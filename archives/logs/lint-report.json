[{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\app\\layout.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_geist' is assigned a value but never used.","line":6,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_geistMono' is assigned a value but never used.","line":7,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":17}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Metadata } from 'next'\r\nimport { Geist, Geist_Mono } from 'next/font/google'\r\nimport { Analytics } from '@vercel/analytics/next'\r\nimport './globals.css'\r\n\r\nconst _geist = Geist({ subsets: [\"latin\"] });\r\nconst _geistMono = Geist_Mono({ subsets: [\"latin\"] });\r\n\r\nexport const metadata: Metadata = {\r\n  title: 'v0 App',\r\n  description: 'Created with v0',\r\n  generator: 'v0.app',\r\n  icons: {\r\n    icon: [\r\n      {\r\n        url: '/icon-light-32x32.png',\r\n        media: '(prefers-color-scheme: light)',\r\n      },\r\n      {\r\n        url: '/icon-dark-32x32.png',\r\n        media: '(prefers-color-scheme: dark)',\r\n      },\r\n      {\r\n        url: '/icon.svg',\r\n        type: 'image/svg+xml',\r\n      },\r\n    ],\r\n    apple: '/apple-icon.png',\r\n  },\r\n}\r\n\r\nexport default function RootLayout({\r\n  children,\r\n}: Readonly<{\r\n  children: React.ReactNode\r\n}>) {\r\n  return (\r\n    <html lang=\"en\">\r\n      <body className={`font-sans antialiased`}>\r\n        {children}\r\n        <Analytics />\r\n      </body>\r\n    </html>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\app\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'selectedFile' is assigned a value but never used.","line":162,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":162,"endColumn":22}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport * as React from \"react\"\r\nimport { Sidebar } from \"@/components/file-explorer/sidebar\"\r\nimport type { FileNode } from \"@/components/file-explorer/file-tree-item\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport {\r\n  Menu,\r\n  FileText,\r\n  Download,\r\n  Filter,\r\n  Upload,\r\n  MoreHorizontal,\r\n  Eye,\r\n  Pencil,\r\n  Trash2,\r\n  Shield,\r\n  LayoutDashboard,\r\n  ClipboardCheck,\r\n  FileBox,\r\n  TrendingUp,\r\n  BarChart3,\r\n} from \"lucide-react\"\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\"\r\n\r\nconst sampleFiles: FileNode[] = [\r\n  {\r\n    id: \"1\",\r\n    name: \"Projetos\",\r\n    type: \"folder\",\r\n    children: [\r\n      {\r\n        id: \"1-1\",\r\n        name: \"Obra Centro Comercial\",\r\n        type: \"folder\",\r\n        children: [\r\n          {\r\n            id: \"1-1-1\",\r\n            name: \"Contratos\",\r\n            type: \"folder\",\r\n            children: [\r\n              { id: \"1-1-1-1\", name: \"contrato-principal.pdf\", type: \"file\", extension: \"pdf\" },\r\n              { id: \"1-1-1-2\", name: \"aditivo-01.pdf\", type: \"file\", extension: \"pdf\" },\r\n              { id: \"1-1-1-3\", name: \"aditivo-02.pdf\", type: \"file\", extension: \"pdf\" },\r\n            ],\r\n          },\r\n          {\r\n            id: \"1-1-2\",\r\n            name: \"Plantas\",\r\n            type: \"folder\",\r\n            children: [\r\n              { id: \"1-1-2-1\", name: \"planta-baixa.dwg\", type: \"file\", extension: \"dwg\" },\r\n              { id: \"1-1-2-2\", name: \"corte-aa.dwg\", type: \"file\", extension: \"dwg\" },\r\n              { id: \"1-1-2-3\", name: \"fachada.png\", type: \"file\", extension: \"png\" },\r\n            ],\r\n          },\r\n          {\r\n            id: \"1-1-3\",\r\n            name: \"Relatórios\",\r\n            type: \"folder\",\r\n            children: [\r\n              { id: \"1-1-3-1\", name: \"relatorio-mensal-jan.xlsx\", type: \"file\", extension: \"xlsx\" },\r\n              { id: \"1-1-3-2\", name: \"relatorio-mensal-fev.xlsx\", type: \"file\", extension: \"xlsx\" },\r\n            ],\r\n          },\r\n        ],\r\n      },\r\n      {\r\n        id: \"1-2\",\r\n        name: \"Residencial Vista Mar\",\r\n        type: \"folder\",\r\n        children: [\r\n          { id: \"1-2-1\", name: \"proposta-comercial.pdf\", type: \"file\", extension: \"pdf\" },\r\n          { id: \"1-2-2\", name: \"cronograma.xlsx\", type: \"file\", extension: \"xlsx\" },\r\n        ],\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    id: \"2\",\r\n    name: \"Documentos Legais\",\r\n    type: \"folder\",\r\n    children: [\r\n      { id: \"2-1\", name: \"alvara-construcao.pdf\", type: \"file\", extension: \"pdf\" },\r\n      { id: \"2-2\", name: \"licenca-ambiental.pdf\", type: \"file\", extension: \"pdf\" },\r\n      { id: \"2-3\", name: \"art-responsavel.pdf\", type: \"file\", extension: \"pdf\" },\r\n    ],\r\n  },\r\n  {\r\n    id: \"3\",\r\n    name: \"Templates\",\r\n    type: \"folder\",\r\n    children: [\r\n      { id: \"3-1\", name: \"modelo-relatorio.docx\", type: \"file\", extension: \"docx\" },\r\n      { id: \"3-2\", name: \"modelo-orcamento.xlsx\", type: \"file\", extension: \"xlsx\" },\r\n      { id: \"3-3\", name: \"modelo-contrato.docx\", type: \"file\", extension: \"docx\" },\r\n    ],\r\n  },\r\n  { id: \"4\", name: \"config.json\", type: \"file\", extension: \"json\" },\r\n]\r\n\r\nconst sampleDocuments = [\r\n  {\r\n    id: \"1\",\r\n    name: \"Contrato Principal - Centro Comercial\",\r\n    type: \"Contrato\",\r\n    version: \"v2.1\",\r\n    status: \"Aprovado\",\r\n    lastModified: \"12/01/2026\",\r\n  },\r\n  {\r\n    id: \"2\",\r\n    name: \"Relatório Mensal - Janeiro 2026\",\r\n    type: \"Relatório\",\r\n    version: \"v1.0\",\r\n    status: \"Em Revisão\",\r\n    lastModified: \"10/01/2026\",\r\n  },\r\n  {\r\n    id: \"3\",\r\n    name: \"Planta Baixa - Térreo\",\r\n    type: \"Projeto\",\r\n    version: \"v3.2\",\r\n    status: \"Aprovado\",\r\n    lastModified: \"08/01/2026\",\r\n  },\r\n  {\r\n    id: \"4\",\r\n    name: \"Aditivo Contratual #02\",\r\n    type: \"Contrato\",\r\n    version: \"v1.0\",\r\n    status: \"Pendente\",\r\n    lastModified: \"05/01/2026\",\r\n  },\r\n  {\r\n    id: \"5\",\r\n    name: \"Cronograma Físico-Financeiro\",\r\n    type: \"Planejamento\",\r\n    version: \"v4.0\",\r\n    status: \"Aprovado\",\r\n    lastModified: \"03/01/2026\",\r\n  },\r\n]\r\n\r\nconst getStatusColor = (status: string) => {\r\n  switch (status) {\r\n    case \"Aprovado\":\r\n      return \"bg-emerald-500/20 text-emerald-400 border-emerald-500/30\"\r\n    case \"Em Revisão\":\r\n      return \"bg-amber-500/20 text-amber-400 border-amber-500/30\"\r\n    case \"Pendente\":\r\n      return \"bg-cyan-500/20 text-cyan-400 border-cyan-500/30\"\r\n    default:\r\n      return \"bg-muted text-muted-foreground\"\r\n  }\r\n}\r\n\r\nexport default function Page() {\r\n  const [selectedFile, setSelectedFile] = React.useState<FileNode | null>(null)\r\n  const [sidebarOpen, setSidebarOpen] = React.useState(true)\r\n  const [activeTab, setActiveTab] = React.useState(\"documentacao\")\r\n\r\n  const tabs = [\r\n    { id: \"dashboard\", label: \"Dashboard\", icon: LayoutDashboard },\r\n    { id: \"auditoria\", label: \"Auditoria Operacional\", icon: ClipboardCheck },\r\n    { id: \"documentacao\", label: \"Documentação\", icon: FileBox },\r\n    { id: \"avanco\", label: \"Avanço Físico\", icon: TrendingUp },\r\n    { id: \"performance\", label: \"Performance (KPIs)\", icon: BarChart3 },\r\n  ]\r\n\r\n  return (\r\n    <div className=\"flex h-screen flex-col bg-background dark\">\r\n      {/* Top Header */}\r\n      <header className=\"flex h-14 items-center justify-between border-b border-border bg-card px-4\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => setSidebarOpen(!sidebarOpen)}>\r\n            <Menu className=\"size-5\" />\r\n          </Button>\r\n          <div className=\"flex items-center gap-2\">\r\n            <div className=\"flex size-8 items-center justify-center rounded-full bg-cyan-500 text-sm font-bold text-black\">\r\n              OP\r\n            </div>\r\n            <span className=\"font-semibold\">ORION - SYSTEM</span>\r\n          </div>\r\n        </div>\r\n      </header>\r\n\r\n      <div className=\"flex flex-1 overflow-hidden\">\r\n        {/* Sidebar */}\r\n        {sidebarOpen && (\r\n          <aside className=\"w-64 border-r border-border\">\r\n            <Sidebar files={sampleFiles} onFileSelect={setSelectedFile} />\r\n          </aside>\r\n        )}\r\n\r\n        {/* Main Content */}\r\n        <main className=\"flex flex-1 flex-col overflow-hidden\">\r\n          {/* Module Header */}\r\n          <div className=\"border-b border-border bg-card/50 p-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-4\">\r\n                <div className=\"flex size-12 items-center justify-center rounded-lg border border-cyan-500/30 bg-cyan-500/10\">\r\n                  <Shield className=\"size-6 text-cyan-500\" />\r\n                </div>\r\n                <div>\r\n                  <h1 className=\"text-2xl font-bold\">MÓDULO GAPO</h1>\r\n                  <p className=\"text-sm text-muted-foreground\">Gestão, Auditoria e Performance de Obras</p>\r\n                </div>\r\n              </div>\r\n              <div className=\"flex items-center gap-2\">\r\n                <Button variant=\"outline\" size=\"sm\" className=\"gap-2 bg-transparent\">\r\n                  <FileText className=\"size-4\" />\r\n                  PDF\r\n                </Button>\r\n                <Button variant=\"outline\" size=\"sm\" className=\"gap-2 bg-transparent\">\r\n                  <FileText className=\"size-4\" />\r\n                  EXCEL\r\n                </Button>\r\n                <Button variant=\"outline\" size=\"sm\" className=\"gap-2 bg-transparent\">\r\n                  <Filter className=\"size-4\" />\r\n                  FILTROS\r\n                </Button>\r\n                <Button size=\"sm\" className=\"gap-2 bg-cyan-500 text-black hover:bg-cyan-600\">\r\n                  <Download className=\"size-4\" />\r\n                  EXPORTAR TUDO\r\n                </Button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Tabs */}\r\n            <div className=\"mt-6 flex gap-1 rounded-lg bg-background/50 p-1\">\r\n              {tabs.map((tab) => {\r\n                const Icon = tab.icon\r\n                return (\r\n                  <button\r\n                    key={tab.id}\r\n                    onClick={() => setActiveTab(tab.id)}\r\n                    className={`flex items-center gap-2 rounded-md px-4 py-2 text-sm font-medium transition-colors ${\r\n                      activeTab === tab.id\r\n                        ? \"bg-card text-foreground shadow-sm\"\r\n                        : \"text-muted-foreground hover:text-foreground\"\r\n                    }`}\r\n                  >\r\n                    <Icon className=\"size-4\" />\r\n                    {tab.label}\r\n                  </button>\r\n                )\r\n              })}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Content Area */}\r\n          <div className=\"flex-1 overflow-auto p-6\">\r\n            {/* Search and Actions */}\r\n            <div className=\"mb-6 flex items-center gap-4\">\r\n              <div className=\"relative flex-1\">\r\n                <Filter className=\"absolute left-3 top-1/2 size-4 -translate-y-1/2 text-muted-foreground\" />\r\n                <Input placeholder=\"Buscar documentos, contratos, projetos...\" className=\"pl-10\" />\r\n              </div>\r\n              <Button className=\"gap-2 bg-cyan-500 text-black hover:bg-cyan-600\">\r\n                <Upload className=\"size-4\" />\r\n                Novo Documento\r\n              </Button>\r\n            </div>\r\n\r\n            {/* Documents Section */}\r\n            <div className=\"rounded-lg border border-border bg-card\">\r\n              <div className=\"border-b border-border p-4\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <FileBox className=\"size-5 text-cyan-500\" />\r\n                  <div>\r\n                    <h2 className=\"font-semibold\">Repositório de Documentos</h2>\r\n                    <p className=\"text-sm text-muted-foreground\">Gestão versionada e segura de arquivos da obra.</p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <Table>\r\n                <TableHeader>\r\n                  <TableRow>\r\n                    <TableHead className=\"text-xs uppercase text-muted-foreground\">Nome do Arquivo</TableHead>\r\n                    <TableHead className=\"text-xs uppercase text-muted-foreground\">Tipo</TableHead>\r\n                    <TableHead className=\"text-xs uppercase text-muted-foreground\">Versão</TableHead>\r\n                    <TableHead className=\"text-xs uppercase text-muted-foreground\">Status</TableHead>\r\n                    <TableHead className=\"text-xs uppercase text-muted-foreground\">Última Modificação</TableHead>\r\n                    <TableHead className=\"text-right text-xs uppercase text-muted-foreground\">Ações</TableHead>\r\n                  </TableRow>\r\n                </TableHeader>\r\n                <TableBody>\r\n                  {sampleDocuments.map((doc) => (\r\n                    <TableRow key={doc.id}>\r\n                      <TableCell className=\"font-medium\">{doc.name}</TableCell>\r\n                      <TableCell>{doc.type}</TableCell>\r\n                      <TableCell>\r\n                        <Badge variant=\"outline\" className=\"font-mono text-xs\">\r\n                          {doc.version}\r\n                        </Badge>\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        <Badge className={getStatusColor(doc.status)}>{doc.status}</Badge>\r\n                      </TableCell>\r\n                      <TableCell className=\"text-muted-foreground\">{doc.lastModified}</TableCell>\r\n                      <TableCell className=\"text-right\">\r\n                        <DropdownMenu>\r\n                          <DropdownMenuTrigger asChild>\r\n                            <Button variant=\"ghost\" size=\"icon\" className=\"size-8\">\r\n                              <MoreHorizontal className=\"size-4\" />\r\n                            </Button>\r\n                          </DropdownMenuTrigger>\r\n                          <DropdownMenuContent align=\"end\">\r\n                            <DropdownMenuItem className=\"gap-2\">\r\n                              <Eye className=\"size-4\" />\r\n                              Visualizar\r\n                            </DropdownMenuItem>\r\n                            <DropdownMenuItem className=\"gap-2\">\r\n                              <Download className=\"size-4\" />\r\n                              Download\r\n                            </DropdownMenuItem>\r\n                            <DropdownMenuItem className=\"gap-2\">\r\n                              <Pencil className=\"size-4\" />\r\n                              Editar\r\n                            </DropdownMenuItem>\r\n                            <DropdownMenuItem className=\"gap-2 text-destructive\">\r\n                              <Trash2 className=\"size-4\" />\r\n                              Excluir\r\n                            </DropdownMenuItem>\r\n                          </DropdownMenuContent>\r\n                        </DropdownMenu>\r\n                      </TableCell>\r\n                    </TableRow>\r\n                  ))}\r\n                </TableBody>\r\n              </Table>\r\n            </div>\r\n          </div>\r\n        </main>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\file-explorer\\file-explorer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\file-explorer\\file-tree-item.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\file-explorer\\outline-panel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\file-explorer\\settings-panel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\file-explorer\\sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\theme-provider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\accordion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\alert.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\aspect-ratio.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\breadcrumb.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\button-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\calendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\carousel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\chart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\collapsible.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\command.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\context-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\drawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\empty.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\field.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\form.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\hover-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\input-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\input-otp.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\item.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\kbd.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\menubar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\navigation-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\pagination.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\radio-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\resizable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\slider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\sonner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\spinner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\toaster.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\toggle-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\toggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\use-mobile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\components\\ui\\use-toast.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'actionTypes' is assigned a value but only used as a type.","line":18,"column":7,"nodeType":null,"messageId":"usedOnlyAsType","endLine":18,"endColumn":18}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\n// Inspired by react-hot-toast library\r\nimport * as React from 'react'\r\n\r\nimport type { ToastActionElement, ToastProps } from '@/components/ui/toast'\r\n\r\nconst TOAST_LIMIT = 1\r\nconst TOAST_REMOVE_DELAY = 1000000\r\n\r\ntype ToasterToast = ToastProps & {\r\n  id: string\r\n  title?: React.ReactNode\r\n  description?: React.ReactNode\r\n  action?: ToastActionElement\r\n}\r\n\r\nconst actionTypes = {\r\n  ADD_TOAST: 'ADD_TOAST',\r\n  UPDATE_TOAST: 'UPDATE_TOAST',\r\n  DISMISS_TOAST: 'DISMISS_TOAST',\r\n  REMOVE_TOAST: 'REMOVE_TOAST',\r\n} as const\r\n\r\nlet count = 0\r\n\r\nfunction genId() {\r\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\r\n  return count.toString()\r\n}\r\n\r\ntype ActionType = typeof actionTypes\r\n\r\ntype Action =\r\n  | {\r\n      type: ActionType['ADD_TOAST']\r\n      toast: ToasterToast\r\n    }\r\n  | {\r\n      type: ActionType['UPDATE_TOAST']\r\n      toast: Partial<ToasterToast>\r\n    }\r\n  | {\r\n      type: ActionType['DISMISS_TOAST']\r\n      toastId?: ToasterToast['id']\r\n    }\r\n  | {\r\n      type: ActionType['REMOVE_TOAST']\r\n      toastId?: ToasterToast['id']\r\n    }\r\n\r\ninterface State {\r\n  toasts: ToasterToast[]\r\n}\r\n\r\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\r\n\r\nconst addToRemoveQueue = (toastId: string) => {\r\n  if (toastTimeouts.has(toastId)) {\r\n    return\r\n  }\r\n\r\n  const timeout = setTimeout(() => {\r\n    toastTimeouts.delete(toastId)\r\n    dispatch({\r\n      type: 'REMOVE_TOAST',\r\n      toastId: toastId,\r\n    })\r\n  }, TOAST_REMOVE_DELAY)\r\n\r\n  toastTimeouts.set(toastId, timeout)\r\n}\r\n\r\nexport const reducer = (state: State, action: Action): State => {\r\n  switch (action.type) {\r\n    case 'ADD_TOAST':\r\n      return {\r\n        ...state,\r\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\r\n      }\r\n\r\n    case 'UPDATE_TOAST':\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.map((t) =>\r\n          t.id === action.toast.id ? { ...t, ...action.toast } : t,\r\n        ),\r\n      }\r\n\r\n    case 'DISMISS_TOAST': {\r\n      const { toastId } = action\r\n\r\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\r\n      // but I'll keep it here for simplicity\r\n      if (toastId) {\r\n        addToRemoveQueue(toastId)\r\n      } else {\r\n        state.toasts.forEach((toast) => {\r\n          addToRemoveQueue(toast.id)\r\n        })\r\n      }\r\n\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.map((t) =>\r\n          t.id === toastId || toastId === undefined\r\n            ? {\r\n                ...t,\r\n                open: false,\r\n              }\r\n            : t,\r\n        ),\r\n      }\r\n    }\r\n    case 'REMOVE_TOAST':\r\n      if (action.toastId === undefined) {\r\n        return {\r\n          ...state,\r\n          toasts: [],\r\n        }\r\n      }\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\r\n      }\r\n  }\r\n}\r\n\r\nconst listeners: Array<(state: State) => void> = []\r\n\r\nlet memoryState: State = { toasts: [] }\r\n\r\nfunction dispatch(action: Action) {\r\n  memoryState = reducer(memoryState, action)\r\n  listeners.forEach((listener) => {\r\n    listener(memoryState)\r\n  })\r\n}\r\n\r\ntype Toast = Omit<ToasterToast, 'id'>\r\n\r\nfunction toast({ ...props }: Toast) {\r\n  const id = genId()\r\n\r\n  const update = (props: ToasterToast) =>\r\n    dispatch({\r\n      type: 'UPDATE_TOAST',\r\n      toast: { ...props, id },\r\n    })\r\n  const dismiss = () => dispatch({ type: 'DISMISS_TOAST', toastId: id })\r\n\r\n  dispatch({\r\n    type: 'ADD_TOAST',\r\n    toast: {\r\n      ...props,\r\n      id,\r\n      open: true,\r\n      onOpenChange: (open) => {\r\n        if (!open) dismiss()\r\n      },\r\n    },\r\n  })\r\n\r\n  return {\r\n    id: id,\r\n    dismiss,\r\n    update,\r\n  }\r\n}\r\n\r\nfunction useToast() {\r\n  const [state, setState] = React.useState<State>(memoryState)\r\n\r\n  React.useEffect(() => {\r\n    listeners.push(setState)\r\n    return () => {\r\n      const index = listeners.indexOf(setState)\r\n      if (index > -1) {\r\n        listeners.splice(index, 1)\r\n      }\r\n    }\r\n  }, [state])\r\n\r\n  return {\r\n    ...state,\r\n    toast,\r\n    dismiss: (toastId?: string) => dispatch({ type: 'DISMISS_TOAST', toastId }),\r\n  }\r\n}\r\n\r\nexport { useToast, toast }\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\hooks\\use-mobile.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\hooks\\use-toast.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'actionTypes' is assigned a value but only used as a type.","line":18,"column":7,"nodeType":null,"messageId":"usedOnlyAsType","endLine":18,"endColumn":18}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\n// Inspired by react-hot-toast library\r\nimport * as React from 'react'\r\n\r\nimport type { ToastActionElement, ToastProps } from '@/components/ui/toast'\r\n\r\nconst TOAST_LIMIT = 1\r\nconst TOAST_REMOVE_DELAY = 1000000\r\n\r\ntype ToasterToast = ToastProps & {\r\n  id: string\r\n  title?: React.ReactNode\r\n  description?: React.ReactNode\r\n  action?: ToastActionElement\r\n}\r\n\r\nconst actionTypes = {\r\n  ADD_TOAST: 'ADD_TOAST',\r\n  UPDATE_TOAST: 'UPDATE_TOAST',\r\n  DISMISS_TOAST: 'DISMISS_TOAST',\r\n  REMOVE_TOAST: 'REMOVE_TOAST',\r\n} as const\r\n\r\nlet count = 0\r\n\r\nfunction genId() {\r\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\r\n  return count.toString()\r\n}\r\n\r\ntype ActionType = typeof actionTypes\r\n\r\ntype Action =\r\n  | {\r\n      type: ActionType['ADD_TOAST']\r\n      toast: ToasterToast\r\n    }\r\n  | {\r\n      type: ActionType['UPDATE_TOAST']\r\n      toast: Partial<ToasterToast>\r\n    }\r\n  | {\r\n      type: ActionType['DISMISS_TOAST']\r\n      toastId?: ToasterToast['id']\r\n    }\r\n  | {\r\n      type: ActionType['REMOVE_TOAST']\r\n      toastId?: ToasterToast['id']\r\n    }\r\n\r\ninterface State {\r\n  toasts: ToasterToast[]\r\n}\r\n\r\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\r\n\r\nconst addToRemoveQueue = (toastId: string) => {\r\n  if (toastTimeouts.has(toastId)) {\r\n    return\r\n  }\r\n\r\n  const timeout = setTimeout(() => {\r\n    toastTimeouts.delete(toastId)\r\n    dispatch({\r\n      type: 'REMOVE_TOAST',\r\n      toastId: toastId,\r\n    })\r\n  }, TOAST_REMOVE_DELAY)\r\n\r\n  toastTimeouts.set(toastId, timeout)\r\n}\r\n\r\nexport const reducer = (state: State, action: Action): State => {\r\n  switch (action.type) {\r\n    case 'ADD_TOAST':\r\n      return {\r\n        ...state,\r\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\r\n      }\r\n\r\n    case 'UPDATE_TOAST':\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.map((t) =>\r\n          t.id === action.toast.id ? { ...t, ...action.toast } : t,\r\n        ),\r\n      }\r\n\r\n    case 'DISMISS_TOAST': {\r\n      const { toastId } = action\r\n\r\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\r\n      // but I'll keep it here for simplicity\r\n      if (toastId) {\r\n        addToRemoveQueue(toastId)\r\n      } else {\r\n        state.toasts.forEach((toast) => {\r\n          addToRemoveQueue(toast.id)\r\n        })\r\n      }\r\n\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.map((t) =>\r\n          t.id === toastId || toastId === undefined\r\n            ? {\r\n                ...t,\r\n                open: false,\r\n              }\r\n            : t,\r\n        ),\r\n      }\r\n    }\r\n    case 'REMOVE_TOAST':\r\n      if (action.toastId === undefined) {\r\n        return {\r\n          ...state,\r\n          toasts: [],\r\n        }\r\n      }\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\r\n      }\r\n  }\r\n}\r\n\r\nconst listeners: Array<(state: State) => void> = []\r\n\r\nlet memoryState: State = { toasts: [] }\r\n\r\nfunction dispatch(action: Action) {\r\n  memoryState = reducer(memoryState, action)\r\n  listeners.forEach((listener) => {\r\n    listener(memoryState)\r\n  })\r\n}\r\n\r\ntype Toast = Omit<ToasterToast, 'id'>\r\n\r\nfunction toast({ ...props }: Toast) {\r\n  const id = genId()\r\n\r\n  const update = (props: ToasterToast) =>\r\n    dispatch({\r\n      type: 'UPDATE_TOAST',\r\n      toast: { ...props, id },\r\n    })\r\n  const dismiss = () => dispatch({ type: 'DISMISS_TOAST', toastId: id })\r\n\r\n  dispatch({\r\n    type: 'ADD_TOAST',\r\n    toast: {\r\n      ...props,\r\n      id,\r\n      open: true,\r\n      onOpenChange: (open) => {\r\n        if (!open) dismiss()\r\n      },\r\n    },\r\n  })\r\n\r\n  return {\r\n    id: id,\r\n    dismiss,\r\n    update,\r\n  }\r\n}\r\n\r\nfunction useToast() {\r\n  const [state, setState] = React.useState<State>(memoryState)\r\n\r\n  React.useEffect(() => {\r\n    listeners.push(setState)\r\n    return () => {\r\n      const index = listeners.indexOf(setState)\r\n      if (index > -1) {\r\n        listeners.splice(index, 1)\r\n      }\r\n    }\r\n  }, [state])\r\n\r\n  return {\r\n    ...state,\r\n    toast,\r\n    dismiss: (toastId?: string) => dispatch({ type: 'DISMISS_TOAST', toastId }),\r\n  }\r\n}\r\n\r\nexport { useToast, toast }\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\next.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\FileSystem\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\analyze-lint.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":16,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":16,"endColumn":8},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":20,"column":33,"nodeType":"Identifier","messageId":"undef","endLine":20,"endColumn":40},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":22,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":22,"endColumn":8},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":26,"column":33,"nodeType":"Identifier","messageId":"undef","endLine":26,"endColumn":40}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import fs from 'fs';\r\nconst report = JSON.parse(fs.readFileSync('lint-report.json', 'utf8'));\r\nconst fileErrors = {};\r\nconst ruleErrors = {};\r\n\r\nreport.forEach(file => {\r\n    if (file.errorCount > 0) {\r\n        fileErrors[file.filePath] = file.errorCount;\r\n        file.messages.forEach(msg => {\r\n            const ruleId = msg.ruleId || 'unknown';\r\n            ruleErrors[ruleId] = (ruleErrors[ruleId] || 0) + 1;\r\n        });\r\n    }\r\n});\r\n\r\nconsole.log('--- Top 10 Files with Errors ---');\r\nObject.entries(fileErrors)\r\n    .sort((a, b) => b[1] - a[1])\r\n    .slice(0, 10)\r\n    .forEach(([path, count]) => console.log(`${count}: ${path}`)); // Printing full path might be better for uniqueness but filename is cleaner\r\n\r\nconsole.log('\\n--- Top 10 Rules Violated ---');\r\nObject.entries(ruleErrors)\r\n    .sort((a, b) => b[1] - a[1])\r\n    .slice(0, 10)\r\n    .forEach(([rule, count]) => console.log(`${count}: ${rule}`));\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\dev-dist\\registerSW.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":1,"column":23,"nodeType":"Identifier","messageId":"undef","endLine":1,"endColumn":32},{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":1,"column":34,"nodeType":"Identifier","messageId":"undef","endLine":1,"endColumn":43}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"if('serviceWorker' in navigator) navigator.serviceWorker.register('/dev-sw.js?dev-sw', { scope: '/', type: 'classic' })","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\dev-dist\\sw.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":15,"column":6,"nodeType":"Identifier","messageId":"undef","endLine":15,"endColumn":10},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":23,"column":15,"nodeType":"Identifier","messageId":"undef","endLine":23,"endColumn":18},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":27,"column":29,"nodeType":"Identifier","messageId":"undef","endLine":27,"endColumn":33},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":28,"column":28,"nodeType":"Identifier","messageId":"undef","endLine":28,"endColumn":36},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":31,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":31,"endColumn":21},{"ruleId":"no-undef","severity":2,"message":"'importScripts' is not defined.","line":34,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":34,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":49,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":49,"endColumn":7},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":50,"column":49,"nodeType":"Identifier","messageId":"undef","endLine":50,"endColumn":53},{"ruleId":"no-undef","severity":2,"message":"'document' is not defined.","line":50,"column":56,"nodeType":"Identifier","messageId":"undef","endLine":50,"endColumn":64},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":50,"column":92,"nodeType":"Identifier","messageId":"undef","endLine":50,"endColumn":100},{"ruleId":"no-undef","severity":2,"message":"'define' is not defined.","line":70,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":70,"endColumn":7},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":72,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":72,"endColumn":7}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Copyright 2018 Google Inc. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n// If the loader is already loaded, just stop.\r\nif (!self.define) {\r\n  let registry = {};\r\n\r\n  // Used for `eval` and `importScripts` where we can't get script URL by other means.\r\n  // In both cases, it's safe to use a global var because those functions are synchronous.\r\n  let nextDefineUri;\r\n\r\n  const singleRequire = (uri, parentUri) => {\r\n    uri = new URL(uri + \".js\", parentUri).href;\r\n    return registry[uri] || (\r\n      \r\n        new Promise(resolve => {\r\n          if (\"document\" in self) {\r\n            const script = document.createElement(\"script\");\r\n            script.src = uri;\r\n            script.onload = resolve;\r\n            document.head.appendChild(script);\r\n          } else {\r\n            nextDefineUri = uri;\r\n            importScripts(uri);\r\n            resolve();\r\n          }\r\n        })\r\n      \r\n      .then(() => {\r\n        let promise = registry[uri];\r\n        if (!promise) {\r\n          throw new Error(`Module ${uri} didn’t register its module`);\r\n        }\r\n        return promise;\r\n      })\r\n    );\r\n  };\r\n\r\n  self.define = (depsNames, factory) => {\r\n    const uri = nextDefineUri || (\"document\" in self ? document.currentScript.src : \"\") || location.href;\r\n    if (registry[uri]) {\r\n      // Module is already loading or loaded.\r\n      return;\r\n    }\r\n    let exports = {};\r\n    const require = depUri => singleRequire(depUri, uri);\r\n    const specialDeps = {\r\n      module: { uri },\r\n      exports,\r\n      require\r\n    };\r\n    registry[uri] = Promise.all(depsNames.map(\r\n      depName => specialDeps[depName] || require(depName)\r\n    )).then(deps => {\r\n      factory(...deps);\r\n      return exports;\r\n    });\r\n  };\r\n}\r\ndefine(['./workbox-d0715b1c'], (function (workbox) { 'use strict';\r\n\r\n  self.skipWaiting();\r\n  workbox.clientsClaim();\r\n\r\n  /**\r\n   * The precacheAndRoute() method efficiently caches and responds to\r\n   * requests for URLs in the manifest.\r\n   * See https://goo.gl/S9QRab\r\n   */\r\n  workbox.precacheAndRoute([{\r\n    \"url\": \"registerSW.js\",\r\n    \"revision\": \"3ca0b8505b4bec776b69afdba2768812\"\r\n  }, {\r\n    \"url\": \"index.html\",\r\n    \"revision\": \"0.3bghqlukmd\"\r\n  }], {});\r\n  workbox.cleanupOutdatedCaches();\r\n  workbox.registerRoute(new workbox.NavigationRoute(workbox.createHandlerBoundToURL(\"index.html\"), {\r\n    allowlist: [/^\\/$/]\r\n  }));\r\n  workbox.registerRoute(/\\.(?:png|jpg|jpeg|svg|gif|webp)$/, new workbox.CacheFirst({\r\n    \"cacheName\": \"images-cache\",\r\n    plugins: [new workbox.ExpirationPlugin({\r\n      maxEntries: 50,\r\n      maxAgeSeconds: 2592000\r\n    })]\r\n  }), 'GET');\r\n  workbox.registerRoute(({\r\n    url\r\n  }) => url.hostname.includes(\"supabase.co\"), new workbox.NetworkOnly(), 'GET');\r\n  workbox.registerRoute(/^https:\\/\\/fonts\\.googleapis\\.com\\/.*/, new workbox.StaleWhileRevalidate({\r\n    \"cacheName\": \"google-fonts-stylesheets\",\r\n    plugins: []\r\n  }), 'GET');\r\n  workbox.registerRoute(/^https:\\/\\/fonts\\.gstatic\\.com\\/.*/, new workbox.CacheFirst({\r\n    \"cacheName\": \"google-fonts-webfonts\",\r\n    plugins: [new workbox.ExpirationPlugin({\r\n      maxEntries: 30,\r\n      maxAgeSeconds: 31536000\r\n    })]\r\n  }), 'GET');\r\n\r\n}));\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\dev-dist\\workbox-d0715b1c.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'define' is not defined.","line":1,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":1,"endColumn":7},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":3,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":3,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[63,76],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":2,"message":"Expected an assignment or function call and instead saw an expression.","line":5,"column":7,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":5,"endColumn":41},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":5,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":5,"endColumn":11},{"ruleId":"no-undef","severity":2,"message":"'_' is not defined.","line":5,"column":37,"nodeType":"Identifier","messageId":"undef","endLine":5,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":6,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":15},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":6,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":6,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[148,148],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":18,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":18,"endColumn":13},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":30,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":30,"endColumn":17},{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":36,"column":53,"nodeType":"Identifier","messageId":"undef","endLine":36,"endColumn":62},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":37,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":37,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":44,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":44,"endColumn":16},{"ruleId":"@typescript-eslint/ban-types","message":"Definition for rule '@typescript-eslint/ban-types' was not found.","line":52,"column":7,"endLine":52,"endColumn":63,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/ban-types","message":"Definition for rule '@typescript-eslint/ban-types' was not found.","line":419,"column":5,"endLine":419,"endColumn":61,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":456,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":456,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[17801,17814],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":2,"message":"Expected an assignment or function call and instead saw an expression.","line":458,"column":7,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":458,"endColumn":44},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":458,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":458,"endColumn":11},{"ruleId":"no-undef","severity":2,"message":"'_' is not defined.","line":458,"column":40,"nodeType":"Identifier","messageId":"undef","endLine":458,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":459,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":459,"endColumn":15},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":459,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":459,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[17889,17889],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":637,"column":30,"nodeType":"Identifier","messageId":"undef","endLine":637,"endColumn":38},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":661,"column":26,"nodeType":"Identifier","messageId":"undef","endLine":661,"endColumn":29},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":661,"column":43,"nodeType":"Identifier","messageId":"undef","endLine":661,"endColumn":51},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":664,"column":49,"nodeType":"Identifier","messageId":"undef","endLine":664,"endColumn":57},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":713,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":713,"endColumn":13},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":750,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":750,"endColumn":13},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":765,"column":35,"nodeType":"Identifier","messageId":"undef","endLine":765,"endColumn":42},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":799,"column":50,"nodeType":"Identifier","messageId":"undef","endLine":799,"endColumn":57},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":806,"column":25,"nodeType":"Identifier","messageId":"undef","endLine":806,"endColumn":28},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":806,"column":42,"nodeType":"Identifier","messageId":"undef","endLine":806,"endColumn":50},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":813,"column":43,"nodeType":"Identifier","messageId":"undef","endLine":813,"endColumn":51},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":1135,"column":32,"nodeType":"Identifier","messageId":"undef","endLine":1135,"endColumn":35},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":1135,"column":45,"nodeType":"Identifier","messageId":"undef","endLine":1135,"endColumn":53},{"ruleId":"no-undef","severity":2,"message":"'registration' is not defined.","line":1197,"column":53,"nodeType":"Identifier","messageId":"undef","endLine":1197,"endColumn":65},{"ruleId":"@typescript-eslint/ban-types","message":"Definition for rule '@typescript-eslint/ban-types' was not found.","line":1257,"column":5,"endLine":1257,"endColumn":61,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/ban-types","message":"Definition for rule '@typescript-eslint/ban-types' was not found.","line":1275,"column":5,"endLine":1275,"endColumn":61,"severity":2,"nodeType":null},{"ruleId":"no-func-assign","severity":2,"message":"'_extends' is a function.","line":1291,"column":14,"nodeType":"Identifier","messageId":"isAFunction","endLine":1291,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":2,"message":"Expected an assignment or function call and instead saw an expression.","line":1294,"column":28,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1294,"endColumn":76},{"ruleId":"no-undef","severity":2,"message":"'IDBDatabase' is not defined.","line":1305,"column":57,"nodeType":"Identifier","messageId":"undef","endLine":1305,"endColumn":68},{"ruleId":"no-undef","severity":2,"message":"'IDBObjectStore' is not defined.","line":1305,"column":70,"nodeType":"Identifier","messageId":"undef","endLine":1305,"endColumn":84},{"ruleId":"no-undef","severity":2,"message":"'IDBIndex' is not defined.","line":1305,"column":86,"nodeType":"Identifier","messageId":"undef","endLine":1305,"endColumn":94},{"ruleId":"no-undef","severity":2,"message":"'IDBCursor' is not defined.","line":1305,"column":96,"nodeType":"Identifier","messageId":"undef","endLine":1305,"endColumn":105},{"ruleId":"no-undef","severity":2,"message":"'IDBTransaction' is not defined.","line":1305,"column":107,"nodeType":"Identifier","messageId":"undef","endLine":1305,"endColumn":121},{"ruleId":"no-undef","severity":2,"message":"'IDBCursor' is not defined.","line":1309,"column":63,"nodeType":"Identifier","messageId":"undef","endLine":1309,"endColumn":72},{"ruleId":"no-undef","severity":2,"message":"'IDBCursor' is not defined.","line":1309,"column":92,"nodeType":"Identifier","messageId":"undef","endLine":1309,"endColumn":101},{"ruleId":"no-undef","severity":2,"message":"'IDBCursor' is not defined.","line":1309,"column":122,"nodeType":"Identifier","messageId":"undef","endLine":1309,"endColumn":131},{"ruleId":"no-undef","severity":2,"message":"'IDBCursor' is not defined.","line":1336,"column":30,"nodeType":"Identifier","messageId":"undef","endLine":1336,"endColumn":39},{"ruleId":"no-undef","severity":2,"message":"'DOMException' is not defined.","line":1360,"column":34,"nodeType":"Identifier","messageId":"undef","endLine":1360,"endColumn":46},{"ruleId":"no-undef","severity":2,"message":"'IDBTransaction' is not defined.","line":1372,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":1372,"endColumn":45},{"ruleId":"no-undef","severity":2,"message":"'IDBTransaction' is not defined.","line":1392,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":1392,"endColumn":45},{"ruleId":"no-undef","severity":2,"message":"'IDBDatabase' is not defined.","line":1405,"column":20,"nodeType":"Identifier","messageId":"undef","endLine":1405,"endColumn":31},{"ruleId":"no-undef","severity":2,"message":"'IDBTransaction' is not defined.","line":1405,"column":81,"nodeType":"Identifier","messageId":"undef","endLine":1405,"endColumn":95},{"ruleId":"no-undef","severity":2,"message":"'IDBTransaction' is not defined.","line":1435,"column":28,"nodeType":"Identifier","messageId":"undef","endLine":1435,"endColumn":42},{"ruleId":"no-undef","severity":2,"message":"'IDBRequest' is not defined.","line":1443,"column":28,"nodeType":"Identifier","messageId":"undef","endLine":1443,"endColumn":38},{"ruleId":"no-undef","severity":2,"message":"'indexedDB' is not defined.","line":1471,"column":23,"nodeType":"Identifier","messageId":"undef","endLine":1471,"endColumn":32},{"ruleId":"no-undef","severity":2,"message":"'indexedDB' is not defined.","line":1499,"column":23,"nodeType":"Identifier","messageId":"undef","endLine":1499,"endColumn":32},{"ruleId":"no-undef","severity":2,"message":"'IDBDatabase' is not defined.","line":1511,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":1511,"endColumn":42},{"ruleId":"no-undef","severity":2,"message":"'IDBIndex' is not defined.","line":1520,"column":39,"nodeType":"Identifier","messageId":"undef","endLine":1520,"endColumn":47},{"ruleId":"no-undef","severity":2,"message":"'IDBObjectStore' is not defined.","line":1520,"column":50,"nodeType":"Identifier","messageId":"undef","endLine":1520,"endColumn":64},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":1543,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":1543,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[60095,60108],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":2,"message":"Expected an assignment or function call and instead saw an expression.","line":1545,"column":7,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1545,"endColumn":47},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":1545,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":1545,"endColumn":11},{"ruleId":"no-undef","severity":2,"message":"'_' is not defined.","line":1545,"column":43,"nodeType":"Identifier","messageId":"undef","endLine":1545,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":1546,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":1546,"endColumn":15},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1546,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1546,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[60186,60186],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":1558,"column":23,"nodeType":"Identifier","messageId":"undef","endLine":1558,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":1558,"column":44,"nodeType":"Identifier","messageId":"undef","endLine":1558,"endColumn":52},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":1812,"column":29,"nodeType":"Identifier","messageId":"undef","endLine":1812,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":1967,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":1967,"endColumn":27},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":1999,"column":52,"nodeType":"Identifier","messageId":"undef","endLine":1999,"endColumn":59},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":2129,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":2129,"endColumn":21},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":2144,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":2144,"endColumn":34},{"ruleId":"no-undef","severity":2,"message":"'setTimeout' is not defined.","line":2253,"column":37,"nodeType":"Identifier","messageId":"undef","endLine":2253,"endColumn":47},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":2256,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":2256,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[87677,87690],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":2,"message":"Expected an assignment or function call and instead saw an expression.","line":2258,"column":7,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":2258,"endColumn":47},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":2258,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":2258,"endColumn":11},{"ruleId":"no-undef","severity":2,"message":"'_' is not defined.","line":2258,"column":43,"nodeType":"Identifier","messageId":"undef","endLine":2258,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":2259,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":2259,"endColumn":15},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":2259,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":2259,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[87768,87768],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":2269,"column":46,"nodeType":"Identifier","messageId":"undef","endLine":2269,"endColumn":53},{"ruleId":"no-undef","severity":2,"message":"'ExtendableEvent' is not defined.","line":2337,"column":56,"nodeType":"Identifier","messageId":"undef","endLine":2337,"endColumn":71},{"ruleId":"no-undef","severity":2,"message":"'FetchEvent' is not defined.","line":2376,"column":61,"nodeType":"Identifier","messageId":"undef","endLine":2376,"endColumn":71},{"ruleId":"no-undef","severity":2,"message":"'fetch' is not defined.","line":2410,"column":33,"nodeType":"Identifier","messageId":"undef","endLine":2410,"endColumn":38},{"ruleId":"no-constant-condition","severity":2,"message":"Unexpected constant condition.","line":2411,"column":15,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":2411,"endColumn":45},{"ruleId":"no-undef","severity":2,"message":"'caches' is not defined.","line":2478,"column":32,"nodeType":"Identifier","messageId":"undef","endLine":2478,"endColumn":38},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":2550,"column":29,"nodeType":"Identifier","messageId":"undef","endLine":2550,"endColumn":33},{"ruleId":"no-undef","severity":2,"message":"'FetchEvent' is not defined.","line":2877,"column":32,"nodeType":"Identifier","messageId":"undef","endLine":2877,"endColumn":42},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":2884,"column":67,"nodeType":"Identifier","messageId":"undef","endLine":2884,"endColumn":74},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":2945,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":2945,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":3042,"column":50,"nodeType":"Identifier","messageId":"undef","endLine":3042,"endColumn":57},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":3137,"column":50,"nodeType":"Identifier","messageId":"undef","endLine":3137,"endColumn":57},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":3269,"column":50,"nodeType":"Identifier","messageId":"undef","endLine":3269,"endColumn":57},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":3333,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":3333,"endColumn":11},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":3333,"column":47,"nodeType":"Identifier","messageId":"undef","endLine":3333,"endColumn":51},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":3357,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":3357,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[131585,131598],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":2,"message":"Expected an assignment or function call and instead saw an expression.","line":3359,"column":7,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":3359,"endColumn":47},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":3359,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":3359,"endColumn":11},{"ruleId":"no-undef","severity":2,"message":"'_' is not defined.","line":3359,"column":43,"nodeType":"Identifier","messageId":"undef","endLine":3359,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":3360,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":3360,"endColumn":15},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":3360,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":3360,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[131676,131676],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":3389,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":3389,"endColumn":34},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":3389,"column":42,"nodeType":"Identifier","messageId":"undef","endLine":3389,"endColumn":50},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":3407,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":3407,"endColumn":34},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":3407,"column":40,"nodeType":"Identifier","messageId":"undef","endLine":3407,"endColumn":48},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":3415,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":3415,"endColumn":34},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":3415,"column":40,"nodeType":"Identifier","messageId":"undef","endLine":3415,"endColumn":48},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":3416,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":3416,"endColumn":34},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":3416,"column":40,"nodeType":"Identifier","messageId":"undef","endLine":3416,"endColumn":48},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":3456,"column":84,"nodeType":"Identifier","messageId":"undef","endLine":3456,"endColumn":91},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":3496,"column":33,"nodeType":"Identifier","messageId":"undef","endLine":3496,"endColumn":40},{"ruleId":"no-undef","severity":2,"message":"'Response' is not defined.","line":3603,"column":34,"nodeType":"Identifier","messageId":"undef","endLine":3603,"endColumn":42},{"ruleId":"no-undef","severity":2,"message":"'Response' is not defined.","line":3606,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":3606,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":3608,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":3608,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":3647,"column":33,"nodeType":"Identifier","messageId":"undef","endLine":3647,"endColumn":36},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":3650,"column":22,"nodeType":"Identifier","messageId":"undef","endLine":3650,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'Headers' is not defined.","line":3658,"column":22,"nodeType":"Identifier","messageId":"undef","endLine":3658,"endColumn":29},{"ruleId":"no-undef","severity":2,"message":"'Response' is not defined.","line":3668,"column":18,"nodeType":"Identifier","messageId":"undef","endLine":3668,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":3752,"column":46,"nodeType":"Identifier","messageId":"undef","endLine":3752,"endColumn":53},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":3784,"column":87,"nodeType":"Identifier","messageId":"undef","endLine":3784,"endColumn":94},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":3943,"column":11,"nodeType":"Identifier","messageId":"undef","endLine":3943,"endColumn":15},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":3944,"column":11,"nodeType":"Identifier","messageId":"undef","endLine":3944,"endColumn":15},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":4022,"column":33,"nodeType":"Identifier","messageId":"undef","endLine":4022,"endColumn":40},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":4062,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":4062,"endColumn":35},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":4108,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":4108,"endColumn":34},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":4108,"column":40,"nodeType":"Identifier","messageId":"undef","endLine":4108,"endColumn":48},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":4138,"column":40,"nodeType":"Identifier","messageId":"undef","endLine":4138,"endColumn":47},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":4141,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":4141,"endColumn":35},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":4162,"column":33,"nodeType":"Identifier","messageId":"undef","endLine":4162,"endColumn":40},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":4243,"column":29,"nodeType":"Identifier","messageId":"undef","endLine":4243,"endColumn":32},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":4243,"column":38,"nodeType":"Identifier","messageId":"undef","endLine":4243,"endColumn":46},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":4249,"column":34,"nodeType":"Identifier","messageId":"undef","endLine":4249,"endColumn":37},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":4254,"column":30,"nodeType":"Identifier","messageId":"undef","endLine":4254,"endColumn":33},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":4436,"column":32,"nodeType":"Identifier","messageId":"undef","endLine":4436,"endColumn":36},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":4438,"column":74,"nodeType":"Identifier","messageId":"undef","endLine":4438,"endColumn":78},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":4440,"column":61,"nodeType":"Identifier","messageId":"undef","endLine":4440,"endColumn":65},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":4459,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":4459,"endColumn":11}],"suppressedMessages":[],"errorCount":136,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"define(['exports'], (function (exports) { 'use strict';\r\n\r\n    // @ts-ignore\r\n    try {\r\n      self['workbox:core:7.3.0'] && _();\r\n    } catch (e) {}\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const logger = (() => {\r\n      // Don't overwrite this value if it's already set.\r\n      // See https://github.com/GoogleChrome/workbox/pull/2284#issuecomment-560470923\r\n      if (!('__WB_DISABLE_DEV_LOGS' in globalThis)) {\r\n        self.__WB_DISABLE_DEV_LOGS = false;\r\n      }\r\n      let inGroup = false;\r\n      const methodToColorMap = {\r\n        debug: `#7f8c8d`,\r\n        log: `#2ecc71`,\r\n        warn: `#f39c12`,\r\n        error: `#c0392b`,\r\n        groupCollapsed: `#3498db`,\r\n        groupEnd: null // No colored prefix on groupEnd\r\n      };\r\n      const print = function (method, args) {\r\n        if (self.__WB_DISABLE_DEV_LOGS) {\r\n          return;\r\n        }\r\n        if (method === 'groupCollapsed') {\r\n          // Safari doesn't print all console.groupCollapsed() arguments:\r\n          // https://bugs.webkit.org/show_bug.cgi?id=182754\r\n          if (/^((?!chrome|android).)*safari/i.test(navigator.userAgent)) {\r\n            console[method](...args);\r\n            return;\r\n          }\r\n        }\r\n        const styles = [`background: ${methodToColorMap[method]}`, `border-radius: 0.5em`, `color: white`, `font-weight: bold`, `padding: 2px 0.5em`];\r\n        // When in a group, the workbox prefix is not displayed.\r\n        const logPrefix = inGroup ? [] : ['%cworkbox', styles.join(';')];\r\n        console[method](...logPrefix, ...args);\r\n        if (method === 'groupCollapsed') {\r\n          inGroup = true;\r\n        }\r\n        if (method === 'groupEnd') {\r\n          inGroup = false;\r\n        }\r\n      };\r\n      // eslint-disable-next-line @typescript-eslint/ban-types\r\n      const api = {};\r\n      const loggerMethods = Object.keys(methodToColorMap);\r\n      for (const key of loggerMethods) {\r\n        const method = key;\r\n        api[method] = (...args) => {\r\n          print(method, args);\r\n        };\r\n      }\r\n      return api;\r\n    })();\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const messages$1 = {\r\n      'invalid-value': ({\r\n        paramName,\r\n        validValueDescription,\r\n        value\r\n      }) => {\r\n        if (!paramName || !validValueDescription) {\r\n          throw new Error(`Unexpected input to 'invalid-value' error.`);\r\n        }\r\n        return `The '${paramName}' parameter was given a value with an ` + `unexpected value. ${validValueDescription} Received a value of ` + `${JSON.stringify(value)}.`;\r\n      },\r\n      'not-an-array': ({\r\n        moduleName,\r\n        className,\r\n        funcName,\r\n        paramName\r\n      }) => {\r\n        if (!moduleName || !className || !funcName || !paramName) {\r\n          throw new Error(`Unexpected input to 'not-an-array' error.`);\r\n        }\r\n        return `The parameter '${paramName}' passed into ` + `'${moduleName}.${className}.${funcName}()' must be an array.`;\r\n      },\r\n      'incorrect-type': ({\r\n        expectedType,\r\n        paramName,\r\n        moduleName,\r\n        className,\r\n        funcName\r\n      }) => {\r\n        if (!expectedType || !paramName || !moduleName || !funcName) {\r\n          throw new Error(`Unexpected input to 'incorrect-type' error.`);\r\n        }\r\n        const classNameStr = className ? `${className}.` : '';\r\n        return `The parameter '${paramName}' passed into ` + `'${moduleName}.${classNameStr}` + `${funcName}()' must be of type ${expectedType}.`;\r\n      },\r\n      'incorrect-class': ({\r\n        expectedClassName,\r\n        paramName,\r\n        moduleName,\r\n        className,\r\n        funcName,\r\n        isReturnValueProblem\r\n      }) => {\r\n        if (!expectedClassName || !moduleName || !funcName) {\r\n          throw new Error(`Unexpected input to 'incorrect-class' error.`);\r\n        }\r\n        const classNameStr = className ? `${className}.` : '';\r\n        if (isReturnValueProblem) {\r\n          return `The return value from ` + `'${moduleName}.${classNameStr}${funcName}()' ` + `must be an instance of class ${expectedClassName}.`;\r\n        }\r\n        return `The parameter '${paramName}' passed into ` + `'${moduleName}.${classNameStr}${funcName}()' ` + `must be an instance of class ${expectedClassName}.`;\r\n      },\r\n      'missing-a-method': ({\r\n        expectedMethod,\r\n        paramName,\r\n        moduleName,\r\n        className,\r\n        funcName\r\n      }) => {\r\n        if (!expectedMethod || !paramName || !moduleName || !className || !funcName) {\r\n          throw new Error(`Unexpected input to 'missing-a-method' error.`);\r\n        }\r\n        return `${moduleName}.${className}.${funcName}() expected the ` + `'${paramName}' parameter to expose a '${expectedMethod}' method.`;\r\n      },\r\n      'add-to-cache-list-unexpected-type': ({\r\n        entry\r\n      }) => {\r\n        return `An unexpected entry was passed to ` + `'workbox-precaching.PrecacheController.addToCacheList()' The entry ` + `'${JSON.stringify(entry)}' isn't supported. You must supply an array of ` + `strings with one or more characters, objects with a url property or ` + `Request objects.`;\r\n      },\r\n      'add-to-cache-list-conflicting-entries': ({\r\n        firstEntry,\r\n        secondEntry\r\n      }) => {\r\n        if (!firstEntry || !secondEntry) {\r\n          throw new Error(`Unexpected input to ` + `'add-to-cache-list-duplicate-entries' error.`);\r\n        }\r\n        return `Two of the entries passed to ` + `'workbox-precaching.PrecacheController.addToCacheList()' had the URL ` + `${firstEntry} but different revision details. Workbox is ` + `unable to cache and version the asset correctly. Please remove one ` + `of the entries.`;\r\n      },\r\n      'plugin-error-request-will-fetch': ({\r\n        thrownErrorMessage\r\n      }) => {\r\n        if (!thrownErrorMessage) {\r\n          throw new Error(`Unexpected input to ` + `'plugin-error-request-will-fetch', error.`);\r\n        }\r\n        return `An error was thrown by a plugins 'requestWillFetch()' method. ` + `The thrown error message was: '${thrownErrorMessage}'.`;\r\n      },\r\n      'invalid-cache-name': ({\r\n        cacheNameId,\r\n        value\r\n      }) => {\r\n        if (!cacheNameId) {\r\n          throw new Error(`Expected a 'cacheNameId' for error 'invalid-cache-name'`);\r\n        }\r\n        return `You must provide a name containing at least one character for ` + `setCacheDetails({${cacheNameId}: '...'}). Received a value of ` + `'${JSON.stringify(value)}'`;\r\n      },\r\n      'unregister-route-but-not-found-with-method': ({\r\n        method\r\n      }) => {\r\n        if (!method) {\r\n          throw new Error(`Unexpected input to ` + `'unregister-route-but-not-found-with-method' error.`);\r\n        }\r\n        return `The route you're trying to unregister was not  previously ` + `registered for the method type '${method}'.`;\r\n      },\r\n      'unregister-route-route-not-registered': () => {\r\n        return `The route you're trying to unregister was not previously ` + `registered.`;\r\n      },\r\n      'queue-replay-failed': ({\r\n        name\r\n      }) => {\r\n        return `Replaying the background sync queue '${name}' failed.`;\r\n      },\r\n      'duplicate-queue-name': ({\r\n        name\r\n      }) => {\r\n        return `The Queue name '${name}' is already being used. ` + `All instances of backgroundSync.Queue must be given unique names.`;\r\n      },\r\n      'expired-test-without-max-age': ({\r\n        methodName,\r\n        paramName\r\n      }) => {\r\n        return `The '${methodName}()' method can only be used when the ` + `'${paramName}' is used in the constructor.`;\r\n      },\r\n      'unsupported-route-type': ({\r\n        moduleName,\r\n        className,\r\n        funcName,\r\n        paramName\r\n      }) => {\r\n        return `The supplied '${paramName}' parameter was an unsupported type. ` + `Please check the docs for ${moduleName}.${className}.${funcName} for ` + `valid input types.`;\r\n      },\r\n      'not-array-of-class': ({\r\n        value,\r\n        expectedClass,\r\n        moduleName,\r\n        className,\r\n        funcName,\r\n        paramName\r\n      }) => {\r\n        return `The supplied '${paramName}' parameter must be an array of ` + `'${expectedClass}' objects. Received '${JSON.stringify(value)},'. ` + `Please check the call to ${moduleName}.${className}.${funcName}() ` + `to fix the issue.`;\r\n      },\r\n      'max-entries-or-age-required': ({\r\n        moduleName,\r\n        className,\r\n        funcName\r\n      }) => {\r\n        return `You must define either config.maxEntries or config.maxAgeSeconds` + `in ${moduleName}.${className}.${funcName}`;\r\n      },\r\n      'statuses-or-headers-required': ({\r\n        moduleName,\r\n        className,\r\n        funcName\r\n      }) => {\r\n        return `You must define either config.statuses or config.headers` + `in ${moduleName}.${className}.${funcName}`;\r\n      },\r\n      'invalid-string': ({\r\n        moduleName,\r\n        funcName,\r\n        paramName\r\n      }) => {\r\n        if (!paramName || !moduleName || !funcName) {\r\n          throw new Error(`Unexpected input to 'invalid-string' error.`);\r\n        }\r\n        return `When using strings, the '${paramName}' parameter must start with ` + `'http' (for cross-origin matches) or '/' (for same-origin matches). ` + `Please see the docs for ${moduleName}.${funcName}() for ` + `more info.`;\r\n      },\r\n      'channel-name-required': () => {\r\n        return `You must provide a channelName to construct a ` + `BroadcastCacheUpdate instance.`;\r\n      },\r\n      'invalid-responses-are-same-args': () => {\r\n        return `The arguments passed into responsesAreSame() appear to be ` + `invalid. Please ensure valid Responses are used.`;\r\n      },\r\n      'expire-custom-caches-only': () => {\r\n        return `You must provide a 'cacheName' property when using the ` + `expiration plugin with a runtime caching strategy.`;\r\n      },\r\n      'unit-must-be-bytes': ({\r\n        normalizedRangeHeader\r\n      }) => {\r\n        if (!normalizedRangeHeader) {\r\n          throw new Error(`Unexpected input to 'unit-must-be-bytes' error.`);\r\n        }\r\n        return `The 'unit' portion of the Range header must be set to 'bytes'. ` + `The Range header provided was \"${normalizedRangeHeader}\"`;\r\n      },\r\n      'single-range-only': ({\r\n        normalizedRangeHeader\r\n      }) => {\r\n        if (!normalizedRangeHeader) {\r\n          throw new Error(`Unexpected input to 'single-range-only' error.`);\r\n        }\r\n        return `Multiple ranges are not supported. Please use a  single start ` + `value, and optional end value. The Range header provided was ` + `\"${normalizedRangeHeader}\"`;\r\n      },\r\n      'invalid-range-values': ({\r\n        normalizedRangeHeader\r\n      }) => {\r\n        if (!normalizedRangeHeader) {\r\n          throw new Error(`Unexpected input to 'invalid-range-values' error.`);\r\n        }\r\n        return `The Range header is missing both start and end values. At least ` + `one of those values is needed. The Range header provided was ` + `\"${normalizedRangeHeader}\"`;\r\n      },\r\n      'no-range-header': () => {\r\n        return `No Range header was found in the Request provided.`;\r\n      },\r\n      'range-not-satisfiable': ({\r\n        size,\r\n        start,\r\n        end\r\n      }) => {\r\n        return `The start (${start}) and end (${end}) values in the Range are ` + `not satisfiable by the cached response, which is ${size} bytes.`;\r\n      },\r\n      'attempt-to-cache-non-get-request': ({\r\n        url,\r\n        method\r\n      }) => {\r\n        return `Unable to cache '${url}' because it is a '${method}' request and ` + `only 'GET' requests can be cached.`;\r\n      },\r\n      'cache-put-with-no-response': ({\r\n        url\r\n      }) => {\r\n        return `There was an attempt to cache '${url}' but the response was not ` + `defined.`;\r\n      },\r\n      'no-response': ({\r\n        url,\r\n        error\r\n      }) => {\r\n        let message = `The strategy could not generate a response for '${url}'.`;\r\n        if (error) {\r\n          message += ` The underlying error is ${error}.`;\r\n        }\r\n        return message;\r\n      },\r\n      'bad-precaching-response': ({\r\n        url,\r\n        status\r\n      }) => {\r\n        return `The precaching request for '${url}' failed` + (status ? ` with an HTTP status of ${status}.` : `.`);\r\n      },\r\n      'non-precached-url': ({\r\n        url\r\n      }) => {\r\n        return `createHandlerBoundToURL('${url}') was called, but that URL is ` + `not precached. Please pass in a URL that is precached instead.`;\r\n      },\r\n      'add-to-cache-list-conflicting-integrities': ({\r\n        url\r\n      }) => {\r\n        return `Two of the entries passed to ` + `'workbox-precaching.PrecacheController.addToCacheList()' had the URL ` + `${url} with different integrity values. Please remove one of them.`;\r\n      },\r\n      'missing-precache-entry': ({\r\n        cacheName,\r\n        url\r\n      }) => {\r\n        return `Unable to find a precached response in ${cacheName} for ${url}.`;\r\n      },\r\n      'cross-origin-copy-response': ({\r\n        origin\r\n      }) => {\r\n        return `workbox-core.copyResponse() can only be used with same-origin ` + `responses. It was passed a response with origin ${origin}.`;\r\n      },\r\n      'opaque-streams-source': ({\r\n        type\r\n      }) => {\r\n        const message = `One of the workbox-streams sources resulted in an ` + `'${type}' response.`;\r\n        if (type === 'opaqueredirect') {\r\n          return `${message} Please do not use a navigation request that results ` + `in a redirect as a source.`;\r\n        }\r\n        return `${message} Please ensure your sources are CORS-enabled.`;\r\n      }\r\n    };\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const generatorFunction = (code, details = {}) => {\r\n      const message = messages$1[code];\r\n      if (!message) {\r\n        throw new Error(`Unable to find message for code '${code}'.`);\r\n      }\r\n      return message(details);\r\n    };\r\n    const messageGenerator = generatorFunction;\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Workbox errors should be thrown with this class.\r\n     * This allows use to ensure the type easily in tests,\r\n     * helps developers identify errors from workbox\r\n     * easily and allows use to optimise error\r\n     * messages correctly.\r\n     *\r\n     * @private\r\n     */\r\n    class WorkboxError extends Error {\r\n      /**\r\n       *\r\n       * @param {string} errorCode The error code that\r\n       * identifies this particular error.\r\n       * @param {Object=} details Any relevant arguments\r\n       * that will help developers identify issues should\r\n       * be added as a key on the context object.\r\n       */\r\n      constructor(errorCode, details) {\r\n        const message = messageGenerator(errorCode, details);\r\n        super(message);\r\n        this.name = errorCode;\r\n        this.details = details;\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /*\r\n     * This method throws if the supplied value is not an array.\r\n     * The destructed values are required to produce a meaningful error for users.\r\n     * The destructed and restructured object is so it's clear what is\r\n     * needed.\r\n     */\r\n    const isArray = (value, details) => {\r\n      if (!Array.isArray(value)) {\r\n        throw new WorkboxError('not-an-array', details);\r\n      }\r\n    };\r\n    const hasMethod = (object, expectedMethod, details) => {\r\n      const type = typeof object[expectedMethod];\r\n      if (type !== 'function') {\r\n        details['expectedMethod'] = expectedMethod;\r\n        throw new WorkboxError('missing-a-method', details);\r\n      }\r\n    };\r\n    const isType = (object, expectedType, details) => {\r\n      if (typeof object !== expectedType) {\r\n        details['expectedType'] = expectedType;\r\n        throw new WorkboxError('incorrect-type', details);\r\n      }\r\n    };\r\n    const isInstance = (object,\r\n    // Need the general type to do the check later.\r\n    // eslint-disable-next-line @typescript-eslint/ban-types\r\n    expectedClass, details) => {\r\n      if (!(object instanceof expectedClass)) {\r\n        details['expectedClassName'] = expectedClass.name;\r\n        throw new WorkboxError('incorrect-class', details);\r\n      }\r\n    };\r\n    const isOneOf = (value, validValues, details) => {\r\n      if (!validValues.includes(value)) {\r\n        details['validValueDescription'] = `Valid values are ${JSON.stringify(validValues)}.`;\r\n        throw new WorkboxError('invalid-value', details);\r\n      }\r\n    };\r\n    const isArrayOfClass = (value,\r\n    // Need general type to do check later.\r\n    expectedClass,\r\n     \r\n    details) => {\r\n      const error = new WorkboxError('not-array-of-class', details);\r\n      if (!Array.isArray(value)) {\r\n        throw error;\r\n      }\r\n      for (const item of value) {\r\n        if (!(item instanceof expectedClass)) {\r\n          throw error;\r\n        }\r\n      }\r\n    };\r\n    const finalAssertExports = {\r\n      hasMethod,\r\n      isArray,\r\n      isInstance,\r\n      isOneOf,\r\n      isType,\r\n      isArrayOfClass\r\n    };\r\n\r\n    // @ts-ignore\r\n    try {\r\n      self['workbox:routing:7.3.0'] && _();\r\n    } catch (e) {}\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * The default HTTP method, 'GET', used when there's no specific method\r\n     * configured for a route.\r\n     *\r\n     * @type {string}\r\n     *\r\n     * @private\r\n     */\r\n    const defaultMethod = 'GET';\r\n    /**\r\n     * The list of valid HTTP methods associated with requests that could be routed.\r\n     *\r\n     * @type {Array<string>}\r\n     *\r\n     * @private\r\n     */\r\n    const validMethods = ['DELETE', 'GET', 'HEAD', 'PATCH', 'POST', 'PUT'];\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * @param {function()|Object} handler Either a function, or an object with a\r\n     * 'handle' method.\r\n     * @return {Object} An object with a handle method.\r\n     *\r\n     * @private\r\n     */\r\n    const normalizeHandler = handler => {\r\n      if (handler && typeof handler === 'object') {\r\n        {\r\n          finalAssertExports.hasMethod(handler, 'handle', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Route',\r\n            funcName: 'constructor',\r\n            paramName: 'handler'\r\n          });\r\n        }\r\n        return handler;\r\n      } else {\r\n        {\r\n          finalAssertExports.isType(handler, 'function', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Route',\r\n            funcName: 'constructor',\r\n            paramName: 'handler'\r\n          });\r\n        }\r\n        return {\r\n          handle: handler\r\n        };\r\n      }\r\n    };\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A `Route` consists of a pair of callback functions, \"match\" and \"handler\".\r\n     * The \"match\" callback determine if a route should be used to \"handle\" a\r\n     * request by returning a non-falsy value if it can. The \"handler\" callback\r\n     * is called when there is a match and should return a Promise that resolves\r\n     * to a `Response`.\r\n     *\r\n     * @memberof workbox-routing\r\n     */\r\n    class Route {\r\n      /**\r\n       * Constructor for Route class.\r\n       *\r\n       * @param {workbox-routing~matchCallback} match\r\n       * A callback function that determines whether the route matches a given\r\n       * `fetch` event by returning a non-falsy value.\r\n       * @param {workbox-routing~handlerCallback} handler A callback\r\n       * function that returns a Promise resolving to a Response.\r\n       * @param {string} [method='GET'] The HTTP method to match the Route\r\n       * against.\r\n       */\r\n      constructor(match, handler, method = defaultMethod) {\r\n        {\r\n          finalAssertExports.isType(match, 'function', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Route',\r\n            funcName: 'constructor',\r\n            paramName: 'match'\r\n          });\r\n          if (method) {\r\n            finalAssertExports.isOneOf(method, validMethods, {\r\n              paramName: 'method'\r\n            });\r\n          }\r\n        }\r\n        // These values are referenced directly by Router so cannot be\r\n        // altered by minificaton.\r\n        this.handler = normalizeHandler(handler);\r\n        this.match = match;\r\n        this.method = method;\r\n      }\r\n      /**\r\n       *\r\n       * @param {workbox-routing-handlerCallback} handler A callback\r\n       * function that returns a Promise resolving to a Response\r\n       */\r\n      setCatchHandler(handler) {\r\n        this.catchHandler = normalizeHandler(handler);\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * RegExpRoute makes it easy to create a regular expression based\r\n     * {@link workbox-routing.Route}.\r\n     *\r\n     * For same-origin requests the RegExp only needs to match part of the URL. For\r\n     * requests against third-party servers, you must define a RegExp that matches\r\n     * the start of the URL.\r\n     *\r\n     * @memberof workbox-routing\r\n     * @extends workbox-routing.Route\r\n     */\r\n    class RegExpRoute extends Route {\r\n      /**\r\n       * If the regular expression contains\r\n       * [capture groups]{@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp#grouping-back-references},\r\n       * the captured values will be passed to the\r\n       * {@link workbox-routing~handlerCallback} `params`\r\n       * argument.\r\n       *\r\n       * @param {RegExp} regExp The regular expression to match against URLs.\r\n       * @param {workbox-routing~handlerCallback} handler A callback\r\n       * function that returns a Promise resulting in a Response.\r\n       * @param {string} [method='GET'] The HTTP method to match the Route\r\n       * against.\r\n       */\r\n      constructor(regExp, handler, method) {\r\n        {\r\n          finalAssertExports.isInstance(regExp, RegExp, {\r\n            moduleName: 'workbox-routing',\r\n            className: 'RegExpRoute',\r\n            funcName: 'constructor',\r\n            paramName: 'pattern'\r\n          });\r\n        }\r\n        const match = ({\r\n          url\r\n        }) => {\r\n          const result = regExp.exec(url.href);\r\n          // Return immediately if there's no match.\r\n          if (!result) {\r\n            return;\r\n          }\r\n          // Require that the match start at the first character in the URL string\r\n          // if it's a cross-origin request.\r\n          // See https://github.com/GoogleChrome/workbox/issues/281 for the context\r\n          // behind this behavior.\r\n          if (url.origin !== location.origin && result.index !== 0) {\r\n            {\r\n              logger.debug(`The regular expression '${regExp.toString()}' only partially matched ` + `against the cross-origin URL '${url.toString()}'. RegExpRoute's will only ` + `handle cross-origin requests if they match the entire URL.`);\r\n            }\r\n            return;\r\n          }\r\n          // If the route matches, but there aren't any capture groups defined, then\r\n          // this will return [], which is truthy and therefore sufficient to\r\n          // indicate a match.\r\n          // If there are capture groups, then it will return their values.\r\n          return result.slice(1);\r\n        };\r\n        super(match, handler, method);\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const getFriendlyURL = url => {\r\n      const urlObj = new URL(String(url), location.href);\r\n      // See https://github.com/GoogleChrome/workbox/issues/2323\r\n      // We want to include everything, except for the origin if it's same-origin.\r\n      return urlObj.href.replace(new RegExp(`^${location.origin}`), '');\r\n    };\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * The Router can be used to process a `FetchEvent` using one or more\r\n     * {@link workbox-routing.Route}, responding with a `Response` if\r\n     * a matching route exists.\r\n     *\r\n     * If no route matches a given a request, the Router will use a \"default\"\r\n     * handler if one is defined.\r\n     *\r\n     * Should the matching Route throw an error, the Router will use a \"catch\"\r\n     * handler if one is defined to gracefully deal with issues and respond with a\r\n     * Request.\r\n     *\r\n     * If a request matches multiple routes, the **earliest** registered route will\r\n     * be used to respond to the request.\r\n     *\r\n     * @memberof workbox-routing\r\n     */\r\n    class Router {\r\n      /**\r\n       * Initializes a new Router.\r\n       */\r\n      constructor() {\r\n        this._routes = new Map();\r\n        this._defaultHandlerMap = new Map();\r\n      }\r\n      /**\r\n       * @return {Map<string, Array<workbox-routing.Route>>} routes A `Map` of HTTP\r\n       * method name ('GET', etc.) to an array of all the corresponding `Route`\r\n       * instances that are registered.\r\n       */\r\n      get routes() {\r\n        return this._routes;\r\n      }\r\n      /**\r\n       * Adds a fetch event listener to respond to events when a route matches\r\n       * the event's request.\r\n       */\r\n      addFetchListener() {\r\n        // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705\r\n        self.addEventListener('fetch', event => {\r\n          const {\r\n            request\r\n          } = event;\r\n          const responsePromise = this.handleRequest({\r\n            request,\r\n            event\r\n          });\r\n          if (responsePromise) {\r\n            event.respondWith(responsePromise);\r\n          }\r\n        });\r\n      }\r\n      /**\r\n       * Adds a message event listener for URLs to cache from the window.\r\n       * This is useful to cache resources loaded on the page prior to when the\r\n       * service worker started controlling it.\r\n       *\r\n       * The format of the message data sent from the window should be as follows.\r\n       * Where the `urlsToCache` array may consist of URL strings or an array of\r\n       * URL string + `requestInit` object (the same as you'd pass to `fetch()`).\r\n       *\r\n       * ```\r\n       * {\r\n       *   type: 'CACHE_URLS',\r\n       *   payload: {\r\n       *     urlsToCache: [\r\n       *       './script1.js',\r\n       *       './script2.js',\r\n       *       ['./script3.js', {mode: 'no-cors'}],\r\n       *     ],\r\n       *   },\r\n       * }\r\n       * ```\r\n       */\r\n      addCacheListener() {\r\n        // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705\r\n        self.addEventListener('message', event => {\r\n          // event.data is type 'any'\r\n           \r\n          if (event.data && event.data.type === 'CACHE_URLS') {\r\n             \r\n            const {\r\n              payload\r\n            } = event.data;\r\n            {\r\n              logger.debug(`Caching URLs from the window`, payload.urlsToCache);\r\n            }\r\n            const requestPromises = Promise.all(payload.urlsToCache.map(entry => {\r\n              if (typeof entry === 'string') {\r\n                entry = [entry];\r\n              }\r\n              const request = new Request(...entry);\r\n              return this.handleRequest({\r\n                request,\r\n                event\r\n              });\r\n              // TODO(philipwalton): TypeScript errors without this typecast for\r\n              // some reason (probably a bug). The real type here should work but\r\n              // doesn't: `Array<Promise<Response> | undefined>`.\r\n            })); // TypeScript\r\n            event.waitUntil(requestPromises);\r\n            // If a MessageChannel was used, reply to the message on success.\r\n            if (event.ports && event.ports[0]) {\r\n              void requestPromises.then(() => event.ports[0].postMessage(true));\r\n            }\r\n          }\r\n        });\r\n      }\r\n      /**\r\n       * Apply the routing rules to a FetchEvent object to get a Response from an\r\n       * appropriate Route's handler.\r\n       *\r\n       * @param {Object} options\r\n       * @param {Request} options.request The request to handle.\r\n       * @param {ExtendableEvent} options.event The event that triggered the\r\n       *     request.\r\n       * @return {Promise<Response>|undefined} A promise is returned if a\r\n       *     registered route can handle the request. If there is no matching\r\n       *     route and there's no `defaultHandler`, `undefined` is returned.\r\n       */\r\n      handleRequest({\r\n        request,\r\n        event\r\n      }) {\r\n        {\r\n          finalAssertExports.isInstance(request, Request, {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'handleRequest',\r\n            paramName: 'options.request'\r\n          });\r\n        }\r\n        const url = new URL(request.url, location.href);\r\n        if (!url.protocol.startsWith('http')) {\r\n          {\r\n            logger.debug(`Workbox Router only supports URLs that start with 'http'.`);\r\n          }\r\n          return;\r\n        }\r\n        const sameOrigin = url.origin === location.origin;\r\n        const {\r\n          params,\r\n          route\r\n        } = this.findMatchingRoute({\r\n          event,\r\n          request,\r\n          sameOrigin,\r\n          url\r\n        });\r\n        let handler = route && route.handler;\r\n        const debugMessages = [];\r\n        {\r\n          if (handler) {\r\n            debugMessages.push([`Found a route to handle this request:`, route]);\r\n            if (params) {\r\n              debugMessages.push([`Passing the following params to the route's handler:`, params]);\r\n            }\r\n          }\r\n        }\r\n        // If we don't have a handler because there was no matching route, then\r\n        // fall back to defaultHandler if that's defined.\r\n        const method = request.method;\r\n        if (!handler && this._defaultHandlerMap.has(method)) {\r\n          {\r\n            debugMessages.push(`Failed to find a matching route. Falling ` + `back to the default handler for ${method}.`);\r\n          }\r\n          handler = this._defaultHandlerMap.get(method);\r\n        }\r\n        if (!handler) {\r\n          {\r\n            // No handler so Workbox will do nothing. If logs is set of debug\r\n            // i.e. verbose, we should print out this information.\r\n            logger.debug(`No route found for: ${getFriendlyURL(url)}`);\r\n          }\r\n          return;\r\n        }\r\n        {\r\n          // We have a handler, meaning Workbox is going to handle the route.\r\n          // print the routing details to the console.\r\n          logger.groupCollapsed(`Router is responding to: ${getFriendlyURL(url)}`);\r\n          debugMessages.forEach(msg => {\r\n            if (Array.isArray(msg)) {\r\n              logger.log(...msg);\r\n            } else {\r\n              logger.log(msg);\r\n            }\r\n          });\r\n          logger.groupEnd();\r\n        }\r\n        // Wrap in try and catch in case the handle method throws a synchronous\r\n        // error. It should still callback to the catch handler.\r\n        let responsePromise;\r\n        try {\r\n          responsePromise = handler.handle({\r\n            url,\r\n            request,\r\n            event,\r\n            params\r\n          });\r\n        } catch (err) {\r\n          responsePromise = Promise.reject(err);\r\n        }\r\n        // Get route's catch handler, if it exists\r\n        const catchHandler = route && route.catchHandler;\r\n        if (responsePromise instanceof Promise && (this._catchHandler || catchHandler)) {\r\n          responsePromise = responsePromise.catch(async err => {\r\n            // If there's a route catch handler, process that first\r\n            if (catchHandler) {\r\n              {\r\n                // Still include URL here as it will be async from the console group\r\n                // and may not make sense without the URL\r\n                logger.groupCollapsed(`Error thrown when responding to: ` + ` ${getFriendlyURL(url)}. Falling back to route's Catch Handler.`);\r\n                logger.error(`Error thrown by:`, route);\r\n                logger.error(err);\r\n                logger.groupEnd();\r\n              }\r\n              try {\r\n                return await catchHandler.handle({\r\n                  url,\r\n                  request,\r\n                  event,\r\n                  params\r\n                });\r\n              } catch (catchErr) {\r\n                if (catchErr instanceof Error) {\r\n                  err = catchErr;\r\n                }\r\n              }\r\n            }\r\n            if (this._catchHandler) {\r\n              {\r\n                // Still include URL here as it will be async from the console group\r\n                // and may not make sense without the URL\r\n                logger.groupCollapsed(`Error thrown when responding to: ` + ` ${getFriendlyURL(url)}. Falling back to global Catch Handler.`);\r\n                logger.error(`Error thrown by:`, route);\r\n                logger.error(err);\r\n                logger.groupEnd();\r\n              }\r\n              return this._catchHandler.handle({\r\n                url,\r\n                request,\r\n                event\r\n              });\r\n            }\r\n            throw err;\r\n          });\r\n        }\r\n        return responsePromise;\r\n      }\r\n      /**\r\n       * Checks a request and URL (and optionally an event) against the list of\r\n       * registered routes, and if there's a match, returns the corresponding\r\n       * route along with any params generated by the match.\r\n       *\r\n       * @param {Object} options\r\n       * @param {URL} options.url\r\n       * @param {boolean} options.sameOrigin The result of comparing `url.origin`\r\n       *     against the current origin.\r\n       * @param {Request} options.request The request to match.\r\n       * @param {Event} options.event The corresponding event.\r\n       * @return {Object} An object with `route` and `params` properties.\r\n       *     They are populated if a matching route was found or `undefined`\r\n       *     otherwise.\r\n       */\r\n      findMatchingRoute({\r\n        url,\r\n        sameOrigin,\r\n        request,\r\n        event\r\n      }) {\r\n        const routes = this._routes.get(request.method) || [];\r\n        for (const route of routes) {\r\n          let params;\r\n          // route.match returns type any, not possible to change right now.\r\n           \r\n          const matchResult = route.match({\r\n            url,\r\n            sameOrigin,\r\n            request,\r\n            event\r\n          });\r\n          if (matchResult) {\r\n            {\r\n              // Warn developers that using an async matchCallback is almost always\r\n              // not the right thing to do.\r\n              if (matchResult instanceof Promise) {\r\n                logger.warn(`While routing ${getFriendlyURL(url)}, an async ` + `matchCallback function was used. Please convert the ` + `following route to use a synchronous matchCallback function:`, route);\r\n              }\r\n            }\r\n            // See https://github.com/GoogleChrome/workbox/issues/2079\r\n             \r\n            params = matchResult;\r\n            if (Array.isArray(params) && params.length === 0) {\r\n              // Instead of passing an empty array in as params, use undefined.\r\n              params = undefined;\r\n            } else if (matchResult.constructor === Object &&\r\n             \r\n            Object.keys(matchResult).length === 0) {\r\n              // Instead of passing an empty object in as params, use undefined.\r\n              params = undefined;\r\n            } else if (typeof matchResult === 'boolean') {\r\n              // For the boolean value true (rather than just something truth-y),\r\n              // don't set params.\r\n              // See https://github.com/GoogleChrome/workbox/pull/2134#issuecomment-513924353\r\n              params = undefined;\r\n            }\r\n            // Return early if have a match.\r\n            return {\r\n              route,\r\n              params\r\n            };\r\n          }\r\n        }\r\n        // If no match was found above, return and empty object.\r\n        return {};\r\n      }\r\n      /**\r\n       * Define a default `handler` that's called when no routes explicitly\r\n       * match the incoming request.\r\n       *\r\n       * Each HTTP method ('GET', 'POST', etc.) gets its own default handler.\r\n       *\r\n       * Without a default handler, unmatched requests will go against the\r\n       * network as if there were no service worker present.\r\n       *\r\n       * @param {workbox-routing~handlerCallback} handler A callback\r\n       * function that returns a Promise resulting in a Response.\r\n       * @param {string} [method='GET'] The HTTP method to associate with this\r\n       * default handler. Each method has its own default.\r\n       */\r\n      setDefaultHandler(handler, method = defaultMethod) {\r\n        this._defaultHandlerMap.set(method, normalizeHandler(handler));\r\n      }\r\n      /**\r\n       * If a Route throws an error while handling a request, this `handler`\r\n       * will be called and given a chance to provide a response.\r\n       *\r\n       * @param {workbox-routing~handlerCallback} handler A callback\r\n       * function that returns a Promise resulting in a Response.\r\n       */\r\n      setCatchHandler(handler) {\r\n        this._catchHandler = normalizeHandler(handler);\r\n      }\r\n      /**\r\n       * Registers a route with the router.\r\n       *\r\n       * @param {workbox-routing.Route} route The route to register.\r\n       */\r\n      registerRoute(route) {\r\n        {\r\n          finalAssertExports.isType(route, 'object', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'registerRoute',\r\n            paramName: 'route'\r\n          });\r\n          finalAssertExports.hasMethod(route, 'match', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'registerRoute',\r\n            paramName: 'route'\r\n          });\r\n          finalAssertExports.isType(route.handler, 'object', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'registerRoute',\r\n            paramName: 'route'\r\n          });\r\n          finalAssertExports.hasMethod(route.handler, 'handle', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'registerRoute',\r\n            paramName: 'route.handler'\r\n          });\r\n          finalAssertExports.isType(route.method, 'string', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'registerRoute',\r\n            paramName: 'route.method'\r\n          });\r\n        }\r\n        if (!this._routes.has(route.method)) {\r\n          this._routes.set(route.method, []);\r\n        }\r\n        // Give precedence to all of the earlier routes by adding this additional\r\n        // route to the end of the array.\r\n        this._routes.get(route.method).push(route);\r\n      }\r\n      /**\r\n       * Unregisters a route with the router.\r\n       *\r\n       * @param {workbox-routing.Route} route The route to unregister.\r\n       */\r\n      unregisterRoute(route) {\r\n        if (!this._routes.has(route.method)) {\r\n          throw new WorkboxError('unregister-route-but-not-found-with-method', {\r\n            method: route.method\r\n          });\r\n        }\r\n        const routeIndex = this._routes.get(route.method).indexOf(route);\r\n        if (routeIndex > -1) {\r\n          this._routes.get(route.method).splice(routeIndex, 1);\r\n        } else {\r\n          throw new WorkboxError('unregister-route-route-not-registered');\r\n        }\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    let defaultRouter;\r\n    /**\r\n     * Creates a new, singleton Router instance if one does not exist. If one\r\n     * does already exist, that instance is returned.\r\n     *\r\n     * @private\r\n     * @return {Router}\r\n     */\r\n    const getOrCreateDefaultRouter = () => {\r\n      if (!defaultRouter) {\r\n        defaultRouter = new Router();\r\n        // The helpers that use the default Router assume these listeners exist.\r\n        defaultRouter.addFetchListener();\r\n        defaultRouter.addCacheListener();\r\n      }\r\n      return defaultRouter;\r\n    };\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Easily register a RegExp, string, or function with a caching\r\n     * strategy to a singleton Router instance.\r\n     *\r\n     * This method will generate a Route for you if needed and\r\n     * call {@link workbox-routing.Router#registerRoute}.\r\n     *\r\n     * @param {RegExp|string|workbox-routing.Route~matchCallback|workbox-routing.Route} capture\r\n     * If the capture param is a `Route`, all other arguments will be ignored.\r\n     * @param {workbox-routing~handlerCallback} [handler] A callback\r\n     * function that returns a Promise resulting in a Response. This parameter\r\n     * is required if `capture` is not a `Route` object.\r\n     * @param {string} [method='GET'] The HTTP method to match the Route\r\n     * against.\r\n     * @return {workbox-routing.Route} The generated `Route`.\r\n     *\r\n     * @memberof workbox-routing\r\n     */\r\n    function registerRoute(capture, handler, method) {\r\n      let route;\r\n      if (typeof capture === 'string') {\r\n        const captureUrl = new URL(capture, location.href);\r\n        {\r\n          if (!(capture.startsWith('/') || capture.startsWith('http'))) {\r\n            throw new WorkboxError('invalid-string', {\r\n              moduleName: 'workbox-routing',\r\n              funcName: 'registerRoute',\r\n              paramName: 'capture'\r\n            });\r\n          }\r\n          // We want to check if Express-style wildcards are in the pathname only.\r\n          // TODO: Remove this log message in v4.\r\n          const valueToCheck = capture.startsWith('http') ? captureUrl.pathname : capture;\r\n          // See https://github.com/pillarjs/path-to-regexp#parameters\r\n          const wildcards = '[*:?+]';\r\n          if (new RegExp(`${wildcards}`).exec(valueToCheck)) {\r\n            logger.debug(`The '$capture' parameter contains an Express-style wildcard ` + `character (${wildcards}). Strings are now always interpreted as ` + `exact matches; use a RegExp for partial or wildcard matches.`);\r\n          }\r\n        }\r\n        const matchCallback = ({\r\n          url\r\n        }) => {\r\n          {\r\n            if (url.pathname === captureUrl.pathname && url.origin !== captureUrl.origin) {\r\n              logger.debug(`${capture} only partially matches the cross-origin URL ` + `${url.toString()}. This route will only handle cross-origin requests ` + `if they match the entire URL.`);\r\n            }\r\n          }\r\n          return url.href === captureUrl.href;\r\n        };\r\n        // If `capture` is a string then `handler` and `method` must be present.\r\n        route = new Route(matchCallback, handler, method);\r\n      } else if (capture instanceof RegExp) {\r\n        // If `capture` is a `RegExp` then `handler` and `method` must be present.\r\n        route = new RegExpRoute(capture, handler, method);\r\n      } else if (typeof capture === 'function') {\r\n        // If `capture` is a function then `handler` and `method` must be present.\r\n        route = new Route(capture, handler, method);\r\n      } else if (capture instanceof Route) {\r\n        route = capture;\r\n      } else {\r\n        throw new WorkboxError('unsupported-route-type', {\r\n          moduleName: 'workbox-routing',\r\n          funcName: 'registerRoute',\r\n          paramName: 'capture'\r\n        });\r\n      }\r\n      const defaultRouter = getOrCreateDefaultRouter();\r\n      defaultRouter.registerRoute(route);\r\n      return route;\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const _cacheNameDetails = {\r\n      googleAnalytics: 'googleAnalytics',\r\n      precache: 'precache-v2',\r\n      prefix: 'workbox',\r\n      runtime: 'runtime',\r\n      suffix: typeof registration !== 'undefined' ? registration.scope : ''\r\n    };\r\n    const _createCacheName = cacheName => {\r\n      return [_cacheNameDetails.prefix, cacheName, _cacheNameDetails.suffix].filter(value => value && value.length > 0).join('-');\r\n    };\r\n    const eachCacheNameDetail = fn => {\r\n      for (const key of Object.keys(_cacheNameDetails)) {\r\n        fn(key);\r\n      }\r\n    };\r\n    const cacheNames = {\r\n      updateDetails: details => {\r\n        eachCacheNameDetail(key => {\r\n          if (typeof details[key] === 'string') {\r\n            _cacheNameDetails[key] = details[key];\r\n          }\r\n        });\r\n      },\r\n      getGoogleAnalyticsName: userCacheName => {\r\n        return userCacheName || _createCacheName(_cacheNameDetails.googleAnalytics);\r\n      },\r\n      getPrecacheName: userCacheName => {\r\n        return userCacheName || _createCacheName(_cacheNameDetails.precache);\r\n      },\r\n      getPrefix: () => {\r\n        return _cacheNameDetails.prefix;\r\n      },\r\n      getRuntimeName: userCacheName => {\r\n        return userCacheName || _createCacheName(_cacheNameDetails.runtime);\r\n      },\r\n      getSuffix: () => {\r\n        return _cacheNameDetails.suffix;\r\n      }\r\n    };\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A helper function that prevents a promise from being flagged as unused.\r\n     *\r\n     * @private\r\n     **/\r\n    function dontWaitFor(promise) {\r\n      // Effective no-op.\r\n      void promise.then(() => {});\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    // Callbacks to be executed whenever there's a quota error.\r\n    // Can't change Function type right now.\r\n    // eslint-disable-next-line @typescript-eslint/ban-types\r\n    const quotaErrorCallbacks = new Set();\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Adds a function to the set of quotaErrorCallbacks that will be executed if\r\n     * there's a quota error.\r\n     *\r\n     * @param {Function} callback\r\n     * @memberof workbox-core\r\n     */\r\n    // Can't change Function type\r\n    // eslint-disable-next-line @typescript-eslint/ban-types\r\n    function registerQuotaErrorCallback(callback) {\r\n      {\r\n        finalAssertExports.isType(callback, 'function', {\r\n          moduleName: 'workbox-core',\r\n          funcName: 'register',\r\n          paramName: 'callback'\r\n        });\r\n      }\r\n      quotaErrorCallbacks.add(callback);\r\n      {\r\n        logger.log('Registered a callback to respond to quota errors.', callback);\r\n      }\r\n    }\r\n\r\n    function _extends() {\r\n      return _extends = Object.assign ? Object.assign.bind() : function (n) {\r\n        for (var e = 1; e < arguments.length; e++) {\r\n          var t = arguments[e];\r\n          for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]);\r\n        }\r\n        return n;\r\n      }, _extends.apply(null, arguments);\r\n    }\r\n\r\n    const instanceOfAny = (object, constructors) => constructors.some(c => object instanceof c);\r\n    let idbProxyableTypes;\r\n    let cursorAdvanceMethods;\r\n    // This is a function to prevent it throwing up in node environments.\r\n    function getIdbProxyableTypes() {\r\n      return idbProxyableTypes || (idbProxyableTypes = [IDBDatabase, IDBObjectStore, IDBIndex, IDBCursor, IDBTransaction]);\r\n    }\r\n    // This is a function to prevent it throwing up in node environments.\r\n    function getCursorAdvanceMethods() {\r\n      return cursorAdvanceMethods || (cursorAdvanceMethods = [IDBCursor.prototype.advance, IDBCursor.prototype.continue, IDBCursor.prototype.continuePrimaryKey]);\r\n    }\r\n    const cursorRequestMap = new WeakMap();\r\n    const transactionDoneMap = new WeakMap();\r\n    const transactionStoreNamesMap = new WeakMap();\r\n    const transformCache = new WeakMap();\r\n    const reverseTransformCache = new WeakMap();\r\n    function promisifyRequest(request) {\r\n      const promise = new Promise((resolve, reject) => {\r\n        const unlisten = () => {\r\n          request.removeEventListener('success', success);\r\n          request.removeEventListener('error', error);\r\n        };\r\n        const success = () => {\r\n          resolve(wrap(request.result));\r\n          unlisten();\r\n        };\r\n        const error = () => {\r\n          reject(request.error);\r\n          unlisten();\r\n        };\r\n        request.addEventListener('success', success);\r\n        request.addEventListener('error', error);\r\n      });\r\n      promise.then(value => {\r\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\r\n        // (see wrapFunction).\r\n        if (value instanceof IDBCursor) {\r\n          cursorRequestMap.set(value, request);\r\n        }\r\n        // Catching to avoid \"Uncaught Promise exceptions\"\r\n      }).catch(() => {});\r\n      // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\r\n      // is because we create many promises from a single IDBRequest.\r\n      reverseTransformCache.set(promise, request);\r\n      return promise;\r\n    }\r\n    function cacheDonePromiseForTransaction(tx) {\r\n      // Early bail if we've already created a done promise for this transaction.\r\n      if (transactionDoneMap.has(tx)) return;\r\n      const done = new Promise((resolve, reject) => {\r\n        const unlisten = () => {\r\n          tx.removeEventListener('complete', complete);\r\n          tx.removeEventListener('error', error);\r\n          tx.removeEventListener('abort', error);\r\n        };\r\n        const complete = () => {\r\n          resolve();\r\n          unlisten();\r\n        };\r\n        const error = () => {\r\n          reject(tx.error || new DOMException('AbortError', 'AbortError'));\r\n          unlisten();\r\n        };\r\n        tx.addEventListener('complete', complete);\r\n        tx.addEventListener('error', error);\r\n        tx.addEventListener('abort', error);\r\n      });\r\n      // Cache it for later retrieval.\r\n      transactionDoneMap.set(tx, done);\r\n    }\r\n    let idbProxyTraps = {\r\n      get(target, prop, receiver) {\r\n        if (target instanceof IDBTransaction) {\r\n          // Special handling for transaction.done.\r\n          if (prop === 'done') return transactionDoneMap.get(target);\r\n          // Polyfill for objectStoreNames because of Edge.\r\n          if (prop === 'objectStoreNames') {\r\n            return target.objectStoreNames || transactionStoreNamesMap.get(target);\r\n          }\r\n          // Make tx.store return the only store in the transaction, or undefined if there are many.\r\n          if (prop === 'store') {\r\n            return receiver.objectStoreNames[1] ? undefined : receiver.objectStore(receiver.objectStoreNames[0]);\r\n          }\r\n        }\r\n        // Else transform whatever we get back.\r\n        return wrap(target[prop]);\r\n      },\r\n      set(target, prop, value) {\r\n        target[prop] = value;\r\n        return true;\r\n      },\r\n      has(target, prop) {\r\n        if (target instanceof IDBTransaction && (prop === 'done' || prop === 'store')) {\r\n          return true;\r\n        }\r\n        return prop in target;\r\n      }\r\n    };\r\n    function replaceTraps(callback) {\r\n      idbProxyTraps = callback(idbProxyTraps);\r\n    }\r\n    function wrapFunction(func) {\r\n      // Due to expected object equality (which is enforced by the caching in `wrap`), we\r\n      // only create one new func per func.\r\n      // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\r\n      if (func === IDBDatabase.prototype.transaction && !('objectStoreNames' in IDBTransaction.prototype)) {\r\n        return function (storeNames, ...args) {\r\n          const tx = func.call(unwrap(this), storeNames, ...args);\r\n          transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\r\n          return wrap(tx);\r\n        };\r\n      }\r\n      // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\r\n      // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\r\n      // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\r\n      // with real promises, so each advance methods returns a new promise for the cursor object, or\r\n      // undefined if the end of the cursor has been reached.\r\n      if (getCursorAdvanceMethods().includes(func)) {\r\n        return function (...args) {\r\n          // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\r\n          // the original object.\r\n          func.apply(unwrap(this), args);\r\n          return wrap(cursorRequestMap.get(this));\r\n        };\r\n      }\r\n      return function (...args) {\r\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\r\n        // the original object.\r\n        return wrap(func.apply(unwrap(this), args));\r\n      };\r\n    }\r\n    function transformCachableValue(value) {\r\n      if (typeof value === 'function') return wrapFunction(value);\r\n      // This doesn't return, it just creates a 'done' promise for the transaction,\r\n      // which is later returned for transaction.done (see idbObjectHandler).\r\n      if (value instanceof IDBTransaction) cacheDonePromiseForTransaction(value);\r\n      if (instanceOfAny(value, getIdbProxyableTypes())) return new Proxy(value, idbProxyTraps);\r\n      // Return the same value back if we're not going to transform it.\r\n      return value;\r\n    }\r\n    function wrap(value) {\r\n      // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\r\n      // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\r\n      if (value instanceof IDBRequest) return promisifyRequest(value);\r\n      // If we've already transformed this value before, reuse the transformed value.\r\n      // This is faster, but it also provides object equality.\r\n      if (transformCache.has(value)) return transformCache.get(value);\r\n      const newValue = transformCachableValue(value);\r\n      // Not all types are transformed.\r\n      // These may be primitive types, so they can't be WeakMap keys.\r\n      if (newValue !== value) {\r\n        transformCache.set(value, newValue);\r\n        reverseTransformCache.set(newValue, value);\r\n      }\r\n      return newValue;\r\n    }\r\n    const unwrap = value => reverseTransformCache.get(value);\r\n\r\n    /**\r\n     * Open a database.\r\n     *\r\n     * @param name Name of the database.\r\n     * @param version Schema version.\r\n     * @param callbacks Additional callbacks.\r\n     */\r\n    function openDB(name, version, {\r\n      blocked,\r\n      upgrade,\r\n      blocking,\r\n      terminated\r\n    } = {}) {\r\n      const request = indexedDB.open(name, version);\r\n      const openPromise = wrap(request);\r\n      if (upgrade) {\r\n        request.addEventListener('upgradeneeded', event => {\r\n          upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction), event);\r\n        });\r\n      }\r\n      if (blocked) {\r\n        request.addEventListener('blocked', event => blocked(\r\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\r\n        event.oldVersion, event.newVersion, event));\r\n      }\r\n      openPromise.then(db => {\r\n        if (terminated) db.addEventListener('close', () => terminated());\r\n        if (blocking) {\r\n          db.addEventListener('versionchange', event => blocking(event.oldVersion, event.newVersion, event));\r\n        }\r\n      }).catch(() => {});\r\n      return openPromise;\r\n    }\r\n    /**\r\n     * Delete a database.\r\n     *\r\n     * @param name Name of the database.\r\n     */\r\n    function deleteDB(name, {\r\n      blocked\r\n    } = {}) {\r\n      const request = indexedDB.deleteDatabase(name);\r\n      if (blocked) {\r\n        request.addEventListener('blocked', event => blocked(\r\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\r\n        event.oldVersion, event));\r\n      }\r\n      return wrap(request).then(() => undefined);\r\n    }\r\n    const readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\r\n    const writeMethods = ['put', 'add', 'delete', 'clear'];\r\n    const cachedMethods = new Map();\r\n    function getMethod(target, prop) {\r\n      if (!(target instanceof IDBDatabase && !(prop in target) && typeof prop === 'string')) {\r\n        return;\r\n      }\r\n      if (cachedMethods.get(prop)) return cachedMethods.get(prop);\r\n      const targetFuncName = prop.replace(/FromIndex$/, '');\r\n      const useIndex = prop !== targetFuncName;\r\n      const isWrite = writeMethods.includes(targetFuncName);\r\n      if (\r\n      // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\r\n      !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) || !(isWrite || readMethods.includes(targetFuncName))) {\r\n        return;\r\n      }\r\n      const method = async function (storeName, ...args) {\r\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\r\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\r\n        let target = tx.store;\r\n        if (useIndex) target = target.index(args.shift());\r\n        // Must reject if op rejects.\r\n        // If it's a write operation, must reject if tx.done rejects.\r\n        // Must reject with op rejection first.\r\n        // Must resolve with op value.\r\n        // Must handle both promises (no unhandled rejections)\r\n        return (await Promise.all([target[targetFuncName](...args), isWrite && tx.done]))[0];\r\n      };\r\n      cachedMethods.set(prop, method);\r\n      return method;\r\n    }\r\n    replaceTraps(oldTraps => _extends({}, oldTraps, {\r\n      get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\r\n      has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop)\r\n    }));\r\n\r\n    // @ts-ignore\r\n    try {\r\n      self['workbox:expiration:7.3.0'] && _();\r\n    } catch (e) {}\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const DB_NAME = 'workbox-expiration';\r\n    const CACHE_OBJECT_STORE = 'cache-entries';\r\n    const normalizeURL = unNormalizedUrl => {\r\n      const url = new URL(unNormalizedUrl, location.href);\r\n      url.hash = '';\r\n      return url.href;\r\n    };\r\n    /**\r\n     * Returns the timestamp model.\r\n     *\r\n     * @private\r\n     */\r\n    class CacheTimestampsModel {\r\n      /**\r\n       *\r\n       * @param {string} cacheName\r\n       *\r\n       * @private\r\n       */\r\n      constructor(cacheName) {\r\n        this._db = null;\r\n        this._cacheName = cacheName;\r\n      }\r\n      /**\r\n       * Performs an upgrade of indexedDB.\r\n       *\r\n       * @param {IDBPDatabase<CacheDbSchema>} db\r\n       *\r\n       * @private\r\n       */\r\n      _upgradeDb(db) {\r\n        // TODO(philipwalton): EdgeHTML doesn't support arrays as a keyPath, so we\r\n        // have to use the `id` keyPath here and create our own values (a\r\n        // concatenation of `url + cacheName`) instead of simply using\r\n        // `keyPath: ['url', 'cacheName']`, which is supported in other browsers.\r\n        const objStore = db.createObjectStore(CACHE_OBJECT_STORE, {\r\n          keyPath: 'id'\r\n        });\r\n        // TODO(philipwalton): once we don't have to support EdgeHTML, we can\r\n        // create a single index with the keyPath `['cacheName', 'timestamp']`\r\n        // instead of doing both these indexes.\r\n        objStore.createIndex('cacheName', 'cacheName', {\r\n          unique: false\r\n        });\r\n        objStore.createIndex('timestamp', 'timestamp', {\r\n          unique: false\r\n        });\r\n      }\r\n      /**\r\n       * Performs an upgrade of indexedDB and deletes deprecated DBs.\r\n       *\r\n       * @param {IDBPDatabase<CacheDbSchema>} db\r\n       *\r\n       * @private\r\n       */\r\n      _upgradeDbAndDeleteOldDbs(db) {\r\n        this._upgradeDb(db);\r\n        if (this._cacheName) {\r\n          void deleteDB(this._cacheName);\r\n        }\r\n      }\r\n      /**\r\n       * @param {string} url\r\n       * @param {number} timestamp\r\n       *\r\n       * @private\r\n       */\r\n      async setTimestamp(url, timestamp) {\r\n        url = normalizeURL(url);\r\n        const entry = {\r\n          url,\r\n          timestamp,\r\n          cacheName: this._cacheName,\r\n          // Creating an ID from the URL and cache name won't be necessary once\r\n          // Edge switches to Chromium and all browsers we support work with\r\n          // array keyPaths.\r\n          id: this._getId(url)\r\n        };\r\n        const db = await this.getDb();\r\n        const tx = db.transaction(CACHE_OBJECT_STORE, 'readwrite', {\r\n          durability: 'relaxed'\r\n        });\r\n        await tx.store.put(entry);\r\n        await tx.done;\r\n      }\r\n      /**\r\n       * Returns the timestamp stored for a given URL.\r\n       *\r\n       * @param {string} url\r\n       * @return {number | undefined}\r\n       *\r\n       * @private\r\n       */\r\n      async getTimestamp(url) {\r\n        const db = await this.getDb();\r\n        const entry = await db.get(CACHE_OBJECT_STORE, this._getId(url));\r\n        return entry === null || entry === void 0 ? void 0 : entry.timestamp;\r\n      }\r\n      /**\r\n       * Iterates through all the entries in the object store (from newest to\r\n       * oldest) and removes entries once either `maxCount` is reached or the\r\n       * entry's timestamp is less than `minTimestamp`.\r\n       *\r\n       * @param {number} minTimestamp\r\n       * @param {number} maxCount\r\n       * @return {Array<string>}\r\n       *\r\n       * @private\r\n       */\r\n      async expireEntries(minTimestamp, maxCount) {\r\n        const db = await this.getDb();\r\n        let cursor = await db.transaction(CACHE_OBJECT_STORE).store.index('timestamp').openCursor(null, 'prev');\r\n        const entriesToDelete = [];\r\n        let entriesNotDeletedCount = 0;\r\n        while (cursor) {\r\n          const result = cursor.value;\r\n          // TODO(philipwalton): once we can use a multi-key index, we\r\n          // won't have to check `cacheName` here.\r\n          if (result.cacheName === this._cacheName) {\r\n            // Delete an entry if it's older than the max age or\r\n            // if we already have the max number allowed.\r\n            if (minTimestamp && result.timestamp < minTimestamp || maxCount && entriesNotDeletedCount >= maxCount) {\r\n              // TODO(philipwalton): we should be able to delete the\r\n              // entry right here, but doing so causes an iteration\r\n              // bug in Safari stable (fixed in TP). Instead we can\r\n              // store the keys of the entries to delete, and then\r\n              // delete the separate transactions.\r\n              // https://github.com/GoogleChrome/workbox/issues/1978\r\n              // cursor.delete();\r\n              // We only need to return the URL, not the whole entry.\r\n              entriesToDelete.push(cursor.value);\r\n            } else {\r\n              entriesNotDeletedCount++;\r\n            }\r\n          }\r\n          cursor = await cursor.continue();\r\n        }\r\n        // TODO(philipwalton): once the Safari bug in the following issue is fixed,\r\n        // we should be able to remove this loop and do the entry deletion in the\r\n        // cursor loop above:\r\n        // https://github.com/GoogleChrome/workbox/issues/1978\r\n        const urlsDeleted = [];\r\n        for (const entry of entriesToDelete) {\r\n          await db.delete(CACHE_OBJECT_STORE, entry.id);\r\n          urlsDeleted.push(entry.url);\r\n        }\r\n        return urlsDeleted;\r\n      }\r\n      /**\r\n       * Takes a URL and returns an ID that will be unique in the object store.\r\n       *\r\n       * @param {string} url\r\n       * @return {string}\r\n       *\r\n       * @private\r\n       */\r\n      _getId(url) {\r\n        // Creating an ID from the URL and cache name won't be necessary once\r\n        // Edge switches to Chromium and all browsers we support work with\r\n        // array keyPaths.\r\n        return this._cacheName + '|' + normalizeURL(url);\r\n      }\r\n      /**\r\n       * Returns an open connection to the database.\r\n       *\r\n       * @private\r\n       */\r\n      async getDb() {\r\n        if (!this._db) {\r\n          this._db = await openDB(DB_NAME, 1, {\r\n            upgrade: this._upgradeDbAndDeleteOldDbs.bind(this)\r\n          });\r\n        }\r\n        return this._db;\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * The `CacheExpiration` class allows you define an expiration and / or\r\n     * limit on the number of responses stored in a\r\n     * [`Cache`](https://developer.mozilla.org/en-US/docs/Web/API/Cache).\r\n     *\r\n     * @memberof workbox-expiration\r\n     */\r\n    class CacheExpiration {\r\n      /**\r\n       * To construct a new CacheExpiration instance you must provide at least\r\n       * one of the `config` properties.\r\n       *\r\n       * @param {string} cacheName Name of the cache to apply restrictions to.\r\n       * @param {Object} config\r\n       * @param {number} [config.maxEntries] The maximum number of entries to cache.\r\n       * Entries used the least will be removed as the maximum is reached.\r\n       * @param {number} [config.maxAgeSeconds] The maximum age of an entry before\r\n       * it's treated as stale and removed.\r\n       * @param {Object} [config.matchOptions] The [`CacheQueryOptions`](https://developer.mozilla.org/en-US/docs/Web/API/Cache/delete#Parameters)\r\n       * that will be used when calling `delete()` on the cache.\r\n       */\r\n      constructor(cacheName, config = {}) {\r\n        this._isRunning = false;\r\n        this._rerunRequested = false;\r\n        {\r\n          finalAssertExports.isType(cacheName, 'string', {\r\n            moduleName: 'workbox-expiration',\r\n            className: 'CacheExpiration',\r\n            funcName: 'constructor',\r\n            paramName: 'cacheName'\r\n          });\r\n          if (!(config.maxEntries || config.maxAgeSeconds)) {\r\n            throw new WorkboxError('max-entries-or-age-required', {\r\n              moduleName: 'workbox-expiration',\r\n              className: 'CacheExpiration',\r\n              funcName: 'constructor'\r\n            });\r\n          }\r\n          if (config.maxEntries) {\r\n            finalAssertExports.isType(config.maxEntries, 'number', {\r\n              moduleName: 'workbox-expiration',\r\n              className: 'CacheExpiration',\r\n              funcName: 'constructor',\r\n              paramName: 'config.maxEntries'\r\n            });\r\n          }\r\n          if (config.maxAgeSeconds) {\r\n            finalAssertExports.isType(config.maxAgeSeconds, 'number', {\r\n              moduleName: 'workbox-expiration',\r\n              className: 'CacheExpiration',\r\n              funcName: 'constructor',\r\n              paramName: 'config.maxAgeSeconds'\r\n            });\r\n          }\r\n        }\r\n        this._maxEntries = config.maxEntries;\r\n        this._maxAgeSeconds = config.maxAgeSeconds;\r\n        this._matchOptions = config.matchOptions;\r\n        this._cacheName = cacheName;\r\n        this._timestampModel = new CacheTimestampsModel(cacheName);\r\n      }\r\n      /**\r\n       * Expires entries for the given cache and given criteria.\r\n       */\r\n      async expireEntries() {\r\n        if (this._isRunning) {\r\n          this._rerunRequested = true;\r\n          return;\r\n        }\r\n        this._isRunning = true;\r\n        const minTimestamp = this._maxAgeSeconds ? Date.now() - this._maxAgeSeconds * 1000 : 0;\r\n        const urlsExpired = await this._timestampModel.expireEntries(minTimestamp, this._maxEntries);\r\n        // Delete URLs from the cache\r\n        const cache = await self.caches.open(this._cacheName);\r\n        for (const url of urlsExpired) {\r\n          await cache.delete(url, this._matchOptions);\r\n        }\r\n        {\r\n          if (urlsExpired.length > 0) {\r\n            logger.groupCollapsed(`Expired ${urlsExpired.length} ` + `${urlsExpired.length === 1 ? 'entry' : 'entries'} and removed ` + `${urlsExpired.length === 1 ? 'it' : 'them'} from the ` + `'${this._cacheName}' cache.`);\r\n            logger.log(`Expired the following ${urlsExpired.length === 1 ? 'URL' : 'URLs'}:`);\r\n            urlsExpired.forEach(url => logger.log(`    ${url}`));\r\n            logger.groupEnd();\r\n          } else {\r\n            logger.debug(`Cache expiration ran and found no entries to remove.`);\r\n          }\r\n        }\r\n        this._isRunning = false;\r\n        if (this._rerunRequested) {\r\n          this._rerunRequested = false;\r\n          dontWaitFor(this.expireEntries());\r\n        }\r\n      }\r\n      /**\r\n       * Update the timestamp for the given URL. This ensures the when\r\n       * removing entries based on maximum entries, most recently used\r\n       * is accurate or when expiring, the timestamp is up-to-date.\r\n       *\r\n       * @param {string} url\r\n       */\r\n      async updateTimestamp(url) {\r\n        {\r\n          finalAssertExports.isType(url, 'string', {\r\n            moduleName: 'workbox-expiration',\r\n            className: 'CacheExpiration',\r\n            funcName: 'updateTimestamp',\r\n            paramName: 'url'\r\n          });\r\n        }\r\n        await this._timestampModel.setTimestamp(url, Date.now());\r\n      }\r\n      /**\r\n       * Can be used to check if a URL has expired or not before it's used.\r\n       *\r\n       * This requires a look up from IndexedDB, so can be slow.\r\n       *\r\n       * Note: This method will not remove the cached entry, call\r\n       * `expireEntries()` to remove indexedDB and Cache entries.\r\n       *\r\n       * @param {string} url\r\n       * @return {boolean}\r\n       */\r\n      async isURLExpired(url) {\r\n        if (!this._maxAgeSeconds) {\r\n          {\r\n            throw new WorkboxError(`expired-test-without-max-age`, {\r\n              methodName: 'isURLExpired',\r\n              paramName: 'maxAgeSeconds'\r\n            });\r\n          }\r\n        } else {\r\n          const timestamp = await this._timestampModel.getTimestamp(url);\r\n          const expireOlderThan = Date.now() - this._maxAgeSeconds * 1000;\r\n          return timestamp !== undefined ? timestamp < expireOlderThan : true;\r\n        }\r\n      }\r\n      /**\r\n       * Removes the IndexedDB object store used to keep track of cache expiration\r\n       * metadata.\r\n       */\r\n      async delete() {\r\n        // Make sure we don't attempt another rerun if we're called in the middle of\r\n        // a cache expiration.\r\n        this._rerunRequested = false;\r\n        await this._timestampModel.expireEntries(Infinity); // Expires all.\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * This plugin can be used in a `workbox-strategy` to regularly enforce a\r\n     * limit on the age and / or the number of cached requests.\r\n     *\r\n     * It can only be used with `workbox-strategy` instances that have a\r\n     * [custom `cacheName` property set](/web/tools/workbox/guides/configure-workbox#custom_cache_names_in_strategies).\r\n     * In other words, it can't be used to expire entries in strategy that uses the\r\n     * default runtime cache name.\r\n     *\r\n     * Whenever a cached response is used or updated, this plugin will look\r\n     * at the associated cache and remove any old or extra responses.\r\n     *\r\n     * When using `maxAgeSeconds`, responses may be used *once* after expiring\r\n     * because the expiration clean up will not have occurred until *after* the\r\n     * cached response has been used. If the response has a \"Date\" header, then\r\n     * a light weight expiration check is performed and the response will not be\r\n     * used immediately.\r\n     *\r\n     * When using `maxEntries`, the entry least-recently requested will be removed\r\n     * from the cache first.\r\n     *\r\n     * @memberof workbox-expiration\r\n     */\r\n    class ExpirationPlugin {\r\n      /**\r\n       * @param {ExpirationPluginOptions} config\r\n       * @param {number} [config.maxEntries] The maximum number of entries to cache.\r\n       * Entries used the least will be removed as the maximum is reached.\r\n       * @param {number} [config.maxAgeSeconds] The maximum age of an entry before\r\n       * it's treated as stale and removed.\r\n       * @param {Object} [config.matchOptions] The [`CacheQueryOptions`](https://developer.mozilla.org/en-US/docs/Web/API/Cache/delete#Parameters)\r\n       * that will be used when calling `delete()` on the cache.\r\n       * @param {boolean} [config.purgeOnQuotaError] Whether to opt this cache in to\r\n       * automatic deletion if the available storage quota has been exceeded.\r\n       */\r\n      constructor(config = {}) {\r\n        /**\r\n         * A \"lifecycle\" callback that will be triggered automatically by the\r\n         * `workbox-strategies` handlers when a `Response` is about to be returned\r\n         * from a [Cache](https://developer.mozilla.org/en-US/docs/Web/API/Cache) to\r\n         * the handler. It allows the `Response` to be inspected for freshness and\r\n         * prevents it from being used if the `Response`'s `Date` header value is\r\n         * older than the configured `maxAgeSeconds`.\r\n         *\r\n         * @param {Object} options\r\n         * @param {string} options.cacheName Name of the cache the response is in.\r\n         * @param {Response} options.cachedResponse The `Response` object that's been\r\n         *     read from a cache and whose freshness should be checked.\r\n         * @return {Response} Either the `cachedResponse`, if it's\r\n         *     fresh, or `null` if the `Response` is older than `maxAgeSeconds`.\r\n         *\r\n         * @private\r\n         */\r\n        this.cachedResponseWillBeUsed = async ({\r\n          event,\r\n          request,\r\n          cacheName,\r\n          cachedResponse\r\n        }) => {\r\n          if (!cachedResponse) {\r\n            return null;\r\n          }\r\n          const isFresh = this._isResponseDateFresh(cachedResponse);\r\n          // Expire entries to ensure that even if the expiration date has\r\n          // expired, it'll only be used once.\r\n          const cacheExpiration = this._getCacheExpiration(cacheName);\r\n          dontWaitFor(cacheExpiration.expireEntries());\r\n          // Update the metadata for the request URL to the current timestamp,\r\n          // but don't `await` it as we don't want to block the response.\r\n          const updateTimestampDone = cacheExpiration.updateTimestamp(request.url);\r\n          if (event) {\r\n            try {\r\n              event.waitUntil(updateTimestampDone);\r\n            } catch (error) {\r\n              {\r\n                // The event may not be a fetch event; only log the URL if it is.\r\n                if ('request' in event) {\r\n                  logger.warn(`Unable to ensure service worker stays alive when ` + `updating cache entry for ` + `'${getFriendlyURL(event.request.url)}'.`);\r\n                }\r\n              }\r\n            }\r\n          }\r\n          return isFresh ? cachedResponse : null;\r\n        };\r\n        /**\r\n         * A \"lifecycle\" callback that will be triggered automatically by the\r\n         * `workbox-strategies` handlers when an entry is added to a cache.\r\n         *\r\n         * @param {Object} options\r\n         * @param {string} options.cacheName Name of the cache that was updated.\r\n         * @param {string} options.request The Request for the cached entry.\r\n         *\r\n         * @private\r\n         */\r\n        this.cacheDidUpdate = async ({\r\n          cacheName,\r\n          request\r\n        }) => {\r\n          {\r\n            finalAssertExports.isType(cacheName, 'string', {\r\n              moduleName: 'workbox-expiration',\r\n              className: 'Plugin',\r\n              funcName: 'cacheDidUpdate',\r\n              paramName: 'cacheName'\r\n            });\r\n            finalAssertExports.isInstance(request, Request, {\r\n              moduleName: 'workbox-expiration',\r\n              className: 'Plugin',\r\n              funcName: 'cacheDidUpdate',\r\n              paramName: 'request'\r\n            });\r\n          }\r\n          const cacheExpiration = this._getCacheExpiration(cacheName);\r\n          await cacheExpiration.updateTimestamp(request.url);\r\n          await cacheExpiration.expireEntries();\r\n        };\r\n        {\r\n          if (!(config.maxEntries || config.maxAgeSeconds)) {\r\n            throw new WorkboxError('max-entries-or-age-required', {\r\n              moduleName: 'workbox-expiration',\r\n              className: 'Plugin',\r\n              funcName: 'constructor'\r\n            });\r\n          }\r\n          if (config.maxEntries) {\r\n            finalAssertExports.isType(config.maxEntries, 'number', {\r\n              moduleName: 'workbox-expiration',\r\n              className: 'Plugin',\r\n              funcName: 'constructor',\r\n              paramName: 'config.maxEntries'\r\n            });\r\n          }\r\n          if (config.maxAgeSeconds) {\r\n            finalAssertExports.isType(config.maxAgeSeconds, 'number', {\r\n              moduleName: 'workbox-expiration',\r\n              className: 'Plugin',\r\n              funcName: 'constructor',\r\n              paramName: 'config.maxAgeSeconds'\r\n            });\r\n          }\r\n        }\r\n        this._config = config;\r\n        this._maxAgeSeconds = config.maxAgeSeconds;\r\n        this._cacheExpirations = new Map();\r\n        if (config.purgeOnQuotaError) {\r\n          registerQuotaErrorCallback(() => this.deleteCacheAndMetadata());\r\n        }\r\n      }\r\n      /**\r\n       * A simple helper method to return a CacheExpiration instance for a given\r\n       * cache name.\r\n       *\r\n       * @param {string} cacheName\r\n       * @return {CacheExpiration}\r\n       *\r\n       * @private\r\n       */\r\n      _getCacheExpiration(cacheName) {\r\n        if (cacheName === cacheNames.getRuntimeName()) {\r\n          throw new WorkboxError('expire-custom-caches-only');\r\n        }\r\n        let cacheExpiration = this._cacheExpirations.get(cacheName);\r\n        if (!cacheExpiration) {\r\n          cacheExpiration = new CacheExpiration(cacheName, this._config);\r\n          this._cacheExpirations.set(cacheName, cacheExpiration);\r\n        }\r\n        return cacheExpiration;\r\n      }\r\n      /**\r\n       * @param {Response} cachedResponse\r\n       * @return {boolean}\r\n       *\r\n       * @private\r\n       */\r\n      _isResponseDateFresh(cachedResponse) {\r\n        if (!this._maxAgeSeconds) {\r\n          // We aren't expiring by age, so return true, it's fresh\r\n          return true;\r\n        }\r\n        // Check if the 'date' header will suffice a quick expiration check.\r\n        // See https://github.com/GoogleChromeLabs/sw-toolbox/issues/164 for\r\n        // discussion.\r\n        const dateHeaderTimestamp = this._getDateHeaderTimestamp(cachedResponse);\r\n        if (dateHeaderTimestamp === null) {\r\n          // Unable to parse date, so assume it's fresh.\r\n          return true;\r\n        }\r\n        // If we have a valid headerTime, then our response is fresh iff the\r\n        // headerTime plus maxAgeSeconds is greater than the current time.\r\n        const now = Date.now();\r\n        return dateHeaderTimestamp >= now - this._maxAgeSeconds * 1000;\r\n      }\r\n      /**\r\n       * This method will extract the data header and parse it into a useful\r\n       * value.\r\n       *\r\n       * @param {Response} cachedResponse\r\n       * @return {number|null}\r\n       *\r\n       * @private\r\n       */\r\n      _getDateHeaderTimestamp(cachedResponse) {\r\n        if (!cachedResponse.headers.has('date')) {\r\n          return null;\r\n        }\r\n        const dateHeader = cachedResponse.headers.get('date');\r\n        const parsedDate = new Date(dateHeader);\r\n        const headerTime = parsedDate.getTime();\r\n        // If the Date header was invalid for some reason, parsedDate.getTime()\r\n        // will return NaN.\r\n        if (isNaN(headerTime)) {\r\n          return null;\r\n        }\r\n        return headerTime;\r\n      }\r\n      /**\r\n       * This is a helper method that performs two operations:\r\n       *\r\n       * - Deletes *all* the underlying Cache instances associated with this plugin\r\n       * instance, by calling caches.delete() on your behalf.\r\n       * - Deletes the metadata from IndexedDB used to keep track of expiration\r\n       * details for each Cache instance.\r\n       *\r\n       * When using cache expiration, calling this method is preferable to calling\r\n       * `caches.delete()` directly, since this will ensure that the IndexedDB\r\n       * metadata is also cleanly removed and open IndexedDB instances are deleted.\r\n       *\r\n       * Note that if you're *not* using cache expiration for a given cache, calling\r\n       * `caches.delete()` and passing in the cache's name should be sufficient.\r\n       * There is no Workbox-specific method needed for cleanup in that case.\r\n       */\r\n      async deleteCacheAndMetadata() {\r\n        // Do this one at a time instead of all at once via `Promise.all()` to\r\n        // reduce the chance of inconsistency if a promise rejects.\r\n        for (const [cacheName, cacheExpiration] of this._cacheExpirations) {\r\n          await self.caches.delete(cacheName);\r\n          await cacheExpiration.delete();\r\n        }\r\n        // Reset this._cacheExpirations to its initial state.\r\n        this._cacheExpirations = new Map();\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    function stripParams(fullURL, ignoreParams) {\r\n      const strippedURL = new URL(fullURL);\r\n      for (const param of ignoreParams) {\r\n        strippedURL.searchParams.delete(param);\r\n      }\r\n      return strippedURL.href;\r\n    }\r\n    /**\r\n     * Matches an item in the cache, ignoring specific URL params. This is similar\r\n     * to the `ignoreSearch` option, but it allows you to ignore just specific\r\n     * params (while continuing to match on the others).\r\n     *\r\n     * @private\r\n     * @param {Cache} cache\r\n     * @param {Request} request\r\n     * @param {Object} matchOptions\r\n     * @param {Array<string>} ignoreParams\r\n     * @return {Promise<Response|undefined>}\r\n     */\r\n    async function cacheMatchIgnoreParams(cache, request, ignoreParams, matchOptions) {\r\n      const strippedRequestURL = stripParams(request.url, ignoreParams);\r\n      // If the request doesn't include any ignored params, match as normal.\r\n      if (request.url === strippedRequestURL) {\r\n        return cache.match(request, matchOptions);\r\n      }\r\n      // Otherwise, match by comparing keys\r\n      const keysOptions = Object.assign(Object.assign({}, matchOptions), {\r\n        ignoreSearch: true\r\n      });\r\n      const cacheKeys = await cache.keys(request, keysOptions);\r\n      for (const cacheKey of cacheKeys) {\r\n        const strippedCacheKeyURL = stripParams(cacheKey.url, ignoreParams);\r\n        if (strippedRequestURL === strippedCacheKeyURL) {\r\n          return cache.match(cacheKey, matchOptions);\r\n        }\r\n      }\r\n      return;\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * The Deferred class composes Promises in a way that allows for them to be\r\n     * resolved or rejected from outside the constructor. In most cases promises\r\n     * should be used directly, but Deferreds can be necessary when the logic to\r\n     * resolve a promise must be separate.\r\n     *\r\n     * @private\r\n     */\r\n    class Deferred {\r\n      /**\r\n       * Creates a promise and exposes its resolve and reject functions as methods.\r\n       */\r\n      constructor() {\r\n        this.promise = new Promise((resolve, reject) => {\r\n          this.resolve = resolve;\r\n          this.reject = reject;\r\n        });\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Runs all of the callback functions, one at a time sequentially, in the order\r\n     * in which they were registered.\r\n     *\r\n     * @memberof workbox-core\r\n     * @private\r\n     */\r\n    async function executeQuotaErrorCallbacks() {\r\n      {\r\n        logger.log(`About to run ${quotaErrorCallbacks.size} ` + `callbacks to clean up caches.`);\r\n      }\r\n      for (const callback of quotaErrorCallbacks) {\r\n        await callback();\r\n        {\r\n          logger.log(callback, 'is complete.');\r\n        }\r\n      }\r\n      {\r\n        logger.log('Finished running callbacks.');\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Returns a promise that resolves and the passed number of milliseconds.\r\n     * This utility is an async/await-friendly version of `setTimeout`.\r\n     *\r\n     * @param {number} ms\r\n     * @return {Promise}\r\n     * @private\r\n     */\r\n    function timeout(ms) {\r\n      return new Promise(resolve => setTimeout(resolve, ms));\r\n    }\r\n\r\n    // @ts-ignore\r\n    try {\r\n      self['workbox:strategies:7.3.0'] && _();\r\n    } catch (e) {}\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    function toRequest(input) {\r\n      return typeof input === 'string' ? new Request(input) : input;\r\n    }\r\n    /**\r\n     * A class created every time a Strategy instance calls\r\n     * {@link workbox-strategies.Strategy~handle} or\r\n     * {@link workbox-strategies.Strategy~handleAll} that wraps all fetch and\r\n     * cache actions around plugin callbacks and keeps track of when the strategy\r\n     * is \"done\" (i.e. all added `event.waitUntil()` promises have resolved).\r\n     *\r\n     * @memberof workbox-strategies\r\n     */\r\n    class StrategyHandler {\r\n      /**\r\n       * Creates a new instance associated with the passed strategy and event\r\n       * that's handling the request.\r\n       *\r\n       * The constructor also initializes the state that will be passed to each of\r\n       * the plugins handling this request.\r\n       *\r\n       * @param {workbox-strategies.Strategy} strategy\r\n       * @param {Object} options\r\n       * @param {Request|string} options.request A request to run this strategy for.\r\n       * @param {ExtendableEvent} options.event The event associated with the\r\n       *     request.\r\n       * @param {URL} [options.url]\r\n       * @param {*} [options.params] The return value from the\r\n       *     {@link workbox-routing~matchCallback} (if applicable).\r\n       */\r\n      constructor(strategy, options) {\r\n        this._cacheKeys = {};\r\n        /**\r\n         * The request the strategy is performing (passed to the strategy's\r\n         * `handle()` or `handleAll()` method).\r\n         * @name request\r\n         * @instance\r\n         * @type {Request}\r\n         * @memberof workbox-strategies.StrategyHandler\r\n         */\r\n        /**\r\n         * The event associated with this request.\r\n         * @name event\r\n         * @instance\r\n         * @type {ExtendableEvent}\r\n         * @memberof workbox-strategies.StrategyHandler\r\n         */\r\n        /**\r\n         * A `URL` instance of `request.url` (if passed to the strategy's\r\n         * `handle()` or `handleAll()` method).\r\n         * Note: the `url` param will be present if the strategy was invoked\r\n         * from a workbox `Route` object.\r\n         * @name url\r\n         * @instance\r\n         * @type {URL|undefined}\r\n         * @memberof workbox-strategies.StrategyHandler\r\n         */\r\n        /**\r\n         * A `param` value (if passed to the strategy's\r\n         * `handle()` or `handleAll()` method).\r\n         * Note: the `param` param will be present if the strategy was invoked\r\n         * from a workbox `Route` object and the\r\n         * {@link workbox-routing~matchCallback} returned\r\n         * a truthy value (it will be that value).\r\n         * @name params\r\n         * @instance\r\n         * @type {*|undefined}\r\n         * @memberof workbox-strategies.StrategyHandler\r\n         */\r\n        {\r\n          finalAssertExports.isInstance(options.event, ExtendableEvent, {\r\n            moduleName: 'workbox-strategies',\r\n            className: 'StrategyHandler',\r\n            funcName: 'constructor',\r\n            paramName: 'options.event'\r\n          });\r\n        }\r\n        Object.assign(this, options);\r\n        this.event = options.event;\r\n        this._strategy = strategy;\r\n        this._handlerDeferred = new Deferred();\r\n        this._extendLifetimePromises = [];\r\n        // Copy the plugins list (since it's mutable on the strategy),\r\n        // so any mutations don't affect this handler instance.\r\n        this._plugins = [...strategy.plugins];\r\n        this._pluginStateMap = new Map();\r\n        for (const plugin of this._plugins) {\r\n          this._pluginStateMap.set(plugin, {});\r\n        }\r\n        this.event.waitUntil(this._handlerDeferred.promise);\r\n      }\r\n      /**\r\n       * Fetches a given request (and invokes any applicable plugin callback\r\n       * methods) using the `fetchOptions` (for non-navigation requests) and\r\n       * `plugins` defined on the `Strategy` object.\r\n       *\r\n       * The following plugin lifecycle methods are invoked when using this method:\r\n       * - `requestWillFetch()`\r\n       * - `fetchDidSucceed()`\r\n       * - `fetchDidFail()`\r\n       *\r\n       * @param {Request|string} input The URL or request to fetch.\r\n       * @return {Promise<Response>}\r\n       */\r\n      async fetch(input) {\r\n        const {\r\n          event\r\n        } = this;\r\n        let request = toRequest(input);\r\n        if (request.mode === 'navigate' && event instanceof FetchEvent && event.preloadResponse) {\r\n          const possiblePreloadResponse = await event.preloadResponse;\r\n          if (possiblePreloadResponse) {\r\n            {\r\n              logger.log(`Using a preloaded navigation response for ` + `'${getFriendlyURL(request.url)}'`);\r\n            }\r\n            return possiblePreloadResponse;\r\n          }\r\n        }\r\n        // If there is a fetchDidFail plugin, we need to save a clone of the\r\n        // original request before it's either modified by a requestWillFetch\r\n        // plugin or before the original request's body is consumed via fetch().\r\n        const originalRequest = this.hasCallback('fetchDidFail') ? request.clone() : null;\r\n        try {\r\n          for (const cb of this.iterateCallbacks('requestWillFetch')) {\r\n            request = await cb({\r\n              request: request.clone(),\r\n              event\r\n            });\r\n          }\r\n        } catch (err) {\r\n          if (err instanceof Error) {\r\n            throw new WorkboxError('plugin-error-request-will-fetch', {\r\n              thrownErrorMessage: err.message\r\n            });\r\n          }\r\n        }\r\n        // The request can be altered by plugins with `requestWillFetch` making\r\n        // the original request (most likely from a `fetch` event) different\r\n        // from the Request we make. Pass both to `fetchDidFail` to aid debugging.\r\n        const pluginFilteredRequest = request.clone();\r\n        try {\r\n          let fetchResponse;\r\n          // See https://github.com/GoogleChrome/workbox/issues/1796\r\n          fetchResponse = await fetch(request, request.mode === 'navigate' ? undefined : this._strategy.fetchOptions);\r\n          if (\"development\" !== 'production') {\r\n            logger.debug(`Network request for ` + `'${getFriendlyURL(request.url)}' returned a response with ` + `status '${fetchResponse.status}'.`);\r\n          }\r\n          for (const callback of this.iterateCallbacks('fetchDidSucceed')) {\r\n            fetchResponse = await callback({\r\n              event,\r\n              request: pluginFilteredRequest,\r\n              response: fetchResponse\r\n            });\r\n          }\r\n          return fetchResponse;\r\n        } catch (error) {\r\n          {\r\n            logger.log(`Network request for ` + `'${getFriendlyURL(request.url)}' threw an error.`, error);\r\n          }\r\n          // `originalRequest` will only exist if a `fetchDidFail` callback\r\n          // is being used (see above).\r\n          if (originalRequest) {\r\n            await this.runCallbacks('fetchDidFail', {\r\n              error: error,\r\n              event,\r\n              originalRequest: originalRequest.clone(),\r\n              request: pluginFilteredRequest.clone()\r\n            });\r\n          }\r\n          throw error;\r\n        }\r\n      }\r\n      /**\r\n       * Calls `this.fetch()` and (in the background) runs `this.cachePut()` on\r\n       * the response generated by `this.fetch()`.\r\n       *\r\n       * The call to `this.cachePut()` automatically invokes `this.waitUntil()`,\r\n       * so you do not have to manually call `waitUntil()` on the event.\r\n       *\r\n       * @param {Request|string} input The request or URL to fetch and cache.\r\n       * @return {Promise<Response>}\r\n       */\r\n      async fetchAndCachePut(input) {\r\n        const response = await this.fetch(input);\r\n        const responseClone = response.clone();\r\n        void this.waitUntil(this.cachePut(input, responseClone));\r\n        return response;\r\n      }\r\n      /**\r\n       * Matches a request from the cache (and invokes any applicable plugin\r\n       * callback methods) using the `cacheName`, `matchOptions`, and `plugins`\r\n       * defined on the strategy object.\r\n       *\r\n       * The following plugin lifecycle methods are invoked when using this method:\r\n       * - cacheKeyWillBeUsed()\r\n       * - cachedResponseWillBeUsed()\r\n       *\r\n       * @param {Request|string} key The Request or URL to use as the cache key.\r\n       * @return {Promise<Response|undefined>} A matching response, if found.\r\n       */\r\n      async cacheMatch(key) {\r\n        const request = toRequest(key);\r\n        let cachedResponse;\r\n        const {\r\n          cacheName,\r\n          matchOptions\r\n        } = this._strategy;\r\n        const effectiveRequest = await this.getCacheKey(request, 'read');\r\n        const multiMatchOptions = Object.assign(Object.assign({}, matchOptions), {\r\n          cacheName\r\n        });\r\n        cachedResponse = await caches.match(effectiveRequest, multiMatchOptions);\r\n        {\r\n          if (cachedResponse) {\r\n            logger.debug(`Found a cached response in '${cacheName}'.`);\r\n          } else {\r\n            logger.debug(`No cached response found in '${cacheName}'.`);\r\n          }\r\n        }\r\n        for (const callback of this.iterateCallbacks('cachedResponseWillBeUsed')) {\r\n          cachedResponse = (await callback({\r\n            cacheName,\r\n            matchOptions,\r\n            cachedResponse,\r\n            request: effectiveRequest,\r\n            event: this.event\r\n          })) || undefined;\r\n        }\r\n        return cachedResponse;\r\n      }\r\n      /**\r\n       * Puts a request/response pair in the cache (and invokes any applicable\r\n       * plugin callback methods) using the `cacheName` and `plugins` defined on\r\n       * the strategy object.\r\n       *\r\n       * The following plugin lifecycle methods are invoked when using this method:\r\n       * - cacheKeyWillBeUsed()\r\n       * - cacheWillUpdate()\r\n       * - cacheDidUpdate()\r\n       *\r\n       * @param {Request|string} key The request or URL to use as the cache key.\r\n       * @param {Response} response The response to cache.\r\n       * @return {Promise<boolean>} `false` if a cacheWillUpdate caused the response\r\n       * not be cached, and `true` otherwise.\r\n       */\r\n      async cachePut(key, response) {\r\n        const request = toRequest(key);\r\n        // Run in the next task to avoid blocking other cache reads.\r\n        // https://github.com/w3c/ServiceWorker/issues/1397\r\n        await timeout(0);\r\n        const effectiveRequest = await this.getCacheKey(request, 'write');\r\n        {\r\n          if (effectiveRequest.method && effectiveRequest.method !== 'GET') {\r\n            throw new WorkboxError('attempt-to-cache-non-get-request', {\r\n              url: getFriendlyURL(effectiveRequest.url),\r\n              method: effectiveRequest.method\r\n            });\r\n          }\r\n          // See https://github.com/GoogleChrome/workbox/issues/2818\r\n          const vary = response.headers.get('Vary');\r\n          if (vary) {\r\n            logger.debug(`The response for ${getFriendlyURL(effectiveRequest.url)} ` + `has a 'Vary: ${vary}' header. ` + `Consider setting the {ignoreVary: true} option on your strategy ` + `to ensure cache matching and deletion works as expected.`);\r\n          }\r\n        }\r\n        if (!response) {\r\n          {\r\n            logger.error(`Cannot cache non-existent response for ` + `'${getFriendlyURL(effectiveRequest.url)}'.`);\r\n          }\r\n          throw new WorkboxError('cache-put-with-no-response', {\r\n            url: getFriendlyURL(effectiveRequest.url)\r\n          });\r\n        }\r\n        const responseToCache = await this._ensureResponseSafeToCache(response);\r\n        if (!responseToCache) {\r\n          {\r\n            logger.debug(`Response '${getFriendlyURL(effectiveRequest.url)}' ` + `will not be cached.`, responseToCache);\r\n          }\r\n          return false;\r\n        }\r\n        const {\r\n          cacheName,\r\n          matchOptions\r\n        } = this._strategy;\r\n        const cache = await self.caches.open(cacheName);\r\n        const hasCacheUpdateCallback = this.hasCallback('cacheDidUpdate');\r\n        const oldResponse = hasCacheUpdateCallback ? await cacheMatchIgnoreParams(\r\n        // TODO(philipwalton): the `__WB_REVISION__` param is a precaching\r\n        // feature. Consider into ways to only add this behavior if using\r\n        // precaching.\r\n        cache, effectiveRequest.clone(), ['__WB_REVISION__'], matchOptions) : null;\r\n        {\r\n          logger.debug(`Updating the '${cacheName}' cache with a new Response ` + `for ${getFriendlyURL(effectiveRequest.url)}.`);\r\n        }\r\n        try {\r\n          await cache.put(effectiveRequest, hasCacheUpdateCallback ? responseToCache.clone() : responseToCache);\r\n        } catch (error) {\r\n          if (error instanceof Error) {\r\n            // See https://developer.mozilla.org/en-US/docs/Web/API/DOMException#exception-QuotaExceededError\r\n            if (error.name === 'QuotaExceededError') {\r\n              await executeQuotaErrorCallbacks();\r\n            }\r\n            throw error;\r\n          }\r\n        }\r\n        for (const callback of this.iterateCallbacks('cacheDidUpdate')) {\r\n          await callback({\r\n            cacheName,\r\n            oldResponse,\r\n            newResponse: responseToCache.clone(),\r\n            request: effectiveRequest,\r\n            event: this.event\r\n          });\r\n        }\r\n        return true;\r\n      }\r\n      /**\r\n       * Checks the list of plugins for the `cacheKeyWillBeUsed` callback, and\r\n       * executes any of those callbacks found in sequence. The final `Request`\r\n       * object returned by the last plugin is treated as the cache key for cache\r\n       * reads and/or writes. If no `cacheKeyWillBeUsed` plugin callbacks have\r\n       * been registered, the passed request is returned unmodified\r\n       *\r\n       * @param {Request} request\r\n       * @param {string} mode\r\n       * @return {Promise<Request>}\r\n       */\r\n      async getCacheKey(request, mode) {\r\n        const key = `${request.url} | ${mode}`;\r\n        if (!this._cacheKeys[key]) {\r\n          let effectiveRequest = request;\r\n          for (const callback of this.iterateCallbacks('cacheKeyWillBeUsed')) {\r\n            effectiveRequest = toRequest(await callback({\r\n              mode,\r\n              request: effectiveRequest,\r\n              event: this.event,\r\n              // params has a type any can't change right now.\r\n              params: this.params  \r\n            }));\r\n          }\r\n          this._cacheKeys[key] = effectiveRequest;\r\n        }\r\n        return this._cacheKeys[key];\r\n      }\r\n      /**\r\n       * Returns true if the strategy has at least one plugin with the given\r\n       * callback.\r\n       *\r\n       * @param {string} name The name of the callback to check for.\r\n       * @return {boolean}\r\n       */\r\n      hasCallback(name) {\r\n        for (const plugin of this._strategy.plugins) {\r\n          if (name in plugin) {\r\n            return true;\r\n          }\r\n        }\r\n        return false;\r\n      }\r\n      /**\r\n       * Runs all plugin callbacks matching the given name, in order, passing the\r\n       * given param object (merged ith the current plugin state) as the only\r\n       * argument.\r\n       *\r\n       * Note: since this method runs all plugins, it's not suitable for cases\r\n       * where the return value of a callback needs to be applied prior to calling\r\n       * the next callback. See\r\n       * {@link workbox-strategies.StrategyHandler#iterateCallbacks}\r\n       * below for how to handle that case.\r\n       *\r\n       * @param {string} name The name of the callback to run within each plugin.\r\n       * @param {Object} param The object to pass as the first (and only) param\r\n       *     when executing each callback. This object will be merged with the\r\n       *     current plugin state prior to callback execution.\r\n       */\r\n      async runCallbacks(name, param) {\r\n        for (const callback of this.iterateCallbacks(name)) {\r\n          // TODO(philipwalton): not sure why `any` is needed. It seems like\r\n          // this should work with `as WorkboxPluginCallbackParam[C]`.\r\n          await callback(param);\r\n        }\r\n      }\r\n      /**\r\n       * Accepts a callback and returns an iterable of matching plugin callbacks,\r\n       * where each callback is wrapped with the current handler state (i.e. when\r\n       * you call each callback, whatever object parameter you pass it will\r\n       * be merged with the plugin's current state).\r\n       *\r\n       * @param {string} name The name fo the callback to run\r\n       * @return {Array<Function>}\r\n       */\r\n      *iterateCallbacks(name) {\r\n        for (const plugin of this._strategy.plugins) {\r\n          if (typeof plugin[name] === 'function') {\r\n            const state = this._pluginStateMap.get(plugin);\r\n            const statefulCallback = param => {\r\n              const statefulParam = Object.assign(Object.assign({}, param), {\r\n                state\r\n              });\r\n              // TODO(philipwalton): not sure why `any` is needed. It seems like\r\n              // this should work with `as WorkboxPluginCallbackParam[C]`.\r\n              return plugin[name](statefulParam);\r\n            };\r\n            yield statefulCallback;\r\n          }\r\n        }\r\n      }\r\n      /**\r\n       * Adds a promise to the\r\n       * [extend lifetime promises]{@link https://w3c.github.io/ServiceWorker/#extendableevent-extend-lifetime-promises}\r\n       * of the event associated with the request being handled (usually a\r\n       * `FetchEvent`).\r\n       *\r\n       * Note: you can await\r\n       * {@link workbox-strategies.StrategyHandler~doneWaiting}\r\n       * to know when all added promises have settled.\r\n       *\r\n       * @param {Promise} promise A promise to add to the extend lifetime promises\r\n       *     of the event that triggered the request.\r\n       */\r\n      waitUntil(promise) {\r\n        this._extendLifetimePromises.push(promise);\r\n        return promise;\r\n      }\r\n      /**\r\n       * Returns a promise that resolves once all promises passed to\r\n       * {@link workbox-strategies.StrategyHandler~waitUntil}\r\n       * have settled.\r\n       *\r\n       * Note: any work done after `doneWaiting()` settles should be manually\r\n       * passed to an event's `waitUntil()` method (not this handler's\r\n       * `waitUntil()` method), otherwise the service worker thread may be killed\r\n       * prior to your work completing.\r\n       */\r\n      async doneWaiting() {\r\n        while (this._extendLifetimePromises.length) {\r\n          const promises = this._extendLifetimePromises.splice(0);\r\n          const result = await Promise.allSettled(promises);\r\n          const firstRejection = result.find(i => i.status === 'rejected');\r\n          if (firstRejection) {\r\n            throw firstRejection.reason;\r\n          }\r\n        }\r\n      }\r\n      /**\r\n       * Stops running the strategy and immediately resolves any pending\r\n       * `waitUntil()` promises.\r\n       */\r\n      destroy() {\r\n        this._handlerDeferred.resolve(null);\r\n      }\r\n      /**\r\n       * This method will call cacheWillUpdate on the available plugins (or use\r\n       * status === 200) to determine if the Response is safe and valid to cache.\r\n       *\r\n       * @param {Request} options.request\r\n       * @param {Response} options.response\r\n       * @return {Promise<Response|undefined>}\r\n       *\r\n       * @private\r\n       */\r\n      async _ensureResponseSafeToCache(response) {\r\n        let responseToCache = response;\r\n        let pluginsUsed = false;\r\n        for (const callback of this.iterateCallbacks('cacheWillUpdate')) {\r\n          responseToCache = (await callback({\r\n            request: this.request,\r\n            response: responseToCache,\r\n            event: this.event\r\n          })) || undefined;\r\n          pluginsUsed = true;\r\n          if (!responseToCache) {\r\n            break;\r\n          }\r\n        }\r\n        if (!pluginsUsed) {\r\n          if (responseToCache && responseToCache.status !== 200) {\r\n            responseToCache = undefined;\r\n          }\r\n          {\r\n            if (responseToCache) {\r\n              if (responseToCache.status !== 200) {\r\n                if (responseToCache.status === 0) {\r\n                  logger.warn(`The response for '${this.request.url}' ` + `is an opaque response. The caching strategy that you're ` + `using will not cache opaque responses by default.`);\r\n                } else {\r\n                  logger.debug(`The response for '${this.request.url}' ` + `returned a status code of '${response.status}' and won't ` + `be cached as a result.`);\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n        return responseToCache;\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * An abstract base class that all other strategy classes must extend from:\r\n     *\r\n     * @memberof workbox-strategies\r\n     */\r\n    class Strategy {\r\n      /**\r\n       * Creates a new instance of the strategy and sets all documented option\r\n       * properties as public instance properties.\r\n       *\r\n       * Note: if a custom strategy class extends the base Strategy class and does\r\n       * not need more than these properties, it does not need to define its own\r\n       * constructor.\r\n       *\r\n       * @param {Object} [options]\r\n       * @param {string} [options.cacheName] Cache name to store and retrieve\r\n       * requests. Defaults to the cache names provided by\r\n       * {@link workbox-core.cacheNames}.\r\n       * @param {Array<Object>} [options.plugins] [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}\r\n       * to use in conjunction with this caching strategy.\r\n       * @param {Object} [options.fetchOptions] Values passed along to the\r\n       * [`init`](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters)\r\n       * of [non-navigation](https://github.com/GoogleChrome/workbox/issues/1796)\r\n       * `fetch()` requests made by this strategy.\r\n       * @param {Object} [options.matchOptions] The\r\n       * [`CacheQueryOptions`]{@link https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions}\r\n       * for any `cache.match()` or `cache.put()` calls made by this strategy.\r\n       */\r\n      constructor(options = {}) {\r\n        /**\r\n         * Cache name to store and retrieve\r\n         * requests. Defaults to the cache names provided by\r\n         * {@link workbox-core.cacheNames}.\r\n         *\r\n         * @type {string}\r\n         */\r\n        this.cacheName = cacheNames.getRuntimeName(options.cacheName);\r\n        /**\r\n         * The list\r\n         * [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}\r\n         * used by this strategy.\r\n         *\r\n         * @type {Array<Object>}\r\n         */\r\n        this.plugins = options.plugins || [];\r\n        /**\r\n         * Values passed along to the\r\n         * [`init`]{@link https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters}\r\n         * of all fetch() requests made by this strategy.\r\n         *\r\n         * @type {Object}\r\n         */\r\n        this.fetchOptions = options.fetchOptions;\r\n        /**\r\n         * The\r\n         * [`CacheQueryOptions`]{@link https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions}\r\n         * for any `cache.match()` or `cache.put()` calls made by this strategy.\r\n         *\r\n         * @type {Object}\r\n         */\r\n        this.matchOptions = options.matchOptions;\r\n      }\r\n      /**\r\n       * Perform a request strategy and returns a `Promise` that will resolve with\r\n       * a `Response`, invoking all relevant plugin callbacks.\r\n       *\r\n       * When a strategy instance is registered with a Workbox\r\n       * {@link workbox-routing.Route}, this method is automatically\r\n       * called when the route matches.\r\n       *\r\n       * Alternatively, this method can be used in a standalone `FetchEvent`\r\n       * listener by passing it to `event.respondWith()`.\r\n       *\r\n       * @param {FetchEvent|Object} options A `FetchEvent` or an object with the\r\n       *     properties listed below.\r\n       * @param {Request|string} options.request A request to run this strategy for.\r\n       * @param {ExtendableEvent} options.event The event associated with the\r\n       *     request.\r\n       * @param {URL} [options.url]\r\n       * @param {*} [options.params]\r\n       */\r\n      handle(options) {\r\n        const [responseDone] = this.handleAll(options);\r\n        return responseDone;\r\n      }\r\n      /**\r\n       * Similar to {@link workbox-strategies.Strategy~handle}, but\r\n       * instead of just returning a `Promise` that resolves to a `Response` it\r\n       * it will return an tuple of `[response, done]` promises, where the former\r\n       * (`response`) is equivalent to what `handle()` returns, and the latter is a\r\n       * Promise that will resolve once any promises that were added to\r\n       * `event.waitUntil()` as part of performing the strategy have completed.\r\n       *\r\n       * You can await the `done` promise to ensure any extra work performed by\r\n       * the strategy (usually caching responses) completes successfully.\r\n       *\r\n       * @param {FetchEvent|Object} options A `FetchEvent` or an object with the\r\n       *     properties listed below.\r\n       * @param {Request|string} options.request A request to run this strategy for.\r\n       * @param {ExtendableEvent} options.event The event associated with the\r\n       *     request.\r\n       * @param {URL} [options.url]\r\n       * @param {*} [options.params]\r\n       * @return {Array<Promise>} A tuple of [response, done]\r\n       *     promises that can be used to determine when the response resolves as\r\n       *     well as when the handler has completed all its work.\r\n       */\r\n      handleAll(options) {\r\n        // Allow for flexible options to be passed.\r\n        if (options instanceof FetchEvent) {\r\n          options = {\r\n            event: options,\r\n            request: options.request\r\n          };\r\n        }\r\n        const event = options.event;\r\n        const request = typeof options.request === 'string' ? new Request(options.request) : options.request;\r\n        const params = 'params' in options ? options.params : undefined;\r\n        const handler = new StrategyHandler(this, {\r\n          event,\r\n          request,\r\n          params\r\n        });\r\n        const responseDone = this._getResponse(handler, request, event);\r\n        const handlerDone = this._awaitComplete(responseDone, handler, request, event);\r\n        // Return an array of promises, suitable for use with Promise.all().\r\n        return [responseDone, handlerDone];\r\n      }\r\n      async _getResponse(handler, request, event) {\r\n        await handler.runCallbacks('handlerWillStart', {\r\n          event,\r\n          request\r\n        });\r\n        let response = undefined;\r\n        try {\r\n          response = await this._handle(request, handler);\r\n          // The \"official\" Strategy subclasses all throw this error automatically,\r\n          // but in case a third-party Strategy doesn't, ensure that we have a\r\n          // consistent failure when there's no response or an error response.\r\n          if (!response || response.type === 'error') {\r\n            throw new WorkboxError('no-response', {\r\n              url: request.url\r\n            });\r\n          }\r\n        } catch (error) {\r\n          if (error instanceof Error) {\r\n            for (const callback of handler.iterateCallbacks('handlerDidError')) {\r\n              response = await callback({\r\n                error,\r\n                event,\r\n                request\r\n              });\r\n              if (response) {\r\n                break;\r\n              }\r\n            }\r\n          }\r\n          if (!response) {\r\n            throw error;\r\n          } else {\r\n            logger.log(`While responding to '${getFriendlyURL(request.url)}', ` + `an ${error instanceof Error ? error.toString() : ''} error occurred. Using a fallback response provided by ` + `a handlerDidError plugin.`);\r\n          }\r\n        }\r\n        for (const callback of handler.iterateCallbacks('handlerWillRespond')) {\r\n          response = await callback({\r\n            event,\r\n            request,\r\n            response\r\n          });\r\n        }\r\n        return response;\r\n      }\r\n      async _awaitComplete(responseDone, handler, request, event) {\r\n        let response;\r\n        let error;\r\n        try {\r\n          response = await responseDone;\r\n        } catch (error) {\r\n          // Ignore errors, as response errors should be caught via the `response`\r\n          // promise above. The `done` promise will only throw for errors in\r\n          // promises passed to `handler.waitUntil()`.\r\n        }\r\n        try {\r\n          await handler.runCallbacks('handlerDidRespond', {\r\n            event,\r\n            request,\r\n            response\r\n          });\r\n          await handler.doneWaiting();\r\n        } catch (waitUntilError) {\r\n          if (waitUntilError instanceof Error) {\r\n            error = waitUntilError;\r\n          }\r\n        }\r\n        await handler.runCallbacks('handlerDidComplete', {\r\n          event,\r\n          request,\r\n          response,\r\n          error: error\r\n        });\r\n        handler.destroy();\r\n        if (error) {\r\n          throw error;\r\n        }\r\n      }\r\n    }\r\n    /**\r\n     * Classes extending the `Strategy` based class should implement this method,\r\n     * and leverage the {@link workbox-strategies.StrategyHandler}\r\n     * arg to perform all fetching and cache logic, which will ensure all relevant\r\n     * cache, cache options, fetch options and plugins are used (per the current\r\n     * strategy instance).\r\n     *\r\n     * @name _handle\r\n     * @instance\r\n     * @abstract\r\n     * @function\r\n     * @param {Request} request\r\n     * @param {workbox-strategies.StrategyHandler} handler\r\n     * @return {Promise<Response>}\r\n     *\r\n     * @memberof workbox-strategies.Strategy\r\n     */\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const messages = {\r\n      strategyStart: (strategyName, request) => `Using ${strategyName} to respond to '${getFriendlyURL(request.url)}'`,\r\n      printFinalResponse: response => {\r\n        if (response) {\r\n          logger.groupCollapsed(`View the final response here.`);\r\n          logger.log(response || '[No response returned]');\r\n          logger.groupEnd();\r\n        }\r\n      }\r\n    };\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * An implementation of a [cache-first](https://developer.chrome.com/docs/workbox/caching-strategies-overview/#cache-first-falling-back-to-network)\r\n     * request strategy.\r\n     *\r\n     * A cache first strategy is useful for assets that have been revisioned,\r\n     * such as URLs like `/styles/example.a8f5f1.css`, since they\r\n     * can be cached for long periods of time.\r\n     *\r\n     * If the network request fails, and there is no cache match, this will throw\r\n     * a `WorkboxError` exception.\r\n     *\r\n     * @extends workbox-strategies.Strategy\r\n     * @memberof workbox-strategies\r\n     */\r\n    class CacheFirst extends Strategy {\r\n      /**\r\n       * @private\r\n       * @param {Request|string} request A request to run this strategy for.\r\n       * @param {workbox-strategies.StrategyHandler} handler The event that\r\n       *     triggered the request.\r\n       * @return {Promise<Response>}\r\n       */\r\n      async _handle(request, handler) {\r\n        const logs = [];\r\n        {\r\n          finalAssertExports.isInstance(request, Request, {\r\n            moduleName: 'workbox-strategies',\r\n            className: this.constructor.name,\r\n            funcName: 'makeRequest',\r\n            paramName: 'request'\r\n          });\r\n        }\r\n        let response = await handler.cacheMatch(request);\r\n        let error = undefined;\r\n        if (!response) {\r\n          {\r\n            logs.push(`No response found in the '${this.cacheName}' cache. ` + `Will respond with a network request.`);\r\n          }\r\n          try {\r\n            response = await handler.fetchAndCachePut(request);\r\n          } catch (err) {\r\n            if (err instanceof Error) {\r\n              error = err;\r\n            }\r\n          }\r\n          {\r\n            if (response) {\r\n              logs.push(`Got response from network.`);\r\n            } else {\r\n              logs.push(`Unable to get a response from the network.`);\r\n            }\r\n          }\r\n        } else {\r\n          {\r\n            logs.push(`Found a cached response in the '${this.cacheName}' cache.`);\r\n          }\r\n        }\r\n        {\r\n          logger.groupCollapsed(messages.strategyStart(this.constructor.name, request));\r\n          for (const log of logs) {\r\n            logger.log(log);\r\n          }\r\n          messages.printFinalResponse(response);\r\n          logger.groupEnd();\r\n        }\r\n        if (!response) {\r\n          throw new WorkboxError('no-response', {\r\n            url: request.url,\r\n            error\r\n          });\r\n        }\r\n        return response;\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * An implementation of a\r\n     * [network-only](https://developer.chrome.com/docs/workbox/caching-strategies-overview/#network-only)\r\n     * request strategy.\r\n     *\r\n     * This class is useful if you want to take advantage of any\r\n     * [Workbox plugins](https://developer.chrome.com/docs/workbox/using-plugins/).\r\n     *\r\n     * If the network request fails, this will throw a `WorkboxError` exception.\r\n     *\r\n     * @extends workbox-strategies.Strategy\r\n     * @memberof workbox-strategies\r\n     */\r\n    class NetworkOnly extends Strategy {\r\n      /**\r\n       * @param {Object} [options]\r\n       * @param {Array<Object>} [options.plugins] [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}\r\n       * to use in conjunction with this caching strategy.\r\n       * @param {Object} [options.fetchOptions] Values passed along to the\r\n       * [`init`](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters)\r\n       * of [non-navigation](https://github.com/GoogleChrome/workbox/issues/1796)\r\n       * `fetch()` requests made by this strategy.\r\n       * @param {number} [options.networkTimeoutSeconds] If set, any network requests\r\n       * that fail to respond within the timeout will result in a network error.\r\n       */\r\n      constructor(options = {}) {\r\n        super(options);\r\n        this._networkTimeoutSeconds = options.networkTimeoutSeconds || 0;\r\n      }\r\n      /**\r\n       * @private\r\n       * @param {Request|string} request A request to run this strategy for.\r\n       * @param {workbox-strategies.StrategyHandler} handler The event that\r\n       *     triggered the request.\r\n       * @return {Promise<Response>}\r\n       */\r\n      async _handle(request, handler) {\r\n        {\r\n          finalAssertExports.isInstance(request, Request, {\r\n            moduleName: 'workbox-strategies',\r\n            className: this.constructor.name,\r\n            funcName: '_handle',\r\n            paramName: 'request'\r\n          });\r\n        }\r\n        let error = undefined;\r\n        let response;\r\n        try {\r\n          const promises = [handler.fetch(request)];\r\n          if (this._networkTimeoutSeconds) {\r\n            const timeoutPromise = timeout(this._networkTimeoutSeconds * 1000);\r\n            promises.push(timeoutPromise);\r\n          }\r\n          response = await Promise.race(promises);\r\n          if (!response) {\r\n            throw new Error(`Timed out the network response after ` + `${this._networkTimeoutSeconds} seconds.`);\r\n          }\r\n        } catch (err) {\r\n          if (err instanceof Error) {\r\n            error = err;\r\n          }\r\n        }\r\n        {\r\n          logger.groupCollapsed(messages.strategyStart(this.constructor.name, request));\r\n          if (response) {\r\n            logger.log(`Got response from network.`);\r\n          } else {\r\n            logger.log(`Unable to get a response from the network.`);\r\n          }\r\n          messages.printFinalResponse(response);\r\n          logger.groupEnd();\r\n        }\r\n        if (!response) {\r\n          throw new WorkboxError('no-response', {\r\n            url: request.url,\r\n            error\r\n          });\r\n        }\r\n        return response;\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const cacheOkAndOpaquePlugin = {\r\n      /**\r\n       * Returns a valid response (to allow caching) if the status is 200 (OK) or\r\n       * 0 (opaque).\r\n       *\r\n       * @param {Object} options\r\n       * @param {Response} options.response\r\n       * @return {Response|null}\r\n       *\r\n       * @private\r\n       */\r\n      cacheWillUpdate: async ({\r\n        response\r\n      }) => {\r\n        if (response.status === 200 || response.status === 0) {\r\n          return response;\r\n        }\r\n        return null;\r\n      }\r\n    };\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * An implementation of a\r\n     * [stale-while-revalidate](https://developer.chrome.com/docs/workbox/caching-strategies-overview/#stale-while-revalidate)\r\n     * request strategy.\r\n     *\r\n     * Resources are requested from both the cache and the network in parallel.\r\n     * The strategy will respond with the cached version if available, otherwise\r\n     * wait for the network response. The cache is updated with the network response\r\n     * with each successful request.\r\n     *\r\n     * By default, this strategy will cache responses with a 200 status code as\r\n     * well as [opaque responses](https://developer.chrome.com/docs/workbox/caching-resources-during-runtime/#opaque-responses).\r\n     * Opaque responses are cross-origin requests where the response doesn't\r\n     * support [CORS](https://enable-cors.org/).\r\n     *\r\n     * If the network request fails, and there is no cache match, this will throw\r\n     * a `WorkboxError` exception.\r\n     *\r\n     * @extends workbox-strategies.Strategy\r\n     * @memberof workbox-strategies\r\n     */\r\n    class StaleWhileRevalidate extends Strategy {\r\n      /**\r\n       * @param {Object} [options]\r\n       * @param {string} [options.cacheName] Cache name to store and retrieve\r\n       * requests. Defaults to cache names provided by\r\n       * {@link workbox-core.cacheNames}.\r\n       * @param {Array<Object>} [options.plugins] [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}\r\n       * to use in conjunction with this caching strategy.\r\n       * @param {Object} [options.fetchOptions] Values passed along to the\r\n       * [`init`](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters)\r\n       * of [non-navigation](https://github.com/GoogleChrome/workbox/issues/1796)\r\n       * `fetch()` requests made by this strategy.\r\n       * @param {Object} [options.matchOptions] [`CacheQueryOptions`](https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions)\r\n       */\r\n      constructor(options = {}) {\r\n        super(options);\r\n        // If this instance contains no plugins with a 'cacheWillUpdate' callback,\r\n        // prepend the `cacheOkAndOpaquePlugin` plugin to the plugins list.\r\n        if (!this.plugins.some(p => 'cacheWillUpdate' in p)) {\r\n          this.plugins.unshift(cacheOkAndOpaquePlugin);\r\n        }\r\n      }\r\n      /**\r\n       * @private\r\n       * @param {Request|string} request A request to run this strategy for.\r\n       * @param {workbox-strategies.StrategyHandler} handler The event that\r\n       *     triggered the request.\r\n       * @return {Promise<Response>}\r\n       */\r\n      async _handle(request, handler) {\r\n        const logs = [];\r\n        {\r\n          finalAssertExports.isInstance(request, Request, {\r\n            moduleName: 'workbox-strategies',\r\n            className: this.constructor.name,\r\n            funcName: 'handle',\r\n            paramName: 'request'\r\n          });\r\n        }\r\n        const fetchAndCachePromise = handler.fetchAndCachePut(request).catch(() => {\r\n          // Swallow this error because a 'no-response' error will be thrown in\r\n          // main handler return flow. This will be in the `waitUntil()` flow.\r\n        });\r\n        void handler.waitUntil(fetchAndCachePromise);\r\n        let response = await handler.cacheMatch(request);\r\n        let error;\r\n        if (response) {\r\n          {\r\n            logs.push(`Found a cached response in the '${this.cacheName}'` + ` cache. Will update with the network response in the background.`);\r\n          }\r\n        } else {\r\n          {\r\n            logs.push(`No response found in the '${this.cacheName}' cache. ` + `Will wait for the network response.`);\r\n          }\r\n          try {\r\n            // NOTE(philipwalton): Really annoying that we have to type cast here.\r\n            // https://github.com/microsoft/TypeScript/issues/20006\r\n            response = await fetchAndCachePromise;\r\n          } catch (err) {\r\n            if (err instanceof Error) {\r\n              error = err;\r\n            }\r\n          }\r\n        }\r\n        {\r\n          logger.groupCollapsed(messages.strategyStart(this.constructor.name, request));\r\n          for (const log of logs) {\r\n            logger.log(log);\r\n          }\r\n          messages.printFinalResponse(response);\r\n          logger.groupEnd();\r\n        }\r\n        if (!response) {\r\n          throw new WorkboxError('no-response', {\r\n            url: request.url,\r\n            error\r\n          });\r\n        }\r\n        return response;\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Claim any currently available clients once the service worker\r\n     * becomes active. This is normally used in conjunction with `skipWaiting()`.\r\n     *\r\n     * @memberof workbox-core\r\n     */\r\n    function clientsClaim() {\r\n      self.addEventListener('activate', () => self.clients.claim());\r\n    }\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A utility method that makes it easier to use `event.waitUntil` with\r\n     * async functions and return the result.\r\n     *\r\n     * @param {ExtendableEvent} event\r\n     * @param {Function} asyncFn\r\n     * @return {Function}\r\n     * @private\r\n     */\r\n    function waitUntil(event, asyncFn) {\r\n      const returnPromise = asyncFn();\r\n      event.waitUntil(returnPromise);\r\n      return returnPromise;\r\n    }\r\n\r\n    // @ts-ignore\r\n    try {\r\n      self['workbox:precaching:7.3.0'] && _();\r\n    } catch (e) {}\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    // Name of the search parameter used to store revision info.\r\n    const REVISION_SEARCH_PARAM = '__WB_REVISION__';\r\n    /**\r\n     * Converts a manifest entry into a versioned URL suitable for precaching.\r\n     *\r\n     * @param {Object|string} entry\r\n     * @return {string} A URL with versioning info.\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    function createCacheKey(entry) {\r\n      if (!entry) {\r\n        throw new WorkboxError('add-to-cache-list-unexpected-type', {\r\n          entry\r\n        });\r\n      }\r\n      // If a precache manifest entry is a string, it's assumed to be a versioned\r\n      // URL, like '/app.abcd1234.js'. Return as-is.\r\n      if (typeof entry === 'string') {\r\n        const urlObject = new URL(entry, location.href);\r\n        return {\r\n          cacheKey: urlObject.href,\r\n          url: urlObject.href\r\n        };\r\n      }\r\n      const {\r\n        revision,\r\n        url\r\n      } = entry;\r\n      if (!url) {\r\n        throw new WorkboxError('add-to-cache-list-unexpected-type', {\r\n          entry\r\n        });\r\n      }\r\n      // If there's just a URL and no revision, then it's also assumed to be a\r\n      // versioned URL.\r\n      if (!revision) {\r\n        const urlObject = new URL(url, location.href);\r\n        return {\r\n          cacheKey: urlObject.href,\r\n          url: urlObject.href\r\n        };\r\n      }\r\n      // Otherwise, construct a properly versioned URL using the custom Workbox\r\n      // search parameter along with the revision info.\r\n      const cacheKeyURL = new URL(url, location.href);\r\n      const originalURL = new URL(url, location.href);\r\n      cacheKeyURL.searchParams.set(REVISION_SEARCH_PARAM, revision);\r\n      return {\r\n        cacheKey: cacheKeyURL.href,\r\n        url: originalURL.href\r\n      };\r\n    }\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A plugin, designed to be used with PrecacheController, to determine the\r\n     * of assets that were updated (or not updated) during the install event.\r\n     *\r\n     * @private\r\n     */\r\n    class PrecacheInstallReportPlugin {\r\n      constructor() {\r\n        this.updatedURLs = [];\r\n        this.notUpdatedURLs = [];\r\n        this.handlerWillStart = async ({\r\n          request,\r\n          state\r\n        }) => {\r\n          // TODO: `state` should never be undefined...\r\n          if (state) {\r\n            state.originalRequest = request;\r\n          }\r\n        };\r\n        this.cachedResponseWillBeUsed = async ({\r\n          event,\r\n          state,\r\n          cachedResponse\r\n        }) => {\r\n          if (event.type === 'install') {\r\n            if (state && state.originalRequest && state.originalRequest instanceof Request) {\r\n              // TODO: `state` should never be undefined...\r\n              const url = state.originalRequest.url;\r\n              if (cachedResponse) {\r\n                this.notUpdatedURLs.push(url);\r\n              } else {\r\n                this.updatedURLs.push(url);\r\n              }\r\n            }\r\n          }\r\n          return cachedResponse;\r\n        };\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A plugin, designed to be used with PrecacheController, to translate URLs into\r\n     * the corresponding cache key, based on the current revision info.\r\n     *\r\n     * @private\r\n     */\r\n    class PrecacheCacheKeyPlugin {\r\n      constructor({\r\n        precacheController\r\n      }) {\r\n        this.cacheKeyWillBeUsed = async ({\r\n          request,\r\n          params\r\n        }) => {\r\n          // Params is type any, can't change right now.\r\n           \r\n          const cacheKey = (params === null || params === void 0 ? void 0 : params.cacheKey) || this._precacheController.getCacheKeyForURL(request.url);\r\n           \r\n          return cacheKey ? new Request(cacheKey, {\r\n            headers: request.headers\r\n          }) : request;\r\n        };\r\n        this._precacheController = precacheController;\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * @param {string} groupTitle\r\n     * @param {Array<string>} deletedURLs\r\n     *\r\n     * @private\r\n     */\r\n    const logGroup = (groupTitle, deletedURLs) => {\r\n      logger.groupCollapsed(groupTitle);\r\n      for (const url of deletedURLs) {\r\n        logger.log(url);\r\n      }\r\n      logger.groupEnd();\r\n    };\r\n    /**\r\n     * @param {Array<string>} deletedURLs\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    function printCleanupDetails(deletedURLs) {\r\n      const deletionCount = deletedURLs.length;\r\n      if (deletionCount > 0) {\r\n        logger.groupCollapsed(`During precaching cleanup, ` + `${deletionCount} cached ` + `request${deletionCount === 1 ? ' was' : 's were'} deleted.`);\r\n        logGroup('Deleted Cache Requests', deletedURLs);\r\n        logger.groupEnd();\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * @param {string} groupTitle\r\n     * @param {Array<string>} urls\r\n     *\r\n     * @private\r\n     */\r\n    function _nestedGroup(groupTitle, urls) {\r\n      if (urls.length === 0) {\r\n        return;\r\n      }\r\n      logger.groupCollapsed(groupTitle);\r\n      for (const url of urls) {\r\n        logger.log(url);\r\n      }\r\n      logger.groupEnd();\r\n    }\r\n    /**\r\n     * @param {Array<string>} urlsToPrecache\r\n     * @param {Array<string>} urlsAlreadyPrecached\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    function printInstallDetails(urlsToPrecache, urlsAlreadyPrecached) {\r\n      const precachedCount = urlsToPrecache.length;\r\n      const alreadyPrecachedCount = urlsAlreadyPrecached.length;\r\n      if (precachedCount || alreadyPrecachedCount) {\r\n        let message = `Precaching ${precachedCount} file${precachedCount === 1 ? '' : 's'}.`;\r\n        if (alreadyPrecachedCount > 0) {\r\n          message += ` ${alreadyPrecachedCount} ` + `file${alreadyPrecachedCount === 1 ? ' is' : 's are'} already cached.`;\r\n        }\r\n        logger.groupCollapsed(message);\r\n        _nestedGroup(`View newly precached URLs.`, urlsToPrecache);\r\n        _nestedGroup(`View previously precached URLs.`, urlsAlreadyPrecached);\r\n        logger.groupEnd();\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    let supportStatus;\r\n    /**\r\n     * A utility function that determines whether the current browser supports\r\n     * constructing a new `Response` from a `response.body` stream.\r\n     *\r\n     * @return {boolean} `true`, if the current browser can successfully\r\n     *     construct a `Response` from a `response.body` stream, `false` otherwise.\r\n     *\r\n     * @private\r\n     */\r\n    function canConstructResponseFromBodyStream() {\r\n      if (supportStatus === undefined) {\r\n        const testResponse = new Response('');\r\n        if ('body' in testResponse) {\r\n          try {\r\n            new Response(testResponse.body);\r\n            supportStatus = true;\r\n          } catch (error) {\r\n            supportStatus = false;\r\n          }\r\n        }\r\n        supportStatus = false;\r\n      }\r\n      return supportStatus;\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Allows developers to copy a response and modify its `headers`, `status`,\r\n     * or `statusText` values (the values settable via a\r\n     * [`ResponseInit`]{@link https://developer.mozilla.org/en-US/docs/Web/API/Response/Response#Syntax}\r\n     * object in the constructor).\r\n     * To modify these values, pass a function as the second argument. That\r\n     * function will be invoked with a single object with the response properties\r\n     * `{headers, status, statusText}`. The return value of this function will\r\n     * be used as the `ResponseInit` for the new `Response`. To change the values\r\n     * either modify the passed parameter(s) and return it, or return a totally\r\n     * new object.\r\n     *\r\n     * This method is intentionally limited to same-origin responses, regardless of\r\n     * whether CORS was used or not.\r\n     *\r\n     * @param {Response} response\r\n     * @param {Function} modifier\r\n     * @memberof workbox-core\r\n     */\r\n    async function copyResponse(response, modifier) {\r\n      let origin = null;\r\n      // If response.url isn't set, assume it's cross-origin and keep origin null.\r\n      if (response.url) {\r\n        const responseURL = new URL(response.url);\r\n        origin = responseURL.origin;\r\n      }\r\n      if (origin !== self.location.origin) {\r\n        throw new WorkboxError('cross-origin-copy-response', {\r\n          origin\r\n        });\r\n      }\r\n      const clonedResponse = response.clone();\r\n      // Create a fresh `ResponseInit` object by cloning the headers.\r\n      const responseInit = {\r\n        headers: new Headers(clonedResponse.headers),\r\n        status: clonedResponse.status,\r\n        statusText: clonedResponse.statusText\r\n      };\r\n      // Apply any user modifications.\r\n      const modifiedResponseInit = modifier ? modifier(responseInit) : responseInit;\r\n      // Create the new response from the body stream and `ResponseInit`\r\n      // modifications. Note: not all browsers support the Response.body stream,\r\n      // so fall back to reading the entire body into memory as a blob.\r\n      const body = canConstructResponseFromBodyStream() ? clonedResponse.body : await clonedResponse.blob();\r\n      return new Response(body, modifiedResponseInit);\r\n    }\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A {@link workbox-strategies.Strategy} implementation\r\n     * specifically designed to work with\r\n     * {@link workbox-precaching.PrecacheController}\r\n     * to both cache and fetch precached assets.\r\n     *\r\n     * Note: an instance of this class is created automatically when creating a\r\n     * `PrecacheController`; it's generally not necessary to create this yourself.\r\n     *\r\n     * @extends workbox-strategies.Strategy\r\n     * @memberof workbox-precaching\r\n     */\r\n    class PrecacheStrategy extends Strategy {\r\n      /**\r\n       *\r\n       * @param {Object} [options]\r\n       * @param {string} [options.cacheName] Cache name to store and retrieve\r\n       * requests. Defaults to the cache names provided by\r\n       * {@link workbox-core.cacheNames}.\r\n       * @param {Array<Object>} [options.plugins] {@link https://developers.google.com/web/tools/workbox/guides/using-plugins|Plugins}\r\n       * to use in conjunction with this caching strategy.\r\n       * @param {Object} [options.fetchOptions] Values passed along to the\r\n       * {@link https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters|init}\r\n       * of all fetch() requests made by this strategy.\r\n       * @param {Object} [options.matchOptions] The\r\n       * {@link https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions|CacheQueryOptions}\r\n       * for any `cache.match()` or `cache.put()` calls made by this strategy.\r\n       * @param {boolean} [options.fallbackToNetwork=true] Whether to attempt to\r\n       * get the response from the network if there's a precache miss.\r\n       */\r\n      constructor(options = {}) {\r\n        options.cacheName = cacheNames.getPrecacheName(options.cacheName);\r\n        super(options);\r\n        this._fallbackToNetwork = options.fallbackToNetwork === false ? false : true;\r\n        // Redirected responses cannot be used to satisfy a navigation request, so\r\n        // any redirected response must be \"copied\" rather than cloned, so the new\r\n        // response doesn't contain the `redirected` flag. See:\r\n        // https://bugs.chromium.org/p/chromium/issues/detail?id=669363&desc=2#c1\r\n        this.plugins.push(PrecacheStrategy.copyRedirectedCacheableResponsesPlugin);\r\n      }\r\n      /**\r\n       * @private\r\n       * @param {Request|string} request A request to run this strategy for.\r\n       * @param {workbox-strategies.StrategyHandler} handler The event that\r\n       *     triggered the request.\r\n       * @return {Promise<Response>}\r\n       */\r\n      async _handle(request, handler) {\r\n        const response = await handler.cacheMatch(request);\r\n        if (response) {\r\n          return response;\r\n        }\r\n        // If this is an `install` event for an entry that isn't already cached,\r\n        // then populate the cache.\r\n        if (handler.event && handler.event.type === 'install') {\r\n          return await this._handleInstall(request, handler);\r\n        }\r\n        // Getting here means something went wrong. An entry that should have been\r\n        // precached wasn't found in the cache.\r\n        return await this._handleFetch(request, handler);\r\n      }\r\n      async _handleFetch(request, handler) {\r\n        let response;\r\n        const params = handler.params || {};\r\n        // Fall back to the network if we're configured to do so.\r\n        if (this._fallbackToNetwork) {\r\n          {\r\n            logger.warn(`The precached response for ` + `${getFriendlyURL(request.url)} in ${this.cacheName} was not ` + `found. Falling back to the network.`);\r\n          }\r\n          const integrityInManifest = params.integrity;\r\n          const integrityInRequest = request.integrity;\r\n          const noIntegrityConflict = !integrityInRequest || integrityInRequest === integrityInManifest;\r\n          // Do not add integrity if the original request is no-cors\r\n          // See https://github.com/GoogleChrome/workbox/issues/3096\r\n          response = await handler.fetch(new Request(request, {\r\n            integrity: request.mode !== 'no-cors' ? integrityInRequest || integrityInManifest : undefined\r\n          }));\r\n          // It's only \"safe\" to repair the cache if we're using SRI to guarantee\r\n          // that the response matches the precache manifest's expectations,\r\n          // and there's either a) no integrity property in the incoming request\r\n          // or b) there is an integrity, and it matches the precache manifest.\r\n          // See https://github.com/GoogleChrome/workbox/issues/2858\r\n          // Also if the original request users no-cors we don't use integrity.\r\n          // See https://github.com/GoogleChrome/workbox/issues/3096\r\n          if (integrityInManifest && noIntegrityConflict && request.mode !== 'no-cors') {\r\n            this._useDefaultCacheabilityPluginIfNeeded();\r\n            const wasCached = await handler.cachePut(request, response.clone());\r\n            {\r\n              if (wasCached) {\r\n                logger.log(`A response for ${getFriendlyURL(request.url)} ` + `was used to \"repair\" the precache.`);\r\n              }\r\n            }\r\n          }\r\n        } else {\r\n          // This shouldn't normally happen, but there are edge cases:\r\n          // https://github.com/GoogleChrome/workbox/issues/1441\r\n          throw new WorkboxError('missing-precache-entry', {\r\n            cacheName: this.cacheName,\r\n            url: request.url\r\n          });\r\n        }\r\n        {\r\n          const cacheKey = params.cacheKey || (await handler.getCacheKey(request, 'read'));\r\n          // Workbox is going to handle the route.\r\n          // print the routing details to the console.\r\n          logger.groupCollapsed(`Precaching is responding to: ` + getFriendlyURL(request.url));\r\n          logger.log(`Serving the precached url: ${getFriendlyURL(cacheKey instanceof Request ? cacheKey.url : cacheKey)}`);\r\n          logger.groupCollapsed(`View request details here.`);\r\n          logger.log(request);\r\n          logger.groupEnd();\r\n          logger.groupCollapsed(`View response details here.`);\r\n          logger.log(response);\r\n          logger.groupEnd();\r\n          logger.groupEnd();\r\n        }\r\n        return response;\r\n      }\r\n      async _handleInstall(request, handler) {\r\n        this._useDefaultCacheabilityPluginIfNeeded();\r\n        const response = await handler.fetch(request);\r\n        // Make sure we defer cachePut() until after we know the response\r\n        // should be cached; see https://github.com/GoogleChrome/workbox/issues/2737\r\n        const wasCached = await handler.cachePut(request, response.clone());\r\n        if (!wasCached) {\r\n          // Throwing here will lead to the `install` handler failing, which\r\n          // we want to do if *any* of the responses aren't safe to cache.\r\n          throw new WorkboxError('bad-precaching-response', {\r\n            url: request.url,\r\n            status: response.status\r\n          });\r\n        }\r\n        return response;\r\n      }\r\n      /**\r\n       * This method is complex, as there a number of things to account for:\r\n       *\r\n       * The `plugins` array can be set at construction, and/or it might be added to\r\n       * to at any time before the strategy is used.\r\n       *\r\n       * At the time the strategy is used (i.e. during an `install` event), there\r\n       * needs to be at least one plugin that implements `cacheWillUpdate` in the\r\n       * array, other than `copyRedirectedCacheableResponsesPlugin`.\r\n       *\r\n       * - If this method is called and there are no suitable `cacheWillUpdate`\r\n       * plugins, we need to add `defaultPrecacheCacheabilityPlugin`.\r\n       *\r\n       * - If this method is called and there is exactly one `cacheWillUpdate`, then\r\n       * we don't have to do anything (this might be a previously added\r\n       * `defaultPrecacheCacheabilityPlugin`, or it might be a custom plugin).\r\n       *\r\n       * - If this method is called and there is more than one `cacheWillUpdate`,\r\n       * then we need to check if one is `defaultPrecacheCacheabilityPlugin`. If so,\r\n       * we need to remove it. (This situation is unlikely, but it could happen if\r\n       * the strategy is used multiple times, the first without a `cacheWillUpdate`,\r\n       * and then later on after manually adding a custom `cacheWillUpdate`.)\r\n       *\r\n       * See https://github.com/GoogleChrome/workbox/issues/2737 for more context.\r\n       *\r\n       * @private\r\n       */\r\n      _useDefaultCacheabilityPluginIfNeeded() {\r\n        let defaultPluginIndex = null;\r\n        let cacheWillUpdatePluginCount = 0;\r\n        for (const [index, plugin] of this.plugins.entries()) {\r\n          // Ignore the copy redirected plugin when determining what to do.\r\n          if (plugin === PrecacheStrategy.copyRedirectedCacheableResponsesPlugin) {\r\n            continue;\r\n          }\r\n          // Save the default plugin's index, in case it needs to be removed.\r\n          if (plugin === PrecacheStrategy.defaultPrecacheCacheabilityPlugin) {\r\n            defaultPluginIndex = index;\r\n          }\r\n          if (plugin.cacheWillUpdate) {\r\n            cacheWillUpdatePluginCount++;\r\n          }\r\n        }\r\n        if (cacheWillUpdatePluginCount === 0) {\r\n          this.plugins.push(PrecacheStrategy.defaultPrecacheCacheabilityPlugin);\r\n        } else if (cacheWillUpdatePluginCount > 1 && defaultPluginIndex !== null) {\r\n          // Only remove the default plugin; multiple custom plugins are allowed.\r\n          this.plugins.splice(defaultPluginIndex, 1);\r\n        }\r\n        // Nothing needs to be done if cacheWillUpdatePluginCount is 1\r\n      }\r\n    }\r\n    PrecacheStrategy.defaultPrecacheCacheabilityPlugin = {\r\n      async cacheWillUpdate({\r\n        response\r\n      }) {\r\n        if (!response || response.status >= 400) {\r\n          return null;\r\n        }\r\n        return response;\r\n      }\r\n    };\r\n    PrecacheStrategy.copyRedirectedCacheableResponsesPlugin = {\r\n      async cacheWillUpdate({\r\n        response\r\n      }) {\r\n        return response.redirected ? await copyResponse(response) : response;\r\n      }\r\n    };\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Performs efficient precaching of assets.\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    class PrecacheController {\r\n      /**\r\n       * Create a new PrecacheController.\r\n       *\r\n       * @param {Object} [options]\r\n       * @param {string} [options.cacheName] The cache to use for precaching.\r\n       * @param {string} [options.plugins] Plugins to use when precaching as well\r\n       * as responding to fetch events for precached assets.\r\n       * @param {boolean} [options.fallbackToNetwork=true] Whether to attempt to\r\n       * get the response from the network if there's a precache miss.\r\n       */\r\n      constructor({\r\n        cacheName,\r\n        plugins = [],\r\n        fallbackToNetwork = true\r\n      } = {}) {\r\n        this._urlsToCacheKeys = new Map();\r\n        this._urlsToCacheModes = new Map();\r\n        this._cacheKeysToIntegrities = new Map();\r\n        this._strategy = new PrecacheStrategy({\r\n          cacheName: cacheNames.getPrecacheName(cacheName),\r\n          plugins: [...plugins, new PrecacheCacheKeyPlugin({\r\n            precacheController: this\r\n          })],\r\n          fallbackToNetwork\r\n        });\r\n        // Bind the install and activate methods to the instance.\r\n        this.install = this.install.bind(this);\r\n        this.activate = this.activate.bind(this);\r\n      }\r\n      /**\r\n       * @type {workbox-precaching.PrecacheStrategy} The strategy created by this controller and\r\n       * used to cache assets and respond to fetch events.\r\n       */\r\n      get strategy() {\r\n        return this._strategy;\r\n      }\r\n      /**\r\n       * Adds items to the precache list, removing any duplicates and\r\n       * stores the files in the\r\n       * {@link workbox-core.cacheNames|\"precache cache\"} when the service\r\n       * worker installs.\r\n       *\r\n       * This method can be called multiple times.\r\n       *\r\n       * @param {Array<Object|string>} [entries=[]] Array of entries to precache.\r\n       */\r\n      precache(entries) {\r\n        this.addToCacheList(entries);\r\n        if (!this._installAndActiveListenersAdded) {\r\n          self.addEventListener('install', this.install);\r\n          self.addEventListener('activate', this.activate);\r\n          this._installAndActiveListenersAdded = true;\r\n        }\r\n      }\r\n      /**\r\n       * This method will add items to the precache list, removing duplicates\r\n       * and ensuring the information is valid.\r\n       *\r\n       * @param {Array<workbox-precaching.PrecacheController.PrecacheEntry|string>} entries\r\n       *     Array of entries to precache.\r\n       */\r\n      addToCacheList(entries) {\r\n        {\r\n          finalAssertExports.isArray(entries, {\r\n            moduleName: 'workbox-precaching',\r\n            className: 'PrecacheController',\r\n            funcName: 'addToCacheList',\r\n            paramName: 'entries'\r\n          });\r\n        }\r\n        const urlsToWarnAbout = [];\r\n        for (const entry of entries) {\r\n          // See https://github.com/GoogleChrome/workbox/issues/2259\r\n          if (typeof entry === 'string') {\r\n            urlsToWarnAbout.push(entry);\r\n          } else if (entry && entry.revision === undefined) {\r\n            urlsToWarnAbout.push(entry.url);\r\n          }\r\n          const {\r\n            cacheKey,\r\n            url\r\n          } = createCacheKey(entry);\r\n          const cacheMode = typeof entry !== 'string' && entry.revision ? 'reload' : 'default';\r\n          if (this._urlsToCacheKeys.has(url) && this._urlsToCacheKeys.get(url) !== cacheKey) {\r\n            throw new WorkboxError('add-to-cache-list-conflicting-entries', {\r\n              firstEntry: this._urlsToCacheKeys.get(url),\r\n              secondEntry: cacheKey\r\n            });\r\n          }\r\n          if (typeof entry !== 'string' && entry.integrity) {\r\n            if (this._cacheKeysToIntegrities.has(cacheKey) && this._cacheKeysToIntegrities.get(cacheKey) !== entry.integrity) {\r\n              throw new WorkboxError('add-to-cache-list-conflicting-integrities', {\r\n                url\r\n              });\r\n            }\r\n            this._cacheKeysToIntegrities.set(cacheKey, entry.integrity);\r\n          }\r\n          this._urlsToCacheKeys.set(url, cacheKey);\r\n          this._urlsToCacheModes.set(url, cacheMode);\r\n          if (urlsToWarnAbout.length > 0) {\r\n            const warningMessage = `Workbox is precaching URLs without revision ` + `info: ${urlsToWarnAbout.join(', ')}\\nThis is generally NOT safe. ` + `Learn more at https://bit.ly/wb-precache`;\r\n            {\r\n              logger.warn(warningMessage);\r\n            }\r\n          }\r\n        }\r\n      }\r\n      /**\r\n       * Precaches new and updated assets. Call this method from the service worker\r\n       * install event.\r\n       *\r\n       * Note: this method calls `event.waitUntil()` for you, so you do not need\r\n       * to call it yourself in your event handlers.\r\n       *\r\n       * @param {ExtendableEvent} event\r\n       * @return {Promise<workbox-precaching.InstallResult>}\r\n       */\r\n      install(event) {\r\n        // waitUntil returns Promise<any>\r\n         \r\n        return waitUntil(event, async () => {\r\n          const installReportPlugin = new PrecacheInstallReportPlugin();\r\n          this.strategy.plugins.push(installReportPlugin);\r\n          // Cache entries one at a time.\r\n          // See https://github.com/GoogleChrome/workbox/issues/2528\r\n          for (const [url, cacheKey] of this._urlsToCacheKeys) {\r\n            const integrity = this._cacheKeysToIntegrities.get(cacheKey);\r\n            const cacheMode = this._urlsToCacheModes.get(url);\r\n            const request = new Request(url, {\r\n              integrity,\r\n              cache: cacheMode,\r\n              credentials: 'same-origin'\r\n            });\r\n            await Promise.all(this.strategy.handleAll({\r\n              params: {\r\n                cacheKey\r\n              },\r\n              request,\r\n              event\r\n            }));\r\n          }\r\n          const {\r\n            updatedURLs,\r\n            notUpdatedURLs\r\n          } = installReportPlugin;\r\n          {\r\n            printInstallDetails(updatedURLs, notUpdatedURLs);\r\n          }\r\n          return {\r\n            updatedURLs,\r\n            notUpdatedURLs\r\n          };\r\n        });\r\n      }\r\n      /**\r\n       * Deletes assets that are no longer present in the current precache manifest.\r\n       * Call this method from the service worker activate event.\r\n       *\r\n       * Note: this method calls `event.waitUntil()` for you, so you do not need\r\n       * to call it yourself in your event handlers.\r\n       *\r\n       * @param {ExtendableEvent} event\r\n       * @return {Promise<workbox-precaching.CleanupResult>}\r\n       */\r\n      activate(event) {\r\n        // waitUntil returns Promise<any>\r\n         \r\n        return waitUntil(event, async () => {\r\n          const cache = await self.caches.open(this.strategy.cacheName);\r\n          const currentlyCachedRequests = await cache.keys();\r\n          const expectedCacheKeys = new Set(this._urlsToCacheKeys.values());\r\n          const deletedURLs = [];\r\n          for (const request of currentlyCachedRequests) {\r\n            if (!expectedCacheKeys.has(request.url)) {\r\n              await cache.delete(request);\r\n              deletedURLs.push(request.url);\r\n            }\r\n          }\r\n          {\r\n            printCleanupDetails(deletedURLs);\r\n          }\r\n          return {\r\n            deletedURLs\r\n          };\r\n        });\r\n      }\r\n      /**\r\n       * Returns a mapping of a precached URL to the corresponding cache key, taking\r\n       * into account the revision information for the URL.\r\n       *\r\n       * @return {Map<string, string>} A URL to cache key mapping.\r\n       */\r\n      getURLsToCacheKeys() {\r\n        return this._urlsToCacheKeys;\r\n      }\r\n      /**\r\n       * Returns a list of all the URLs that have been precached by the current\r\n       * service worker.\r\n       *\r\n       * @return {Array<string>} The precached URLs.\r\n       */\r\n      getCachedURLs() {\r\n        return [...this._urlsToCacheKeys.keys()];\r\n      }\r\n      /**\r\n       * Returns the cache key used for storing a given URL. If that URL is\r\n       * unversioned, like `/index.html', then the cache key will be the original\r\n       * URL with a search parameter appended to it.\r\n       *\r\n       * @param {string} url A URL whose cache key you want to look up.\r\n       * @return {string} The versioned URL that corresponds to a cache key\r\n       * for the original URL, or undefined if that URL isn't precached.\r\n       */\r\n      getCacheKeyForURL(url) {\r\n        const urlObject = new URL(url, location.href);\r\n        return this._urlsToCacheKeys.get(urlObject.href);\r\n      }\r\n      /**\r\n       * @param {string} url A cache key whose SRI you want to look up.\r\n       * @return {string} The subresource integrity associated with the cache key,\r\n       * or undefined if it's not set.\r\n       */\r\n      getIntegrityForCacheKey(cacheKey) {\r\n        return this._cacheKeysToIntegrities.get(cacheKey);\r\n      }\r\n      /**\r\n       * This acts as a drop-in replacement for\r\n       * [`cache.match()`](https://developer.mozilla.org/en-US/docs/Web/API/Cache/match)\r\n       * with the following differences:\r\n       *\r\n       * - It knows what the name of the precache is, and only checks in that cache.\r\n       * - It allows you to pass in an \"original\" URL without versioning parameters,\r\n       * and it will automatically look up the correct cache key for the currently\r\n       * active revision of that URL.\r\n       *\r\n       * E.g., `matchPrecache('index.html')` will find the correct precached\r\n       * response for the currently active service worker, even if the actual cache\r\n       * key is `'/index.html?__WB_REVISION__=1234abcd'`.\r\n       *\r\n       * @param {string|Request} request The key (without revisioning parameters)\r\n       * to look up in the precache.\r\n       * @return {Promise<Response|undefined>}\r\n       */\r\n      async matchPrecache(request) {\r\n        const url = request instanceof Request ? request.url : request;\r\n        const cacheKey = this.getCacheKeyForURL(url);\r\n        if (cacheKey) {\r\n          const cache = await self.caches.open(this.strategy.cacheName);\r\n          return cache.match(cacheKey);\r\n        }\r\n        return undefined;\r\n      }\r\n      /**\r\n       * Returns a function that looks up `url` in the precache (taking into\r\n       * account revision information), and returns the corresponding `Response`.\r\n       *\r\n       * @param {string} url The precached URL which will be used to lookup the\r\n       * `Response`.\r\n       * @return {workbox-routing~handlerCallback}\r\n       */\r\n      createHandlerBoundToURL(url) {\r\n        const cacheKey = this.getCacheKeyForURL(url);\r\n        if (!cacheKey) {\r\n          throw new WorkboxError('non-precached-url', {\r\n            url\r\n          });\r\n        }\r\n        return options => {\r\n          options.request = new Request(url);\r\n          options.params = Object.assign({\r\n            cacheKey\r\n          }, options.params);\r\n          return this.strategy.handle(options);\r\n        };\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    let precacheController;\r\n    /**\r\n     * @return {PrecacheController}\r\n     * @private\r\n     */\r\n    const getOrCreatePrecacheController = () => {\r\n      if (!precacheController) {\r\n        precacheController = new PrecacheController();\r\n      }\r\n      return precacheController;\r\n    };\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Removes any URL search parameters that should be ignored.\r\n     *\r\n     * @param {URL} urlObject The original URL.\r\n     * @param {Array<RegExp>} ignoreURLParametersMatching RegExps to test against\r\n     * each search parameter name. Matches mean that the search parameter should be\r\n     * ignored.\r\n     * @return {URL} The URL with any ignored search parameters removed.\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    function removeIgnoredSearchParams(urlObject, ignoreURLParametersMatching = []) {\r\n      // Convert the iterable into an array at the start of the loop to make sure\r\n      // deletion doesn't mess up iteration.\r\n      for (const paramName of [...urlObject.searchParams.keys()]) {\r\n        if (ignoreURLParametersMatching.some(regExp => regExp.test(paramName))) {\r\n          urlObject.searchParams.delete(paramName);\r\n        }\r\n      }\r\n      return urlObject;\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Generator function that yields possible variations on the original URL to\r\n     * check, one at a time.\r\n     *\r\n     * @param {string} url\r\n     * @param {Object} options\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    function* generateURLVariations(url, {\r\n      ignoreURLParametersMatching = [/^utm_/, /^fbclid$/],\r\n      directoryIndex = 'index.html',\r\n      cleanURLs = true,\r\n      urlManipulation\r\n    } = {}) {\r\n      const urlObject = new URL(url, location.href);\r\n      urlObject.hash = '';\r\n      yield urlObject.href;\r\n      const urlWithoutIgnoredParams = removeIgnoredSearchParams(urlObject, ignoreURLParametersMatching);\r\n      yield urlWithoutIgnoredParams.href;\r\n      if (directoryIndex && urlWithoutIgnoredParams.pathname.endsWith('/')) {\r\n        const directoryURL = new URL(urlWithoutIgnoredParams.href);\r\n        directoryURL.pathname += directoryIndex;\r\n        yield directoryURL.href;\r\n      }\r\n      if (cleanURLs) {\r\n        const cleanURL = new URL(urlWithoutIgnoredParams.href);\r\n        cleanURL.pathname += '.html';\r\n        yield cleanURL.href;\r\n      }\r\n      if (urlManipulation) {\r\n        const additionalURLs = urlManipulation({\r\n          url: urlObject\r\n        });\r\n        for (const urlToAttempt of additionalURLs) {\r\n          yield urlToAttempt.href;\r\n        }\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A subclass of {@link workbox-routing.Route} that takes a\r\n     * {@link workbox-precaching.PrecacheController}\r\n     * instance and uses it to match incoming requests and handle fetching\r\n     * responses from the precache.\r\n     *\r\n     * @memberof workbox-precaching\r\n     * @extends workbox-routing.Route\r\n     */\r\n    class PrecacheRoute extends Route {\r\n      /**\r\n       * @param {PrecacheController} precacheController A `PrecacheController`\r\n       * instance used to both match requests and respond to fetch events.\r\n       * @param {Object} [options] Options to control how requests are matched\r\n       * against the list of precached URLs.\r\n       * @param {string} [options.directoryIndex=index.html] The `directoryIndex` will\r\n       * check cache entries for a URLs ending with '/' to see if there is a hit when\r\n       * appending the `directoryIndex` value.\r\n       * @param {Array<RegExp>} [options.ignoreURLParametersMatching=[/^utm_/, /^fbclid$/]] An\r\n       * array of regex's to remove search params when looking for a cache match.\r\n       * @param {boolean} [options.cleanURLs=true] The `cleanURLs` option will\r\n       * check the cache for the URL with a `.html` added to the end of the end.\r\n       * @param {workbox-precaching~urlManipulation} [options.urlManipulation]\r\n       * This is a function that should take a URL and return an array of\r\n       * alternative URLs that should be checked for precache matches.\r\n       */\r\n      constructor(precacheController, options) {\r\n        const match = ({\r\n          request\r\n        }) => {\r\n          const urlsToCacheKeys = precacheController.getURLsToCacheKeys();\r\n          for (const possibleURL of generateURLVariations(request.url, options)) {\r\n            const cacheKey = urlsToCacheKeys.get(possibleURL);\r\n            if (cacheKey) {\r\n              const integrity = precacheController.getIntegrityForCacheKey(cacheKey);\r\n              return {\r\n                cacheKey,\r\n                integrity\r\n              };\r\n            }\r\n          }\r\n          {\r\n            logger.debug(`Precaching did not find a match for ` + getFriendlyURL(request.url));\r\n          }\r\n          return;\r\n        };\r\n        super(match, precacheController.strategy);\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Add a `fetch` listener to the service worker that will\r\n     * respond to\r\n     * [network requests]{@link https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers#Custom_responses_to_requests}\r\n     * with precached assets.\r\n     *\r\n     * Requests for assets that aren't precached, the `FetchEvent` will not be\r\n     * responded to, allowing the event to fall through to other `fetch` event\r\n     * listeners.\r\n     *\r\n     * @param {Object} [options] See the {@link workbox-precaching.PrecacheRoute}\r\n     * options.\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    function addRoute(options) {\r\n      const precacheController = getOrCreatePrecacheController();\r\n      const precacheRoute = new PrecacheRoute(precacheController, options);\r\n      registerRoute(precacheRoute);\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Adds items to the precache list, removing any duplicates and\r\n     * stores the files in the\r\n     * {@link workbox-core.cacheNames|\"precache cache\"} when the service\r\n     * worker installs.\r\n     *\r\n     * This method can be called multiple times.\r\n     *\r\n     * Please note: This method **will not** serve any of the cached files for you.\r\n     * It only precaches files. To respond to a network request you call\r\n     * {@link workbox-precaching.addRoute}.\r\n     *\r\n     * If you have a single array of files to precache, you can just call\r\n     * {@link workbox-precaching.precacheAndRoute}.\r\n     *\r\n     * @param {Array<Object|string>} [entries=[]] Array of entries to precache.\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    function precache(entries) {\r\n      const precacheController = getOrCreatePrecacheController();\r\n      precacheController.precache(entries);\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * This method will add entries to the precache list and add a route to\r\n     * respond to fetch events.\r\n     *\r\n     * This is a convenience method that will call\r\n     * {@link workbox-precaching.precache} and\r\n     * {@link workbox-precaching.addRoute} in a single call.\r\n     *\r\n     * @param {Array<Object|string>} entries Array of entries to precache.\r\n     * @param {Object} [options] See the\r\n     * {@link workbox-precaching.PrecacheRoute} options.\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    function precacheAndRoute(entries, options) {\r\n      precache(entries);\r\n      addRoute(options);\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const SUBSTRING_TO_FIND = '-precache-';\r\n    /**\r\n     * Cleans up incompatible precaches that were created by older versions of\r\n     * Workbox, by a service worker registered under the current scope.\r\n     *\r\n     * This is meant to be called as part of the `activate` event.\r\n     *\r\n     * This should be safe to use as long as you don't include `substringToFind`\r\n     * (defaulting to `-precache-`) in your non-precache cache names.\r\n     *\r\n     * @param {string} currentPrecacheName The cache name currently in use for\r\n     * precaching. This cache won't be deleted.\r\n     * @param {string} [substringToFind='-precache-'] Cache names which include this\r\n     * substring will be deleted (excluding `currentPrecacheName`).\r\n     * @return {Array<string>} A list of all the cache names that were deleted.\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    const deleteOutdatedCaches = async (currentPrecacheName, substringToFind = SUBSTRING_TO_FIND) => {\r\n      const cacheNames = await self.caches.keys();\r\n      const cacheNamesToDelete = cacheNames.filter(cacheName => {\r\n        return cacheName.includes(substringToFind) && cacheName.includes(self.registration.scope) && cacheName !== currentPrecacheName;\r\n      });\r\n      await Promise.all(cacheNamesToDelete.map(cacheName => self.caches.delete(cacheName)));\r\n      return cacheNamesToDelete;\r\n    };\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Adds an `activate` event listener which will clean up incompatible\r\n     * precaches that were created by older versions of Workbox.\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    function cleanupOutdatedCaches() {\r\n      // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705\r\n      self.addEventListener('activate', event => {\r\n        const cacheName = cacheNames.getPrecacheName();\r\n        event.waitUntil(deleteOutdatedCaches(cacheName).then(cachesDeleted => {\r\n          {\r\n            if (cachesDeleted.length > 0) {\r\n              logger.log(`The following out-of-date precaches were cleaned up ` + `automatically:`, cachesDeleted);\r\n            }\r\n          }\r\n        }));\r\n      });\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * NavigationRoute makes it easy to create a\r\n     * {@link workbox-routing.Route} that matches for browser\r\n     * [navigation requests]{@link https://developers.google.com/web/fundamentals/primers/service-workers/high-performance-loading#first_what_are_navigation_requests}.\r\n     *\r\n     * It will only match incoming Requests whose\r\n     * {@link https://fetch.spec.whatwg.org/#concept-request-mode|mode}\r\n     * is set to `navigate`.\r\n     *\r\n     * You can optionally only apply this route to a subset of navigation requests\r\n     * by using one or both of the `denylist` and `allowlist` parameters.\r\n     *\r\n     * @memberof workbox-routing\r\n     * @extends workbox-routing.Route\r\n     */\r\n    class NavigationRoute extends Route {\r\n      /**\r\n       * If both `denylist` and `allowlist` are provided, the `denylist` will\r\n       * take precedence and the request will not match this route.\r\n       *\r\n       * The regular expressions in `allowlist` and `denylist`\r\n       * are matched against the concatenated\r\n       * [`pathname`]{@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLHyperlinkElementUtils/pathname}\r\n       * and [`search`]{@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLHyperlinkElementUtils/search}\r\n       * portions of the requested URL.\r\n       *\r\n       * *Note*: These RegExps may be evaluated against every destination URL during\r\n       * a navigation. Avoid using\r\n       * [complex RegExps](https://github.com/GoogleChrome/workbox/issues/3077),\r\n       * or else your users may see delays when navigating your site.\r\n       *\r\n       * @param {workbox-routing~handlerCallback} handler A callback\r\n       * function that returns a Promise resulting in a Response.\r\n       * @param {Object} options\r\n       * @param {Array<RegExp>} [options.denylist] If any of these patterns match,\r\n       * the route will not handle the request (even if a allowlist RegExp matches).\r\n       * @param {Array<RegExp>} [options.allowlist=[/./]] If any of these patterns\r\n       * match the URL's pathname and search parameter, the route will handle the\r\n       * request (assuming the denylist doesn't match).\r\n       */\r\n      constructor(handler, {\r\n        allowlist = [/./],\r\n        denylist = []\r\n      } = {}) {\r\n        {\r\n          finalAssertExports.isArrayOfClass(allowlist, RegExp, {\r\n            moduleName: 'workbox-routing',\r\n            className: 'NavigationRoute',\r\n            funcName: 'constructor',\r\n            paramName: 'options.allowlist'\r\n          });\r\n          finalAssertExports.isArrayOfClass(denylist, RegExp, {\r\n            moduleName: 'workbox-routing',\r\n            className: 'NavigationRoute',\r\n            funcName: 'constructor',\r\n            paramName: 'options.denylist'\r\n          });\r\n        }\r\n        super(options => this._match(options), handler);\r\n        this._allowlist = allowlist;\r\n        this._denylist = denylist;\r\n      }\r\n      /**\r\n       * Routes match handler.\r\n       *\r\n       * @param {Object} options\r\n       * @param {URL} options.url\r\n       * @param {Request} options.request\r\n       * @return {boolean}\r\n       *\r\n       * @private\r\n       */\r\n      _match({\r\n        url,\r\n        request\r\n      }) {\r\n        if (request && request.mode !== 'navigate') {\r\n          return false;\r\n        }\r\n        const pathnameAndSearch = url.pathname + url.search;\r\n        for (const regExp of this._denylist) {\r\n          if (regExp.test(pathnameAndSearch)) {\r\n            {\r\n              logger.log(`The navigation route ${pathnameAndSearch} is not ` + `being used, since the URL matches this denylist pattern: ` + `${regExp.toString()}`);\r\n            }\r\n            return false;\r\n          }\r\n        }\r\n        if (this._allowlist.some(regExp => regExp.test(pathnameAndSearch))) {\r\n          {\r\n            logger.debug(`The navigation route ${pathnameAndSearch} ` + `is being used.`);\r\n          }\r\n          return true;\r\n        }\r\n        {\r\n          logger.log(`The navigation route ${pathnameAndSearch} is not ` + `being used, since the URL being navigated to doesn't ` + `match the allowlist.`);\r\n        }\r\n        return false;\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Helper function that calls\r\n     * {@link PrecacheController#createHandlerBoundToURL} on the default\r\n     * {@link PrecacheController} instance.\r\n     *\r\n     * If you are creating your own {@link PrecacheController}, then call the\r\n     * {@link PrecacheController#createHandlerBoundToURL} on that instance,\r\n     * instead of using this function.\r\n     *\r\n     * @param {string} url The precached URL which will be used to lookup the\r\n     * `Response`.\r\n     * @param {boolean} [fallbackToNetwork=true] Whether to attempt to get the\r\n     * response from the network if there's a precache miss.\r\n     * @return {workbox-routing~handlerCallback}\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    function createHandlerBoundToURL(url) {\r\n      const precacheController = getOrCreatePrecacheController();\r\n      return precacheController.createHandlerBoundToURL(url);\r\n    }\r\n\r\n    exports.CacheFirst = CacheFirst;\r\n    exports.ExpirationPlugin = ExpirationPlugin;\r\n    exports.NavigationRoute = NavigationRoute;\r\n    exports.NetworkOnly = NetworkOnly;\r\n    exports.StaleWhileRevalidate = StaleWhileRevalidate;\r\n    exports.cleanupOutdatedCaches = cleanupOutdatedCaches;\r\n    exports.clientsClaim = clientsClaim;\r\n    exports.createHandlerBoundToURL = createHandlerBoundToURL;\r\n    exports.precacheAndRoute = precacheAndRoute;\r\n    exports.registerRoute = registerRoute;\r\n\r\n}));\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\dev-dist\\workbox-ffd35893.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'define' is not defined.","line":1,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":1,"endColumn":7},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":3,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":3,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[63,76],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":2,"message":"Expected an assignment or function call and instead saw an expression.","line":5,"column":7,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":5,"endColumn":41},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":5,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":5,"endColumn":11},{"ruleId":"no-undef","severity":2,"message":"'_' is not defined.","line":5,"column":37,"nodeType":"Identifier","messageId":"undef","endLine":5,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":6,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":15},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":6,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":6,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[148,148],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":22,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":22,"endColumn":11},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":22,"column":47,"nodeType":"Identifier","messageId":"undef","endLine":22,"endColumn":51},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":35,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":35,"endColumn":13},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":47,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":47,"endColumn":17},{"ruleId":"no-undef","severity":2,"message":"'navigator' is not defined.","line":53,"column":53,"nodeType":"Identifier","messageId":"undef","endLine":53,"endColumn":62},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":54,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":54,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":61,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":61,"endColumn":16},{"ruleId":"@typescript-eslint/ban-types","message":"Definition for rule '@typescript-eslint/ban-types' was not found.","line":69,"column":7,"endLine":69,"endColumn":63,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/ban-types","message":"Definition for rule '@typescript-eslint/ban-types' was not found.","line":436,"column":5,"endLine":436,"endColumn":61,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":473,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":473,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[18330,18343],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":2,"message":"Expected an assignment or function call and instead saw an expression.","line":475,"column":7,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":475,"endColumn":44},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":475,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":475,"endColumn":11},{"ruleId":"no-undef","severity":2,"message":"'_' is not defined.","line":475,"column":40,"nodeType":"Identifier","messageId":"undef","endLine":475,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":476,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":476,"endColumn":15},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":476,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":476,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[18418,18418],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":654,"column":30,"nodeType":"Identifier","messageId":"undef","endLine":654,"endColumn":38},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":678,"column":26,"nodeType":"Identifier","messageId":"undef","endLine":678,"endColumn":29},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":678,"column":43,"nodeType":"Identifier","messageId":"undef","endLine":678,"endColumn":51},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":681,"column":49,"nodeType":"Identifier","messageId":"undef","endLine":681,"endColumn":57},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":730,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":730,"endColumn":13},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":767,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":767,"endColumn":13},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":782,"column":35,"nodeType":"Identifier","messageId":"undef","endLine":782,"endColumn":42},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":816,"column":50,"nodeType":"Identifier","messageId":"undef","endLine":816,"endColumn":57},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":823,"column":25,"nodeType":"Identifier","messageId":"undef","endLine":823,"endColumn":28},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":823,"column":42,"nodeType":"Identifier","messageId":"undef","endLine":823,"endColumn":50},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":830,"column":43,"nodeType":"Identifier","messageId":"undef","endLine":830,"endColumn":51},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":1152,"column":32,"nodeType":"Identifier","messageId":"undef","endLine":1152,"endColumn":35},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":1152,"column":45,"nodeType":"Identifier","messageId":"undef","endLine":1152,"endColumn":53},{"ruleId":"no-undef","severity":2,"message":"'registration' is not defined.","line":1214,"column":53,"nodeType":"Identifier","messageId":"undef","endLine":1214,"endColumn":65},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":1270,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":1270,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[48179,48192],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":2,"message":"Expected an assignment or function call and instead saw an expression.","line":1272,"column":7,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1272,"endColumn":47},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":1272,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":1272,"endColumn":11},{"ruleId":"no-undef","severity":2,"message":"'_' is not defined.","line":1272,"column":43,"nodeType":"Identifier","messageId":"undef","endLine":1272,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":1273,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":1273,"endColumn":15},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1273,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1273,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[48270,48270],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":1302,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":1302,"endColumn":34},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":1302,"column":42,"nodeType":"Identifier","messageId":"undef","endLine":1302,"endColumn":50},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":1320,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":1320,"endColumn":34},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":1320,"column":40,"nodeType":"Identifier","messageId":"undef","endLine":1320,"endColumn":48},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":1328,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":1328,"endColumn":34},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":1328,"column":40,"nodeType":"Identifier","messageId":"undef","endLine":1328,"endColumn":48},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":1329,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":1329,"endColumn":34},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":1329,"column":40,"nodeType":"Identifier","messageId":"undef","endLine":1329,"endColumn":48},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":1369,"column":84,"nodeType":"Identifier","messageId":"undef","endLine":1369,"endColumn":91},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":1409,"column":33,"nodeType":"Identifier","messageId":"undef","endLine":1409,"endColumn":40},{"ruleId":"no-undef","severity":2,"message":"'Response' is not defined.","line":1516,"column":34,"nodeType":"Identifier","messageId":"undef","endLine":1516,"endColumn":42},{"ruleId":"no-undef","severity":2,"message":"'Response' is not defined.","line":1519,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":1519,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":1521,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":1521,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":1560,"column":33,"nodeType":"Identifier","messageId":"undef","endLine":1560,"endColumn":36},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":1563,"column":22,"nodeType":"Identifier","messageId":"undef","endLine":1563,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'Headers' is not defined.","line":1571,"column":22,"nodeType":"Identifier","messageId":"undef","endLine":1571,"endColumn":29},{"ruleId":"no-undef","severity":2,"message":"'Response' is not defined.","line":1581,"column":18,"nodeType":"Identifier","messageId":"undef","endLine":1581,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":1591,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":1591,"endColumn":34},{"ruleId":"@typescript-eslint/ban-types","message":"Definition for rule '@typescript-eslint/ban-types' was not found.","line":1665,"column":5,"endLine":1665,"endColumn":61,"severity":2,"nodeType":null},{"ruleId":"no-undef","severity":2,"message":"'setTimeout' is not defined.","line":1712,"column":37,"nodeType":"Identifier","messageId":"undef","endLine":1712,"endColumn":47},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":1715,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":1715,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[63252,63265],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":2,"message":"Expected an assignment or function call and instead saw an expression.","line":1717,"column":7,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":1717,"endColumn":47},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":1717,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":1717,"endColumn":11},{"ruleId":"no-undef","severity":2,"message":"'_' is not defined.","line":1717,"column":43,"nodeType":"Identifier","messageId":"undef","endLine":1717,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":1718,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":1718,"endColumn":15},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1718,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1718,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[63343,63343],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":1728,"column":46,"nodeType":"Identifier","messageId":"undef","endLine":1728,"endColumn":53},{"ruleId":"no-undef","severity":2,"message":"'ExtendableEvent' is not defined.","line":1796,"column":56,"nodeType":"Identifier","messageId":"undef","endLine":1796,"endColumn":71},{"ruleId":"no-undef","severity":2,"message":"'FetchEvent' is not defined.","line":1835,"column":61,"nodeType":"Identifier","messageId":"undef","endLine":1835,"endColumn":71},{"ruleId":"no-undef","severity":2,"message":"'fetch' is not defined.","line":1869,"column":33,"nodeType":"Identifier","messageId":"undef","endLine":1869,"endColumn":38},{"ruleId":"no-constant-condition","severity":2,"message":"Unexpected constant condition.","line":1870,"column":15,"nodeType":"BinaryExpression","messageId":"unexpected","endLine":1870,"endColumn":45},{"ruleId":"no-undef","severity":2,"message":"'caches' is not defined.","line":1937,"column":32,"nodeType":"Identifier","messageId":"undef","endLine":1937,"endColumn":38},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":2009,"column":29,"nodeType":"Identifier","messageId":"undef","endLine":2009,"endColumn":33},{"ruleId":"no-undef","severity":2,"message":"'FetchEvent' is not defined.","line":2336,"column":32,"nodeType":"Identifier","messageId":"undef","endLine":2336,"endColumn":42},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":2343,"column":67,"nodeType":"Identifier","messageId":"undef","endLine":2343,"endColumn":74},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":2404,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":2404,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":2532,"column":46,"nodeType":"Identifier","messageId":"undef","endLine":2532,"endColumn":53},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":2564,"column":87,"nodeType":"Identifier","messageId":"undef","endLine":2564,"endColumn":94},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":2723,"column":11,"nodeType":"Identifier","messageId":"undef","endLine":2723,"endColumn":15},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":2724,"column":11,"nodeType":"Identifier","messageId":"undef","endLine":2724,"endColumn":15},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":2802,"column":33,"nodeType":"Identifier","messageId":"undef","endLine":2802,"endColumn":40},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":2842,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":2842,"endColumn":35},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":2888,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":2888,"endColumn":34},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":2888,"column":40,"nodeType":"Identifier","messageId":"undef","endLine":2888,"endColumn":48},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":2918,"column":40,"nodeType":"Identifier","messageId":"undef","endLine":2918,"endColumn":47},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":2921,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":2921,"endColumn":35},{"ruleId":"no-undef","severity":2,"message":"'Request' is not defined.","line":2942,"column":33,"nodeType":"Identifier","messageId":"undef","endLine":2942,"endColumn":40},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":3023,"column":29,"nodeType":"Identifier","messageId":"undef","endLine":3023,"endColumn":32},{"ruleId":"no-undef","severity":2,"message":"'location' is not defined.","line":3023,"column":38,"nodeType":"Identifier","messageId":"undef","endLine":3023,"endColumn":46},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":3029,"column":34,"nodeType":"Identifier","messageId":"undef","endLine":3029,"endColumn":37},{"ruleId":"no-undef","severity":2,"message":"'URL' is not defined.","line":3034,"column":30,"nodeType":"Identifier","messageId":"undef","endLine":3034,"endColumn":33},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":3216,"column":32,"nodeType":"Identifier","messageId":"undef","endLine":3216,"endColumn":36},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":3218,"column":74,"nodeType":"Identifier","messageId":"undef","endLine":3218,"endColumn":78},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":3220,"column":61,"nodeType":"Identifier","messageId":"undef","endLine":3220,"endColumn":65},{"ruleId":"no-undef","severity":2,"message":"'self' is not defined.","line":3239,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":3239,"endColumn":11}],"suppressedMessages":[],"errorCount":97,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"define(['exports'], (function (exports) { 'use strict';\r\n\r\n    // @ts-ignore\r\n    try {\r\n      self['workbox:core:7.3.0'] && _();\r\n    } catch (e) {}\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Claim any currently available clients once the service worker\r\n     * becomes active. This is normally used in conjunction with `skipWaiting()`.\r\n     *\r\n     * @memberof workbox-core\r\n     */\r\n    function clientsClaim() {\r\n      self.addEventListener('activate', () => self.clients.claim());\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const logger = (() => {\r\n      // Don't overwrite this value if it's already set.\r\n      // See https://github.com/GoogleChrome/workbox/pull/2284#issuecomment-560470923\r\n      if (!('__WB_DISABLE_DEV_LOGS' in globalThis)) {\r\n        self.__WB_DISABLE_DEV_LOGS = false;\r\n      }\r\n      let inGroup = false;\r\n      const methodToColorMap = {\r\n        debug: `#7f8c8d`,\r\n        log: `#2ecc71`,\r\n        warn: `#f39c12`,\r\n        error: `#c0392b`,\r\n        groupCollapsed: `#3498db`,\r\n        groupEnd: null // No colored prefix on groupEnd\r\n      };\r\n      const print = function (method, args) {\r\n        if (self.__WB_DISABLE_DEV_LOGS) {\r\n          return;\r\n        }\r\n        if (method === 'groupCollapsed') {\r\n          // Safari doesn't print all console.groupCollapsed() arguments:\r\n          // https://bugs.webkit.org/show_bug.cgi?id=182754\r\n          if (/^((?!chrome|android).)*safari/i.test(navigator.userAgent)) {\r\n            console[method](...args);\r\n            return;\r\n          }\r\n        }\r\n        const styles = [`background: ${methodToColorMap[method]}`, `border-radius: 0.5em`, `color: white`, `font-weight: bold`, `padding: 2px 0.5em`];\r\n        // When in a group, the workbox prefix is not displayed.\r\n        const logPrefix = inGroup ? [] : ['%cworkbox', styles.join(';')];\r\n        console[method](...logPrefix, ...args);\r\n        if (method === 'groupCollapsed') {\r\n          inGroup = true;\r\n        }\r\n        if (method === 'groupEnd') {\r\n          inGroup = false;\r\n        }\r\n      };\r\n      // eslint-disable-next-line @typescript-eslint/ban-types\r\n      const api = {};\r\n      const loggerMethods = Object.keys(methodToColorMap);\r\n      for (const key of loggerMethods) {\r\n        const method = key;\r\n        api[method] = (...args) => {\r\n          print(method, args);\r\n        };\r\n      }\r\n      return api;\r\n    })();\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const messages = {\r\n      'invalid-value': ({\r\n        paramName,\r\n        validValueDescription,\r\n        value\r\n      }) => {\r\n        if (!paramName || !validValueDescription) {\r\n          throw new Error(`Unexpected input to 'invalid-value' error.`);\r\n        }\r\n        return `The '${paramName}' parameter was given a value with an ` + `unexpected value. ${validValueDescription} Received a value of ` + `${JSON.stringify(value)}.`;\r\n      },\r\n      'not-an-array': ({\r\n        moduleName,\r\n        className,\r\n        funcName,\r\n        paramName\r\n      }) => {\r\n        if (!moduleName || !className || !funcName || !paramName) {\r\n          throw new Error(`Unexpected input to 'not-an-array' error.`);\r\n        }\r\n        return `The parameter '${paramName}' passed into ` + `'${moduleName}.${className}.${funcName}()' must be an array.`;\r\n      },\r\n      'incorrect-type': ({\r\n        expectedType,\r\n        paramName,\r\n        moduleName,\r\n        className,\r\n        funcName\r\n      }) => {\r\n        if (!expectedType || !paramName || !moduleName || !funcName) {\r\n          throw new Error(`Unexpected input to 'incorrect-type' error.`);\r\n        }\r\n        const classNameStr = className ? `${className}.` : '';\r\n        return `The parameter '${paramName}' passed into ` + `'${moduleName}.${classNameStr}` + `${funcName}()' must be of type ${expectedType}.`;\r\n      },\r\n      'incorrect-class': ({\r\n        expectedClassName,\r\n        paramName,\r\n        moduleName,\r\n        className,\r\n        funcName,\r\n        isReturnValueProblem\r\n      }) => {\r\n        if (!expectedClassName || !moduleName || !funcName) {\r\n          throw new Error(`Unexpected input to 'incorrect-class' error.`);\r\n        }\r\n        const classNameStr = className ? `${className}.` : '';\r\n        if (isReturnValueProblem) {\r\n          return `The return value from ` + `'${moduleName}.${classNameStr}${funcName}()' ` + `must be an instance of class ${expectedClassName}.`;\r\n        }\r\n        return `The parameter '${paramName}' passed into ` + `'${moduleName}.${classNameStr}${funcName}()' ` + `must be an instance of class ${expectedClassName}.`;\r\n      },\r\n      'missing-a-method': ({\r\n        expectedMethod,\r\n        paramName,\r\n        moduleName,\r\n        className,\r\n        funcName\r\n      }) => {\r\n        if (!expectedMethod || !paramName || !moduleName || !className || !funcName) {\r\n          throw new Error(`Unexpected input to 'missing-a-method' error.`);\r\n        }\r\n        return `${moduleName}.${className}.${funcName}() expected the ` + `'${paramName}' parameter to expose a '${expectedMethod}' method.`;\r\n      },\r\n      'add-to-cache-list-unexpected-type': ({\r\n        entry\r\n      }) => {\r\n        return `An unexpected entry was passed to ` + `'workbox-precaching.PrecacheController.addToCacheList()' The entry ` + `'${JSON.stringify(entry)}' isn't supported. You must supply an array of ` + `strings with one or more characters, objects with a url property or ` + `Request objects.`;\r\n      },\r\n      'add-to-cache-list-conflicting-entries': ({\r\n        firstEntry,\r\n        secondEntry\r\n      }) => {\r\n        if (!firstEntry || !secondEntry) {\r\n          throw new Error(`Unexpected input to ` + `'add-to-cache-list-duplicate-entries' error.`);\r\n        }\r\n        return `Two of the entries passed to ` + `'workbox-precaching.PrecacheController.addToCacheList()' had the URL ` + `${firstEntry} but different revision details. Workbox is ` + `unable to cache and version the asset correctly. Please remove one ` + `of the entries.`;\r\n      },\r\n      'plugin-error-request-will-fetch': ({\r\n        thrownErrorMessage\r\n      }) => {\r\n        if (!thrownErrorMessage) {\r\n          throw new Error(`Unexpected input to ` + `'plugin-error-request-will-fetch', error.`);\r\n        }\r\n        return `An error was thrown by a plugins 'requestWillFetch()' method. ` + `The thrown error message was: '${thrownErrorMessage}'.`;\r\n      },\r\n      'invalid-cache-name': ({\r\n        cacheNameId,\r\n        value\r\n      }) => {\r\n        if (!cacheNameId) {\r\n          throw new Error(`Expected a 'cacheNameId' for error 'invalid-cache-name'`);\r\n        }\r\n        return `You must provide a name containing at least one character for ` + `setCacheDetails({${cacheNameId}: '...'}). Received a value of ` + `'${JSON.stringify(value)}'`;\r\n      },\r\n      'unregister-route-but-not-found-with-method': ({\r\n        method\r\n      }) => {\r\n        if (!method) {\r\n          throw new Error(`Unexpected input to ` + `'unregister-route-but-not-found-with-method' error.`);\r\n        }\r\n        return `The route you're trying to unregister was not  previously ` + `registered for the method type '${method}'.`;\r\n      },\r\n      'unregister-route-route-not-registered': () => {\r\n        return `The route you're trying to unregister was not previously ` + `registered.`;\r\n      },\r\n      'queue-replay-failed': ({\r\n        name\r\n      }) => {\r\n        return `Replaying the background sync queue '${name}' failed.`;\r\n      },\r\n      'duplicate-queue-name': ({\r\n        name\r\n      }) => {\r\n        return `The Queue name '${name}' is already being used. ` + `All instances of backgroundSync.Queue must be given unique names.`;\r\n      },\r\n      'expired-test-without-max-age': ({\r\n        methodName,\r\n        paramName\r\n      }) => {\r\n        return `The '${methodName}()' method can only be used when the ` + `'${paramName}' is used in the constructor.`;\r\n      },\r\n      'unsupported-route-type': ({\r\n        moduleName,\r\n        className,\r\n        funcName,\r\n        paramName\r\n      }) => {\r\n        return `The supplied '${paramName}' parameter was an unsupported type. ` + `Please check the docs for ${moduleName}.${className}.${funcName} for ` + `valid input types.`;\r\n      },\r\n      'not-array-of-class': ({\r\n        value,\r\n        expectedClass,\r\n        moduleName,\r\n        className,\r\n        funcName,\r\n        paramName\r\n      }) => {\r\n        return `The supplied '${paramName}' parameter must be an array of ` + `'${expectedClass}' objects. Received '${JSON.stringify(value)},'. ` + `Please check the call to ${moduleName}.${className}.${funcName}() ` + `to fix the issue.`;\r\n      },\r\n      'max-entries-or-age-required': ({\r\n        moduleName,\r\n        className,\r\n        funcName\r\n      }) => {\r\n        return `You must define either config.maxEntries or config.maxAgeSeconds` + `in ${moduleName}.${className}.${funcName}`;\r\n      },\r\n      'statuses-or-headers-required': ({\r\n        moduleName,\r\n        className,\r\n        funcName\r\n      }) => {\r\n        return `You must define either config.statuses or config.headers` + `in ${moduleName}.${className}.${funcName}`;\r\n      },\r\n      'invalid-string': ({\r\n        moduleName,\r\n        funcName,\r\n        paramName\r\n      }) => {\r\n        if (!paramName || !moduleName || !funcName) {\r\n          throw new Error(`Unexpected input to 'invalid-string' error.`);\r\n        }\r\n        return `When using strings, the '${paramName}' parameter must start with ` + `'http' (for cross-origin matches) or '/' (for same-origin matches). ` + `Please see the docs for ${moduleName}.${funcName}() for ` + `more info.`;\r\n      },\r\n      'channel-name-required': () => {\r\n        return `You must provide a channelName to construct a ` + `BroadcastCacheUpdate instance.`;\r\n      },\r\n      'invalid-responses-are-same-args': () => {\r\n        return `The arguments passed into responsesAreSame() appear to be ` + `invalid. Please ensure valid Responses are used.`;\r\n      },\r\n      'expire-custom-caches-only': () => {\r\n        return `You must provide a 'cacheName' property when using the ` + `expiration plugin with a runtime caching strategy.`;\r\n      },\r\n      'unit-must-be-bytes': ({\r\n        normalizedRangeHeader\r\n      }) => {\r\n        if (!normalizedRangeHeader) {\r\n          throw new Error(`Unexpected input to 'unit-must-be-bytes' error.`);\r\n        }\r\n        return `The 'unit' portion of the Range header must be set to 'bytes'. ` + `The Range header provided was \"${normalizedRangeHeader}\"`;\r\n      },\r\n      'single-range-only': ({\r\n        normalizedRangeHeader\r\n      }) => {\r\n        if (!normalizedRangeHeader) {\r\n          throw new Error(`Unexpected input to 'single-range-only' error.`);\r\n        }\r\n        return `Multiple ranges are not supported. Please use a  single start ` + `value, and optional end value. The Range header provided was ` + `\"${normalizedRangeHeader}\"`;\r\n      },\r\n      'invalid-range-values': ({\r\n        normalizedRangeHeader\r\n      }) => {\r\n        if (!normalizedRangeHeader) {\r\n          throw new Error(`Unexpected input to 'invalid-range-values' error.`);\r\n        }\r\n        return `The Range header is missing both start and end values. At least ` + `one of those values is needed. The Range header provided was ` + `\"${normalizedRangeHeader}\"`;\r\n      },\r\n      'no-range-header': () => {\r\n        return `No Range header was found in the Request provided.`;\r\n      },\r\n      'range-not-satisfiable': ({\r\n        size,\r\n        start,\r\n        end\r\n      }) => {\r\n        return `The start (${start}) and end (${end}) values in the Range are ` + `not satisfiable by the cached response, which is ${size} bytes.`;\r\n      },\r\n      'attempt-to-cache-non-get-request': ({\r\n        url,\r\n        method\r\n      }) => {\r\n        return `Unable to cache '${url}' because it is a '${method}' request and ` + `only 'GET' requests can be cached.`;\r\n      },\r\n      'cache-put-with-no-response': ({\r\n        url\r\n      }) => {\r\n        return `There was an attempt to cache '${url}' but the response was not ` + `defined.`;\r\n      },\r\n      'no-response': ({\r\n        url,\r\n        error\r\n      }) => {\r\n        let message = `The strategy could not generate a response for '${url}'.`;\r\n        if (error) {\r\n          message += ` The underlying error is ${error}.`;\r\n        }\r\n        return message;\r\n      },\r\n      'bad-precaching-response': ({\r\n        url,\r\n        status\r\n      }) => {\r\n        return `The precaching request for '${url}' failed` + (status ? ` with an HTTP status of ${status}.` : `.`);\r\n      },\r\n      'non-precached-url': ({\r\n        url\r\n      }) => {\r\n        return `createHandlerBoundToURL('${url}') was called, but that URL is ` + `not precached. Please pass in a URL that is precached instead.`;\r\n      },\r\n      'add-to-cache-list-conflicting-integrities': ({\r\n        url\r\n      }) => {\r\n        return `Two of the entries passed to ` + `'workbox-precaching.PrecacheController.addToCacheList()' had the URL ` + `${url} with different integrity values. Please remove one of them.`;\r\n      },\r\n      'missing-precache-entry': ({\r\n        cacheName,\r\n        url\r\n      }) => {\r\n        return `Unable to find a precached response in ${cacheName} for ${url}.`;\r\n      },\r\n      'cross-origin-copy-response': ({\r\n        origin\r\n      }) => {\r\n        return `workbox-core.copyResponse() can only be used with same-origin ` + `responses. It was passed a response with origin ${origin}.`;\r\n      },\r\n      'opaque-streams-source': ({\r\n        type\r\n      }) => {\r\n        const message = `One of the workbox-streams sources resulted in an ` + `'${type}' response.`;\r\n        if (type === 'opaqueredirect') {\r\n          return `${message} Please do not use a navigation request that results ` + `in a redirect as a source.`;\r\n        }\r\n        return `${message} Please ensure your sources are CORS-enabled.`;\r\n      }\r\n    };\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const generatorFunction = (code, details = {}) => {\r\n      const message = messages[code];\r\n      if (!message) {\r\n        throw new Error(`Unable to find message for code '${code}'.`);\r\n      }\r\n      return message(details);\r\n    };\r\n    const messageGenerator = generatorFunction;\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Workbox errors should be thrown with this class.\r\n     * This allows use to ensure the type easily in tests,\r\n     * helps developers identify errors from workbox\r\n     * easily and allows use to optimise error\r\n     * messages correctly.\r\n     *\r\n     * @private\r\n     */\r\n    class WorkboxError extends Error {\r\n      /**\r\n       *\r\n       * @param {string} errorCode The error code that\r\n       * identifies this particular error.\r\n       * @param {Object=} details Any relevant arguments\r\n       * that will help developers identify issues should\r\n       * be added as a key on the context object.\r\n       */\r\n      constructor(errorCode, details) {\r\n        const message = messageGenerator(errorCode, details);\r\n        super(message);\r\n        this.name = errorCode;\r\n        this.details = details;\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /*\r\n     * This method throws if the supplied value is not an array.\r\n     * The destructed values are required to produce a meaningful error for users.\r\n     * The destructed and restructured object is so it's clear what is\r\n     * needed.\r\n     */\r\n    const isArray = (value, details) => {\r\n      if (!Array.isArray(value)) {\r\n        throw new WorkboxError('not-an-array', details);\r\n      }\r\n    };\r\n    const hasMethod = (object, expectedMethod, details) => {\r\n      const type = typeof object[expectedMethod];\r\n      if (type !== 'function') {\r\n        details['expectedMethod'] = expectedMethod;\r\n        throw new WorkboxError('missing-a-method', details);\r\n      }\r\n    };\r\n    const isType = (object, expectedType, details) => {\r\n      if (typeof object !== expectedType) {\r\n        details['expectedType'] = expectedType;\r\n        throw new WorkboxError('incorrect-type', details);\r\n      }\r\n    };\r\n    const isInstance = (object,\r\n    // Need the general type to do the check later.\r\n    // eslint-disable-next-line @typescript-eslint/ban-types\r\n    expectedClass, details) => {\r\n      if (!(object instanceof expectedClass)) {\r\n        details['expectedClassName'] = expectedClass.name;\r\n        throw new WorkboxError('incorrect-class', details);\r\n      }\r\n    };\r\n    const isOneOf = (value, validValues, details) => {\r\n      if (!validValues.includes(value)) {\r\n        details['validValueDescription'] = `Valid values are ${JSON.stringify(validValues)}.`;\r\n        throw new WorkboxError('invalid-value', details);\r\n      }\r\n    };\r\n    const isArrayOfClass = (value,\r\n    // Need general type to do check later.\r\n    expectedClass,\r\n     \r\n    details) => {\r\n      const error = new WorkboxError('not-array-of-class', details);\r\n      if (!Array.isArray(value)) {\r\n        throw error;\r\n      }\r\n      for (const item of value) {\r\n        if (!(item instanceof expectedClass)) {\r\n          throw error;\r\n        }\r\n      }\r\n    };\r\n    const finalAssertExports = {\r\n      hasMethod,\r\n      isArray,\r\n      isInstance,\r\n      isOneOf,\r\n      isType,\r\n      isArrayOfClass\r\n    };\r\n\r\n    // @ts-ignore\r\n    try {\r\n      self['workbox:routing:7.3.0'] && _();\r\n    } catch (e) {}\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * The default HTTP method, 'GET', used when there's no specific method\r\n     * configured for a route.\r\n     *\r\n     * @type {string}\r\n     *\r\n     * @private\r\n     */\r\n    const defaultMethod = 'GET';\r\n    /**\r\n     * The list of valid HTTP methods associated with requests that could be routed.\r\n     *\r\n     * @type {Array<string>}\r\n     *\r\n     * @private\r\n     */\r\n    const validMethods = ['DELETE', 'GET', 'HEAD', 'PATCH', 'POST', 'PUT'];\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * @param {function()|Object} handler Either a function, or an object with a\r\n     * 'handle' method.\r\n     * @return {Object} An object with a handle method.\r\n     *\r\n     * @private\r\n     */\r\n    const normalizeHandler = handler => {\r\n      if (handler && typeof handler === 'object') {\r\n        {\r\n          finalAssertExports.hasMethod(handler, 'handle', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Route',\r\n            funcName: 'constructor',\r\n            paramName: 'handler'\r\n          });\r\n        }\r\n        return handler;\r\n      } else {\r\n        {\r\n          finalAssertExports.isType(handler, 'function', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Route',\r\n            funcName: 'constructor',\r\n            paramName: 'handler'\r\n          });\r\n        }\r\n        return {\r\n          handle: handler\r\n        };\r\n      }\r\n    };\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A `Route` consists of a pair of callback functions, \"match\" and \"handler\".\r\n     * The \"match\" callback determine if a route should be used to \"handle\" a\r\n     * request by returning a non-falsy value if it can. The \"handler\" callback\r\n     * is called when there is a match and should return a Promise that resolves\r\n     * to a `Response`.\r\n     *\r\n     * @memberof workbox-routing\r\n     */\r\n    class Route {\r\n      /**\r\n       * Constructor for Route class.\r\n       *\r\n       * @param {workbox-routing~matchCallback} match\r\n       * A callback function that determines whether the route matches a given\r\n       * `fetch` event by returning a non-falsy value.\r\n       * @param {workbox-routing~handlerCallback} handler A callback\r\n       * function that returns a Promise resolving to a Response.\r\n       * @param {string} [method='GET'] The HTTP method to match the Route\r\n       * against.\r\n       */\r\n      constructor(match, handler, method = defaultMethod) {\r\n        {\r\n          finalAssertExports.isType(match, 'function', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Route',\r\n            funcName: 'constructor',\r\n            paramName: 'match'\r\n          });\r\n          if (method) {\r\n            finalAssertExports.isOneOf(method, validMethods, {\r\n              paramName: 'method'\r\n            });\r\n          }\r\n        }\r\n        // These values are referenced directly by Router so cannot be\r\n        // altered by minificaton.\r\n        this.handler = normalizeHandler(handler);\r\n        this.match = match;\r\n        this.method = method;\r\n      }\r\n      /**\r\n       *\r\n       * @param {workbox-routing-handlerCallback} handler A callback\r\n       * function that returns a Promise resolving to a Response\r\n       */\r\n      setCatchHandler(handler) {\r\n        this.catchHandler = normalizeHandler(handler);\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * RegExpRoute makes it easy to create a regular expression based\r\n     * {@link workbox-routing.Route}.\r\n     *\r\n     * For same-origin requests the RegExp only needs to match part of the URL. For\r\n     * requests against third-party servers, you must define a RegExp that matches\r\n     * the start of the URL.\r\n     *\r\n     * @memberof workbox-routing\r\n     * @extends workbox-routing.Route\r\n     */\r\n    class RegExpRoute extends Route {\r\n      /**\r\n       * If the regular expression contains\r\n       * [capture groups]{@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp#grouping-back-references},\r\n       * the captured values will be passed to the\r\n       * {@link workbox-routing~handlerCallback} `params`\r\n       * argument.\r\n       *\r\n       * @param {RegExp} regExp The regular expression to match against URLs.\r\n       * @param {workbox-routing~handlerCallback} handler A callback\r\n       * function that returns a Promise resulting in a Response.\r\n       * @param {string} [method='GET'] The HTTP method to match the Route\r\n       * against.\r\n       */\r\n      constructor(regExp, handler, method) {\r\n        {\r\n          finalAssertExports.isInstance(regExp, RegExp, {\r\n            moduleName: 'workbox-routing',\r\n            className: 'RegExpRoute',\r\n            funcName: 'constructor',\r\n            paramName: 'pattern'\r\n          });\r\n        }\r\n        const match = ({\r\n          url\r\n        }) => {\r\n          const result = regExp.exec(url.href);\r\n          // Return immediately if there's no match.\r\n          if (!result) {\r\n            return;\r\n          }\r\n          // Require that the match start at the first character in the URL string\r\n          // if it's a cross-origin request.\r\n          // See https://github.com/GoogleChrome/workbox/issues/281 for the context\r\n          // behind this behavior.\r\n          if (url.origin !== location.origin && result.index !== 0) {\r\n            {\r\n              logger.debug(`The regular expression '${regExp.toString()}' only partially matched ` + `against the cross-origin URL '${url.toString()}'. RegExpRoute's will only ` + `handle cross-origin requests if they match the entire URL.`);\r\n            }\r\n            return;\r\n          }\r\n          // If the route matches, but there aren't any capture groups defined, then\r\n          // this will return [], which is truthy and therefore sufficient to\r\n          // indicate a match.\r\n          // If there are capture groups, then it will return their values.\r\n          return result.slice(1);\r\n        };\r\n        super(match, handler, method);\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const getFriendlyURL = url => {\r\n      const urlObj = new URL(String(url), location.href);\r\n      // See https://github.com/GoogleChrome/workbox/issues/2323\r\n      // We want to include everything, except for the origin if it's same-origin.\r\n      return urlObj.href.replace(new RegExp(`^${location.origin}`), '');\r\n    };\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * The Router can be used to process a `FetchEvent` using one or more\r\n     * {@link workbox-routing.Route}, responding with a `Response` if\r\n     * a matching route exists.\r\n     *\r\n     * If no route matches a given a request, the Router will use a \"default\"\r\n     * handler if one is defined.\r\n     *\r\n     * Should the matching Route throw an error, the Router will use a \"catch\"\r\n     * handler if one is defined to gracefully deal with issues and respond with a\r\n     * Request.\r\n     *\r\n     * If a request matches multiple routes, the **earliest** registered route will\r\n     * be used to respond to the request.\r\n     *\r\n     * @memberof workbox-routing\r\n     */\r\n    class Router {\r\n      /**\r\n       * Initializes a new Router.\r\n       */\r\n      constructor() {\r\n        this._routes = new Map();\r\n        this._defaultHandlerMap = new Map();\r\n      }\r\n      /**\r\n       * @return {Map<string, Array<workbox-routing.Route>>} routes A `Map` of HTTP\r\n       * method name ('GET', etc.) to an array of all the corresponding `Route`\r\n       * instances that are registered.\r\n       */\r\n      get routes() {\r\n        return this._routes;\r\n      }\r\n      /**\r\n       * Adds a fetch event listener to respond to events when a route matches\r\n       * the event's request.\r\n       */\r\n      addFetchListener() {\r\n        // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705\r\n        self.addEventListener('fetch', event => {\r\n          const {\r\n            request\r\n          } = event;\r\n          const responsePromise = this.handleRequest({\r\n            request,\r\n            event\r\n          });\r\n          if (responsePromise) {\r\n            event.respondWith(responsePromise);\r\n          }\r\n        });\r\n      }\r\n      /**\r\n       * Adds a message event listener for URLs to cache from the window.\r\n       * This is useful to cache resources loaded on the page prior to when the\r\n       * service worker started controlling it.\r\n       *\r\n       * The format of the message data sent from the window should be as follows.\r\n       * Where the `urlsToCache` array may consist of URL strings or an array of\r\n       * URL string + `requestInit` object (the same as you'd pass to `fetch()`).\r\n       *\r\n       * ```\r\n       * {\r\n       *   type: 'CACHE_URLS',\r\n       *   payload: {\r\n       *     urlsToCache: [\r\n       *       './script1.js',\r\n       *       './script2.js',\r\n       *       ['./script3.js', {mode: 'no-cors'}],\r\n       *     ],\r\n       *   },\r\n       * }\r\n       * ```\r\n       */\r\n      addCacheListener() {\r\n        // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705\r\n        self.addEventListener('message', event => {\r\n          // event.data is type 'any'\r\n           \r\n          if (event.data && event.data.type === 'CACHE_URLS') {\r\n             \r\n            const {\r\n              payload\r\n            } = event.data;\r\n            {\r\n              logger.debug(`Caching URLs from the window`, payload.urlsToCache);\r\n            }\r\n            const requestPromises = Promise.all(payload.urlsToCache.map(entry => {\r\n              if (typeof entry === 'string') {\r\n                entry = [entry];\r\n              }\r\n              const request = new Request(...entry);\r\n              return this.handleRequest({\r\n                request,\r\n                event\r\n              });\r\n              // TODO(philipwalton): TypeScript errors without this typecast for\r\n              // some reason (probably a bug). The real type here should work but\r\n              // doesn't: `Array<Promise<Response> | undefined>`.\r\n            })); // TypeScript\r\n            event.waitUntil(requestPromises);\r\n            // If a MessageChannel was used, reply to the message on success.\r\n            if (event.ports && event.ports[0]) {\r\n              void requestPromises.then(() => event.ports[0].postMessage(true));\r\n            }\r\n          }\r\n        });\r\n      }\r\n      /**\r\n       * Apply the routing rules to a FetchEvent object to get a Response from an\r\n       * appropriate Route's handler.\r\n       *\r\n       * @param {Object} options\r\n       * @param {Request} options.request The request to handle.\r\n       * @param {ExtendableEvent} options.event The event that triggered the\r\n       *     request.\r\n       * @return {Promise<Response>|undefined} A promise is returned if a\r\n       *     registered route can handle the request. If there is no matching\r\n       *     route and there's no `defaultHandler`, `undefined` is returned.\r\n       */\r\n      handleRequest({\r\n        request,\r\n        event\r\n      }) {\r\n        {\r\n          finalAssertExports.isInstance(request, Request, {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'handleRequest',\r\n            paramName: 'options.request'\r\n          });\r\n        }\r\n        const url = new URL(request.url, location.href);\r\n        if (!url.protocol.startsWith('http')) {\r\n          {\r\n            logger.debug(`Workbox Router only supports URLs that start with 'http'.`);\r\n          }\r\n          return;\r\n        }\r\n        const sameOrigin = url.origin === location.origin;\r\n        const {\r\n          params,\r\n          route\r\n        } = this.findMatchingRoute({\r\n          event,\r\n          request,\r\n          sameOrigin,\r\n          url\r\n        });\r\n        let handler = route && route.handler;\r\n        const debugMessages = [];\r\n        {\r\n          if (handler) {\r\n            debugMessages.push([`Found a route to handle this request:`, route]);\r\n            if (params) {\r\n              debugMessages.push([`Passing the following params to the route's handler:`, params]);\r\n            }\r\n          }\r\n        }\r\n        // If we don't have a handler because there was no matching route, then\r\n        // fall back to defaultHandler if that's defined.\r\n        const method = request.method;\r\n        if (!handler && this._defaultHandlerMap.has(method)) {\r\n          {\r\n            debugMessages.push(`Failed to find a matching route. Falling ` + `back to the default handler for ${method}.`);\r\n          }\r\n          handler = this._defaultHandlerMap.get(method);\r\n        }\r\n        if (!handler) {\r\n          {\r\n            // No handler so Workbox will do nothing. If logs is set of debug\r\n            // i.e. verbose, we should print out this information.\r\n            logger.debug(`No route found for: ${getFriendlyURL(url)}`);\r\n          }\r\n          return;\r\n        }\r\n        {\r\n          // We have a handler, meaning Workbox is going to handle the route.\r\n          // print the routing details to the console.\r\n          logger.groupCollapsed(`Router is responding to: ${getFriendlyURL(url)}`);\r\n          debugMessages.forEach(msg => {\r\n            if (Array.isArray(msg)) {\r\n              logger.log(...msg);\r\n            } else {\r\n              logger.log(msg);\r\n            }\r\n          });\r\n          logger.groupEnd();\r\n        }\r\n        // Wrap in try and catch in case the handle method throws a synchronous\r\n        // error. It should still callback to the catch handler.\r\n        let responsePromise;\r\n        try {\r\n          responsePromise = handler.handle({\r\n            url,\r\n            request,\r\n            event,\r\n            params\r\n          });\r\n        } catch (err) {\r\n          responsePromise = Promise.reject(err);\r\n        }\r\n        // Get route's catch handler, if it exists\r\n        const catchHandler = route && route.catchHandler;\r\n        if (responsePromise instanceof Promise && (this._catchHandler || catchHandler)) {\r\n          responsePromise = responsePromise.catch(async err => {\r\n            // If there's a route catch handler, process that first\r\n            if (catchHandler) {\r\n              {\r\n                // Still include URL here as it will be async from the console group\r\n                // and may not make sense without the URL\r\n                logger.groupCollapsed(`Error thrown when responding to: ` + ` ${getFriendlyURL(url)}. Falling back to route's Catch Handler.`);\r\n                logger.error(`Error thrown by:`, route);\r\n                logger.error(err);\r\n                logger.groupEnd();\r\n              }\r\n              try {\r\n                return await catchHandler.handle({\r\n                  url,\r\n                  request,\r\n                  event,\r\n                  params\r\n                });\r\n              } catch (catchErr) {\r\n                if (catchErr instanceof Error) {\r\n                  err = catchErr;\r\n                }\r\n              }\r\n            }\r\n            if (this._catchHandler) {\r\n              {\r\n                // Still include URL here as it will be async from the console group\r\n                // and may not make sense without the URL\r\n                logger.groupCollapsed(`Error thrown when responding to: ` + ` ${getFriendlyURL(url)}. Falling back to global Catch Handler.`);\r\n                logger.error(`Error thrown by:`, route);\r\n                logger.error(err);\r\n                logger.groupEnd();\r\n              }\r\n              return this._catchHandler.handle({\r\n                url,\r\n                request,\r\n                event\r\n              });\r\n            }\r\n            throw err;\r\n          });\r\n        }\r\n        return responsePromise;\r\n      }\r\n      /**\r\n       * Checks a request and URL (and optionally an event) against the list of\r\n       * registered routes, and if there's a match, returns the corresponding\r\n       * route along with any params generated by the match.\r\n       *\r\n       * @param {Object} options\r\n       * @param {URL} options.url\r\n       * @param {boolean} options.sameOrigin The result of comparing `url.origin`\r\n       *     against the current origin.\r\n       * @param {Request} options.request The request to match.\r\n       * @param {Event} options.event The corresponding event.\r\n       * @return {Object} An object with `route` and `params` properties.\r\n       *     They are populated if a matching route was found or `undefined`\r\n       *     otherwise.\r\n       */\r\n      findMatchingRoute({\r\n        url,\r\n        sameOrigin,\r\n        request,\r\n        event\r\n      }) {\r\n        const routes = this._routes.get(request.method) || [];\r\n        for (const route of routes) {\r\n          let params;\r\n          // route.match returns type any, not possible to change right now.\r\n           \r\n          const matchResult = route.match({\r\n            url,\r\n            sameOrigin,\r\n            request,\r\n            event\r\n          });\r\n          if (matchResult) {\r\n            {\r\n              // Warn developers that using an async matchCallback is almost always\r\n              // not the right thing to do.\r\n              if (matchResult instanceof Promise) {\r\n                logger.warn(`While routing ${getFriendlyURL(url)}, an async ` + `matchCallback function was used. Please convert the ` + `following route to use a synchronous matchCallback function:`, route);\r\n              }\r\n            }\r\n            // See https://github.com/GoogleChrome/workbox/issues/2079\r\n             \r\n            params = matchResult;\r\n            if (Array.isArray(params) && params.length === 0) {\r\n              // Instead of passing an empty array in as params, use undefined.\r\n              params = undefined;\r\n            } else if (matchResult.constructor === Object &&\r\n             \r\n            Object.keys(matchResult).length === 0) {\r\n              // Instead of passing an empty object in as params, use undefined.\r\n              params = undefined;\r\n            } else if (typeof matchResult === 'boolean') {\r\n              // For the boolean value true (rather than just something truth-y),\r\n              // don't set params.\r\n              // See https://github.com/GoogleChrome/workbox/pull/2134#issuecomment-513924353\r\n              params = undefined;\r\n            }\r\n            // Return early if have a match.\r\n            return {\r\n              route,\r\n              params\r\n            };\r\n          }\r\n        }\r\n        // If no match was found above, return and empty object.\r\n        return {};\r\n      }\r\n      /**\r\n       * Define a default `handler` that's called when no routes explicitly\r\n       * match the incoming request.\r\n       *\r\n       * Each HTTP method ('GET', 'POST', etc.) gets its own default handler.\r\n       *\r\n       * Without a default handler, unmatched requests will go against the\r\n       * network as if there were no service worker present.\r\n       *\r\n       * @param {workbox-routing~handlerCallback} handler A callback\r\n       * function that returns a Promise resulting in a Response.\r\n       * @param {string} [method='GET'] The HTTP method to associate with this\r\n       * default handler. Each method has its own default.\r\n       */\r\n      setDefaultHandler(handler, method = defaultMethod) {\r\n        this._defaultHandlerMap.set(method, normalizeHandler(handler));\r\n      }\r\n      /**\r\n       * If a Route throws an error while handling a request, this `handler`\r\n       * will be called and given a chance to provide a response.\r\n       *\r\n       * @param {workbox-routing~handlerCallback} handler A callback\r\n       * function that returns a Promise resulting in a Response.\r\n       */\r\n      setCatchHandler(handler) {\r\n        this._catchHandler = normalizeHandler(handler);\r\n      }\r\n      /**\r\n       * Registers a route with the router.\r\n       *\r\n       * @param {workbox-routing.Route} route The route to register.\r\n       */\r\n      registerRoute(route) {\r\n        {\r\n          finalAssertExports.isType(route, 'object', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'registerRoute',\r\n            paramName: 'route'\r\n          });\r\n          finalAssertExports.hasMethod(route, 'match', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'registerRoute',\r\n            paramName: 'route'\r\n          });\r\n          finalAssertExports.isType(route.handler, 'object', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'registerRoute',\r\n            paramName: 'route'\r\n          });\r\n          finalAssertExports.hasMethod(route.handler, 'handle', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'registerRoute',\r\n            paramName: 'route.handler'\r\n          });\r\n          finalAssertExports.isType(route.method, 'string', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'registerRoute',\r\n            paramName: 'route.method'\r\n          });\r\n        }\r\n        if (!this._routes.has(route.method)) {\r\n          this._routes.set(route.method, []);\r\n        }\r\n        // Give precedence to all of the earlier routes by adding this additional\r\n        // route to the end of the array.\r\n        this._routes.get(route.method).push(route);\r\n      }\r\n      /**\r\n       * Unregisters a route with the router.\r\n       *\r\n       * @param {workbox-routing.Route} route The route to unregister.\r\n       */\r\n      unregisterRoute(route) {\r\n        if (!this._routes.has(route.method)) {\r\n          throw new WorkboxError('unregister-route-but-not-found-with-method', {\r\n            method: route.method\r\n          });\r\n        }\r\n        const routeIndex = this._routes.get(route.method).indexOf(route);\r\n        if (routeIndex > -1) {\r\n          this._routes.get(route.method).splice(routeIndex, 1);\r\n        } else {\r\n          throw new WorkboxError('unregister-route-route-not-registered');\r\n        }\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    let defaultRouter;\r\n    /**\r\n     * Creates a new, singleton Router instance if one does not exist. If one\r\n     * does already exist, that instance is returned.\r\n     *\r\n     * @private\r\n     * @return {Router}\r\n     */\r\n    const getOrCreateDefaultRouter = () => {\r\n      if (!defaultRouter) {\r\n        defaultRouter = new Router();\r\n        // The helpers that use the default Router assume these listeners exist.\r\n        defaultRouter.addFetchListener();\r\n        defaultRouter.addCacheListener();\r\n      }\r\n      return defaultRouter;\r\n    };\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Easily register a RegExp, string, or function with a caching\r\n     * strategy to a singleton Router instance.\r\n     *\r\n     * This method will generate a Route for you if needed and\r\n     * call {@link workbox-routing.Router#registerRoute}.\r\n     *\r\n     * @param {RegExp|string|workbox-routing.Route~matchCallback|workbox-routing.Route} capture\r\n     * If the capture param is a `Route`, all other arguments will be ignored.\r\n     * @param {workbox-routing~handlerCallback} [handler] A callback\r\n     * function that returns a Promise resulting in a Response. This parameter\r\n     * is required if `capture` is not a `Route` object.\r\n     * @param {string} [method='GET'] The HTTP method to match the Route\r\n     * against.\r\n     * @return {workbox-routing.Route} The generated `Route`.\r\n     *\r\n     * @memberof workbox-routing\r\n     */\r\n    function registerRoute(capture, handler, method) {\r\n      let route;\r\n      if (typeof capture === 'string') {\r\n        const captureUrl = new URL(capture, location.href);\r\n        {\r\n          if (!(capture.startsWith('/') || capture.startsWith('http'))) {\r\n            throw new WorkboxError('invalid-string', {\r\n              moduleName: 'workbox-routing',\r\n              funcName: 'registerRoute',\r\n              paramName: 'capture'\r\n            });\r\n          }\r\n          // We want to check if Express-style wildcards are in the pathname only.\r\n          // TODO: Remove this log message in v4.\r\n          const valueToCheck = capture.startsWith('http') ? captureUrl.pathname : capture;\r\n          // See https://github.com/pillarjs/path-to-regexp#parameters\r\n          const wildcards = '[*:?+]';\r\n          if (new RegExp(`${wildcards}`).exec(valueToCheck)) {\r\n            logger.debug(`The '$capture' parameter contains an Express-style wildcard ` + `character (${wildcards}). Strings are now always interpreted as ` + `exact matches; use a RegExp for partial or wildcard matches.`);\r\n          }\r\n        }\r\n        const matchCallback = ({\r\n          url\r\n        }) => {\r\n          {\r\n            if (url.pathname === captureUrl.pathname && url.origin !== captureUrl.origin) {\r\n              logger.debug(`${capture} only partially matches the cross-origin URL ` + `${url.toString()}. This route will only handle cross-origin requests ` + `if they match the entire URL.`);\r\n            }\r\n          }\r\n          return url.href === captureUrl.href;\r\n        };\r\n        // If `capture` is a string then `handler` and `method` must be present.\r\n        route = new Route(matchCallback, handler, method);\r\n      } else if (capture instanceof RegExp) {\r\n        // If `capture` is a `RegExp` then `handler` and `method` must be present.\r\n        route = new RegExpRoute(capture, handler, method);\r\n      } else if (typeof capture === 'function') {\r\n        // If `capture` is a function then `handler` and `method` must be present.\r\n        route = new Route(capture, handler, method);\r\n      } else if (capture instanceof Route) {\r\n        route = capture;\r\n      } else {\r\n        throw new WorkboxError('unsupported-route-type', {\r\n          moduleName: 'workbox-routing',\r\n          funcName: 'registerRoute',\r\n          paramName: 'capture'\r\n        });\r\n      }\r\n      const defaultRouter = getOrCreateDefaultRouter();\r\n      defaultRouter.registerRoute(route);\r\n      return route;\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const _cacheNameDetails = {\r\n      googleAnalytics: 'googleAnalytics',\r\n      precache: 'precache-v2',\r\n      prefix: 'workbox',\r\n      runtime: 'runtime',\r\n      suffix: typeof registration !== 'undefined' ? registration.scope : ''\r\n    };\r\n    const _createCacheName = cacheName => {\r\n      return [_cacheNameDetails.prefix, cacheName, _cacheNameDetails.suffix].filter(value => value && value.length > 0).join('-');\r\n    };\r\n    const eachCacheNameDetail = fn => {\r\n      for (const key of Object.keys(_cacheNameDetails)) {\r\n        fn(key);\r\n      }\r\n    };\r\n    const cacheNames = {\r\n      updateDetails: details => {\r\n        eachCacheNameDetail(key => {\r\n          if (typeof details[key] === 'string') {\r\n            _cacheNameDetails[key] = details[key];\r\n          }\r\n        });\r\n      },\r\n      getGoogleAnalyticsName: userCacheName => {\r\n        return userCacheName || _createCacheName(_cacheNameDetails.googleAnalytics);\r\n      },\r\n      getPrecacheName: userCacheName => {\r\n        return userCacheName || _createCacheName(_cacheNameDetails.precache);\r\n      },\r\n      getPrefix: () => {\r\n        return _cacheNameDetails.prefix;\r\n      },\r\n      getRuntimeName: userCacheName => {\r\n        return userCacheName || _createCacheName(_cacheNameDetails.runtime);\r\n      },\r\n      getSuffix: () => {\r\n        return _cacheNameDetails.suffix;\r\n      }\r\n    };\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A utility method that makes it easier to use `event.waitUntil` with\r\n     * async functions and return the result.\r\n     *\r\n     * @param {ExtendableEvent} event\r\n     * @param {Function} asyncFn\r\n     * @return {Function}\r\n     * @private\r\n     */\r\n    function waitUntil(event, asyncFn) {\r\n      const returnPromise = asyncFn();\r\n      event.waitUntil(returnPromise);\r\n      return returnPromise;\r\n    }\r\n\r\n    // @ts-ignore\r\n    try {\r\n      self['workbox:precaching:7.3.0'] && _();\r\n    } catch (e) {}\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    // Name of the search parameter used to store revision info.\r\n    const REVISION_SEARCH_PARAM = '__WB_REVISION__';\r\n    /**\r\n     * Converts a manifest entry into a versioned URL suitable for precaching.\r\n     *\r\n     * @param {Object|string} entry\r\n     * @return {string} A URL with versioning info.\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    function createCacheKey(entry) {\r\n      if (!entry) {\r\n        throw new WorkboxError('add-to-cache-list-unexpected-type', {\r\n          entry\r\n        });\r\n      }\r\n      // If a precache manifest entry is a string, it's assumed to be a versioned\r\n      // URL, like '/app.abcd1234.js'. Return as-is.\r\n      if (typeof entry === 'string') {\r\n        const urlObject = new URL(entry, location.href);\r\n        return {\r\n          cacheKey: urlObject.href,\r\n          url: urlObject.href\r\n        };\r\n      }\r\n      const {\r\n        revision,\r\n        url\r\n      } = entry;\r\n      if (!url) {\r\n        throw new WorkboxError('add-to-cache-list-unexpected-type', {\r\n          entry\r\n        });\r\n      }\r\n      // If there's just a URL and no revision, then it's also assumed to be a\r\n      // versioned URL.\r\n      if (!revision) {\r\n        const urlObject = new URL(url, location.href);\r\n        return {\r\n          cacheKey: urlObject.href,\r\n          url: urlObject.href\r\n        };\r\n      }\r\n      // Otherwise, construct a properly versioned URL using the custom Workbox\r\n      // search parameter along with the revision info.\r\n      const cacheKeyURL = new URL(url, location.href);\r\n      const originalURL = new URL(url, location.href);\r\n      cacheKeyURL.searchParams.set(REVISION_SEARCH_PARAM, revision);\r\n      return {\r\n        cacheKey: cacheKeyURL.href,\r\n        url: originalURL.href\r\n      };\r\n    }\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A plugin, designed to be used with PrecacheController, to determine the\r\n     * of assets that were updated (or not updated) during the install event.\r\n     *\r\n     * @private\r\n     */\r\n    class PrecacheInstallReportPlugin {\r\n      constructor() {\r\n        this.updatedURLs = [];\r\n        this.notUpdatedURLs = [];\r\n        this.handlerWillStart = async ({\r\n          request,\r\n          state\r\n        }) => {\r\n          // TODO: `state` should never be undefined...\r\n          if (state) {\r\n            state.originalRequest = request;\r\n          }\r\n        };\r\n        this.cachedResponseWillBeUsed = async ({\r\n          event,\r\n          state,\r\n          cachedResponse\r\n        }) => {\r\n          if (event.type === 'install') {\r\n            if (state && state.originalRequest && state.originalRequest instanceof Request) {\r\n              // TODO: `state` should never be undefined...\r\n              const url = state.originalRequest.url;\r\n              if (cachedResponse) {\r\n                this.notUpdatedURLs.push(url);\r\n              } else {\r\n                this.updatedURLs.push(url);\r\n              }\r\n            }\r\n          }\r\n          return cachedResponse;\r\n        };\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A plugin, designed to be used with PrecacheController, to translate URLs into\r\n     * the corresponding cache key, based on the current revision info.\r\n     *\r\n     * @private\r\n     */\r\n    class PrecacheCacheKeyPlugin {\r\n      constructor({\r\n        precacheController\r\n      }) {\r\n        this.cacheKeyWillBeUsed = async ({\r\n          request,\r\n          params\r\n        }) => {\r\n          // Params is type any, can't change right now.\r\n           \r\n          const cacheKey = (params === null || params === void 0 ? void 0 : params.cacheKey) || this._precacheController.getCacheKeyForURL(request.url);\r\n           \r\n          return cacheKey ? new Request(cacheKey, {\r\n            headers: request.headers\r\n          }) : request;\r\n        };\r\n        this._precacheController = precacheController;\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * @param {string} groupTitle\r\n     * @param {Array<string>} deletedURLs\r\n     *\r\n     * @private\r\n     */\r\n    const logGroup = (groupTitle, deletedURLs) => {\r\n      logger.groupCollapsed(groupTitle);\r\n      for (const url of deletedURLs) {\r\n        logger.log(url);\r\n      }\r\n      logger.groupEnd();\r\n    };\r\n    /**\r\n     * @param {Array<string>} deletedURLs\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    function printCleanupDetails(deletedURLs) {\r\n      const deletionCount = deletedURLs.length;\r\n      if (deletionCount > 0) {\r\n        logger.groupCollapsed(`During precaching cleanup, ` + `${deletionCount} cached ` + `request${deletionCount === 1 ? ' was' : 's were'} deleted.`);\r\n        logGroup('Deleted Cache Requests', deletedURLs);\r\n        logger.groupEnd();\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * @param {string} groupTitle\r\n     * @param {Array<string>} urls\r\n     *\r\n     * @private\r\n     */\r\n    function _nestedGroup(groupTitle, urls) {\r\n      if (urls.length === 0) {\r\n        return;\r\n      }\r\n      logger.groupCollapsed(groupTitle);\r\n      for (const url of urls) {\r\n        logger.log(url);\r\n      }\r\n      logger.groupEnd();\r\n    }\r\n    /**\r\n     * @param {Array<string>} urlsToPrecache\r\n     * @param {Array<string>} urlsAlreadyPrecached\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    function printInstallDetails(urlsToPrecache, urlsAlreadyPrecached) {\r\n      const precachedCount = urlsToPrecache.length;\r\n      const alreadyPrecachedCount = urlsAlreadyPrecached.length;\r\n      if (precachedCount || alreadyPrecachedCount) {\r\n        let message = `Precaching ${precachedCount} file${precachedCount === 1 ? '' : 's'}.`;\r\n        if (alreadyPrecachedCount > 0) {\r\n          message += ` ${alreadyPrecachedCount} ` + `file${alreadyPrecachedCount === 1 ? ' is' : 's are'} already cached.`;\r\n        }\r\n        logger.groupCollapsed(message);\r\n        _nestedGroup(`View newly precached URLs.`, urlsToPrecache);\r\n        _nestedGroup(`View previously precached URLs.`, urlsAlreadyPrecached);\r\n        logger.groupEnd();\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    let supportStatus;\r\n    /**\r\n     * A utility function that determines whether the current browser supports\r\n     * constructing a new `Response` from a `response.body` stream.\r\n     *\r\n     * @return {boolean} `true`, if the current browser can successfully\r\n     *     construct a `Response` from a `response.body` stream, `false` otherwise.\r\n     *\r\n     * @private\r\n     */\r\n    function canConstructResponseFromBodyStream() {\r\n      if (supportStatus === undefined) {\r\n        const testResponse = new Response('');\r\n        if ('body' in testResponse) {\r\n          try {\r\n            new Response(testResponse.body);\r\n            supportStatus = true;\r\n          } catch (error) {\r\n            supportStatus = false;\r\n          }\r\n        }\r\n        supportStatus = false;\r\n      }\r\n      return supportStatus;\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Allows developers to copy a response and modify its `headers`, `status`,\r\n     * or `statusText` values (the values settable via a\r\n     * [`ResponseInit`]{@link https://developer.mozilla.org/en-US/docs/Web/API/Response/Response#Syntax}\r\n     * object in the constructor).\r\n     * To modify these values, pass a function as the second argument. That\r\n     * function will be invoked with a single object with the response properties\r\n     * `{headers, status, statusText}`. The return value of this function will\r\n     * be used as the `ResponseInit` for the new `Response`. To change the values\r\n     * either modify the passed parameter(s) and return it, or return a totally\r\n     * new object.\r\n     *\r\n     * This method is intentionally limited to same-origin responses, regardless of\r\n     * whether CORS was used or not.\r\n     *\r\n     * @param {Response} response\r\n     * @param {Function} modifier\r\n     * @memberof workbox-core\r\n     */\r\n    async function copyResponse(response, modifier) {\r\n      let origin = null;\r\n      // If response.url isn't set, assume it's cross-origin and keep origin null.\r\n      if (response.url) {\r\n        const responseURL = new URL(response.url);\r\n        origin = responseURL.origin;\r\n      }\r\n      if (origin !== self.location.origin) {\r\n        throw new WorkboxError('cross-origin-copy-response', {\r\n          origin\r\n        });\r\n      }\r\n      const clonedResponse = response.clone();\r\n      // Create a fresh `ResponseInit` object by cloning the headers.\r\n      const responseInit = {\r\n        headers: new Headers(clonedResponse.headers),\r\n        status: clonedResponse.status,\r\n        statusText: clonedResponse.statusText\r\n      };\r\n      // Apply any user modifications.\r\n      const modifiedResponseInit = modifier ? modifier(responseInit) : responseInit;\r\n      // Create the new response from the body stream and `ResponseInit`\r\n      // modifications. Note: not all browsers support the Response.body stream,\r\n      // so fall back to reading the entire body into memory as a blob.\r\n      const body = canConstructResponseFromBodyStream() ? clonedResponse.body : await clonedResponse.blob();\r\n      return new Response(body, modifiedResponseInit);\r\n    }\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    function stripParams(fullURL, ignoreParams) {\r\n      const strippedURL = new URL(fullURL);\r\n      for (const param of ignoreParams) {\r\n        strippedURL.searchParams.delete(param);\r\n      }\r\n      return strippedURL.href;\r\n    }\r\n    /**\r\n     * Matches an item in the cache, ignoring specific URL params. This is similar\r\n     * to the `ignoreSearch` option, but it allows you to ignore just specific\r\n     * params (while continuing to match on the others).\r\n     *\r\n     * @private\r\n     * @param {Cache} cache\r\n     * @param {Request} request\r\n     * @param {Object} matchOptions\r\n     * @param {Array<string>} ignoreParams\r\n     * @return {Promise<Response|undefined>}\r\n     */\r\n    async function cacheMatchIgnoreParams(cache, request, ignoreParams, matchOptions) {\r\n      const strippedRequestURL = stripParams(request.url, ignoreParams);\r\n      // If the request doesn't include any ignored params, match as normal.\r\n      if (request.url === strippedRequestURL) {\r\n        return cache.match(request, matchOptions);\r\n      }\r\n      // Otherwise, match by comparing keys\r\n      const keysOptions = Object.assign(Object.assign({}, matchOptions), {\r\n        ignoreSearch: true\r\n      });\r\n      const cacheKeys = await cache.keys(request, keysOptions);\r\n      for (const cacheKey of cacheKeys) {\r\n        const strippedCacheKeyURL = stripParams(cacheKey.url, ignoreParams);\r\n        if (strippedRequestURL === strippedCacheKeyURL) {\r\n          return cache.match(cacheKey, matchOptions);\r\n        }\r\n      }\r\n      return;\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * The Deferred class composes Promises in a way that allows for them to be\r\n     * resolved or rejected from outside the constructor. In most cases promises\r\n     * should be used directly, but Deferreds can be necessary when the logic to\r\n     * resolve a promise must be separate.\r\n     *\r\n     * @private\r\n     */\r\n    class Deferred {\r\n      /**\r\n       * Creates a promise and exposes its resolve and reject functions as methods.\r\n       */\r\n      constructor() {\r\n        this.promise = new Promise((resolve, reject) => {\r\n          this.resolve = resolve;\r\n          this.reject = reject;\r\n        });\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    // Callbacks to be executed whenever there's a quota error.\r\n    // Can't change Function type right now.\r\n    // eslint-disable-next-line @typescript-eslint/ban-types\r\n    const quotaErrorCallbacks = new Set();\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Runs all of the callback functions, one at a time sequentially, in the order\r\n     * in which they were registered.\r\n     *\r\n     * @memberof workbox-core\r\n     * @private\r\n     */\r\n    async function executeQuotaErrorCallbacks() {\r\n      {\r\n        logger.log(`About to run ${quotaErrorCallbacks.size} ` + `callbacks to clean up caches.`);\r\n      }\r\n      for (const callback of quotaErrorCallbacks) {\r\n        await callback();\r\n        {\r\n          logger.log(callback, 'is complete.');\r\n        }\r\n      }\r\n      {\r\n        logger.log('Finished running callbacks.');\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Returns a promise that resolves and the passed number of milliseconds.\r\n     * This utility is an async/await-friendly version of `setTimeout`.\r\n     *\r\n     * @param {number} ms\r\n     * @return {Promise}\r\n     * @private\r\n     */\r\n    function timeout(ms) {\r\n      return new Promise(resolve => setTimeout(resolve, ms));\r\n    }\r\n\r\n    // @ts-ignore\r\n    try {\r\n      self['workbox:strategies:7.3.0'] && _();\r\n    } catch (e) {}\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    function toRequest(input) {\r\n      return typeof input === 'string' ? new Request(input) : input;\r\n    }\r\n    /**\r\n     * A class created every time a Strategy instance calls\r\n     * {@link workbox-strategies.Strategy~handle} or\r\n     * {@link workbox-strategies.Strategy~handleAll} that wraps all fetch and\r\n     * cache actions around plugin callbacks and keeps track of when the strategy\r\n     * is \"done\" (i.e. all added `event.waitUntil()` promises have resolved).\r\n     *\r\n     * @memberof workbox-strategies\r\n     */\r\n    class StrategyHandler {\r\n      /**\r\n       * Creates a new instance associated with the passed strategy and event\r\n       * that's handling the request.\r\n       *\r\n       * The constructor also initializes the state that will be passed to each of\r\n       * the plugins handling this request.\r\n       *\r\n       * @param {workbox-strategies.Strategy} strategy\r\n       * @param {Object} options\r\n       * @param {Request|string} options.request A request to run this strategy for.\r\n       * @param {ExtendableEvent} options.event The event associated with the\r\n       *     request.\r\n       * @param {URL} [options.url]\r\n       * @param {*} [options.params] The return value from the\r\n       *     {@link workbox-routing~matchCallback} (if applicable).\r\n       */\r\n      constructor(strategy, options) {\r\n        this._cacheKeys = {};\r\n        /**\r\n         * The request the strategy is performing (passed to the strategy's\r\n         * `handle()` or `handleAll()` method).\r\n         * @name request\r\n         * @instance\r\n         * @type {Request}\r\n         * @memberof workbox-strategies.StrategyHandler\r\n         */\r\n        /**\r\n         * The event associated with this request.\r\n         * @name event\r\n         * @instance\r\n         * @type {ExtendableEvent}\r\n         * @memberof workbox-strategies.StrategyHandler\r\n         */\r\n        /**\r\n         * A `URL` instance of `request.url` (if passed to the strategy's\r\n         * `handle()` or `handleAll()` method).\r\n         * Note: the `url` param will be present if the strategy was invoked\r\n         * from a workbox `Route` object.\r\n         * @name url\r\n         * @instance\r\n         * @type {URL|undefined}\r\n         * @memberof workbox-strategies.StrategyHandler\r\n         */\r\n        /**\r\n         * A `param` value (if passed to the strategy's\r\n         * `handle()` or `handleAll()` method).\r\n         * Note: the `param` param will be present if the strategy was invoked\r\n         * from a workbox `Route` object and the\r\n         * {@link workbox-routing~matchCallback} returned\r\n         * a truthy value (it will be that value).\r\n         * @name params\r\n         * @instance\r\n         * @type {*|undefined}\r\n         * @memberof workbox-strategies.StrategyHandler\r\n         */\r\n        {\r\n          finalAssertExports.isInstance(options.event, ExtendableEvent, {\r\n            moduleName: 'workbox-strategies',\r\n            className: 'StrategyHandler',\r\n            funcName: 'constructor',\r\n            paramName: 'options.event'\r\n          });\r\n        }\r\n        Object.assign(this, options);\r\n        this.event = options.event;\r\n        this._strategy = strategy;\r\n        this._handlerDeferred = new Deferred();\r\n        this._extendLifetimePromises = [];\r\n        // Copy the plugins list (since it's mutable on the strategy),\r\n        // so any mutations don't affect this handler instance.\r\n        this._plugins = [...strategy.plugins];\r\n        this._pluginStateMap = new Map();\r\n        for (const plugin of this._plugins) {\r\n          this._pluginStateMap.set(plugin, {});\r\n        }\r\n        this.event.waitUntil(this._handlerDeferred.promise);\r\n      }\r\n      /**\r\n       * Fetches a given request (and invokes any applicable plugin callback\r\n       * methods) using the `fetchOptions` (for non-navigation requests) and\r\n       * `plugins` defined on the `Strategy` object.\r\n       *\r\n       * The following plugin lifecycle methods are invoked when using this method:\r\n       * - `requestWillFetch()`\r\n       * - `fetchDidSucceed()`\r\n       * - `fetchDidFail()`\r\n       *\r\n       * @param {Request|string} input The URL or request to fetch.\r\n       * @return {Promise<Response>}\r\n       */\r\n      async fetch(input) {\r\n        const {\r\n          event\r\n        } = this;\r\n        let request = toRequest(input);\r\n        if (request.mode === 'navigate' && event instanceof FetchEvent && event.preloadResponse) {\r\n          const possiblePreloadResponse = await event.preloadResponse;\r\n          if (possiblePreloadResponse) {\r\n            {\r\n              logger.log(`Using a preloaded navigation response for ` + `'${getFriendlyURL(request.url)}'`);\r\n            }\r\n            return possiblePreloadResponse;\r\n          }\r\n        }\r\n        // If there is a fetchDidFail plugin, we need to save a clone of the\r\n        // original request before it's either modified by a requestWillFetch\r\n        // plugin or before the original request's body is consumed via fetch().\r\n        const originalRequest = this.hasCallback('fetchDidFail') ? request.clone() : null;\r\n        try {\r\n          for (const cb of this.iterateCallbacks('requestWillFetch')) {\r\n            request = await cb({\r\n              request: request.clone(),\r\n              event\r\n            });\r\n          }\r\n        } catch (err) {\r\n          if (err instanceof Error) {\r\n            throw new WorkboxError('plugin-error-request-will-fetch', {\r\n              thrownErrorMessage: err.message\r\n            });\r\n          }\r\n        }\r\n        // The request can be altered by plugins with `requestWillFetch` making\r\n        // the original request (most likely from a `fetch` event) different\r\n        // from the Request we make. Pass both to `fetchDidFail` to aid debugging.\r\n        const pluginFilteredRequest = request.clone();\r\n        try {\r\n          let fetchResponse;\r\n          // See https://github.com/GoogleChrome/workbox/issues/1796\r\n          fetchResponse = await fetch(request, request.mode === 'navigate' ? undefined : this._strategy.fetchOptions);\r\n          if (\"development\" !== 'production') {\r\n            logger.debug(`Network request for ` + `'${getFriendlyURL(request.url)}' returned a response with ` + `status '${fetchResponse.status}'.`);\r\n          }\r\n          for (const callback of this.iterateCallbacks('fetchDidSucceed')) {\r\n            fetchResponse = await callback({\r\n              event,\r\n              request: pluginFilteredRequest,\r\n              response: fetchResponse\r\n            });\r\n          }\r\n          return fetchResponse;\r\n        } catch (error) {\r\n          {\r\n            logger.log(`Network request for ` + `'${getFriendlyURL(request.url)}' threw an error.`, error);\r\n          }\r\n          // `originalRequest` will only exist if a `fetchDidFail` callback\r\n          // is being used (see above).\r\n          if (originalRequest) {\r\n            await this.runCallbacks('fetchDidFail', {\r\n              error: error,\r\n              event,\r\n              originalRequest: originalRequest.clone(),\r\n              request: pluginFilteredRequest.clone()\r\n            });\r\n          }\r\n          throw error;\r\n        }\r\n      }\r\n      /**\r\n       * Calls `this.fetch()` and (in the background) runs `this.cachePut()` on\r\n       * the response generated by `this.fetch()`.\r\n       *\r\n       * The call to `this.cachePut()` automatically invokes `this.waitUntil()`,\r\n       * so you do not have to manually call `waitUntil()` on the event.\r\n       *\r\n       * @param {Request|string} input The request or URL to fetch and cache.\r\n       * @return {Promise<Response>}\r\n       */\r\n      async fetchAndCachePut(input) {\r\n        const response = await this.fetch(input);\r\n        const responseClone = response.clone();\r\n        void this.waitUntil(this.cachePut(input, responseClone));\r\n        return response;\r\n      }\r\n      /**\r\n       * Matches a request from the cache (and invokes any applicable plugin\r\n       * callback methods) using the `cacheName`, `matchOptions`, and `plugins`\r\n       * defined on the strategy object.\r\n       *\r\n       * The following plugin lifecycle methods are invoked when using this method:\r\n       * - cacheKeyWillBeUsed()\r\n       * - cachedResponseWillBeUsed()\r\n       *\r\n       * @param {Request|string} key The Request or URL to use as the cache key.\r\n       * @return {Promise<Response|undefined>} A matching response, if found.\r\n       */\r\n      async cacheMatch(key) {\r\n        const request = toRequest(key);\r\n        let cachedResponse;\r\n        const {\r\n          cacheName,\r\n          matchOptions\r\n        } = this._strategy;\r\n        const effectiveRequest = await this.getCacheKey(request, 'read');\r\n        const multiMatchOptions = Object.assign(Object.assign({}, matchOptions), {\r\n          cacheName\r\n        });\r\n        cachedResponse = await caches.match(effectiveRequest, multiMatchOptions);\r\n        {\r\n          if (cachedResponse) {\r\n            logger.debug(`Found a cached response in '${cacheName}'.`);\r\n          } else {\r\n            logger.debug(`No cached response found in '${cacheName}'.`);\r\n          }\r\n        }\r\n        for (const callback of this.iterateCallbacks('cachedResponseWillBeUsed')) {\r\n          cachedResponse = (await callback({\r\n            cacheName,\r\n            matchOptions,\r\n            cachedResponse,\r\n            request: effectiveRequest,\r\n            event: this.event\r\n          })) || undefined;\r\n        }\r\n        return cachedResponse;\r\n      }\r\n      /**\r\n       * Puts a request/response pair in the cache (and invokes any applicable\r\n       * plugin callback methods) using the `cacheName` and `plugins` defined on\r\n       * the strategy object.\r\n       *\r\n       * The following plugin lifecycle methods are invoked when using this method:\r\n       * - cacheKeyWillBeUsed()\r\n       * - cacheWillUpdate()\r\n       * - cacheDidUpdate()\r\n       *\r\n       * @param {Request|string} key The request or URL to use as the cache key.\r\n       * @param {Response} response The response to cache.\r\n       * @return {Promise<boolean>} `false` if a cacheWillUpdate caused the response\r\n       * not be cached, and `true` otherwise.\r\n       */\r\n      async cachePut(key, response) {\r\n        const request = toRequest(key);\r\n        // Run in the next task to avoid blocking other cache reads.\r\n        // https://github.com/w3c/ServiceWorker/issues/1397\r\n        await timeout(0);\r\n        const effectiveRequest = await this.getCacheKey(request, 'write');\r\n        {\r\n          if (effectiveRequest.method && effectiveRequest.method !== 'GET') {\r\n            throw new WorkboxError('attempt-to-cache-non-get-request', {\r\n              url: getFriendlyURL(effectiveRequest.url),\r\n              method: effectiveRequest.method\r\n            });\r\n          }\r\n          // See https://github.com/GoogleChrome/workbox/issues/2818\r\n          const vary = response.headers.get('Vary');\r\n          if (vary) {\r\n            logger.debug(`The response for ${getFriendlyURL(effectiveRequest.url)} ` + `has a 'Vary: ${vary}' header. ` + `Consider setting the {ignoreVary: true} option on your strategy ` + `to ensure cache matching and deletion works as expected.`);\r\n          }\r\n        }\r\n        if (!response) {\r\n          {\r\n            logger.error(`Cannot cache non-existent response for ` + `'${getFriendlyURL(effectiveRequest.url)}'.`);\r\n          }\r\n          throw new WorkboxError('cache-put-with-no-response', {\r\n            url: getFriendlyURL(effectiveRequest.url)\r\n          });\r\n        }\r\n        const responseToCache = await this._ensureResponseSafeToCache(response);\r\n        if (!responseToCache) {\r\n          {\r\n            logger.debug(`Response '${getFriendlyURL(effectiveRequest.url)}' ` + `will not be cached.`, responseToCache);\r\n          }\r\n          return false;\r\n        }\r\n        const {\r\n          cacheName,\r\n          matchOptions\r\n        } = this._strategy;\r\n        const cache = await self.caches.open(cacheName);\r\n        const hasCacheUpdateCallback = this.hasCallback('cacheDidUpdate');\r\n        const oldResponse = hasCacheUpdateCallback ? await cacheMatchIgnoreParams(\r\n        // TODO(philipwalton): the `__WB_REVISION__` param is a precaching\r\n        // feature. Consider into ways to only add this behavior if using\r\n        // precaching.\r\n        cache, effectiveRequest.clone(), ['__WB_REVISION__'], matchOptions) : null;\r\n        {\r\n          logger.debug(`Updating the '${cacheName}' cache with a new Response ` + `for ${getFriendlyURL(effectiveRequest.url)}.`);\r\n        }\r\n        try {\r\n          await cache.put(effectiveRequest, hasCacheUpdateCallback ? responseToCache.clone() : responseToCache);\r\n        } catch (error) {\r\n          if (error instanceof Error) {\r\n            // See https://developer.mozilla.org/en-US/docs/Web/API/DOMException#exception-QuotaExceededError\r\n            if (error.name === 'QuotaExceededError') {\r\n              await executeQuotaErrorCallbacks();\r\n            }\r\n            throw error;\r\n          }\r\n        }\r\n        for (const callback of this.iterateCallbacks('cacheDidUpdate')) {\r\n          await callback({\r\n            cacheName,\r\n            oldResponse,\r\n            newResponse: responseToCache.clone(),\r\n            request: effectiveRequest,\r\n            event: this.event\r\n          });\r\n        }\r\n        return true;\r\n      }\r\n      /**\r\n       * Checks the list of plugins for the `cacheKeyWillBeUsed` callback, and\r\n       * executes any of those callbacks found in sequence. The final `Request`\r\n       * object returned by the last plugin is treated as the cache key for cache\r\n       * reads and/or writes. If no `cacheKeyWillBeUsed` plugin callbacks have\r\n       * been registered, the passed request is returned unmodified\r\n       *\r\n       * @param {Request} request\r\n       * @param {string} mode\r\n       * @return {Promise<Request>}\r\n       */\r\n      async getCacheKey(request, mode) {\r\n        const key = `${request.url} | ${mode}`;\r\n        if (!this._cacheKeys[key]) {\r\n          let effectiveRequest = request;\r\n          for (const callback of this.iterateCallbacks('cacheKeyWillBeUsed')) {\r\n            effectiveRequest = toRequest(await callback({\r\n              mode,\r\n              request: effectiveRequest,\r\n              event: this.event,\r\n              // params has a type any can't change right now.\r\n              params: this.params  \r\n            }));\r\n          }\r\n          this._cacheKeys[key] = effectiveRequest;\r\n        }\r\n        return this._cacheKeys[key];\r\n      }\r\n      /**\r\n       * Returns true if the strategy has at least one plugin with the given\r\n       * callback.\r\n       *\r\n       * @param {string} name The name of the callback to check for.\r\n       * @return {boolean}\r\n       */\r\n      hasCallback(name) {\r\n        for (const plugin of this._strategy.plugins) {\r\n          if (name in plugin) {\r\n            return true;\r\n          }\r\n        }\r\n        return false;\r\n      }\r\n      /**\r\n       * Runs all plugin callbacks matching the given name, in order, passing the\r\n       * given param object (merged ith the current plugin state) as the only\r\n       * argument.\r\n       *\r\n       * Note: since this method runs all plugins, it's not suitable for cases\r\n       * where the return value of a callback needs to be applied prior to calling\r\n       * the next callback. See\r\n       * {@link workbox-strategies.StrategyHandler#iterateCallbacks}\r\n       * below for how to handle that case.\r\n       *\r\n       * @param {string} name The name of the callback to run within each plugin.\r\n       * @param {Object} param The object to pass as the first (and only) param\r\n       *     when executing each callback. This object will be merged with the\r\n       *     current plugin state prior to callback execution.\r\n       */\r\n      async runCallbacks(name, param) {\r\n        for (const callback of this.iterateCallbacks(name)) {\r\n          // TODO(philipwalton): not sure why `any` is needed. It seems like\r\n          // this should work with `as WorkboxPluginCallbackParam[C]`.\r\n          await callback(param);\r\n        }\r\n      }\r\n      /**\r\n       * Accepts a callback and returns an iterable of matching plugin callbacks,\r\n       * where each callback is wrapped with the current handler state (i.e. when\r\n       * you call each callback, whatever object parameter you pass it will\r\n       * be merged with the plugin's current state).\r\n       *\r\n       * @param {string} name The name fo the callback to run\r\n       * @return {Array<Function>}\r\n       */\r\n      *iterateCallbacks(name) {\r\n        for (const plugin of this._strategy.plugins) {\r\n          if (typeof plugin[name] === 'function') {\r\n            const state = this._pluginStateMap.get(plugin);\r\n            const statefulCallback = param => {\r\n              const statefulParam = Object.assign(Object.assign({}, param), {\r\n                state\r\n              });\r\n              // TODO(philipwalton): not sure why `any` is needed. It seems like\r\n              // this should work with `as WorkboxPluginCallbackParam[C]`.\r\n              return plugin[name](statefulParam);\r\n            };\r\n            yield statefulCallback;\r\n          }\r\n        }\r\n      }\r\n      /**\r\n       * Adds a promise to the\r\n       * [extend lifetime promises]{@link https://w3c.github.io/ServiceWorker/#extendableevent-extend-lifetime-promises}\r\n       * of the event associated with the request being handled (usually a\r\n       * `FetchEvent`).\r\n       *\r\n       * Note: you can await\r\n       * {@link workbox-strategies.StrategyHandler~doneWaiting}\r\n       * to know when all added promises have settled.\r\n       *\r\n       * @param {Promise} promise A promise to add to the extend lifetime promises\r\n       *     of the event that triggered the request.\r\n       */\r\n      waitUntil(promise) {\r\n        this._extendLifetimePromises.push(promise);\r\n        return promise;\r\n      }\r\n      /**\r\n       * Returns a promise that resolves once all promises passed to\r\n       * {@link workbox-strategies.StrategyHandler~waitUntil}\r\n       * have settled.\r\n       *\r\n       * Note: any work done after `doneWaiting()` settles should be manually\r\n       * passed to an event's `waitUntil()` method (not this handler's\r\n       * `waitUntil()` method), otherwise the service worker thread may be killed\r\n       * prior to your work completing.\r\n       */\r\n      async doneWaiting() {\r\n        while (this._extendLifetimePromises.length) {\r\n          const promises = this._extendLifetimePromises.splice(0);\r\n          const result = await Promise.allSettled(promises);\r\n          const firstRejection = result.find(i => i.status === 'rejected');\r\n          if (firstRejection) {\r\n            throw firstRejection.reason;\r\n          }\r\n        }\r\n      }\r\n      /**\r\n       * Stops running the strategy and immediately resolves any pending\r\n       * `waitUntil()` promises.\r\n       */\r\n      destroy() {\r\n        this._handlerDeferred.resolve(null);\r\n      }\r\n      /**\r\n       * This method will call cacheWillUpdate on the available plugins (or use\r\n       * status === 200) to determine if the Response is safe and valid to cache.\r\n       *\r\n       * @param {Request} options.request\r\n       * @param {Response} options.response\r\n       * @return {Promise<Response|undefined>}\r\n       *\r\n       * @private\r\n       */\r\n      async _ensureResponseSafeToCache(response) {\r\n        let responseToCache = response;\r\n        let pluginsUsed = false;\r\n        for (const callback of this.iterateCallbacks('cacheWillUpdate')) {\r\n          responseToCache = (await callback({\r\n            request: this.request,\r\n            response: responseToCache,\r\n            event: this.event\r\n          })) || undefined;\r\n          pluginsUsed = true;\r\n          if (!responseToCache) {\r\n            break;\r\n          }\r\n        }\r\n        if (!pluginsUsed) {\r\n          if (responseToCache && responseToCache.status !== 200) {\r\n            responseToCache = undefined;\r\n          }\r\n          {\r\n            if (responseToCache) {\r\n              if (responseToCache.status !== 200) {\r\n                if (responseToCache.status === 0) {\r\n                  logger.warn(`The response for '${this.request.url}' ` + `is an opaque response. The caching strategy that you're ` + `using will not cache opaque responses by default.`);\r\n                } else {\r\n                  logger.debug(`The response for '${this.request.url}' ` + `returned a status code of '${response.status}' and won't ` + `be cached as a result.`);\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n        return responseToCache;\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * An abstract base class that all other strategy classes must extend from:\r\n     *\r\n     * @memberof workbox-strategies\r\n     */\r\n    class Strategy {\r\n      /**\r\n       * Creates a new instance of the strategy and sets all documented option\r\n       * properties as public instance properties.\r\n       *\r\n       * Note: if a custom strategy class extends the base Strategy class and does\r\n       * not need more than these properties, it does not need to define its own\r\n       * constructor.\r\n       *\r\n       * @param {Object} [options]\r\n       * @param {string} [options.cacheName] Cache name to store and retrieve\r\n       * requests. Defaults to the cache names provided by\r\n       * {@link workbox-core.cacheNames}.\r\n       * @param {Array<Object>} [options.plugins] [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}\r\n       * to use in conjunction with this caching strategy.\r\n       * @param {Object} [options.fetchOptions] Values passed along to the\r\n       * [`init`](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters)\r\n       * of [non-navigation](https://github.com/GoogleChrome/workbox/issues/1796)\r\n       * `fetch()` requests made by this strategy.\r\n       * @param {Object} [options.matchOptions] The\r\n       * [`CacheQueryOptions`]{@link https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions}\r\n       * for any `cache.match()` or `cache.put()` calls made by this strategy.\r\n       */\r\n      constructor(options = {}) {\r\n        /**\r\n         * Cache name to store and retrieve\r\n         * requests. Defaults to the cache names provided by\r\n         * {@link workbox-core.cacheNames}.\r\n         *\r\n         * @type {string}\r\n         */\r\n        this.cacheName = cacheNames.getRuntimeName(options.cacheName);\r\n        /**\r\n         * The list\r\n         * [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}\r\n         * used by this strategy.\r\n         *\r\n         * @type {Array<Object>}\r\n         */\r\n        this.plugins = options.plugins || [];\r\n        /**\r\n         * Values passed along to the\r\n         * [`init`]{@link https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters}\r\n         * of all fetch() requests made by this strategy.\r\n         *\r\n         * @type {Object}\r\n         */\r\n        this.fetchOptions = options.fetchOptions;\r\n        /**\r\n         * The\r\n         * [`CacheQueryOptions`]{@link https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions}\r\n         * for any `cache.match()` or `cache.put()` calls made by this strategy.\r\n         *\r\n         * @type {Object}\r\n         */\r\n        this.matchOptions = options.matchOptions;\r\n      }\r\n      /**\r\n       * Perform a request strategy and returns a `Promise` that will resolve with\r\n       * a `Response`, invoking all relevant plugin callbacks.\r\n       *\r\n       * When a strategy instance is registered with a Workbox\r\n       * {@link workbox-routing.Route}, this method is automatically\r\n       * called when the route matches.\r\n       *\r\n       * Alternatively, this method can be used in a standalone `FetchEvent`\r\n       * listener by passing it to `event.respondWith()`.\r\n       *\r\n       * @param {FetchEvent|Object} options A `FetchEvent` or an object with the\r\n       *     properties listed below.\r\n       * @param {Request|string} options.request A request to run this strategy for.\r\n       * @param {ExtendableEvent} options.event The event associated with the\r\n       *     request.\r\n       * @param {URL} [options.url]\r\n       * @param {*} [options.params]\r\n       */\r\n      handle(options) {\r\n        const [responseDone] = this.handleAll(options);\r\n        return responseDone;\r\n      }\r\n      /**\r\n       * Similar to {@link workbox-strategies.Strategy~handle}, but\r\n       * instead of just returning a `Promise` that resolves to a `Response` it\r\n       * it will return an tuple of `[response, done]` promises, where the former\r\n       * (`response`) is equivalent to what `handle()` returns, and the latter is a\r\n       * Promise that will resolve once any promises that were added to\r\n       * `event.waitUntil()` as part of performing the strategy have completed.\r\n       *\r\n       * You can await the `done` promise to ensure any extra work performed by\r\n       * the strategy (usually caching responses) completes successfully.\r\n       *\r\n       * @param {FetchEvent|Object} options A `FetchEvent` or an object with the\r\n       *     properties listed below.\r\n       * @param {Request|string} options.request A request to run this strategy for.\r\n       * @param {ExtendableEvent} options.event The event associated with the\r\n       *     request.\r\n       * @param {URL} [options.url]\r\n       * @param {*} [options.params]\r\n       * @return {Array<Promise>} A tuple of [response, done]\r\n       *     promises that can be used to determine when the response resolves as\r\n       *     well as when the handler has completed all its work.\r\n       */\r\n      handleAll(options) {\r\n        // Allow for flexible options to be passed.\r\n        if (options instanceof FetchEvent) {\r\n          options = {\r\n            event: options,\r\n            request: options.request\r\n          };\r\n        }\r\n        const event = options.event;\r\n        const request = typeof options.request === 'string' ? new Request(options.request) : options.request;\r\n        const params = 'params' in options ? options.params : undefined;\r\n        const handler = new StrategyHandler(this, {\r\n          event,\r\n          request,\r\n          params\r\n        });\r\n        const responseDone = this._getResponse(handler, request, event);\r\n        const handlerDone = this._awaitComplete(responseDone, handler, request, event);\r\n        // Return an array of promises, suitable for use with Promise.all().\r\n        return [responseDone, handlerDone];\r\n      }\r\n      async _getResponse(handler, request, event) {\r\n        await handler.runCallbacks('handlerWillStart', {\r\n          event,\r\n          request\r\n        });\r\n        let response = undefined;\r\n        try {\r\n          response = await this._handle(request, handler);\r\n          // The \"official\" Strategy subclasses all throw this error automatically,\r\n          // but in case a third-party Strategy doesn't, ensure that we have a\r\n          // consistent failure when there's no response or an error response.\r\n          if (!response || response.type === 'error') {\r\n            throw new WorkboxError('no-response', {\r\n              url: request.url\r\n            });\r\n          }\r\n        } catch (error) {\r\n          if (error instanceof Error) {\r\n            for (const callback of handler.iterateCallbacks('handlerDidError')) {\r\n              response = await callback({\r\n                error,\r\n                event,\r\n                request\r\n              });\r\n              if (response) {\r\n                break;\r\n              }\r\n            }\r\n          }\r\n          if (!response) {\r\n            throw error;\r\n          } else {\r\n            logger.log(`While responding to '${getFriendlyURL(request.url)}', ` + `an ${error instanceof Error ? error.toString() : ''} error occurred. Using a fallback response provided by ` + `a handlerDidError plugin.`);\r\n          }\r\n        }\r\n        for (const callback of handler.iterateCallbacks('handlerWillRespond')) {\r\n          response = await callback({\r\n            event,\r\n            request,\r\n            response\r\n          });\r\n        }\r\n        return response;\r\n      }\r\n      async _awaitComplete(responseDone, handler, request, event) {\r\n        let response;\r\n        let error;\r\n        try {\r\n          response = await responseDone;\r\n        } catch (error) {\r\n          // Ignore errors, as response errors should be caught via the `response`\r\n          // promise above. The `done` promise will only throw for errors in\r\n          // promises passed to `handler.waitUntil()`.\r\n        }\r\n        try {\r\n          await handler.runCallbacks('handlerDidRespond', {\r\n            event,\r\n            request,\r\n            response\r\n          });\r\n          await handler.doneWaiting();\r\n        } catch (waitUntilError) {\r\n          if (waitUntilError instanceof Error) {\r\n            error = waitUntilError;\r\n          }\r\n        }\r\n        await handler.runCallbacks('handlerDidComplete', {\r\n          event,\r\n          request,\r\n          response,\r\n          error: error\r\n        });\r\n        handler.destroy();\r\n        if (error) {\r\n          throw error;\r\n        }\r\n      }\r\n    }\r\n    /**\r\n     * Classes extending the `Strategy` based class should implement this method,\r\n     * and leverage the {@link workbox-strategies.StrategyHandler}\r\n     * arg to perform all fetching and cache logic, which will ensure all relevant\r\n     * cache, cache options, fetch options and plugins are used (per the current\r\n     * strategy instance).\r\n     *\r\n     * @name _handle\r\n     * @instance\r\n     * @abstract\r\n     * @function\r\n     * @param {Request} request\r\n     * @param {workbox-strategies.StrategyHandler} handler\r\n     * @return {Promise<Response>}\r\n     *\r\n     * @memberof workbox-strategies.Strategy\r\n     */\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A {@link workbox-strategies.Strategy} implementation\r\n     * specifically designed to work with\r\n     * {@link workbox-precaching.PrecacheController}\r\n     * to both cache and fetch precached assets.\r\n     *\r\n     * Note: an instance of this class is created automatically when creating a\r\n     * `PrecacheController`; it's generally not necessary to create this yourself.\r\n     *\r\n     * @extends workbox-strategies.Strategy\r\n     * @memberof workbox-precaching\r\n     */\r\n    class PrecacheStrategy extends Strategy {\r\n      /**\r\n       *\r\n       * @param {Object} [options]\r\n       * @param {string} [options.cacheName] Cache name to store and retrieve\r\n       * requests. Defaults to the cache names provided by\r\n       * {@link workbox-core.cacheNames}.\r\n       * @param {Array<Object>} [options.plugins] {@link https://developers.google.com/web/tools/workbox/guides/using-plugins|Plugins}\r\n       * to use in conjunction with this caching strategy.\r\n       * @param {Object} [options.fetchOptions] Values passed along to the\r\n       * {@link https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters|init}\r\n       * of all fetch() requests made by this strategy.\r\n       * @param {Object} [options.matchOptions] The\r\n       * {@link https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions|CacheQueryOptions}\r\n       * for any `cache.match()` or `cache.put()` calls made by this strategy.\r\n       * @param {boolean} [options.fallbackToNetwork=true] Whether to attempt to\r\n       * get the response from the network if there's a precache miss.\r\n       */\r\n      constructor(options = {}) {\r\n        options.cacheName = cacheNames.getPrecacheName(options.cacheName);\r\n        super(options);\r\n        this._fallbackToNetwork = options.fallbackToNetwork === false ? false : true;\r\n        // Redirected responses cannot be used to satisfy a navigation request, so\r\n        // any redirected response must be \"copied\" rather than cloned, so the new\r\n        // response doesn't contain the `redirected` flag. See:\r\n        // https://bugs.chromium.org/p/chromium/issues/detail?id=669363&desc=2#c1\r\n        this.plugins.push(PrecacheStrategy.copyRedirectedCacheableResponsesPlugin);\r\n      }\r\n      /**\r\n       * @private\r\n       * @param {Request|string} request A request to run this strategy for.\r\n       * @param {workbox-strategies.StrategyHandler} handler The event that\r\n       *     triggered the request.\r\n       * @return {Promise<Response>}\r\n       */\r\n      async _handle(request, handler) {\r\n        const response = await handler.cacheMatch(request);\r\n        if (response) {\r\n          return response;\r\n        }\r\n        // If this is an `install` event for an entry that isn't already cached,\r\n        // then populate the cache.\r\n        if (handler.event && handler.event.type === 'install') {\r\n          return await this._handleInstall(request, handler);\r\n        }\r\n        // Getting here means something went wrong. An entry that should have been\r\n        // precached wasn't found in the cache.\r\n        return await this._handleFetch(request, handler);\r\n      }\r\n      async _handleFetch(request, handler) {\r\n        let response;\r\n        const params = handler.params || {};\r\n        // Fall back to the network if we're configured to do so.\r\n        if (this._fallbackToNetwork) {\r\n          {\r\n            logger.warn(`The precached response for ` + `${getFriendlyURL(request.url)} in ${this.cacheName} was not ` + `found. Falling back to the network.`);\r\n          }\r\n          const integrityInManifest = params.integrity;\r\n          const integrityInRequest = request.integrity;\r\n          const noIntegrityConflict = !integrityInRequest || integrityInRequest === integrityInManifest;\r\n          // Do not add integrity if the original request is no-cors\r\n          // See https://github.com/GoogleChrome/workbox/issues/3096\r\n          response = await handler.fetch(new Request(request, {\r\n            integrity: request.mode !== 'no-cors' ? integrityInRequest || integrityInManifest : undefined\r\n          }));\r\n          // It's only \"safe\" to repair the cache if we're using SRI to guarantee\r\n          // that the response matches the precache manifest's expectations,\r\n          // and there's either a) no integrity property in the incoming request\r\n          // or b) there is an integrity, and it matches the precache manifest.\r\n          // See https://github.com/GoogleChrome/workbox/issues/2858\r\n          // Also if the original request users no-cors we don't use integrity.\r\n          // See https://github.com/GoogleChrome/workbox/issues/3096\r\n          if (integrityInManifest && noIntegrityConflict && request.mode !== 'no-cors') {\r\n            this._useDefaultCacheabilityPluginIfNeeded();\r\n            const wasCached = await handler.cachePut(request, response.clone());\r\n            {\r\n              if (wasCached) {\r\n                logger.log(`A response for ${getFriendlyURL(request.url)} ` + `was used to \"repair\" the precache.`);\r\n              }\r\n            }\r\n          }\r\n        } else {\r\n          // This shouldn't normally happen, but there are edge cases:\r\n          // https://github.com/GoogleChrome/workbox/issues/1441\r\n          throw new WorkboxError('missing-precache-entry', {\r\n            cacheName: this.cacheName,\r\n            url: request.url\r\n          });\r\n        }\r\n        {\r\n          const cacheKey = params.cacheKey || (await handler.getCacheKey(request, 'read'));\r\n          // Workbox is going to handle the route.\r\n          // print the routing details to the console.\r\n          logger.groupCollapsed(`Precaching is responding to: ` + getFriendlyURL(request.url));\r\n          logger.log(`Serving the precached url: ${getFriendlyURL(cacheKey instanceof Request ? cacheKey.url : cacheKey)}`);\r\n          logger.groupCollapsed(`View request details here.`);\r\n          logger.log(request);\r\n          logger.groupEnd();\r\n          logger.groupCollapsed(`View response details here.`);\r\n          logger.log(response);\r\n          logger.groupEnd();\r\n          logger.groupEnd();\r\n        }\r\n        return response;\r\n      }\r\n      async _handleInstall(request, handler) {\r\n        this._useDefaultCacheabilityPluginIfNeeded();\r\n        const response = await handler.fetch(request);\r\n        // Make sure we defer cachePut() until after we know the response\r\n        // should be cached; see https://github.com/GoogleChrome/workbox/issues/2737\r\n        const wasCached = await handler.cachePut(request, response.clone());\r\n        if (!wasCached) {\r\n          // Throwing here will lead to the `install` handler failing, which\r\n          // we want to do if *any* of the responses aren't safe to cache.\r\n          throw new WorkboxError('bad-precaching-response', {\r\n            url: request.url,\r\n            status: response.status\r\n          });\r\n        }\r\n        return response;\r\n      }\r\n      /**\r\n       * This method is complex, as there a number of things to account for:\r\n       *\r\n       * The `plugins` array can be set at construction, and/or it might be added to\r\n       * to at any time before the strategy is used.\r\n       *\r\n       * At the time the strategy is used (i.e. during an `install` event), there\r\n       * needs to be at least one plugin that implements `cacheWillUpdate` in the\r\n       * array, other than `copyRedirectedCacheableResponsesPlugin`.\r\n       *\r\n       * - If this method is called and there are no suitable `cacheWillUpdate`\r\n       * plugins, we need to add `defaultPrecacheCacheabilityPlugin`.\r\n       *\r\n       * - If this method is called and there is exactly one `cacheWillUpdate`, then\r\n       * we don't have to do anything (this might be a previously added\r\n       * `defaultPrecacheCacheabilityPlugin`, or it might be a custom plugin).\r\n       *\r\n       * - If this method is called and there is more than one `cacheWillUpdate`,\r\n       * then we need to check if one is `defaultPrecacheCacheabilityPlugin`. If so,\r\n       * we need to remove it. (This situation is unlikely, but it could happen if\r\n       * the strategy is used multiple times, the first without a `cacheWillUpdate`,\r\n       * and then later on after manually adding a custom `cacheWillUpdate`.)\r\n       *\r\n       * See https://github.com/GoogleChrome/workbox/issues/2737 for more context.\r\n       *\r\n       * @private\r\n       */\r\n      _useDefaultCacheabilityPluginIfNeeded() {\r\n        let defaultPluginIndex = null;\r\n        let cacheWillUpdatePluginCount = 0;\r\n        for (const [index, plugin] of this.plugins.entries()) {\r\n          // Ignore the copy redirected plugin when determining what to do.\r\n          if (plugin === PrecacheStrategy.copyRedirectedCacheableResponsesPlugin) {\r\n            continue;\r\n          }\r\n          // Save the default plugin's index, in case it needs to be removed.\r\n          if (plugin === PrecacheStrategy.defaultPrecacheCacheabilityPlugin) {\r\n            defaultPluginIndex = index;\r\n          }\r\n          if (plugin.cacheWillUpdate) {\r\n            cacheWillUpdatePluginCount++;\r\n          }\r\n        }\r\n        if (cacheWillUpdatePluginCount === 0) {\r\n          this.plugins.push(PrecacheStrategy.defaultPrecacheCacheabilityPlugin);\r\n        } else if (cacheWillUpdatePluginCount > 1 && defaultPluginIndex !== null) {\r\n          // Only remove the default plugin; multiple custom plugins are allowed.\r\n          this.plugins.splice(defaultPluginIndex, 1);\r\n        }\r\n        // Nothing needs to be done if cacheWillUpdatePluginCount is 1\r\n      }\r\n    }\r\n    PrecacheStrategy.defaultPrecacheCacheabilityPlugin = {\r\n      async cacheWillUpdate({\r\n        response\r\n      }) {\r\n        if (!response || response.status >= 400) {\r\n          return null;\r\n        }\r\n        return response;\r\n      }\r\n    };\r\n    PrecacheStrategy.copyRedirectedCacheableResponsesPlugin = {\r\n      async cacheWillUpdate({\r\n        response\r\n      }) {\r\n        return response.redirected ? await copyResponse(response) : response;\r\n      }\r\n    };\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Performs efficient precaching of assets.\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    class PrecacheController {\r\n      /**\r\n       * Create a new PrecacheController.\r\n       *\r\n       * @param {Object} [options]\r\n       * @param {string} [options.cacheName] The cache to use for precaching.\r\n       * @param {string} [options.plugins] Plugins to use when precaching as well\r\n       * as responding to fetch events for precached assets.\r\n       * @param {boolean} [options.fallbackToNetwork=true] Whether to attempt to\r\n       * get the response from the network if there's a precache miss.\r\n       */\r\n      constructor({\r\n        cacheName,\r\n        plugins = [],\r\n        fallbackToNetwork = true\r\n      } = {}) {\r\n        this._urlsToCacheKeys = new Map();\r\n        this._urlsToCacheModes = new Map();\r\n        this._cacheKeysToIntegrities = new Map();\r\n        this._strategy = new PrecacheStrategy({\r\n          cacheName: cacheNames.getPrecacheName(cacheName),\r\n          plugins: [...plugins, new PrecacheCacheKeyPlugin({\r\n            precacheController: this\r\n          })],\r\n          fallbackToNetwork\r\n        });\r\n        // Bind the install and activate methods to the instance.\r\n        this.install = this.install.bind(this);\r\n        this.activate = this.activate.bind(this);\r\n      }\r\n      /**\r\n       * @type {workbox-precaching.PrecacheStrategy} The strategy created by this controller and\r\n       * used to cache assets and respond to fetch events.\r\n       */\r\n      get strategy() {\r\n        return this._strategy;\r\n      }\r\n      /**\r\n       * Adds items to the precache list, removing any duplicates and\r\n       * stores the files in the\r\n       * {@link workbox-core.cacheNames|\"precache cache\"} when the service\r\n       * worker installs.\r\n       *\r\n       * This method can be called multiple times.\r\n       *\r\n       * @param {Array<Object|string>} [entries=[]] Array of entries to precache.\r\n       */\r\n      precache(entries) {\r\n        this.addToCacheList(entries);\r\n        if (!this._installAndActiveListenersAdded) {\r\n          self.addEventListener('install', this.install);\r\n          self.addEventListener('activate', this.activate);\r\n          this._installAndActiveListenersAdded = true;\r\n        }\r\n      }\r\n      /**\r\n       * This method will add items to the precache list, removing duplicates\r\n       * and ensuring the information is valid.\r\n       *\r\n       * @param {Array<workbox-precaching.PrecacheController.PrecacheEntry|string>} entries\r\n       *     Array of entries to precache.\r\n       */\r\n      addToCacheList(entries) {\r\n        {\r\n          finalAssertExports.isArray(entries, {\r\n            moduleName: 'workbox-precaching',\r\n            className: 'PrecacheController',\r\n            funcName: 'addToCacheList',\r\n            paramName: 'entries'\r\n          });\r\n        }\r\n        const urlsToWarnAbout = [];\r\n        for (const entry of entries) {\r\n          // See https://github.com/GoogleChrome/workbox/issues/2259\r\n          if (typeof entry === 'string') {\r\n            urlsToWarnAbout.push(entry);\r\n          } else if (entry && entry.revision === undefined) {\r\n            urlsToWarnAbout.push(entry.url);\r\n          }\r\n          const {\r\n            cacheKey,\r\n            url\r\n          } = createCacheKey(entry);\r\n          const cacheMode = typeof entry !== 'string' && entry.revision ? 'reload' : 'default';\r\n          if (this._urlsToCacheKeys.has(url) && this._urlsToCacheKeys.get(url) !== cacheKey) {\r\n            throw new WorkboxError('add-to-cache-list-conflicting-entries', {\r\n              firstEntry: this._urlsToCacheKeys.get(url),\r\n              secondEntry: cacheKey\r\n            });\r\n          }\r\n          if (typeof entry !== 'string' && entry.integrity) {\r\n            if (this._cacheKeysToIntegrities.has(cacheKey) && this._cacheKeysToIntegrities.get(cacheKey) !== entry.integrity) {\r\n              throw new WorkboxError('add-to-cache-list-conflicting-integrities', {\r\n                url\r\n              });\r\n            }\r\n            this._cacheKeysToIntegrities.set(cacheKey, entry.integrity);\r\n          }\r\n          this._urlsToCacheKeys.set(url, cacheKey);\r\n          this._urlsToCacheModes.set(url, cacheMode);\r\n          if (urlsToWarnAbout.length > 0) {\r\n            const warningMessage = `Workbox is precaching URLs without revision ` + `info: ${urlsToWarnAbout.join(', ')}\\nThis is generally NOT safe. ` + `Learn more at https://bit.ly/wb-precache`;\r\n            {\r\n              logger.warn(warningMessage);\r\n            }\r\n          }\r\n        }\r\n      }\r\n      /**\r\n       * Precaches new and updated assets. Call this method from the service worker\r\n       * install event.\r\n       *\r\n       * Note: this method calls `event.waitUntil()` for you, so you do not need\r\n       * to call it yourself in your event handlers.\r\n       *\r\n       * @param {ExtendableEvent} event\r\n       * @return {Promise<workbox-precaching.InstallResult>}\r\n       */\r\n      install(event) {\r\n        // waitUntil returns Promise<any>\r\n         \r\n        return waitUntil(event, async () => {\r\n          const installReportPlugin = new PrecacheInstallReportPlugin();\r\n          this.strategy.plugins.push(installReportPlugin);\r\n          // Cache entries one at a time.\r\n          // See https://github.com/GoogleChrome/workbox/issues/2528\r\n          for (const [url, cacheKey] of this._urlsToCacheKeys) {\r\n            const integrity = this._cacheKeysToIntegrities.get(cacheKey);\r\n            const cacheMode = this._urlsToCacheModes.get(url);\r\n            const request = new Request(url, {\r\n              integrity,\r\n              cache: cacheMode,\r\n              credentials: 'same-origin'\r\n            });\r\n            await Promise.all(this.strategy.handleAll({\r\n              params: {\r\n                cacheKey\r\n              },\r\n              request,\r\n              event\r\n            }));\r\n          }\r\n          const {\r\n            updatedURLs,\r\n            notUpdatedURLs\r\n          } = installReportPlugin;\r\n          {\r\n            printInstallDetails(updatedURLs, notUpdatedURLs);\r\n          }\r\n          return {\r\n            updatedURLs,\r\n            notUpdatedURLs\r\n          };\r\n        });\r\n      }\r\n      /**\r\n       * Deletes assets that are no longer present in the current precache manifest.\r\n       * Call this method from the service worker activate event.\r\n       *\r\n       * Note: this method calls `event.waitUntil()` for you, so you do not need\r\n       * to call it yourself in your event handlers.\r\n       *\r\n       * @param {ExtendableEvent} event\r\n       * @return {Promise<workbox-precaching.CleanupResult>}\r\n       */\r\n      activate(event) {\r\n        // waitUntil returns Promise<any>\r\n         \r\n        return waitUntil(event, async () => {\r\n          const cache = await self.caches.open(this.strategy.cacheName);\r\n          const currentlyCachedRequests = await cache.keys();\r\n          const expectedCacheKeys = new Set(this._urlsToCacheKeys.values());\r\n          const deletedURLs = [];\r\n          for (const request of currentlyCachedRequests) {\r\n            if (!expectedCacheKeys.has(request.url)) {\r\n              await cache.delete(request);\r\n              deletedURLs.push(request.url);\r\n            }\r\n          }\r\n          {\r\n            printCleanupDetails(deletedURLs);\r\n          }\r\n          return {\r\n            deletedURLs\r\n          };\r\n        });\r\n      }\r\n      /**\r\n       * Returns a mapping of a precached URL to the corresponding cache key, taking\r\n       * into account the revision information for the URL.\r\n       *\r\n       * @return {Map<string, string>} A URL to cache key mapping.\r\n       */\r\n      getURLsToCacheKeys() {\r\n        return this._urlsToCacheKeys;\r\n      }\r\n      /**\r\n       * Returns a list of all the URLs that have been precached by the current\r\n       * service worker.\r\n       *\r\n       * @return {Array<string>} The precached URLs.\r\n       */\r\n      getCachedURLs() {\r\n        return [...this._urlsToCacheKeys.keys()];\r\n      }\r\n      /**\r\n       * Returns the cache key used for storing a given URL. If that URL is\r\n       * unversioned, like `/index.html', then the cache key will be the original\r\n       * URL with a search parameter appended to it.\r\n       *\r\n       * @param {string} url A URL whose cache key you want to look up.\r\n       * @return {string} The versioned URL that corresponds to a cache key\r\n       * for the original URL, or undefined if that URL isn't precached.\r\n       */\r\n      getCacheKeyForURL(url) {\r\n        const urlObject = new URL(url, location.href);\r\n        return this._urlsToCacheKeys.get(urlObject.href);\r\n      }\r\n      /**\r\n       * @param {string} url A cache key whose SRI you want to look up.\r\n       * @return {string} The subresource integrity associated with the cache key,\r\n       * or undefined if it's not set.\r\n       */\r\n      getIntegrityForCacheKey(cacheKey) {\r\n        return this._cacheKeysToIntegrities.get(cacheKey);\r\n      }\r\n      /**\r\n       * This acts as a drop-in replacement for\r\n       * [`cache.match()`](https://developer.mozilla.org/en-US/docs/Web/API/Cache/match)\r\n       * with the following differences:\r\n       *\r\n       * - It knows what the name of the precache is, and only checks in that cache.\r\n       * - It allows you to pass in an \"original\" URL without versioning parameters,\r\n       * and it will automatically look up the correct cache key for the currently\r\n       * active revision of that URL.\r\n       *\r\n       * E.g., `matchPrecache('index.html')` will find the correct precached\r\n       * response for the currently active service worker, even if the actual cache\r\n       * key is `'/index.html?__WB_REVISION__=1234abcd'`.\r\n       *\r\n       * @param {string|Request} request The key (without revisioning parameters)\r\n       * to look up in the precache.\r\n       * @return {Promise<Response|undefined>}\r\n       */\r\n      async matchPrecache(request) {\r\n        const url = request instanceof Request ? request.url : request;\r\n        const cacheKey = this.getCacheKeyForURL(url);\r\n        if (cacheKey) {\r\n          const cache = await self.caches.open(this.strategy.cacheName);\r\n          return cache.match(cacheKey);\r\n        }\r\n        return undefined;\r\n      }\r\n      /**\r\n       * Returns a function that looks up `url` in the precache (taking into\r\n       * account revision information), and returns the corresponding `Response`.\r\n       *\r\n       * @param {string} url The precached URL which will be used to lookup the\r\n       * `Response`.\r\n       * @return {workbox-routing~handlerCallback}\r\n       */\r\n      createHandlerBoundToURL(url) {\r\n        const cacheKey = this.getCacheKeyForURL(url);\r\n        if (!cacheKey) {\r\n          throw new WorkboxError('non-precached-url', {\r\n            url\r\n          });\r\n        }\r\n        return options => {\r\n          options.request = new Request(url);\r\n          options.params = Object.assign({\r\n            cacheKey\r\n          }, options.params);\r\n          return this.strategy.handle(options);\r\n        };\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    let precacheController;\r\n    /**\r\n     * @return {PrecacheController}\r\n     * @private\r\n     */\r\n    const getOrCreatePrecacheController = () => {\r\n      if (!precacheController) {\r\n        precacheController = new PrecacheController();\r\n      }\r\n      return precacheController;\r\n    };\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Removes any URL search parameters that should be ignored.\r\n     *\r\n     * @param {URL} urlObject The original URL.\r\n     * @param {Array<RegExp>} ignoreURLParametersMatching RegExps to test against\r\n     * each search parameter name. Matches mean that the search parameter should be\r\n     * ignored.\r\n     * @return {URL} The URL with any ignored search parameters removed.\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    function removeIgnoredSearchParams(urlObject, ignoreURLParametersMatching = []) {\r\n      // Convert the iterable into an array at the start of the loop to make sure\r\n      // deletion doesn't mess up iteration.\r\n      for (const paramName of [...urlObject.searchParams.keys()]) {\r\n        if (ignoreURLParametersMatching.some(regExp => regExp.test(paramName))) {\r\n          urlObject.searchParams.delete(paramName);\r\n        }\r\n      }\r\n      return urlObject;\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Generator function that yields possible variations on the original URL to\r\n     * check, one at a time.\r\n     *\r\n     * @param {string} url\r\n     * @param {Object} options\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    function* generateURLVariations(url, {\r\n      ignoreURLParametersMatching = [/^utm_/, /^fbclid$/],\r\n      directoryIndex = 'index.html',\r\n      cleanURLs = true,\r\n      urlManipulation\r\n    } = {}) {\r\n      const urlObject = new URL(url, location.href);\r\n      urlObject.hash = '';\r\n      yield urlObject.href;\r\n      const urlWithoutIgnoredParams = removeIgnoredSearchParams(urlObject, ignoreURLParametersMatching);\r\n      yield urlWithoutIgnoredParams.href;\r\n      if (directoryIndex && urlWithoutIgnoredParams.pathname.endsWith('/')) {\r\n        const directoryURL = new URL(urlWithoutIgnoredParams.href);\r\n        directoryURL.pathname += directoryIndex;\r\n        yield directoryURL.href;\r\n      }\r\n      if (cleanURLs) {\r\n        const cleanURL = new URL(urlWithoutIgnoredParams.href);\r\n        cleanURL.pathname += '.html';\r\n        yield cleanURL.href;\r\n      }\r\n      if (urlManipulation) {\r\n        const additionalURLs = urlManipulation({\r\n          url: urlObject\r\n        });\r\n        for (const urlToAttempt of additionalURLs) {\r\n          yield urlToAttempt.href;\r\n        }\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A subclass of {@link workbox-routing.Route} that takes a\r\n     * {@link workbox-precaching.PrecacheController}\r\n     * instance and uses it to match incoming requests and handle fetching\r\n     * responses from the precache.\r\n     *\r\n     * @memberof workbox-precaching\r\n     * @extends workbox-routing.Route\r\n     */\r\n    class PrecacheRoute extends Route {\r\n      /**\r\n       * @param {PrecacheController} precacheController A `PrecacheController`\r\n       * instance used to both match requests and respond to fetch events.\r\n       * @param {Object} [options] Options to control how requests are matched\r\n       * against the list of precached URLs.\r\n       * @param {string} [options.directoryIndex=index.html] The `directoryIndex` will\r\n       * check cache entries for a URLs ending with '/' to see if there is a hit when\r\n       * appending the `directoryIndex` value.\r\n       * @param {Array<RegExp>} [options.ignoreURLParametersMatching=[/^utm_/, /^fbclid$/]] An\r\n       * array of regex's to remove search params when looking for a cache match.\r\n       * @param {boolean} [options.cleanURLs=true] The `cleanURLs` option will\r\n       * check the cache for the URL with a `.html` added to the end of the end.\r\n       * @param {workbox-precaching~urlManipulation} [options.urlManipulation]\r\n       * This is a function that should take a URL and return an array of\r\n       * alternative URLs that should be checked for precache matches.\r\n       */\r\n      constructor(precacheController, options) {\r\n        const match = ({\r\n          request\r\n        }) => {\r\n          const urlsToCacheKeys = precacheController.getURLsToCacheKeys();\r\n          for (const possibleURL of generateURLVariations(request.url, options)) {\r\n            const cacheKey = urlsToCacheKeys.get(possibleURL);\r\n            if (cacheKey) {\r\n              const integrity = precacheController.getIntegrityForCacheKey(cacheKey);\r\n              return {\r\n                cacheKey,\r\n                integrity\r\n              };\r\n            }\r\n          }\r\n          {\r\n            logger.debug(`Precaching did not find a match for ` + getFriendlyURL(request.url));\r\n          }\r\n          return;\r\n        };\r\n        super(match, precacheController.strategy);\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Add a `fetch` listener to the service worker that will\r\n     * respond to\r\n     * [network requests]{@link https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers#Custom_responses_to_requests}\r\n     * with precached assets.\r\n     *\r\n     * Requests for assets that aren't precached, the `FetchEvent` will not be\r\n     * responded to, allowing the event to fall through to other `fetch` event\r\n     * listeners.\r\n     *\r\n     * @param {Object} [options] See the {@link workbox-precaching.PrecacheRoute}\r\n     * options.\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    function addRoute(options) {\r\n      const precacheController = getOrCreatePrecacheController();\r\n      const precacheRoute = new PrecacheRoute(precacheController, options);\r\n      registerRoute(precacheRoute);\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Adds items to the precache list, removing any duplicates and\r\n     * stores the files in the\r\n     * {@link workbox-core.cacheNames|\"precache cache\"} when the service\r\n     * worker installs.\r\n     *\r\n     * This method can be called multiple times.\r\n     *\r\n     * Please note: This method **will not** serve any of the cached files for you.\r\n     * It only precaches files. To respond to a network request you call\r\n     * {@link workbox-precaching.addRoute}.\r\n     *\r\n     * If you have a single array of files to precache, you can just call\r\n     * {@link workbox-precaching.precacheAndRoute}.\r\n     *\r\n     * @param {Array<Object|string>} [entries=[]] Array of entries to precache.\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    function precache(entries) {\r\n      const precacheController = getOrCreatePrecacheController();\r\n      precacheController.precache(entries);\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * This method will add entries to the precache list and add a route to\r\n     * respond to fetch events.\r\n     *\r\n     * This is a convenience method that will call\r\n     * {@link workbox-precaching.precache} and\r\n     * {@link workbox-precaching.addRoute} in a single call.\r\n     *\r\n     * @param {Array<Object|string>} entries Array of entries to precache.\r\n     * @param {Object} [options] See the\r\n     * {@link workbox-precaching.PrecacheRoute} options.\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    function precacheAndRoute(entries, options) {\r\n      precache(entries);\r\n      addRoute(options);\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const SUBSTRING_TO_FIND = '-precache-';\r\n    /**\r\n     * Cleans up incompatible precaches that were created by older versions of\r\n     * Workbox, by a service worker registered under the current scope.\r\n     *\r\n     * This is meant to be called as part of the `activate` event.\r\n     *\r\n     * This should be safe to use as long as you don't include `substringToFind`\r\n     * (defaulting to `-precache-`) in your non-precache cache names.\r\n     *\r\n     * @param {string} currentPrecacheName The cache name currently in use for\r\n     * precaching. This cache won't be deleted.\r\n     * @param {string} [substringToFind='-precache-'] Cache names which include this\r\n     * substring will be deleted (excluding `currentPrecacheName`).\r\n     * @return {Array<string>} A list of all the cache names that were deleted.\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    const deleteOutdatedCaches = async (currentPrecacheName, substringToFind = SUBSTRING_TO_FIND) => {\r\n      const cacheNames = await self.caches.keys();\r\n      const cacheNamesToDelete = cacheNames.filter(cacheName => {\r\n        return cacheName.includes(substringToFind) && cacheName.includes(self.registration.scope) && cacheName !== currentPrecacheName;\r\n      });\r\n      await Promise.all(cacheNamesToDelete.map(cacheName => self.caches.delete(cacheName)));\r\n      return cacheNamesToDelete;\r\n    };\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Adds an `activate` event listener which will clean up incompatible\r\n     * precaches that were created by older versions of Workbox.\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    function cleanupOutdatedCaches() {\r\n      // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705\r\n      self.addEventListener('activate', event => {\r\n        const cacheName = cacheNames.getPrecacheName();\r\n        event.waitUntil(deleteOutdatedCaches(cacheName).then(cachesDeleted => {\r\n          {\r\n            if (cachesDeleted.length > 0) {\r\n              logger.log(`The following out-of-date precaches were cleaned up ` + `automatically:`, cachesDeleted);\r\n            }\r\n          }\r\n        }));\r\n      });\r\n    }\r\n\r\n    exports.cleanupOutdatedCaches = cleanupOutdatedCaches;\r\n    exports.clientsClaim = clientsClaim;\r\n    exports.precacheAndRoute = precacheAndRoute;\r\n\r\n}));\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\scripts\\add-admin-column.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":12,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":12,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":16,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":16,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":18,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":18,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":22,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":22,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":25,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":25,"endColumn":16}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport pkg from 'pg';\r\nconst { Client } = pkg;\r\n\r\nasync function run() {\r\n    const client = new Client({\r\n        connectionString: \"postgresql://orion:OrionPass123@localhost:5432/orion_db\",\r\n    });\r\n\r\n    try {\r\n        await client.connect();\r\n        console.log('Connected to database');\r\n\r\n        try {\r\n            await client.query(\"ALTER TABLE users ADD COLUMN IF NOT EXISTS is_system_admin BOOLEAN DEFAULT FALSE\");\r\n            console.log(\"Added column is_system_admin to users\");\r\n        } catch (e) {\r\n            console.log(\"Notice: \" + e.message);\r\n        }\r\n\r\n        await client.query(\"UPDATE users SET is_system_admin = TRUE\");\r\n        console.log(\"Updated all users to is_system_admin = TRUE\");\r\n\r\n    } catch (err) {\r\n        console.error('Error:', err.message);\r\n    } finally {\r\n        await client.end();\r\n    }\r\n}\r\n\r\nrun();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\scripts\\check-approle.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":13,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":13,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":14,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":14,"endColumn":38},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":16,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":16,"endColumn":16}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport pkg from 'pg';\r\nconst { Client } = pkg;\r\n\r\nasync function run() {\r\n    const client = new Client({\r\n        connectionString: \"postgresql://orion:OrionPass123@localhost:5432/orion_db\",\r\n    });\r\n\r\n    try {\r\n        await client.connect();\r\n        const res = await client.query(\"SELECT enumlabel FROM pg_enum JOIN pg_type ON pg_enum.enumtypid = pg_type.oid WHERE pg_type.typname = 'AppRole'\");\r\n        console.log('Enum values for AppRole:');\r\n        res.rows.forEach(r => console.log(`- ${r.enumlabel}`));\r\n    } catch (err) {\r\n        console.error('Error:', err.message);\r\n    } finally {\r\n        await client.end();\r\n    }\r\n}\r\n\r\nrun();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\scripts\\check-employees-count.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\scripts\\check-enum.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":13,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":13,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":14,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":14,"endColumn":38},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":18,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":18,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":19,"column":32,"nodeType":"Identifier","messageId":"undef","endLine":19,"endColumn":39},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":22,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":22,"endColumn":16}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport pkg from 'pg';\r\nconst { Client } = pkg;\r\n\r\nasync function run() {\r\n    const client = new Client({\r\n        connectionString: \"postgresql://orion:OrionPass123@localhost:5432/orion_db\",\r\n    });\r\n\r\n    try {\r\n        await client.connect();\r\n        const res = await client.query(\"SELECT enumlabel FROM pg_enum JOIN pg_type ON pg_enum.enumtypid = pg_type.oid WHERE pg_type.typname = 'Role'\");\r\n        console.log('Enum values for Role:');\r\n        res.rows.forEach(r => console.log(`- ${r.enumlabel}`));\r\n\r\n        // Also check for app_role if it exists\r\n        const res2 = await client.query(\"SELECT enumlabel FROM pg_enum JOIN pg_type ON pg_enum.enumtypid = pg_type.oid WHERE pg_type.typname = 'app_role'\");\r\n        console.log('Enum values for app_role:');\r\n        res2.rows.forEach(r => console.log(`- ${r.enumlabel}`));\r\n\r\n    } catch (err) {\r\n        console.error('Error:', err.message);\r\n    } finally {\r\n        await client.end();\r\n    }\r\n}\r\n\r\nrun();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\scripts\\check-roles.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":13,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":13,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":14,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":14,"endColumn":38},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":17,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":17,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":18,"column":33,"nodeType":"Identifier","messageId":"undef","endLine":18,"endColumn":40},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":20,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":20,"endColumn":16}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport pkg from 'pg';\r\nconst { Client } = pkg;\r\n\r\nasync function run() {\r\n    const client = new Client({\r\n        connectionString: \"postgresql://orion:OrionPass123@localhost:5432/orion_db\",\r\n    });\r\n\r\n    try {\r\n        await client.connect();\r\n        const res = await client.query(\"SELECT column_name FROM information_schema.columns WHERE table_name = 'user_roles'\");\r\n        console.log('Columns in user_roles:');\r\n        res.rows.forEach(r => console.log(`- ${r.column_name}`));\r\n\r\n        const users = await client.query(\"SELECT id, email, role FROM users\");\r\n        console.log('Users role in users table:');\r\n        users.rows.forEach(u => console.log(`- ${u.email}: ${u.role}`));\r\n    } catch (err) {\r\n        console.error('Error:', err);\r\n    } finally {\r\n        await client.end();\r\n    }\r\n}\r\n\r\nrun();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\scripts\\check_counts copy.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":10,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":10,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":14,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":14,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":15,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":15,"endColumn":12}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { createClient } from '@supabase/supabase-js';\r\n\r\nconst SUPABASE_URL = \"https://ultdeyxftiawkqrugnfm.supabase.co\";\r\nconst SUPABASE_SERVICE_ROLE_KEY = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVsdGRleXhmdGlhd2txcnVnbmZtIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODIzMzI3MSwiZXhwIjoyMDgzODA5MjcxfQ.j5nfS2IUCDONKZogqRdwPeXPmLTLiqO6NmsXth0O0_I\";\r\n\r\nconst supabase = createClient(SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY);\r\n\r\nasync function run() {\r\n    console.log(\"Checking row counts...\");\r\n    const { count: tCount } = await supabase.from('tower_technical_data').select('*', { count: 'exact', head: true });\r\n    const { count: sCount } = await supabase.from('span_technical_data').select('*', { count: 'exact', head: true });\r\n\r\n    console.log(\"Tower Count:\", tCount);\r\n    console.log(\"Span Count:\", sCount);\r\n}\r\n\r\nrun();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\scripts\\debug_regex.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":14,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":14,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":15,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":15,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":16,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":16,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":25,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":25,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":26,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":26,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":28,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":28,"endColumn":12}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nconst kmlSnippet = `\r\n\t<Style id=\"sectionInfo0\">\r\n\t\t<BalloonStyle>\r\n\t\t\t<text><![CDATA[<h3>Section #1</h3>Voltage: 500kV<br>Cable: 'dotterel_acsr'<br>From Str.: TRIO_C1 Set 1 'PR1 (E)'<br>To Str.: 0/1A Set 1 'PR1 (E)'<br>Disp. Condition: PR1.Temp.Máxima 'Creep RS'<br><br>Sagging data: Catenary (m) 304.731, Horiz. Tension (daN) 196.3,  Condition 'Creep RS', Temperature (deg C) 40<br><br>]]></text>\r\n\t\t</BalloonStyle>\r\n\t</Style>\r\n`;\r\n\r\nconst styleRegex = /<Style id=\"([^\"]+)\">[\\s\\S]*?<text><!\\[CDATA\\[([\\s\\S]*?)\\]\\]><\\/text>/g;\r\nlet match = styleRegex.exec(kmlSnippet);\r\n\r\nif (match) {\r\n    console.log('✅ Match encontrado!');\r\n    console.log('ID:', match[1]);\r\n    console.log('HTML:', match[2]);\r\n\r\n    const html = match[2];\r\n    const extract = (label) => {\r\n        const regex = new RegExp(`${label}:\\\\s*(.*?)(?:<br>|$)`, 'i');\r\n        const m = html.match(regex);\r\n        return m ? m[1].trim() : null;\r\n    };\r\n\r\n    console.log('Voltage:', extract('Voltage'));\r\n    console.log('From:', extract('From Str.'));\r\n} else {\r\n    console.log('❌ Match NÃO encontrado.');\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\scripts\\download-tiles.module.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":47,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":47,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'reject' is defined but never used.","line":53,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":53,"endColumn":40},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":58,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":58,"endColumn":24},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":69,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":69,"endColumn":24},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":73,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":73,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":81,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":81,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":82,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":82,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":87,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":87,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'setTimeout' is not defined.","line":95,"column":40,"nodeType":"Identifier","messageId":"undef","endLine":95,"endColumn":50},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":100,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":100,"endColumn":12}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import fs from 'fs';\r\nimport path from 'path';\r\nimport https from 'https';\r\nimport { fileURLToPath } from 'url';\r\n\r\n// --- CONFIGURATION ---\r\n// Area to download (e.g., around the specific tower coordinates the user provided)\r\n// Center: Lat -22.65, Lon -43.76 (Swapped based on user input likely being Lat/Lon but they put -43 in Lat)\r\n// Let's use a standard bounding box around the user's apparent area of interest.\r\n// If the user meant Lat -22.65, Lon -43.76 (near Rio de Janeiro state) we use that.\r\n// If they meant Lat -43 (South Ocean), well... let's default to a safe box around the inputs.\r\n\r\nconst CENTER_LAT = -22.6529;\r\nconst CENTER_LON = -43.7689;\r\nconst ZOOM_LEVELS = [14, 15, 16]; // Zoom levels to download\r\nconst RADIUS_TILES = 2; // Number of tiles around the center to download (grid radius)\r\n\r\nconst OUTPUT_DIR = path.join(path.dirname(fileURLToPath(import.meta.url)), '../public/tiles');\r\n\r\n// --- UTILS ---\r\nfunction latLonToTile(lat, lon, zoom) {\r\n    const n = Math.pow(2, zoom);\r\n    const x = Math.floor(((lon + 180) / 360) * n);\r\n    const y = Math.floor(\r\n        ((1 - Math.log(Math.tan((lat * Math.PI) / 180) + 1 / Math.cos((lat * Math.PI) / 180)) / Math.PI) / 2) * n\r\n    );\r\n    return { x, y, z: zoom };\r\n}\r\n\r\nfunction ensureDirectoryExistence(filePath) {\r\n    const dirname = path.dirname(filePath);\r\n    if (fs.existsSync(dirname)) {\r\n        return true;\r\n    }\r\n    ensureDirectoryExistence(dirname);\r\n    fs.mkdirSync(dirname);\r\n}\r\n\r\nfunction downloadTile(z, x, y) {\r\n    // Using OpenStreetMap standard tile server\r\n    // Note: Respect OSM usage policy. Do not bulk download heavily without permission.\r\n    // This script is for small localized areas (offline cache).\r\n    const url = `https://a.tile.openstreetmap.org/${z}/${x}/${y}.png`;\r\n    const outputPath = path.join(OUTPUT_DIR, `${z}`, `${x}`, `${y}.png`);\r\n\r\n    if (fs.existsSync(outputPath)) {\r\n        console.log(`Skipping (exists): ${z}/${x}/${y}`);\r\n        return Promise.resolve();\r\n    }\r\n\r\n    ensureDirectoryExistence(outputPath);\r\n\r\n    return new Promise((resolve, reject) => {\r\n        https.get(url, {\r\n            headers: { 'User-Agent': 'TeamOrionOfflineDownloader/1.0' }\r\n        }, (res) => {\r\n            if (res.statusCode !== 200) {\r\n                console.error(`Failed to download ${url}: ${res.statusCode}`);\r\n                // Don't reject, just skip to keep process running\r\n                resolve();\r\n                return;\r\n            }\r\n\r\n            const fileStream = fs.createWriteStream(outputPath);\r\n            res.pipe(fileStream);\r\n\r\n            fileStream.on('finish', () => {\r\n                fileStream.close();\r\n                console.log(`Downloaded: ${z}/${x}/${y}`);\r\n                resolve();\r\n            });\r\n        }).on('error', (err) => {\r\n            console.error(`Error downloading ${url}: ${err.message}`);\r\n            resolve();\r\n        });\r\n    });\r\n}\r\n\r\n// --- MAIN ---\r\nasync function main() {\r\n    console.log(`Starting download for area around ${CENTER_LAT}, ${CENTER_LON}`);\r\n    console.log(`Output directory: ${OUTPUT_DIR}`);\r\n\r\n    for (const z of ZOOM_LEVELS) {\r\n        const centerTile = latLonToTile(CENTER_LAT, CENTER_LON, z);\r\n\r\n        console.log(`Processing Zoom Level ${z}... Center Tile: ${centerTile.x}, ${centerTile.y}`);\r\n\r\n        for (let dx = -RADIUS_TILES; dx <= RADIUS_TILES; dx++) {\r\n            for (let dy = -RADIUS_TILES; dy <= RADIUS_TILES; dy++) {\r\n                const x = centerTile.x + dx;\r\n                const y = centerTile.y + dy;\r\n\r\n                // Basic delay to be nice to the server\r\n                await new Promise(r => setTimeout(r, 100));\r\n                await downloadTile(z, x, y);\r\n            }\r\n        }\r\n    }\r\n    console.log('Download complete!');\r\n}\r\n\r\nmain();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\scripts\\extract_kml_debug.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":12,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":12,"endColumn":8},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":13,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":13,"endColumn":8},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":16,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":16,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":17,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":17,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":22,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":22,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'match' is assigned a value but never used.","line":30,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":18},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":32,"column":38,"nodeType":"Identifier","messageId":"undef","endLine":32,"endColumn":45},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":34,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":34,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":37,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":37,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":39,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":39,"endColumn":12}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport fs from 'fs';\r\nimport path from 'path';\r\nimport { fileURLToPath } from 'url';\r\n\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = path.dirname(__filename);\r\n\r\nconst KML_PATH = path.join(__dirname, '../public/models/kml/LT-L-TRIO-LGO.kml');\r\nconst OUTPUT_PATH = path.join(__dirname, '../spans_extracted.json');\r\n\r\nconsole.log('✅ Iniciando script...');\r\nconsole.log('📂 Caminho:', KML_PATH);\r\n\r\nif (!fs.existsSync(KML_PATH)) {\r\n    console.error('❌ Arquivo não encontrado!');\r\n    process.exit(1);\r\n}\r\n\r\ntry {\r\n    const kmlContent = fs.readFileSync(KML_PATH, 'utf-8');\r\n    console.log(`📦 Arquivo lido. ${(kmlContent.length / 1024 / 1024).toFixed(2)} MB`);\r\n\r\n    // Teste simples de regex\r\n    const styleRegex = /<Style id=\"([^\"]+)\">[\\s\\S]*?<text><!\\[CDATA\\[([\\s\\S]*?)\\]\\]><\\/text>/g;\r\n\r\n    let stylesCount = 0;\r\n    let match;\r\n    // Loop limitado para teste\r\n    while ((match = styleRegex.exec(kmlContent)) !== null) {\r\n        stylesCount++;\r\n        if (stylesCount % 100 === 0) process.stdout.write('.');\r\n    }\r\n    console.log(`\\n✅ Estilos processados: ${stylesCount}`);\r\n\r\n    fs.writeFileSync(OUTPUT_PATH, JSON.stringify({ count: stylesCount }));\r\n    console.log('✅ Arquivo de teste salvo.');\r\n} catch (e) {\r\n    console.error('❌ Erro fatal:', e);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\scripts\\extract_kml_spans.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":12,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":12,"endColumn":8},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":18,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":18,"endColumn":12},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":45,"column":69,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":45,"endColumn":70,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1534,1535],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1534,1534],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":53,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":53,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":56,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":56,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":111,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":111,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":113,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":113,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":117,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":117,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":120,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":120,"endColumn":12}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport fs from 'fs';\r\nimport path from 'path';\r\nimport { fileURLToPath } from 'url';\r\n\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = path.dirname(__filename);\r\n\r\nconst KML_PATH = path.join(__dirname, '../public/models/kml/LT-L-TRIO-LGO.kml');\r\nconst OUTPUT_JSON_PATH = path.join(__dirname, '../spans_extracted.json');\r\n\r\nconsole.log('✅ Iniciando script de extração v3...');\r\n\r\ntry {\r\n    const kmlContent = fs.readFileSync(KML_PATH, 'utf-8');\r\n\r\n    // 1. Extrair Estilos\r\n    console.log('🔍 Mapeando estilos...');\r\n    const stylesMap = new Map();\r\n    const styleRegex = /<Style id=\"([^\"]+)\">[\\s\\S]*?<text><!\\[CDATA\\[([\\s\\S]*?)\\]\\]><\\/text>/g;\r\n\r\n    let styleMatch;\r\n    let countStyles = 0;\r\n    while ((styleMatch = styleRegex.exec(kmlContent)) !== null) {\r\n        const id = styleMatch[1];\r\n        const html = styleMatch[2];\r\n\r\n        const extract = (label) => {\r\n            const regex = new RegExp(`${label}:\\\\s*(.*?)(?:<br>|$)`, 'i');\r\n            const m = html.match(regex);\r\n            return m ? m[1].trim() : null;\r\n        };\r\n\r\n        const metadata = {\r\n            voltage: extract('Voltage'),\r\n            cableType: extract('Cable')?.replace(/'/g, ''),\r\n            fromStr: extract('From Str.'),\r\n            toStr: extract('To Str.')\r\n        };\r\n\r\n        // Sagging\r\n        const saggingMatch = html.match(/Sagging data: (.*)/);\r\n        if (saggingMatch) {\r\n            const sagText = saggingMatch[1];\r\n            const catenaryMatch = sagText.match(/Catenary \\(m\\) ([\\d\\.]+)/);\r\n            if (catenaryMatch) metadata.catenary = parseFloat(catenaryMatch[1]);\r\n            // ... outros\r\n        }\r\n\r\n        stylesMap.set(id, metadata);\r\n        countStyles++;\r\n    }\r\n    console.log(`🎨 ${countStyles} estilos com metadados mapeados.`);\r\n\r\n    // 2. Extrair Placemarks e Coordenadas\r\n    console.log('🔍 Extraindo Placemarks...');\r\n\r\n    // Regex simplificado para pegar blocos <Placemark>\r\n    // Vamos usar indexOf para iterar manually, mais confiável com memória\r\n    const placemarkTag = '<Placemark>';\r\n    const endPlacemarkTag = '</Placemark>';\r\n\r\n    let startIndex = 0;\r\n    let countSpans = 0;\r\n    const spans = [];\r\n\r\n    let missingStyles = new Set();\r\n\r\n    while (true) {\r\n        const pStart = kmlContent.indexOf(placemarkTag, startIndex);\r\n        if (pStart === -1) break;\r\n\r\n        const pEnd = kmlContent.indexOf(endPlacemarkTag, pStart);\r\n        if (pEnd === -1) break;\r\n\r\n        const content = kmlContent.substring(pStart, pEnd + endPlacemarkTag.length);\r\n        startIndex = pEnd + endPlacemarkTag.length;\r\n\r\n        // Processar conteudo\r\n        if (!content.includes('<LineString>')) continue;\r\n\r\n        const styleUrlMatch = content.match(/<styleUrl>#([^<]+)<\\/styleUrl>/);\r\n        const coordinatesMatch = content.match(/<coordinates>([\\s\\S]*?)<\\/coordinates>/);\r\n\r\n        if (styleUrlMatch && coordinatesMatch) {\r\n            const styleId = styleUrlMatch[1];\r\n            const metadata = stylesMap.get(styleId);\r\n\r\n            if (metadata) {\r\n                const coordsText = coordinatesMatch[1].trim();\r\n                // Pegar apenas p1 e p2 para simplificar JSON\r\n                const pointsStr = coordsText.split(/\\s+/);\r\n                const points = pointsStr.map(p => {\r\n                    const parts = p.split(',');\r\n                    return { lng: parseFloat(parts[0]), lat: parseFloat(parts[1]), alt: parseFloat(parts[2]) };\r\n                });\r\n\r\n                spans.push({\r\n                    spanId: `span-${countSpans}`,\r\n                    ...metadata,\r\n                    coordinates: points,\r\n                    rawStyleId: styleId\r\n                });\r\n                countSpans++;\r\n            } else {\r\n                missingStyles.add(styleId);\r\n            }\r\n        }\r\n    }\r\n\r\n    console.log(`\\n✅ ${countSpans} vãos extraídos.`);\r\n    if (missingStyles.size > 0) {\r\n        console.log(`⚠️ ${missingStyles.size} estilos referenciados mas não encontrados (possivelmente estilos visuais sem metadados). Ex:`, Array.from(missingStyles).slice(0, 5));\r\n    }\r\n\r\n    fs.writeFileSync(OUTPUT_JSON_PATH, JSON.stringify(spans, null, 2));\r\n    console.log(`💾 JSON salvo.`);\r\n\r\n} catch (e) {\r\n    console.error('❌ Erro:', e);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\scripts\\generate_catenary_svg.js","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'minX' is assigned a value but never used.","line":38,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":11},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":81,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":81,"endColumn":8}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import fs from 'fs';\r\n\r\nfunction getDist(lat1, lon1, lat2, lon2) {\r\n    const R = 6371000; // Earth radius in meters\r\n    const dLat = (lat2 - lat1) * Math.PI / 180;\r\n    const dLon = (lon2 - lon1) * Math.PI / 180;\r\n    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n        Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\r\n        Math.sin(dLon / 2) * Math.sin(dLon / 2);\r\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n    return R * c;\r\n}\r\n\r\n// Data from search\r\nconst t1 = { lat: -22.6529484, lng: -43.7689477, elev: 98.73, height: 30 };\r\nconst t2 = { lat: -22.6527473, lng: -43.7678521, elev: 111.56, height: 30 };\r\n\r\nconst spanDist = getDist(t1.lat, t1.lng, t2.lat, t2.lng);\r\nconst h1 = t1.elev + t1.height;\r\nconst h2 = t2.elev + t2.height;\r\n\r\nconst C = 1200; // Catenary constant\r\nconst steps = 50;\r\nlet points = [];\r\n\r\nfor (let i = 0; i <= steps; i++) {\r\n    const xRel = (i / steps) * spanDist;\r\n    const t = (i / steps);\r\n    const baseLine = h1 + (h2 - h1) * t;\r\n    const xFromCenter = xRel - (spanDist / 2);\r\n    const sag = C * (Math.cosh(xFromCenter / C) - Math.cosh(spanDist / (2 * C)));\r\n    points.push({ x: xRel, y: baseLine + sag });\r\n}\r\n\r\nconst width = 800;\r\nconst height = 400;\r\nconst padding = 50;\r\nconst minX = 0;\r\nconst maxX = spanDist;\r\nconst minY = Math.min(...points.map(p => p.y)) - 20;\r\nconst maxY = Math.max(h1, h2) + 20;\r\n\r\nconst scaleX = (x) => padding + (x / maxX) * (width - 2 * padding);\r\nconst scaleY = (y) => height - padding - ((y - minY) / (maxY - minY)) * (height - 2 * padding);\r\n\r\nlet pathD = `M ${scaleX(points[0].x)} ${scaleY(points[0].y)}`;\r\nfor (let i = 1; i < points.length; i++) {\r\n    pathD += ` L ${scaleX(points[i].x)} ${scaleY(points[i].y)}`;\r\n}\r\n\r\nconst svg = `\r\n<svg width=\"${width}\" height=\"${height}\" viewBox=\"0 0 ${width} ${height}\" xmlns=\"http://www.w3.org/2000/svg\">\r\n  <rect width=\"100%\" height=\"100%\" fill=\"#0f172a\" />\r\n  <text x=\"50%\" y=\"30\" fill=\"white\" font-family=\"Arial\" font-size=\"16\" text-anchor=\"middle\">Perfil de Catenária de Engenharia</text>\r\n  <text x=\"50%\" y=\"55\" fill=\"#94a3b8\" font-family=\"Arial\" font-size=\"12\" text-anchor=\"middle\">TRIO_C1 para 0/1A | Vão: ${spanDist.toFixed(2)}m</text>\r\n  \r\n  <!-- Linha de Base (Solo Indicativo) -->\r\n  <path d=\"M ${scaleX(0)} ${scaleY(t1.elev)} L ${scaleX(spanDist)} ${scaleY(t2.elev)}\" stroke=\"#334155\" stroke-dasharray=\"5,5\" fill=\"none\" />\r\n  <text x=\"${scaleX(0)}\" y=\"${scaleY(t1.elev) + 20}\" fill=\"#475569\" font-size=\"10\" text-anchor=\"middle\">TRIO_C1 (Elev: ${t1.elev}m)</text>\r\n  <text x=\"${scaleX(spanDist)}\" y=\"${scaleY(t2.elev) + 20}\" fill=\"#475569\" font-size=\"10\" text-anchor=\"middle\">0/1A (Elev: ${t2.elev}m)</text>\r\n\r\n  <!-- Estruturas (Torres) -->\r\n  <line x1=\"${scaleX(0)}\" y1=\"${scaleY(t1.elev)}\" x2=\"${scaleX(0)}\" y2=\"${scaleY(h1)}\" stroke=\"#cbd5e1\" stroke-width=\"4\" />\r\n  <line x1=\"${scaleX(spanDist)}\" y1=\"${scaleY(t2.elev)}\" x2=\"${scaleX(spanDist)}\" y2=\"${scaleY(h2)}\" stroke=\"#cbd5e1\" stroke-width=\"4\" />\r\n  \r\n  <!-- Cabo Catenária -->\r\n  <path d=\"${pathD}\" fill=\"none\" stroke=\"#f59e0b\" stroke-width=\"3\" />\r\n  \r\n  <!-- Pontos de Suspensão -->\r\n  <circle cx=\"${scaleX(0)}\" cy=\"${scaleY(h1)}\" r=\"5\" fill=\"#f59e0b\" />\r\n  <circle cx=\"${scaleX(spanDist)}\" cy=\"${scaleY(h2)}\" r=\"5\" fill=\"#f59e0b\" />\r\n\r\n  <!-- Info Sag -->\r\n  <text x=\"${scaleX(spanDist / 2)}\" y=\"${scaleY(points[Math.floor(steps / 2)].y) + 25}\" fill=\"#f59e0b\" font-family=\"Arial\" font-size=\"11\" text-anchor=\"middle\">\r\n    Sag Máximo (C=${C}m)\r\n  </text>\r\n</svg>\r\n`;\r\n\r\nfs.writeFileSync('catenaria_trio_c1_01a.svg', svg);\r\nconsole.log('SVG gerado: catenaria_trio_c1_01a.svg');\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\scripts\\list-columns-roles.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":13,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":13,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":14,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":14,"endColumn":38},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":16,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":16,"endColumn":16}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport pkg from 'pg';\r\nconst { Client } = pkg;\r\n\r\nasync function run() {\r\n    const client = new Client({\r\n        connectionString: \"postgresql://orion:OrionPass123@localhost:5432/orion_db\",\r\n    });\r\n\r\n    try {\r\n        await client.connect();\r\n        const res = await client.query(\"SELECT column_name, data_type, udt_name FROM information_schema.columns WHERE table_name = 'user_roles'\");\r\n        console.log('Columns in user_roles:');\r\n        res.rows.forEach(r => console.log(`- ${r.column_name} (${r.data_type}, ${r.udt_name})`));\r\n    } catch (err) {\r\n        console.error('Error:', err);\r\n    } finally {\r\n        await client.end();\r\n    }\r\n}\r\n\r\nrun();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\scripts\\list-columns.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":13,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":13,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":14,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":14,"endColumn":38},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":16,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":16,"endColumn":16}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport pkg from 'pg';\r\nconst { Client } = pkg;\r\n\r\nasync function run() {\r\n    const client = new Client({\r\n        connectionString: \"postgresql://orion:OrionPass123@localhost:5432/orion_db\",\r\n    });\r\n\r\n    try {\r\n        await client.connect();\r\n        const res = await client.query(\"SELECT column_name FROM information_schema.columns WHERE table_name = 'users'\");\r\n        console.log('Columns in users:');\r\n        res.rows.forEach(r => console.log(`- ${r.column_name}`));\r\n    } catch (err) {\r\n        console.error('Error:', err);\r\n    } finally {\r\n        await client.end();\r\n    }\r\n}\r\n\r\nrun();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\scripts\\list-tables.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":13,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":13,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":14,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":14,"endColumn":38},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":16,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":16,"endColumn":16}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport pkg from 'pg';\r\nconst { Client } = pkg;\r\n\r\nasync function run() {\r\n    const client = new Client({\r\n        connectionString: \"postgresql://orion:OrionPass123@localhost:5432/orion_db\",\r\n    });\r\n\r\n    try {\r\n        await client.connect();\r\n        const res = await client.query(\"SELECT table_name FROM information_schema.tables WHERE table_schema = 'public'\");\r\n        console.log('Tables:');\r\n        res.rows.forEach(r => console.log(`- ${r.table_name}`));\r\n    } catch (err) {\r\n        console.error('Error:', err);\r\n    } finally {\r\n        await client.end();\r\n    }\r\n}\r\n\r\nrun();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\scripts\\set-god-mode.js","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":16,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":19},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":16,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":16,"endColumn":24,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[413,414],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":20,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":20,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":22,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":22,"endColumn":16}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport pkg from 'pg';\r\nconst { Client } = pkg;\r\n\r\nasync function run() {\r\n    const client = new Client({\r\n        connectionString: \"postgresql://orion:OrionPass123@localhost:5432/orion_db\",\r\n    });\r\n\r\n    try {\r\n        await client.connect();\r\n\r\n        // Add superadmingod to Role enum\r\n        try {\r\n            await client.query(\"ALTER TYPE \\\"Role\\\" ADD VALUE 'superadmingod'\");\r\n        } catch (e) { }\r\n\r\n        await client.query(\"UPDATE users SET role = 'superadmingod' WHERE email = 'julianogitiz@gmail.com'\");\r\n        await client.query(\"UPDATE user_roles SET role = 'superadmingod' WHERE user_id = (SELECT id FROM users WHERE email = 'julianogitiz@gmail.com')\");\r\n        console.log(\"User julianogitiz@gmail.com is now superadmingod\");\r\n    } catch (err) {\r\n        console.error('Error:', err.message);\r\n    } finally {\r\n        await client.end();\r\n    }\r\n}\r\n\r\nrun();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\scripts\\set-superadmin.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":12,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":12,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":17,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":17,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":18,"column":23,"nodeType":"Identifier","messageId":"undef","endLine":18,"endColumn":30},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":22,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":22,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":23,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":19},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":23,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":23,"endColumn":24,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[769,770],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":28,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":28,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":29,"column":23,"nodeType":"Identifier","messageId":"undef","endLine":29,"endColumn":30},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":33,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":33,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":34,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":19},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":34,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":34,"endColumn":24,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1267,1268],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":39,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":39,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":52,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":52,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":55,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":55,"endColumn":16}],"suppressedMessages":[],"errorCount":14,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport pkg from 'pg';\r\nconst { Client } = pkg;\r\n\r\nasync function run() {\r\n    const client = new Client({\r\n        connectionString: \"postgresql://orion:OrionPass123@localhost:5432/orion_db\",\r\n    });\r\n\r\n    try {\r\n        await client.connect();\r\n        console.log('Connected to database');\r\n\r\n        // Expand Role enum\r\n        try {\r\n            await client.query(\"ALTER TYPE \\\"Role\\\" ADD VALUE 'super_admin'\");\r\n            console.log(\"Added 'super_admin' to Role enum\");\r\n        } catch (e) { console.log(\"Role 'super_admin' might already exist or failed: \" + e.message); }\r\n\r\n        try {\r\n            await client.query(\"ALTER TYPE \\\"Role\\\" ADD VALUE 'SUPER_ADMIN'\");\r\n            console.log(\"Added 'SUPER_ADMIN' to Role enum\");\r\n        } catch (e) { }\r\n\r\n        // Expand AppRole enum\r\n        try {\r\n            await client.query(\"ALTER TYPE \\\"AppRole\\\" ADD VALUE 'super_admin'\");\r\n            console.log(\"Added 'super_admin' to AppRole enum\");\r\n        } catch (e) { console.log(\"AppRole 'super_admin' might already exist or failed: \" + e.message); }\r\n\r\n        try {\r\n            await client.query(\"ALTER TYPE \\\"AppRole\\\" ADD VALUE 'superadmingod'\");\r\n            console.log(\"Added 'superadmingod' to AppRole enum\");\r\n        } catch (e) { }\r\n\r\n        // Now promote everyone\r\n        const res = await client.query('SELECT id, email FROM users');\r\n        for (const user of res.rows) {\r\n            console.log(`Promoting ${user.email} to super_admin`);\r\n            await client.query(\"UPDATE users SET role = 'super_admin' WHERE id = $1\", [user.id]);\r\n\r\n            const roleRes = await client.query('SELECT id FROM user_roles WHERE user_id = $1', [user.id]);\r\n            if (roleRes.rows.length > 0) {\r\n                await client.query(\"UPDATE user_roles SET role = 'super_admin' WHERE user_id = $1\", [user.id]);\r\n            } else {\r\n                // We need a UUID. Using a simple mock one since it's local.\r\n                const newId = 'admin-' + user.id.substring(0, 8);\r\n                await client.query(\"INSERT INTO user_roles (id, user_id, role) VALUES ($1, $2, 'super_admin')\", [newId, user.id]);\r\n            }\r\n        }\r\n\r\n        console.log('Promotion complete.');\r\n\r\n    } catch (err) {\r\n        console.error('CRITICAL ERROR:', err.message);\r\n    } finally {\r\n        await client.end();\r\n    }\r\n}\r\n\r\nrun();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\App.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'render' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'screen' is defined but never used.","line":2,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":24}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\r\nimport { render, screen } from '@testing-library/react';\r\n\r\ndescribe('App', () => {\r\n    it('should pass a simple truthy test', () => {\r\n        expect(true).toBe(true);\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ModeToggle.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Moon' is defined but never used.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Sun' is defined but never used.","line":1,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3450,3453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3450,3453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Moon, Sun, Palette } from \"lucide-react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport {\r\n    DropdownMenu,\r\n    DropdownMenuContent,\r\n    DropdownMenuItem,\r\n    DropdownMenuLabel,\r\n    DropdownMenuSeparator,\r\n    DropdownMenuTrigger,\r\n} from \"@/components/ui/dropdown-menu\"\r\nimport { useTheme } from \"@/components/theme-provider\"\r\n\r\nexport function ModeToggle() {\r\n    const { setTheme, theme } = useTheme()\r\n\r\n    const themes = [\r\n        { id: \"light\", name: \"Claro\", color: \"bg-white border\" },\r\n        { id: \"dark\", name: \"Escuro\", color: \"bg-slate-950\" },\r\n        { id: \"industrial\", name: \"Industrial Gold\", color: \"bg-blue-900 border-amber-500 border-2\" },\r\n        { id: \"midnight\", name: \"Midnight Pro\", color: \"bg-slate-900 border-sky-400 border-2\" },\r\n        { id: \"slate\", name: \"Modern Slate\", color: \"bg-slate-800 border-slate-400 border-2\" },\r\n        { id: \"emerald\", name: \"Emerald Deep\", color: \"bg-emerald-950 border-emerald-500 border-2\" },\r\n        { id: \"purple\", name: \"Royal Purple\", color: \"bg-purple-950 border-purple-500 border-2\" },\r\n        { id: \"crimson\", name: \"Crimson Steel\", color: \"bg-rose-950 border-rose-500 border-2\" },\r\n        { id: \"sunset\", name: \"Sunset Horizon\", color: \"bg-orange-950 border-orange-500 border-2\" },\r\n        { id: \"oceanic\", name: \"Oceanic Blue\", color: \"bg-cyan-950 border-cyan-500 border-2\" },\r\n        { id: \"nebula\", name: \"Cosmic Nebula\", color: \"bg-indigo-950 border-pink-500 border-2\" },\r\n    ]\r\n\r\n    return (\r\n        <DropdownMenu>\r\n            <DropdownMenuTrigger asChild>\r\n                <Button variant=\"ghost\" size=\"icon\" className=\"h-9 w-9 relative hover:bg-white/10\">\r\n                    <Palette className=\"h-[1.2rem] w-[1.2rem] text-secondary-foreground\" />\r\n                    <span className=\"sr-only\">Escolher tema</span>\r\n                </Button>\r\n            </DropdownMenuTrigger>\r\n            <DropdownMenuContent align=\"end\" className=\"w-56 glass-card p-2\">\r\n                <DropdownMenuLabel className=\"text-xs font-bold uppercase tracking-wider opacity-60\">Temas Padrão</DropdownMenuLabel>\r\n                <DropdownMenuItem onClick={() => setTheme(\"light\")} className=\"flex items-center gap-2 cursor-pointer\">\r\n                    <div className=\"w-4 h-4 rounded-full bg-white border border-slate-200\" />\r\n                    Claro\r\n                </DropdownMenuItem>\r\n                <DropdownMenuItem onClick={() => setTheme(\"dark\")} className=\"flex items-center gap-2 cursor-pointer\">\r\n                    <div className=\"w-4 h-4 rounded-full bg-slate-900 border border-slate-700\" />\r\n                    Escuro\r\n                </DropdownMenuItem>\r\n                <DropdownMenuItem onClick={() => setTheme(\"system\")} className=\"flex items-center gap-2 cursor-pointer\">\r\n                    <div className=\"w-4 h-4 rounded-full bg-linear-to-r from-white to-slate-900 border border-slate-400\" />\r\n                    Sistema\r\n                </DropdownMenuItem>\r\n\r\n                <DropdownMenuSeparator className=\"bg-white/10\" />\r\n                <DropdownMenuLabel className=\"text-xs font-bold uppercase tracking-wider opacity-60\">Presets Premium</DropdownMenuLabel>\r\n\r\n                <div className=\"grid grid-cols-1 gap-1\">\r\n                    {themes.slice(2).map((t) => (\r\n                        <DropdownMenuItem\r\n                            key={t.id}\r\n                            onClick={() => setTheme(t.id as any)}\r\n                            className={`flex items-center justify-between cursor-pointer p-3 rounded-lg m-1 transition-all ${theme === t.id ? 'bg-primary/20 ring-1 ring-primary/50' : 'hover:bg-white/5'}`}\r\n                        >\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <div className={`w-6 h-6 rounded-md shadow-sm ${t.color}`} />\r\n                                <span className={`text-sm font-medium ${theme === t.id ? 'text-primary' : ''}`}>{t.name}</span>\r\n                            </div>\r\n                            {theme === t.id && <div className=\"w-2 h-2 rounded-full bg-primary shadow-glow animate-pulse\" />}\r\n                        </DropdownMenuItem>\r\n                    ))}\r\n                </div>\r\n            </DropdownMenuContent>\r\n        </DropdownMenu>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\NavLink.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\audit\\TeamLabTab.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'orionApi' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[550,553],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[550,553],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[618,621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[618,621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":141,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9028,9031],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9028,9031],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { HardHat, Users, Plus, Trash2, ShieldCheck, AlertCircle, Fingerprint } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport { orionApi } from '@/integrations/database';\r\nimport { cn } from '@/lib/utils';\r\n\r\nexport default function TeamLabTab() {\r\n    const [mockTeams, setMockTeams] = useState<any[]>([]);\r\n    const [mockEmployees, setMockEmployees] = useState<any[]>([]);\r\n    const [logs, setLogs] = useState<string[]>([]);\r\n\r\n    const addLog = (msg: string) => {\r\n        setLogs(prev => [`[${new Date().toLocaleTimeString()}] ${msg}`, ...prev.slice(0, 9)]);\r\n    };\r\n\r\n    const handleCreateMockEmployee = (type: 'MOD' | 'MOI') => {\r\n        const newEmp = {\r\n            id: `mock-emp-${Math.random().toString(36).substr(2, 9)}`,\r\n            fullName: type === 'MOD' ? 'Pedreiro de Teste' : 'Engenheiro de Teste',\r\n            laborType: type,\r\n            jobFunction: { name: type === 'MOD' ? 'PEDREIRO' : 'ENGENHEIRO' }\r\n        };\r\n        setMockEmployees(prev => [...prev, newEmp]);\r\n        addLog(`Mock ${type} criado: ${newEmp.fullName}`);\r\n    };\r\n\r\n    const handleCreateMockTeam = (type: 'MOD' | 'MOI') => {\r\n        const newTeam = {\r\n            id: `mock-team-${Math.random().toString(36).substr(2, 9)}`,\r\n            name: `Equipe Teste ${type}`,\r\n            laborType: type,\r\n            members: []\r\n        };\r\n        setMockTeams(prev => [...prev, newTeam]);\r\n        addLog(`Equipe ${type} criada: ${newTeam.name}`);\r\n    };\r\n\r\n    const handleSimulateMove = (empId: string, teamId: string) => {\r\n        const emp = mockEmployees.find(e => e.id === empId);\r\n        const team = mockTeams.find(t => t.id === teamId);\r\n\r\n        if (!emp || !team) return;\r\n\r\n        addLog(`Tentando mover ${emp.laborType} para equipe ${team.laborType}...`);\r\n\r\n        if (emp.laborType !== team.laborType) {\r\n            addLog(`ERRO: Violação de homogeneidade! ${emp.laborType} != ${team.laborType}`);\r\n            toast.error('Bloqueado: Tipos de mão de obra incompatíveis!');\r\n            return;\r\n        }\r\n\r\n        addLog(`SUCESSO: Movimentação permitida.`);\r\n        toast.success('Movimentação validada com sucesso!');\r\n\r\n        setMockTeams(prev => prev.map(t =>\r\n            t.id === teamId ? { ...t, members: [...t.members, emp] } : t\r\n        ));\r\n        setMockEmployees(prev => prev.filter(e => e.id !== empId));\r\n    };\r\n\r\n    const clearAll = () => {\r\n        setMockTeams([]);\r\n        setMockEmployees([]);\r\n        setLogs([]);\r\n        toast.info('Playground resetado.');\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n                <Card className=\"glass-card border-primary/20 bg-primary/5\">\r\n                    <CardHeader className=\"p-4\">\r\n                        <CardTitle className=\"text-xs uppercase font-black flex items-center gap-2\">\r\n                            <Plus className=\"w-4 h-4\" /> Gerador de Massa\r\n                        </CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent className=\"p-4 pt-0 flex flex-col gap-2\">\r\n                        <Button size=\"sm\" onClick={() => handleCreateMockEmployee('MOD')} className=\"w-full justify-start gap-2 bg-green-500/10 text-green-500 hover:bg-green-500/20 border-green-500/20\">\r\n                            <HardHat className=\"w-4 h-4\" /> Mock Pedreiro (MOD)\r\n                        </Button>\r\n                        <Button size=\"sm\" onClick={() => handleCreateMockEmployee('MOI')} className=\"w-full justify-start gap-2 bg-blue-500/10 text-blue-500 hover:bg-blue-500/20 border-blue-500/20\">\r\n                            <Users className=\"w-4 h-4\" /> Mock Engenheiro (MOI)\r\n                        </Button>\r\n                        <div className=\"h-px bg-white/5 my-1\" />\r\n                        <Button size=\"sm\" onClick={() => handleCreateMockTeam('MOD')} className=\"w-full justify-start gap-2 variant-outline\">\r\n                            <ShieldCheck className=\"w-4 h-4 text-green-500\" /> Criar Equipe MOD\r\n                        </Button>\r\n                        <Button size=\"sm\" onClick={() => handleCreateMockTeam('MOI')} className=\"w-full justify-start gap-2 variant-outline\">\r\n                            <ShieldCheck className=\"w-4 h-4 text-blue-500\" /> Criar Equipe MOI\r\n                        </Button>\r\n                        <Button size=\"sm\" variant=\"ghost\" onClick={clearAll} className=\"w-full text-red-500 hover:bg-red-500/10 mt-2\">\r\n                            <Trash2 className=\"w-4 h-4\" /> Resetar Lab\r\n                        </Button>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <div className=\"md:col-span-3 space-y-4\">\r\n                    <Card className=\"glass-card\">\r\n                        <CardHeader className=\"p-4\">\r\n                            <CardTitle className=\"text-sm font-black uppercase\">Playground de Validação</CardTitle>\r\n                            <CardDescription className=\"text-[10px]\">Simulação isolada das travas de segurança de composição de equipe.</CardDescription>\r\n                        </CardHeader>\r\n                        <CardContent className=\"p-4 pt-0\">\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                                {/* Pool de Colaboradores Mock */}\r\n                                <div className=\"space-y-3\">\r\n                                    <h4 className=\"text-[10px] uppercase font-bold text-muted-foreground flex items-center gap-2\">\r\n                                        <Fingerprint className=\"w-3 h-3\" /> Colaboradores Criados\r\n                                    </h4>\r\n                                    <div className=\"min-h-[150px] border border-dashed border-white/10 rounded-xl p-3 flex flex-wrap gap-2 content-start\">\r\n                                        {mockEmployees.length === 0 && <p className=\"text-[10px] text-muted-foreground italic m-auto\">Nenhum mock criado.</p>}\r\n                                        {mockEmployees.map(emp => (\r\n                                            <div key={emp.id} className={cn(\"p-2 rounded-lg border text-[10px] font-bold flex items-center gap-2 group relative transition-all animate-in fade-in zoom-in\", emp.laborType === 'MOD' ? \"bg-green-500/5 border-green-500/20 text-green-500\" : \"bg-blue-500/5 border-blue-500/20 text-blue-500\")}>\r\n                                                {emp.fullName}\r\n                                                <div className=\"absolute inset-0 bg-white/5 opacity-0 group-hover:opacity-100 flex items-center justify-center rounded-lg backdrop-blur-sm transition-opacity\">\r\n                                                    <span className=\"text-[8px] uppercase\">Arraste para uma equipe</span>\r\n                                                </div>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Equipes Mock */}\r\n                                <div className=\"space-y-3\">\r\n                                    <h4 className=\"text-[10px] uppercase font-bold text-muted-foreground\">Frentes de Serviço Destino</h4>\r\n                                    <div className=\"grid grid-cols-1 gap-3\">\r\n                                        {mockTeams.length === 0 && <div className=\"h-[150px] border border-dashed border-white/10 rounded-xl flex items-center justify-center text-[10px] text-muted-foreground italic\">Crie uma equipe para testar.</div>}\r\n                                        {mockTeams.map(team => (\r\n                                            <div key={team.id} className=\"p-3 rounded-xl border border-white/10 bg-white/2 space-y-2\">\r\n                                                <div className=\"flex justify-between items-center\">\r\n                                                    <span className=\"text-[11px] font-black\">{team.name}</span>\r\n                                                    <Badge className={team.laborType === 'MOD' ? \"bg-green-500/10 text-green-500\" : \"bg-blue-500/10 text-blue-500\"}>\r\n                                                        {team.laborType}\r\n                                                    </Badge>\r\n                                                </div>\r\n                                                <div className=\"min-h-[40px] border border-white/5 rounded-lg p-2 flex flex-wrap gap-1 bg-black/20\">\r\n                                                    {team.members.length === 0 && <span className=\"text-[8px] text-muted-foreground italic\">Vazia</span>}\r\n                                                    {team.members.map((m: any) => (\r\n                                                        <Badge key={m.id} variant=\"outline\" className=\"text-[8px] h-5\">{m.fullName}</Badge>\r\n                                                    ))}\r\n                                                </div>\r\n                                                {mockEmployees.length > 0 && (\r\n                                                    <div className=\"flex gap-1 pt-1 overflow-x-auto pb-1\">\r\n                                                        {mockEmployees.map(e => (\r\n                                                            <Button key={e.id} size=\"icon\" variant=\"ghost\" className=\"h-6 w-6 rounded-md hover:bg-primary/20\" title={`Mover ${e.fullName} para esta equipe`} onClick={() => handleSimulateMove(e.id, team.id)}>\r\n                                                                <Users className=\"w-3 h-3\" />\r\n                                                            </Button>\r\n                                                        ))}\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    <Card className=\"glass-card border-none bg-black/40\">\r\n                        <CardHeader className=\"p-3\">\r\n                            <CardTitle className=\"text-[10px] uppercase font-bold flex items-center gap-2\">\r\n                                <AlertCircle className=\"w-3 h-3 text-primary\" /> Console de Segurança (Lab)\r\n                            </CardTitle>\r\n                        </CardHeader>\r\n                        <CardContent className=\"p-3 pt-0 font-mono text-[9px] space-y-1\">\r\n                            {logs.length === 0 && <span className=\"text-muted-foreground italic\">Aguardando ações...</span>}\r\n                            {logs.map((log, i) => (\r\n                                <div key={i} className={cn(log.includes('ERRO') ? \"text-red-400\" : log.includes('SUCESSO') ? \"text-green-400\" : \"text-white/40\")}>\r\n                                    {log}\r\n                                </div>\r\n                            ))}\r\n                        </CardContent>\r\n                    </Card>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\auth\\MfaSetup.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useEffect' is defined but never used.","line":1,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TOTP' is defined but never used.","line":2,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'db' is defined but never used.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1600,1603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1600,1603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2969,2972],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2969,2972],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { generateSecret, TOTP, generateURI, verify } from 'otplib';\r\n\r\nimport { QRCodeSVG } from 'qrcode.react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { db } from '@/integrations/database';\r\nimport { Loader2, ShieldCheck, Copy, CheckCircle2, AlertCircle } from 'lucide-react';\r\n\r\nexport function MfaSetup({ onComplete }: { onComplete?: () => void }) {\r\n    const { profile, user, enableMfa } = useAuth();\r\n    const { toast } = useToast();\r\n    const [step, setStep] = useState<'generate' | 'verify' | 'completed'>(profile?.mfaEnabled ? 'completed' : 'generate');\r\n    const [secret, setSecret] = useState('');\r\n    const [otpUrl, setOtpUrl] = useState('');\r\n    const [verificationCode, setVerificationCode] = useState('');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    // 1. Gerar Segredo Initial\r\n    const handleGenerateSecret = () => {\r\n        try {\r\n            const newSecret = generateSecret();\r\n            const appName = 'GESTÃO VIRTUAL';\r\n            const accountName = user?.email || profile?.fullName || 'user';\r\n\r\n            const url = generateURI({\r\n                issuer: appName,\r\n                label: accountName,\r\n                secret: newSecret\r\n            });\r\n\r\n            setSecret(newSecret);\r\n            setOtpUrl(url);\r\n            setStep('verify');\r\n        } catch (error: any) {\r\n            console.error('MFA Error:', error);\r\n        }\r\n    };\r\n\r\n    // 2. Verificar o primeiro código\r\n    const handleVerifyAndEnable = async () => {\r\n        if (verificationCode.length !== 6) return;\r\n\r\n        setIsLoading(true);\r\n        try {\r\n            const isValid = await verify({\r\n                token: verificationCode,\r\n                secret: secret\r\n            });\r\n\r\n            console.log('MFA Setup Verification:', {\r\n                codeReceived: verificationCode,\r\n                isValid: isValid.valid,\r\n                secretUsed: secret.substring(0, 4) + '...'\r\n            });\r\n\r\n            if (!isValid.valid) {\r\n                toast({\r\n                    title: 'Código Inválido',\r\n                    description: 'O código inserido não coincide com o QR Code.',\r\n                    variant: 'destructive'\r\n                });\r\n                return;\r\n            }\r\n\r\n            // Salvar no Banco via AuthContext\r\n            const result = await enableMfa(secret);\r\n\r\n            if (!result.success) throw new Error(result.error);\r\n\r\n            toast({\r\n                title: 'MFA Ativado!',\r\n                description: 'Sua conta agora está protegida com autenticação de dois fatores.',\r\n            });\r\n            setStep('completed');\r\n            if (onComplete) onComplete();\r\n        } catch (error: any) {\r\n            toast({\r\n                title: 'Erro ao ativar MFA',\r\n                description: error.message,\r\n                variant: 'destructive'\r\n            });\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const copyToClipboard = () => {\r\n        navigator.clipboard.writeText(secret);\r\n        toast({ description: 'Segredo copiado para a área de transferência.' });\r\n    };\r\n\r\n    if (step === 'completed') {\r\n        return (\r\n            <div className=\"p-6 text-center space-y-4\">\r\n                <div className=\"w-16 h-16 bg-success/10 rounded-full flex items-center justify-center mx-auto\">\r\n                    <CheckCircle2 className=\"w-10 h-10 text-success\" />\r\n                </div>\r\n                <h3 className=\"text-xl font-bold\">MFA Ativado</h3>\r\n                <p className=\"text-muted-foreground\">Sua conta está blindada. Você precisará do Microsoft Authenticator para logar.</p>\r\n                <Button variant=\"outline\" className=\"w-full\" onClick={() => setStep('generate')}>\r\n                    Reconfigurar (Gerar Novo)\r\n                </Button>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"p-4 space-y-6\">\r\n            <div className=\"flex items-center gap-3 p-3 bg-primary/10 border border-primary/20 rounded-lg\">\r\n                <ShieldCheck className=\"w-5 h-5 text-primary\" />\r\n                <p className=\"text-sm font-medium\">Eleve a segurança da sua conta para o nível industrial.</p>\r\n            </div>\r\n\r\n            {step === 'generate' ? (\r\n                <div className=\"space-y-4 text-center\">\r\n                    <p className=\"text-sm text-muted-foreground\">\r\n                        Clique abaixo para gerar seu segredo único e configurar o protoloco TOTP.\r\n                    </p>\r\n                    <Button onClick={handleGenerateSecret} className=\"w-full gradient-primary\">\r\n                        Começar Configuração\r\n                    </Button>\r\n                </div>\r\n            ) : (\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"flex flex-col items-center gap-4\">\r\n                        <div className=\"p-4 bg-white rounded-xl shadow-inner inline-block\">\r\n                            <QRCodeSVG value={otpUrl} size={200} />\r\n                        </div>\r\n                        <p className=\"text-xs text-muted-foreground text-center max-w-[250px]\">\r\n                            Escaneie este QR Code usando o Microsoft Authenticator ou Google Authenticator.\r\n                        </p>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"p-3 bg-muted/50 rounded-lg border border-dashed border-white/20\">\r\n                            <Label className=\"text-[10px] uppercase text-muted-foreground mb-1 block\">Segredo Manual</Label>\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <code className=\"text-xs font-mono\">{secret}</code>\r\n                                <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" onClick={copyToClipboard}>\r\n                                    <Copy className=\"h-3 w-3\" />\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"verification\">Digite o código de 6 dígitos para validar</Label>\r\n                            <Input\r\n                                id=\"verification\"\r\n                                placeholder=\"000 000\"\r\n                                value={verificationCode}\r\n                                onChange={(e) => setVerificationCode(e.target.value.replace(/\\D/g, '').slice(0, 6))}\r\n                                className=\"text-center text-2xl tracking-[0.5em] font-bold h-14\"\r\n                            />\r\n                        </div>\r\n\r\n                        <Button\r\n                            onClick={handleVerifyAndEnable}\r\n                            className=\"w-full h-12 text-lg font-bold\"\r\n                            disabled={verificationCode.length !== 6 || isLoading}\r\n                        >\r\n                            {isLoading ? <Loader2 className=\"w-5 h-5 animate-spin mr-2\" /> : 'Ativar MFA'}\r\n                        </Button>\r\n\r\n                        <div className=\"flex items-start gap-2 text-[11px] text-amber-500 bg-amber-500/5 p-2 rounded border border-amber-500/20\">\r\n                            <AlertCircle className=\"w-3.5 h-3.5 shrink-0\" />\r\n                            <span>Não compartilhe seu segredo com ninguém. Guarde-o em local seguro.</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\auth\\PasswordGenerator.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'HelpCircle' is defined but never used.","line":2,"column":81,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":91},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has a missing dependency: 'generatePassword'. Either include it or remove the dependency array.","line":56,"column":8,"nodeType":"ArrayExpression","endLine":56,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [generatePassword]","fix":{"range":[2083,2085],"text":"[generatePassword]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react';\r\nimport { Eye, EyeOff, Copy, RefreshCw, Loader2, ShieldCheck, ShieldAlert, Info, HelpCircle } from 'lucide-react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Checkbox } from '@/components/ui/checkbox';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { cn } from '@/lib/utils';\r\n\r\ninterface PasswordGeneratorProps {\r\n    onSave: (password: string) => Promise<void>;\r\n    isSaving?: boolean;\r\n}\r\n\r\nexport function PasswordGenerator({ onSave, isSaving = false }: PasswordGeneratorProps) {\r\n    const { toast } = useToast();\r\n    const [password, setPassword] = React.useState('');\r\n    const [showPassword, setShowPassword] = React.useState(true);\r\n    const [length, setLength] = React.useState(12);\r\n    const [options, setOptions] = React.useState({\r\n        uppercase: true,\r\n        lowercase: true,\r\n        numbers: true,\r\n        symbols: true\r\n    });\r\n\r\n    const generatePassword = React.useCallback(() => {\r\n        const charSets = {\r\n            uppercase: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',\r\n            lowercase: 'abcdefghijklmnopqrstuvwxyz',\r\n            numbers: '0123456789',\r\n            symbols: '!@#$%^&*()_+~`|}{[]:;?><,./-='\r\n        };\r\n\r\n        let chars = '';\r\n        if (options.uppercase) chars += charSets.uppercase;\r\n        if (options.lowercase) chars += charSets.lowercase;\r\n        if (options.numbers) chars += charSets.numbers;\r\n        if (options.symbols) chars += charSets.symbols;\r\n\r\n        if (!chars) {\r\n            toast({ title: 'Aviso', description: 'Selecione pelo menos um tipo de caractere', variant: 'destructive' });\r\n            return;\r\n        }\r\n\r\n        let generated = '';\r\n        for (let i = 0; i < length; i++) {\r\n            generated += chars.charAt(Math.floor(Math.random() * chars.length));\r\n        }\r\n        setPassword(generated);\r\n    }, [length, options, toast]);\r\n\r\n    // Generate once on mount\r\n    React.useEffect(() => {\r\n        generatePassword();\r\n    }, []);\r\n\r\n    const copyToClipboard = () => {\r\n        navigator.clipboard.writeText(password);\r\n        toast({ title: 'Copiado!', description: 'Senha copiada para a área de transferência.' });\r\n    };\r\n\r\n    const getStrength = () => {\r\n        if (!password) return { label: 'Empty', color: 'text-muted-foreground' };\r\n        let score = 0;\r\n        if (password.length > 8) score++;\r\n        if (password.length > 12) score++;\r\n        if (/[A-Z]/.test(password)) score++;\r\n        if (/[0-9]/.test(password)) score++;\r\n        if (/[!@#$%^&*()]/.test(password)) score++;\r\n\r\n        if (score <= 2) return { label: 'FRACA', color: 'text-red-500 border-red-500/30 bg-red-500/5' };\r\n        if (score <= 4) return { label: 'MÉDIA', color: 'text-yellow-500 border-yellow-500/30 bg-yellow-500/5' };\r\n        return { label: 'FORTE', color: 'text-emerald-500 border-emerald-500/30 bg-emerald-500/5' };\r\n    };\r\n\r\n    const strength = getStrength();\r\n\r\n    return (\r\n        <div className=\"p-6 space-y-6 rounded-xl border border-yellow-500/20 bg-black/95 backdrop-blur-2xl shadow-2xl animate-in zoom-in-95 duration-300 ring-1 ring-white/10\">\r\n            <div className=\"text-center space-y-1 relative\">\r\n                <div className=\"absolute -top-1 left-1/2 -translate-x-1/2 w-32 h-1 bg-yellow-500/20 rounded-full\" />\r\n                <h3 className=\"text-xl font-black text-yellow-500 uppercase tracking-[0.2em] pt-4\">\r\n                    PASSWORD GENERATOR\r\n                </h3>\r\n                <p className=\"text-[10px] text-white/30 font-bold uppercase tracking-widest italic\">Industrial Security Protocol</p>\r\n            </div>\r\n\r\n            <div className=\"space-y-4\">\r\n                <div className=\"space-y-2\">\r\n                    <div className=\"flex justify-between items-end px-1\">\r\n                        <Label className=\"text-[10px] uppercase font-black tracking-widest text-white/40\">Senha Gerada</Label>\r\n                        <span className=\"text-[10px] font-black uppercase tracking-wider\">\r\n                            SEGURANÇA: <span className={cn(\"px-2 py-0.5 rounded transition-all duration-500 border\", strength.color)}>{strength.label}</span>\r\n                        </span>\r\n                    </div>\r\n                    <div className=\"relative group overflow-hidden rounded-lg\">\r\n                        <Input\r\n                            type={showPassword ? 'text' : 'password'}\r\n                            value={password}\r\n                            readOnly\r\n                            className=\"h-14 bg-white/5 border-yellow-500/30 text-white font-mono text-xl pr-28 focus-visible:ring-yellow-500/50 focus-visible:border-yellow-500 transition-all text-center tracking-extra-wide\"\r\n                        />\r\n                        <div className=\"absolute right-1.5 top-1/2 -translate-y-1/2 flex items-center gap-1 bg-black/40 backdrop-blur-md p-1 rounded-md border border-white/5\">\r\n                            <Button\r\n                                variant=\"ghost\"\r\n                                size=\"icon\"\r\n                                className=\"h-9 w-9 text-white/50 hover:text-yellow-500 hover:bg-yellow-500/10 transition-colors\"\r\n                                onClick={() => setShowPassword(!showPassword)}\r\n                                title={showPassword ? 'Ocultar' : 'Mostrar'}\r\n                            >\r\n                                {showPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n                            </Button>\r\n                            <Button\r\n                                variant=\"ghost\"\r\n                                size=\"icon\"\r\n                                className=\"h-9 w-9 text-white/50 hover:text-yellow-500 hover:bg-yellow-500/10 transition-colors\"\r\n                                onClick={copyToClipboard}\r\n                                title=\"Copiar\"\r\n                            >\r\n                                <Copy className=\"h-4 w-4\" />\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                    <Label className=\"text-[10px] uppercase font-black tracking-widest text-white/40 px-1\">Configuração Técnica</Label>\r\n                    <div className=\"grid grid-cols-2 gap-3 p-4 bg-white/2 border border-white/5 rounded-xl\">\r\n                        <div className=\"flex items-center space-x-3 cursor-pointer group bg-white/5 p-2 rounded-lg hover:bg-white/10 transition-colors\" onClick={() => setOptions({ ...options, uppercase: !options.uppercase })}>\r\n                            <Checkbox checked={options.uppercase} className=\"border-yellow-500/50 data-[state=checked]:bg-yellow-500 data-[state=checked]:border-yellow-500\" />\r\n                            <span className=\"text-[11px] font-bold text-white/70 group-hover:text-white transition-colors uppercase\">Maiúsculas</span>\r\n                        </div>\r\n                        <div className=\"flex items-center space-x-3 cursor-pointer group bg-white/5 p-2 rounded-lg hover:bg-white/10 transition-colors\" onClick={() => setOptions({ ...options, lowercase: !options.lowercase })}>\r\n                            <Checkbox checked={options.lowercase} className=\"border-yellow-500/50 data-[state=checked]:bg-yellow-500 data-[state=checked]:border-yellow-500\" />\r\n                            <span className=\"text-[11px] font-bold text-white/70 group-hover:text-white transition-colors uppercase\">Minúsculas</span>\r\n                        </div>\r\n                        <div className=\"flex items-center space-x-3 cursor-pointer group bg-white/5 p-2 rounded-lg hover:bg-white/10 transition-colors\" onClick={() => setOptions({ ...options, numbers: !options.numbers })}>\r\n                            <Checkbox checked={options.numbers} className=\"border-yellow-500/50 data-[state=checked]:bg-yellow-500 data-[state=checked]:border-yellow-500\" />\r\n                            <span className=\"text-[11px] font-bold text-white/70 group-hover:text-white transition-colors uppercase\">Números</span>\r\n                        </div>\r\n                        <div className=\"flex items-center space-x-3 cursor-pointer group bg-white/5 p-2 rounded-lg hover:bg-white/10 transition-colors\" onClick={() => setOptions({ ...options, symbols: !options.symbols })}>\r\n                            <Checkbox checked={options.symbols} className=\"border-yellow-500/50 data-[state=checked]:bg-yellow-500 data-[state=checked]:border-yellow-500\" />\r\n                            <span className=\"text-[11px] font-bold text-white/70 group-hover:text-white transition-colors uppercase\">Símbolos</span>\r\n                        </div>\r\n                        <div className=\"col-span-2 pt-2 border-t border-white/5 mt-1 flex items-center justify-between\">\r\n                            <span className=\"text-[10px] uppercase font-black text-white/30\">Comprimento</span>\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <span className=\"text-yellow-500 font-mono font-bold text-sm w-4\">{length}</span>\r\n                                <Input\r\n                                    type=\"range\"\r\n                                    min={6}\r\n                                    max={32}\r\n                                    value={length}\r\n                                    onChange={(e) => setLength(parseInt(e.target.value))}\r\n                                    className=\"h-1.5 w-32 bg-white/10 rounded-full appearance-none cursor-pointer accent-yellow-500 hover:accent-yellow-400\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 pt-2\">\r\n                    <Button\r\n                        variant=\"outline\"\r\n                        className=\"w-full border-yellow-500/50 text-yellow-500 hover:bg-yellow-500/10 font-black h-12 rounded-lg transition-all uppercase tracking-widest text-xs\"\r\n                        onClick={generatePassword}\r\n                    >\r\n                        <RefreshCw className=\"w-4 h-4 mr-2\" />\r\n                        Nova Senha\r\n                    </Button>\r\n                    <Button\r\n                        className=\"w-full bg-yellow-500 hover:bg-yellow-600 text-black font-black h-12 rounded-lg shadow-lg shadow-yellow-500/20 active:scale-[0.98] transition-all uppercase tracking-widest text-xs\"\r\n                        onClick={() => onSave(password)}\r\n                        disabled={isSaving}\r\n                    >\r\n                        {isSaving ? (\r\n                            <Loader2 className=\"w-4 h-4 animate-spin mr-2\" />\r\n                        ) : (\r\n                            <ShieldCheck className=\"w-4 h-4 mr-2\" />\r\n                        )}\r\n                        Salvar Acesso\r\n                    </Button>\r\n                </div>\r\n\r\n                <div className=\"mt-4 pt-4 border-t border-white/5 animate-in fade-in slide-in-from-bottom-2 duration-700\">\r\n                    <div className=\"flex flex-col gap-3\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <div className=\"p-1 rounded bg-yellow-500/10 border border-yellow-500/20\">\r\n                                <Info className=\"w-3.5 h-3.5 text-yellow-500\" />\r\n                            </div>\r\n                            <h4 className=\"text-[10px] font-black text-yellow-500 uppercase tracking-widest\">Protocolo de Segurança</h4>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-2 gap-x-6 gap-y-2 text-[10px] text-white/40 leading-tight\">\r\n                            <div className=\"flex gap-2\">\r\n                                <span className=\"text-yellow-500/70 font-bold\">•</span>\r\n                                <p><strong>Entropy:</strong> Com {length} caracteres, a complexidade é exponencial.</p>\r\n                            </div>\r\n                            <div className=\"flex gap-2\">\r\n                                <span className=\"text-yellow-500/70 font-bold\">•</span>\r\n                                <p><strong>Storage:</strong> Senhas são processadas via hashing irreversível no servidor.</p>\r\n                            </div>\r\n                            <div className=\"flex gap-2\">\r\n                                <span className=\"text-yellow-500/70 font-bold\">•</span>\r\n                                <p><strong>Transit:</strong> Transferência protegida por criptografia de ponta Orion (TLS).</p>\r\n                            </div>\r\n                            <div className=\"flex gap-2\">\r\n                                <span className=\"text-yellow-500/70 font-bold\">•</span>\r\n                                <p><strong>Control:</strong> Toda alteração administrativa é registrada em logs de auditoria.</p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"p-3 bg-red-500/5 rounded-lg border border-red-500/10 mt-1\">\r\n                            <p className=\"text-[9px] text-red-400 italic font-medium leading-relaxed\">\r\n                                <ShieldAlert className=\"inline w-3 h-3 mr-1 -mt-0.5\" />\r\n                                <strong>Aviso:</strong> É obrigação do administrador reportar esta senha ao usuário por canal seguro e externo ao sistema.\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\auth\\PasswordResetRequestForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":45,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { useMessages } from '@/hooks/useMessages';\r\nimport { Loader2, Mail, User, Building2 } from 'lucide-react';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\nexport function PasswordResetRequestForm() {\r\n    const [email, setEmail] = useState('');\r\n    const [fullName, setFullName] = useState('');\r\n    const [identification, setIdentification] = useState('');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const { sendMessage } = useMessages();\r\n    const { toast } = useToast();\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setIsLoading(true);\r\n\r\n        try {\r\n            const result = await sendMessage({\r\n                type: 'PASSWORD_RESET',\r\n                subject: `Redefinição de Senha - ${fullName}`,\r\n                content: `Solicitação de redefinição de senha.\\n\\nNome: ${fullName}\\nE-mail: ${email}\\nIdentificação: ${identification}`,\r\n                senderEmail: email,\r\n                recipientRole: 'admin',\r\n                metadata: {\r\n                    source: 'login_screen',\r\n                    fullName: fullName,\r\n                    email: email,\r\n                    identification: identification\r\n                }\r\n            });\r\n\r\n            if (result.success) {\r\n                toast({\r\n                    title: 'Solicitação Enviada',\r\n                    description: 'Sua solicitação foi registrada. Um administrador analisará e entrará em contato.',\r\n                });\r\n                setEmail('');\r\n                setFullName('');\r\n                setIdentification('');\r\n            }\r\n        } catch (error) {\r\n            toast({\r\n                title: 'Erro',\r\n                description: 'Não foi possível enviar a solicitação.',\r\n                variant: 'destructive'\r\n            });\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <form onSubmit={handleSubmit} className=\"space-y-4 pt-4\">\r\n            <div className=\"space-y-2\">\r\n                <Label htmlFor=\"reset-name\" className=\"flex items-center gap-2\">\r\n                    <User className=\"w-3 h-3\" />\r\n                    Nome Completo *\r\n                </Label>\r\n                <Input\r\n                    id=\"reset-name\"\r\n                    type=\"text\"\r\n                    placeholder=\"Seu nome completo\"\r\n                    value={fullName}\r\n                    onChange={(e) => setFullName(e.target.value)}\r\n                    required\r\n                />\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n                <Label htmlFor=\"reset-email\" className=\"flex items-center gap-2\">\r\n                    <Mail className=\"w-3 h-3\" />\r\n                    E-mail Cadastrado *\r\n                </Label>\r\n                <Input\r\n                    id=\"reset-email\"\r\n                    type=\"email\"\r\n                    placeholder=\"seu@email.com\"\r\n                    value={email}\r\n                    onChange={(e) => setEmail(e.target.value)}\r\n                    required\r\n                />\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n                <Label htmlFor=\"reset-ident\" className=\"flex items-center gap-2\">\r\n                    <Building2 className=\"w-3 h-3\" />\r\n                    Empresa / Obra / Canteiro *\r\n                </Label>\r\n                <Input\r\n                    id=\"reset-ident\"\r\n                    placeholder=\"Ex: Construtora XYZ - Obra Alpha\"\r\n                    value={identification}\r\n                    onChange={(e) => setIdentification(e.target.value)}\r\n                    required\r\n                />\r\n                <p className=\"text-[10px] text-muted-foreground\">\r\n                    Necessário para validação de identidade.\r\n                </p>\r\n            </div>\r\n            <Button\r\n                type=\"submit\"\r\n                className=\"w-full gradient-primary\"\r\n                disabled={isLoading || !email || !fullName || !identification}\r\n            >\r\n                {isLoading ? <Loader2 className=\"w-4 h-4 animate-spin mr-2\" /> : null}\r\n                Enviar Solicitação\r\n            </Button>\r\n        </form>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\auth\\PermissionGate.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'can' is assigned a value but never used.","line":22,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":16}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { usePermissions, UserPermission } from '@/hooks/usePermissions';\r\n\r\ninterface PermissionGateProps {\r\n    children: React.ReactNode;\r\n    permission?: UserPermission;\r\n    permissions?: UserPermission[];\r\n    any?: boolean; // Se true, canAny. Se false ou omitido, canAll.\r\n    fallback?: React.ReactNode;\r\n}\r\n\r\n/**\r\n * Componente utilitário para renderizar conteúdo opcionalmente com base nas permissões do Custom SU.\r\n */\r\nexport const PermissionGate: React.FC<PermissionGateProps> = ({\r\n    children,\r\n    permission,\r\n    permissions = [],\r\n    any = false,\r\n    fallback = null\r\n}) => {\r\n    const { can, canAll, canAny } = usePermissions();\r\n\r\n    const allPerms = permission ? [permission, ...permissions] : permissions;\r\n\r\n    if (allPerms.length === 0) return <>{children}</>;\r\n\r\n    const hasAccess = any ? canAny(allPerms) : canAll(allPerms);\r\n\r\n    if (hasAccess) {\r\n        return <>{children}</>;\r\n    }\r\n\r\n    return <>{fallback}</>;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\auth\\QRScanner.tsx","messages":[{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":122,"column":48,"nodeType":"BlockStatement","messageId":"unexpected","endLine":122,"endColumn":51,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4889,4890],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'startScanning'. Either include it or remove the dependency array.","line":126,"column":8,"nodeType":"ArrayExpression","endLine":126,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [startScanning]","fix":{"range":[4967,4969],"text":"[startScanning]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":151,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5771,5774],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5771,5774],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":173,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":173,"endColumn":21}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState, useRef } from 'react';\r\nimport { Html5Qrcode } from 'html5-qrcode';\r\nimport { db } from '@/integrations/database';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { Loader2, QrCode, CheckCircle2, XCircle, Camera, RefreshCw } from 'lucide-react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Label } from '@/components/ui/label';\r\n\r\ninterface QRScannerProps {\r\n    onSuccess?: () => void;\r\n    onClose?: () => void;\r\n}\r\n\r\nexport function QRScanner({ onSuccess, onClose }: QRScannerProps) {\r\n    const [isProcessing, setIsProcessing] = useState(false);\r\n    const [isLoadingCameras, setIsLoadingCameras] = useState(true);\r\n    const [cameras, setCameras] = useState<Array<{ id: string, label: string }>>([]);\r\n    const [selectedCameraId, setSelectedCameraId] = useState<string>('');\r\n    const [isScanning, setIsScanning] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [success, setSuccess] = useState(false);\r\n\r\n    const scannerRef = useRef<Html5Qrcode | null>(null);\r\n    const initTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\r\n    const isMountedRef = useRef(true);\r\n    const { toast } = useToast();\r\n\r\n    const startScanning = async (overrideCameraId?: string) => {\r\n        const cameraId = overrideCameraId || selectedCameraId;\r\n        if (!cameraId || !isMountedRef.current) return;\r\n\r\n        setError(null);\r\n        setIsScanning(true);\r\n\r\n        try {\r\n            // Pequeno delay para garantir que o div #qr-reader foi renderizado\r\n            await new Promise(resolve => setTimeout(resolve, 100));\r\n            if (!isMountedRef.current) return;\r\n\r\n            const html5QrCode = new Html5Qrcode(\"qr-reader\");\r\n            scannerRef.current = html5QrCode;\r\n\r\n            const config = {\r\n                fps: 15,\r\n                qrbox: { width: 250, height: 250 },\r\n                aspectRatio: 1.0\r\n            };\r\n\r\n            await html5QrCode.start(\r\n                cameraId,\r\n                config,\r\n                onScanSuccess,\r\n                () => { } // Ignore errors\r\n            );\r\n        } catch (err) {\r\n            console.error(\"Failed to start scanner:\", err);\r\n            if (isMountedRef.current) {\r\n                setError(\"Não foi possível iniciar o scanner nesta câmera.\");\r\n                setIsScanning(false);\r\n            }\r\n        }\r\n    };\r\n\r\n    const stopScanning = async () => {\r\n        try {\r\n            if (scannerRef.current) {\r\n                if (scannerRef.current.isScanning) {\r\n                    await scannerRef.current.stop();\r\n                }\r\n                await scannerRef.current.clear();\r\n            }\r\n        } catch (err) {\r\n            console.debug(\"Error during scanner shutdown:\", err);\r\n        } finally {\r\n            if (isMountedRef.current) {\r\n                setIsScanning(false);\r\n                scannerRef.current = null;\r\n            }\r\n        }\r\n    };\r\n\r\n    // Initialize/Request cameras\r\n    useEffect(() => {\r\n        isMountedRef.current = true;\r\n\r\n        const initCameras = async () => {\r\n            try {\r\n                const devices = await Html5Qrcode.getCameras();\r\n                if (devices && devices.length > 0) {\r\n                    const firstCameraId = devices[0].id;\r\n                    if (isMountedRef.current) {\r\n                        setCameras(devices.map(d => ({ id: d.id, label: d.label || `Câmera ${devices.indexOf(d) + 1}` })));\r\n                        setSelectedCameraId(firstCameraId);\r\n\r\n                        // Inicia automaticamente após um pequeno delay para garantir que o elemento DOM está pronto\r\n                        initTimeoutRef.current = setTimeout(() => {\r\n                            if (isMountedRef.current) {\r\n                                startScanning(firstCameraId);\r\n                            }\r\n                        }, 500);\r\n                    }\r\n                } else {\r\n                    if (isMountedRef.current) setError(\"Nenhuma câmera encontrada no dispositivo.\");\r\n                }\r\n            } catch (err) {\r\n                console.error(\"Error getting cameras:\", err);\r\n                if (isMountedRef.current) setError(\"Permissão de câmera negada ou erro ao acessar dispositivos.\");\r\n            } finally {\r\n                if (isMountedRef.current) setIsLoadingCameras(false);\r\n            }\r\n        };\r\n\r\n        initCameras();\r\n\r\n        return () => {\r\n            isMountedRef.current = false;\r\n            if (initTimeoutRef.current) clearTimeout(initTimeoutRef.current);\r\n            const scanner = scannerRef.current;\r\n            if (scanner) {\r\n                scanner.stop().catch(() => { });\r\n                try { scanner.clear(); } catch { }\r\n            }\r\n            scannerRef.current = null;\r\n        };\r\n    }, []);\r\n\r\n    const onScanSuccess = async (decodedText: string) => {\r\n        if (isProcessing || success || !isMountedRef.current) return;\r\n\r\n        if (!decodedText.startsWith('ttpro_link_')) {\r\n            toast({\r\n                title: \"QR Code Inválido\",\r\n                description: \"Este código não pertence ao GESTÃO VIRTUAL.\",\r\n                variant: \"destructive\"\r\n            });\r\n            return;\r\n        }\r\n\r\n        setIsProcessing(true);\r\n        setError(null);\r\n\r\n        try {\r\n            const { data: { session } } = await db.auth.getSession();\r\n\r\n            if (!session) {\r\n                if (isMountedRef.current) setError(\"Sessão não encontrada. Faça login novamente.\");\r\n                return;\r\n            }\r\n\r\n            const { error: updateError } = await (db as any)\r\n                .from('qr_sessions')\r\n                .update({ status: 'approved', auth_payload: session })\r\n                .eq('session_token', decodedText)\r\n                .eq('status', 'pending');\r\n\r\n            if (updateError) {\r\n                if (isMountedRef.current) setError(\"O link expirou ou já foi utilizado.\");\r\n            } else {\r\n                // PRIMEIRO para o scanner para limpar o DOM\r\n                await stopScanning();\r\n\r\n                if (isMountedRef.current) {\r\n                    setTimeout(() => {\r\n                        if (isMountedRef.current) {\r\n                            setSuccess(true);\r\n                            toast({ title: \"Acesso aprovado!\", description: \"Dispositivo pareado com sucesso.\" });\r\n                            if (onSuccess) setTimeout(onSuccess, 1500);\r\n                        }\r\n                    }, 300);\r\n                }\r\n            }\r\n        } catch (err) {\r\n            if (isMountedRef.current) setError(\"Ocorreu um erro ao processar a autorização.\");\r\n        } finally {\r\n            if (isMountedRef.current) setIsProcessing(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex flex-col gap-6 p-2 w-full\">\r\n            {/* Success View */}\r\n            {success && (\r\n                <div className=\"flex flex-col items-center justify-center py-16 px-4 animate-scale-in text-center w-full\">\r\n                    <div className=\"w-24 h-24 rounded-full bg-green-500/20 text-green-500 flex items-center justify-center mb-6 shadow-[0_0_30px_rgba(34,197,94,0.3)] border border-green-500/30\">\r\n                        <CheckCircle2 className=\"w-14 h-14\" />\r\n                    </div>\r\n                    <h3 className=\"text-2xl font-bold mb-2\">Login Aprovado!</h3>\r\n                    <p className=\"text-muted-foreground\">O computador foi conectado com segurança.</p>\r\n                </div>\r\n            )}\r\n\r\n            {/* Scanner View (always in DOM but hidden on success) */}\r\n            <div className={success ? 'hidden' : 'block'}>\r\n                <div className=\"flex flex-col gap-6\">\r\n                    <div className=\"relative group max-w-[350px] mx-auto w-full\">\r\n                        {/* Permanent Scanner Container */}\r\n                        <div className=\"relative aspect-square w-full overflow-hidden rounded-3xl border border-white/10 bg-black/40 glass-scanner shadow-2xl\">\r\n                            {/* Conteúdo do Scanner (Gerenciado pela biblioteca) */}\r\n                            <div id=\"qr-reader\" className=\"w-full h-full\" />\r\n\r\n                            {/* Overlays (Gerenciados pelo React) */}\r\n                            {!isScanning && !success && (\r\n                                <div className=\"absolute inset-0 flex flex-col items-center justify-center text-center p-8 bg-slate-900/50 backdrop-blur-sm z-10 transition-all\">\r\n                                    <div className=\"w-16 h-16 rounded-2xl bg-primary/10 flex items-center justify-center mb-4 border border-primary/20\">\r\n                                        <Camera className=\"w-8 h-8 text-primary\" />\r\n                                    </div>\r\n                                    <p className=\"text-sm font-medium text-white/80\">Câmera pronta</p>\r\n                                    <p className=\"text-xs text-white/40 mt-1\">Selecione a câmera e inicie o escaneamento</p>\r\n                                </div>\r\n                            )}\r\n\r\n                            {isScanning && (\r\n                                <>\r\n                                    <div className=\"absolute inset-0 pointer-events-none z-10 qr-scanner-overlay\" />\r\n                                    <div className=\"absolute top-[calc(50%-125px)] left-[calc(50%-125px)] w-[250px] h-[250px] border-2 border-primary/50 rounded-2xl pointer-events-none z-20 overflow-hidden\">\r\n                                        <div className=\"w-full h-[3px] bg-primary shadow-[0_0_15px_#3b82f6] animate-scan\" />\r\n                                    </div>\r\n                                    <div className=\"absolute bottom-6 left-0 right-0 flex justify-center z-30\">\r\n                                        <div className=\"px-4 py-1.5 rounded-full bg-black/60 backdrop-blur-md border border-white/10 text-[10px] font-bold text-white/70 uppercase tracking-widest flex items-center gap-2\">\r\n                                            <div className=\"w-2 h-2 rounded-full bg-red-500 animate-pulse\" />\r\n                                            Buscando QR Code...\r\n                                        </div>\r\n                                    </div>\r\n                                </>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"absolute -top-1 -right-1 w-8 h-8 border-t-2 border-r-2 border-primary rounded-tr-xl pointer-events-none\" />\r\n                        <div className=\"absolute -bottom-1 -left-1 w-8 h-8 border-b-2 border-l-2 border-primary rounded-bl-xl pointer-events-none\" />\r\n                    </div>\r\n\r\n                    <div className=\"space-y-3\">\r\n                        <div className=\"flex items-center justify-between px-1\">\r\n                            <Label className=\"text-[10px] font-bold uppercase tracking-widest text-white/40\">Fonte de Captura</Label>\r\n                            {cameras.length > 1 && (\r\n                                <span className=\"text-[10px] font-medium text-primary bg-primary/10 px-2 py-0.5 rounded-full\">\r\n                                    {cameras.length} dispositivos\r\n                                </span>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"flex gap-2\">\r\n                            <Select\r\n                                value={selectedCameraId}\r\n                                onValueChange={(val) => {\r\n                                    setSelectedCameraId(val);\r\n                                    if (isScanning) {\r\n                                        stopScanning().then(() => startScanning(val));\r\n                                    }\r\n                                }}\r\n                                disabled={isLoadingCameras || isProcessing}\r\n                            >\r\n                                <SelectTrigger className=\"glass-card border-white/5 h-12 flex-1 text-white/80\">\r\n                                    {isLoadingCameras ? (\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <Loader2 className=\"w-3 h-3 animate-spin\" />\r\n                                            <span className=\"text-xs\">Buscando...</span>\r\n                                        </div>\r\n                                    ) : (\r\n                                        <SelectValue placeholder=\"Escolha a câmera\" />\r\n                                    )}\r\n                                </SelectTrigger>\r\n                                <SelectContent className=\"glass-card border-white/10\">\r\n                                    {cameras.map(cam => (\r\n                                        <SelectItem key={cam.id} value={cam.id} className=\"text-sm\">\r\n                                            {cam.label}\r\n                                        </SelectItem>\r\n                                    ))}\r\n                                </SelectContent>\r\n                            </Select>\r\n\r\n                            {cameras.length > 1 && (\r\n                                <Button\r\n                                    variant=\"outline\"\r\n                                    size=\"icon\"\r\n                                    onClick={async () => {\r\n                                        const currentIndex = cameras.findIndex(c => c.id === selectedCameraId);\r\n                                        const nextIndex = (currentIndex + 1) % cameras.length;\r\n                                        const nextId = cameras[nextIndex].id;\r\n                                        setSelectedCameraId(nextId);\r\n                                        if (isScanning) {\r\n                                            await stopScanning();\r\n                                            await startScanning(nextId);\r\n                                        }\r\n                                    }}\r\n                                    className=\"h-12 w-12 glass-card border-white/5 text-primary hover:bg-primary/10\"\r\n                                    disabled={isLoadingCameras || isProcessing}\r\n                                    title=\"Alternar Câmera\"\r\n                                >\r\n                                    <RefreshCw className={`w-5 h-5 ${isScanning ? 'animate-spin-slow' : ''}`} />\r\n                                </Button>\r\n                            )}\r\n\r\n                            {!isScanning ? (\r\n                                <Button\r\n                                    onClick={() => startScanning()}\r\n                                    className=\"h-12 gradient-primary text-white shadow-glow px-6 font-bold\"\r\n                                    disabled={!selectedCameraId || isLoadingCameras || isProcessing}\r\n                                >\r\n                                    Iniciar\r\n                                </Button>\r\n                            ) : (\r\n                                <Button\r\n                                    variant=\"destructive\"\r\n                                    onClick={stopScanning}\r\n                                    className=\"h-12 px-6 bg-destructive/80 hover:bg-destructive shadow-lg shadow-destructive/20 font-bold\"\r\n                                    disabled={!isScanning || isProcessing}\r\n                                >\r\n                                    Parar\r\n                                </Button>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {error && (\r\n                        <div className=\"p-3 rounded-xl bg-destructive/10 border border-destructive/20 flex items-center gap-3 animate-fade-in\">\r\n                            <XCircle className=\"w-4 h-4 text-destructive shrink-0\" />\r\n                            <span className=\"text-xs text-destructive font-medium leading-tight\">{error}</span>\r\n                        </div>\r\n                    )}\r\n\r\n                    {isProcessing && (\r\n                        <div className=\"flex items-center justify-center gap-3 py-2 text-primary animate-pulse\">\r\n                            <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n                            <span className=\"text-xs font-bold uppercase tracking-widest\">Aguardando...</span>\r\n                        </div>\r\n                    )}\r\n\r\n                    {!isScanning && !error && (\r\n                        <div className=\"flex items-start gap-3 p-4 rounded-2xl bg-muted/30 border border-white/5\">\r\n                            <QrCode className=\"w-5 h-5 text-primary mt-0.5 shrink-0\" />\r\n                            <p className=\"text-xs text-muted-foreground leading-relaxed\">\r\n                                Aponte a câmera para o QR Code gerado no desktop.\r\n                            </p>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {onClose && (\r\n                <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    onClick={onClose}\r\n                    className=\"w-full text-muted-foreground hover:text-foreground transition-colors mt-2\"\r\n                >\r\n                    Cancelar Operação\r\n                </Button>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\composition\\CompositionStatsPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CardDescription' is defined but never used.","line":13,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":67},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Badge' is defined but never used.","line":14,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[969,972],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[969,972],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[991,994],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[991,994],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'COLORS' is assigned a value but never used.","line":32,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'selectedProjectId' is defined but never used.","line":40,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'sites' is defined but never used.","line":41,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'projects' is defined but never used.","line":42,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":13}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport {\r\n    PieChart, Pie, Cell, ResponsiveContainer, Tooltip,\r\n    BarChart, Bar, XAxis, YAxis, CartesianGrid, Legend\r\n} from 'recharts';\r\nimport {\r\n    Sheet,\r\n    SheetContent,\r\n    SheetHeader,\r\n    SheetTitle,\r\n    SheetDescription,\r\n} from \"@/components/ui/sheet\";\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { ScrollArea } from '@/components/ui/scroll-area';\r\nimport { Employee } from '@/hooks/useEmployees';\r\nimport { Team } from '@/hooks/useTeams';\r\nimport { getLaborClassification } from '@/utils/laborUtils';\r\nimport { Users, HardHat, TrendingUp, PieChart as PieChartIcon, BarChart3 } from 'lucide-react';\r\n\r\ninterface CompositionStatsPanelProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    employees: Employee[];\r\n    teams: Team[];\r\n    selectedSiteId: string;\r\n    selectedProjectId: string;\r\n    sites: any[];\r\n    projects: any[];\r\n}\r\n\r\nconst COLORS = ['#10b981', '#3b82f6', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899'];\r\n\r\nexport default function CompositionStatsPanel({\r\n    isOpen,\r\n    onClose,\r\n    employees,\r\n    teams,\r\n    selectedSiteId,\r\n    selectedProjectId,\r\n    sites,\r\n    projects\r\n}: CompositionStatsPanelProps) {\r\n\r\n    // Data aggregation for MOD vs MOI\r\n    const modMoiData = React.useMemo(() => {\r\n        // IDs assigned to teams\r\n        const assignedIds = new Set([\r\n            ...teams.flatMap(t => t.members),\r\n            ...teams.map(t => t.supervisorId).filter(Boolean) as string[]\r\n        ]);\r\n\r\n        const assignedEmployees = employees.filter(e => assignedIds.has(e.id));\r\n\r\n        const counts = assignedEmployees.reduce((acc, emp) => {\r\n            const laborType = getLaborClassification(emp.functionName);\r\n            acc[laborType] = (acc[laborType] || 0) + 1;\r\n            return acc;\r\n        }, { MOD: 0, MOI: 0 } as Record<string, number>);\r\n\r\n        return [\r\n            { name: 'MOD (Direta)', value: counts.MOD, color: '#10b981' }, // Emerald\r\n            { name: 'MOI (Indireta)', value: counts.MOI, color: '#3b82f6' } // Blue\r\n        ];\r\n    }, [employees, teams]);\r\n\r\n    // Data aggregation for Team Sizes\r\n    const teamSizesData = React.useMemo(() => {\r\n        return teams\r\n            .filter(t => (selectedSiteId === 'all' || t.siteId === selectedSiteId))\r\n            .map(t => ({\r\n                name: t.name,\r\n                membros: t.members.length,\r\n                total: t.members.length + (t.supervisorId ? 1 : 0)\r\n            }))\r\n            .sort((a, b) => b.total - a.total);\r\n    }, [teams, selectedSiteId]);\r\n\r\n    // Labor Diversity (Functions)\r\n    const functionDiversityData = React.useMemo(() => {\r\n        const assignedIds = new Set([\r\n            ...teams.flatMap(t => t.members),\r\n            ...teams.map(t => t.supervisorId).filter(Boolean) as string[]\r\n        ]);\r\n        const assignedEmployees = employees.filter(e => assignedIds.has(e.id));\r\n\r\n        const counts = assignedEmployees.reduce((acc, emp) => {\r\n            const func = emp.functionName || 'Outros';\r\n            acc[func] = (acc[func] || 0) + 1;\r\n            return acc;\r\n        }, {} as Record<string, number>);\r\n\r\n        return Object.entries(counts)\r\n            .map(([name, value]) => ({ name, value }))\r\n            .sort((a, b) => b.value - a.value)\r\n            .slice(0, 6);\r\n    }, [employees, teams]);\r\n\r\n    const totalAllocated = React.useMemo(() => {\r\n        const ids = new Set([\r\n            ...teams.flatMap(t => t.members),\r\n            ...teams.map(t => t.supervisorId).filter(Boolean) as string[]\r\n        ]);\r\n        return ids.size;\r\n    }, [teams]);\r\n\r\n    const totalAvailable = employees.length;\r\n    const allocationRate = totalAvailable > 0 ? (totalAllocated / totalAvailable) * 100 : 0;\r\n\r\n    return (\r\n        <Sheet open={isOpen} onOpenChange={onClose}>\r\n            <SheetContent side=\"right\" className=\"w-full sm:max-w-2xl glass-card border-white/10 p-0 text-foreground\">\r\n                <SheetHeader className=\"p-6 border-b border-white/5 bg-primary/5\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"p-2 rounded-xl bg-primary/20\">\r\n                            <TrendingUp className=\"w-6 h-6 text-primary\" />\r\n                        </div>\r\n                        <div>\r\n                            <SheetTitle className=\"text-2xl font-display font-bold\">Analytics da Equipe</SheetTitle>\r\n                            <SheetDescription className=\"text-muted-foreground\">\r\n                                Indicadores de alocação e distribuição de mão de obra.\r\n                            </SheetDescription>\r\n                        </div>\r\n                    </div>\r\n                </SheetHeader>\r\n\r\n                <ScrollArea className=\"h-[calc(100vh-10rem)] p-6\">\r\n                    <div className=\"space-y-6\">\r\n                        {/* Key Metrics Row */}\r\n                        <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\r\n                            <Card className=\"bg-black/20 border-white/5\">\r\n                                <CardContent className=\"p-4 flex flex-col items-center justify-center text-center\">\r\n                                    <Users className=\"w-5 h-5 text-primary mb-1\" />\r\n                                    <span className=\"text-2xl font-black\">{totalAllocated}</span>\r\n                                    <span className=\"text-[10px] uppercase font-bold text-muted-foreground\">Alocados</span>\r\n                                </CardContent>\r\n                            </Card>\r\n                            <Card className=\"bg-black/20 border-white/5\">\r\n                                <CardContent className=\"p-4 flex flex-col items-center justify-center text-center\">\r\n                                    <HardHat className=\"w-5 h-5 text-emerald-500 mb-1\" />\r\n                                    <span className=\"text-2xl font-black\">{allocationRate.toFixed(1)}%</span>\r\n                                    <span className=\"text-[10px] uppercase font-bold text-muted-foreground\">Taxa de Alocação</span>\r\n                                </CardContent>\r\n                            </Card>\r\n                            <Card className=\"bg-black/20 border-white/5 col-span-2 md:col-span-1\">\r\n                                <CardContent className=\"p-4 flex flex-col items-center justify-center text-center\">\r\n                                    <TrendingUp className=\"w-5 h-5 text-blue-500 mb-1\" />\r\n                                    <span className=\"text-2xl font-black\">{teams.length}</span>\r\n                                    <span className=\"text-[10px] uppercase font-bold text-muted-foreground\">Frentes Ativas</span>\r\n                                </CardContent>\r\n                            </Card>\r\n                        </div>\r\n\r\n                        {/* Charts Section */}\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                            {/* MOD vs MOI */}\r\n                            <Card className=\"bg-white/5 border-white/5\">\r\n                                <CardHeader className=\"py-4\">\r\n                                    <CardTitle className=\"text-sm flex items-center gap-2\">\r\n                                        <PieChartIcon className=\"w-4 h-4 text-primary\" />\r\n                                        Distribuição MOD/MOI\r\n                                    </CardTitle>\r\n                                </CardHeader>\r\n                                <CardContent className=\"h-64\">\r\n                                    <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                        <PieChart>\r\n                                            <Pie\r\n                                                data={modMoiData}\r\n                                                cx=\"50%\"\r\n                                                cy=\"50%\"\r\n                                                innerRadius={60}\r\n                                                outerRadius={80}\r\n                                                paddingAngle={5}\r\n                                                dataKey=\"value\"\r\n                                            >\r\n                                                {modMoiData.map((entry, index) => (\r\n                                                    <Cell key={`cell-${index}`} fill={entry.color} />\r\n                                                ))}\r\n                                            </Pie>\r\n                                            <Tooltip\r\n                                                contentStyle={{ backgroundColor: '#000', border: '1px solid #333' }}\r\n                                                itemStyle={{ color: '#fff' }}\r\n                                            />\r\n                                            <Legend verticalAlign=\"bottom\" height={36} />\r\n                                        </PieChart>\r\n                                    </ResponsiveContainer>\r\n                                </CardContent>\r\n                            </Card>\r\n\r\n                            {/* Job Diversity */}\r\n                            <Card className=\"bg-white/5 border-white/5\">\r\n                                <CardHeader className=\"py-4\">\r\n                                    <CardTitle className=\"text-sm flex items-center gap-2\">\r\n                                        <BarChart3 className=\"w-4 h-4 text-primary\" />\r\n                                        Principais Cargos\r\n                                    </CardTitle>\r\n                                </CardHeader>\r\n                                <CardContent className=\"h-64\">\r\n                                    <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                        <BarChart data={functionDiversityData} layout=\"vertical\">\r\n                                            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#333\" />\r\n                                            <XAxis type=\"number\" hide />\r\n                                            <YAxis\r\n                                                dataKey=\"name\"\r\n                                                type=\"category\"\r\n                                                width={100}\r\n                                                style={{ fontSize: '10px' }}\r\n                                            />\r\n                                            <Tooltip\r\n                                                contentStyle={{ backgroundColor: '#000', border: '1px solid #333' }}\r\n                                                itemStyle={{ color: '#fff' }}\r\n                                            />\r\n                                            <Bar dataKey=\"value\" fill=\"#fbbf24\" radius={[0, 4, 4, 0]} />\r\n                                        </BarChart>\r\n                                    </ResponsiveContainer>\r\n                                </CardContent>\r\n                            </Card>\r\n                        </div>\r\n\r\n                        {/* Team Sizes Bar Chart */}\r\n                        <Card className=\"bg-white/5 border-white/5\">\r\n                            <CardHeader>\r\n                                <CardTitle className=\"text-sm\">Tamanho das Equipes (Efetivo Total)</CardTitle>\r\n                            </CardHeader>\r\n                            <CardContent className=\"h-80\">\r\n                                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                    <BarChart data={teamSizesData}>\r\n                                        <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#333\" />\r\n                                        <XAxis dataKey=\"name\" style={{ fontSize: '10px' }} />\r\n                                        <YAxis style={{ fontSize: '10px' }} />\r\n                                        <Tooltip\r\n                                            contentStyle={{ backgroundColor: '#000', border: '1px solid #333' }}\r\n                                            itemStyle={{ color: '#fff' }}\r\n                                        />\r\n                                        <Bar dataKey=\"total\" fill=\"#8b5cf6\" name=\"Total Alocados\" radius={[4, 4, 0, 0]} />\r\n                                    </BarChart>\r\n                                </ResponsiveContainer>\r\n                            </CardContent>\r\n                        </Card>\r\n                    </div>\r\n                </ScrollArea>\r\n            </SheetContent>\r\n        </Sheet>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\employees\\FaceRegistrationDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'RefreshCw' is defined but never used.","line":5,"column":51,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":60},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'stopCamera'. Either include it or remove the dependency array.","line":29,"column":8,"nodeType":"ArrayExpression","endLine":29,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [open, stopCamera]","fix":{"range":[1251,1257],"text":"[open, stopCamera]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3318,3321],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3318,3321],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react';\r\nimport { useState, useRef, useEffect } from 'react';\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Camera, UserCheck, Loader2, AlertCircle, RefreshCw } from 'lucide-react';\r\nimport { useEmployees, Employee } from '@/hooks/useEmployees';\r\nimport { faceRecognitionService } from '@/services/faceRecognitionService';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\ninterface FaceRegistrationDialogProps {\r\n    employee: Employee | null;\r\n    open: boolean;\r\n    onOpenChange: (open: boolean) => void;\r\n}\r\n\r\nexport function FaceRegistrationDialog({ employee, open, onOpenChange }: FaceRegistrationDialogProps) {\r\n    const [isCapturing, setIsCapturing] = useState(false);\r\n    const [isProcessing, setIsProcessing] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [stream, setStream] = useState<MediaStream | null>(null);\r\n    const videoRef = useRef<HTMLVideoElement>(null);\r\n    const { updateEmployee } = useEmployees();\r\n    const { toast } = useToast();\r\n\r\n    useEffect(() => {\r\n        if (!open) {\r\n            stopCamera();\r\n        }\r\n    }, [open]);\r\n\r\n    const startCamera = async () => {\r\n        setError(null);\r\n        setIsCapturing(true);\r\n        try {\r\n            const newStream = await navigator.mediaDevices.getUserMedia({\r\n                video: { facingMode: 'user' }\r\n            });\r\n            setStream(newStream);\r\n            if (videoRef.current) {\r\n                videoRef.current.srcObject = newStream;\r\n            }\r\n        } catch (err) {\r\n            console.error('Error accessing camera:', err);\r\n            setError('Não foi possível acessar a câmera. Verifique as permissões.');\r\n            setIsCapturing(false);\r\n        }\r\n    };\r\n\r\n    const stopCamera = () => {\r\n        if (stream) {\r\n            stream.getTracks().forEach(track => track.stop());\r\n            setStream(null);\r\n        }\r\n        setIsCapturing(false);\r\n    };\r\n\r\n    const handleCapture = async () => {\r\n        if (!videoRef.current || !employee) return;\r\n\r\n        setIsProcessing(true);\r\n        setError(null);\r\n\r\n        try {\r\n            const descriptor = await faceRecognitionService.getDescriptor(videoRef.current);\r\n\r\n            if (descriptor) {\r\n                // Converter Float32Array para Array normal para salvar no JSON do db\r\n                const descriptorArray = Array.from(descriptor);\r\n\r\n                const result = await updateEmployee(employee.id, {\r\n                    faceDescriptor: descriptorArray\r\n                });\r\n\r\n                if (result.success) {\r\n                    toast({\r\n                        title: 'Rosto cadastrado!',\r\n                        description: `Identificação facial de ${employee.fullName} configurada com sucesso.`,\r\n                    });\r\n                    onOpenChange(false);\r\n                } else {\r\n                    setError(result.error || 'Erro ao salvar os dados faciais no servidor. Verifique se a tabela foi atualizada.');\r\n                }\r\n            } else {\r\n                setError('Nenhum rosto detectado. Tente se posicionar melhor em frente à câmera.');\r\n            }\r\n        } catch (err: any) {\r\n            console.error('Error during face registration:', err);\r\n            if (err.message?.includes('Fetch') || err.message?.includes('model')) {\r\n                setError('Erro ao carregar modelos de IA (Rede/Arquivos).');\r\n            } else {\r\n                setError('Erro técnico no processamento facial. Tente novamente.');\r\n            }\r\n        } finally {\r\n            setIsProcessing(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent className=\"sm:max-w-md glass-card border-white/10\">\r\n                <DialogHeader>\r\n                    <DialogTitle className=\"flex items-center gap-2\">\r\n                        <UserCheck className=\"w-5 h-5 text-primary\" />\r\n                        Cadastro Facial\r\n                    </DialogTitle>\r\n                    <DialogDescription>\r\n                        Registre o rosto de <strong>{employee?.fullName}</strong> para permitir o registro de ponto por biometria.\r\n                    </DialogDescription>\r\n                </DialogHeader>\r\n\r\n                <div className=\"space-y-4 py-4\">\r\n                    <div className=\"relative aspect-square rounded-3xl overflow-hidden bg-black/40 border-2 border-dashed border-white/10 flex items-center justify-center\">\r\n                        {isCapturing ? (\r\n                            <>\r\n                                <video\r\n                                    ref={videoRef}\r\n                                    autoPlay\r\n                                    playsInline\r\n                                    muted\r\n                                    className=\"w-full h-full object-cover mirror\"\r\n                                    style={{ transform: 'scaleX(-1)' }} // Mirror view for user\r\n                                />\r\n                                <div className=\"absolute inset-0 border-[30px] border-black/20 pointer-events-none\">\r\n                                    <div className=\"w-full h-full border-2 border-primary/50 rounded-full animate-pulse shadow-[0_0_50px_rgba(59,130,246,0.5)]\" />\r\n                                </div>\r\n                            </>\r\n                        ) : (\r\n                            <div className=\"text-center p-8 space-y-4\">\r\n                                <div className=\"w-20 h-20 rounded-full bg-primary/10 flex items-center justify-center mx-auto\">\r\n                                    <Camera className=\"w-10 h-10 text-primary opacity-50\" />\r\n                                </div>\r\n                                <p className=\"text-sm text-muted-foreground\">\r\n                                    Posicione o rosto no centro da moldura para um cadastro preciso.\r\n                                </p>\r\n                            </div>\r\n                        )}\r\n\r\n                        {isProcessing && (\r\n                            <div className=\"absolute inset-0 bg-black/60 backdrop-blur-sm flex flex-col items-center justify-center text-white gap-3\">\r\n                                <Loader2 className=\"w-10 h-10 animate-spin text-primary\" />\r\n                                <p className=\"font-bold animate-pulse\">Analisando Biometria...</p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {error && (\r\n                        <div className=\"p-3 rounded-lg bg-destructive/10 border border-destructive/20 text-destructive text-xs flex items-center gap-2\">\r\n                            <AlertCircle className=\"w-4 h-4 flex-shrink-0\" />\r\n                            {error}\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"flex flex-col gap-2\">\r\n                        {!isCapturing ? (\r\n                            <Button onClick={startCamera} className=\"w-full h-12 gradient-primary shadow-glow\">\r\n                                <Camera className=\"w-4 h-4 mr-2\" />\r\n                                Iniciar Câmera\r\n                            </Button>\r\n                        ) : (\r\n                            <div className=\"grid grid-cols-2 gap-3\">\r\n                                <Button\r\n                                    onClick={handleCapture}\r\n                                    disabled={isProcessing}\r\n                                    className=\"gradient-primary shadow-glow\"\r\n                                >\r\n                                    {isProcessing ? <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> : <UserCheck className=\"w-4 h-4 mr-2\" />}\r\n                                    Mapear Rosto\r\n                                </Button>\r\n                                <Button variant=\"outline\" onClick={stopCamera} disabled={isProcessing} className=\"border-white/10\">\r\n                                    Cancelar\r\n                                </Button>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\gapo\\GAPOAnalyticsPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'LineChart' is defined but never used.","line":3,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Scatter' is defined but never used.","line":4,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":59},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Users' is defined but never used.","line":10,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Target' is defined but never used.","line":10,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'LineChartIcon' is defined but never used.","line":10,"column":97,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":110},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'physicalProgressData' is assigned a value but never used.","line":21,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'hhEfficiency' is assigned a value but never used.","line":21,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":47}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport {\r\n    LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer,\r\n    BarChart, Bar, AreaChart, Area, ComposedChart, Scatter, PieChart, Pie, Cell\r\n} from 'recharts';\r\nimport { useGAPOAnalytics } from '@/hooks/useGAPOAnalytics';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from \"@/components/ui/tabs\";\r\nimport { TrendingUp, Users, Target, Activity, PieChart as PieChartIcon, BarChart3, LineChart as LineChartIcon, Download } from 'lucide-react';\r\n\r\nimport { WorkStage } from '@/hooks/useWorkStages';\r\nimport { TimeRecord } from '@/hooks/useTimeRecords';\r\n\r\ninterface GAPOAnalyticsPanelProps {\r\n    stages: WorkStage[];\r\n    records: TimeRecord[];\r\n}\r\n\r\nexport default function GAPOAnalyticsPanel({ stages, records }: GAPOAnalyticsPanelProps) {\r\n    const { physicalProgressData, hhEfficiency, sCurveData } = useGAPOAnalytics(stages, records);\r\n\r\n    const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042'];\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-fade-in\">\r\n            <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n                <div>\r\n                    <h2 className=\"text-2xl font-black tracking-tight\">Performance e Analytics</h2>\r\n                    <p className=\"text-muted-foreground text-sm\">Visão consolidada dos indicadores chave de performance (KPIs).</p>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                    <Button variant=\"outline\" size=\"sm\" className=\"gap-2 text-xs font-bold uppercase tracking-wider\">\r\n                        <Download className=\"w-4 h-4\" /> Exportar Relatório\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            <Tabs defaultValue=\"overview\" className=\"w-full\">\r\n                <TabsList className=\"bg-black/20 p-1 mb-6 border border-white/5 rounded-lg\">\r\n                    <TabsTrigger value=\"overview\" className=\"gap-2 px-6\">\r\n                        <TrendingUp className=\"w-4 h-4\" /> Visão Geral\r\n                    </TabsTrigger>\r\n                    <TabsTrigger value=\"productivity\" className=\"gap-2 px-6\">\r\n                        <BarChart3 className=\"w-4 h-4\" /> Produtividade\r\n                    </TabsTrigger>\r\n                    <TabsTrigger value=\"financial\" className=\"gap-2 px-6\">\r\n                        <PieChartIcon className=\"w-4 h-4\" /> Custos & Riscos\r\n                    </TabsTrigger>\r\n                </TabsList>\r\n\r\n                <TabsContent value=\"overview\" className=\"space-y-6\">\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                        <Card className=\"glass-card bg-primary/5 border-primary/20\">\r\n                            <CardHeader className=\"py-4\">\r\n                                <CardTitle className=\"text-xs font-bold uppercase tracking-widest opacity-80 text-primary\">HH Projetado vs Real</CardTitle>\r\n                            </CardHeader>\r\n                            <CardContent>\r\n                                <div className=\"text-3xl font-black text-foreground\">2.450 <span className=\"text-sm font-medium text-muted-foreground\">hrs</span></div>\r\n                                <div className=\"w-full bg-black/40 h-1.5 mt-2 rounded-full overflow-hidden\">\r\n                                    <div className=\"h-full bg-primary w-[65%]\" />\r\n                                </div>\r\n                                <p className=\"text-[10px] text-muted-foreground mt-2 tracking-tight\">65% do total estimado consumido.</p>\r\n                            </CardContent>\r\n                        </Card>\r\n                        <Card className=\"glass-card bg-emerald-500/5 border-emerald-500/20\">\r\n                            <CardHeader className=\"py-4\">\r\n                                <CardTitle className=\"text-xs font-bold uppercase tracking-widest opacity-80 text-emerald-500\">SPI (Índice de Prazo)</CardTitle>\r\n                            </CardHeader>\r\n                            <CardContent>\r\n                                <div className=\"text-3xl font-black text-foreground\">0.98</div>\r\n                                <p className=\"text-[10px] text-emerald-500/80 mt-1 font-bold\">Ligeiro atraso (Ideal: 1.0)</p>\r\n                            </CardContent>\r\n                        </Card>\r\n                        <Card className=\"glass-card bg-blue-500/5 border-blue-500/20\">\r\n                            <CardHeader className=\"py-4\">\r\n                                <CardTitle className=\"text-xs font-bold uppercase tracking-widest opacity-80 text-blue-500\">CPI (Índice de Custo)</CardTitle>\r\n                            </CardHeader>\r\n                            <CardContent>\r\n                                <div className=\"text-3xl font-black text-foreground\">1.12</div>\r\n                                <p className=\"text-[10px] text-blue-500/80 mt-1 font-bold\">Abaixo do orçamento (Eficiente)</p>\r\n                            </CardContent>\r\n                        </Card>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                        <Card className=\"glass-card\">\r\n                            <CardHeader>\r\n                                <CardTitle className=\"flex items-center gap-2 text-lg\">\r\n                                    <TrendingUp className=\"w-5 h-5 text-primary\" />\r\n                                    Curva S – Avanço Físico\r\n                                </CardTitle>\r\n                                <CardDescription>Comparativo acumulado: Planejado vs Realizado</CardDescription>\r\n                            </CardHeader>\r\n                            <CardContent className=\"h-[350px]\">\r\n                                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                    <AreaChart data={sCurveData} margin={{ top: 10, right: 30, left: 0, bottom: 0 }}>\r\n                                        <defs>\r\n                                            <linearGradient id=\"colorPlanned\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                                <stop offset=\"5%\" stopColor=\"#3b82f6\" stopOpacity={0.3} />\r\n                                                <stop offset=\"95%\" stopColor=\"#3b82f6\" stopOpacity={0} />\r\n                                            </linearGradient>\r\n                                            <linearGradient id=\"colorActual\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                                <stop offset=\"5%\" stopColor=\"#10b981\" stopOpacity={0.3} />\r\n                                                <stop offset=\"95%\" stopColor=\"#10b981\" stopOpacity={0} />\r\n                                            </linearGradient>\r\n                                        </defs>\r\n                                        <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#333\" vertical={false} />\r\n                                        <XAxis dataKey=\"month\" stroke=\"#666\" fontSize={10} tickLine={false} axisLine={false} />\r\n                                        <YAxis stroke=\"#666\" fontSize={10} tickLine={false} axisLine={false} tickFormatter={(val) => `${val}%`} />\r\n                                        <Tooltip\r\n                                            contentStyle={{ backgroundColor: '#09090b', border: '1px solid #333', borderRadius: '8px', fontSize: '12px' }}\r\n                                            itemStyle={{ color: '#fff' }}\r\n                                        />\r\n                                        <Legend verticalAlign=\"top\" height={36} iconType=\"circle\" />\r\n                                        <Area type=\"monotone\" dataKey=\"planned\" name=\"Planejado Acumulado\" stroke=\"#3b82f6\" strokeWidth={3} fillOpacity={1} fill=\"url(#colorPlanned)\" />\r\n                                        <Area type=\"monotone\" dataKey=\"actual\" name=\"Realizado Acumulado\" stroke=\"#10b981\" strokeWidth={3} fillOpacity={1} fill=\"url(#colorActual)\" />\r\n                                    </AreaChart>\r\n                                </ResponsiveContainer>\r\n                            </CardContent>\r\n                        </Card>\r\n\r\n                        <Card className=\"glass-card\">\r\n                            <CardHeader>\r\n                                <CardTitle className=\"flex items-center gap-2 text-lg\">\r\n                                    <Activity className=\"w-5 h-5 text-amber-500\" />\r\n                                    Desempenho Quinzenal\r\n                                </CardTitle>\r\n                                <CardDescription>Avanço percentual por período</CardDescription>\r\n                            </CardHeader>\r\n                            <CardContent className=\"h-[350px]\">\r\n                                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                    <ComposedChart data={sCurveData} margin={{ top: 10, right: 30, left: 0, bottom: 0 }}>\r\n                                        <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#333\" vertical={false} />\r\n                                        <XAxis dataKey=\"month\" stroke=\"#666\" fontSize={10} tickLine={false} axisLine={false} />\r\n                                        <YAxis stroke=\"#666\" fontSize={10} tickLine={false} axisLine={false} />\r\n                                        <Tooltip\r\n                                            contentStyle={{ backgroundColor: '#09090b', border: '1px solid #333', borderRadius: '8px' }}\r\n                                            cursor={{ fill: 'rgba(255,255,255,0.05)' }}\r\n                                        />\r\n                                        <Bar dataKey=\"actual\" name=\"Realizado no Mês\" barSize={20} fill=\"#f59e0b\" radius={[4, 4, 0, 0]} />\r\n                                        <Line type=\"monotone\" dataKey=\"planned\" name=\"Meta do Mês\" stroke=\"#ef4444\" strokeWidth={2} dot={{ r: 4 }} />\r\n                                    </ComposedChart>\r\n                                </ResponsiveContainer>\r\n                            </CardContent>\r\n                        </Card>\r\n                    </div>\r\n                </TabsContent>\r\n\r\n                <TabsContent value=\"productivity\">\r\n                    <div className=\"grid grid-cols-1 gap-6\">\r\n                        <Card className=\"glass-card\">\r\n                            <CardHeader>\r\n                                <CardTitle>Eficiência Operacional por Setor</CardTitle>\r\n                                <CardDescription>Análise de produtividade baseada em tarefas concluídas vs equipes alocadas.</CardDescription>\r\n                            </CardHeader>\r\n                            <CardContent className=\"h-[400px] flex items-center justify-center text-muted-foreground\">\r\n                                {/* Placeholder for complex bar chart */}\r\n                                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                    <BarChart\r\n                                        data={[\r\n                                            { name: 'Fundação', meta: 100, real: 120 },\r\n                                            { name: 'Montagem', meta: 100, real: 85 },\r\n                                            { name: 'Eletromecânica', meta: 100, real: 90 },\r\n                                            { name: 'Lançamento', meta: 100, real: 100 },\r\n                                            { name: 'Comissionamento', meta: 100, real: 60 },\r\n                                        ]}\r\n                                        layout=\"vertical\"\r\n                                        margin={{ top: 20, right: 30, left: 40, bottom: 5 }}\r\n                                    >\r\n                                        <CartesianGrid strokeDasharray=\"3 3\" horizontal={false} stroke=\"#333\" />\r\n                                        <XAxis type=\"number\" stroke=\"#666\" fontSize={10} />\r\n                                        <YAxis dataKey=\"name\" type=\"category\" stroke=\"#fff\" fontSize={12} width={100} />\r\n                                        <Tooltip contentStyle={{ backgroundColor: '#000', border: '1px solid #333' }} />\r\n                                        <Legend />\r\n                                        <Bar dataKey=\"meta\" name=\"Meta Produtividade\" fill=\"#3b82f6\" barSize={15} radius={[0, 4, 4, 0]} />\r\n                                        <Bar dataKey=\"real\" name=\"Produtividade Real\" fill=\"#10b981\" barSize={15} radius={[0, 4, 4, 0]} />\r\n                                    </BarChart>\r\n                                </ResponsiveContainer>\r\n                            </CardContent>\r\n                        </Card>\r\n                    </div>\r\n                </TabsContent>\r\n\r\n                <TabsContent value=\"financial\">\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                        <Card className=\"glass-card\">\r\n                            <CardHeader>\r\n                                <CardTitle>Distribuição de Custos</CardTitle>\r\n                            </CardHeader>\r\n                            <CardContent className=\"h-[300px]\">\r\n                                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                    <PieChart>\r\n                                        <Pie\r\n                                            data={[\r\n                                                { name: 'Mão de Obra', value: 400 },\r\n                                                { name: 'Materiais', value: 300 },\r\n                                                { name: 'Equipamentos', value: 300 },\r\n                                                { name: 'Indiretos', value: 200 },\r\n                                            ]}\r\n                                            cx=\"50%\"\r\n                                            cy=\"50%\"\r\n                                            innerRadius={60}\r\n                                            outerRadius={80}\r\n                                            fill=\"#8884d8\"\r\n                                            paddingAngle={5}\r\n                                            dataKey=\"value\"\r\n                                        >\r\n                                            {COLORS.map((entry, index) => (\r\n                                                <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\r\n                                            ))}\r\n                                        </Pie>\r\n                                        <Tooltip contentStyle={{ backgroundColor: '#000', border: '1px solid #333' }} />\r\n                                        <Legend />\r\n                                    </PieChart>\r\n                                </ResponsiveContainer>\r\n                            </CardContent>\r\n                        </Card>\r\n                        <Card className=\"glass-card\">\r\n                            <CardHeader>\r\n                                <CardTitle>Análise de Riscos</CardTitle>\r\n                            </CardHeader>\r\n                            <CardContent className=\"h-[300px] flex items-center justify-center\">\r\n                                <p className=\"text-muted-foreground italic\">Selecione um período para ver a matriz de riscos atualizada.</p>\r\n                            </CardContent>\r\n                        </Card>\r\n                    </div>\r\n                </TabsContent>\r\n\r\n            </Tabs>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\gapo\\GAPOAuditDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Calendar' is defined but never used.","line":6,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ptBR' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'siteId' is defined but never used.","line":15,"column":57,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":63},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has an unnecessary dependency: 'projectId'. Either exclude it or remove the dependency array.","line":31,"column":8,"nodeType":"ArrayExpression","endLine":31,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [logs]","fix":{"range":[1574,1591],"text":"[logs]"}}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\r\nimport { useAuditLogs } from '@/hooks/useAuditLogs';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Activity, User, Calendar, Database } from 'lucide-react';\r\nimport { format } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\n\r\ninterface GAPOAuditDashboardProps {\r\n    projectId?: string;\r\n    siteId?: string;\r\n}\r\n\r\nexport default function GAPOAuditDashboard({ projectId, siteId }: GAPOAuditDashboardProps) {\r\n    const { data: logs = [], isLoading } = useAuditLogs();\r\n\r\n    // Filter logs for operational tables only and by project/site context\r\n    const operationalLogs = useMemo(() => {\r\n        const opTables = ['work_stages', 'stage_progress', 'construction_documents', 'teams', 'sites', 'projects'];\r\n\r\n        return logs.filter(log => {\r\n            const isOp = opTables.includes(log.table_name);\r\n            // If we had project_id/site_id directly in audit_logs, we'd filter here.\r\n            // For now, we assume the backend filters globally or we rely on 'details' having IDs if needed.\r\n            // Since backend strictly enforces multitenancy now, this is safer.\r\n            // However, for extra client-side filtering if metadata implies project:\r\n            // const matchesProject = !projectId || log.metadata?.projectId === projectId;\r\n            return isOp;\r\n        }).slice(0, 50);\r\n    }, [logs, projectId]);\r\n\r\n    const getActionStyle = (action: string) => {\r\n        switch (action) {\r\n            case 'INSERT': return 'bg-green-500/10 text-green-500 border-green-500/20';\r\n            case 'UPDATE': return 'bg-amber-500/10 text-amber-500 border-amber-500/20';\r\n            case 'DELETE': return 'bg-red-500/10 text-red-500 border-red-500/20';\r\n            default: return 'bg-blue-500/10 text-blue-500 border-blue-500/20';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Card className=\"glass-card\">\r\n            <CardHeader className=\"border-b border-white/5\">\r\n                <CardTitle className=\"flex items-center gap-2\">\r\n                    <Activity className=\"w-5 h-5 text-primary\" />\r\n                    Trilha de Auditoria Operacional\r\n                </CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"p-0\">\r\n                <Table>\r\n                    <TableHeader>\r\n                        <TableRow className=\"hover:bg-transparent border-white/5 bg-white/2\">\r\n                            <TableHead className=\"font-bold text-[10px] uppercase tracking-widest pl-6\">Evento</TableHead>\r\n                            <TableHead className=\"font-bold text-[10px] uppercase tracking-widest\">Responsável</TableHead>\r\n                            <TableHead className=\"font-bold text-[10px] uppercase tracking-widest\">Módulo</TableHead>\r\n                            <TableHead className=\"font-bold text-[10px] uppercase tracking-widest\">Ação</TableHead>\r\n                            <TableHead className=\"font-bold text-[10px] uppercase tracking-widest pr-6\">Data</TableHead>\r\n                        </TableRow>\r\n                    </TableHeader>\r\n                    <TableBody>\r\n                        {isLoading ? (\r\n                            <TableRow>\r\n                                <TableCell colSpan={5} className=\"text-center py-10\">Processando trilhas...</TableCell>\r\n                            </TableRow>\r\n                        ) : operationalLogs.length === 0 ? (\r\n                            <TableRow>\r\n                                <TableCell colSpan={5} className=\"text-center py-10 italic text-muted-foreground\">Nenhum evento operacional registrado.</TableCell>\r\n                            </TableRow>\r\n                        ) : (\r\n                            operationalLogs.map((log) => (\r\n                                <TableRow key={log.id} className=\"hover:bg-white/2 border-white/5 transition-colors\">\r\n                                    <TableCell className=\"pl-6 py-4\">\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <Database className=\"w-3 h-3 text-muted-foreground\" />\r\n                                            <span className=\"text-sm font-bold\">ID: {log.record_id.substring(0, 8)}...</span>\r\n                                        </div>\r\n                                    </TableCell>\r\n                                    <TableCell>\r\n                                        <div className=\"flex items-center gap-2 text-xs font-medium\">\r\n                                            <User className=\"w-3 h-3 text-primary\" />\r\n                                            {log.performer_name}\r\n                                        </div>\r\n                                    </TableCell>\r\n                                    <TableCell>\r\n                                        <Badge variant=\"outline\" className=\"text-[9px] uppercase font-black bg-white/5\">\r\n                                            {log.table_name}\r\n                                        </Badge>\r\n                                    </TableCell>\r\n                                    <TableCell>\r\n                                        <Badge className={getActionStyle(log.action) + \" text-[9px] font-black uppercase\"}>\r\n                                            {log.action}\r\n                                        </Badge>\r\n                                    </TableCell>\r\n                                    <TableCell className=\"text-right pr-6 whitespace-nowrap\">\r\n                                        <div className=\"flex flex-col text-[10px] font-bold\">\r\n                                            <span>{format(new Date(log.performed_at), 'dd/MM/yyyy')}</span>\r\n                                            <span className=\"opacity-50\">{format(new Date(log.performed_at), 'HH:mm:ss')}</span>\r\n                                        </div>\r\n                                    </TableCell>\r\n                                </TableRow>\r\n                            ))\r\n                        )}\r\n                    </TableBody>\r\n                </Table>\r\n            </CardContent>\r\n        </Card>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\gapo\\GAPODocumentHub.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Activity' is defined but never used.","line":8,"column":68,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":76},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'DocumentApprovalModal' is defined but never used.","line":15,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleRefresh' is assigned a value but never used.","line":62,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":231,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":231,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9555,9558],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9555,9558],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":239,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":239,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9817,9820],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9817,9820],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":270,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":270,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10936,10939],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10936,10939],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":343,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":343,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14303,14306],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14303,14306],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'treeData' is assigned a value but never used.","line":392,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":392,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleFileSelect' is assigned a value but never used.","line":394,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":394,"endColumn":27}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { useConstructionDocuments } from '@/hooks/useConstructionDocuments';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Input } from '@/components/ui/input';\r\nimport { FileText, Upload, Filter, Download, History, ShieldCheck, Activity, Archive, Edit2, Trash2, Eye } from 'lucide-react';\r\nimport { format } from 'date-fns';\r\nimport { DocumentSidebar, type FileNode } from './file-explorer/document-sidebar';\r\n\r\nimport { toast } from 'sonner';\r\nimport { useDownloadQueue } from '@/hooks/useDownloadQueue';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { DocumentApprovalModal } from '@/components/gapo/document-approval-modal';\r\nimport { isGestaoGlobal, isCorporateRole } from '@/utils/permissionHelpers';\r\n\r\ninterface GAPODocumentHubProps {\r\n    projectId?: string;\r\n    siteId?: string;\r\n}\r\n\r\nexport default function GAPODocumentHub({ projectId, siteId }: GAPODocumentHubProps) {\r\n    const { documents, isLoading, uploadDocument, updateDocument, downloadDocument, previewDocument, createFolder, deleteDocument, refresh } = useConstructionDocuments(projectId, siteId);\r\n\r\n    // Download Queue\r\n    const { addToQueue, isProcessing, currentDownload, queueLength } = useDownloadQueue(downloadDocument);\r\n    const { profile } = useAuth();\r\n    const isAdmin = isGestaoGlobal(profile) || isCorporateRole(profile?.role);\r\n\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [selectedFile, setSelectedFile] = useState<FileNode | null>(null);\r\n    const [selectedDocIds, setSelectedDocIds] = useState<string[]>([]);\r\n    const [lastSelectedId, setLastSelectedId] = useState<string | null>(null);\r\n    const fileInputRef = React.useRef<HTMLInputElement>(null);\r\n\r\n    const handleNewFile = () => {\r\n        fileInputRef.current?.click();\r\n    };\r\n\r\n    const handleFileChange = async (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = event.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        toast.promise(uploadDocument(file, { projectId, siteId }), {\r\n            loading: 'Enviando documento...',\r\n            success: 'Documento enviado com sucesso!',\r\n            error: 'Erro ao enviar documento'\r\n        });\r\n\r\n        // Reset input\r\n        if (fileInputRef.current) fileInputRef.current.value = '';\r\n    };\r\n\r\n    const handleNewFolder = async () => {\r\n        const folderName = window.prompt(\"Digite o nome da nova pasta:\");\r\n        if (folderName) {\r\n            await createFolder(folderName, selectedFile?.type === 'folder' ? `${selectedFile.id}/` : '/');\r\n        }\r\n    };\r\n\r\n    const handleRefresh = async () => {\r\n        await refresh();\r\n        toast.success('Arquivos atualizados');\r\n    };\r\n\r\n    const MAX_EXPORT_FILES = 20;\r\n    const MAX_EXPORT_SIZE_MB = 100;\r\n\r\n    const handleExportAll = () => {\r\n        const filesToExport = documents.filter(d => d.fileUrl !== 'folder');\r\n\r\n        if (filesToExport.length === 0) {\r\n            toast.error(\"Nenhum documento para exportar.\");\r\n            return;\r\n        }\r\n\r\n        if (filesToExport.length > MAX_EXPORT_FILES) {\r\n            toast.error(`Limite de exportação excedido. Máximo ${MAX_EXPORT_FILES} arquivos por vez (atual: ${filesToExport.length}).`);\r\n            return;\r\n        }\r\n\r\n        const totalSize = filesToExport.reduce((acc, doc) => acc + (doc.fileSize || 0), 0);\r\n        const totalSizeMB = (totalSize / (1024 * 1024)).toFixed(2);\r\n\r\n        if (parseFloat(totalSizeMB) > MAX_EXPORT_SIZE_MB) {\r\n            toast.error(`O tamanho total (${totalSizeMB}MB) excede o limite de ${MAX_EXPORT_SIZE_MB}MB.`);\r\n            return;\r\n        }\r\n\r\n        toast.success(`Exportando ${filesToExport.length} arquivos (${totalSizeMB}MB)...`);\r\n        filesToExport.forEach(doc => downloadDocument(doc));\r\n    };\r\n\r\n    const handleArchive = (docId: string) => {\r\n        toast.promise(updateDocument(docId, { status: 'archived' }), {\r\n            loading: 'Arquivando...',\r\n            success: 'Documento arquivado',\r\n            error: 'Erro ao arquivar'\r\n        });\r\n    };\r\n\r\n    const handleValidate = (docId: string) => {\r\n        toast.promise(updateDocument(docId, { status: 'valid' }), {\r\n            loading: 'Validando...',\r\n            success: 'Documento validado',\r\n            error: 'Erro ao validar'\r\n        });\r\n    };\r\n\r\n    const handleSidebarAction = (action: string, node: FileNode) => {\r\n        const doc = documents.find(d => d.id === node.id);\r\n\r\n        if (action === \"Abrir\") {\r\n            if (node.type === 'file') {\r\n                setSelectedFile(node);\r\n                if (doc) previewDocument(doc);\r\n            } else {\r\n                setSelectedFile(node);\r\n                toast.info(`Pasta \"${node.name}\" selecionada`);\r\n            }\r\n        } else if (action === \"Visualizar\") {\r\n            if (doc) previewDocument(doc);\r\n        } else if (action === \"Renomear\") {\r\n            if (doc) {\r\n                const newName = window.prompt(\"Novo nome:\", doc.name);\r\n                if (newName && newName !== doc.name) {\r\n                    toast.promise(updateDocument(doc.id, { name: newName }), {\r\n                        loading: 'Atualizando...',\r\n                        success: 'Renomeado com sucesso!',\r\n                        error: 'Erro ao renomear'\r\n                    });\r\n                }\r\n            }\r\n        } else if (action === \"Informações\") {\r\n            if (doc) {\r\n                const info = `\r\nNome: ${doc.name}\r\nTipo: ${doc.docType}\r\nVersão: v${doc.version}\r\nStatus: ${doc.status}\r\nCaminho: ${doc.folderPath}\r\nModificado: ${format(new Date(doc.updatedAt), 'dd/MM/yyyy HH:mm')}\r\n                `;\r\n                window.alert(info);\r\n            } else {\r\n                toast.info(`Pasta: ${node.name}\\nID: ${node.id}`);\r\n            }\r\n        } else if (action === \"Excluir\") {\r\n            if (window.confirm(`Tem certeza que deseja excluir \"${node.name}\"?`)) {\r\n                handleDelete(node.id, doc?.fileUrl);\r\n            }\r\n        } else if (action === \"Nova Pasta\") {\r\n            handleNewFolder();\r\n        } else if (action === \"Novo Arquivo\") {\r\n            handleNewFile();\r\n        } else if (action === \"Nova Pasta Inteligente\") {\r\n            handleSmartFolder(node.id, node.name);\r\n        } else if (action === \"Marcar como Importante\") {\r\n            if (doc) {\r\n                toast.promise(updateDocument(doc.id, { metadata: { ...doc.metadata, priority: 'high' } }), {\r\n                    loading: 'Marcando...',\r\n                    success: 'Marcado como Importante',\r\n                    error: 'Erro ao marcar'\r\n                });\r\n            }\r\n        } else if (action === \"Mover para Raiz\") {\r\n            handleMove(node.id, \"root\");\r\n        }\r\n    };\r\n\r\n    const handleSmartFolder = async (parentId: string, templateType: string = 'Obra') => {\r\n        const templates: Record<string, string[]> = {\r\n            'template-obra': ['01. Projetos', '02. Diários de Obra', '03. Fotos', '04. Relatórios'],\r\n            'template-financeiro': ['01. Notas Fiscais', '02. Contratos', '03. Comprovantes'],\r\n            'template-seguranca': ['01. EPIs', '02. NR-18', '03. Treinamentos'],\r\n            'Obra': ['Projetos', 'Fotos', 'Relatórios'] // Default for context menu on folder\r\n        };\r\n\r\n        const folders = templates[parentId] || templates[templateType] || templates['Obra'];\r\n        const path = parentId.startsWith('template-') ? '/' : `/${parentId}/`;\r\n\r\n        toast.loading(\"Criando estrutura inteligente...\");\r\n        for (const name of folders) {\r\n            await createFolder(name, path);\r\n        }\r\n        toast.dismiss();\r\n        toast.success(\"Estrutura criada com sucesso!\");\r\n    };\r\n\r\n    const handleDelete = async (id: string, storagePath?: string) => {\r\n        await deleteDocument(id, storagePath);\r\n    };\r\n\r\n    const handleMove = async (sourceId: string, targetId: string) => {\r\n        const sourceDoc = documents.find(d => d.id === sourceId);\r\n        if (!sourceDoc) return;\r\n\r\n        // Path is simply the ID of the folder for now (as used in tree logic)\r\n        const newPath = targetId === 'root' || !targetId ? '/' : `/${targetId}/`;\r\n\r\n        toast.promise(updateDocument(sourceId, { folderPath: newPath }), {\r\n            loading: 'Movendo...',\r\n            success: 'Movido com sucesso!',\r\n            error: 'Erro ao mover'\r\n        });\r\n    };\r\n\r\n    const handleBulkDownload = () => {\r\n        const selectedDocs = documents.filter(d => selectedDocIds.includes(d.id) && d.fileUrl !== 'folder');\r\n\r\n        if (selectedDocs.length === 0) return;\r\n\r\n        if (selectedDocs.length > MAX_EXPORT_FILES) {\r\n            toast.error(`Limite de download excedido. Selecione no máximo ${MAX_EXPORT_FILES} arquivos.`);\r\n            return;\r\n        }\r\n\r\n        const totalSize = selectedDocs.reduce((acc, doc) => acc + (doc.fileSize || 0), 0);\r\n        const totalSizeMB = (totalSize / (1024 * 1024)).toFixed(2);\r\n\r\n        if (parseFloat(totalSizeMB) > MAX_EXPORT_SIZE_MB) {\r\n            toast.error(`O tamanho total (${totalSizeMB}MB) excede o limite de ${MAX_EXPORT_SIZE_MB}MB.`);\r\n            return;\r\n        }\r\n\r\n        // Use Queue System\r\n        addToQueue(selectedDocs);\r\n    };\r\n\r\n    const handleApprove = async (doc: any) => {\r\n        toast.promise(updateDocument(doc.id, { status: 'valid' }), {\r\n            loading: 'Aprovando...',\r\n            success: 'Documento aprovado!',\r\n            error: 'Erro ao aprovar'\r\n        });\r\n    };\r\n\r\n    const handleReject = async (doc: any) => {\r\n        toast.promise(updateDocument(doc.id, { status: 'rejected' }), {\r\n            loading: 'Rejeitando...',\r\n            success: 'Documento rejeitado!',\r\n            error: 'Erro ao rejeitar'\r\n        });\r\n    };\r\n\r\n    const handleBulkArchive = async () => {\r\n        toast.loading(`Arquivando ${selectedDocIds.length} itens...`);\r\n        for (const id of selectedDocIds) {\r\n            await updateDocument(id, { status: 'archived' });\r\n        }\r\n        setSelectedDocIds([]);\r\n        toast.dismiss();\r\n        toast.success(\"Itens arquivados com sucesso\");\r\n    };\r\n\r\n    const handleBulkDelete = async () => {\r\n        if (!window.confirm(`Excluir permanentemente ${selectedDocIds.length} itens?`)) return;\r\n\r\n        toast.loading(`Excluindo ${selectedDocIds.length} itens...`);\r\n        for (const id of selectedDocIds) {\r\n            const doc = documents.find(d => d.id === id);\r\n            await deleteDocument(id, doc?.fileUrl);\r\n        }\r\n        setSelectedDocIds([]);\r\n        toast.dismiss();\r\n        toast.success(\"Itens excluídos\");\r\n    };\r\n\r\n    const handleRename = async (doc: any) => {\r\n        const newName = window.prompt(\"Digite o novo nome do documento:\", doc.name);\r\n        if (newName && newName !== doc.name) {\r\n            toast.promise(updateDocument(doc.id, { name: newName }), {\r\n                loading: 'Renomeando...',\r\n                success: 'Renomeado com sucesso!',\r\n                error: 'Erro ao renomear'\r\n            });\r\n        }\r\n    };\r\n\r\n    const filteredDocs = documents.filter(doc => {\r\n        // Ignorar registros que representam pastas na listagem da tabela\r\n        if (doc.fileUrl === 'folder') return false;\r\n\r\n        const matchesSearch = doc.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            doc.docType.toLowerCase().includes(searchTerm.toLowerCase());\r\n\r\n        // Filtragem por seleção na Sidebar\r\n        if (selectedFile) {\r\n            if (selectedFile.type === 'folder') {\r\n                // Mostrar arquivos que estão dentro desta pasta\r\n                return matchesSearch && doc.folderPath.includes(selectedFile.id);\r\n            } else {\r\n                // Mostrar apenas o arquivo selecionado\r\n                return doc.id === selectedFile.id;\r\n            }\r\n        }\r\n\r\n        return matchesSearch;\r\n    });\r\n\r\n    const handleRowClick = (e: React.MouseEvent, docId: string) => {\r\n        // Ignorar se o clique foi em botões de ação\r\n        if ((e.target as HTMLElement).closest('button')) return;\r\n\r\n        if (e.ctrlKey || e.metaKey) {\r\n            // CTRL + Click: Adiciona/Remove individualmente\r\n            setSelectedDocIds(prev =>\r\n                prev.includes(docId) ? prev.filter(id => id !== docId) : [...prev, docId]\r\n            );\r\n            setLastSelectedId(docId);\r\n        } else if (e.shiftKey && lastSelectedId) {\r\n            // SHIFT + Click: Seleção em range\r\n            const docList = filteredDocs.filter(d => d.fileUrl !== 'folder');\r\n            const currentIndex = docList.findIndex(d => d.id === docId);\r\n            const lastIndex = docList.findIndex(d => d.id === lastSelectedId);\r\n\r\n            if (currentIndex !== -1 && lastIndex !== -1) {\r\n                const start = Math.min(currentIndex, lastIndex);\r\n                const end = Math.max(currentIndex, lastIndex);\r\n                const rangeIds = docList.slice(start, end + 1).map(d => d.id);\r\n                setSelectedDocIds(prev => Array.from(new Set([...prev, ...rangeIds])));\r\n            }\r\n        } else {\r\n            // Click Normal: Seleciona apenas um\r\n            setSelectedDocIds([docId]);\r\n            setLastSelectedId(docId);\r\n        }\r\n    };\r\n\r\n    const getStatusColor = (status: string) => {\r\n        switch (status) {\r\n            case 'valid': return 'bg-emerald-500/10 text-emerald-500 border-emerald-500/20';\r\n            case 'expired': return 'bg-red-500/10 text-red-500 border-red-500/20';\r\n            case 'archived': return 'bg-slate-500/10 text-slate-500 border-slate-500/20';\r\n            case 'superseded': return 'bg-amber-500/10 text-amber-500 border-amber-500/20';\r\n            case 'pending': return 'bg-yellow-500/10 text-yellow-500 border-yellow-500/20';\r\n            case 'rejected': return 'bg-gray-500/10 text-gray-500 border-gray-500/20 font-bold'; // GRAY BOLD as requested\r\n            default: return 'bg-blue-500/10 text-blue-500 border-blue-500/20';\r\n        }\r\n    };\r\n\r\n    const documentsToTree = (docs: any[]): FileNode[] => {\r\n        const tree: FileNode[] = [];\r\n        const foldersMap: Record<string, FileNode> = {};\r\n\r\n        // 1. Passar primeiro para mapear todas as pastas e ordenar\r\n        docs.filter(d => d.fileUrl === 'folder')\r\n            .sort((a, b) => a.name.localeCompare(b.name))\r\n            .forEach(d => {\r\n                foldersMap[d.id] = {\r\n                    id: d.id,\r\n                    name: d.name,\r\n                    type: 'folder',\r\n                    children: []\r\n                };\r\n            });\r\n\r\n        // 2. Segunda passagem para construir a hierarquia\r\n        docs.filter(d => d.fileUrl === 'folder').forEach(d => {\r\n            const node = foldersMap[d.id];\r\n            // Encontrar o ID da pasta pai no final do caminho (ex: \"/id-pai/\")\r\n            const parentId = d.folderPath.split('/').filter(Boolean).pop();\r\n\r\n            if (parentId && foldersMap[parentId]) {\r\n                foldersMap[parentId].children?.push(node);\r\n            } else {\r\n                tree.push(node);\r\n            }\r\n        });\r\n\r\n        // 3. Terceira passagem para adicionar os arquivos\r\n        docs.filter(d => d.fileUrl !== 'folder').forEach(d => {\r\n            const fileNode: FileNode = {\r\n                id: d.id,\r\n                name: d.name,\r\n                type: 'file',\r\n                extension: d.name.split('.').pop()\r\n            };\r\n\r\n            const parentId = d.folderPath.split('/').filter(Boolean).pop();\r\n            if (parentId && foldersMap[parentId]) {\r\n                foldersMap[parentId].children?.push(fileNode);\r\n            } else {\r\n                tree.push(fileNode);\r\n            }\r\n        });\r\n\r\n        return tree;\r\n    };\r\n\r\n    const treeData = documentsToTree(documents);\r\n\r\n    const handleFileSelect = (node: FileNode) => {\r\n        setSelectedFile(node);\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex gap-4 h-[calc(100vh-280px)] min-h-[500px]\">\r\n            <input\r\n                type=\"file\"\r\n                className=\"hidden\"\r\n                ref={fileInputRef}\r\n                onChange={handleFileChange}\r\n            />\r\n            {/* Sidebar - File Explorer */}\r\n            <div className=\"w-72 shrink-0 glass-card rounded-lg overflow-hidden border border-white/5 flex flex-col\">\r\n                {selectedFile && (\r\n                    <div className=\"p-2 border-b border-white/5 bg-primary/5\">\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            className=\"w-full text-[10px] h-7 uppercase font-bold gap-2\"\r\n                            onClick={() => setSelectedFile(null)}\r\n                        >\r\n                            <Filter className=\"w-3 h-3\" /> Limpar Seleção\r\n                        </Button>\r\n                    </div>\r\n                )}\r\n                <DocumentSidebar\r\n                    onFileSelect={(n) => setSelectedFile(n)}\r\n                    onNewFile={handleNewFile}\r\n                    onNewFolder={handleNewFolder}\r\n                    onRefresh={refresh}\r\n                    onAction={handleSidebarAction}\r\n                    onMove={handleMove}\r\n                    files={documentsToTree(documents)}\r\n                    // Props for Approval and Settings\r\n                    documents={documents}\r\n                    isAdmin={isAdmin}\r\n                    onApprove={handleApprove}\r\n                    onReject={handleReject}\r\n                />\r\n            </div>\r\n\r\n            <div className=\"flex-1 space-y-4 overflow-auto\">\r\n                {(isProcessing || queueLength > 0) && (\r\n                    <div className=\"flex items-center justify-between p-3 glass-card bg-emerald-500/10 rounded-lg border-emerald-500/20 animate-pulse\">\r\n                        <span className=\"text-sm font-bold uppercase text-emerald-400 flex items-center gap-2\">\r\n                            <Download className=\"size-4 animate-bounce\" />\r\n                            Baixando: {currentDownload || 'Preparando...'}\r\n                        </span>\r\n                        <Badge variant=\"outline\" className=\"text-emerald-400 border-emerald-400/30\">\r\n                            Fila: {queueLength}\r\n                        </Badge>\r\n                    </div>\r\n                )}\r\n\r\n                {selectedDocIds.length > 0 && (\r\n                    <div className=\"flex items-center justify-between p-3 glass-card border-primary/20 bg-primary/5 rounded-lg animate-in fade-in slide-in-from-top-2\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"size-8 rounded-full bg-primary/20 flex items-center justify-center text-xs font-bold text-primary\">\r\n                                {selectedDocIds.length}\r\n                            </div>\r\n                            <span className=\"text-sm font-bold uppercase tracking-wider\">Itens Selecionados</span>\r\n                        </div>\r\n                        <div className=\"flex gap-2\">\r\n                            <Button size=\"sm\" variant=\"ghost\" className=\"h-8 gap-2 hover:bg-emerald-500/20\" onClick={handleBulkDownload}>\r\n                                <Download className=\"w-4 h-4\" /> Baixar\r\n                            </Button>\r\n                            <Button size=\"sm\" variant=\"ghost\" className=\"h-8 gap-2 hover:bg-amber-500/20\" onClick={handleBulkArchive}>\r\n                                <Archive className=\"w-4 h-4\" /> Arquivar\r\n                            </Button>\r\n                            <Button size=\"sm\" variant=\"ghost\" className=\"h-8 gap-2 hover:bg-red-500/20 text-red-400\" onClick={handleBulkDelete}>\r\n                                <Trash2 className=\"w-4 h-4\" /> Excluir\r\n                            </Button>\r\n                            <div className=\"w-px h-8 bg-white/10 mx-1\" />\r\n                            <Button size=\"sm\" variant=\"ghost\" className=\"h-8 text-xs opacity-50 hover:opacity-100\" onClick={() => setSelectedDocIds([])}>\r\n                                Cancelar\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n                <div className=\"flex flex-col md:flex-row gap-4 justify-between\">\r\n                    <div className=\"relative flex-1\">\r\n                        <Filter className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\r\n                        <Input\r\n                            placeholder=\"Buscar documentos, contratos, projetos...\"\r\n                            className=\"industrial-input pl-10\"\r\n                            value={searchTerm}\r\n                            onChange={(e) => setSearchTerm(e.target.value)}\r\n                        />\r\n                    </div>\r\n                    <div className=\"flex gap-2\">\r\n                        <Button\r\n                            variant=\"outline\"\r\n                            className=\"glass-card border-white/5 font-bold gap-2 text-[10px] uppercase tracking-widest\"\r\n                            onClick={handleExportAll}\r\n                        >\r\n                            <Download className=\"w-4 h-4\" /> Exportar Tudo\r\n                        </Button>\r\n                        <Button\r\n                            className=\"gradient-primary font-bold gap-2\"\r\n                            onClick={handleNewFile}\r\n                        >\r\n                            <Upload className=\"w-4 h-4\" /> Novo Documento\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n\r\n                <Card className=\"glass-card\">\r\n                    <CardHeader>\r\n                        <CardTitle className=\"flex items-center gap-2\">\r\n                            <FileText className=\"w-5 h-5 text-primary\" />\r\n                            Repositório de Documentos\r\n                        </CardTitle>\r\n                        <CardDescription>Gestão versionada e segura de arquivos da obra.</CardDescription>\r\n                    </CardHeader>\r\n                    <CardContent className=\"p-0\">\r\n                        <Table>\r\n                            <TableHeader>\r\n                                <TableRow className=\"hover:bg-transparent border-white/5 bg-white/2\">\r\n                                    <TableHead className=\"font-bold text-[10px] uppercase tracking-widest pl-6\">Nome do Arquivo</TableHead>\r\n                                    <TableHead className=\"font-bold text-[10px] uppercase tracking-widest\">Tipo</TableHead>\r\n                                    <TableHead className=\"font-bold text-[10px] uppercase tracking-widest\">Versão</TableHead>\r\n                                    <TableHead className=\"font-bold text-[10px] uppercase tracking-widest\">Status</TableHead>\r\n                                    <TableHead className=\"font-bold text-[10px] uppercase tracking-widest\">Última Modificação</TableHead>\r\n                                    <TableHead className=\"text-right pr-6 font-bold text-[10px] uppercase tracking-widest\">Ações</TableHead>\r\n                                </TableRow>\r\n                            </TableHeader>\r\n                            <TableBody>\r\n                                {isLoading ? (\r\n                                    <TableRow>\r\n                                        <TableCell colSpan={6} className=\"text-center py-10\">Carregando documentos...</TableCell>\r\n                                    </TableRow>\r\n                                ) : filteredDocs.length === 0 ? (\r\n                                    <TableRow>\r\n                                        <TableCell colSpan={6} className=\"text-center py-10 italic text-muted-foreground\">Nenhum documento encontrado.</TableCell>\r\n                                    </TableRow>\r\n                                ) : (\r\n                                    filteredDocs.filter(d => d.fileUrl !== 'folder').map((doc) => (\r\n                                        <TableRow\r\n                                            key={doc.id}\r\n                                            className={`\r\n                                                cursor-pointer transition-colors group border-white/5\r\n                                                ${selectedDocIds.includes(doc.id) ? 'bg-primary/15 hover:bg-primary/20' : 'hover:bg-white/2'}\r\n                                            `}\r\n                                            onClick={(e) => handleRowClick(e, doc.id)}\r\n                                        >\r\n                                            <TableCell className=\"pl-6 py-4\">\r\n                                                <div className=\"flex items-center gap-3\">\r\n                                                    <div className=\"p-2 rounded-lg bg-primary/10\">\r\n                                                        <FileText className=\"w-4 h-4 text-primary\" />\r\n                                                    </div>\r\n                                                    <div className=\"flex flex-col\">\r\n                                                        <span className=\"font-bold text-sm\">{doc.name}</span>\r\n                                                        <span className=\"text-[10px] opacity-50 font-mono italic\">UUID: {doc.id.substring(0, 8)}</span>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </TableCell>\r\n                                            <TableCell>\r\n                                                <Badge variant=\"outline\" className=\"text-[10px] font-black uppercase tracking-tight\">\r\n                                                    {doc.docType}\r\n                                                </Badge>\r\n                                            </TableCell>\r\n                                            <TableCell>\r\n                                                <div className=\"flex items-center gap-1 font-bold text-xs\">\r\n                                                    <History className=\"w-3 h-3 text-muted-foreground\" />\r\n                                                    v{doc.version}\r\n                                                </div>\r\n                                            </TableCell>\r\n                                            <TableCell>\r\n                                                <Badge className={getStatusColor(doc.status) + \" text-[10px] font-black uppercase\"}>\r\n                                                    {doc.status}\r\n                                                </Badge>\r\n                                            </TableCell>\r\n                                            <TableCell className=\"text-xs font-medium\">\r\n                                                {format(new Date(doc.updatedAt), 'dd/MM/yyyy HH:mm')}\r\n                                            </TableCell>\r\n                                            <TableCell className=\"text-right pr-6\">\r\n                                                <div className=\"flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                                    <Button\r\n                                                        size=\"icon\"\r\n                                                        variant=\"ghost\"\r\n                                                        className=\"h-8 w-8 hover:bg-primary/20 hover:text-primary\"\r\n                                                        title=\"Visualizar\"\r\n                                                        onClick={() => previewDocument(doc)}\r\n                                                    >\r\n                                                        <Eye className=\"w-4 h-4\" />\r\n                                                    </Button>\r\n                                                    <Button\r\n                                                        size=\"icon\"\r\n                                                        variant=\"ghost\"\r\n                                                        className=\"h-8 w-8 hover:bg-emerald-500/20 hover:text-emerald-500\"\r\n                                                        title=\"Download\"\r\n                                                        onClick={() => downloadDocument(doc)}\r\n                                                    >\r\n                                                        <Download className=\"w-4 h-4\" />\r\n                                                    </Button>\r\n                                                    <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 hover:bg-amber-500/20 hover:text-amber-500\" title=\"Arquivar\" onClick={() => handleArchive(doc.id)}>\r\n                                                        <Archive className=\"w-4 h-4\" />\r\n                                                    </Button>\r\n                                                    <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 hover:bg-blue-500/20 hover:text-blue-500\" title=\"Renomear\" onClick={() => handleRename(doc)}>\r\n                                                        <Edit2 className=\"w-4 h-4\" />\r\n                                                    </Button>\r\n                                                    <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 hover:bg-primary/20 hover:text-primary\" title=\"Validar\" onClick={() => handleValidate(doc.id)}>\r\n                                                        <ShieldCheck className=\"w-4 h-4\" />\r\n                                                    </Button>\r\n                                                </div>\r\n                                            </TableCell>\r\n                                        </TableRow>\r\n                                    ))\r\n                                )}\r\n                            </TableBody>\r\n                        </Table>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\gapo\\GAPOProgressTracker.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Collapsible' is defined but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CollapsibleContent' is defined but never used.","line":11,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CollapsibleTrigger' is defined but never used.","line":11,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":61},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3762,3765],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3762,3765],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo } from 'react';\r\nimport { useWorkStages, WorkStage, CreateStageData } from '@/hooks/useWorkStages';\r\nimport { Card, CardContent } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Activity, Plus, Edit2, MoreVertical, Trash2, GripVertical, AlertTriangle, ChevronDown, ChevronRight, Zap, Combine, Loader2 } from 'lucide-react';\r\nimport StageFormModal from './StageFormModal';\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger, DropdownMenuSeparator } from '@/components/ui/dropdown-menu';\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\r\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\r\n\r\ninterface GAPOProgressTrackerProps {\r\n    siteId?: string;\r\n}\r\n\r\ninterface StageWithChildren extends WorkStage {\r\n    children: StageWithChildren[];\r\n}\r\n\r\nexport default function GAPOProgressTracker({ siteId }: GAPOProgressTrackerProps) {\r\n    const { stages, isLoading, createStage, updateStage, deleteStage, deleteAllStages, reorderStages, syncStages, refresh } = useWorkStages(siteId || 'all');\r\n    const [isModalOpen, setIsModalOpen] = useState(false);\r\n    const [editingStage, setEditingStage] = useState<WorkStage | null>(null);\r\n    const [parentIdForNew, setParentIdForNew] = useState<string | null>(null);\r\n    const [expandedStages, setExpandedStages] = useState<Set<string>>(new Set());\r\n    const [draggedId, setDraggedId] = useState<string | null>(null);\r\n    const [dragOverId, setDragOverId] = useState<string | null>(null);\r\n    const [isSyncing, setIsSyncing] = useState(false);\r\n\r\n    // Build hierarchy from flat list\r\n    const hierarchicalStages = useMemo(() => {\r\n        const stageMap = new Map<string, StageWithChildren>();\r\n        const rootStages: StageWithChildren[] = [];\r\n\r\n        // First pass: create all nodes\r\n        stages.forEach(stage => {\r\n            // Create a deep copy to avoid mutating the query cache, allowing us to update progress\r\n            stageMap.set(stage.id, { ...stage, children: [], progress: { ...stage.progress } } as StageWithChildren);\r\n        });\r\n\r\n        // Second pass: build hierarchy\r\n        stages.forEach(stage => {\r\n            const node = stageMap.get(stage.id)!;\r\n            if (stage.parentId && stageMap.has(stage.parentId)) {\r\n                stageMap.get(stage.parentId)!.children.push(node);\r\n            } else {\r\n                rootStages.push(node);\r\n            }\r\n        });\r\n\r\n        // Helper to calculate progress recursively\r\n        const calculateProgress = (node: StageWithChildren): number => {\r\n            if (node.children.length === 0) {\r\n                return node.progress?.actualPercentage || 0;\r\n            }\r\n\r\n            let totalWeight = 0;\r\n            let totalWeightedProgress = 0;\r\n\r\n            node.children.forEach(child => {\r\n                const childProgress = calculateProgress(child);\r\n                const weight = Number(child.weight) || 0;\r\n\r\n                totalWeight += weight;\r\n                totalWeightedProgress += childProgress * weight;\r\n            });\r\n\r\n            const aggregatedProgress = totalWeight > 0 ? totalWeightedProgress / totalWeight : 0;\r\n\r\n            // Update parent progress visually\r\n            node.progress = {\r\n                ...(node.progress || {}),\r\n                actualPercentage: aggregatedProgress,\r\n                // Optional: mark as aggregate\r\n            } as any;\r\n\r\n            return aggregatedProgress;\r\n        };\r\n\r\n        // Sort children by displayOrder and calculate progress\r\n        const sortAndCalc = (nodes: StageWithChildren[]) => {\r\n            nodes.sort((a, b) => a.displayOrder - b.displayOrder);\r\n            nodes.forEach(n => {\r\n                sortAndCalc(n.children);\r\n                // Calculate starts from leaves up, but recursion is natively supported.\r\n                // Actually, calculateProgress calls calculateProgress(child), so we just need to call it on roots AFTER structure is built.\r\n            });\r\n        };\r\n\r\n        sortAndCalc(rootStages);\r\n        rootStages.forEach(root => calculateProgress(root));\r\n\r\n        return rootStages;\r\n    }, [stages]);\r\n\r\n    const getStatusColor = (actual: number, planned: number) => {\r\n        if (actual >= planned) return 'text-emerald-500';\r\n        if (actual < planned * 0.8) return 'text-red-500';\r\n        return 'text-amber-500';\r\n    };\r\n\r\n    const handleCreate = (parentId: string | null = null) => {\r\n        setEditingStage(null);\r\n        setParentIdForNew(parentId);\r\n        setIsModalOpen(true);\r\n    };\r\n\r\n    const handleEdit = (stage: WorkStage) => {\r\n        setEditingStage(stage);\r\n        setParentIdForNew(null);\r\n        setIsModalOpen(true);\r\n    };\r\n\r\n    const handleSave = async (data: CreateStageData, silent = false) => {\r\n        if (editingStage) {\r\n            return updateStage(editingStage.id, data);\r\n        }\r\n        // Usa o parentId dos dados se fornecido (importante para importações), caso contrário usa o parentIdForNew do estado\r\n        return createStage({\r\n            ...data,\r\n            parentId: data.parentId || (parentIdForNew || undefined)\r\n        }, silent);\r\n    };\r\n\r\n    const handleSync = async () => {\r\n        setIsSyncing(true);\r\n        try {\r\n            await syncStages();\r\n        } finally {\r\n            setIsSyncing(false);\r\n        }\r\n    };\r\n\r\n    const handleDelete = async (stageId: string) => {\r\n        return deleteStage(stageId);\r\n    };\r\n\r\n    const handleDeleteAll = async () => {\r\n        return deleteAllStages();\r\n    };\r\n\r\n    const toggleExpanded = (stageId: string) => {\r\n        const newSet = new Set(expandedStages);\r\n        if (newSet.has(stageId)) {\r\n            newSet.delete(stageId);\r\n        } else {\r\n            newSet.add(stageId);\r\n        }\r\n        setExpandedStages(newSet);\r\n    };\r\n\r\n    // Drag handlers\r\n    const handleDragStart = (e: React.DragEvent, id: string) => {\r\n        setDraggedId(id);\r\n        e.dataTransfer.effectAllowed = 'move';\r\n        e.stopPropagation(); // Prevent parent drag start when dragging child\r\n    };\r\n\r\n    const handleDragOver = (e: React.DragEvent, id: string) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        setDragOverId(id);\r\n    };\r\n\r\n    const handleDrop = async (e: React.DragEvent, targetId: string) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        if (!draggedId || draggedId === targetId) {\r\n            setDraggedId(null);\r\n            setDragOverId(null);\r\n            return;\r\n        }\r\n\r\n        const draggedStage = stages.find(s => s.id === draggedId);\r\n        const targetStage = stages.find(s => s.id === targetId);\r\n\r\n        if (!draggedStage || !targetStage) return;\r\n\r\n        // Allow reordering only within the same level (same parent)\r\n        if (draggedStage.parentId !== targetStage.parentId) {\r\n            setDraggedId(null);\r\n            setDragOverId(null);\r\n            return;\r\n        }\r\n\r\n        // Get all siblings\r\n        const siblings = stages\r\n            .filter(s => s.parentId === draggedStage.parentId)\r\n            .sort((a, b) => a.displayOrder - b.displayOrder);\r\n\r\n        const draggedIndex = siblings.findIndex(s => s.id === draggedId);\r\n        const targetIndex = siblings.findIndex(s => s.id === targetId);\r\n\r\n        if (draggedIndex === -1 || targetIndex === -1) return;\r\n\r\n        const newSiblings = [...siblings];\r\n        const [removed] = newSiblings.splice(draggedIndex, 1);\r\n        newSiblings.splice(targetIndex, 0, removed);\r\n\r\n        // Update display order\r\n        const updates = newSiblings.map((s, index) => ({\r\n            ...s,\r\n            displayOrder: index\r\n        }));\r\n\r\n        setDraggedId(null);\r\n        setDragOverId(null);\r\n\r\n        await reorderStages(updates);\r\n    };\r\n\r\n    const handleDragEnd = () => {\r\n        setDraggedId(null);\r\n        setDragOverId(null);\r\n    };\r\n\r\n    const renderStage = (stage: StageWithChildren, index: number, depth: number = 0) => {\r\n        const hasChildren = stage.children.length > 0;\r\n        const isExpanded = expandedStages.has(stage.id);\r\n\r\n        return (\r\n            <div key={stage.id} className={depth > 0 ? 'ml-8 border-l-2 border-slate-800 pl-4' : ''}>\r\n                <Card\r\n                    draggable\r\n                    onDragStart={(e) => handleDragStart(e, stage.id)}\r\n                    onDragOver={(e) => handleDragOver(e, stage.id)}\r\n                    onDrop={(e) => handleDrop(e, stage.id)}\r\n                    onDragEnd={handleDragEnd}\r\n                    className={`glass-card overflow-hidden group transition-all mb-2 cursor-grab active:cursor-grabbing ${draggedId === stage.id ? 'opacity-50 scale-[0.98]' : ''\r\n                        } ${dragOverId === stage.id ? 'border-amber-500 bg-amber-500/5' : 'hover:border-primary/20'\r\n                        } ${depth > 0 ? 'bg-slate-900/30' : ''}`}\r\n                >\r\n                    <CardContent className=\"p-3\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"text-slate-600 hover:text-slate-400 cursor-grab active:cursor-grabbing\">\r\n                                <GripVertical className=\"h-4 w-4\" />\r\n                            </div>\r\n\r\n                            {/* Expand/Collapse for parents */}\r\n                            {hasChildren ? (\r\n                                <Button\r\n                                    variant=\"ghost\"\r\n                                    size=\"icon\"\r\n                                    className=\"h-6 w-6 p-0\"\r\n                                    onClick={() => toggleExpanded(stage.id)}\r\n                                >\r\n                                    {isExpanded ? (\r\n                                        <ChevronDown className=\"h-4 w-4 text-amber-500\" />\r\n                                    ) : (\r\n                                        <ChevronRight className=\"h-4 w-4 text-slate-500\" />\r\n                                    )}\r\n                                </Button>\r\n                            ) : (\r\n                                <div className=\"w-6\" />\r\n                            )}\r\n\r\n                            {/* Order/Depth indicator */}\r\n                            <div className={`w-7 h-7 rounded-full flex items-center justify-center font-bold text-xs ${depth === 0\r\n                                ? 'bg-amber-500/20 text-amber-500'\r\n                                : 'bg-slate-700/50 text-slate-400'\r\n                                }`}>\r\n                                {depth === 0 ? index + 1 : '↳'}\r\n                            </div>\r\n\r\n                            {/* Stage Info */}\r\n                            <div className=\"flex-1 min-w-0\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <h3 className={`font-bold truncate ${depth > 0 ? 'text-sm' : 'text-base'}`}>{stage.name}</h3>\r\n                                    {stage.productionActivityId && (\r\n                                        <Zap className=\"h-3.5 w-3.5 text-amber-500 fill-amber-500/20\" />\r\n                                    )}\r\n                                    <Badge variant=\"outline\" className=\"text-[10px] font-black tracking-widest bg-white/5 uppercase\">\r\n                                        Peso: {(stage.weight * 100).toFixed(0)}%\r\n                                    </Badge>\r\n                                    {hasChildren && (\r\n                                        <Badge variant=\"outline\" className=\"text-[10px] bg-sky-500/10 text-sky-500 border-sky-500/30 flex gap-1 items-center\">\r\n                                            <Combine className=\"h-2.5 w-2.5\" />\r\n                                            Consolidado ({stage.children.length})\r\n                                        </Badge>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Progresso */}\r\n                            <div className=\"w-32 space-y-1.5\">\r\n                                <div className=\"flex justify-between text-xs font-bold\">\r\n                                    <span className=\"text-slate-500\">Progresso</span>\r\n                                    <span className={getStatusColor(stage.progress?.actualPercentage || 0, stage.progress?.plannedPercentage || 0)}>\r\n                                        {Math.min(100, stage.progress?.actualPercentage || 0).toFixed(2)}%\r\n                                    </span>\r\n                                </div>\r\n                                <Progress value={Math.min(100, stage.progress?.actualPercentage || 0)} className=\"h-1.5 bg-white/5\" />\r\n                            </div>\r\n\r\n                            {/* Actions */}\r\n                            <DropdownMenu>\r\n                                <DropdownMenuTrigger asChild>\r\n                                    <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                        <MoreVertical className=\"h-4 w-4\" />\r\n                                    </Button>\r\n                                </DropdownMenuTrigger>\r\n                                <DropdownMenuContent align=\"end\" className=\"bg-slate-950 border-slate-800\">\r\n                                    <DropdownMenuItem onClick={() => handleCreate(stage.id)} className=\"cursor-pointer\">\r\n                                        <Plus className=\"h-4 w-4 mr-2\" />\r\n                                        Adicionar Sub-etapa\r\n                                    </DropdownMenuItem>\r\n                                    <DropdownMenuSeparator className=\"bg-slate-800\" />\r\n                                    <DropdownMenuItem onClick={() => handleEdit(stage)} className=\"cursor-pointer\">\r\n                                        <Edit2 className=\"h-4 w-4 mr-2\" />\r\n                                        Editar\r\n                                    </DropdownMenuItem>\r\n                                    <DropdownMenuItem\r\n                                        onClick={() => handleDelete(stage.id)}\r\n                                        className=\"cursor-pointer text-rose-500 focus:text-rose-500\"\r\n                                    >\r\n                                        <Trash2 className=\"h-4 w-4 mr-2\" />\r\n                                        Excluir\r\n                                    </DropdownMenuItem>\r\n                                </DropdownMenuContent>\r\n                            </DropdownMenu>\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                {/* Children */}\r\n                {hasChildren && isExpanded && (\r\n                    <div className=\"space-y-0\">\r\n                        {stage.children.map((child, childIndex) => renderStage(child, childIndex, depth + 1))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h2 className=\"text-xl font-bold flex items-center gap-2\">\r\n                        <Activity className=\"w-5 h-5 text-primary\" />\r\n                        Acompanhamento de Metas\r\n                    </h2>\r\n                    <p className=\"text-xs text-muted-foreground italic font-medium\">\r\n                        Cronograma Físico x Realizado por etapa de obra.\r\n                        {stages.length > 0 && <span className=\"text-amber-500 ml-1\">Arraste para reordenar • Clique ⋮ para sub-etapas</span>}\r\n                    </p>\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    {stages.length > 0 && (\r\n                        <div className=\"flex gap-2\">\r\n                            <Button\r\n                                variant=\"outline\"\r\n                                size=\"sm\"\r\n                                onClick={handleSync}\r\n                                disabled={isSyncing}\r\n                                className=\"border-amber-500/30 text-amber-500 hover:bg-amber-500/10 gap-2 font-bold\"\r\n                            >\r\n                                {isSyncing ? <Loader2 className=\"w-3 h-3 animate-spin\" /> : <Zap className=\"w-3 h-3\" />}\r\n                                Sincronizar Produção\r\n                            </Button>\r\n\r\n                            <AlertDialog>\r\n                                <AlertDialogTrigger asChild>\r\n                                    <Button variant=\"outline\" size=\"sm\" className=\"border-rose-500/30 text-rose-500 hover:bg-rose-950/20 gap-2\">\r\n                                        <Trash2 className=\"w-3 h-3\" /> Remover Todas\r\n                                    </Button>\r\n                                </AlertDialogTrigger>\r\n                                <AlertDialogContent className=\"bg-slate-950 border-slate-800\">\r\n                                    <AlertDialogHeader>\r\n                                        <AlertDialogTitle className=\"text-rose-500 flex items-center gap-2\">\r\n                                            <AlertTriangle className=\"h-5 w-5\" />\r\n                                            Remover Todas as Etapas\r\n                                        </AlertDialogTitle>\r\n                                        <AlertDialogDescription>\r\n                                            Tem certeza que deseja remover <strong>todas as {stages.length} etapas</strong>?\r\n                                            Esta ação não pode ser desfeita.\r\n                                        </AlertDialogDescription>\r\n                                    </AlertDialogHeader>\r\n                                    <AlertDialogFooter>\r\n                                        <AlertDialogCancel className=\"border-slate-700\">Cancelar</AlertDialogCancel>\r\n                                        <AlertDialogAction\r\n                                            onClick={handleDeleteAll}\r\n                                            className=\"bg-rose-600 hover:bg-rose-700\"\r\n                                        >\r\n                                            Sim, Remover Todas\r\n                                        </AlertDialogAction>\r\n                                    </AlertDialogFooter>\r\n                                </AlertDialogContent>\r\n                            </AlertDialog>\r\n                        </div>\r\n                    )}\r\n                    <Button onClick={() => handleCreate(null)} className=\"gradient-primary font-bold gap-2\">\r\n                        <Plus className=\"w-4 h-4\" /> Nova Etapa\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"space-y-0\">\r\n                {isLoading ? (\r\n                    <div className=\"py-20 text-center glass-card italic text-muted-foreground\">\r\n                        <div className=\"h-8 w-8 border-4 border-amber-500 border-t-transparent rounded-full animate-spin mx-auto mb-4\" />\r\n                        Calculando avanço físico...\r\n                    </div>\r\n                ) : hierarchicalStages.length === 0 ? (\r\n                    <div className=\"py-20 text-center glass-card\">\r\n                        <p className=\"italic text-muted-foreground mb-4\">Nenhuma etapa de obra cadastrada para este projeto.</p>\r\n                        <Button onClick={() => handleCreate(null)} variant=\"outline\" className=\"border-amber-500/30 text-amber-500 hover:bg-amber-500/10\">\r\n                            <Plus className=\"w-4 h-4 mr-2\" /> Adicionar Primeira Etapa\r\n                        </Button>\r\n                    </div>\r\n                ) : (\r\n                    hierarchicalStages.map((stage, index) => renderStage(stage, index, 0))\r\n                )}\r\n            </div>\r\n\r\n            <StageFormModal\r\n                isOpen={isModalOpen}\r\n                onClose={() => {\r\n                    setIsModalOpen(false);\r\n                    setParentIdForNew(null);\r\n                }}\r\n                stage={editingStage}\r\n                onSave={handleSave}\r\n                onDelete={handleDelete}\r\n                onSync={syncStages}\r\n                onRefresh={refresh}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\gapo\\GAPOValidationList.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CardHeader' is defined but never used.","line":3,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CardTitle' is defined but never used.","line":3,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CardDescription' is defined but never used.","line":3,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":67},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Clock' is defined but never used.","line":7,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Activity' is defined but never used.","line":7,"column":69,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":77},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'HelpCircle' is defined but never used.","line":7,"column":85,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":95},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ptBR' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1352,1355],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1352,1355],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1390,1393],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1390,1393],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":63,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":63,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2776,2779],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2776,2779],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { useProductionLogs, ProductionLog } from '@/hooks/useProductionLogs';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\r\nimport { CheckCircle2, XCircle, Clock, AlertTriangle, User, MapPin, Activity, Info, HelpCircle } from 'lucide-react';\r\nimport { format } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogDescription,\r\n    DialogFooter\r\n} from '@/components/ui/dialog';\r\nimport { Textarea } from '@/components/ui/textarea';\r\n\r\ninterface GAPOValidationListProps {\r\n    projectId?: string;\r\n}\r\n\r\nexport default function GAPOValidationList({ projectId }: GAPOValidationListProps) {\r\n    const { data: logs = [], isLoading, approve, isApproving } = useProductionLogs(true);\r\n    const { toast } = useToast();\r\n\r\n    // Context-aware filtering\r\n    const filteredLogs = React.useMemo(() => {\r\n        if (!projectId) return logs;\r\n        return logs.filter(log => {\r\n            const tower = log.tower as any;\r\n            const meta = log as any;\r\n            return !projectId || tower?.project_id === projectId || meta.metadata?.projectId === projectId;\r\n        });\r\n    }, [logs, projectId]);\r\n\r\n    // Use filteredLogs instead of logs for rendering\r\n    const displayLogs = projectId ? filteredLogs : logs;\r\n\r\n    const [selectedLog, setSelectedLog] = useState<ProductionLog | null>(null);\r\n    const [auditNote, setAuditNote] = useState('');\r\n    const [modalAction, setModalAction] = useState<'approve' | 'reject' | null>(null);\r\n\r\n    const handleAction = async () => {\r\n        if (!selectedLog || !modalAction) return;\r\n\r\n        try {\r\n            await approve({\r\n                logId: selectedLog.id,\r\n                approved: modalAction === 'approve',\r\n                reason: auditNote\r\n            });\r\n\r\n            toast({\r\n                title: modalAction === 'approve' ? 'Apontamento Aprovado' : 'Apontamento Rejeitado',\r\n                description: `O registro da torre ${selectedLog.tower?.objectId} foi processado com sucesso.`,\r\n            });\r\n\r\n            setSelectedLog(null);\r\n            setAuditNote('');\r\n        } catch (error) {\r\n            toast({\r\n                title: 'Erro no processamento',\r\n                description: 'Não foi possível salvar a validação técnica.',\r\n                variant: 'destructive'\r\n            });\r\n        }\r\n    };\r\n\r\n    const isValidDate = (date: any) => {\r\n        const d = new Date(date);\r\n        return d instanceof Date && !isNaN(d.getTime());\r\n    };\r\n\r\n    if (isLoading) {\r\n        return <div className=\"p-8 text-center animate-pulse italic\">Carregando auditorias pendentes...</div>;\r\n    }\r\n\r\n    if (displayLogs.length === 0) {\r\n        return (\r\n            <Card className=\"glass-card border-white/5 border-dashed\">\r\n                <CardContent className=\"p-12 text-center\">\r\n                    <CheckCircle2 className=\"w-12 h-12 text-emerald-500/20 mx-auto mb-4\" />\r\n                    <h3 className=\"text-lg font-bold\">Tudo em dia!</h3>\r\n                    <p className=\"text-muted-foreground text-sm\">Não há validações técnicas pendentes no momento.</p>\r\n                </CardContent>\r\n            </Card>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            <div className=\"flex items-center justify-between px-2\">\r\n                <div>\r\n                    <h3 className=\"text-lg font-bold flex items-center gap-2\">\r\n                        <AlertTriangle className=\"w-5 h-5 text-amber-500\" />\r\n                        Aguardando Validação Técnica\r\n                    </h3>\r\n                    <p className=\"text-xs text-muted-foreground\">Analise e approve os apontamentos de campo que exigem supervisão.</p>\r\n                </div>\r\n                <Badge variant=\"secondary\" className=\"bg-amber-500/10 text-amber-500 border-amber-500/20 font-black\">\r\n                    {displayLogs.length} PENDENTES\r\n                </Badge>\r\n            </div>\r\n\r\n            <div className=\"bg-blue-500/5 border border-blue-500/10 rounded-lg p-3 flex gap-3 animate-in fade-in duration-500\">\r\n                <Info className=\"w-5 h-5 text-blue-400 shrink-0\" />\r\n                <div className=\"space-y-1\">\r\n                    <h4 className=\"text-[11px] font-black text-blue-400 uppercase tracking-widest\">Protocolo de Verificação Manual</h4>\r\n                    <p className=\"text-[10px] text-white/50 leading-relaxed\">\r\n                        Para cada <strong>teste de campo</strong>, verifique: (1) Evidência fotográfica no repositório, (2) Coerência entre progresso reportado e cronograma planejado, (3) Assinatura digital do encarregado. A aprovação sincroniza automaticamente o Avanço Físico (WorkStages).\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            <Card className=\"glass-card overflow-hidden\">\r\n                <Table>\r\n                    <TableHeader>\r\n                        <TableRow className=\"hover:bg-transparent border-white/5 bg-white/2\">\r\n                            <TableHead className=\"text-[10px] uppercase font-black tracking-widest pl-6\">Torre / Objeto</TableHead>\r\n                            <TableHead className=\"text-[10px] uppercase font-black tracking-widest\">Atividade</TableHead>\r\n                            <TableHead className=\"text-[10px] uppercase font-black tracking-widest text-center\">Progresso</TableHead>\r\n                            <TableHead className=\"text-[10px] uppercase font-black tracking-widest\">Responsável</TableHead>\r\n                            <TableHead className=\"text-[10px] uppercase font-black tracking-widest\">Informado em</TableHead>\r\n                            <TableHead className=\"text-[10px] uppercase font-black tracking-widest pr-6 text-right\">Ações</TableHead>\r\n                        </TableRow>\r\n                    </TableHeader>\r\n                    <TableBody>\r\n                        {displayLogs.map((log) => (\r\n                            <TableRow key={log.id} className=\"hover:bg-white/2 border-white/5 transition-colors\">\r\n                                <TableCell className=\"pl-6\">\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <div className=\"p-1.5 rounded-lg bg-primary/10\">\r\n                                            <MapPin className=\"w-3.5 h-3.5 text-primary\" />\r\n                                        </div>\r\n                                        <span className=\"font-bold\">{log.tower?.objectId}</span>\r\n                                    </div>\r\n                                </TableCell>\r\n                                <TableCell>\r\n                                    <div className=\"flex flex-col\">\r\n                                        <span className=\"text-[11px] font-bold\">{log.activity?.name}</span>\r\n                                        <span className=\"text-[9px] uppercase tracking-tighter opacity-50 italic\">\r\n                                            {log.approvalReason || 'Solicitação Padrão'}\r\n                                        </span>\r\n                                    </div>\r\n                                </TableCell>\r\n                                <TableCell className=\"text-center\">\r\n                                    <Badge variant=\"outline\" className=\"text-[10px] font-black border-primary/20 bg-primary/5\">\r\n                                        {log.progressPercent}%\r\n                                    </Badge>\r\n                                </TableCell>\r\n                                <TableCell>\r\n                                    <div className=\"flex items-center gap-2 text-[10px] font-medium\">\r\n                                        <User className=\"w-3 h-3 opacity-60\" />\r\n                                        {log.changedBy?.name?.split(' ')[0]}\r\n                                    </div>\r\n                                </TableCell>\r\n                                <TableCell>\r\n                                    <div className=\"flex flex-col text-[10px] font-bold\">\r\n                                        <span>\r\n                                            {isValidDate(log.createdAt)\r\n                                                ? format(new Date(log.createdAt), 'dd/MM/yyyy')\r\n                                                : 'Data Inválida'}\r\n                                        </span>\r\n                                        <span className=\"opacity-50\">\r\n                                            {isValidDate(log.createdAt)\r\n                                                ? format(new Date(log.createdAt), 'HH:mm')\r\n                                                : '--:--'}\r\n                                        </span>\r\n                                    </div>\r\n                                </TableCell>\r\n                                <TableCell className=\"pr-6 text-right\">\r\n                                    <div className=\"flex items-center justify-end gap-2\">\r\n                                        <Button\r\n                                            size=\"sm\"\r\n                                            variant=\"ghost\"\r\n                                            className=\"h-8 w-8 p-0 hover:bg-red-500/10 hover:text-red-500\"\r\n                                            onClick={() => {\r\n                                                setSelectedLog(log);\r\n                                                setModalAction('reject');\r\n                                            }}\r\n                                        >\r\n                                            <XCircle className=\"w-4 h-4\" />\r\n                                        </Button>\r\n                                        <Button\r\n                                            size=\"sm\"\r\n                                            variant=\"ghost\"\r\n                                            className=\"h-8 w-8 p-0 hover:bg-emerald-500/10 hover:text-emerald-500\"\r\n                                            onClick={() => {\r\n                                                setSelectedLog(log);\r\n                                                setModalAction('approve');\r\n                                            }}\r\n                                        >\r\n                                            <CheckCircle2 className=\"w-4 h-4\" />\r\n                                        </Button>\r\n                                    </div>\r\n                                </TableCell>\r\n                            </TableRow>\r\n                        ))}\r\n                    </TableBody>\r\n                </Table>\r\n            </Card>\r\n\r\n            <Dialog open={!!selectedLog} onOpenChange={(open) => !open && setSelectedLog(null)}>\r\n                <DialogContent className=\"glass-card border-white/10 sm:max-w-[400px]\">\r\n                    <DialogHeader>\r\n                        <DialogTitle className=\"flex items-center gap-2\">\r\n                            {modalAction === 'approve' ? (\r\n                                <CheckCircle2 className=\"w-5 h-5 text-emerald-500\" />\r\n                            ) : (\r\n                                <XCircle className=\"w-5 h-5 text-red-500\" />\r\n                            )}\r\n                            {modalAction === 'approve' ? 'Confirmar Validação' : 'Rejeitar Apontamento'}\r\n                        </DialogTitle>\r\n                        <DialogDescription className=\"text-xs\">\r\n                            Torre: <span className=\"font-bold text-foreground\">{selectedLog?.tower?.objectId}</span> |\r\n                            Atividade: <span className=\"font-bold text-foreground\">{selectedLog?.activity?.name}</span>\r\n                        </DialogDescription>\r\n                    </DialogHeader>\r\n\r\n                    <div className=\"py-4 space-y-4\">\r\n                        <div className=\"p-3 rounded-xl bg-white/5 border border-white/10 space-y-2\">\r\n                            <div className=\"flex justify-between items-center text-[10px] uppercase font-black tracking-widest opacity-60\">\r\n                                <span>Progresso Reportado</span>\r\n                                <span className=\"text-primary\">{selectedLog?.progressPercent}%</span>\r\n                            </div>\r\n                            <div className=\"h-1.5 w-full bg-white/10 rounded-full overflow-hidden\">\r\n                                <div\r\n                                    className=\"h-full bg-primary transition-all\"\r\n                                    style={{ width: `${selectedLog?.progressPercent}%` }}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-[10px] font-black uppercase tracking-widest opacity-60 pl-1\">\r\n                                Notas de Auditoria (Opcional)\r\n                            </label>\r\n                            <Textarea\r\n                                placeholder=\"Descreva observações técnicas sobre esta validação...\"\r\n                                className=\"glass-card border-white/5 bg-white/2 min-h-[80px] text-xs\"\r\n                                value={auditNote}\r\n                                onChange={(e) => setAuditNote(e.target.value)}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <DialogFooter className=\"gap-2 sm:gap-0\">\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            className=\"text-xs font-bold uppercase tracking-widest\"\r\n                            onClick={() => setSelectedLog(null)}\r\n                        >\r\n                            Cancelar\r\n                        </Button>\r\n                        <Button\r\n                            size=\"sm\"\r\n                            className={modalAction === 'approve' ? 'gradient-primary' : 'bg-red-500 hover:bg-red-600'}\r\n                            onClick={handleAction}\r\n                            disabled={isApproving}\r\n                        >\r\n                            {isApproving ? 'Processando...' : modalAction === 'approve' ? 'Validar Agora' : 'Confirmar Rejeição'}\r\n                        </Button>\r\n                    </DialogFooter>\r\n                </DialogContent>\r\n            </Dialog>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\gapo\\StageFormModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":158,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6505,6508],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6505,6508],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'toggleAllActivities' is assigned a value but never used.","line":217,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":217,"endColumn":30}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport { Checkbox } from '@/components/ui/checkbox';\r\nimport { WorkStage, CreateStageData } from '@/hooks/useWorkStages';\r\nimport { Save, Trash2, AlertCircle, List, PenLine, Loader2, FolderPlus, ChevronDown, ChevronRight, Zap } from 'lucide-react';\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport { orionApi } from '@/integrations/orion/client';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Select, SelectContent, SelectGroup, SelectItem, SelectLabel, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\n\r\ninterface StageFormModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    stage?: WorkStage | null;\r\n    onSave: (data: CreateStageData, silent?: boolean) => Promise<{ success: boolean; stageId?: string }>;\r\n    onDelete?: (stageId: string) => Promise<{ success: boolean }>;\r\n    onSync?: () => Promise<{ success: boolean }>; // New prop\r\n    onRefresh?: () => void;\r\n}\r\n\r\ninterface ProductionCategory {\r\n    id: string;\r\n    name: string;\r\n    activities: { id: string; name: string; weight: number }[];\r\n}\r\n\r\nexport default function StageFormModal({ isOpen, onClose, stage, onSave, onDelete, onSync, onRefresh }: StageFormModalProps) {\r\n    const [activeTab, setActiveTab] = useState<'manual' | 'import'>('manual');\r\n    const [name, setName] = useState('');\r\n    const [description, setDescription] = useState('');\r\n    const [weight, setWeight] = useState('1.0');\r\n    const [productionActivityId, setProductionActivityId] = useState<string>('none');\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n    const [error, setError] = useState('');\r\n\r\n    // Import state\r\n    const [selectedActivities, setSelectedActivities] = useState<Set<string>>(new Set());\r\n    const [selectedCategoriesOnly, setSelectedCategoriesOnly] = useState<Set<string>>(new Set()); // For Meta Mãe only\r\n    const [expandedCategories, setExpandedCategories] = useState<Set<string>>(new Set());\r\n\r\n    const isEditMode = !!stage;\r\n\r\n    // Fetch production activities\r\n    const { data: categories, isLoading: loadingCategories } = useQuery({\r\n        queryKey: ['production-categories'],\r\n        queryFn: async () => {\r\n            const res = await orionApi.get('/production/categories');\r\n            return res.data as ProductionCategory[];\r\n        },\r\n        enabled: isOpen && activeTab === 'import'\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (stage) {\r\n            setName(stage.name);\r\n            setDescription(stage.description || '');\r\n            setWeight(String(stage.weight));\r\n            setProductionActivityId(stage.productionActivityId || 'none');\r\n            setActiveTab('manual');\r\n        } else {\r\n            setName('');\r\n            setDescription('');\r\n            setWeight('1.0');\r\n            setProductionActivityId('none');\r\n            setSelectedActivities(new Set());\r\n            setSelectedCategoriesOnly(new Set());\r\n        }\r\n        setError('');\r\n    }, [stage, isOpen]);\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setError('');\r\n\r\n        if (!name.trim()) {\r\n            setError('O nome da etapa é obrigatório.');\r\n            return;\r\n        }\r\n\r\n        const weightNum = parseFloat(weight.replace(',', '.'));\r\n        if (isNaN(weightNum) || weightNum <= 0 || weightNum > 1) {\r\n            setError('O peso deve ser um número entre 0.01 e 1.0');\r\n            return;\r\n        }\r\n\r\n        setIsSubmitting(true);\r\n        try {\r\n            const result = await onSave({\r\n                name: name.trim(),\r\n                description: description.trim() || undefined,\r\n                weight: weightNum,\r\n                productionActivityId: productionActivityId !== 'none' ? productionActivityId : null\r\n            });\r\n\r\n            if (result.success) {\r\n                onClose();\r\n            }\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    };\r\n\r\n    const handleImport = async () => {\r\n        const hasActivities = selectedActivities.size > 0;\r\n        const hasCategoriesOnly = selectedCategoriesOnly.size > 0;\r\n\r\n        if (!hasActivities && !hasCategoriesOnly) {\r\n            setError('Selecione pelo menos uma categoria ou atividade para importar.');\r\n            return;\r\n        }\r\n\r\n        setIsSubmitting(true);\r\n        setError('');\r\n\r\n        try {\r\n            for (const cat of categories || []) {\r\n                const catActivities = cat.activities.filter(a => selectedActivities.has(a.id));\r\n                const isParentRequested = selectedCategoriesOnly.has(cat.id) || catActivities.length > 0;\r\n\r\n                if (!isParentRequested) continue;\r\n\r\n                // Create Parent Meta (Meta Mãe)\r\n                const parentResult = await onSave({\r\n                    name: cat.name,\r\n                    description: catActivities.length > 0\r\n                        ? `Etapa principal com ${catActivities.length} sub-metas`\r\n                        : `Meta principal`,\r\n                    weight: 1.0\r\n                }, true);\r\n\r\n                const parentId = parentResult.stageId;\r\n\r\n                // Create Children (Sub Metas)\r\n                for (const act of catActivities) {\r\n                    await onSave({\r\n                        name: act.name,\r\n                        description: `Sub-meta de ${cat.name}`,\r\n                        weight: Number(act.weight) || 1.0,\r\n                        parentId: parentId,\r\n                        productionActivityId: act.id\r\n                    }, true);\r\n                }\r\n            }\r\n\r\n            if (onSync) {\r\n                console.log('[Importação] Iniciando sincronização de dados...');\r\n                await onSync();\r\n            } else {\r\n                onRefresh?.();\r\n            }\r\n            onClose();\r\n        } catch (err: any) {\r\n            setError(err.message || 'Erro ao importar etapas');\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    };\r\n\r\n    const handleDelete = async () => {\r\n        if (!stage || !onDelete) return;\r\n        setIsSubmitting(true);\r\n        try {\r\n            const result = await onDelete(stage.id);\r\n            if (result.success) {\r\n                onClose();\r\n            }\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    };\r\n\r\n    const toggleActivity = (activityId: string, categoryId: string) => {\r\n        const newSet = new Set(selectedActivities);\r\n        if (newSet.has(activityId)) {\r\n            newSet.delete(activityId);\r\n        } else {\r\n            newSet.add(activityId);\r\n            // If adding an activity, remove category-only selection\r\n            const newCatSet = new Set(selectedCategoriesOnly);\r\n            newCatSet.delete(categoryId);\r\n            setSelectedCategoriesOnly(newCatSet);\r\n        }\r\n        setSelectedActivities(newSet);\r\n    };\r\n\r\n    const toggleCategory = (categoryId: string) => {\r\n        const category = categories?.find(c => c.id === categoryId);\r\n        if (!category) return;\r\n\r\n        const selectedCount = category.activities.filter(a => selectedActivities.has(a.id)).length;\r\n        const isManuallySelected = selectedCategoriesOnly.has(categoryId);\r\n        const isActive = selectedCount > 0 || isManuallySelected;\r\n\r\n        const newActSet = new Set(selectedActivities);\r\n        const newCatSet = new Set(selectedCategoriesOnly);\r\n\r\n        if (isActive) {\r\n            // Unselect everything in this category\r\n            category.activities.forEach(a => newActSet.delete(a.id));\r\n            newCatSet.delete(categoryId);\r\n        } else {\r\n            // Select all activities in this category\r\n            category.activities.forEach(a => newActSet.add(a.id));\r\n            newCatSet.add(categoryId);\r\n        }\r\n\r\n        setSelectedActivities(newActSet);\r\n        setSelectedCategoriesOnly(newCatSet);\r\n    };\r\n\r\n    const toggleAllActivities = (category: ProductionCategory) => {\r\n        const allSelected = category.activities.every(a => selectedActivities.has(a.id));\r\n        const newSet = new Set(selectedActivities);\r\n        const newCatSet = new Set(selectedCategoriesOnly);\r\n\r\n        category.activities.forEach(a => {\r\n            if (allSelected) {\r\n                newSet.delete(a.id);\r\n            } else {\r\n                newSet.add(a.id);\r\n            }\r\n        });\r\n\r\n        // Remove category-only when selecting activities\r\n        if (!allSelected) {\r\n            newCatSet.delete(category.id);\r\n            setSelectedCategoriesOnly(newCatSet);\r\n        }\r\n\r\n        setSelectedActivities(newSet);\r\n    };\r\n\r\n    const toggleExpandCategory = (categoryId: string) => {\r\n        const newSet = new Set(expandedCategories);\r\n        if (newSet.has(categoryId)) {\r\n            newSet.delete(categoryId);\r\n        } else {\r\n            newSet.add(categoryId);\r\n        }\r\n        setExpandedCategories(newSet);\r\n    };\r\n\r\n    const selectNone = () => {\r\n        setSelectedActivities(new Set());\r\n        setSelectedCategoriesOnly(new Set());\r\n    };\r\n\r\n    const getImportCount = () => {\r\n        const categoriesToBeImported = new Set<string>();\r\n\r\n        // Count categories that have activities selected\r\n        categories?.forEach(cat => {\r\n            if (cat.activities.some(a => selectedActivities.has(a.id)) || selectedCategoriesOnly.has(cat.id)) {\r\n                categoriesToBeImported.add(cat.id);\r\n            }\r\n        });\r\n\r\n        // Count items: Parents + Children\r\n        return categoriesToBeImported.size + selectedActivities.size;\r\n    };\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={onClose}>\r\n            <DialogContent className=\"max-w-2xl max-h-[85vh] overflow-hidden flex flex-col bg-slate-950 border-slate-800 text-slate-100\">\r\n                <DialogHeader>\r\n                    <DialogTitle className=\"text-xl font-bold text-amber-500\">\r\n                        {isEditMode ? 'Editar Etapa' : 'Nova Etapa de Obra'}\r\n                    </DialogTitle>\r\n                    <DialogDescription className=\"text-slate-400\">\r\n                        {isEditMode ? 'Atualize os dados da etapa.' : 'Adicione uma nova etapa ou importe das atividades de produção.'}\r\n                    </DialogDescription>\r\n                </DialogHeader>\r\n\r\n                {!isEditMode && (\r\n                    <Tabs value={activeTab} onValueChange={(v) => setActiveTab(v as 'manual' | 'import')} className=\"w-full\">\r\n                        <TabsList className=\"grid w-full grid-cols-2 bg-slate-900\">\r\n                            <TabsTrigger value=\"manual\" className=\"data-[state=active]:bg-amber-500/20 data-[state=active]:text-amber-500\">\r\n                                <PenLine className=\"h-4 w-4 mr-2\" />\r\n                                Manual\r\n                            </TabsTrigger>\r\n                            <TabsTrigger value=\"import\" className=\"data-[state=active]:bg-amber-500/20 data-[state=active]:text-amber-500\">\r\n                                <List className=\"h-4 w-4 mr-2\" />\r\n                                Importar Atividades\r\n                            </TabsTrigger>\r\n                        </TabsList>\r\n                    </Tabs>\r\n                )}\r\n\r\n                <div className=\"flex-1 overflow-y-auto py-4\">\r\n                    {error && (\r\n                        <div className=\"bg-rose-950/30 border border-rose-500/30 text-rose-400 p-3 rounded-lg text-sm flex items-center gap-2 mb-4\">\r\n                            <AlertCircle className=\"h-4 w-4\" />\r\n                            {error}\r\n                        </div>\r\n                    )}\r\n\r\n                    {(activeTab === 'manual' || isEditMode) && (\r\n                        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                            <div className=\"space-y-2\">\r\n                                <Label htmlFor=\"name\" className=\"text-xs uppercase font-bold tracking-wider text-slate-400\">\r\n                                    Nome da Etapa *\r\n                                </Label>\r\n                                <Input\r\n                                    id=\"name\"\r\n                                    value={name}\r\n                                    onChange={(e) => setName(e.target.value)}\r\n                                    placeholder=\"Ex: Fundação, Montagem, Lançamento...\"\r\n                                    className=\"bg-black/40 border-slate-700\"\r\n                                    autoFocus\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"space-y-2\">\r\n                                <Label htmlFor=\"description\" className=\"text-xs uppercase font-bold tracking-wider text-slate-400\">\r\n                                    Descrição\r\n                                </Label>\r\n                                <Textarea\r\n                                    id=\"description\"\r\n                                    value={description}\r\n                                    onChange={(e) => setDescription(e.target.value)}\r\n                                    placeholder=\"Descrição detalhada da etapa (opcional)\"\r\n                                    className=\"bg-black/40 border-slate-700 min-h-[80px]\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"space-y-2\">\r\n                                <Label htmlFor=\"weight\" className=\"text-xs uppercase font-bold tracking-wider text-slate-400\">\r\n                                    Peso na Obra (0.01 a 1.0)\r\n                                </Label>\r\n                                <Input\r\n                                    id=\"weight\"\r\n                                    type=\"text\"\r\n                                    inputMode=\"decimal\"\r\n                                    value={weight}\r\n                                    onChange={(e) => setWeight(e.target.value)}\r\n                                    placeholder=\"Ex: 0.25 (25% do peso total)\"\r\n                                    className=\"bg-black/40 border-slate-700 w-32\"\r\n                                />\r\n                                <p className=\"text-[10px] text-slate-500\">\r\n                                    O peso define a importância relativa desta etapa no cálculo do avanço físico geral.\r\n                                </p>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-2\">\r\n                                <Label htmlFor=\"activityLink\" className=\"text-xs uppercase font-bold tracking-wider text-slate-400\">\r\n                                    Vincular à Atividade de Produção\r\n                                </Label>\r\n                                <Select value={productionActivityId} onValueChange={setProductionActivityId}>\r\n                                    <SelectTrigger className=\"bg-black/40 border-slate-700\">\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            {productionActivityId !== 'none' && <Zap className=\"h-3 w-3 text-amber-500 fill-amber-500/20\" />}\r\n                                            <SelectValue placeholder=\"Selecione uma atividade para vincular automático\" />\r\n                                        </div>\r\n                                    </SelectTrigger>\r\n                                    <SelectContent className=\"max-h-[300px]\">\r\n                                        <SelectItem value=\"none\">-- Sem Vínculo Automático --</SelectItem>\r\n                                        {categories?.map((cat) => (\r\n                                            <SelectGroup key={cat.id}>\r\n                                                <SelectLabel className=\"text-amber-500 font-bold px-2 py-1.5 text-xs uppercase tracking-wider bg-slate-900/50\">\r\n                                                    {cat.name}\r\n                                                </SelectLabel>\r\n                                                {cat.activities.map((act) => (\r\n                                                    <SelectItem key={act.id} value={act.id} className=\"pl-6 text-sm\">\r\n                                                        {act.name}\r\n                                                    </SelectItem>\r\n                                                ))}\r\n                                            </SelectGroup>\r\n                                        ))}\r\n                                    </SelectContent>\r\n                                </Select>\r\n                                <p className=\"text-[10px] text-emerald-500/80\">\r\n                                    Ao vincular, o avanço desta etapa será atualizado automaticamente quando a produção for apontada.\r\n                                </p>\r\n                            </div>\r\n                        </form>\r\n                    )}\r\n\r\n                    {activeTab === 'import' && !isEditMode && (\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <div>\r\n                                    <p className=\"text-sm text-slate-400\">\r\n                                        Selecione as categorias e atividades:\r\n                                    </p>\r\n                                    <p className=\"text-[10px] text-slate-500\">\r\n                                        <FolderPlus className=\"h-3 w-3 inline mr-1\" />\r\n                                        Marque só a categoria = Meta Mãe | Marque atividades = Meta Mãe + Sub-metas\r\n                                    </p>\r\n                                </div>\r\n                                <Button variant=\"ghost\" size=\"sm\" onClick={selectNone} className=\"text-xs\">\r\n                                    Limpar\r\n                                </Button>\r\n                            </div>\r\n\r\n                            {loadingCategories ? (\r\n                                <div className=\"flex items-center justify-center py-10\">\r\n                                    <Loader2 className=\"h-6 w-6 animate-spin text-amber-500\" />\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"space-y-2 max-h-[350px] overflow-y-auto pr-2\">\r\n                                    {categories?.map(category => {\r\n                                        const selectedCount = category.activities.filter(a => selectedActivities.has(a.id)).length;\r\n                                        const isCategoryOnly = selectedCategoriesOnly.has(category.id);\r\n                                        const isExpanded = expandedCategories.has(category.id);\r\n                                        const hasAnySelection = selectedCount > 0 || isCategoryOnly;\r\n\r\n                                        return (\r\n                                            <div key={category.id} className={`bg-slate-900/50 rounded-lg border transition-all ${hasAnySelection ? 'border-amber-500/50 bg-amber-500/5' : 'border-slate-800'\r\n                                                }`}>\r\n                                                {/* Category Header */}\r\n                                                <div className=\"flex items-center gap-2 p-3\">\r\n                                                    {/* Expand/Collapse */}\r\n                                                    <Button\r\n                                                        variant=\"ghost\"\r\n                                                        size=\"icon\"\r\n                                                        className=\"h-6 w-6 p-0\"\r\n                                                        onClick={() => toggleExpandCategory(category.id)}\r\n                                                    >\r\n                                                        {isExpanded ? (\r\n                                                            <ChevronDown className=\"h-4 w-4 text-slate-500\" />\r\n                                                        ) : (\r\n                                                            <ChevronRight className=\"h-4 w-4 text-slate-500\" />\r\n                                                        )}\r\n                                                    </Button>\r\n\r\n                                                    {/* Category Only Checkbox */}\r\n                                                    <div\r\n                                                        className=\"flex items-center gap-2 cursor-pointer\"\r\n                                                        onClick={() => toggleCategory(category.id)}\r\n                                                    >\r\n                                                        <Checkbox\r\n                                                            checked={hasAnySelection}\r\n                                                            className=\"border-amber-500 data-[state=checked]:bg-amber-500\"\r\n                                                        />\r\n                                                    </div>\r\n\r\n                                                    {/* Category Name */}\r\n                                                    <span\r\n                                                        className=\"font-bold text-sm text-amber-500 uppercase tracking-wider flex-1 cursor-pointer\"\r\n                                                        onClick={() => toggleExpandCategory(category.id)}\r\n                                                    >\r\n                                                        {category.name}\r\n                                                    </span>\r\n\r\n                                                    {/* Selection indicator */}\r\n                                                    {isCategoryOnly && (\r\n                                                        <Badge className=\"bg-amber-500/20 text-amber-400 text-[9px]\">\r\n                                                            Só Meta Mãe\r\n                                                        </Badge>\r\n                                                    )}\r\n                                                    {selectedCount > 0 && (\r\n                                                        <Badge className=\"bg-emerald-500/20 text-emerald-400 text-[9px]\">\r\n                                                            {selectedCount} sub-metas\r\n                                                        </Badge>\r\n                                                    )}\r\n\r\n                                                    {/* Select All Activities Button */}\r\n                                                    <Button\r\n                                                        variant=\"ghost\"\r\n                                                        size=\"sm\"\r\n                                                        className=\"text-[10px] h-6 px-2\"\r\n                                                        onClick={() => toggleCategory(category.id)}\r\n                                                    >\r\n                                                        {hasAnySelection ? 'Limpar' : 'Todas'}\r\n                                                    </Button>\r\n                                                </div>\r\n\r\n                                                {/* Activities List */}\r\n                                                {isExpanded && (\r\n                                                    <div className=\"px-3 pb-3 pt-0 border-t border-slate-800/50\">\r\n                                                        <div className=\"grid grid-cols-2 gap-1 mt-2\">\r\n                                                            {category.activities.map(activity => (\r\n                                                                <label\r\n                                                                    key={activity.id}\r\n                                                                    className=\"flex items-center gap-2 cursor-pointer text-sm text-slate-300 hover:text-white p-1.5 rounded hover:bg-slate-800/50\"\r\n                                                                >\r\n                                                                    <Checkbox\r\n                                                                        checked={selectedActivities.has(activity.id)}\r\n                                                                        onCheckedChange={() => toggleActivity(activity.id, category.id)}\r\n                                                                    />\r\n                                                                    <span className=\"truncate\">{activity.name}</span>\r\n                                                                </label>\r\n                                                            ))}\r\n                                                        </div>\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n                                        );\r\n                                    })}\r\n                                </div>\r\n                            )}\r\n\r\n                            {getImportCount() > 0 && (\r\n                                <p className=\"text-xs text-amber-500 font-medium\">\r\n                                    {getImportCount()} item(s) selecionado(s) para importar\r\n                                </p>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                <DialogFooter className=\"flex items-center justify-between border-t border-slate-800 pt-4\">\r\n                    {isEditMode && onDelete ? (\r\n                        <AlertDialog>\r\n                            <AlertDialogTrigger asChild>\r\n                                <Button variant=\"ghost\" className=\"text-rose-500 hover:bg-rose-950/30 hover:text-rose-400\">\r\n                                    <Trash2 className=\"h-4 w-4 mr-2\" />\r\n                                    Excluir\r\n                                </Button>\r\n                            </AlertDialogTrigger>\r\n                            <AlertDialogContent className=\"bg-slate-950 border-slate-800\">\r\n                                <AlertDialogHeader>\r\n                                    <AlertDialogTitle className=\"text-rose-500\">Excluir Etapa</AlertDialogTitle>\r\n                                    <AlertDialogDescription>\r\n                                        Tem certeza que deseja excluir a etapa \"{stage?.name}\"? Esta ação não pode ser desfeita.\r\n                                    </AlertDialogDescription>\r\n                                </AlertDialogHeader>\r\n                                <AlertDialogFooter>\r\n                                    <AlertDialogCancel className=\"border-slate-700\">Cancelar</AlertDialogCancel>\r\n                                    <AlertDialogAction\r\n                                        onClick={handleDelete}\r\n                                        className=\"bg-rose-600 hover:bg-rose-700\"\r\n                                    >\r\n                                        Sim, Excluir\r\n                                    </AlertDialogAction>\r\n                                </AlertDialogFooter>\r\n                            </AlertDialogContent>\r\n                        </AlertDialog>\r\n                    ) : (\r\n                        <div />\r\n                    )}\r\n\r\n                    <div className=\"flex gap-2\">\r\n                        <Button variant=\"outline\" onClick={onClose} className=\"border-slate-700 hover:bg-slate-800\">\r\n                            Cancelar\r\n                        </Button>\r\n\r\n                        {activeTab === 'manual' || isEditMode ? (\r\n                            <Button\r\n                                onClick={handleSubmit}\r\n                                disabled={isSubmitting}\r\n                                className=\"bg-amber-600 hover:bg-amber-700 text-white font-bold\"\r\n                            >\r\n                                <Save className=\"h-4 w-4 mr-2\" />\r\n                                {isSubmitting ? 'Salvando...' : (isEditMode ? 'Salvar Alterações' : 'Criar Etapa')}\r\n                            </Button>\r\n                        ) : (\r\n                            <Button\r\n                                onClick={handleImport}\r\n                                disabled={isSubmitting || getImportCount() === 0}\r\n                                className=\"bg-amber-600 hover:bg-amber-700 text-white font-bold\"\r\n                            >\r\n                                <List className=\"h-4 w-4 mr-2\" />\r\n                                {isSubmitting ? 'Importando...' : `Importar ${getImportCount()} Item(s)`}\r\n                            </Button>\r\n                        )}\r\n                    </div>\r\n                </DialogFooter>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\gapo\\document-approval-modal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AlertTriangle' is defined but never used.","line":6,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":63},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":131,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8861,8864],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8861,8864],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\r\nimport { Badge } from '@/components/ui/badge'; // Assuming you have a Badge component\r\nimport { CheckCircle2, XCircle, Clock, FileText, AlertTriangle } from 'lucide-react';\r\nimport { format } from 'date-fns';\r\nimport { ConstructionDocument } from '@/hooks/useConstructionDocuments';\r\nimport { ScrollArea } from '@/components/ui/scroll-area';\r\n\r\ninterface DocumentApprovalModalProps {\r\n    documents: ConstructionDocument[];\r\n    onApprove: (doc: ConstructionDocument) => void;\r\n    onReject: (doc: ConstructionDocument) => void;\r\n}\r\n\r\nexport function DocumentApprovalModal({ documents, onApprove, onReject }: DocumentApprovalModalProps) {\r\n    const pendingDocs = documents.filter(d => d.status === 'pending');\r\n    const processedDocs = documents.filter(d => d.status === 'valid' || d.status === 'rejected').slice(0, 50); // Show last 50 processed\r\n\r\n    return (\r\n        <Dialog>\r\n            <DialogTrigger asChild>\r\n                <Button variant=\"outline\" className=\"w-full gap-2 relative\">\r\n                    <Clock className=\"size-4\" />\r\n                    Aprovação de Arquivos\r\n                    {pendingDocs.length > 0 && (\r\n                        <span className=\"absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-red-500 text-[10px] text-white\">\r\n                            {pendingDocs.length}\r\n                        </span>\r\n                    )}\r\n                </Button>\r\n            </DialogTrigger>\r\n            <DialogContent className=\"max-w-4xl max-h-[80vh] flex flex-col glass-card border-white/10\">\r\n                <DialogHeader>\r\n                    <DialogTitle>Central de Aprovação</DialogTitle>\r\n                    <DialogDescription>Gerencie a entrada de novos documentos no sistema.</DialogDescription>\r\n                </DialogHeader>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 flex-1 overflow-hidden\">\r\n                    <div className=\"flex flex-col gap-4 overflow-hidden\">\r\n                        <h3 className=\"font-bold flex items-center gap-2 text-amber-500\">\r\n                            <Clock className=\"size-4\" /> Pendentes ({pendingDocs.length})\r\n                        </h3>\r\n                        <div className=\"border border-white/10 rounded-lg overflow-hidden flex-1 bg-black/20\">\r\n                            <ScrollArea className=\"h-full\">\r\n                                {pendingDocs.length === 0 ? (\r\n                                    <div className=\"p-8 text-center text-muted-foreground flex flex-col items-center gap-2\">\r\n                                        <CheckCircle2 className=\"size-8 opacity-20\" />\r\n                                        <span className=\"text-xs\">Tudo limpo! Nenhum documento pendente.</span>\r\n                                    </div>\r\n                                ) : (\r\n                                    <Table>\r\n                                        <TableHeader>\r\n                                            <TableRow className=\"hover:bg-transparent\">\r\n                                                <TableHead className=\"text-xs\">Arquivo</TableHead>\r\n                                                <TableHead className=\"text-xs text-right\">Ações</TableHead>\r\n                                            </TableRow>\r\n                                        </TableHeader>\r\n                                        <TableBody>\r\n                                            {pendingDocs.map(doc => (\r\n                                                <TableRow key={doc.id} className=\"hover:bg-white/5\">\r\n                                                    <TableCell className=\"py-2\">\r\n                                                        <div className=\"flex flex-col gap-1\">\r\n                                                            <span className=\"font-medium text-sm flex items-center gap-2\">\r\n                                                                <FileText className=\"size-3 text-primary\" /> {doc.name}\r\n                                                            </span>\r\n                                                            <div className=\"flex gap-2 text-[10px] text-muted-foreground\">\r\n                                                                <span>{format(doc.createdAt, 'dd/MM HH:mm')}</span>\r\n                                                                <span>•</span>\r\n                                                                <span>{(doc.fileSize / 1024).toFixed(0)} KB</span>\r\n                                                                <span>•</span>\r\n                                                                <span>{doc.createdBy}</span>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </TableCell>\r\n                                                    <TableCell className=\"text-right py-2\">\r\n                                                        <div className=\"flex justify-end gap-1\">\r\n                                                            <Button size=\"icon\" variant=\"ghost\" className=\"h-7 w-7 text-emerald-500 hover:bg-emerald-500/10 hover:text-emerald-400\" onClick={() => onApprove(doc)}>\r\n                                                                <CheckCircle2 className=\"size-4\" />\r\n                                                            </Button>\r\n                                                            <Button size=\"icon\" variant=\"ghost\" className=\"h-7 w-7 text-red-500 hover:bg-red-500/10 hover:text-red-400\" onClick={() => onReject(doc)}>\r\n                                                                <XCircle className=\"size-4\" />\r\n                                                            </Button>\r\n                                                        </div>\r\n                                                    </TableCell>\r\n                                                </TableRow>\r\n                                            ))}\r\n                                        </TableBody>\r\n                                    </Table>\r\n                                )}\r\n                            </ScrollArea>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex flex-col gap-4 overflow-hidden opacity-75\">\r\n                        <h3 className=\"font-bold flex items-center gap-2 text-muted-foreground\">\r\n                            <HistoryIcon className=\"size-4\" /> Histórico Recente\r\n                        </h3>\r\n                        <div className=\"border border-white/10 rounded-lg overflow-hidden flex-1 bg-black/20\">\r\n                            <ScrollArea className=\"h-full\">\r\n                                <Table>\r\n                                    <TableHeader>\r\n                                        <TableRow className=\"hover:bg-transparent\">\r\n                                            <TableHead className=\"text-xs\">Arquivo</TableHead>\r\n                                            <TableHead className=\"text-xs text-right\">Status</TableHead>\r\n                                        </TableRow>\r\n                                    </TableHeader>\r\n                                    <TableBody>\r\n                                        {processedDocs.map(doc => (\r\n                                            <TableRow key={doc.id} className=\"hover:bg-transparent opacity-60\">\r\n                                                <TableCell className=\"py-2 text-xs\">{doc.name}</TableCell>\r\n                                                <TableCell className=\"py-2 text-right\">\r\n                                                    <Badge variant=\"outline\" className={`text-[10px] ${doc.status === 'valid' ? 'text-emerald-500 border-emerald-500/30' : 'text-gray-500 border-gray-500/30 font-bold'}`}>\r\n                                                        {doc.status === 'valid' ? 'Aprovado' : 'Rejeitado'}\r\n                                                    </Badge>\r\n                                                </TableCell>\r\n                                            </TableRow>\r\n                                        ))}\r\n                                    </TableBody>\r\n                                </Table>\r\n                            </ScrollArea>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n\r\nfunction HistoryIcon(props: any) {\r\n    return (\r\n        <svg\r\n            {...props}\r\n            xmlns=\"http://www.w3.org/2000/svg\"\r\n            width=\"24\"\r\n            height=\"24\"\r\n            viewBox=\"0 0 24 24\"\r\n            fill=\"none\"\r\n            stroke=\"currentColor\"\r\n            strokeWidth=\"2\"\r\n            strokeLinecap=\"round\"\r\n            strokeLinejoin=\"round\"\r\n        >\r\n            <path d=\"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74-2.74L3 12\" />\r\n            <path d=\"M3 3v9h9\" />\r\n            <path d=\"M12 7v5l4 2\" />\r\n        </svg>\r\n    )\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\gapo\\file-explorer\\document-sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\gapo\\file-explorer\\file-explorer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\gapo\\file-explorer\\file-tree-item.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ExternalLink' is defined but never used.","line":18,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'toast' is defined but never used.","line":36,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":15}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport * as React from \"react\"\r\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\"\r\nimport {\r\n    ChevronRight,\r\n    Folder,\r\n    FolderOpen,\r\n    File,\r\n    FileText,\r\n    FileImage,\r\n    FileCode,\r\n    Settings,\r\n    FileJson,\r\n    Edit2,\r\n    Trash2,\r\n    Archive,\r\n    ExternalLink,\r\n    Info,\r\n    FolderPlus,\r\n    FilePlus,\r\n    Star,\r\n    Zap,\r\n    ChevronUp,\r\n    Eye,\r\n    Shield\r\n} from \"lucide-react\"\r\nimport { cn } from \"@/lib/utils\"\r\nimport {\r\n    ContextMenu,\r\n    ContextMenuContent,\r\n    ContextMenuItem,\r\n    ContextMenuSeparator,\r\n    ContextMenuTrigger,\r\n} from \"@/components/ui/context-menu\"\r\nimport { toast } from \"sonner\"\r\n\r\nexport interface FileNode {\r\n    id: string\r\n    name: string\r\n    type: \"file\" | \"folder\"\r\n    children?: FileNode[]\r\n    extension?: string\r\n}\r\n\r\ninterface FileTreeItemProps {\r\n    node: FileNode\r\n    level?: number\r\n    onSelect?: (node: FileNode) => void\r\n    selectedId?: string\r\n    isMultiSelect?: boolean\r\n    isSelected?: boolean\r\n    getIsSelected?: (id: string) => boolean\r\n    onAction?: (action: string, node: FileNode) => void\r\n    onMove?: (sourceId: string, targetId: string) => void\r\n}\r\n\r\nconst getFileIcon = (extension?: string) => {\r\n    switch (extension) {\r\n        case \"txt\":\r\n        case \"md\":\r\n        case \"doc\":\r\n        case \"pdf\":\r\n            return FileText\r\n        case \"png\":\r\n        case \"jpg\":\r\n        case \"jpeg\":\r\n        case \"gif\":\r\n        case \"svg\":\r\n            return FileImage\r\n        case \"ts\":\r\n        case \"tsx\":\r\n        case \"js\":\r\n        case \"jsx\":\r\n        case \"css\":\r\n        case \"html\":\r\n            return FileCode\r\n        case \"json\":\r\n            return FileJson\r\n        case \"settings\":\r\n            return Settings\r\n        default:\r\n            return File\r\n    }\r\n}\r\n\r\nexport function FileTreeItem({\r\n    node,\r\n    level = 0,\r\n    onSelect,\r\n    selectedId,\r\n    isMultiSelect,\r\n    isSelected,\r\n    getIsSelected,\r\n    onAction,\r\n    onMove\r\n}: FileTreeItemProps) {\r\n    const [isOpen, setIsOpen] = React.useState(false)\r\n    const [isDragOver, setIsDragOver] = React.useState(false)\r\n    const activeSelected = isMultiSelect ? (getIsSelected?.(node.id) ?? isSelected) : selectedId === node.id\r\n    const FileIcon = node.type === \"folder\" ? (isOpen ? FolderOpen : Folder) : getFileIcon(node.extension)\r\n\r\n    const [nodeName, setNodeName] = React.useState(node.name)\r\n\r\n    const handleAction = (action: string) => {\r\n        if (action === \"Renomear\") {\r\n            const newName = window.prompt(\"Digite o novo nome:\", nodeName);\r\n            if (newName && newName !== nodeName) {\r\n                setNodeName(newName);\r\n                onAction?.(\"Renomear\", { ...node, name: newName });\r\n            }\r\n        } else {\r\n            onAction?.(action, node);\r\n        }\r\n    }\r\n\r\n    const handleDragStart = (e: React.DragEvent) => {\r\n        e.dataTransfer.setData(\"sourceId\", node.id);\r\n        e.dataTransfer.effectAllowed = \"move\";\r\n    };\r\n\r\n    const handleDragOver = (e: React.DragEvent) => {\r\n        if (node.type === \"folder\") {\r\n            e.preventDefault();\r\n            setIsDragOver(true);\r\n        }\r\n    };\r\n\r\n    const handleDragLeave = () => {\r\n        setIsDragOver(false);\r\n    };\r\n\r\n    const handleDrop = (e: React.DragEvent) => {\r\n        e.preventDefault();\r\n        setIsDragOver(false);\r\n        const sourceId = e.dataTransfer.getData(\"sourceId\");\r\n        if (sourceId && sourceId !== node.id) {\r\n            onMove?.(sourceId, node.id);\r\n        }\r\n    };\r\n\r\n    const SelectionOverlay = () => {\r\n        if (!isMultiSelect) return null\r\n        const selected = getIsSelected?.(node.id) ?? isSelected\r\n        return (\r\n            <div className={cn(\r\n                \"size-3.5 rounded border border-white/20 flex items-center justify-center transition-colors shrink-0\",\r\n                selected ? \"bg-primary border-primary\" : \"bg-transparent\"\r\n            )}>\r\n                {selected && <svg className=\"size-2.5 text-black\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"4\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><polyline points=\"20 6 9 17 4 12\" /></svg>}\r\n            </div>\r\n        )\r\n    }\r\n\r\n    const MenuContent = () => (\r\n        <ContextMenuContent className=\"glass-card border-white/10 w-48\">\r\n            <ContextMenuItem onClick={() => handleAction(\"Abrir\")} className=\"gap-2 font-bold\">\r\n                <Eye className=\"size-3.5\" /> Abrir / Visualizar\r\n            </ContextMenuItem>\r\n            {node.type === \"folder\" && (\r\n                <>\r\n                    <ContextMenuItem onClick={() => handleAction(\"Novo Arquivo\")} className=\"gap-2\">\r\n                        <FilePlus className=\"size-3.5\" /> Novo Arquivo\r\n                    </ContextMenuItem>\r\n                    <ContextMenuItem onClick={() => handleAction(\"Nova Pasta\")} className=\"gap-2\">\r\n                        <FolderPlus className=\"size-3.5\" /> Nova Pasta\r\n                    </ContextMenuItem>\r\n                    <ContextMenuSeparator className=\"bg-white/5\" />\r\n                    <ContextMenuItem onClick={() => handleAction(\"Permissões\")} className=\"gap-2\">\r\n                        <Shield className=\"size-3.5 text-primary\" /> Gerenciar Permissões\r\n                    </ContextMenuItem>\r\n                </>\r\n            )}\r\n            <ContextMenuSeparator className=\"bg-white/5\" />\r\n            <ContextMenuItem onClick={() => handleAction(\"Renomear\")} className=\"gap-2\">\r\n                <Edit2 className=\"size-3.5\" /> Renomear\r\n            </ContextMenuItem>\r\n            <ContextMenuItem onClick={() => handleAction(\"Arquivar\")} className=\"gap-2\">\r\n                <Archive className=\"size-3.5 text-amber-500\" /> Arquivar\r\n            </ContextMenuItem>\r\n            <ContextMenuSeparator className=\"bg-white/5\" />\r\n            <ContextMenuItem onClick={() => handleAction(\"Informações\")} className=\"gap-2\">\r\n                <Info className=\"size-3.5\" /> Informações\r\n            </ContextMenuItem>\r\n            <ContextMenuItem onClick={() => handleAction(\"Excluir\")} className=\"gap-2 text-red-500 hover:text-red-400 focus:text-red-400\">\r\n                <Trash2 className=\"size-3.5\" /> Excluir\r\n            </ContextMenuItem>\r\n            <ContextMenuSeparator className=\"bg-white/5\" />\r\n            <ContextMenuItem onClick={() => handleAction(\"Marcar como Importante\")} className=\"gap-2\">\r\n                <Star className=\"size-3.5 text-amber-500\" /> Marcar como Importante\r\n            </ContextMenuItem>\r\n            {node.type === \"folder\" && (\r\n                <ContextMenuItem onClick={() => handleAction(\"Nova Pasta Inteligente\")} className=\"gap-2\">\r\n                    <Zap className=\"size-3.5 text-primary\" /> Estrutura Automática\r\n                </ContextMenuItem>\r\n            )}\r\n            <ContextMenuItem onClick={() => handleAction(\"Mover para Raiz\")} className=\"gap-2\">\r\n                <ChevronUp className=\"size-3.5\" /> Mover para Raiz\r\n            </ContextMenuItem>\r\n        </ContextMenuContent>\r\n    )\r\n\r\n    if (node.type === \"folder\" && node.children) {\r\n        return (\r\n            <ContextMenu>\r\n                <Collapsible open={isOpen} onOpenChange={setIsOpen}>\r\n                    <ContextMenuTrigger asChild>\r\n                        <CollapsibleTrigger\r\n                            className={cn(\r\n                                \"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm transition-colors hover:bg-white/5\",\r\n                                activeSelected && \"bg-primary/10 text-primary\",\r\n                                isDragOver && \"bg-primary/20 ring-1 ring-primary/50\"\r\n                            )}\r\n                            style={{ paddingLeft: `${level * 16 + 8}px` }}\r\n                            onClick={() => onSelect?.(node)}\r\n                            onDoubleClick={() => handleAction(\"Abrir\")}\r\n                            draggable\r\n                            onDragStart={handleDragStart}\r\n                            onDragOver={handleDragOver}\r\n                            onDragLeave={handleDragLeave}\r\n                            onDrop={handleDrop}\r\n                        >\r\n                            <ChevronRight\r\n                                className={cn(\r\n                                    \"size-4 shrink-0 text-muted-foreground transition-transform duration-200\",\r\n                                    isOpen && \"rotate-90\",\r\n                                )}\r\n                            />\r\n                            <SelectionOverlay />\r\n                            <FileIcon className=\"size-4 shrink-0 text-cyan-500\" />\r\n                            <span className=\"truncate font-medium\">{nodeName}</span>\r\n                        </CollapsibleTrigger>\r\n                    </ContextMenuTrigger>\r\n                    <CollapsibleContent>\r\n                        {node.children.map((child) => (\r\n                            <FileTreeItem\r\n                                key={child.id}\r\n                                node={child}\r\n                                level={level + 1}\r\n                                onSelect={onSelect}\r\n                                selectedId={selectedId}\r\n                                isMultiSelect={isMultiSelect}\r\n                                getIsSelected={getIsSelected}\r\n                                onAction={onAction}\r\n                                onMove={onMove}\r\n                            />\r\n                        ))}\r\n                    </CollapsibleContent>\r\n                </Collapsible>\r\n                <MenuContent />\r\n            </ContextMenu>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <ContextMenu>\r\n            <ContextMenuTrigger asChild>\r\n                <button\r\n                    className={cn(\r\n                        \"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm transition-colors hover:bg-white/5\",\r\n                        activeSelected && \"bg-primary/10 text-primary\",\r\n                        isDragOver && \"bg-primary/20 ring-1 ring-primary/50\"\r\n                    )}\r\n                    style={{ paddingLeft: `${level * 16 + 28}px` }}\r\n                    onClick={() => onSelect?.(node)}\r\n                    onDoubleClick={() => handleAction(\"Abrir\")}\r\n                    draggable\r\n                    onDragStart={handleDragStart}\r\n                    onDragOver={handleDragOver}\r\n                    onDragLeave={handleDragLeave}\r\n                    onDrop={handleDrop}\r\n                >\r\n                    <SelectionOverlay />\r\n                    <FileIcon className=\"size-4 shrink-0 text-muted-foreground\" />\r\n                    <span className=\"truncate\">{nodeName}</span>\r\n                </button>\r\n            </ContextMenuTrigger>\r\n            <MenuContent />\r\n        </ContextMenu>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\layout\\AppLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\layout\\Header.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useState' is defined but never used.","line":1,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AlertTriangle' is defined but never used.","line":37,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":16},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'PAGE_TITLES'. Either include it or remove the dependency array.","line":87,"column":6,"nodeType":"ArrayExpression","endLine":87,"endColumn":36,"suggestions":[{"desc":"Update the dependencies array to be: [PAGE_TITLES, location.pathname, propTitle]","fix":{"range":[2400,2430],"text":"[PAGE_TITLES, location.pathname, propTitle]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":308,"column":167,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":308,"endColumn":170,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12745,12748],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12745,12748],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":312,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":312,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12932,12935],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12932,12935],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo, useState } from 'react';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useSync } from '@/contexts/SyncContext';\r\nimport { useMessages } from '@/hooks/useMessages';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { ModeToggle } from '@/components/ModeToggle';\r\nimport { isProtectedUser } from '@/utils/permissionHelpers';\r\nimport { getRoleStyle, getRoleLabel } from '@/utils/roleUtils';\r\nimport { cn } from '@/lib/utils';\r\nimport { isProtectedSignal, can } from '@/signals/authSignals';\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport {\r\n  LogOut,\r\n  Menu,\r\n  Wifi,\r\n  WifiOff,\r\n  Cloud,\r\n  CloudOff,\r\n  RefreshCw,\r\n  User,\r\n  Mail,\r\n  Ticket,\r\n  Key,\r\n  FileText,\r\n  CheckCircle,\r\n  ArrowRight,\r\n  Laptop,\r\n  Shield,\r\n  ShieldCheck,\r\n  QrCode,\r\n  AlertTriangle\r\n} from 'lucide-react';\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuSeparator,\r\n  DropdownMenuTrigger,\r\n} from \"@/components/ui/dropdown-menu\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport { QRScanner } from '@/components/auth/QRScanner';\r\n\r\ninterface HeaderProps {\r\n  onMenuClick: () => void;\r\n  title?: string;\r\n}\r\n\r\nexport function Header({ onMenuClick, title: propTitle }: HeaderProps) {\r\n  const { user, profile, logout } = useAuth();\r\n  const { isOnline, isSyncing, pendingChanges, syncNow } = useSync();\r\n  const { messages } = useMessages();\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n\r\n  // Normalize role for visual checks\r\n  const roleUpper = (profile?.role || '').toUpperCase();\r\n\r\n  const PAGE_TITLES: Record<string, string> = {\r\n    '/dashboard': 'Início',\r\n    '/time-clock': 'Registro de Ponto',\r\n    '/daily-report': 'Novo Relatório',\r\n    '/reports': 'Relatórios Diários',\r\n    '/time-records': 'Espelho de Ponto',\r\n    '/teams': 'Equipes',\r\n    '/employees': 'Funcionários',\r\n    '/functions': 'Funções',\r\n    '/users': 'Usuários',\r\n    '/settings': 'Configurações',\r\n    '/messages': 'Mensagens',\r\n  };\r\n\r\n  const title = useMemo(() => {\r\n    if (propTitle) return propTitle;\r\n    return PAGE_TITLES[location.pathname] || 'ORION - SYSTEM';\r\n  }, [location.pathname, propTitle]);\r\n\r\n  const displayName = profile?.fullName || user?.email?.split('@')[0] || 'Usuário';\r\n  const [isQRModalOpen, setIsQRModalOpen] = React.useState(false);\r\n\r\n  const unreadCount = useMemo(() => {\r\n    return messages.filter(msg => {\r\n      const isRecipient = msg.recipientId === profile?.id;\r\n      const canManageTickets = can('system_messages.manage') || isProtectedSignal.value;\r\n      const isAdminType = msg.recipientRole === 'ADMIN' || msg.type === 'PASSWORD_RESET';\r\n\r\n      return msg.status === 'PENDING' &&\r\n        msg.senderId !== profile?.id &&\r\n        msg.senderEmail !== user?.email && (\r\n          isRecipient ||\r\n          (canManageTickets && isAdminType)\r\n        );\r\n    }).length;\r\n  }, [messages, profile, user]);\r\n\r\n  // Lista de mensagens pendentes para exibir no popover\r\n  const pendingMessages = useMemo(() => {\r\n    return messages.filter(msg => {\r\n      const isRecipient = msg.recipientId === profile?.id;\r\n      const canManageTickets = can('system_messages.manage') || isProtectedSignal.value;\r\n      const isAdminType = msg.recipientRole === 'ADMIN' || msg.type === 'PASSWORD_RESET';\r\n\r\n      return msg.status === 'PENDING' &&\r\n        msg.senderId !== profile?.id &&\r\n        msg.senderEmail !== user?.email && (\r\n          isRecipient ||\r\n          (canManageTickets && isAdminType)\r\n        );\r\n    });\r\n  }, [messages, profile, user]);\r\n\r\n  return (\r\n    <header className=\"sticky top-0 z-40 w-full glass shadow-strong border-b border-white/5\">\r\n      <div className=\"flex h-16 items-center justify-between px-4\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"icon\"\r\n            onClick={onMenuClick}\r\n            className=\"text-secondary-foreground hover:bg-secondary/80\"\r\n          >\r\n            <Menu className=\"h-5 w-5\" />\r\n          </Button>\r\n          <div className=\"flex items-center gap-2\">\r\n            <div className=\"w-8 h-8 rounded-lg gradient-primary flex items-center justify-center shadow-glow\">\r\n              <span className=\"text-primary-foreground font-bold text-sm\">OP</span>\r\n            </div>\r\n            <h1 className=\"font-display text-lg font-bold text-secondary-foreground\">\r\n              {title}\r\n            </h1>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-2\">\r\n          <ModeToggle />\r\n\r\n          {/* QR Scanner */}\r\n          <Dialog open={isQRModalOpen} onOpenChange={setIsQRModalOpen}>\r\n            <DialogTrigger asChild>\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"text-secondary-foreground hover:bg-secondary/80\"\r\n                title=\"Escanear QR para Login\"\r\n              >\r\n                <QrCode className=\"h-5 w-5\" />\r\n              </Button>\r\n            </DialogTrigger>\r\n            <DialogContent className=\"sm:max-w-md bg-card border-white/10 glass-card\">\r\n              <DialogHeader>\r\n                <DialogTitle>Aprovar Acesso</DialogTitle>\r\n              </DialogHeader>\r\n              <QRScanner\r\n                onClose={() => setIsQRModalOpen(false)}\r\n                onSuccess={() => setIsQRModalOpen(false)}\r\n              />\r\n            </DialogContent>\r\n          </Dialog>\r\n\r\n          {/* Sync Status */}\r\n          <div className=\"flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-secondary/50\">\r\n            {isOnline ? (\r\n              <Wifi className=\"h-4 w-4 text-success\" />\r\n            ) : (\r\n              <WifiOff className=\"h-4 w-4 text-muted-foreground\" />\r\n            )}\r\n            <div className=\"relative flex items-center justify-center\">\r\n              {isSyncing ? (\r\n                <RefreshCw className=\"h-4 w-4 text-primary animate-spin\" />\r\n              ) : pendingChanges > 0 ? (\r\n                <>\r\n                  <CloudOff className=\"h-4 w-4 text-accent\" />\r\n                  <span className=\"absolute -top-1.5 -right-2 flex h-4 min-w-4 items-center justify-center rounded-full bg-red-500 px-1 text-[10px] font-bold text-white shadow-sm animate-in zoom-in duration-300\">\r\n                    +{pendingChanges}\r\n                  </span>\r\n                </>\r\n              ) : (\r\n                <Cloud className=\"h-4 w-4 text-success\" />\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Messages Popover */}\r\n          <Popover>\r\n            <PopoverTrigger asChild>\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"text-secondary-foreground hover:bg-secondary/80 relative\"\r\n                title=\"Mensagens\"\r\n              >\r\n                <Mail className=\"h-5 w-5\" />\r\n                {unreadCount > 0 && (\r\n                  <span className=\"absolute -top-0.5 -right-0.5 flex h-4 w-4 items-center justify-center rounded-full bg-destructive text-[10px] font-bold text-destructive-foreground animate-in zoom-in duration-300\">\r\n                    {unreadCount > 9 ? '9+' : unreadCount}\r\n                  </span>\r\n                )}\r\n              </Button>\r\n            </PopoverTrigger>\r\n            <PopoverContent align=\"end\" className=\"w-80 p-0\">\r\n              <div className=\"p-3 border-b bg-muted/50\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <h4 className=\"font-semibold text-sm flex items-center gap-2\">\r\n                    <Ticket className=\"w-4 h-4 text-primary\" />\r\n                    Central de Tickets\r\n                  </h4>\r\n                  {unreadCount > 0 && (\r\n                    <Badge variant=\"destructive\" className=\"text-xs\">\r\n                      {unreadCount} pendente{unreadCount > 1 ? 's' : ''}\r\n                    </Badge>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"max-h-[300px] overflow-y-auto\">\r\n                {pendingMessages.length === 0 ? (\r\n                  <div className=\"p-6 text-center text-sm text-muted-foreground\">\r\n                    <CheckCircle className=\"w-8 h-8 mx-auto mb-2 text-green-500\" />\r\n                    Nenhum ticket pendente\r\n                  </div>\r\n                ) : (\r\n                  pendingMessages.slice(0, 5).map((msg) => (\r\n                    <div\r\n                      key={msg.id}\r\n                      className=\"p-3 border-b last:border-0 hover:bg-muted/50 cursor-pointer transition-colors\"\r\n                      onClick={() => navigate('/messages')}\r\n                    >\r\n                      <div className=\"flex items-start gap-2\">\r\n                        <div className={`mt-1 ${msg.type === 'PASSWORD_RESET' ? 'text-yellow-500' : 'text-primary'}`}>\r\n                          {msg.type === 'PASSWORD_RESET' ? <Key className=\"w-4 h-4\" /> : <FileText className=\"w-4 h-4\" />}\r\n                        </div>\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <p className=\"text-sm font-medium truncate\">{msg.subject}</p>\r\n                          <p className=\"text-xs text-muted-foreground truncate\">\r\n                            {msg.sender?.full_name || msg.senderEmail || 'Anônimo'}\r\n                          </p>\r\n                          <p className=\"text-[10px] text-muted-foreground mt-1\">\r\n                            {new Date(msg.createdAt).toLocaleDateString('pt-BR')}\r\n                          </p>\r\n                        </div>\r\n                        <Badge variant=\"outline\" className=\"text-[10px] text-yellow-500 border-yellow-500\">\r\n                          Pendente\r\n                        </Badge>\r\n                      </div>\r\n                    </div>\r\n                  ))\r\n                )}\r\n              </div>\r\n\r\n              <div className=\"p-2 border-t bg-muted/30\">\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  className=\"w-full h-8 text-xs\"\r\n                  onClick={() => navigate('/messages')}\r\n                >\r\n                  Ver todos os tickets\r\n                  <ArrowRight className=\"w-3 h-3 ml-2\" />\r\n                </Button>\r\n              </div>\r\n            </PopoverContent>\r\n          </Popover>\r\n\r\n          {/* User Menu */}\r\n          <DropdownMenu>\r\n            <DropdownMenuTrigger asChild>\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"text-secondary-foreground hover:bg-secondary/80 overflow-hidden \"\r\n              >\r\n                {profile?.image ? (\r\n                  <img src={profile.image} alt={displayName} className=\"w-full h-full object-cover\" />\r\n                ) : (\r\n                  <User className=\"h-5 w-5\" />\r\n                )}\r\n              </Button>\r\n            </DropdownMenuTrigger>\r\n            <DropdownMenuContent align=\"end\" className=\"min-w-[220px] w-auto max-w-[320px]\">\r\n              <div className=\"px-3 py-3\">\r\n                <div className=\"flex items-center gap-3 mb-2\">\r\n                  <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center font-bold text-primary overflow-hidden border border-primary/20 shrink-0\">\r\n                    {profile?.image ? (\r\n                      <img src={profile.image} alt={displayName} className=\"w-full h-full object-cover\" />\r\n                    ) : (\r\n                      displayName.charAt(0).toUpperCase()\r\n                    )}\r\n                  </div>\r\n                  <div className=\"min-w-0\">\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                      <p className={cn(\r\n                        \"text-sm font-medium truncate\",\r\n                        // Dynamic Color by Role\r\n                        (roleUpper === 'SUPER_ADMIN_GOD' || roleUpper === 'SUPERADMINGOD') && \"text-[#ea580c] font-extrabold drop-shadow-[0_0_8px_rgba(234,88,12,0.4)]\",\r\n                        (roleUpper === 'SUPER_ADMIN' || roleUpper === 'SUPERADMIN') && \"text-[#f4a261] font-bold\",\r\n                        roleUpper === 'ADMIN' && \"text-[#4dabf7] font-bold\",\r\n                        roleUpper === 'TI_SOFTWARE' && \"text-[#00ff9c] font-bold font-mono tracking-tight\",\r\n                        (!['SUPER_ADMIN_GOD', 'SUPERADMINGOD', 'SUPER_ADMIN', 'SUPERADMIN', 'ADMIN', 'TI_SOFTWARE'].includes(roleUpper) && isProtectedUser(profile as any)) && \"text-orange-400 font-extrabold\"\r\n                      )}>\r\n                        {displayName}\r\n                      </p>\r\n                      {isProtectedUser(profile as any) && (roleUpper === 'SUPER_ADMIN_GOD' || roleUpper === 'SUPERADMINGOD') && (\r\n                        <ShieldCheck className=\"w-3 h-3 text-orange-500 shrink-0\" />\r\n                      )}\r\n                    </div>\r\n                    <p className=\"text-[10px] text-muted-foreground truncate\">{user?.email}</p>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"mt-2\">\r\n                  {/* Premium Badge Logic for Dropdown */}\r\n                  {(roleUpper === 'SUPER_ADMIN_GOD' || roleUpper === 'SUPERADMINGOD') ? (\r\n                    <div className=\"role-badge role-super-admin-god shadow-[0_0_20px_-5px_rgba(255,183,3,0.5)] scale-90 origin-left\">\r\n                      <span className=\"relative z-10\">Super Admin God</span>\r\n                      <span className=\"orb\"></span>\r\n                      <span className=\"orb\"></span>\r\n                      <span className=\"orb\"></span>\r\n                    </div>\r\n                  ) : (roleUpper === 'SUPER_ADMIN' || roleUpper === 'SUPERADMIN') ? (\r\n                    <div className=\"role-badge role-socio-diretor scale-90 origin-left\">\r\n                      <span className=\"flex items-center gap-1.5\">\r\n                        <ShieldCheck className=\"w-3 h-3\" />\r\n                        Sócio Diretor\r\n                      </span>\r\n                    </div>\r\n                  ) : roleUpper === 'ADMIN' ? (\r\n                    <div className=\"role-badge role-admin scale-90 origin-left\">\r\n                      <span className=\"flex items-center gap-1.5\">\r\n                        <Shield className=\"w-3 h-3\" />\r\n                        Admin\r\n                      </span>\r\n                    </div>\r\n                  ) : roleUpper === 'TI_SOFTWARE' ? (\r\n                    <div className=\"role-badge role-ti-software scale-90 origin-left\">\r\n                      <span className=\"flex items-center gap-1.5\">\r\n                        <Laptop className=\"w-3 h-3\" />\r\n                        TI-Software\r\n                      </span>\r\n                    </div>\r\n                  ) : (\r\n                    <span className={cn(\r\n                      \"inline-block px-2 py-0.5 rounded-full border text-[10px] font-bold uppercase tracking-tight transition-all\",\r\n                      getRoleStyle(profile?.role || 'worker')\r\n                    )}>\r\n                      {getRoleLabel(profile?.role || 'worker')}\r\n                    </span>\r\n                  )}\r\n                </div>\r\n              </div>\r\n              <DropdownMenuSeparator />\r\n              {pendingChanges > 0 && isOnline && (\r\n                <DropdownMenuItem onClick={syncNow} disabled={isSyncing}>\r\n                  <RefreshCw className={`mr-2 h-4 w-4 ${isSyncing ? 'animate-spin' : ''}`} />\r\n                  Sincronizar agora\r\n                </DropdownMenuItem>\r\n              )}\r\n              <DropdownMenuItem\r\n                onClick={logout}\r\n                className=\"text-destructive focus:bg-destructive/10\"\r\n                disabled={!isOnline}\r\n              >\r\n                <LogOut className=\"mr-2 h-4 w-4\" />\r\n                Sair {!isOnline && '(Offline)'}\r\n              </DropdownMenuItem>\r\n            </DropdownMenuContent>\r\n          </DropdownMenu>\r\n        </div>\r\n      </div>\r\n    </header>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\layout\\Sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\map\\CableConfigModal.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'selectedId'. Either include it or remove the dependency array.","line":69,"column":8,"nodeType":"ArrayExpression","endLine":69,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [isOpen, phases, selectedId]","fix":{"range":[2540,2556],"text":"[isOpen, phases, selectedId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Check, RotateCcw, Zap, Settings2 } from 'lucide-react';\r\nimport { cn } from \"@/lib/utils\";\r\n\r\n// Types\r\nexport interface PhaseConfig {\r\n    id: string;\r\n    name: string;\r\n    enabled: boolean;\r\n    color: [number, number, number]; // RGB\r\n    hexColor?: string; // Cache hex for easier editing\r\n    tension: number;\r\n    verticalOffset: number;\r\n    horizontalOffset: number;\r\n    relativeHeight: number; // Percentage\r\n    cableCount?: number; // 1, 2, 3, 4\r\n    bundleSpacing?: number; // in meters\r\n    width?: number; // Cable thickness\r\n    spacerInterval?: number; // in meters\r\n    spacerSize?: number; // scale multiplier for the frame\r\n    spacerThickness?: number; // thickness of the spacer frame itself\r\n    spacerColor?: [number, number, number]; // RGB\r\n    cableType?: string; // Specification name (e.g., CAA Grosbeak)\r\n}\r\n\r\ninterface CableConfigModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    phases: PhaseConfig[];\r\n    onUpdate: (phases: PhaseConfig[]) => void;\r\n    onRestoreDefaults: () => void;\r\n    readOnly?: boolean;\r\n}\r\n\r\nconst PRESET_COLORS = [\r\n    \"#cbd5e1\", // Alumínio Claro\r\n    \"#94a3b8\", // Aço Polido\r\n    \"#e2e8f0\", // Prata Brilhante\r\n    \"#475569\", // Aço Escuro\r\n    \"#FFFFFF\", // Branco/Reflexo\r\n    \"#00FFFF\", \"#0000FF\", \"#00FF00\", \"#FF0000\"\r\n];\r\n\r\nconst hexToRgb = (hex: string): [number, number, number] => {\r\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n    return result\r\n        ? [parseInt(result[1], 16), parseInt(result[2], 16), parseInt(result[3], 16)]\r\n        : [255, 255, 255];\r\n};\r\n\r\nconst rgbToHex = (r: number, g: number, b: number): string =>\r\n    \"#\" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();\r\n\r\nexport function CableConfigModal({ isOpen, onClose, phases, onUpdate, onRestoreDefaults, readOnly = false }: CableConfigModalProps) {\r\n    const [localPhases, setLocalPhases] = useState<PhaseConfig[]>([]);\r\n    const [selectedId, setSelectedId] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        if (isOpen) {\r\n            setLocalPhases([...phases]);\r\n            if (phases.length > 0 && !selectedId) {\r\n                setSelectedId(phases[0].id);\r\n            }\r\n        }\r\n    }, [isOpen, phases]);\r\n\r\n    const handleApply = () => {\r\n        onUpdate(localPhases);\r\n        onClose();\r\n    };\r\n\r\n    const updateLocalPhase = (id: string, updates: Partial<PhaseConfig>) => {\r\n        setLocalPhases(prev => prev.map(p => p.id === id ? { ...p, ...updates } : p));\r\n    };\r\n\r\n    const selectedPhase = localPhases.find(p => p.id === selectedId);\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={(open) => !open && onClose()}>\r\n            <DialogContent className=\"max-w-[820px] bg-black/95 border-white/5 p-0 overflow-hidden shadow-2xl rounded-[28px] border\">\r\n                <DialogHeader className=\"p-5 bg-linear-to-r from-cyan-950/20 to-transparent border-b border-white/5\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div>\r\n                            <DialogTitle className=\"text-xl font-black text-white tracking-tighter uppercase italic flex items-center gap-3\">\r\n                                <Zap className=\"w-5 h-5 text-cyan-500 fill-cyan-500/20\" />\r\n                                Configuração de Cabos\r\n                            </DialogTitle>\r\n                            <p className=\"text-neutral-500 text-[8px] font-black uppercase tracking-[0.3em] mt-0.5 ml-8\">Ajuste técnico de fases e feixes</p>\r\n                        </div>\r\n                    </div>\r\n                </DialogHeader>\r\n\r\n                <div className=\"flex h-[520px]\">\r\n                    <div className=\"w-[260px] border-r border-white/5 bg-black/20 p-4 space-y-2 overflow-y-auto no-scrollbar backdrop-blur-md\">\r\n                        <Label className=\"text-[9px] font-black text-white/40 uppercase tracking-[0.4em] pl-1 mb-4 block\">Matriz de Fases</Label>\r\n                        <div className=\"space-y-3\">\r\n                            {localPhases.map((phase) => (\r\n                                <button\r\n                                    key={phase.id}\r\n                                    onClick={() => setSelectedId(phase.id)}\r\n                                    className={cn(\r\n                                        \"w-full p-3 rounded-2xl flex items-center gap-3 transition-all duration-700 group relative overflow-hidden\",\r\n                                        selectedId === phase.id\r\n                                            ? \"bg-cyan-500 text-black shadow-[0_15px_40px_rgba(6,182,212,0.3)] scale-[1.02] border-transparent\"\r\n                                            : \"bg-white/2 border border-white/5 hover:bg-white/6 text-neutral-400 hover:text-white\"\r\n                                    )}\r\n                                >\r\n                                    {selectedId === phase.id && (\r\n                                        <div className=\"absolute inset-0 bg-linear-to-r from-white/20 to-transparent opacity-50 animate-pulse\" />\r\n                                    )}\r\n                                    <div\r\n                                        className={cn(\r\n                                            \"w-6 h-6 rounded-xl border-2 shadow-2xl transition-all duration-500 relative z-10\",\r\n                                            selectedId === phase.id ? \"border-black/30 scale-110\" : \"border-white/10\"\r\n                                        )}\r\n                                        style={{ backgroundColor: `rgb(${phase.color.join(',')})` }}\r\n                                    />\r\n                                    <div className=\"text-left flex-1 relative z-10\">\r\n                                        <div className=\"text-[13px] font-black uppercase tracking-tighter leading-none mb-0.5\">{phase.name}</div>\r\n                                        <div className={cn(\r\n                                            \"text-[9px] font-black uppercase tracking-widest opacity-60\",\r\n                                            selectedId === phase.id ? \"text-black\" : \"text-neutral-500\"\r\n                                        )}>\r\n                                            {phase.cableCount || 1} COND • {phase.verticalOffset}M\r\n                                        </div>\r\n                                    </div>\r\n                                    {selectedId === phase.id && (\r\n                                        <div className=\"absolute right-5 w-2 h-2 rounded-full bg-black shadow-[0_0_10px_rgba(0,0,0,0.5)]\" />\r\n                                    )}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Right Column: Settings */}\r\n                    <div className=\"flex-1 overflow-y-auto p-6 scrollbar-thin\">\r\n                        {selectedPhase ? (\r\n                            <div className=\"space-y-10 animate-in fade-in slide-in-from-right-4 duration-300\">\r\n                                <section className=\"space-y-4\">\r\n                                    <div className=\"flex items-center gap-2 text-cyan-400 opacity-80 mb-4\">\r\n                                        <Zap className=\"w-3.5 h-3.5\" />\r\n                                        <h3 className=\"text-[10px] font-black uppercase tracking-widest\">Informações Técnicas</h3>\r\n                                    </div>\r\n                                    <div className=\"space-y-2\">\r\n                                        <Label className=\"text-[9px] font-black text-neutral-500 uppercase tracking-widest pl-1\">Modelo/Tipo de Cabo (Spec)</Label>\r\n                                        <Input\r\n                                            value={selectedPhase.cableType || ''}\r\n                                            onChange={(e) => updateLocalPhase(selectedId!, { cableType: e.target.value })}\r\n                                            placeholder=\"Ex: CAA 636 kcmil Grosbeak\"\r\n                                            className=\"h-12 bg-white/5 border-white/5 rounded-2xl pl-4 font-black text-sm tracking-tight focus:ring-cyan-500/50 uppercase italic\"\r\n                                        />\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-2 text-cyan-400 opacity-60 mt-6 mb-2\">\r\n                                        <div className=\"w-1.5 h-1.5 rounded-full bg-cyan-500\" />\r\n                                        <h3 className=\"text-[9px] font-black uppercase tracking-widest\">Paleta de Identificação</h3>\r\n                                    </div>\r\n                                    <div className=\"flex flex-wrap gap-3\">\r\n                                        {PRESET_COLORS.map(color => (\r\n                                            <button\r\n                                                key={color}\r\n                                                onClick={() => updateLocalPhase(selectedPhase.id, { color: hexToRgb(color) })}\r\n                                                className={cn(\r\n                                                    \"w-10 h-10 rounded-full border-4 border-black/50 transition-all hover:scale-110 active:scale-95 shadow-xl flex items-center justify-center\",\r\n                                                    rgbToHex(...selectedPhase.color).toLowerCase() === color.toLowerCase()\r\n                                                        ? \"ring-2 ring-cyan-500 ring-offset-2 ring-offset-neutral-950 border-white/20\"\r\n                                                        : \"opacity-60 hover:opacity-100\"\r\n                                                )}\r\n                                                style={{ backgroundColor: color }}\r\n                                            >\r\n                                                {rgbToHex(...selectedPhase.color).toLowerCase() === color.toLowerCase() && (\r\n                                                    <Check className=\"w-4 h-4 text-black\" />\r\n                                                )}\r\n                                            </button>\r\n                                        ))}\r\n                                    </div>\r\n                                    <div className=\"mt-4 max-w-[200px] relative group px-2\">\r\n                                        <div className=\"absolute left-6 top-1/2 -translate-y-1/2 text-neutral-500 text-xs font-mono opacity-50\">#</div>\r\n                                        <Input\r\n                                            value={rgbToHex(...selectedPhase.color).replace('#', '')}\r\n                                            onChange={(e) => {\r\n                                                const hex = '#' + e.target.value.replace('#', '');\r\n                                                if (/^#?[0-9A-F]{6}$/i.test(hex)) {\r\n                                                    updateLocalPhase(selectedId!, { color: hexToRgb(hex) });\r\n                                                }\r\n                                            }}\r\n                                            className=\"h-10 bg-white/5 border-white/5 rounded-2xl pl-8 font-mono text-xs tracking-[0.2em] focus:ring-cyan-500/50 uppercase font-black\"\r\n                                        />\r\n                                    </div>\r\n                                </section>\r\n\r\n                                {/* Bundle & Spacers Configuration */}\r\n                                <section className=\"space-y-6 bg-white/3 p-8 rounded-[2.5rem] border border-white/5 backdrop-blur-sm relative overflow-hidden group\">\r\n                                    <div className=\"absolute top-0 right-0 w-32 h-32 bg-cyan-500/5 blur-3xl rounded-full translate-x-10 -translate-y-10 group-hover:bg-cyan-500/10 transition-all duration-1000\" />\r\n                                    <div className=\"flex items-center gap-3 text-cyan-400 mb-2 relative z-10\">\r\n                                        <div className=\"w-8 h-8 rounded-xl bg-cyan-500/10 flex items-center justify-center border border-cyan-500/20\">\r\n                                            <Zap className=\"w-4 h-4\" />\r\n                                        </div>\r\n                                        <h3 className=\"text-[11px] font-black uppercase tracking-[0.2em]\">Feixe & Espessura</h3>\r\n                                    </div>\r\n\r\n                                    <div className=\"grid grid-cols-2 gap-8 relative z-10\">\r\n                                        <div className=\"space-y-6\">\r\n                                            <div className=\"space-y-3\">\r\n                                                <Label className=\"text-[10px] font-black text-neutral-500 uppercase tracking-widest pl-1\">Cabos por Fase</Label>\r\n                                                <div className=\"flex bg-black/40 p-1.5 rounded-2xl border border-white/5 shadow-inner\">\r\n                                                    {[1, 2, 3, 4].map((num) => (\r\n                                                        <button\r\n                                                            key={num}\r\n                                                            onClick={() => !readOnly && updateLocalPhase(selectedPhase.id, { cableCount: num })}\r\n                                                            disabled={readOnly}\r\n                                                            className={cn(\r\n                                                                \"flex-1 py-3 px-1 rounded-xl font-black text-xs transition-all duration-300\",\r\n                                                                selectedPhase.cableCount === num\r\n                                                                    ? \"bg-cyan-500 text-black shadow-xl\"\r\n                                                                    : \"text-neutral-500 hover:text-white hover:bg-white/5\",\r\n                                                                readOnly && \"opacity-50 cursor-not-allowed\"\r\n                                                            )}\r\n                                                        >\r\n                                                            {num}\r\n                                                        </button>\r\n                                                    ))}\r\n                                                </div>\r\n                                            </div>\r\n                                            <div className=\"space-y-2\">\r\n                                                <Label className=\"text-[9px] font-black text-neutral-500 uppercase tracking-widest pl-1\">Espessura (m)</Label>\r\n                                                <Input\r\n                                                    type=\"number\"\r\n                                                    step=\"0.01\"\r\n                                                    value={selectedPhase.width || 0.15}\r\n                                                    onChange={(e) => updateLocalPhase(selectedId!, { width: parseFloat(e.target.value) || 0.15 })}\r\n                                                    className=\"h-10 bg-black/40 border-white/5 rounded-xl text-lg font-black tracking-tighter focus:ring-cyan-500/50 pl-4\"\r\n                                                />\r\n                                            </div>\r\n                                            <div className=\"space-y-2\">\r\n                                                <Label className=\"text-[9px] font-black text-cyan-500 uppercase tracking-widest pl-1\">Tensionamento (Tension)</Label>\r\n                                                <Input\r\n                                                    type=\"number\"\r\n                                                    step=\"0.01\"\r\n                                                    min=\"0.1\"\r\n                                                    max=\"5.0\"\r\n                                                    value={selectedPhase.tension || 1.0}\r\n                                                    onChange={(e) => updateLocalPhase(selectedId!, { tension: parseFloat(e.target.value) || 1.0 })}\r\n                                                    className=\"h-10 bg-cyan-500/10 border-cyan-500/20 rounded-xl text-lg font-black tracking-tighter focus:ring-cyan-500 shadow-[0_0_20px_rgba(6,182,212,0.1)] pl-4\"\r\n                                                />\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"space-y-6\">\r\n                                            <div className=\"space-y-3\">\r\n                                                <Label className=\"text-[10px] font-black text-neutral-500 uppercase tracking-widest pl-1\">Espaçamento Feixe (m)</Label>\r\n                                                <Input\r\n                                                    type=\"number\"\r\n                                                    step=\"0.05\"\r\n                                                    value={selectedPhase.bundleSpacing || 0.4}\r\n                                                    onChange={(e) => updateLocalPhase(selectedId!, { bundleSpacing: parseFloat(e.target.value) || 0.4 })}\r\n                                                    className=\"h-12 bg-black/40 border-white/5 rounded-2xl text-xl font-black tracking-tighter focus:ring-cyan-500/50 pl-4\"\r\n                                                />\r\n                                            </div>\r\n                                            \r\n                                        </div>\r\n                                    </div>\r\n                                </section>\r\n\r\n                                {/* Spacers Advanced Settings */}\r\n                                <section className=\"space-y-6 bg-white/5 p-6 rounded-3xl border border-white/5\">\r\n                                    <div className=\"flex items-center gap-2 text-cyan-400 opacity-80 mb-2\">\r\n                                        <Settings2 className=\"w-4 h-4\" />\r\n                                        <h3 className=\"text-xs font-black uppercase tracking-widest\">Ajuste dos Espaçadores</h3>\r\n                                    </div>\r\n                                    <div className=\"space-y-3\">\r\n                                                <Label className=\"text-[10px] font-black text-neutral-500 uppercase tracking-widest pl-1\">Intervalo Espaçadores (m)</Label>\r\n                                                <Input\r\n                                                    type=\"number\"\r\n                                                    step=\"5\"\r\n                                                    value={selectedPhase.spacerInterval || 0}\r\n                                                    onChange={(e) => updateLocalPhase(selectedId!, { spacerInterval: parseFloat(e.target.value) || 0 })}\r\n                                                    className=\"h-12 bg-black/40 border-white/5 rounded-2xl text-xl font-black tracking-tighter focus:ring-cyan-500/50 pl-4\"\r\n                                                />\r\n                                            </div>\r\n                                    <div className=\"grid grid-cols-2 gap-6\">\r\n                                        <div className=\"space-y-2\">\r\n                                            <Label className=\"text-[10px] font-black text-neutral-500 uppercase tracking-widest pl-1\">Escala do Frame (Size)</Label>\r\n                                            <Input\r\n                                                type=\"number\"\r\n                                                step=\"0.05\"\r\n                                                value={selectedPhase.spacerSize || 1.1}\r\n                                                onChange={(e) => updateLocalPhase(selectedId!, { spacerSize: parseFloat(e.target.value) || 1.1 })}\r\n                                                className=\"h-10 bg-black/40 border-white/10 rounded-xl text-lg font-black tracking-tight focus:ring-cyan-500/50\"\r\n                                                readOnly={readOnly}\r\n                                            />\r\n                                            <p className=\"text-[8px] text-neutral-500 font-bold uppercase tracking-tighter pl-1\">Aumenta o tamanho da moldura</p>\r\n                                        </div>\r\n                                        <div className=\"space-y-2\">\r\n                                            <Label className=\"text-[10px] font-black text-neutral-500 uppercase tracking-widest pl-1\">Espessura Material (m)</Label>\r\n                                            <Input\r\n                                                type=\"number\"\r\n                                                step=\"0.05\"\r\n                                                value={selectedPhase.spacerThickness || 0.2}\r\n                                                onChange={(e) => updateLocalPhase(selectedId!, { spacerThickness: parseFloat(e.target.value) || 0.2 })}\r\n                                                className=\"h-10 bg-black/40 border-white/10 rounded-xl text-lg font-black tracking-tight focus:ring-cyan-500/50\"\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"space-y-4\">\r\n                                        <Label className=\"text-[10px] font-black text-neutral-500 uppercase tracking-widest pl-1\">Cor do Espaçador</Label>\r\n                                        <div className=\"flex flex-wrap gap-2\">\r\n                                            {[\"#141414\", \"#404040\", \"#808080\", \"#C0C0C0\", \"#FF0000\", \"#FFFF00\"].map(color => (\r\n                                                <button\r\n                                                    key={color}\r\n                                                    onClick={() => updateLocalPhase(selectedPhase.id, { spacerColor: hexToRgb(color) })}\r\n                                                    className={cn(\r\n                                                        \"w-8 h-8 rounded-full border-2 border-black/50 transition-all hover:scale-110\",\r\n                                                        rgbToHex(...(selectedPhase.spacerColor || [20, 20, 20])).toLowerCase() === color.toLowerCase()\r\n                                                            ? \"ring-2 ring-cyan-500 ring-offset-1 ring-offset-neutral-900\"\r\n                                                            : \"opacity-60\"\r\n                                                    )}\r\n                                                    style={{ backgroundColor: color }}\r\n                                                />\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n                                </section>\r\n\r\n                                {/* Position Offsets */}\r\n                                <section className=\"space-y-6\">\r\n                                    <div className=\"flex items-center gap-2 text-cyan-400 opacity-80 mb-4\">\r\n                                        <RotateCcw className=\"w-4 h-4 scale-x-[-1]\" />\r\n                                        <h3 className=\"text-xs font-black uppercase tracking-widest\">Posição</h3>\r\n                                    </div>\r\n\r\n                                    <div className=\"grid grid-cols-2 gap-6\">\r\n                                        <div className=\"space-y-2\">\r\n                                            <Label className=\"text-[10px] font-black text-neutral-500 uppercase tracking-widest pl-1\">Offset Horizontal (m)</Label>\r\n                                            <Input\r\n                                                type=\"number\"\r\n                                                value={selectedPhase.horizontalOffset}\r\n                                                onChange={(e) => updateLocalPhase(selectedId!, { horizontalOffset: parseFloat(e.target.value) || 0 })}\r\n                                                className=\"h-14 bg-white/5 border-white/10 rounded-2xl text-lg font-black tracking-tight focus:ring-cyan-500/50\"\r\n                                            />\r\n                                        </div>\r\n                                        <div className=\"space-y-2\">\r\n                                            <Label className=\"text-[10px] font-black text-neutral-500 uppercase tracking-widest pl-1\">Offset Vertical (m)</Label>\r\n                                            <Input\r\n                                                type=\"number\"\r\n                                                value={selectedPhase.verticalOffset}\r\n                                                onChange={(e) => updateLocalPhase(selectedId!, { verticalOffset: parseFloat(e.target.value) || 0 })}\r\n                                                className=\"h-14 bg-white/5 border-white/10 rounded-2xl text-lg font-black tracking-tight focus:ring-cyan-500/50\"\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"space-y-2\">\r\n                                        <Label className=\"text-[10px] font-black text-neutral-500 uppercase tracking-widest pl-1\">Altura Relativa (%)</Label>\r\n                                        <Input\r\n                                            type=\"number\"\r\n                                            value={selectedPhase.relativeHeight}\r\n                                            onChange={(e) => updateLocalPhase(selectedId!, { relativeHeight: parseFloat(e.target.value) || 0 })}\r\n                                            className=\"h-14 bg-white/5 border-white/10 rounded-2xl text-lg font-black tracking-tight focus:ring-cyan-500/50\"\r\n                                        />\r\n                                    </div>\r\n                                </section>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"h-full flex flex-col items-center justify-center text-neutral-600 space-y-4\">\r\n                                <Zap className=\"w-12 h-12 opacity-10\" />\r\n                                <p className=\"text-xs font-black uppercase tracking-widest\">Selecione uma fase para editar</p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Footer */}\r\n                <div className=\"p-4 bg-black border-t border-white/5 flex items-center justify-between\">\r\n                    <Button\r\n                        variant=\"ghost\"\r\n                        onClick={onRestoreDefaults}\r\n                        disabled={readOnly}\r\n                        className={cn(\r\n                            \"text-[9px] font-black uppercase tracking-widest text-neutral-500 hover:text-white hover:bg-white/5 px-3 h-9\",\r\n                            readOnly && \"opacity-20 cursor-not-allowed\"\r\n                        )}\r\n                    >\r\n                        Restaurar Padrão\r\n                    </Button>\r\n                    <div className=\"flex gap-2\">\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            onClick={onClose}\r\n                            className=\"bg-white/5 text-[10px] font-black uppercase tracking-widest hover:bg-white/10 px-4 h-10 rounded-xl\"\r\n                        >\r\n                            Cancelar\r\n                        </Button>\r\n                        <Button\r\n                            onClick={handleApply}\r\n                            disabled={readOnly}\r\n                            className={cn(\r\n                                \"bg-cyan-500 text-black hover:bg-cyan-400 text-[10px] font-black uppercase tracking-widest px-6 h-10 rounded-xl shadow-lg shadow-cyan-500/20 gap-2\",\r\n                                readOnly && \"opacity-20 grayscale\"\r\n                            )}\r\n                        >\r\n                            Aplicar Configurações\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\map\\ExcelDataUploader.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[422,425],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[422,425],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[868,871],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[868,871],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1095,1098],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1095,1098],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2105,2108],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2105,2108],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2992,2995],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2992,2995],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4545,4548],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4545,4548],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport React, { useRef, useState } from 'react';\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { FileSpreadsheet, Loader2 } from \"lucide-react\";\r\nimport * as XLSX from 'xlsx';\r\nimport { useToast } from \"@/hooks/use-toast\";\r\n\r\ninterface TowerData {\r\n    name: string;\r\n    coordinates: {\r\n        lat: number;\r\n        lng: number;\r\n        altitude: number;\r\n    };\r\n    isHidden: boolean;\r\n    properties?: any;\r\n}\r\n\r\ninterface ConnectionData {\r\n    from: string;\r\n    to: string;\r\n}\r\n\r\ninterface ExcelDataUploaderProps {\r\n    onLoad: (towers: TowerData[], connections: ConnectionData[]) => void;\r\n}\r\n\r\nexport function ExcelDataUploader({ onLoad }: ExcelDataUploaderProps) {\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n    const [loading, setLoading] = useState(false);\r\n    const { toast } = useToast();\r\n\r\n    const parseNumber = (val: any) => {\r\n        if (typeof val === 'number') return val;\r\n        if (typeof val === 'string') {\r\n            return parseFloat(val.replace(',', '.'));\r\n        }\r\n        return 0;\r\n    };\r\n\r\n    const parseBoolean = (val: any) => {\r\n        if (typeof val === 'boolean') return val;\r\n        if (typeof val === 'string') {\r\n            const lower = val.toLowerCase().trim();\r\n            return lower === 'true' || lower === 'verdadeiro' || lower === '1' || lower === 'yes';\r\n        }\r\n        return false;\r\n    };\r\n\r\n    const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        setLoading(true);\r\n\r\n        const reader = new FileReader();\r\n        reader.onload = (evt) => {\r\n            try {\r\n                const bstr = evt.target?.result;\r\n                const wb = XLSX.read(bstr, { type: 'binary' });\r\n\r\n                let foundTowers: TowerData[] = [];\r\n                let foundConnections: ConnectionData[] = [];\r\n\r\n                // Iterate over all sheets to find data\r\n                wb.SheetNames.forEach(sheetName => {\r\n                    const ws = wb.Sheets[sheetName];\r\n                    const data: any[] = XLSX.utils.sheet_to_json(ws);\r\n\r\n                    if (data.length === 0) return;\r\n\r\n                    const firstRow = data[0];\r\n                    const keys = Object.keys(firstRow).map(k => k.toLowerCase());\r\n\r\n                    console.log(`📄 Checking Sheet: ${sheetName}`, keys);\r\n\r\n                    // Check if it's a TOWER sheet (needs coordinates)\r\n                    // Looking for: x_coordinate, y_coordinate OR lat, lng\r\n                    const hasCoords = (keys.includes('x_coordinate') && keys.includes('y_coordinate')) ||\r\n                        (keys.includes('lat') && keys.includes('lng')) ||\r\n                        (keys.includes('latitude') && keys.includes('longitude'));\r\n\r\n                    if (hasCoords) {\r\n                        console.log(`✅ Found Tower Data in ${sheetName}`);\r\n                        foundTowers = data.map((row: any) => {\r\n                            // Map X/Y to Lng/Lat\r\n                            // X = Longitude, Y = Latitude\r\n                            const lng = parseNumber(row.x_coordinate || row.lng || row.longitude);\r\n                            const lat = parseNumber(row.y_coordinate || row.lat || row.latitude);\r\n                            const alt = parseNumber(row.object_height || row.object_elevation || row.altitude || row.height || 0);\r\n                            const name = String(row.object_Id || row.name || row.id || `Tower-${Math.random()}`);\r\n                            const isHidden = parseBoolean(row.isHidden || row.hidden || \"false\");\r\n\r\n                            return {\r\n                                name,\r\n                                coordinates: { lat, lng, altitude: alt },\r\n                                isHidden,\r\n                                properties: row\r\n                            };\r\n                        }).filter(t => !isNaN(t.coordinates.lat) && !isNaN(t.coordinates.lng));\r\n                    }\r\n\r\n                    // Check if it's a CONNECTION sheet\r\n                    // Looking for: from_tower_id, to_tower_id\r\n                    const hasConnections = (keys.includes('from_tower_id') && keys.includes('to_tower_id')) ||\r\n                        (keys.includes('from') && keys.includes('to'));\r\n\r\n                    if (hasConnections) {\r\n                        console.log(`✅ Found Connections in ${sheetName}`);\r\n                        foundConnections = data.map((row: any) => ({\r\n                            from: String(row.from_tower_id || row.from || row.From || \"\"),\r\n                            to: String(row.to_tower_id || row.to || row.To || \"\")\r\n                        })).filter(c => c.from && c.to);\r\n                    }\r\n                });\r\n\r\n                if (foundTowers.length > 0) {\r\n                    onLoad(foundTowers, foundConnections);\r\n                    toast({\r\n                        title: \"Projeto Importado\",\r\n                        description: `${foundTowers.length} torres e ${foundConnections.length} conexões carregadas.`,\r\n                    });\r\n                } else {\r\n                    toast({\r\n                        title: \"Erro na Importação\",\r\n                        description: \"Não foi possível encontrar colunas de coordenadas (x_coordinate/y_coordinate) no Excel.\",\r\n                        variant: \"destructive\"\r\n                    });\r\n                }\r\n\r\n            } catch (err) {\r\n                console.error(\"Erro ao ler Excel:\", err);\r\n                toast({\r\n                    title: \"Erro ao ler arquivo\",\r\n                    description: \"Certifique-se que é um arquivo .xlsx válido.\",\r\n                    variant: \"destructive\"\r\n                });\r\n            } finally {\r\n                setLoading(false);\r\n                if (fileInputRef.current) fileInputRef.current.value = \"\";\r\n            }\r\n        };\r\n        reader.readAsBinaryString(file);\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <input\r\n                type=\"file\"\r\n                accept=\".xlsx, .xls, .csv\"\r\n                ref={fileInputRef}\r\n                style={{ display: 'none' }}\r\n                onChange={handleFileChange}\r\n            />\r\n            <Button\r\n                variant=\"outline\"\r\n                disabled={loading}\r\n                className=\"gap-2 bg-blue-950/30 border-blue-900/50 hover:bg-blue-900/50 text-blue-400\"\r\n                onClick={() => fileInputRef.current?.click()}\r\n            >\r\n                {loading ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <FileSpreadsheet className=\"w-4 h-4\" />}\r\n                Importar Projeto (Excel)\r\n            </Button>\r\n        </>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\map\\TowerDetailsModals.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Hash' is defined but never used.","line":10,"column":51,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Card' is defined but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[470,473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[470,473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { MapPin, Navigation, Info, Layers, Boxes, Hash, Ruler } from \"lucide-react\";\r\nimport { Card } from \"@/components/ui/card\";\r\n\r\ninterface TowerDetailsModalsProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    tower: any | null;\r\n}\r\n\r\nexport function TowerDetailsModals({ isOpen, onClose, tower }: TowerDetailsModalsProps) {\r\n    console.log(\"TowerDetailsModals Render - isOpen:\", isOpen, \"Tower:\", tower?.name);\r\n    if (!tower) return null;\r\n\r\n    const handleNavigate = () => {\r\n        const { lat, lng } = tower.coordinates;\r\n        const url = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;\r\n        window.open(url, '_blank');\r\n    };\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={onClose}>\r\n            <DialogContent className=\"sm:max-w-[360px] bg-black/95 border-white/5 backdrop-blur-2xl text-white p-0 overflow-hidden rounded-3xl shadow-2xl border\">\r\n                {/* Header Decoration - Premium OrioN Style */}\r\n                <div className=\"h-28 bg-linear-to-br from-emerald-500/20 via-black to-black relative flex items-end p-5 border-b border-white/5 overflow-hidden\">\r\n                    <div className=\"absolute -top-10 -right-10 w-40 h-40 bg-emerald-500/10 blur-[80px] rounded-full animate-pulse\" />\r\n                    <div className=\"absolute top-4 right-4 flex gap-2\">\r\n                        <Badge variant=\"outline\" className=\"bg-emerald-500/10 text-emerald-400 border-emerald-500/20 font-black text-[7px] uppercase tracking-widest px-1.5 py-0.5 rounded-full\">\r\n                            TÉCNICO\r\n                        </Badge>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-3 relative z-10\">\r\n                        <div className=\"w-10 h-10 bg-emerald-500 rounded-xl flex items-center justify-center shadow-[0_10px_30px_rgba(16,185,129,0.3)] border border-white/10\">\r\n                            <Boxes className=\"w-5 h-5 text-black\" />\r\n                        </div>\r\n                        <div>\r\n                            <DialogHeader>\r\n                                <DialogTitle className=\"text-xl font-black italic tracking-tighter text-white uppercase leading-none\">\r\n                                    {tower.name}\r\n                                </DialogTitle>\r\n                            </DialogHeader>\r\n                            <div className=\"flex items-center gap-2 mt-2\">\r\n                                <span className=\"bg-white/10 text-[9px] font-black uppercase tracking-[0.2em] px-2 py-0.5 rounded-md text-emerald-400 border border-white/5\">\r\n                                    ESTRUTURA #{tower.id?.slice(0, 6).toUpperCase() || \"NEW\"}\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"p-6 space-y-6\">\r\n                    {/* Main Stats Grid */}\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div className=\"bg-white/5 border border-white/5 p-4 rounded-2xl group hover:bg-white/10 transition-all duration-500\">\r\n                            <h4 className=\"text-[9px] text-neutral-500 font-black uppercase tracking-widest mb-1 flex items-center gap-2\">\r\n                                <Ruler className=\"w-3 h-3 text-emerald-500\" /> Altitude\r\n                            </h4>\r\n                            <p className=\"text-xl font-black text-white italic tracking-tighter\">\r\n                                {Number(tower.coordinates.altitude).toFixed(2)}<span className=\"text-[10px] not-italic ml-1 text-neutral-500\">M</span>\r\n                            </p>\r\n                        </div>\r\n                        <div className=\"bg-white/5 border border-white/5 p-4 rounded-2xl group hover:bg-white/10 transition-all duration-500\">\r\n                            <h4 className=\"text-[9px] text-neutral-500 font-black uppercase tracking-widest mb-1 flex items-center gap-2\">\r\n                                <Layers className=\"w-3 h-3 text-emerald-500\" /> Categoria\r\n                            </h4>\r\n                            <p className=\"text-xl font-black text-white italic tracking-tighter uppercase\">\r\n                                {tower.type?.split(' ')[0] || \"TIPO\"}\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Coordinates Section */}\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"flex items-center justify-between px-1\">\r\n                            <h4 className=\"text-[10px] text-neutral-500 font-black uppercase tracking-[0.3em]\">Geolocalização</h4>\r\n                            <MapPin className=\"w-3 h-3 text-emerald-500\" />\r\n                        </div>\r\n                        <div className=\"bg-black/40 rounded-2xl p-1.5 border border-white/5 space-y-1\">\r\n                            {[\r\n                                { label: \"Latitude\", val: tower.coordinates.lat.toFixed(7) },\r\n                                { label: \"Longitude\", val: tower.coordinates.lng.toFixed(7) }\r\n                            ].map((coord, idx) => (\r\n                                <div key={idx} className=\"flex justify-between items-center bg-white/5 hover:bg-white/10 p-3 rounded-xl transition-all\">\r\n                                    <span className=\"text-[9px] text-neutral-400 font-black uppercase tracking-widest\">{coord.label}</span>\r\n                                    <span className=\"text-xs font-black font-mono text-emerald-400 tracking-tight\">{coord.val}</span>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Action Button - Ultra Premium */}\r\n                    <Button\r\n                        onClick={handleNavigate}\r\n                        className=\"w-full h-12 bg-emerald-500 hover:bg-emerald-400 text-black font-black text-[9px] uppercase tracking-widest rounded-xl shadow-[0_15px_30px_rgba(16,185,129,0.2)] transition-all hover:scale-[1.02] active:scale-95 group overflow-hidden relative\"\r\n                    >\r\n                        <div className=\"absolute inset-0 bg-white/20 translate-y-20 group-hover:translate-y-0 transition-transform duration-500\" />\r\n                        <span className=\"relative z-10 flex items-center gap-2\">\r\n                            <Navigation className=\"w-4 h-4 group-hover:rotate-12 transition-transform\" />\r\n                            GPS: NAVEGADOR\r\n                        </span>\r\n                    </Button>\r\n\r\n                    <div className=\"flex items-center justify-center gap-2 text-neutral-600 text-[9px] font-black uppercase tracking-widest pt-2\">\r\n                        <Info className=\"w-3 h-3 text-emerald-500/50\" /> Sincronizado via OrioN Cloud Layer\r\n                    </div>\r\n                </div>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\map\\cable-config-modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\map\\canvas-cable-layer.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Point3D' is defined but never used.","line":3,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[232,235],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[232,235],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[259,262],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[259,262],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1542,1545],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1542,1545],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3214,3217],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3214,3217],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6022,6025],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6022,6025],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'cableColor'. Either include it or remove the dependency array.","line":213,"column":8,"nodeType":"ArrayExpression","endLine":213,"endColumn":48,"suggestions":[{"desc":"Update the dependencies array to be: [map, cableSegments, hiddenPlacemarkIds, cableColor]","fix":{"range":[8482,8522],"text":"[map, cableSegments, hiddenPlacemarkIds, cableColor]"}}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useRef } from 'react';\r\nimport { useMap } from 'react-map-gl/mapbox';\r\nimport { CatenaryCalculator, Point3D } from '@/services/catenary-calculator';\r\n\r\ninterface CanvasCableLayerProps {\r\n    projectSpans: any[];\r\n    visibleTowers: any[];\r\n    cableColor?: string;\r\n    hiddenPlacemarkIds?: Set<string>;\r\n    projectId?: string;\r\n}\r\n\r\nconst normalizeName = (name: string) => (name || '').trim().toUpperCase();\r\n\r\nexport function CanvasCableLayer({\r\n    projectSpans,\r\n    visibleTowers,\r\n    cableColor = '#0ea5e9',\r\n    hiddenPlacemarkIds = new Set(),\r\n    projectId\r\n}: CanvasCableLayerProps) {\r\n    const { current: map } = useMap();\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n\r\n    // 1. Pre-calculate Cable Segments (Geometry + Color) only when data changes\r\n    const cableSegments = React.useMemo(() => {\r\n        if (!projectSpans.length) return [];\r\n\r\n        console.log(`🔌 [CanvasCableLayer] Processing ${projectSpans.length} spans. Towers available: ${visibleTowers.length}`);\r\n\r\n        // Create Lookup Map\r\n        const towerMap = new Map();\r\n        const allTowerNames: string[] = [];\r\n\r\n        if (visibleTowers.length > 0) {\r\n            visibleTowers.forEach(t => {\r\n                const nName = normalizeName(t.name);\r\n                if (nName) {\r\n                    towerMap.set(nName, t);\r\n                    allTowerNames.push(nName);\r\n                }\r\n                if (t.id) towerMap.set(t.id.toString(), t);\r\n            });\r\n        }\r\n\r\n        const segments: any[] = [];\r\n        let matchCount = 0;\r\n        let directGeoCount = 0;\r\n\r\n        projectSpans.forEach(span => {\r\n            const startIdOriginal = span.tower_start_id?.toString() || '';\r\n            const endIdOriginal = span.tower_end_id?.toString() || '';\r\n            const searchStart = normalizeName(startIdOriginal);\r\n            const searchEnd = normalizeName(endIdOriginal);\r\n\r\n            let t1 = towerMap.get(searchStart);\r\n            let t2 = towerMap.get(searchEnd);\r\n\r\n            // ... fallback logic similar to before but cleaner\r\n            if (!t1 || !t2) {\r\n                // Simplified fallback for search\r\n                t1 = t1 || allTowerNames.find(name => name.includes(searchStart) || searchStart.includes(name)) ? towerMap.get(allTowerNames.find(name => name.includes(searchStart) || searchStart.includes(name))) : null;\r\n                t2 = t2 || allTowerNames.find(name => name.includes(searchEnd) || searchEnd.includes(name)) ? towerMap.get(allTowerNames.find(name => name.includes(searchEnd) || searchEnd.includes(name))) : null;\r\n            }\r\n\r\n            // CHECK HIDING\r\n            const tProjId = span.project_id || projectId;\r\n            const hKeyAB = `${tProjId}:::${searchStart}:::${searchEnd}`;\r\n            const hKeyBA = `${tProjId}:::${searchEnd}:::${searchStart}`;\r\n\r\n            if (hiddenPlacemarkIds.has(hKeyAB) || hiddenPlacemarkIds.has(hKeyBA)) {\r\n                return;\r\n            }\r\n\r\n            // Priority 1: Use direct Geometry from DB (imported from KML)\r\n            if (span.geometry && span.geometry.type === 'LineString') {\r\n                const points3D = span.geometry.coordinates.map((c: any) => ({\r\n                    x: c[0],\r\n                    y: c[1],\r\n                    z: c[2] || 0\r\n                }));\r\n\r\n                segments.push({\r\n                    id: span.id,\r\n                    color: span.cable_color || cableColor,\r\n                    points3D\r\n                });\r\n                directGeoCount++;\r\n                return;\r\n            }\r\n\r\n            // Priority 2: Recalculate Catenary (requires towers)\r\n            if (!t1 || !t2) return;\r\n            matchCount++;\r\n\r\n            const phases = Number(span.cable_phases) || 1;\r\n            const spacing = Number(span.cable_spacing) || 0.5;\r\n            const constantC = Number(span.catenary_constant) || 1200;\r\n\r\n            const hStart = span.height_start ? Number(span.height_start) : (t1.towerHeight || 30);\r\n            const hEnd = span.height_end ? Number(span.height_end) : (t2.towerHeight || 30);\r\n            const z1 = Number(t1.elevation ?? t1.coordinates.alt ?? 0);\r\n            const z2 = Number(t2.elevation ?? t2.coordinates.alt ?? 0);\r\n\r\n            const p1Base = { x: t1.coordinates.lng, y: t1.coordinates.lat, z: z1 + hStart };\r\n            const p2Base = { x: t2.coordinates.lng, y: t2.coordinates.lat, z: z2 + hEnd };\r\n\r\n            const dx = p2Base.x - p1Base.x;\r\n            const dy = p2Base.y - p1Base.y;\r\n            const len = Math.sqrt(dx * dx + dy * dy);\r\n            const nx = len > 0 ? -dy / len : 0;\r\n            const ny = len > 0 ? dx / len : 0;\r\n\r\n            for (let i = 0; i < phases; i++) {\r\n                const offsetMultiplier = i - (phases - 1) / 2;\r\n                const offsetLng = nx * 0.00001 * spacing * offsetMultiplier;\r\n                const offsetLat = ny * 0.00001 * spacing * offsetMultiplier;\r\n\r\n                const oP1 = { ...p1Base, x: p1Base.x + offsetLng, y: p1Base.y + offsetLat };\r\n                const oP2 = { ...p2Base, x: p2Base.x + offsetLng, y: p2Base.y + offsetLat };\r\n                const points3D = CatenaryCalculator.generateCatenaryPoints(oP1, oP2, constantC, 25);\r\n\r\n                segments.push({\r\n                    id: `${span.id}-p${i}`,\r\n                    color: span.cable_color || cableColor,\r\n                    points3D\r\n                });\r\n            }\r\n        });\r\n\r\n        console.log(`✅ [CanvasCableLayer] Generated ${segments.length} segments (Direct: ${directGeoCount}, Match: ${matchCount}).`);\r\n        return segments;\r\n    }, [projectSpans, visibleTowers, cableColor, hiddenPlacemarkIds, projectId]);\r\n\r\n    // 2. Render Loop (Fast)\r\n    useEffect(() => {\r\n        if (!map || !canvasRef.current) return;\r\n\r\n        const canvas = canvasRef.current;\r\n        const ctx = canvas.getContext('2d');\r\n        if (!ctx) return;\r\n\r\n        const render = () => {\r\n            const nativeMap = (map as any).getMap?.() || map;\r\n            if (!nativeMap || !nativeMap.project) return;\r\n\r\n            const container = nativeMap.getCanvasContainer();\r\n            if (!container) return;\r\n\r\n            const dpr = window.devicePixelRatio || 1;\r\n            if (canvas.width !== container.offsetWidth * dpr || canvas.height !== container.offsetHeight * dpr) {\r\n                canvas.width = container.offsetWidth * dpr;\r\n                canvas.height = container.offsetHeight * dpr;\r\n                ctx.scale(dpr, dpr);\r\n            }\r\n\r\n            ctx.clearRect(0, 0, canvas.width / dpr, canvas.height / dpr);\r\n\r\n            if (!cableSegments.length) return;\r\n\r\n            ctx.lineCap = 'round';\r\n            ctx.lineJoin = 'round';\r\n\r\n            let debugOnce = false;\r\n\r\n            cableSegments.forEach(seg => {\r\n                if (hiddenPlacemarkIds.has(seg.compositeId)) return;\r\n\r\n                ctx.beginPath();\r\n                let isFirst = true;\r\n                let isValid = false;\r\n\r\n                for (const p of seg.points3D) {\r\n                    const pos = nativeMap.project([p.x, p.y, p.z]);\r\n                    if (pos) {\r\n                        if (isFirst) {\r\n                            ctx.moveTo(pos.x, pos.y);\r\n                            isFirst = false;\r\n                        } else {\r\n                            ctx.lineTo(pos.x, pos.y);\r\n                        }\r\n                        isValid = true;\r\n\r\n                        if (!debugOnce && pos.x > 0 && pos.x < canvas.width / dpr && pos.y > 0 && pos.y < canvas.height / dpr) {\r\n                            console.log(`✏️ [CanvasCableLayer] Drawing segment ${seg.id} at:`, pos);\r\n                            debugOnce = true;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (isValid) {\r\n                    ctx.shadowBlur = 4;\r\n                    ctx.shadowColor = seg.color || cableColor;\r\n                    ctx.lineWidth = 3;\r\n                    ctx.strokeStyle = seg.color || cableColor;\r\n                    ctx.stroke();\r\n                }\r\n            });\r\n\r\n            nativeMap.triggerRepaint();\r\n        };\r\n\r\n        map.on('render', render);\r\n        map.on('move', render);\r\n        map.on('moveend', render);\r\n        render();\r\n\r\n        return () => {\r\n            map.off('render', render);\r\n            map.off('move', render);\r\n            map.off('moveend', render);\r\n        };\r\n    }, [map, cableSegments, hiddenPlacemarkIds]);\r\n\r\n    return (\r\n        <canvas\r\n            ref={canvasRef}\r\n            style={{\r\n                position: 'absolute',\r\n                top: 0,\r\n                left: 0,\r\n                pointerEvents: 'none',\r\n                width: '100%',\r\n                height: '100%',\r\n                zIndex: 9999\r\n            }}\r\n        />\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\map\\csv-uploader.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1124,1127],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1124,1127],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":168,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":168,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":174,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7208,7211],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7208,7211],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":187,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7825,7828],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7825,7828],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":197,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8149,8152],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8149,8152],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":209,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":209,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8657,8660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8657,8660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":211,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":211,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8760,8763],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8760,8763],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":334,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":334,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16184,16187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16184,16187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'k' is defined but never used.","line":391,"column":69,"nodeType":null,"messageId":"unusedVar","endLine":391,"endColumn":70},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":407,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":407,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20065,20068],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20065,20068],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":417,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":417,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20390,20393],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20390,20393],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef } from 'react'\r\nimport { Button } from '@/components/ui/button'\r\nimport { FileSpreadsheet, Loader2, ChevronDown } from 'lucide-react'\r\nimport { useToast } from '@/hooks/use-toast'\r\nimport { useAuth } from '@/contexts/AuthContext'\r\nimport { useProjects } from '@/hooks/useProjects'\r\nimport { db } from '@/integrations/database';\r\nimport { cn } from '@/lib/utils'\r\nimport * as XLSX from 'xlsx'\r\nimport {\r\n    Popover,\r\n    PopoverContent,\r\n    PopoverTrigger,\r\n} from '@/components/ui/popover'\r\nimport { utmToLatLng, parseUTMZone } from '@/lib/geo-utils'\r\n\r\ninterface CSVUploaderProps {\r\n    projectId?: string\r\n    onUploadSuccess?: () => void\r\n}\r\n\r\ninterface TowerRow {\r\n    object_seq: number\r\n    object_id: string\r\n    tower_type: string\r\n    object_height: number\r\n    go_forward: number\r\n    deflection: string\r\n    object_elevation: number\r\n    fuso_object: string\r\n    x_coordinate: number\r\n    y_coordinate: number\r\n    fix_conductor: number\r\n    fix_pararaio?: number\r\n    tipificacao_estrutura?: string\r\n    is_hidden?: boolean\r\n    distance?: number\r\n    weight?: number\r\n    metadata?: any\r\n}\r\n\r\nexport function CSVUploader({ projectId: externalProjectId, onUploadSuccess }: CSVUploaderProps) {\r\n    const [loading, setLoading] = useState(false)\r\n    const [isOpen, setIsOpen] = useState(false)\r\n    const [selectedProjectId, setSelectedProjectId] = useState<string | null>(externalProjectId || null)\r\n    const [defaultFuso, setDefaultFuso] = useState<string>('23S')\r\n    const inputRef = useRef<HTMLInputElement>(null)\r\n    const { toast } = useToast()\r\n    const { profile } = useAuth()\r\n    const { projects } = useProjects()\r\n\r\n    const getNumericId = (name: string) => {\r\n        const upper = (name || '').trim().toUpperCase();\r\n        // Support suffixes like 1/1A, 1/1B\r\n        // Logic: (Structure * 1000 + Tower) * 10 + SuffixWeight\r\n        const parts = upper.match(/(\\d+)\\/(\\d+)([A-Z])?/);\r\n        if (parts) {\r\n            let val = (parseInt(parts[1]) * 1000 + parseInt(parts[2])) * 10;\r\n            if (parts[3]) {\r\n                // Adds weight for suffixes: A=1, B=2, etc.\r\n                val += (parts[3].charCodeAt(0) - 64);\r\n            }\r\n            return val;\r\n        }\r\n        const simple = upper.match(/\\d+/);\r\n        return simple ? parseInt(simple[0]) * 10 : 0;\r\n    };\r\n\r\n    function parseCSV(text: string): TowerRow[] {\r\n        // Remove Byte Order Mark (BOM) if present\r\n        const cleanText = text.replace(/^\\uFEFF/, '')\r\n        const lines = cleanText.trim().split(/\\r?\\n/)\r\n        if (lines.length < 2) {\r\n            console.error('CSV: Fewer than 2 lines found')\r\n            return []\r\n        }\r\n\r\n        // Detect delimiter (comma, semicolon, or tab)\r\n        const firstLine = lines[0]\r\n        const delimiter = firstLine.includes(';') ? ';' : (firstLine.includes('\\t') ? '\\t' : ',')\r\n        console.log('CSV: Detected delimiter:', delimiter === '\\t' ? 'TAB' : delimiter)\r\n\r\n        // Helper to split line by delimiter while respecting quotes\r\n        const splitLine = (line: string) => {\r\n            const result = []\r\n            let start = 0\r\n            let inQuotes = false\r\n            for (let i = 0; i < line.length; i++) {\r\n                if (line[i] === '\"') inQuotes = !inQuotes\r\n                else if (line[i] === delimiter && !inQuotes) {\r\n                    result.push(line.substring(start, i).replace(/^\"|\"$/g, '').trim())\r\n                    start = i + 1\r\n                }\r\n            }\r\n            result.push(line.substring(start).replace(/^\"|\"$/g, '').trim())\r\n            return result\r\n        }\r\n\r\n        const headers = splitLine(lines[0]).map(h => h.toLowerCase().trim().replace(/[^a-z0-9_]/g, ''))\r\n        console.log('CSV: Normalized Headers:', headers)\r\n\r\n        const rows: TowerRow[] = []\r\n\r\n        const parseNumber = (val: string): number => {\r\n            if (!val || val.trim() === '' || val === '0') return 0\r\n\r\n            // Check if it's a DMS string (e.g. 9°33'27\"E)\r\n            if (val.includes('°') || val.includes(\"'\")) {\r\n                return dmsToDecimal(val)\r\n            }\r\n\r\n            const normalized = val.replace(',', '.')\r\n            const num = parseFloat(normalized)\r\n            return isNaN(num) ? 0 : num\r\n        }\r\n\r\n        for (let i = 1; i < lines.length; i++) {\r\n            const values = splitLine(lines[i])\r\n            if (values.length < headers.length) continue\r\n\r\n            const row: Record<string, string> = {}\r\n            headers.forEach((header, idx) => {\r\n                row[header] = values[idx] || ''\r\n            })\r\n\r\n            const objId = row['object_id'] || row['objectid'] || row['id'] || '';\r\n            const seqFromRow = parseNumber(row['object_seq'] || row['objectseq'] || row['seq'] || row['ordem'] || row['num'] || row['n'] || '0');\r\n\r\n            rows.push({\r\n                object_seq: seqFromRow || getNumericId(objId),\r\n                object_id: objId,\r\n                tower_type: row['tower_type'] || row['towertype'] || row['type'] || row['tipo'] || row['structure'] || '',\r\n                object_height: parseNumber(row['object_height'] || row['objectheight'] || row['altura'] || '0'),\r\n                go_forward: parseNumber(row['go_forward'] || row['goforward'] || row['vao_vante'] || '0'),\r\n                deflection: row['deflection'] || row['deflexao'] || row['angulo'] || '',\r\n                object_elevation: parseNumber(row['object_elevation'] || row['objectelevation'] || row['cota'] || row['elevacao'] || row['altitude'] || '0'),\r\n                fuso_object: row['fuso_object'] || row['fusoobject'] || row['fuso'] || row['zone'] || row['utmzone'] || row['utm_zone'] || '',\r\n                x_coordinate: parseNumber(row['x_coordinate'] || row['x_cord_object'] || row['coord_x'] || row['x'] || '0'),\r\n                y_coordinate: parseNumber(row['y_coordinate'] || row['y_cord_object'] || row['coord_y'] || row['y'] || '0'),\r\n                fix_conductor: parseNumber(row['fix_conductor'] || row['fixconductor'] || row['cabo_condutor'] || '0')\r\n            })\r\n        }\r\n\r\n        console.log(`CSV: Parsed ${rows.length} rows successfully`)\r\n        return rows\r\n    }\r\n\r\n    // Helper to convert DMS (9°33'27\"E) to decimal\r\n    const dmsToDecimal = (dms: string): number => {\r\n        if (!dms || dms === '0') return 0\r\n        try {\r\n            const parts = dms.match(/(\\d+)[°|\\s](\\d+)['|\\s](\\d+)\"?([NSEW])?/i)\r\n            if (!parts) {\r\n                // Try simple decimal parse\r\n                const normalized = dms.replace(',', '.')\r\n                const num = parseFloat(normalized)\r\n                return isNaN(num) ? 0 : num\r\n            }\r\n\r\n            const degrees = parseInt(parts[1])\r\n            const minutes = parseInt(parts[2])\r\n            const seconds = parseInt(parts[3])\r\n            const direction = parts[4]?.toUpperCase()\r\n\r\n            let dd = degrees + (minutes / 60) + (seconds / 3600)\r\n            if (direction === 'S' || direction === 'W') dd = dd * -1\r\n            return dd\r\n        } catch (e) {\r\n            return 0\r\n        }\r\n    }\r\n\r\n    // Helper to convert boolean-like values\r\n    const parseBoolean = (val: any): boolean => {\r\n        if (!val) return false;\r\n        const s = String(val).toLowerCase().trim();\r\n        return s === 'true' || s === 'verdadeiro' || s === 'sim' || s === 'yes' || s === '1' || s === 'hidden';\r\n    };\r\n\r\n    // Parse Excel file to TowerRow array\r\n    function parseExcel(buffer: ArrayBuffer): TowerRow[] {\r\n        const workbook = XLSX.read(buffer, { type: 'array' })\r\n        const sheetName = workbook.SheetNames[0]\r\n        const worksheet = workbook.Sheets[sheetName]\r\n\r\n        // Convert to JSON with raw header values\r\n        const jsonData = XLSX.utils.sheet_to_json<Record<string, any>>(worksheet, { defval: '' })\r\n\r\n        if (jsonData.length === 0) {\r\n            console.error('Excel: No data rows found')\r\n            return []\r\n        }\r\n\r\n        console.log('Excel: First row sample:', jsonData[0])\r\n        console.log('Excel: Total rows:', jsonData.length)\r\n\r\n        const parseNumber = (val: any): number => {\r\n            if (val === undefined || val === null || val === '') return 0\r\n            if (typeof val === 'number') return val\r\n            const str = String(val)\r\n            if (str.includes('°') || str.includes(\"'\")) {\r\n                return dmsToDecimal(str)\r\n            }\r\n            const normalized = str.replace(',', '.')\r\n            const num = parseFloat(normalized)\r\n            return isNaN(num) ? 0 : num\r\n        }\r\n\r\n        const rows: TowerRow[] = jsonData.map((row: any) => {\r\n            // Normalize keys to lowercase\r\n            const normalizedRow: Record<string, any> = {}\r\n            Object.keys(row).forEach(key => {\r\n                normalizedRow[key.toLowerCase().trim().replace(/[^a-z0-9_]/g, '')] = row[key]\r\n            })\r\n\r\n            // Combine UTM Zone + Band if separated (e.g. 23 + K -> 23K)\r\n            let parsedFuso = String(normalizedRow['fuso_object'] || normalizedRow['fusoobject'] || normalizedRow['fuso'] || normalizedRow['zone'] || normalizedRow['utmzone'] || normalizedRow['utm_zone'] || '');\r\n            const utmBand = String(normalizedRow['utm_band'] || normalizedRow['utmband'] || normalizedRow['band'] || '');\r\n            if (parsedFuso && utmBand && !parsedFuso.includes(utmBand)) {\r\n                parsedFuso = `${parsedFuso}${utmBand}`;\r\n            }\r\n\r\n            const objId = String(normalizedRow['object_id'] || normalizedRow['objectid'] || normalizedRow['id'] || '');\r\n            const seqFromRow = parseNumber(normalizedRow['object_seq'] || normalizedRow['objectseq'] || normalizedRow['seq'] || normalizedRow['ordem'] || normalizedRow['num'] || normalizedRow['n'] || 0);\r\n\r\n            // New Columns Mapping\r\n            const structureType = String(normalizedRow['structuretype'] || normalizedRow['structure_type'] || normalizedRow['tipificacao_estrutura'] || normalizedRow['tipificacao'] || '');\r\n            const isHidden = parseBoolean(normalizedRow['ishidden'] || normalizedRow['is_hidden'] || normalizedRow['hidden'] || normalizedRow['ocultar']);\r\n            const dist = parseNumber(normalizedRow['distance'] || normalizedRow['distancia'] || normalizedRow['dist'] || 0);\r\n            const wgt = parseNumber(normalizedRow['weight'] || normalizedRow['peso'] || normalizedRow['cable_tension'] || 0);\r\n            // distance used to replace go_forward in logic, but we map both for safety\r\n            const goForward = parseNumber(normalizedRow['go_forward'] || normalizedRow['goforward'] || normalizedRow['vao_vante'] || 0) || dist;\r\n\r\n            return {\r\n                object_seq: seqFromRow || getNumericId(objId),\r\n                object_id: objId,\r\n                tower_type: String(normalizedRow['tower_type'] || normalizedRow['towertype'] || normalizedRow['type'] || normalizedRow['tipo'] || normalizedRow['structure'] || ''),\r\n                object_height: parseNumber(normalizedRow['object_height'] || normalizedRow['objectheight'] || normalizedRow['altura'] || 0),\r\n                go_forward: goForward,\r\n                deflection: String(normalizedRow['deflection'] || normalizedRow['deflexao'] || normalizedRow['angulo'] || ''),\r\n                object_elevation: parseNumber(normalizedRow['object_elevation'] || normalizedRow['objectelevation'] || normalizedRow['cota'] || normalizedRow['elevacao'] || normalizedRow['altitude'] || 0),\r\n                fuso_object: parsedFuso,\r\n                x_coordinate: parseNumber(normalizedRow['x_coordinate'] || normalizedRow['x_cord_object'] || normalizedRow['coord_x'] || normalizedRow['x'] || 0),\r\n                y_coordinate: parseNumber(normalizedRow['y_coordinate'] || normalizedRow['y_cord_object'] || normalizedRow['coord_y'] || normalizedRow['y'] || 0),\r\n                fix_conductor: parseNumber(normalizedRow['fix_conductor'] || normalizedRow['fixconductor'] || normalizedRow['cabo_condutor'] || 0),\r\n                fix_pararaio: parseNumber(normalizedRow['fix_pararaio'] || normalizedRow['fixpararaio'] || normalizedRow['cabo_pararaio'] || 0),\r\n                tipificacao_estrutura: structureType,\r\n                is_hidden: isHidden,\r\n                distance: dist,\r\n                weight: wgt,\r\n                metadata: {\r\n                    original_utm_zone: normalizedRow['utm_zone'],\r\n                    original_utm_band: normalizedRow['utm_band']\r\n                }\r\n            }\r\n        })\r\n\r\n        console.log(`Excel: Parsed ${rows.length} rows successfully`)\r\n        return rows\r\n    }\r\n\r\n    async function handleFileChange(e: React.ChangeEvent<HTMLInputElement>) {\r\n        const file = e.target.files?.[0]\r\n        if (!file) return\r\n\r\n        const targetProjectId = selectedProjectId || externalProjectId\r\n        if (!targetProjectId || targetProjectId === 'all') {\r\n            toast({\r\n                title: 'Selecione uma Obra',\r\n                description: 'É necessário selecionar uma obra para vincular os dados.',\r\n                variant: 'destructive'\r\n            })\r\n            return\r\n        }\r\n\r\n        setLoading(true)\r\n\r\n        try {\r\n            console.log('File: Starting file process:', file.name, 'Type:', file.type)\r\n\r\n            let rows: TowerRow[] = []\r\n\r\n            // Detect file type by extension\r\n            const isExcel = file.name.toLowerCase().endsWith('.xlsx') || file.name.toLowerCase().endsWith('.xls')\r\n\r\n            if (isExcel) {\r\n                const buffer = await file.arrayBuffer()\r\n                rows = parseExcel(buffer)\r\n            } else {\r\n                const text = await file.text()\r\n                rows = parseCSV(text)\r\n            }\r\n\r\n            if (rows.length === 0) {\r\n                throw new Error('Arquivo vazio ou colunas não reconhecidas. Verifique se o arquivo segue o padrão: object_id, type, object_height...')\r\n            }\r\n\r\n            // Check if coordinates look like UTM (very large numbers)\r\n            const utmPoints = rows.filter(r => Math.abs(r.x_coordinate) > 180 || Math.abs(r.y_coordinate) > 90);\r\n            if (utmPoints.length > 0) {\r\n                console.log(`CSV: Detected ${utmPoints.length} points that look like UTM. Attempting conversion...`);\r\n\r\n                let convertedCount = 0;\r\n                rows = rows.map(row => {\r\n                    let finalX = row.x_coordinate;\r\n                    let finalY = row.y_coordinate;\r\n\r\n                    // AUTO-FIX: Detect and fix millimeter scaling (e.g., 626596228 -> 626596.228)\r\n                    // Logic: UTM X is usually < 1,000,000. UTM Y is < 10,000,000 (Southern Hemisphere).\r\n                    // If values are massive (e.g. > 100,000,000), they are likely in millimeters or missing decimal separator.\r\n\r\n                    if (Math.abs(finalX) > 10000000) {\r\n                        // Try dividing by 1000 iteratively\r\n                        while (Math.abs(finalX) > 10000000) finalX /= 1000;\r\n                        console.log(`CSV: Auto-scaled X from ${row.x_coordinate} to ${finalX}`);\r\n                    }\r\n                    if (Math.abs(finalY) > 20000000) {\r\n                        while (Math.abs(finalY) > 20000000) finalY /= 1000;\r\n                        console.log(`CSV: Auto-scaled Y from ${row.y_coordinate} to ${finalY}`);\r\n                    }\r\n\r\n                    const isUTM = Math.abs(finalX) > 180 || Math.abs(finalY) > 90;\r\n                    if (isUTM) {\r\n                        const zoneData = parseUTMZone(row.fuso_object || defaultFuso);\r\n                        if (zoneData) {\r\n                            const { lat, lng } = utmToLatLng(finalX, finalY, zoneData.zone, zoneData.southHemi);\r\n                            convertedCount++;\r\n                            return {\r\n                                ...row,\r\n                                x_coordinate: lng,\r\n                                y_coordinate: lat,\r\n                                fuso_object: row.fuso_object || defaultFuso,\r\n                                metadata: {\r\n                                    ...(row.metadata as any || {}),\r\n                                    original_utm_x: finalX,\r\n                                    original_utm_y: finalY,\r\n                                    raw_excel_x: row.x_coordinate, // Keep track of raw bad data\r\n                                    raw_excel_y: row.y_coordinate,\r\n                                    original_fuso: row.fuso_object || defaultFuso,\r\n                                    converted_from_utm: true\r\n                                }\r\n                            };\r\n                        }\r\n                    }\r\n                    else {\r\n                        // If not UTM after scaling, still use the scaled values if they were scaled\r\n                        return {\r\n                            ...row,\r\n                            x_coordinate: finalX,\r\n                            y_coordinate: finalY\r\n                        };\r\n                    }\r\n                    return row;\r\n                });\r\n\r\n                if (convertedCount > 0) {\r\n                    toast({\r\n                        title: 'Conversão UTM Ativa',\r\n                        description: `Detectamos coordenadas UTM. ${convertedCount} pontos foram convertidos para WGS84 usando o fuso \"${defaultFuso}\".`\r\n                    });\r\n                } else {\r\n                    throw new Error(`As coordenadas detectadas parecem ser UTM (valores altos), mas o fuso \"${defaultFuso}\" é inválido. Verifique o Fuso Padrão no painel.`);\r\n                }\r\n            }\r\n\r\n            const projectCompanyId = projects.find(p => p.id === targetProjectId)?.companyId;\r\n            const effectiveCompanyId = profile?.companyId || projectCompanyId;\r\n\r\n            if (!effectiveCompanyId) {\r\n                console.error('CSV: Missing companyId in profile and project:', profile)\r\n                throw new Error('Empresa não identificada. Verifique se a obra selecionada está vinculada a uma empresa.')\r\n            }\r\n\r\n            // Deduplicate\r\n            const uniqueRowsMap = new Map<string, TowerRow>();\r\n            rows.forEach(row => {\r\n                const key = `${row.object_id}:::${row.object_seq}`;\r\n                uniqueRowsMap.set(key, row);\r\n            });\r\n            const uniqueRows = Array.from(uniqueRowsMap.values());\r\n            console.log(`CSV: Deduplicated ${rows.length} rows to ${uniqueRows.length} unique records`);\r\n\r\n            // Validate Numeric Limits to prevent \"Numeric Field Overflow\"\r\n            const MAX_DECIMAL_VALUE = 999999999999; // 1 trillion safe limit for Decimal(30,10)\r\n            const hugeNumbers = uniqueRows.find(row => {\r\n                return [row.go_forward, row.object_height, row.object_elevation, row.distance, row.weight, row.x_coordinate, row.y_coordinate]\r\n                    .some(val => val && Math.abs(val) > MAX_DECIMAL_VALUE);\r\n            });\r\n\r\n            if (hugeNumbers) {\r\n                const offender = Object.entries(hugeNumbers).find(([k, v]) => typeof v === 'number' && Math.abs(v) > MAX_DECIMAL_VALUE);\r\n                console.error(\"CSV: Found huge number:\", offender, \"in row\", hugeNumbers);\r\n                throw new Error(`Detectado valor numérico muito alto na torre ${hugeNumbers.object_id} (Campo: ${offender?.[0]} = ${offender?.[1]}). Verifique se há erro de digitação ou notação científica.`);\r\n            }\r\n\r\n            // Prepare data for insert\r\n            const dataToInsert = uniqueRows.map(row => ({\r\n                project_id: targetProjectId,\r\n                company_id: effectiveCompanyId,\r\n                ...row,\r\n                // Explicitly map new fields\r\n                tipificacao_estrutura: row.tipificacao_estrutura,\r\n                is_hidden: row.is_hidden,\r\n                distance: row.distance,\r\n                weight: row.weight,\r\n                metadata: {\r\n                    ...(row.metadata as any || {}),\r\n                    deflection_decimal: 0\r\n                }\r\n            }))\r\n\r\n\r\n            console.log('CSV: Attempting upsert to db...', dataToInsert.length, 'rows')\r\n\r\n            // Upsert to handle duplicates\r\n            const { error, data } = await db\r\n                .from('tower_technical_data' as any)\r\n                .upsert(dataToInsert, {\r\n                    onConflict: 'project_id,object_id',\r\n                    ignoreDuplicates: false\r\n                })\r\n                .select()\r\n\r\n            if (error) {\r\n                console.error('CSV: db error:', error)\r\n                throw error\r\n            }\r\n\r\n            console.log('CSV: Upsert successful:', data?.length, 'records processed')\r\n\r\n            const projectName = projects.find(p => p.id === targetProjectId)?.name || 'Obra'\r\n            toast({\r\n                title: 'CSV Importado',\r\n                description: `${rows.length} torres importadas para \"${projectName}\".`\r\n            })\r\n\r\n            if (onUploadSuccess) onUploadSuccess()\r\n\r\n        } catch (error) {\r\n            const message = error instanceof Error ? error.message : 'Erro ao processar CSV'\r\n            console.error('CSV: Error:', message)\r\n            toast({\r\n                title: 'Erro na Importação',\r\n                description: message,\r\n                variant: 'destructive'\r\n            })\r\n        } finally {\r\n            setLoading(false)\r\n            setIsOpen(false)\r\n            if (inputRef.current) inputRef.current.value = ''\r\n        }\r\n    }\r\n\r\n    function handleSelectProject(projectId: string) {\r\n        setSelectedProjectId(projectId)\r\n        inputRef.current?.click()\r\n    }\r\n\r\n    return (\r\n        <div className=\"flex items-center\">\r\n            <input\r\n                ref={inputRef}\r\n                type=\"file\"\r\n                accept=\".csv,.xlsx,.xls\"\r\n                onChange={handleFileChange}\r\n                className=\"hidden\"\r\n                id=\"csv-upload\"\r\n            />\r\n\r\n            <Popover open={isOpen} onOpenChange={setIsOpen}>\r\n                <PopoverTrigger asChild>\r\n                    <Button\r\n                        variant=\"outline\"\r\n                        disabled={loading}\r\n                        className=\"glass-card gap-2 text-[10px] font-black uppercase tracking-widest border-white/5 h-10 shadow-glow active:scale-95 transition-all\"\r\n                    >\r\n                        {loading ? (\r\n                            <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n                        ) : (\r\n                            <FileSpreadsheet className=\"w-4 h-4\" />\r\n                        )}\r\n                        {loading ? 'Importando...' : 'Importar CSV/Excel'}\r\n                        <ChevronDown className=\"w-3 h-3 opacity-50\" />\r\n                    </Button>\r\n                </PopoverTrigger>\r\n                <PopoverContent className=\"w-96 p-2 glass-card border-white/10\" align=\"end\">\r\n                    <div className=\"space-y-1\">\r\n                        <div className=\"px-2 py-3 border-b border-white/5 space-y-2\">\r\n                            <label className=\"text-[9px] font-black uppercase tracking-widest text-primary/70\">\r\n                                Fuso Padrão (UTM fallback)\r\n                            </label>\r\n                            <input\r\n                                type=\"text\"\r\n                                value={defaultFuso}\r\n                                onChange={(e) => setDefaultFuso(e.target.value.toUpperCase())}\r\n                                placeholder=\"Ex: 23S\"\r\n                                className=\"industrial-input h-8 text-[10px] w-full bg-white/5 border-white/10\"\r\n                            />\r\n                        </div>\r\n                        <p className=\"text-[9px] font-black uppercase tracking-widest text-muted-foreground px-2 py-1\">\r\n                            Selecione a Obra para vincular os dados\r\n                        </p>\r\n                        <div className=\"max-h-[200px] overflow-y-auto space-y-0.5\">\r\n                            {projects.map(p => (\r\n                                <button\r\n                                    key={p.id}\r\n                                    onClick={() => handleSelectProject(p.id)}\r\n                                    className={cn(\r\n                                        \"w-full flex items-center justify-between px-3 py-2 rounded-lg text-left text-sm transition-all\",\r\n                                        \"hover:bg-white/5 active:scale-[0.98]\"\r\n                                    )}\r\n                                >\r\n                                    <span className=\"truncate font-medium\">{p.name}</span>\r\n                                    <FileSpreadsheet className=\"w-4 h-4 text-muted-foreground/30\" />\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </PopoverContent>\r\n            </Popover>\r\n        </div>\r\n    )\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\map\\kml-uploader.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'FolderUp' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'getNumericId' is assigned a value but never used.","line":32,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2628,2631],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2628,2631],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":85,"column":70,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":85,"endColumn":71,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3532,3533],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3532,3532],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":92,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3865,3868],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3865,3868],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":117,"column":54,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":117,"endColumn":55,"suggestions":[{"messageId":"removeEscape","fix":{"range":[5200,5201],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[5200,5200],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":118,"column":58,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":118,"endColumn":59,"suggestions":[{"messageId":"removeEscape","fix":{"range":[5272,5273],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[5272,5272],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5403,5406],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5403,5406],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":311,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14580,14583],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14580,14583],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":332,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":332,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15617,15620],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15617,15620],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":370,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":370,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17517,17520],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17517,17520],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":385,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":385,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18145,18148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18145,18148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport React, { useState, useRef } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { FolderUp, Loader2, ChevronDown, FileJson } from 'lucide-react';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useProjects } from '@/hooks/useProjects';\r\nimport { db } from '@/integrations/database';\r\nimport { cn } from '@/lib/utils';\r\nimport JSZip from 'jszip';\r\nimport {\r\n    Popover,\r\n    PopoverContent,\r\n    PopoverTrigger,\r\n} from '@/components/ui/popover';\r\nimport { CatenaryCalculator } from '@/services/catenary-calculator';\r\n\r\ninterface KMLUploaderProps {\r\n    projectId?: string;\r\n    onUploadSuccess?: () => void;\r\n}\r\n\r\nexport function KMLUploader({ projectId: externalProjectId, onUploadSuccess }: KMLUploaderProps) {\r\n    const [loading, setLoading] = useState(false);\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const [selectedProjectId, setSelectedProjectId] = useState<string | null>(externalProjectId || null);\r\n    const inputRef = useRef<HTMLInputElement>(null);\r\n    const { toast } = useToast();\r\n    const { profile } = useAuth();\r\n    const { projects } = useProjects();\r\n\r\n    const getNumericId = (name: string) => {\r\n        const upper = (name || '').trim().toUpperCase();\r\n        // Regex para capturar padrões comuns de torres: Num/Seq+Sufixo\r\n        // Ex: 202/1, 202/1A, 0/1B, 22/3\r\n        const parts = upper.match(/(\\d+)\\/(\\d+)([A-Z])?/);\r\n        if (parts) {\r\n            const structure = parseInt(parts[1]);\r\n            const seq = parseInt(parts[2]);\r\n            const suffix = parts[3];\r\n\r\n            // Peso base para a estrutura (ex: km ou número da torre principal)\r\n            // Multiplicamos por 10000 para ter espaço para sequências e sufixos\r\n            let val = structure * 10000;\r\n\r\n            // Adiciona a sequência (ex: 1, 2, 3...)\r\n            val += seq * 100;\r\n\r\n            // Adiciona peso para sufixos (A=1, B=2...)\r\n            // Torres sem sufixo ficam com 0 (ex: 1/1 vem antes de 1/1A? Depende da lógica)\r\n            // Geralmente 1/1 é a torre base. 1/1A seria uma intermediária ou variante.\r\n            // Se 1/1A deve vir DEPOIS de 1/1, então sufixo soma.\r\n            if (suffix) {\r\n                val += (suffix.charCodeAt(0) - 64); // A=1, B=2...\r\n            }\r\n\r\n            return val;\r\n        }\r\n\r\n        // Fallback para apenas números\r\n        const simple = upper.match(/\\d+/);\r\n        return simple ? parseInt(simple[0]) * 100 : 0;\r\n    };\r\n\r\n    const parseKML = async (kmlText: string) => {\r\n        const towerMap = new Map();\r\n        const spans: any[] = [];\r\n\r\n        // 1. Extract Styles (BalloonStyle text contains technical data in PLS-CADD export)\r\n        const towerStyles = new Map();\r\n        const spanStyles = new Map();\r\n\r\n        const styleRegex = /<Style id=\"([^\"]+)\">[\\s\\S]*?<text><!\\[CDATA\\[([\\s\\S]*?)\\]\\]><\\/text>/g;\r\n        let match;\r\n        while ((match = styleRegex.exec(kmlText)) !== null) {\r\n            const id = match[1];\r\n            const content = match[2];\r\n\r\n            if (content.includes('From Str.')) {\r\n                // Span Style\r\n                const voltage = content.match(/Voltage:\\s*(.*?)<br>/)?.[1];\r\n                const cable = content.match(/Cable:\\s*(.*?)<br>/)?.[1];\r\n                const fromRaw = content.match(/From Str\\.:\\s*(.*?)<br>/)?.[1];\r\n                const toRaw = content.match(/To Str\\.:\\s*(.*?)<br>/)?.[1];\r\n                const catenary = content.match(/Catenary \\(m\\)\\s*([\\d\\.]+)/)?.[1];\r\n\r\n                // Extract common PLS-CADD extra fields\r\n                const numCond = content.match(/Num\\. Cond\\.:\\s*(\\d+)/)?.[1];\r\n                const phases = content.match(/Phases:\\s*(\\d+)/)?.[1];\r\n\r\n                // Extract all technical fields from span style table\r\n                const metadataExtra: any = {\r\n                    num_conductors: parseInt(numCond || '1'),\r\n                    phases: parseInt(phases || '3')\r\n                };\r\n\r\n                const technicalMatches = content.matchAll(/<td>([^<]+)=([^<]+)<\\/td>|<td>([^<]+):([^<]+)<\\/td>/g);\r\n                for (const tMatch of technicalMatches) {\r\n                    const key = (tMatch[1] || tMatch[3])?.trim()?.replace(/\\./g, '');\r\n                    const val = (tMatch[2] || tMatch[4])?.trim();\r\n                    if (key && val && !['Voltage', 'Cable', 'From Str', 'To Str', 'Catenary (m)'].includes(key)) {\r\n                        metadataExtra[key.toLowerCase().replace(/\\s+/g, '_')] = val;\r\n                    }\r\n                }\r\n\r\n                spanStyles.set(id, {\r\n                    voltage: parseFloat(voltage) || 500,\r\n                    cable: cable?.replace(/'/g, ''),\r\n                    from: fromRaw?.split(' Set ')[0]?.trim(),\r\n                    to: toRaw?.split(' Set ')[0]?.trim(),\r\n                    catenary: catenary ? parseFloat(catenary) : 1200,\r\n                    metadata: metadataExtra\r\n                });\r\n            } else if (content.includes('HT=')) {\r\n                // Tower Style\r\n                const name = content.match(/<h3>(.*?)<\\/h3>/)?.[1];\r\n                const height = content.match(/HT=([\\d\\.]+)/)?.[1];\r\n                const elevation = content.match(/ELE=([\\d\\.]+)/)?.[1];\r\n\r\n                // Extract additional technical fields (VM, VPTMIN, VPTMAX, etc)\r\n                const metadata: any = {};\r\n                const technicalMatches = content.matchAll(/<td>([^<]+)=([^<]+)<\\/td>|<td>([^<]+):([^<]+)<\\/td>/g);\r\n                for (const tMatch of technicalMatches) {\r\n                    const key = (tMatch[1] || tMatch[3])?.trim()?.replace(/\\./g, '');\r\n                    const val = (tMatch[2] || tMatch[4])?.trim();\r\n                    if (key && val && !['HT', 'ELE', 'X', 'Y'].includes(key)) {\r\n                        metadata[key.toLowerCase()] = val;\r\n                    }\r\n                }\r\n\r\n                // Capture special descriptions (OBS)\r\n                const obsMatches = content.matchAll(/<td>OBS(\\d+):([^<]+)<\\/td>/g);\r\n                for (const oMatch of obsMatches) {\r\n                    metadata[`obs${oMatch[1]}`] = oMatch[2]?.trim();\r\n                }\r\n\r\n                towerStyles.set(id, {\r\n                    name: name?.trim(),\r\n                    height: height ? parseFloat(height) : 30,\r\n                    elevation: elevation ? parseFloat(elevation) : 0,\r\n                    metadata\r\n                });\r\n            }\r\n        }\r\n\r\n        // 2. Extract Placemarks\r\n        const placemarkRegex = /<Placemark>([\\s\\S]*?)<\\/Placemark>/g;\r\n        let genericCounter = 1;\r\n\r\n        while ((match = placemarkRegex.exec(kmlText)) !== null) {\r\n            const content = match[1];\r\n            const styleUrl = content.match(/<styleUrl>#([^<]+)<\\/styleUrl>/)?.[1];\r\n            let handled = false;\r\n\r\n            // Try PLS-CADD specific styles first\r\n            if (styleUrl) {\r\n                if (towerStyles.has(styleUrl)) {\r\n                    const style = towerStyles.get(styleUrl);\r\n                    const coordsMatch = content.match(/<coordinates>\\s*([\\s\\S]*?)\\s*<\\/coordinates>/);\r\n                    if (coordsMatch) {\r\n                        const parts = coordsMatch[1].trim().split(',');\r\n                        const lng = parseFloat(parts[0]);\r\n                        const lat = parseFloat(parts[1]);\r\n                        towerMap.set(style.name, {\r\n                            object_id: style.name,\r\n                            object_seq: null, // Limpa a sequência para evitar conflitos (será preenchida pelo CSV)\r\n                            object_height: style.height,\r\n                            object_elevation: style.elevation,\r\n                            x_cord_object: lng,\r\n                            y_cord_object: lat,\r\n                            name: style.name,\r\n                            externalId: style.name,\r\n                            metadata: style.metadata || {}\r\n                        });\r\n                        handled = true;\r\n                    }\r\n                } else if (spanStyles.has(styleUrl)) {\r\n                    const style = spanStyles.get(styleUrl);\r\n                    const coordsMatch = content.match(/<coordinates>\\s*([\\s\\S]*?)\\s*<\\/coordinates>/);\r\n                    if (coordsMatch) {\r\n                        const points = coordsMatch[1].trim().split(/\\s+/).map(p => {\r\n                            const parts = p.split(',');\r\n                            return [parseFloat(parts[0]), parseFloat(parts[1]), parseFloat(parts[2]) || 0];\r\n                        });\r\n                        spans.push({\r\n                            tower_start_id: style.from,\r\n                            tower_end_id: style.to,\r\n                            voltage_kv: style.voltage,\r\n                            cable_type: style.cable,\r\n                            catenary_constant: style.catenary,\r\n                            metadata: style.metadata || {},\r\n                            raw_points: points\r\n                        });\r\n                        handled = true;\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Fallback for generic KML (Point support)\r\n            if (!handled) {\r\n                const nameMatch = content.match(/<name>([\\s\\S]*?)<\\/name>/);\r\n                const coordsMatch = content.match(/<coordinates>\\s*([\\s\\S]*?)\\s*<\\/coordinates>/);\r\n\r\n                if (coordsMatch) {\r\n                    let name = nameMatch?.[1]?.replace(/<!\\[CDATA\\[|\\]\\]>/g, '').trim();\r\n                    const parts = coordsMatch[1].trim().split(/\\s+/)[0].split(',');\r\n\r\n                    if (parts.length >= 2) {\r\n                        const lng = parseFloat(parts[0]);\r\n                        const lat = parseFloat(parts[1]);\r\n\r\n                        if (!isNaN(lng) && !isNaN(lat)) {\r\n                            if (!name) name = `PONTO_${genericCounter++}`;\r\n\r\n                            // Support for Technical Tours (LineStrings)\r\n                            const isLine = content.includes('<LineString>');\r\n                            const normName = (name || '').toUpperCase();\r\n                            const isTour = /ALIGNMENT|CENTERLINE|OFFSET/i.test(normName);\r\n\r\n                            if (isLine && isTour) {\r\n                                const points = coordsMatch[1].trim().split(/\\s+/).map(p => {\r\n                                    const c = p.split(',');\r\n                                    return [parseFloat(c[0]), parseFloat(c[1]), parseFloat(c[2]) || 0];\r\n                                });\r\n                                spans.push({\r\n                                    tower_start_id: `TOUR_START_${normName.replace(/\\s+/g, '_')}`,\r\n                                    tower_end_id: `TOUR_END_${normName.replace(/\\s+/g, '_')}`,\r\n                                    span_name: name,\r\n                                    voltage_kv: 0,\r\n                                    cable_type: 'Tour Técnico',\r\n                                    catenary_constant: 1000,\r\n                                    metadata: { is_tour: true, tour_type: normName },\r\n                                    raw_points: points\r\n                                });\r\n                                handled = true;\r\n                            }\r\n\r\n                            // Only add if it's a single Point (not a long line segment being caught as a point)\r\n                            const isPoint = content.includes('<Point>');\r\n                            if (!handled && isPoint && !towerMap.has(name) && !/TOUR|ROUTE/i.test(name)) {\r\n                                towerMap.set(name, {\r\n                                    object_id: name,\r\n                                    object_seq: null,\r\n                                    object_height: 30, // Default height\r\n                                    object_elevation: 0,\r\n                                    x_cord_object: lng,\r\n                                    y_cord_object: lat,\r\n                                    name: name,\r\n                                    externalId: name,\r\n                                    metadata: {}\r\n                                });\r\n                            }\r\n\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return { towers: Array.from(towerMap.values()), spans };\r\n    };\r\n\r\n    async function handleFileChange(e: React.ChangeEvent<HTMLInputElement>) {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        const targetProjectId = selectedProjectId || externalProjectId;\r\n        if (!targetProjectId || targetProjectId === 'all') {\r\n            toast({\r\n                title: 'Selecione uma Obra',\r\n                description: 'É necessário selecionar uma obra para vincular os dados.',\r\n                variant: 'destructive'\r\n            });\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n        try {\r\n            let kmlText = '';\r\n            if (file.name.toLowerCase().endsWith('.kmz')) {\r\n                const zip = await JSZip.loadAsync(file);\r\n                const kmlFile = Object.keys(zip.files).find(f => f.toLowerCase().endsWith('.kml'));\r\n                if (!kmlFile) throw new Error('Não foi possível encontrar o arquivo KML dentro do KMZ.');\r\n                kmlText = await zip.files[kmlFile].async('string');\r\n            } else {\r\n                kmlText = await file.text();\r\n            }\r\n\r\n            const { towers, spans } = await parseKML(kmlText);\r\n\r\n            if (towers.length === 0) {\r\n                throw new Error('Nenhuma torre identificada no KML. Verifique o formato PLS-CADD.');\r\n            }\r\n\r\n            // 1. Sync Towers in batches - DEDUPLICATE FIRST\r\n            const towerDataToInsert = Array.from(new Map(towers.map(t => [\r\n                `${targetProjectId}:::${t.object_id}`,\r\n                {\r\n                    project_id: targetProjectId,\r\n                    company_id: profile?.companyId,\r\n                    ...t\r\n                }\r\n            ])).values());\r\n\r\n            const BATCH_SIZE = 50;\r\n            console.log(`📦 Sincronizando ${towerDataToInsert.length} torres únicas em lotes...`);\r\n\r\n            for (let i = 0; i < towerDataToInsert.length; i += BATCH_SIZE) {\r\n                const batch = towerDataToInsert.slice(i, i + BATCH_SIZE);\r\n                const { error: tErr } = await db\r\n                    .from('tower_technical_data' as any)\r\n                    .upsert(batch, { onConflict: 'project_id,object_id' });\r\n\r\n                if (tErr) {\r\n                    console.error('❌ Erro no lote de torres:', tErr);\r\n                    throw new Error(`Erro ao salvar torres (Lote ${Math.floor(i / BATCH_SIZE) + 1}): ${tErr.message}`);\r\n                }\r\n            }\r\n\r\n            // 2. Process and DEDUPLICATE Spans\r\n            const uniqueSpansMap = new Map();\r\n            spans.forEach(span => {\r\n                // Ensure unique key for the span based on the constraint (project_id, tower_start, tower_end)\r\n                const key = `${targetProjectId}:::${span.tower_start_id}:::${span.tower_end_id}`;\r\n\r\n                // If we already have this span in the map, we skip it to avoid SQL 21000 error\r\n                if (uniqueSpansMap.has(key)) return;\r\n\r\n                const t1 = towers.find(t => t.object_id === span.tower_start_id);\r\n                const t2 = towers.find(t => t.object_id === span.tower_end_id);\r\n\r\n                let geometry: any = null;\r\n                if (t1 && t2) {\r\n                    const start = { x: t1.x_cord_object, y: t1.y_cord_object, z: t1.object_height };\r\n                    const end = { x: t2.x_cord_object, y: t2.y_cord_object, z: t2.object_height };\r\n                    const points = CatenaryCalculator.generateCatenaryPoints(start, end, span.catenary_constant, 80);\r\n                    geometry = {\r\n                        type: 'LineString',\r\n                        coordinates: points.map(p => [p.x, p.y, p.z])\r\n                    };\r\n                } else {\r\n                    geometry = {\r\n                        type: 'LineString',\r\n                        coordinates: span.raw_points\r\n                    };\r\n                }\r\n\r\n                uniqueSpansMap.set(key, {\r\n                    project_id: targetProjectId,\r\n                    company_id: profile?.companyId,\r\n                    tower_start_id: span.tower_start_id,\r\n                    tower_end_id: span.tower_end_id,\r\n                    voltage_kv: span.voltage_kv,\r\n                    cable_type: span.cable_type,\r\n                    catenary_constant: span.catenary_constant,\r\n                    metadata: span.metadata,\r\n                    name: `${span.tower_start_id} - ${span.tower_end_id}`,\r\n                    externalId: `${span.tower_start_id} - ${span.tower_end_id}`,\r\n                    geometry\r\n                });\r\n            });\r\n\r\n            const processedSpans = Array.from(uniqueSpansMap.values());\r\n\r\n            // 2. Sync Spans in batches\r\n            console.log(`📦 Sincronizando ${processedSpans.length} vãos únicos em lotes...`);\r\n            for (let i = 0; i < processedSpans.length; i += BATCH_SIZE) {\r\n                const batch = processedSpans.slice(i, i + BATCH_SIZE);\r\n                const { error: sErr } = await db\r\n                    .from('span_technical_data' as any)\r\n                    .upsert(batch, { onConflict: 'project_id,tower_start_id,tower_end_id' });\r\n\r\n                if (sErr) {\r\n                    console.error('❌ Erro no lote de vãos:', sErr);\r\n                    throw new Error(`Erro ao salvar vãos (Lote ${Math.floor(i / BATCH_SIZE) + 1}): ${sErr.message}`);\r\n                }\r\n            }\r\n\r\n            toast({\r\n                title: 'Importação Concluída',\r\n                description: `${towers.length} torres e ${spans.length} vãos sincronizados com sucesso.`,\r\n            });\r\n\r\n            if (onUploadSuccess) onUploadSuccess();\r\n        } catch (error: any) {\r\n            console.error('❌ KML Import Error Details:', {\r\n                message: error.message,\r\n                details: error.details,\r\n                hint: error.hint,\r\n                code: error.code,\r\n                error\r\n            });\r\n            toast({\r\n                title: 'Erro na Importação',\r\n                description: error.message || 'Erro desconhecido ao processar KML.',\r\n                variant: 'destructive'\r\n            });\r\n        } finally {\r\n            setLoading(false);\r\n            setIsOpen(false);\r\n            if (inputRef.current) inputRef.current.value = '';\r\n        }\r\n    }\r\n\r\n    function handleSelectProject(projectId: string) {\r\n        setSelectedProjectId(projectId);\r\n        inputRef.current?.click();\r\n    }\r\n\r\n    return (\r\n        <div className=\"flex items-center\">\r\n            <input\r\n                ref={inputRef}\r\n                type=\"file\"\r\n                accept=\".kml,.kmz\"\r\n                onChange={handleFileChange}\r\n                className=\"hidden\"\r\n                id=\"kml-upload\"\r\n            />\r\n\r\n            <Popover open={isOpen} onOpenChange={setIsOpen}>\r\n                <PopoverTrigger asChild>\r\n                    <Button\r\n                        variant=\"outline\"\r\n                        disabled={loading}\r\n                        className=\"glass-card gap-2 text-[10px] font-black uppercase tracking-widest border-white/5 h-10 shadow-glow active:scale-95 transition-all\"\r\n                    >\r\n                        {loading ? (\r\n                            <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n                        ) : (\r\n                            <FileJson className=\"w-4 h-4\" />\r\n                        )}\r\n                        {loading ? 'Importando...' : 'Importar KML/KMZ'}\r\n                        <ChevronDown className=\"w-3 h-3 opacity-50\" />\r\n                    </Button>\r\n                </PopoverTrigger>\r\n                <PopoverContent className=\"w-96 p-2 glass-card border-white/10\" align=\"end\">\r\n                    <div className=\"space-y-1\">\r\n                        <p className=\"text-[9px] font-black uppercase tracking-widest text-muted-foreground px-2 py-1\">\r\n                            Selecione a Obra para vincular os dados do Google Earth\r\n                        </p>\r\n                        <div className=\"max-h-[200px] overflow-y-auto space-y-0.5\">\r\n                            {projects.map(p => (\r\n                                <button\r\n                                    key={p.id}\r\n                                    onClick={() => handleSelectProject(p.id)}\r\n                                    className={cn(\r\n                                        \"w-full flex items-center justify-between px-3 py-2 rounded-lg text-left text-sm transition-all\",\r\n                                        \"hover:bg-white/5 active:scale-[0.98]\"\r\n                                    )}\r\n                                >\r\n                                    <span className=\"truncate font-medium\">{p.name}</span>\r\n                                    <FileJson className=\"w-4 h-4 text-muted-foreground/30\" />\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </PopoverContent>\r\n            </Popover>\r\n        </div>\r\n    );\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\map\\mapbox-3d-layer.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Popup' is defined but never used.","line":3,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ExternalLink' is defined but never used.","line":5,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Pencil' is defined but never used.","line":5,"column":67,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":73},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CatenaryCalculator' is defined but never used.","line":13,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Point3D' is defined but never used.","line":13,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CablePath' is defined but never used.","line":15,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AnchorDebugService' is defined but never used.","line":18,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CableConfigModal' is defined but never used.","line":20,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CableAnchorConfig' is defined but never used.","line":20,"column":67,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":84},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'turf' is defined but never used.","line":54,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'features' is defined but never used.","line":55,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":55,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'direction' is assigned a value but never used.","line":155,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":155,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'onUpdatePlacemarkTexture' is defined but never used.","line":188,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":188,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'onUpdateCableSettings' is defined but never used.","line":192,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":192,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":199,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7402,7405],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7402,7405],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'calculateBearing' is assigned a value but never used.","line":205,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":205,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":210,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":210,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7941,7944],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7941,7944],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setEditingTransformTarget' is assigned a value but never used.","line":259,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":259,"endColumn":61},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":275,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11259,11262],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11259,11262],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":276,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":276,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11347,11350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11347,11350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":277,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":277,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11431,11434],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11431,11434],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":315,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":315,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13210,13213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13210,13213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":326,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":326,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13537,13540],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13537,13540],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":337,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":337,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14016,14019],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14016,14019],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":338,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":338,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14080,14083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14080,14083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":409,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":409,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16632,16635],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16632,16635],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":410,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":410,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16696,16699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16696,16699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":413,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":413,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16757,16760],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16757,16760],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":458,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":458,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18394,18397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18394,18397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_x' is defined but never used.","line":458,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":458,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_y' is defined but never used.","line":458,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":458,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'hoveredMarker' is assigned a value but never used.","line":485,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":485,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isVeryClose' is assigned a value but never used.","line":729,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":729,"endColumn":22},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEnrichedPlacemarks\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":732,"column":32,"nodeType":"Identifier","endLine":732,"endColumn":53},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":735,"column":27,"nodeType":"Identifier","endLine":735,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'MAX_DISTANCE_METERS' is assigned a value but never used.","line":738,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":738,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":752,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":752,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30589,30592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30589,30592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":753,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":753,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30633,30636],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30633,30636],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":757,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":757,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30776,30779],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30776,30779],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'getNumericId'. Either include it or remove the dependency array.","line":791,"column":8,"nodeType":"ArrayExpression","endLine":791,"endColumn":59,"suggestions":[{"desc":"Update the dependencies array to be: [mapCenter, enrichedPlacemarks, getNumericId]","fix":{"range":[32138,32189],"text":"[mapCenter, enrichedPlacemarks, getNumericId]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":794,"column":31,"nodeType":"Identifier","endLine":794,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":798,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":798,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32426,32429],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32426,32429],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":801,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":801,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32615,32618],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32615,32618],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'cableSettings.alignmentMethod'. Either include it or remove the dependency array.","line":834,"column":8,"nodeType":"ArrayExpression","endLine":834,"endColumn":65,"suggestions":[{"desc":"Update the dependencies array to be: [map, visibleTowers, placemarkOverrides, cableSettings.alignmentMethod]","fix":{"range":[34307,34364],"text":"[map, visibleTowers, placemarkOverrides, cableSettings.alignmentMethod]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":837,"column":27,"nodeType":"Identifier","endLine":837,"endColumn":34},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":857,"column":5,"nodeType":"Identifier","endLine":857,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":881,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":881,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36312,36315],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36312,36315],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":924,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":924,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37965,37968],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37965,37968],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":924,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":924,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37995,37998],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37995,37998],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":924,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":924,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38023,38026],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38023,38026],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'getEffectiveTransform', 'onUpdatePlacemarkTransform', and 'toast'. Either include them or remove the dependency array. If 'onUpdatePlacemarkTransform' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":988,"column":8,"nodeType":"ArrayExpression","endLine":988,"endColumn":132,"suggestions":[{"desc":"Update the dependencies array to be: [map, isPickingAnchorPosition, pickingAnchorTowerId, pickingAnchorId, pickingPhaseId, towersWithTerrain, placemarkOverrides, getEffectiveTransform, onUpdatePlacemarkTransform, toast]","fix":{"range":[41185,41309],"text":"[map, isPickingAnchorPosition, pickingAnchorTowerId, pickingAnchorId, pickingPhaseId, towersWithTerrain, placemarkOverrides, getEffectiveTransform, onUpdatePlacemarkTransform, toast]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":991,"column":29,"nodeType":"Identifier","endLine":991,"endColumn":36},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":995,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":995,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41556,41559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41556,41559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":1018,"column":29,"nodeType":"Identifier","endLine":1018,"endColumn":36},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1022,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1022,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42673,42676],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42673,42676],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":1036,"column":5,"nodeType":"Identifier","endLine":1036,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1056,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1056,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[44112,44115],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[44112,44115],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1056,"column":108,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1056,"endColumn":111,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[44167,44170],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[44167,44170],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'getModelConfig', 'onUpdatePlacemarkTransform', and 'selectedPlacemark'. Either include them or remove the dependency array. If 'onUpdatePlacemarkTransform' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":1184,"column":8,"nodeType":"ArrayExpression","endLine":1184,"endColumn":109,"suggestions":[{"desc":"Update the dependencies array to be: [map, selectedElement, placemarkOverrides, pickingAnchorId, pickingPhaseId, canUpdate, cableSettings, selectedPlacemark, getModelConfig, onUpdatePlacemarkTransform]","fix":{"range":[49854,49955],"text":"[map, selectedElement, placemarkOverrides, pickingAnchorId, pickingPhaseId, canUpdate, cableSettings, selectedPlacemark, getModelConfig, onUpdatePlacemarkTransform]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'towerBoundingBoxesGeoJSON' is assigned a value but never used.","line":1189,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":1189,"endColumn":36},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":1189,"column":39,"nodeType":"Identifier","endLine":1189,"endColumn":46},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1195,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1195,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[50355,50358],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[50355,50358],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1205,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1205,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[50877,50880],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[50877,50880],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1205,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1205,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[50909,50912],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[50909,50912],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1205,"column":113,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1205,"endColumn":116,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[50931,50934],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[50931,50934],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'towerAlignments'. Either include it or remove the dependency array.","line":1254,"column":8,"nodeType":"ArrayExpression","endLine":1254,"endColumn":66,"suggestions":[{"desc":"Update the dependencies array to be: [towersWithTerrain, placemarkOverrides, towerAlignments, selectedPlacemark?.id]","fix":{"range":[52975,53033],"text":"[towersWithTerrain, placemarkOverrides, towerAlignments, selectedPlacemark?.id]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":1257,"column":37,"nodeType":"Identifier","endLine":1257,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'BOX_SIZE' is assigned a value but never used.","line":1258,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":1258,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1263,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1263,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[53392,53395],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[53392,53395],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1293,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1293,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[55071,55074],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[55071,55074],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1303,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1303,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[55486,55489],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[55486,55489],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'getEffectiveTransform' and 'towersWithTerrain'. Either include them or remove the dependency array.","line":1305,"column":8,"nodeType":"ArrayExpression","endLine":1305,"endColumn":58,"suggestions":[{"desc":"Update the dependencies array to be: [towersWithTerrain, placemarkOverrides, cableSettings?.customModelUrl, cableSettings.towerVerticalOffset, getEffectiveTransform]","fix":{"range":[55510,55560],"text":"[towersWithTerrain, placemarkOverrides, cableSettings?.customModelUrl, cableSettings.towerVerticalOffset, getEffectiveTransform]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":1308,"column":39,"nodeType":"Identifier","endLine":1308,"endColumn":46},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1309,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1309,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[55696,55699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[55696,55699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1312,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1312,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[55785,55788],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[55785,55788],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1332,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1332,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[56844,56847],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[56844,56847],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1332,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1332,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[56876,56879],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[56876,56879],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1332,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1332,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[56898,56901],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[56898,56901],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1342,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1342,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[57521,57524],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[57521,57524],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'getEffectiveTransform' and 'towersWithTerrain'. Either include them or remove the dependency array.","line":1505,"column":8,"nodeType":"ArrayExpression","endLine":1505,"endColumn":58,"suggestions":[{"desc":"Update the dependencies array to be: [towersWithTerrain, placemarkOverrides, cableSettings?.customModelUrl, cableSettings.towerVerticalOffset, cableSettings?.customTexture, getEffectiveTransform]","fix":{"range":[64538,64588],"text":"[towersWithTerrain, placemarkOverrides, cableSettings?.customModelUrl, cableSettings.towerVerticalOffset, cableSettings?.customTexture, getEffectiveTransform]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":1509,"column":26,"nodeType":"Identifier","endLine":1509,"endColumn":33},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":1514,"column":49,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":1514,"endColumn":50,"suggestions":[{"messageId":"removeEscape","fix":{"range":[65077,65078],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[65077,65077],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1575,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1575,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[67871,67874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[67871,67874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1584,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1584,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[68265,68268],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[68265,68268],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1673,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1673,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[72191,72194],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[72191,72194],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'chunkedTowers', 'getEffectiveTransform', 'handleCableClick', 'isAutoConnecting', 'projectAnchors', 'templateAnchors', and 'viewportBounds'. Either include them or remove the dependency array.","line":1675,"column":8,"nodeType":"ArrayExpression","endLine":1675,"endColumn":178,"suggestions":[{"desc":"Update the dependencies array to be: [show3D, towersWithTerrain, projectSpans, cableSettings, placemarkOverrides, hiddenSpans, hiddenPlacemarkIds, projectId, projectAnchors, templateAnchors, getEffectiveTransform, isAutoConnecting, terrainRevision, chunkedTowers, towerAlignments, viewportBounds, handleCableClick, map]","fix":{"range":[72291,72461],"text":"[show3D, towersWithTerrain, projectSpans, cableSettings, placemarkOverrides, hiddenSpans, hiddenPlacemarkIds, projectId, projectAnchors, templateAnchors, getEffectiveTransform, isAutoConnecting, terrainRevision, chunkedTowers, towerAlignments, viewportBounds, handleCableClick, map]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'solidCablesGeoJSON' is assigned a value but never used.","line":1678,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":1678,"endColumn":29},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":1678,"column":32,"nodeType":"Identifier","endLine":1678,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1680,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1680,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[72666,72669],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[72666,72669],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1701,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1701,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[73405,73408],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[73405,73408],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1735,"column":102,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1735,"endColumn":105,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[74597,74600],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[74597,74600],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1751,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1751,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[75317,75320],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[75317,75320],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'scaleZ' is assigned a value but never used.","line":1759,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":1759,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'towerHeight' is assigned a value but never used.","line":1761,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":1761,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1761,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1761,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[76054,76057],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[76054,76057],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'effectiveAltitude' is assigned a value but never used.","line":1764,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":1764,"endColumn":40},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1764,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1764,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[76213,76216],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[76213,76216],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1881,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1881,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[83919,83922],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[83919,83922],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1886,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1886,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[84327,84330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[84327,84330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1886,"column":127,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1886,"endColumn":130,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[84381,84384],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[84381,84384],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1889,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1889,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[84727,84730],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[84727,84730],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1891,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1891,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[84865,84868],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[84865,84868],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1891,"column":123,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1891,"endColumn":126,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[84918,84921],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[84918,84921],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1891,"column":178,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1891,"endColumn":181,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[84973,84976],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[84973,84976],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1891,"column":227,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1891,"endColumn":230,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[85022,85025],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[85022,85025],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1891,"column":276,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1891,"endColumn":279,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[85071,85074],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[85071,85074],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1891,"column":331,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1891,"endColumn":334,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[85126,85129],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[85126,85129],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1903,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1903,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[85947,85950],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[85947,85950],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1916,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1916,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[86705,86708],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[86705,86708],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1917,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1917,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[86792,86795],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[86792,86795],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1918,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1918,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[86877,86880],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[86877,86880],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1919,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1919,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[86976,86979],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[86976,86979],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1943,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1943,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[88355,88358],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[88355,88358],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1943,"column":132,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1943,"endColumn":135,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[88410,88413],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[88410,88413],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1969,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1969,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[90422,90425],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[90422,90425],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1969,"column":140,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1969,"endColumn":143,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[90477,90480],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[90477,90480],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1982,"column":97,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1982,"endColumn":100,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[91551,91554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[91551,91554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1982,"column":152,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1982,"endColumn":155,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[91606,91609],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[91606,91609],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2000,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2000,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[92909,92912],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[92909,92912],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2000,"column":145,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2000,"endColumn":148,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[92964,92967],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[92964,92967],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2001,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2001,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[93099,93102],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[93099,93102],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2001,"column":155,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2001,"endColumn":158,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[93154,93157],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[93154,93157],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2007,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2007,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[93753,93756],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[93753,93756],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2007,"column":169,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2007,"endColumn":172,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[93832,93835],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[93832,93835],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2013,"column":102,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2013,"endColumn":105,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[94324,94327],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[94324,94327],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2014,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2014,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[94456,94459],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[94456,94459],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2014,"column":154,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2014,"endColumn":157,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[94511,94514],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[94511,94514],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2020,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2020,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[95110,95113],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[95110,95113],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2021,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2021,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[95250,95253],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[95250,95253],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2028,"column":93,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2028,"endColumn":96,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[95786,95789],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[95786,95789],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2029,"column":103,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2029,"endColumn":106,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[95925,95928],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[95925,95928],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2029,"column":158,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2029,"endColumn":161,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[95980,95983],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[95980,95983],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2035,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2035,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[96581,96584],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[96581,96584],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2036,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2036,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[96712,96715],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[96712,96715],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2085,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2085,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[100305,100308],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[100305,100308],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2085,"column":144,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2085,"endColumn":147,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[100360,100363],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[100360,100363],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2091,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2091,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[100944,100947],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[100944,100947],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2091,"column":144,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2091,"endColumn":147,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[100999,101002],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[100999,101002],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2123,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2123,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[103932,103935],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[103932,103935],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2123,"column":140,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2123,"endColumn":143,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[103987,103990],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[103987,103990],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2218,"column":168,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2218,"endColumn":171,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[112439,112442],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[112439,112442],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2223,"column":125,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2223,"endColumn":128,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[113017,113020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[113017,113020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2223,"column":182,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2223,"endColumn":185,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[113074,113077],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[113074,113077],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2227,"column":125,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2227,"endColumn":128,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[113534,113537],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[113534,113537],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2227,"column":182,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2227,"endColumn":185,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[113591,113594],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[113591,113594],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2278,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2278,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[117389,117392],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[117389,117392],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2521,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2521,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[133815,133818],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[133815,133818],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2522,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2522,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[133907,133910],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[133907,133910],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2525,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2525,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[134024,134027],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[134024,134027],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":141,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo, useRef } from 'react';\r\nimport { useEnrichedPlacemarks } from '@/hooks/useEnrichedPlacemarks';\r\nimport { Marker, Popup, Source, Layer } from 'react-map-gl/mapbox';\r\nimport type { KMLDocument, KMLPlacemark } from '@/types/kmz';\r\nimport { Box, ExternalLink, X, TowerControl as Tower, Navigation, Pencil, Settings, Ruler, Maximize, RotateCcw, Move, RefreshCw, Save as SaveIcon } from 'lucide-react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { cn } from '@/lib/utils';\r\nimport { useMap } from 'react-map-gl/mapbox';\r\nimport { MapboxOverlay } from '@deck.gl/mapbox';\r\nimport { PathLayer } from '@deck.gl/layers';\r\nimport { useControl } from 'react-map-gl/mapbox';\r\nimport { CatenaryCalculator, Point3D } from '@/services/catenary-calculator';\r\nimport { TowerPhysics } from '@/services/tower-physics';\r\nimport { CableLayerService, CablePath } from '@/services/cable-layer';\r\n\r\nimport { TowerScenegraphService } from '@/services/tower-scenegraph-service';\r\nimport { AnchorDebugService } from '@/services/anchor-debug-service';\r\nimport { STANDARD_PROJECT_ID } from '@/services/anchorService';\r\nimport { CableConfigModal, CableSettings, DEFAULT_CABLE_SETTINGS, CableAnchorConfig, ModelTransform } from './cable-config-modal';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { orionApi } from '@/integrations/orion/client';\r\nimport { Cable } from 'lucide-react';\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue\r\n} from '@/components/ui/select';\r\nimport { Slider } from '@/components/ui/slider';\r\nimport { Label } from '@/components/ui/label';\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogDescription,\r\n    DialogFooter,\r\n} from '@/components/ui/dialog';\r\n\r\n\r\nimport {\r\n    AlertDialog,\r\n    AlertDialogAction,\r\n    AlertDialogCancel,\r\n    AlertDialogContent,\r\n    AlertDialogDescription,\r\n    AlertDialogFooter,\r\n    AlertDialogHeader,\r\n    AlertDialogTitle,\r\n} from '@/components/ui/alert-dialog';\r\n\r\nimport * as turf from '@turf/turf';\r\nimport { features } from 'process';\r\n\r\nconst LOCAL_MODEL_ID = 'industrial-tower';\r\nconst LOCAL_MODEL_URL = `${window.location.origin}/models/towers/scene.gltf`;\r\n\r\nfunction DeckGLOverlay(props: Record<string, unknown>) {\r\n    const overlay = useControl<MapboxOverlay>(\r\n        () => new MapboxOverlay(props),\r\n        ({ map }: { map: unknown }) => {\r\n            if (map && (map as Record<string, unknown>).removeControl) {\r\n                // MapboxOverlay remove is handled by useControl\r\n            }\r\n        }\r\n    );\r\n\r\n    useEffect(() => {\r\n        if (overlay) {\r\n            overlay.setProps(props);\r\n        }\r\n    }, [props, overlay]);\r\n\r\n    return null;\r\n}\r\n\r\ninterface Mapbox3DLayerProps {\r\n    kmlDocuments: KMLDocument[];\r\n    show3D: boolean;\r\n    selectedPlacemark?: KMLPlacemark | null;\r\n    onSelectPlacemark?: (placemark: KMLPlacemark | null) => void;\r\n    hiddenPlacemarkIds?: Set<string>;\r\n    placemarkOverrides?: Record<string, {\r\n        name?: string,\r\n        angle?: number,\r\n        color?: string,\r\n        texture?: string,\r\n        height?: number,\r\n        elevation?: number,\r\n        customModelUrl?: string,\r\n        customModelTransform?: ModelTransform\r\n    }>;\r\n    onHidePlacemark?: (docId: string, placemark: KMLPlacemark) => void;\r\n    onUpdatePlacemarkAngle?: (docId: string, elementId: string, newAngle: number) => void;\r\n    onUpdatePlacemarkColor?: (docId: string, elementId: string, newColor: string) => void;\r\n    onUpdatePlacemarkTexture?: (docId: string, elementId: string, newTexture: string) => void;\r\n    onUpdatePlacemarkHeight?: (docId: string, elementId: string, newHeight: number) => void;\r\n    onUpdatePlacemarkElevation?: (docId: string, elementId: string, newElevation: number) => void;\r\n    onUpdatePlacemarkModel?: (docId: string, elementId: string, modelUrl: string) => void;\r\n    onUpdatePlacemarkTransform?: (docId: string, elementId: string, transform: ModelTransform) => void;\r\n    projectSpans?: unknown[];\r\n    projectId?: string;\r\n    cableSettings?: CableSettings;\r\n    onUpdateCableSettings?: (settings: CableSettings) => Promise<void>;\r\n    canUpdate?: boolean;\r\n}\r\n\r\n// Preset colors for quick selection\r\nconst PRESET_COLORS = [\r\n    '#10b981', // emerald\r\n    '#22c55e', // green\r\n    '#84cc16', // lime\r\n    '#eab308', // yellow\r\n    '#f59e0b', // amber\r\n    '#f97316', // orange\r\n    '#ef4444', // red\r\n    '#f43f5e', // rose\r\n    '#ec4899', // pink\r\n    '#d946ef', // fuchsia\r\n    '#8b5cf6', // violet\r\n    '#6366f1', // indigo\r\n    '#3b82f6', // blue\r\n    '#06b6d4', // cyan\r\n    '#14b8a6', // teal\r\n    '#ffffff', // white\r\n    '#94a3b8', // slate\r\n];\r\n\r\nconst dmsToDecimal = (dms: string): number => {\r\n    if (!dms || dms === '0') return 0;\r\n    try {\r\n        // Parse simple decimal first if no formatting\r\n        // Accepts: 145, 145.5, -45.\r\n        // Rejects: 145SE, 145°\r\n        if (!/[°'\"a-z]/i.test(dms)) {\r\n            const num = parseFloat(dms.replace(',', '.'));\r\n            return isNaN(num) ? 0 : num;\r\n        }\r\n\r\n        // Regex robusto para DMS com ou sem segundos e direção opcional (1 ou 2 letras)\r\n        // Groups: 1=Deg, 2=Min, 3=Sec, 4=Dir\r\n        const parts = dms.match(/(\\d+(?:\\.\\d+)?)[°|\\s]?\\s*(?:(\\d+(?:\\.\\d+)?)['|\\s]?)?\\s*(?:(\\d+(?:\\.\\d+)?)\"?)?\\s*([NSEW]{1,2})?/i);\r\n\r\n        if (!parts) {\r\n            const normalized = dms.replace(',', '.').replace(/[^\\d.-]/g, '');\r\n            const num = parseFloat(normalized);\r\n            return isNaN(num) ? 0 : num;\r\n        }\r\n\r\n        const degrees = parseFloat(parts[1]);\r\n        const minutes = parts[2] ? parseFloat(parts[2]) : 0;\r\n        const seconds = parts[3] ? parseFloat(parts[3]) : 0;\r\n        const direction = parts[4]?.toUpperCase();\r\n\r\n        const dd = degrees + (minutes / 60) + (seconds / 3600);\r\n\r\n        // Ajuste básico de direção se necessário (embora azimute geralmente seja 0-360 direto)\r\n        // Se a direção for S ou W, E assumirmos que isso é uma coordenada geográfica, invertemos.\r\n        // Se for um Azimute (Heading), S=180, SW=225, W=270.\r\n        // SE o valor ja for > 90 (ex 145), o sufixo SE é redundante.\r\n        // Vamos apenas ignorar o sufixo se o valor parecer ser um Azimute valido.\r\n\r\n        return dd;\r\n    } catch (err) {\r\n        console.error(\"Erro parsing DMS:\", err);\r\n        const num = parseFloat(dms.replace(',', '.').replace(/[^\\d.-]/g, ''));\r\n        return isNaN(num) ? 0 : num;\r\n    }\r\n};\r\n\r\n\r\nexport function Mapbox3DLayer({\r\n    kmlDocuments,\r\n    show3D,\r\n    selectedPlacemark,\r\n    onSelectPlacemark,\r\n    hiddenPlacemarkIds = new Set(),\r\n    placemarkOverrides = {},\r\n    onHidePlacemark,\r\n    onUpdatePlacemarkAngle,\r\n    onUpdatePlacemarkColor,\r\n    onUpdatePlacemarkHeight,\r\n    onUpdatePlacemarkElevation,\r\n    onUpdatePlacemarkModel,\r\n    onUpdatePlacemarkTransform,\r\n    onUpdatePlacemarkTexture,\r\n    projectSpans = [],\r\n    projectId,\r\n    cableSettings: propCableSettings,\r\n    onUpdateCableSettings,\r\n    canUpdate = false\r\n}: Mapbox3DLayerProps) {\r\n    const { current: map } = useMap();\r\n    const { toast } = useToast();\r\n    const [zoom, setZoom] = useState(map?.getZoom() || 0);\r\n    const [terrainRevision, setTerrainRevision] = useState(0);\r\n    const [viewportBounds, setViewportBounds] = useState<any>(map?.getBounds());\r\n\r\n    // Helper to normalize tower names for stable matching\r\n    const normalizeName = (name: string) => (name || '').trim().toUpperCase();\r\n\r\n    // Helper to calculate bearing between two points - Using TowerPhysics\r\n    const calculateBearing = (lat1: number, lon1: number, lat2: number, lon2: number) => {\r\n        return TowerPhysics.calculateBearing({ lat: lat1, lng: lon1 }, { lat: lat2, lng: lon2 });\r\n    };\r\n\r\n    // Helper to extract numeric ID for sorting\r\n    const getNumericId = (p: Record<string, any>) => {\r\n        const tId = p.id || p.name;\r\n        const meta = towerMetadata[tId];\r\n\r\n        // Priority 1: Professional KM/Index metadata\r\n        if (meta && meta.technicalKm !== undefined && meta.technicalIndex !== undefined) {\r\n            return (meta.technicalKm * 10000) + meta.technicalIndex;\r\n        }\r\n\r\n        // Priority 2: sequence or object_seq from DB\r\n        if (p.sequence !== undefined && p.sequence !== null) return p.sequence;\r\n        if (p.object_seq !== undefined && p.object_seq !== null) return p.object_seq;\r\n\r\n        // Priority 3: Name parsing (0/1, 0/2)\r\n        const name = p.name || '';\r\n        const upper = name.toUpperCase();\r\n        if (upper.includes('TRIO') || upper.includes('SUB') || upper.includes('SE ') || upper.includes('BOP')) {\r\n            const m = upper.match(/\\d+/);\r\n            return m ? parseInt(m[0]) : 0;\r\n        }\r\n        // Support suffixes like 1/1A, 1/1B\r\n        const parts = upper.match(/(\\d+)\\/(\\d+)([A-Z])?/);\r\n        if (parts) {\r\n            let val = parseInt(parts[1]) * 10000; // Structure (e.g. 202)\r\n            val += parseInt(parts[2]) * 100;      // Sequence (e.g. 1)\r\n\r\n            if (parts[3]) {\r\n                val += (parts[3].charCodeAt(0) - 64);\r\n            }\r\n            return val;\r\n        }\r\n        const simple = upper.match(/\\d+/);\r\n        return simple ? parseInt(simple[0]) + 1000 : 2000;\r\n    };\r\n    const [mapCenter, setMapCenter] = useState(map?.getCenter());\r\n    const [isAngleDialogOpen, setIsAngleDialogOpen] = useState(false);\r\n    const [editingAngleValue, setEditingAngleValue] = useState('');\r\n    const [editingAngleElement, setEditingAngleElement] = useState<{ docId: string; elementId: string } | null>(null);\r\n    const [isColorPickerOpen, setIsColorPickerOpen] = useState(false);\r\n    // Estados para edição de altura e elevação\r\n    const [isHeightDialogOpen, setIsHeightDialogOpen] = useState(false);\r\n    const [editingHeightValue, setEditingHeightValue] = useState('');\r\n    const [editingHeightElement, setEditingHeightElement] = useState<{ docId: string; elementId: string } | null>(null);\r\n    const [isElevationDialogOpen, setIsElevationDialogOpen] = useState(false);\r\n    const [editingElevationValue, setEditingElevationValue] = useState('');\r\n    const [editingElevationElement, setEditingElevationElement] = useState<{ docId: string; elementId: string } | null>(null);\r\n\r\n    const [isTransformDialogOpen, setIsTransformDialogOpen] = useState(false);\r\n    const [editingTransform, setEditingTransform] = useState<ModelTransform | null>(null);\r\n    const [editingTransformTarget, setEditingTransformTarget] = useState<{ docId: string; elementId: string } | null>(null);\r\n\r\n    // Estado para exclusão de vãos\r\n    const [isDeleteSpanDialogOpen, setIsDeleteSpanDialogOpen] = useState(false);\r\n    // Visual fix: Armazena IDs de pares ocultados localmente\r\n    const [hiddenSpans, setHiddenSpans] = useState<Set<string>>(new Set());\r\n    const [disconnectingSpan, setDisconnectingSpan] = useState<{\r\n        id: string;\r\n        start: string;\r\n        end: string;\r\n        towerStartId?: string;\r\n        towerEndId?: string;\r\n        source?: string;\r\n        projectId?: string;\r\n    } | null>(null);\r\n\r\n    const [projectAnchors, setProjectAnchors] = useState<Record<string, any[]>>({});\r\n    const [templateAnchors, setTemplateAnchors] = useState<Record<string, any[]>>({});\r\n    const [towerMetadata, setTowerMetadata] = useState<Record<string, any>>({});\r\n\r\n    // Manual Connection State\r\n    const [isConnectingMode, setIsConnectingMode] = useState(false);\r\n    const [firstTowerToConnect, setFirstTowerToConnect] = useState<KMLPlacemark | null>(null);\r\n    const [isAutoConnecting, setIsAutoConnecting] = useState(false);\r\n\r\n    // Anchor Repositioning State\r\n    const [isPickingAnchorPosition, setIsPickingAnchorPosition] = useState(false);\r\n    const [pickingAnchorTowerId, setPickingAnchorTowerId] = useState<string | null>(null);\r\n    const [pickingAnchorId, setPickingAnchorId] = useState<string | null>(null);\r\n    const [pickingPhaseId, setPickingPhaseId] = useState<string | null>(null);\r\n\r\n    const handleConnectTowers = async (targetTower: KMLPlacemark) => {\r\n        if (!projectId || !firstTowerToConnect) return;\r\n\r\n        try {\r\n            const startTower = firstTowerToConnect;\r\n            const endTower = targetTower;\r\n\r\n            const sourceName = startTower.extendedData?.object_id || startTower.extendedData?.objectId || startTower.name;\r\n            const targetName = endTower.extendedData?.object_id || endTower.extendedData?.objectId || endTower.name;\r\n\r\n            // Simplified drivers for manual connection\r\n            const drivers = ['A', 'B', 'C'].map(phase => ({\r\n                phase,\r\n                cableType: 'Manual-Connect',\r\n                voltageKv: 0,\r\n                cableColor: '#0ea5e9'\r\n            }));\r\n\r\n            const { error } = await orionApi\r\n                .from('segments')\r\n                .insert({\r\n                    projectId: projectId,\r\n                    towerStartId: sourceName,\r\n                    towerEndId: targetName,\r\n                    spanLength: 0,\r\n                    elevationStart: parseFloat((startTower.extendedData as any)?.object_height) || 30,\r\n                    conductors: drivers\r\n                });\r\n\r\n            if (error) throw error;\r\n\r\n            toast({\r\n                title: \"Conexão Realizada\",\r\n                description: `Vão criado entre ${startTower.name} e ${endTower.name}.`\r\n            });\r\n\r\n        } catch (err: any) {\r\n            console.error('Error connecting towers:', err);\r\n            toast({\r\n                title: \"Erro ao conectar\",\r\n                description: err.message || \"Não foi possível criar a conexão.\",\r\n                variant: \"destructive\"\r\n            });\r\n        } finally {\r\n            setIsConnectingMode(false);\r\n            setFirstTowerToConnect(null);\r\n            // Re-fetch spans handled by parent or window trigger\r\n            if (typeof (window as any).refetchSpans === 'function') {\r\n                (window as any).refetchSpans();\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleAutoConnectAll = async () => {\r\n        if (!projectId || projectId === 'all') {\r\n            toast({\r\n                title: \"Ação não permitida\",\r\n                description: \"Selecione uma obra específica para auto-conectar.\",\r\n                variant: \"destructive\"\r\n            });\r\n            return;\r\n        }\r\n\r\n        if (!window.confirm(\"Isso irá criar conexões sequenciais entre todas as torres desta obra. Deseja continuar?\")) {\r\n            return;\r\n        }\r\n\r\n        setIsAutoConnecting(true);\r\n        try {\r\n            const { data: towers, error } = await orionApi\r\n                .from('tower_technical_data')\r\n                .select('*')\r\n                .eq('project_id', projectId)\r\n                .order('object_seq', { ascending: true });\r\n\r\n            if (error) throw error;\r\n            if (!towers || towers.length < 2) {\r\n                toast({\r\n                    title: \"Dados insuficientes\",\r\n                    description: \"A obra precisa de pelo menos 2 torres para criar conexões.\",\r\n                    variant: \"destructive\"\r\n                });\r\n                return;\r\n            }\r\n\r\n            let createdCount = 0;\r\n            for (let i = 0; i < towers.length - 1; i++) {\r\n                const src = towers[i];\r\n                const tgt = towers[i + 1];\r\n\r\n                const sourceName = src.object_id || src.objectId || src.name;\r\n                const targetName = tgt.object_id || tgt.objectId || tgt.name;\r\n\r\n                const drivers = ['A', 'B', 'C'].map(phase => ({\r\n                    phase,\r\n                    cableType: 'Auto-Sequence',\r\n                    voltageKv: 0,\r\n                    cableColor: '#0ea5e9'\r\n                }));\r\n\r\n                const { error: insertError } = await orionApi\r\n                    .from('segments')\r\n                    .insert({\r\n                        projectId: projectId,\r\n                        towerStartId: sourceName,\r\n                        towerEndId: targetName,\r\n                        spanLength: 0,\r\n                        elevationStart: parseFloat(src.object_height) || 30,\r\n                        conductors: drivers\r\n                    });\r\n\r\n                if (!insertError) createdCount++;\r\n            }\r\n\r\n            toast({\r\n                title: \"Auto-Conexão Concluída\",\r\n                description: `${createdCount} novos vãos foram gerados sequencialmente.`,\r\n            });\r\n\r\n            if (typeof (window as any).refetchSpans === 'function') {\r\n                (window as any).refetchSpans();\r\n            }\r\n\r\n        } catch (err: any) {\r\n            console.error('Error in AutoConnect:', err);\r\n            toast({\r\n                title: \"Erro na Auto-Conexão\",\r\n                description: err.message,\r\n                variant: \"destructive\"\r\n            });\r\n        } finally {\r\n            setIsAutoConnecting(false);\r\n        }\r\n    };\r\n\r\n    // Fetch all project anchors for 3D linkage\r\n    useEffect(() => {\r\n        if (!projectId) return;\r\n\r\n        const fetchAnchors = async () => {\r\n            try {\r\n                // Instance-specific anchors\r\n                const response = await fetch(`/api/v1/anchors?projectId=${projectId}`);\r\n                if (response.ok) {\r\n                    const data = await response.json();\r\n                    if (data.anchorsMap) {\r\n                        setProjectAnchors(data.anchorsMap);\r\n                        setTowerMetadata(data.towerMetadata || {});\r\n                    } else {\r\n                        // Support legacy format if necessary (though we just updated it)\r\n                        setProjectAnchors(data);\r\n                    }\r\n                }\r\n\r\n                // Global Model Templates\r\n                const tResponse = await fetch(`/api/v1/anchors?projectId=${STANDARD_PROJECT_ID}`);\r\n                if (tResponse.ok) {\r\n                    const tData = await tResponse.json();\r\n                    setTemplateAnchors(tData);\r\n                }\r\n            } catch (err) {\r\n                console.error(\"Failed to fetch project anchors/templates:\", err);\r\n            }\r\n        };\r\n\r\n        fetchAnchors();\r\n    }, [projectId]);\r\n\r\n    const handleCableClick = (info: any, _x: number, _y: number) => {\r\n        if (!info.object || !canUpdate) return;\r\n\r\n        console.log('🔌 Handle Cable Click:', info.object);\r\n\r\n        setDisconnectingSpan({\r\n            id: info.object.id,\r\n            start: info.object.towerStartName || 'Desconhecido A',\r\n            end: info.object.towerEndName || 'Desconhecido B',\r\n            towerStartId: info.object.towerStartId,\r\n            towerEndId: info.object.towerEndId,\r\n            source: info.object.sourceType,\r\n            projectId: info.object.projectId\r\n        });\r\n        setIsDeleteSpanDialogOpen(true);\r\n    };\r\n\r\n    // Use cable settings from props if provided, otherwise fallback to defaults\r\n    // Merge with defaults to ensure all properties exist\r\n    const cableSettings = useMemo(() => {\r\n        return {\r\n            ...DEFAULT_CABLE_SETTINGS,\r\n            ...propCableSettings,\r\n            anchors: propCableSettings?.anchors || DEFAULT_CABLE_SETTINGS.anchors\r\n        };\r\n    }, [propCableSettings]);\r\n\r\n    const [hoveredMarker, setHoveredMarker] = useState<string | null>(null);\r\n\r\n    // Update zoom and center state for reactivity, and refresh terrain elevation\r\n    useEffect(() => {\r\n        if (!map) return;\r\n\r\n        const updateState = () => {\r\n            setZoom(map.getZoom());\r\n            setMapCenter(map.getCenter());\r\n        };\r\n\r\n        // Listen for idle to ensure terrain is fully loaded at the current view\r\n        const handleIdle = () => {\r\n            setTerrainRevision(prev => prev + 1);\r\n        };\r\n\r\n        const onMoveEnd = () => {\r\n            updateState();\r\n            if (map) setViewportBounds(map.getBounds());\r\n        };\r\n\r\n        map.on('moveend', onMoveEnd);\r\n        map.on('zoomend', onMoveEnd);\r\n        map.on('idle', handleIdle);\r\n\r\n        // Initial state\r\n        updateState();\r\n        if (map) setViewportBounds(map.getBounds());\r\n\r\n        return () => {\r\n            map.off('moveend', onMoveEnd);\r\n            map.off('zoomend', onMoveEnd);\r\n            map.off('idle', handleIdle);\r\n        };\r\n    }, [map]);\r\n\r\n    const openInGPS = () => {\r\n        if (!selectedPlacemark) return;\r\n        const { lat, lng } = selectedPlacemark.coordinates;\r\n        const url = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;\r\n        window.open(url, '_blank');\r\n    };\r\n\r\n    // Helper to get consistent model IDs from URLs\r\n    const getModelId = (url: string) => {\r\n        if (!url || url === LOCAL_MODEL_URL) return LOCAL_MODEL_ID;\r\n        const parts = url.split('/');\r\n        const fileName = parts.pop()?.split('?')[0] || 'custom';\r\n        const parentDir = parts.pop() || '';\r\n        const combo = parentDir ? `${parentDir}-${fileName}` : fileName;\r\n        return `model-${combo.replace(/[^a-zA-Z0-9-]/g, '_')}`;\r\n    };\r\n\r\n    // Register all necessary models in Mapbox style\r\n    const allModelUrls = useMemo(() => {\r\n        const urls = new Set<string>();\r\n        urls.add(cableSettings?.customModelUrl || LOCAL_MODEL_URL);\r\n\r\n        // Add models from patterns (e.g. TRIO ports)\r\n        // urls.add(`${window.location.origin}/models/PORTICO-001/scene.gltf`); // MODELO CORROMPIDO\r\n\r\n        // Add models from overrides\r\n        Object.values(placemarkOverrides).forEach(ov => {\r\n            if (ov.customModelUrl) urls.add(ov.customModelUrl);\r\n        });\r\n\r\n        return Array.from(urls).filter(url => !url.startsWith('procedural-'));\r\n    }, [cableSettings?.customModelUrl, placemarkOverrides]);\r\n\r\n    const registeredModels = useRef<Set<string>>(new Set());\r\n\r\n    useEffect(() => {\r\n        if (!map || !show3D) return;\r\n\r\n        const registerModelsAndTextures = () => {\r\n            // 1. Models\r\n            allModelUrls.forEach(url => {\r\n                const id = getModelId(url);\r\n                if (!map.hasModel(id)) {\r\n                    try {\r\n                        console.log(`🏗️ [3D] Registering model: ${id} from ${url}`);\r\n                        map.addModel(id, url);\r\n                        registeredModels.current.add(id);\r\n                    } catch (e) {\r\n                        console.error(`❌ Erro ao carregar modelo 3D (${id}):`, e);\r\n                    }\r\n                }\r\n            });\r\n\r\n            // 2. Procedural Textures (Canvas)\r\n            const textures = [\r\n                { id: 'texture-metal-light', color: [212, 212, 216], type: 'metal' },\r\n                { id: 'texture-metal-medium', color: [161, 161, 170], type: 'metal' },\r\n                { id: 'texture-concrete-dark', color: [82, 82, 91], type: 'concrete' },\r\n                { id: 'texture-rust', color: [124, 45, 18], type: 'rust' }, // #7c2d12 (amber-900)\r\n                { id: 'texture-warning', color: [234, 179, 8], type: 'stripes' }, // #eab308 (yellow-500)\r\n                { id: 'texture-wood', color: [113, 63, 18], type: 'wood' } // #78350f (amber-900)\r\n            ];\r\n\r\n            textures.forEach(tex => {\r\n                if (map.hasImage(tex.id)) return;\r\n\r\n                const size = 64;\r\n                const canvas = document.createElement('canvas');\r\n                canvas.width = size;\r\n                canvas.height = size;\r\n                const ctx = canvas.getContext('2d');\r\n                if (!ctx) return;\r\n\r\n                // Base Fill\r\n                ctx.fillStyle = `rgb(${tex.color[0]}, ${tex.color[1]}, ${tex.color[2]})`;\r\n                ctx.fillRect(0, 0, size, size);\r\n\r\n                // Specific Patterns\r\n                if (tex.type === 'stripes') {\r\n                    // Warning Stripes (Black/Yellow)\r\n                    ctx.fillStyle = 'rgba(0,0,0,0.8)';\r\n                    ctx.beginPath();\r\n                    for (let x = -size; x < size * 2; x += 16) {\r\n                        ctx.moveTo(x, 0);\r\n                        ctx.lineTo(x - 8, size);\r\n                        ctx.lineTo(x + 8, size);\r\n                        ctx.lineTo(x + 16, 0);\r\n                    }\r\n                    ctx.fill();\r\n                } else if (tex.type === 'wood') {\r\n                    // Wood Grain\r\n                    ctx.strokeStyle = 'rgba(60, 20, 0, 0.3)';\r\n                    for (let i = 0; i < 10; i++) {\r\n                        ctx.beginPath();\r\n                        ctx.moveTo(0, Math.random() * size);\r\n                        ctx.bezierCurveTo(\r\n                            size / 3, Math.random() * size,\r\n                            2 * size / 3, Math.random() * size,\r\n                            size, Math.random() * size\r\n                        );\r\n                        ctx.lineWidth = 1 + Math.random() * 2;\r\n                        ctx.stroke();\r\n                    }\r\n                } else if (tex.type === 'rust') {\r\n                    // Heavy Rust Noise\r\n                    for (let i = 0; i < size * size; i++) {\r\n                        if (Math.random() > 0.4) {\r\n                            const x = Math.random() * size;\r\n                            const y = Math.random() * size;\r\n                            const alpha = Math.random() * 0.4;\r\n                            ctx.fillStyle = Math.random() > 0.5 ? `rgba(60, 20, 0, ${alpha})` : `rgba(160, 80, 20, ${alpha})`;\r\n                            ctx.fillRect(x, y, 2, 2);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // General Noise (Grain) for all non-stripes\r\n                if (tex.type !== 'stripes') {\r\n                    for (let i = 0; i < size; i += 2) {\r\n                        for (let j = 0; j < size; j += 2) {\r\n                            if (Math.random() > 0.8) {\r\n                                const alpha = Math.random() * 0.1;\r\n                                const shade = Math.random() > 0.5 ? 255 : 0;\r\n                                ctx.fillStyle = `rgba(${shade}, ${shade}, ${shade}, ${alpha})`;\r\n                                ctx.fillRect(i, j, 2, 2);\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // Scratches\r\n                    ctx.strokeStyle = `rgba(0,0,0,0.1)`;\r\n                    ctx.lineWidth = 1;\r\n                    for (let k = 0; k < 4; k++) {\r\n                        ctx.beginPath();\r\n                        const x = Math.random() * size;\r\n                        const y = Math.random() * size;\r\n                        ctx.moveTo(x, y);\r\n                        ctx.lineTo(x + (Math.random() - 0.5) * 15, y + (Math.random() - 0.5) * 15);\r\n                        ctx.stroke();\r\n                    }\r\n                }\r\n\r\n                // Border \r\n                ctx.strokeStyle = `rgba(0,0,0,0.15)`;\r\n                ctx.lineWidth = 1;\r\n                ctx.strokeRect(0, 0, size, size);\r\n\r\n                const imgData = ctx.getImageData(0, 0, size, size);\r\n                map.addImage(tex.id, imgData, { pixelRatio: 1 });\r\n            });\r\n        };\r\n\r\n        if (map.isStyleLoaded()) {\r\n            registerModelsAndTextures();\r\n        } else {\r\n            map.once('style.load', registerModelsAndTextures);\r\n        }\r\n    }, [map, allModelUrls, show3D]);\r\n\r\n    // Get transform config for a given model URL\r\n    // IMPORTANT: If the URL is LOCAL_MODEL_URL (default model), also check 'default' key\r\n    const getModelConfig = (url: string) => {\r\n        // First, try the exact key\r\n        const exactKey = url || 'default';\r\n        const exactConfig = cableSettings?.modelConfigs?.[exactKey];\r\n        if (exactConfig) return exactConfig;\r\n\r\n        // If using the LOCAL_MODEL_URL (built-in tower), also check the 'default' key\r\n        if (url === LOCAL_MODEL_URL) {\r\n            return cableSettings?.modelConfigs?.['default'];\r\n        }\r\n\r\n        return undefined;\r\n    };\r\n\r\n    // Helper: Merge individual transform with model defaults, applying global Yaw when individual is 0 or undefined\r\n    const getEffectiveTransform = (individualTransform: ModelTransform | undefined, modelUrl: string) => {\r\n        const modelCfg = getModelConfig(modelUrl);\r\n\r\n\r\n        // If no individual transform, use model config entirely\r\n        if (!individualTransform) {\r\n            return modelCfg;\r\n        }\r\n\r\n        // If individual transform exists but Yaw (rotation[2]) is 0, inherit from model default\r\n        const individualYaw = individualTransform.rotation?.[2] ?? 0;\r\n        const defaultYaw = modelCfg?.rotation?.[2] ?? 0;\r\n\r\n        // Apply default Yaw if individual is 0 and default is non-zero\r\n        if (individualYaw === 0 && defaultYaw !== 0) {\r\n            return {\r\n                ...individualTransform,\r\n                rotation: [\r\n                    individualTransform.rotation?.[0] ?? 0,\r\n                    individualTransform.rotation?.[1] ?? 0,\r\n                    defaultYaw // Use the global default Yaw\r\n                ] as [number, number, number]\r\n            };\r\n        }\r\n\r\n        return individualTransform;\r\n    };\r\n\r\n\r\n    if (!show3D) return null;\r\n\r\n    const isZoomedIn = zoom > 13.5; // Aproximadamente 1000m de distância\r\n    const isVeryClose = zoom > 18;  // Aproximadamente 100m de distância (modo detalhado na superfície)\r\n\r\n    // Filter placemarks - heading will come from database via extendedData\r\n    const enrichedPlacemarks = useEnrichedPlacemarks(kmlDocuments, placemarkOverrides, hiddenPlacemarkIds, projectId);\r\n\r\n    // Simplified enriched placemarks with distance filtering + Reference Point Correction\r\n    const visibleTowers = useMemo(() => {\r\n        if (!mapCenter) return [];\r\n\r\n        const MAX_DISTANCE_METERS = 10000;\r\n        const getDist = (lat1: number, lon1: number, lat2: number, lon2: number) => {\r\n            const R = 6371e3;\r\n            const φ1 = lat1 * Math.PI / 180;\r\n            const φ2 = lat2 * Math.PI / 180;\r\n            const Δφ = (lat2 - lat1) * Math.PI / 180;\r\n            const Δλ = (lon2 - lon1) * Math.PI / 180;\r\n            const a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +\r\n                Math.cos(φ1) * Math.cos(φ2) *\r\n                Math.sin(Δλ / 2) * Math.sin(Δλ / 2);\r\n            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n        };\r\n\r\n        // 1. Separate Towers and Reference Points\r\n        const potentialTowers: any[] = [];\r\n        const referencePoints: any[] = [];\r\n\r\n        enrichedPlacemarks.forEach(p => {\r\n            // Check implicit type from useEnrichedPlacemarks\r\n            if ((p as any).isReferencePoint) {\r\n                referencePoints.push(p);\r\n            } else {\r\n                potentialTowers.push(p);\r\n            }\r\n        });\r\n\r\n        // 2. Map towers and apply correction if a reference point is nearby\r\n        const correctedTowers = potentialTowers.map(t => {\r\n            let bestAlt = t.elevation;\r\n            let foundRef = false;\r\n\r\n            // Find nearest reference point within 40m\r\n            let minDist = 40;\r\n\r\n            for (const ref of referencePoints) {\r\n                const d = getDist(t.coordinates.lat, t.coordinates.lng, ref.coordinates.lat, ref.coordinates.lng);\r\n                if (d < minDist) {\r\n                    minDist = d;\r\n                    // Prefer elevation from metadata, fallback to coordinates\r\n                    bestAlt = ref.elevation !== undefined && ref.elevation !== 0 ? ref.elevation : ref.coordinates.altitude;\r\n                    foundRef = true;\r\n                }\r\n            }\r\n\r\n            if (foundRef) {\r\n                // Return new object with corrected elevation\r\n                return { ...t, elevation: bestAlt, isCorrected: true };\r\n            }\r\n            return t;\r\n        });\r\n\r\n        // 3. Keep all towers (Preserve hidden towers for cable logic)\r\n        return correctedTowers.sort((a, b) => getNumericId(a) - getNumericId(b));\r\n    }, [enrichedPlacemarks, mapCenter, hiddenPlacemarkIds]);\r\n\r\n    // 4. Resolve Terrain Elevation for towers that lack it\r\n    const towersWithTerrain = useMemo(() => {\r\n        if (!map) return visibleTowers;\r\n\r\n        return visibleTowers.map((p, idx) => {\r\n            const docId = (p as any).document_id || '';\r\n            const compositeId = `${docId}:::${p.id}`;\r\n            const override = placemarkOverrides[compositeId];\r\n            const extData = p.extendedData as any;\r\n\r\n            // NEW Priority: Override > Terrain Query (Surface Snap) > DB Elevation > fallback 0\r\n            // IMPORTANT: We ignore p.coordinates.altitude from KMZ because it's often ellipsoidal \r\n            // and causes objects to float hundreds of meters above the visual terrain.\r\n            const dbElevation = parseFloat(extData?.['elevation']) || parseFloat(extData?.['object_elevation']) || parseFloat(extData?.['objectElevation']) || p.coordinates.altitude || 0;\r\n            const terrainElevAtPoint = map.queryTerrainElevation([p.coordinates.lng, p.coordinates.lat]);\r\n\r\n            let currentElevation = override?.elevation;\r\n\r\n            if (currentElevation === undefined || currentElevation === null) {\r\n                // Priority: Terrain Query (if ready) > DB Elevation > fallback 0\r\n                if (terrainElevAtPoint !== null && terrainElevAtPoint !== undefined && !isNaN(terrainElevAtPoint) && terrainElevAtPoint !== 0) {\r\n                    currentElevation = terrainElevAtPoint;\r\n                } else {\r\n                    currentElevation = dbElevation;\r\n                }\r\n            }\r\n\r\n\r\n            const currentHeight = override?.height ?? p.towerHeight;\r\n\r\n            // NEW: Calculate professional bearing (using configured method)\r\n            const currentHeading = TowerPhysics.calculateTowerBearing(idx, visibleTowers, cableSettings.alignmentMethod);\r\n\r\n            return {\r\n                ...p,\r\n                elevation: currentElevation,\r\n                terrainElevation: terrainElevAtPoint,\r\n                towerHeight: currentHeight,\r\n                calculatedHeading: currentHeading\r\n            };\r\n        });\r\n    }, [visibleTowers, map, placemarkOverrides, terrainRevision]); // Included terrainRevision to force refresh\r\n\r\n    // 5. Apply Spatial Chunking for Rendering Performance\r\n    const chunkedTowers = useMemo(() => {\r\n        if (!viewportBounds || towersWithTerrain.length < 50) return towersWithTerrain;\r\n\r\n        // Buffers de segurança (em graus - aprox 2.2km lat / var lng)\r\n        const LAT_BUFFER = 0.02;\r\n        const LNG_BUFFER = 0.03;\r\n\r\n        const west = viewportBounds.getWest() - LNG_BUFFER;\r\n        const east = viewportBounds.getEast() + LNG_BUFFER;\r\n        const south = viewportBounds.getSouth() - LAT_BUFFER;\r\n        const north = viewportBounds.getNorth() + LAT_BUFFER;\r\n\r\n        return towersWithTerrain.filter(t => {\r\n            const lng = t.coordinates.lng;\r\n            const lat = t.coordinates.lat;\r\n            return lng >= west && lng <= east && lat >= south && lat <= north;\r\n        });\r\n    }, [towersWithTerrain, viewportBounds]);\r\n\r\n    // Anchor Repositioning Logic\r\n    useEffect(() => {\r\n        if (!map || !isPickingAnchorPosition || !pickingAnchorTowerId) return;\r\n\r\n        // Disable all map interactions to prevent camera movement while picking\r\n        const originalInteractions = {\r\n            dragPan: map.dragPan?.isEnabled(),\r\n            scrollZoom: map.scrollZoom?.isEnabled(),\r\n            boxZoom: map.boxZoom?.isEnabled(),\r\n            dragRotate: map.dragRotate?.isEnabled(),\r\n            doubleClickZoom: map.doubleClickZoom?.isEnabled(),\r\n            keyboard: map.keyboard?.isEnabled(),\r\n            touchZoomRotate: map.touchZoomRotate?.isEnabled(),\r\n            touchPitch: map.touchPitch?.isEnabled()\r\n        };\r\n\r\n        map.dragPan?.disable();\r\n        map.scrollZoom?.disable();\r\n        map.boxZoom?.disable();\r\n        map.dragRotate?.disable();\r\n        map.doubleClickZoom?.disable();\r\n        map.keyboard?.disable();\r\n        map.touchZoomRotate?.disable();\r\n        map.touchPitch?.disable();\r\n\r\n        const onMapClick = (e: any) => {\r\n            // Only left click\r\n            if (!e.originalEvent || e.originalEvent.button !== 0) return;\r\n\r\n            e.preventDefault();\r\n\r\n            // Find the tower\r\n            const tower = towersWithTerrain.find(t => t.id === pickingAnchorTowerId);\r\n            if (!tower) return;\r\n\r\n            // Calculate Delta in Meters\r\n            const clickLng = e.lngLat.lng;\r\n            const clickLat = e.lngLat.lat;\r\n            const towerLng = tower.coordinates.lng;\r\n            const towerLat = tower.coordinates.lat;\r\n\r\n            // Meters conversion\r\n            const mToDegLat = 1 / 111320;\r\n            const mToDegLng = 1 / (111320 * Math.cos(towerLat * Math.PI / 180));\r\n\r\n            const dx_raw = (clickLng - towerLng) / mToDegLng;\r\n            const dy_raw = (clickLat - towerLat) / mToDegLat;\r\n            const dz = 0;\r\n\r\n            // Movement Limit (Constraint) - Request: \"só movimentar dentro da area da torre!!\"\r\n            const MAX_DISTANCE = 30; // 15 meters\r\n            const distance = Math.sqrt(dx_raw * dx_raw + dy_raw * dy_raw);\r\n\r\n            let dx = dx_raw;\r\n            let dy = dy_raw;\r\n\r\n            if (distance > MAX_DISTANCE) {\r\n                const ratio = MAX_DISTANCE / distance;\r\n                dx *= ratio;\r\n                dy *= ratio;\r\n                toast({\r\n                    title: \"Limite Atingido! 🛡️\",\r\n                    description: `O ajuste foi limitado a ${MAX_DISTANCE}m da torre para manter a integridade.`,\r\n                    variant: \"destructive\"\r\n                });\r\n            }\r\n\r\n            // Save to overrides\r\n            const docId = (tower as any).document_id || (tower as any).projectId || (tower as any).project_id;\r\n            const compositeId = `${docId}:::${tower.id}`;\r\n            const currentOverride = placemarkOverrides[compositeId];\r\n\r\n            const currentTransform = getEffectiveTransform(currentOverride?.customModelTransform, currentOverride?.customModelUrl || LOCAL_MODEL_URL);\r\n\r\n            const newTransform: ModelTransform = {\r\n                ...currentTransform,\r\n                scale: currentTransform?.scale || [1, 1, 1],\r\n                rotation: currentTransform?.rotation || [0, 0, 0],\r\n                offset: currentTransform?.offset || [0, 0, 0],\r\n                baseHeight: currentTransform?.baseHeight || 1,\r\n            };\r\n\r\n            if (pickingPhaseId) {\r\n                // Group Phase Override (Requested: \"os 4 cabos de 1 vez\")\r\n                newTransform.phaseOverrides = {\r\n                    ...(currentTransform?.phaseOverrides || {}),\r\n                    [pickingPhaseId]: { x: dx, y: dy, z: dz }\r\n                };\r\n            } else if (pickingAnchorId) {\r\n                // Individual Anchor Override\r\n                newTransform.anchorOverrides = {\r\n                    ...(currentTransform?.anchorOverrides || {}),\r\n                    [pickingAnchorId]: { x: dx, y: dy, z: dz }\r\n                };\r\n            } else {\r\n                // Global Tower Override\r\n                newTransform.anchorGlobalOffset = { x: dx, y: dy, z: dz };\r\n            }\r\n\r\n            if (onUpdatePlacemarkTransform && docId) {\r\n                onUpdatePlacemarkTransform(docId, tower.id, newTransform);\r\n                toast({\r\n                    title: pickingPhaseId ? `Grupo ${pickingPhaseId} Ajustado! ⚡` : (pickingAnchorId ? `Mísula ${pickingAnchorId} Ajustada! ⚡` : \"Posição Fixada! ✅\"),\r\n                    description: `O ponto foi movido ${pickingPhaseId ? 'em grupo' : (pickingAnchorId ? 'individualmente' : 'globalmente')}.`,\r\n                    duration: 4000\r\n                });\r\n            }\r\n\r\n            // Exit mode\r\n            setIsPickingAnchorPosition(false);\r\n            setPickingAnchorTowerId(null);\r\n            setPickingAnchorId(null);\r\n            setPickingPhaseId(null);\r\n        };\r\n\r\n        map.on('click', onMapClick);\r\n        map.getCanvas().style.cursor = 'crosshair';\r\n\r\n        return () => {\r\n            map.off('click', onMapClick);\r\n            map.getCanvas().style.cursor = '';\r\n\r\n            // Restore map interactions using original states\r\n            if (originalInteractions.dragPan !== false) map.dragPan?.enable();\r\n            if (originalInteractions.scrollZoom !== false) map.scrollZoom?.enable();\r\n            if (originalInteractions.boxZoom !== false) map.boxZoom?.enable();\r\n            if (originalInteractions.dragRotate !== false) map.dragRotate?.enable();\r\n            if (originalInteractions.doubleClickZoom !== false) map.doubleClickZoom?.enable();\r\n            if (originalInteractions.keyboard !== false) map.keyboard?.enable();\r\n            if (originalInteractions.touchZoomRotate !== false) map.touchZoomRotate?.enable();\r\n            if (originalInteractions.touchPitch !== false) map.touchPitch?.enable();\r\n        };\r\n    }, [map, isPickingAnchorPosition, pickingAnchorTowerId, pickingAnchorId, pickingPhaseId, towersWithTerrain, placemarkOverrides]);\r\n\r\n    // Derive selected element (Tower or Span)\r\n    const towerAlignments = useMemo(() => {\r\n        const alignments = new Map<string, number>();\r\n\r\n        towersWithTerrain.forEach((tower, index) => {\r\n            const docId = (tower as any).document_id || '';\r\n            const compositeId = `${docId}:::${tower.id}`;\r\n            const override = placemarkOverrides[compositeId];\r\n\r\n            // Get mode from individual override, or default to bisector\r\n            const mode = override?.customModelTransform?.alignmentMode || 'bisector';\r\n            const manualAngle = override?.customModelTransform?.alignmentManualAngle;\r\n\r\n            if (mode === 'manual' && manualAngle !== undefined) {\r\n                alignments.set(tower.id, manualAngle);\r\n            } else {\r\n                const bearing = TowerPhysics.calculateTowerBearing(\r\n                    index,\r\n                    towersWithTerrain,\r\n                    mode === 'tangential' ? 'tangential' : 'bisector'\r\n                );\r\n                alignments.set(tower.id, bearing);\r\n            }\r\n        });\r\n\r\n        return alignments;\r\n    }, [towersWithTerrain, placemarkOverrides]);\r\n\r\n    const selectedElement = useMemo(() => {\r\n        if (!selectedPlacemark) return null;\r\n\r\n        // Check if it's a Span (Virtual)\r\n        if ((selectedPlacemark.extendedData as any)?.source === '3d_cable_virtual_layer') {\r\n            return selectedPlacemark;\r\n        }\r\n\r\n        // Check if it's a Tower\r\n        let found = towersWithTerrain.find(p => p.id === selectedPlacemark.id);\r\n        if (!found) {\r\n            const normalizedName = (selectedPlacemark.name || '').trim().toUpperCase();\r\n            found = towersWithTerrain.find(p => (p.name || '').trim().toUpperCase() === normalizedName);\r\n        }\r\n        return found || selectedPlacemark;\r\n    }, [selectedPlacemark, towersWithTerrain]);\r\n\r\n    // Keyboard Navigation (WASD + Arrows)\r\n    useEffect(() => {\r\n        if (!map) return;\r\n\r\n        const handleKeyDown = (e: KeyboardEvent) => {\r\n            // Ignore if in input/textarea\r\n            if (['INPUT', 'TEXTAREA'].includes((e.target as HTMLElement).tagName)) return;\r\n\r\n            const isShift = e.shiftKey;\r\n            const moveStepMap = 0.0001; // Map panning (~10m)\r\n            const moveStepAnchor = 0.1; // Anchor movement (10cm)\r\n            const zoomStep = 0.2;\r\n            const rotateStep = 5; // Degrees\r\n\r\n            const center = map.getCenter();\r\n            const zoom = map.getZoom();\r\n            const bearing = map.getBearing();\r\n            const pitch = map.getPitch();\r\n\r\n            // If Shift is pressed, we might be moving the anchor\r\n            if (isShift && selectedPlacemark && canUpdate) {\r\n                const docId = (selectedPlacemark as any).document_id || (selectedPlacemark.extendedData as any)?.document_id;\r\n                const compositeId = `${docId}:::${selectedPlacemark.id}`;\r\n                const override = placemarkOverrides[compositeId];\r\n\r\n                const currentModelUrl = override?.customModelUrl || cableSettings?.customModelUrl || LOCAL_MODEL_URL;\r\n                const currentTransform = override?.customModelTransform || getModelConfig(currentModelUrl) || { scale: [1, 1, 1], rotation: [0, 0, 0], offset: [0, 0, 0], baseHeight: 1 };\r\n\r\n                const newTransform: ModelTransform = { ...currentTransform };\r\n                const currentGlobalOffset = currentTransform.anchorGlobalOffset || { x: 0, y: 0, z: 0 };\r\n                const phaseOverride = pickingPhaseId ? currentTransform.phaseOverrides?.[pickingPhaseId] : null;\r\n                const individualOffset = pickingAnchorId ? currentTransform.anchorOverrides?.[pickingAnchorId] : null;\r\n\r\n                let dx = 0;\r\n                let dy = 0;\r\n\r\n                switch (e.code) {\r\n                    case 'KeyW':\r\n                    case 'ArrowUp':\r\n                        dy = moveStepAnchor;\r\n                        break;\r\n                    case 'KeyS':\r\n                    case 'ArrowDown':\r\n                        dy = -moveStepAnchor;\r\n                        break;\r\n                    case 'KeyA':\r\n                    case 'ArrowLeft':\r\n                        dx = -moveStepAnchor;\r\n                        break;\r\n                    case 'KeyD':\r\n                    case 'ArrowRight':\r\n                        dx = moveStepAnchor;\r\n                        break;\r\n                    default:\r\n                        return; // Don't handle other keys here\r\n                }\r\n\r\n                e.preventDefault();\r\n\r\n                if (pickingPhaseId) {\r\n                    newTransform.phaseOverrides = {\r\n                        ...(currentTransform.phaseOverrides || {}),\r\n                        [pickingPhaseId]: {\r\n                            x: (phaseOverride?.x ?? currentGlobalOffset.x) + dx,\r\n                            y: (phaseOverride?.y ?? currentGlobalOffset.y) + dy,\r\n                            z: (phaseOverride?.z ?? currentGlobalOffset.z)\r\n                        }\r\n                    };\r\n                } else if (pickingAnchorId) {\r\n                    newTransform.anchorOverrides = {\r\n                        ...(currentTransform.anchorOverrides || {}),\r\n                        [pickingAnchorId]: {\r\n                            x: (individualOffset?.x ?? currentGlobalOffset.x) + dx,\r\n                            y: (individualOffset?.y ?? currentGlobalOffset.y) + dy,\r\n                            z: (individualOffset?.z ?? currentGlobalOffset.z)\r\n                        }\r\n                    };\r\n                } else {\r\n                    newTransform.anchorGlobalOffset = {\r\n                        x: currentGlobalOffset.x + dx,\r\n                        y: currentGlobalOffset.y + dy,\r\n                        z: currentGlobalOffset.z\r\n                    };\r\n                }\r\n\r\n                if (onUpdatePlacemarkTransform && docId) {\r\n                    onUpdatePlacemarkTransform(docId, selectedElement.id, newTransform);\r\n                }\r\n                return;\r\n            }\r\n\r\n            // Standard Map Navigation (No Shift or No Selection)\r\n            switch (e.code) {\r\n                // Panning\r\n                case 'KeyW':\r\n                case 'ArrowUp':\r\n                    e.preventDefault();\r\n                    map.easeTo({ center: [center.lng, center.lat + moveStepMap], duration: 100 });\r\n                    break;\r\n                case 'KeyS':\r\n                case 'ArrowDown':\r\n                    e.preventDefault();\r\n                    map.easeTo({ center: [center.lng, center.lat - moveStepMap], duration: 100 });\r\n                    break;\r\n                case 'KeyA':\r\n                case 'ArrowLeft':\r\n                    e.preventDefault();\r\n                    map.easeTo({ center: [center.lng - moveStepMap, center.lat], duration: 100 });\r\n                    break;\r\n                case 'KeyD':\r\n                case 'ArrowRight':\r\n                    e.preventDefault();\r\n                    map.easeTo({ center: [center.lng + moveStepMap, center.lat], duration: 100 });\r\n                    break;\r\n\r\n                // Zooming (Q / E)\r\n                case 'KeyQ':\r\n                    e.preventDefault();\r\n                    map.easeTo({ zoom: zoom - zoomStep, duration: 100 });\r\n                    break;\r\n                case 'KeyE':\r\n                    e.preventDefault();\r\n                    map.easeTo({ zoom: zoom + zoomStep, duration: 100 });\r\n                    break;\r\n\r\n                // Rotation (R / F)\r\n                case 'KeyR':\r\n                    e.preventDefault();\r\n                    map.easeTo({ bearing: bearing - rotateStep, duration: 100 });\r\n                    break;\r\n                case 'KeyF':\r\n                    e.preventDefault();\r\n                    map.easeTo({ bearing: bearing + rotateStep, duration: 100 });\r\n                    break;\r\n\r\n                // Pitch (Z / X)\r\n                case 'KeyZ':\r\n                    e.preventDefault();\r\n                    map.easeTo({ pitch: Math.max(0, pitch - 5), duration: 100 });\r\n                    break;\r\n                case 'KeyX':\r\n                    e.preventDefault();\r\n                    map.easeTo({ pitch: Math.min(85, pitch + 5), duration: 100 });\r\n                    break;\r\n            }\r\n        };\r\n\r\n        window.addEventListener('keydown', handleKeyDown);\r\n        return () => window.removeEventListener('keydown', handleKeyDown);\r\n    }, [map, selectedElement, placemarkOverrides, pickingAnchorId, pickingPhaseId, canUpdate, cableSettings]);\r\n\r\n    // GeoJSON for Mapbox Model Layer - Using TowerLayerService\r\n\r\n    // GeoJSON for 3D Bounding Boxes around towers\r\n    const towerBoundingBoxesGeoJSON = useMemo(() => {\r\n        const BOX_SIZE = 0.00000; // ~25 meters\r\n\r\n        return {\r\n            type: 'FeatureCollection',\r\n            features: towersWithTerrain.filter(p => p.isLocal).map(p => {\r\n                const docId = (p as any).document_id || '';\r\n                const compositeId = `${docId}:::${p.id}`;\r\n                const override = placemarkOverrides[compositeId];\r\n                const towerHeight = override?.height ?? p.towerHeight ?? 30;\r\n                const lng = p.coordinates.lng;\r\n                const lat = p.coordinates.lat;\r\n\r\n                // Rotation logic\r\n                const rotation = override?.angle !== undefined\r\n                    ? override.angle\r\n                    : (towerAlignments.get(p.id) ?? (p as any).calculatedHeading ?? (p as any).heading ?? (p as any).rotation ?? 0);\r\n                const rad = -rotation * (Math.PI / 180); // Negate for Clockwise\r\n                const cos = Math.cos(rad);\r\n                const sin = Math.sin(rad);\r\n\r\n                const rotatePoint = (px: number, py: number) => {\r\n                    const dx = px - lng;\r\n                    const dy = py - lat;\r\n                    // Rotate\r\n                    const rx = dx * cos - dy * sin;\r\n                    const ry = dx * sin + dy * cos;\r\n                    return [lng + rx, lat + ry];\r\n                };\r\n\r\n                // Create a square polygon around the tower WITH Z coordinates for 3D elevation\r\n                const halfSize = BOX_SIZE / 2;\r\n                const z = towerHeight; // Z = tower height for elevated outline\r\n\r\n                // Base coordinates (unrotated) relative to center\r\n                const p1 = rotatePoint(lng - halfSize, lat - halfSize);\r\n                const p2 = rotatePoint(lng + halfSize, lat - halfSize);\r\n                const p3 = rotatePoint(lng + halfSize, lat + halfSize);\r\n                const p4 = rotatePoint(lng - halfSize, lat + halfSize);\r\n\r\n                const polygon = [\r\n                    [p1[0], p1[1], z],\r\n                    [p2[0], p2[1], z],\r\n                    [p3[0], p3[1], z],\r\n                    [p4[0], p4[1], z],\r\n                    [p1[0], p1[1], z] // Close the polygon\r\n                ];\r\n\r\n                return {\r\n                    type: 'Feature',\r\n                    properties: {\r\n                        id: p.id,\r\n                        name: p.name,\r\n                        towerHeight: towerHeight,\r\n                        heading: rotation,\r\n                        color: override?.color || '#00ffff',\r\n                        isSelected: selectedPlacemark?.id === p.id\r\n                    },\r\n                    geometry: {\r\n                        type: 'Polygon',\r\n                        coordinates: [polygon]\r\n                    }\r\n                };\r\n            })\r\n        };\r\n    }, [towersWithTerrain, placemarkOverrides, selectedPlacemark]);\r\n\r\n    // GeoJSON for elevated tower outlines (LineStrings with Z coordinates)\r\n    const towerTopOutlinesGeoJSON = useMemo(() => {\r\n        const BOX_SIZE = 0.00025; // Increased to match bounding box size\r\n\r\n        return {\r\n            type: 'FeatureCollection',\r\n            features: towersWithTerrain.map(p => {\r\n                const docId = (p as any).document_id || '';\r\n                const compositeId = `${docId}:::${p.id}`;\r\n                const override = placemarkOverrides[compositeId];\r\n                const lng = p.coordinates.lng;\r\n                const lat = p.coordinates.lat;\r\n\r\n                // Apply global Yaw default if individual Yaw is 0\r\n                const towerModelUrl = override?.customModelUrl || cableSettings?.customModelUrl || LOCAL_MODEL_URL;\r\n\r\n                // ALTITUDE CONSISTENTE: Mesma lógica usada para os cabos e para o marcador\r\n                const transform = getEffectiveTransform(override?.customModelTransform, towerModelUrl);\r\n                const baseHeight = override?.height ?? p.towerHeight ?? 30;\r\n                const scaleZ = (transform?.scale?.[2] ?? 1) * (transform?.baseHeight ?? 1);\r\n                const offZ = transform?.offset?.[2] ?? 0;\r\n                const towerHeight = (baseHeight * scaleZ) + offZ;\r\n\r\n                const verticalOffset = cableSettings.towerVerticalOffset;\r\n                const effectiveTopHeight = towerHeight + verticalOffset;\r\n                const BASE_ELEV_OUTLINE = override?.elevation ?? p.elevation ?? 0;\r\n\r\n                // Don't show outlines for procedural porticos to avoid clutter\r\n                if (towerModelUrl === 'procedural-portico') return null;\r\n\r\n                return {\r\n                    type: 'Feature',\r\n                    properties: {\r\n                        id: p.id,\r\n                        name: p.name,\r\n                        towerHeight: effectiveTopHeight,\r\n                        color: override?.color || '#00ffff',\r\n                        elevationOffset: p.elevation - ((p as any).terrainElevation || 0)\r\n                    },\r\n                    geometry: {\r\n                        type: 'LineString',\r\n                        coordinates: [\r\n                            [lng, lat, BASE_ELEV_OUTLINE + effectiveTopHeight],\r\n                            [lng, lat, BASE_ELEV_OUTLINE]\r\n                        ]\r\n                    }\r\n                };\r\n            }).filter(Boolean) as any\r\n        };\r\n    }, [chunkedTowers, placemarkOverrides, cableSettings]);\r\n\r\n    // GeoJSON for Procedural Porticos (Pórticos)\r\n    const proceduralPorticosGeoJSON = useMemo(() => {\r\n        const features: any[] = [];\r\n\r\n        towersWithTerrain.forEach(p => {\r\n            const docId = (p as any).document_id || '';\r\n            const compositeId = `${docId}:::${p.id}`;\r\n            const override = placemarkOverrides[compositeId];\r\n\r\n            // Determine if this should be rendered as a Portico\r\n            const isTrio = /TRIO/i.test(p.name);\r\n            const modelUrl = override?.customModelUrl || (isTrio ? 'procedural-portico' : (cableSettings?.customModelUrl || LOCAL_MODEL_URL));\r\n\r\n            if (modelUrl !== 'procedural-portico') return;\r\n\r\n            const transform = getEffectiveTransform(override?.customModelTransform, 'procedural-portico');\r\n            const baseHeight = override?.height ?? p.towerHeight ?? 25;\r\n            const scaleZ = (transform?.scale?.[2] ?? 1) * (transform?.baseHeight ?? 1);\r\n            const offZ = transform?.offset?.[2] ?? 0;\r\n            const towerHeight = (baseHeight * scaleZ) + offZ;\r\n\r\n            const lng = p.coordinates.lng;\r\n            const lat = p.coordinates.lat;\r\n\r\n            // Follow Angle defined in Card (override.angle) or calculated\r\n            const baseRot = (p as any).calculatedHeading || (p as any).heading || (p as any).rotation || 0;\r\n            const yawOverride = transform?.rotation?.[2] ?? 0;\r\n            const rotation = (override?.angle !== undefined ? override.angle : baseRot) + yawOverride;\r\n            const headingRad = -(rotation) * (Math.PI / 180);\r\n\r\n            // Portico Dimensions\r\n            const SPAN_WIDTH = 14; // meters (total span)\r\n            const COLUMN_SIZE = 1.2; // meters (square)\r\n            const BEAM_HEIGHT = 1.5; // meters (thickness of top beam)\r\n            const BASE_ELEVATION_ABS = override?.elevation ?? p.elevation ?? p.coordinates.altitude ?? 0;\r\n            const TERRAIN_ELEV = (p as any).terrainElevation || 0;\r\n            const BASE_REL = BASE_ELEVATION_ABS - TERRAIN_ELEV;\r\n\r\n            const verticalOffset = cableSettings.towerVerticalOffset;\r\n            const effectiveTopHeight = towerHeight + verticalOffset;\r\n\r\n            // Helper to offset point in meters\r\n            const offsetPoint = (xOffset: number, yOffset: number) => {\r\n                // Approximate meters to degrees conversion\r\n                const M_PER_DEG_LAT = 111132.92;\r\n                const M_PER_DEG_LON = 111412.84 * Math.cos(lat * Math.PI / 180);\r\n\r\n                // Rotate offset\r\n                const rx = xOffset * Math.cos(headingRad) - yOffset * Math.sin(headingRad);\r\n                const ry = xOffset * Math.sin(headingRad) + yOffset * Math.cos(headingRad);\r\n\r\n                return [\r\n                    lng + (rx / M_PER_DEG_LON),\r\n                    lat + (ry / M_PER_DEG_LAT)\r\n                ];\r\n            };\r\n\r\n            // Helper to ensure ring closure\r\n            const closePoly = (coords: number[][]) => [...coords, coords[0]];\r\n\r\n            // Determine active texture (default to metal-light for columns)\r\n            const mainTexture = override?.texture || cableSettings?.customTexture || 'texture-metal-light';\r\n\r\n            // Derive secondary textures unless overridden specifically (future proofing), \r\n            // for now just use logical defaults or valid variations if main texture changes type\r\n            let beamTexture = 'texture-metal-medium';\r\n            const foundationTexture = 'texture-concrete-dark';\r\n\r\n            // If main texture is Rust/Wood/Warning, apply to beam too for consistency\r\n            if (mainTexture.includes('rust') || mainTexture.includes('wood') || mainTexture.includes('warning')) {\r\n                beamTexture = mainTexture;\r\n            }\r\n\r\n            // 1. Left Column\r\n            const leftColCenter = -SPAN_WIDTH / 2;\r\n            const p1L = offsetPoint(leftColCenter - COLUMN_SIZE / 2, -COLUMN_SIZE / 2);\r\n            const p2L = offsetPoint(leftColCenter + COLUMN_SIZE / 2, -COLUMN_SIZE / 2);\r\n            const p3L = offsetPoint(leftColCenter + COLUMN_SIZE / 2, COLUMN_SIZE / 2);\r\n            const p4L = offsetPoint(leftColCenter - COLUMN_SIZE / 2, COLUMN_SIZE / 2);\r\n\r\n            features.push({\r\n                type: 'Feature',\r\n                properties: {\r\n                    id: `${p.id}-col-left`,\r\n                    color: '#d4d4d8', // zinc-300\r\n                    texture: mainTexture,\r\n                    height: BASE_REL + effectiveTopHeight,\r\n                    base_height: BASE_REL,\r\n                    type: 'column'\r\n                },\r\n                geometry: {\r\n                    type: 'Polygon',\r\n                    coordinates: [closePoly([p1L, p2L, p3L, p4L])]\r\n                }\r\n            });\r\n\r\n            // 2. Right Column\r\n            const rightColCenter = SPAN_WIDTH / 2;\r\n            const p1R = offsetPoint(rightColCenter - COLUMN_SIZE / 2, -COLUMN_SIZE / 2);\r\n            const p2R = offsetPoint(rightColCenter + COLUMN_SIZE / 2, -COLUMN_SIZE / 2);\r\n            const p3R = offsetPoint(rightColCenter + COLUMN_SIZE / 2, COLUMN_SIZE / 2);\r\n            const p4R = offsetPoint(rightColCenter - COLUMN_SIZE / 2, COLUMN_SIZE / 2);\r\n\r\n            features.push({\r\n                type: 'Feature',\r\n                properties: {\r\n                    id: `${p.id}-col-right`,\r\n                    color: '#d4d4d8', // zinc-300\r\n                    texture: mainTexture,\r\n                    height: BASE_REL + effectiveTopHeight,\r\n                    base_height: BASE_REL,\r\n                    type: 'column'\r\n                },\r\n                geometry: {\r\n                    type: 'Polygon',\r\n                    coordinates: [closePoly([p1R, p2R, p3R, p4R])]\r\n                }\r\n            });\r\n\r\n            // 3. Top Beam (Crossarm)\r\n            // Beam extends slightly past columns\r\n            const beamOverhang = 1.5;\r\n            const beamHalfLength = (SPAN_WIDTH / 2) + beamOverhang;\r\n            const beamWidth = COLUMN_SIZE * 0.8;\r\n\r\n            const b1 = offsetPoint(-beamHalfLength, -beamWidth / 2);\r\n            const b2 = offsetPoint(beamHalfLength, -beamWidth / 2);\r\n            const b3 = offsetPoint(beamHalfLength, beamWidth / 2);\r\n            const b4 = offsetPoint(-beamHalfLength, beamWidth / 2);\r\n\r\n            features.push({\r\n                type: 'Feature',\r\n                properties: {\r\n                    id: `${p.id}-beam`,\r\n                    color: '#a1a1aa', // zinc-400 (slightly darker)\r\n                    texture: beamTexture,\r\n                    height: BASE_REL + effectiveTopHeight,\r\n                    base_height: BASE_REL + effectiveTopHeight - BEAM_HEIGHT,\r\n                    type: 'beam'\r\n                },\r\n                geometry: {\r\n                    type: 'Polygon',\r\n                    coordinates: [closePoly([b1, b2, b3, b4])]\r\n                }\r\n            });\r\n\r\n            // 4. Foundations (Concrete bases) - Visual polish\r\n            const fSize = COLUMN_SIZE * 1.6;\r\n            const fHeight = 0.5;\r\n\r\n            const f1L = offsetPoint(leftColCenter - fSize / 2, -fSize / 2);\r\n            const f2L = offsetPoint(leftColCenter + fSize / 2, -fSize / 2);\r\n            const f3L = offsetPoint(leftColCenter + fSize / 2, fSize / 2);\r\n            const f4L = offsetPoint(leftColCenter - fSize / 2, fSize / 2);\r\n\r\n            features.push({\r\n                type: 'Feature',\r\n                properties: {\r\n                    id: `${p.id}-found-left`,\r\n                    color: '#52525b', // zinc-600 (concrete dark)\r\n                    texture: foundationTexture,\r\n                    height: BASE_REL + fHeight,\r\n                    base_height: BASE_REL,\r\n                    type: 'foundation'\r\n                },\r\n                geometry: {\r\n                    type: 'Polygon',\r\n                    coordinates: [closePoly([f1L, f2L, f3L, f4L])]\r\n                }\r\n            });\r\n\r\n            const f1R = offsetPoint(rightColCenter - fSize / 2, -fSize / 2);\r\n            const f2R = offsetPoint(rightColCenter + fSize / 2, -fSize / 2);\r\n            const f3R = offsetPoint(rightColCenter + fSize / 2, fSize / 2);\r\n            const f4R = offsetPoint(rightColCenter - fSize / 2, fSize / 2);\r\n\r\n            features.push({\r\n                type: 'Feature',\r\n                properties: {\r\n                    id: `${p.id}-found-right`,\r\n                    color: '#52525b', // zinc-600\r\n                    texture: foundationTexture,\r\n                    height: BASE_REL + fHeight,\r\n                    base_height: BASE_REL,\r\n                    type: 'foundation'\r\n                },\r\n                geometry: {\r\n                    type: 'Polygon',\r\n                    coordinates: [closePoly([f1R, f2R, f3R, f4R])]\r\n                }\r\n            });\r\n\r\n        });\r\n\r\n        return {\r\n            type: 'FeatureCollection',\r\n            features\r\n        };\r\n    }, [chunkedTowers, placemarkOverrides, cableSettings]);\r\n    // -------------------------------------------------------------------------\r\n    // 3D Cable Generation (Using Deck.gl for ABSOLUTE elevation - No Undulation)\r\n    // -------------------------------------------------------------------------\r\n    const deckGLLayers = useMemo(() => {\r\n        if (!show3D) return [];\r\n\r\n        const getLocKey = (t: KMLPlacemark) => {\r\n            const name = (t.name || '').toUpperCase().trim();\r\n            const baseMatch = name.match(/^(\\d+[\\/-]\\d+)/);\r\n            if (baseMatch) return baseMatch[1];\r\n            return `${t.coordinates.lng.toFixed(3)},${t.coordinates.lat.toFixed(3)}`;\r\n        };\r\n\r\n        const getNumericId = (p: KMLPlacemark) => {\r\n            const name = p.name || '';\r\n            const m = name.match(/(\\d+)/);\r\n            return m ? parseInt(m[1]) : 0;\r\n        };\r\n\r\n        // 1. Generate Cables\r\n        const paths = CableLayerService.generateCables({\r\n            towers: towersWithTerrain, // Cabos precisam da lista completa para continuidade entre chunks (ou vizinhos)\r\n            projectSpans,\r\n            cableSettings,\r\n            placemarkOverrides,\r\n            hiddenSpans,\r\n            hiddenPlacemarkIds,\r\n            projectId,\r\n            projectAnchors,\r\n            templateAnchors,\r\n            getNumericId,\r\n            getLocKey,\r\n            localModelUrl: LOCAL_MODEL_URL,\r\n            getEffectiveTransform,\r\n            disableAutoGeneration: !isAutoConnecting // Auto-connect disabled unless explicitly active\r\n        });\r\n\r\n        // Filtrar caminhos visíveis (Otimização Deck.gl)\r\n        const visiblePaths = paths.filter(p => {\r\n            if (!viewportBounds) return true;\r\n            // Simplificação: verifica se as torres conectadas estão no chunk (ou próximas)\r\n            const src = towersWithTerrain.find(t => t.id === p.towerStartId);\r\n            const tgt = towersWithTerrain.find(t => t.id === p.towerEndId);\r\n            if (!src || !tgt) return false;\r\n\r\n            const LAT_BUF = 0.01;\r\n            const LNG_BUF = 0.01;\r\n            const w = viewportBounds.getWest() - LNG_BUF;\r\n            const e = viewportBounds.getEast() + LNG_BUF;\r\n            const s = viewportBounds.getSouth() - LAT_BUF;\r\n            const n = viewportBounds.getNorth() + LAT_BUF;\r\n\r\n            const isPointVisible = (lng: number, lat: number) => lng >= w && lng <= e && lat >= s && lat <= n;\r\n            return isPointVisible(src.coordinates.lng, src.coordinates.lat) ||\r\n                isPointVisible(tgt.coordinates.lng, tgt.coordinates.lat);\r\n        });\r\n\r\n        const cableLayer = new PathLayer({\r\n            id: 'deck-cables-layer',\r\n            data: visiblePaths,\r\n            pickable: true,\r\n            getPath: (d: Record<string, unknown>) => d.path as [number, number, number][],\r\n            getColor: (d: Record<string, unknown>) => {\r\n                const hexValue = (typeof d.color === 'string' ? d.color : '#cbd5e1').replace('#', '');\r\n                const r = parseInt(hexValue.substring(0, 2), 16) || 203;\r\n                const g = parseInt(hexValue.substring(2, 4), 16) || 213;\r\n                const b = parseInt(hexValue.substring(4, 6), 16) || 225;\r\n                return [r, g, b, 255];\r\n            },\r\n            getWidth: (d: any) => d.width || 3,\r\n            widthUnits: 'pixels',\r\n            capRounded: true,\r\n            jointRounded: true,\r\n            opacity: cableSettings.globalOpacity,\r\n            parameters: { depthTest: true },\r\n            updateTriggers: {\r\n                getPath: [visiblePaths.length, cableSettings.towerVerticalOffset, terrainRevision]\r\n            },\r\n            onClick: (info: any) => {\r\n                if (info.object) {\r\n                    console.log('Clicked Cable:', info.object);\r\n                    handleCableClick(info, info.x, info.y);\r\n                }\r\n                return true;\r\n            }\r\n        });\r\n\r\n        // Specular Highlight Layer (The \"Shine\" on the metal)\r\n        const cableShineLayer = new PathLayer({\r\n            id: 'deck-cables-shine-layer',\r\n            data: visiblePaths,\r\n            pickable: false, // Don't pick on the highlight\r\n            getPath: (d: Record<string, unknown>) => d.path as [number, number, number][],\r\n            getColor: () => [255, 255, 255, 180] as [number, number, number, number], // Bright white highlight\r\n            getWidth: (d: Record<string, unknown>) => Math.max(1, (Number(d.width) || 3) * 0.4), // 40% of original width\r\n            widthUnits: 'pixels',\r\n            capRounded: true,\r\n            jointRounded: true,\r\n            opacity: cableSettings.globalOpacity * 0.8,\r\n            parameters: { \r\n                depthTest: true,\r\n                blendColor: [1, 1, 1, 0.5]\r\n            },\r\n            updateTriggers: {\r\n                getPath: [visiblePaths.length, cableSettings.towerVerticalOffset, terrainRevision]\r\n            }\r\n        });\r\n\r\n        // 2. Generate Towers (Deck.gl Scenegraph)\r\n        const towerLayers = TowerScenegraphService.getLayers(chunkedTowers, {\r\n            towerVerticalOffset: cableSettings.towerVerticalOffset,\r\n            terrainRevision,\r\n            getTerrainElevation: (lng, lat) => map?.queryTerrainElevation([lng, lat]) ?? 0,\r\n            cableSettings,\r\n            localModelUrl: LOCAL_MODEL_URL,\r\n            projectAnchors,\r\n            templateAnchors\r\n        }, towerAlignments);\r\n\r\n        // 3. Generate Anchor Debug Points (Optional)\r\n        /*\r\n        const anchorLayers = AnchorDebugService.getLayers({\r\n            towers: towersWithTerrain,\r\n            cableSettings,\r\n            placemarkOverrides,\r\n            projectAnchors,\r\n            templateAnchors,\r\n            localModelUrl: LOCAL_MODEL_URL,\r\n            getEffectiveTransform,\r\n            terrainRevision,\r\n            getTerrainElevation: (lng, lat) => map?.queryTerrainElevation([lng, lat]) ?? 0,\r\n            onAnchorClick: (towerId, anchorId) => {\r\n                // DISABLED (User Request): Repositioning via click is temporarily disabled\r\n                \r\n                const tower = towersWithTerrain.find(t => t.id === towerId);\r\n                const anchorConfig = cableSettings.anchors.find(a => a.id === anchorId);\r\n                const phaseId = anchorConfig?.phase;\r\n    \r\n                if (tower) {\r\n                    console.log('--- Anchor Debug Click ---');\r\n                    console.log('Tower:', tower.id, tower.name);\r\n                    console.log('Anchor Config ID:', anchorId);\r\n                    console.log('Phase ID:', phaseId);\r\n                    console.log('Color:', anchorConfig?.color);\r\n    \r\n    \r\n                    onSelectPlacemark?.(tower);\r\n                    setIsPickingAnchorPosition(true);\r\n                    setPickingAnchorTowerId(towerId);\r\n                    setPickingAnchorId(anchorId);\r\n                    setPickingPhaseId(phaseId || null);\r\n    \r\n                    const objName = (tower as any).object_id || (tower as any).objectId || tower.name;\r\n                    const phaseColor = anchorConfig?.color || '#ffffff';\r\n    \r\n                    toast({\r\n                        title: \"Ajuste de Fixação\",\r\n                        description: `Clique no mapa para mover o ponto de fixação ${phaseId || 'desconhecido'}`,\r\n                        className: \"border-l-4\",\r\n                        style: { borderLeftColor: phaseColor }\r\n                    });\r\n                }\r\n                \r\n                return true;\r\n            }\r\n        });\r\n        */\r\n        const anchorLayers: any[] = [];\r\n        return [cableLayer, cableShineLayer, ...towerLayers, ...anchorLayers];\r\n    }, [towersWithTerrain, projectSpans, show3D, cableSettings, placemarkOverrides, hiddenSpans, hiddenPlacemarkIds, projectId, canUpdate, terrainRevision, map, towerAlignments]);\r\n\r\n    // GeoJSON for Solid 3D Cables (fill-extrusion)\r\n    const solidCablesGeoJSON = useMemo(() => {\r\n        if (!show3D) return { type: 'FeatureCollection', features: [] };\r\n        const features: any[] = [];\r\n        return { type: 'FeatureCollection', features };\r\n    }, [show3D]);\r\n\r\n\r\n\r\n\r\n    // 3D Cable interaction logic can be added here if needed for Deck.gl PathLayer.\r\n\r\n    return (\r\n        <>\r\n            {/* 3D Bounding Boxes and Outlines hidden as requested */}\r\n\r\n            {/* 3D Bounding Boxes and Outlines hidden as requested */}\r\n            {/* \r\n            <Source id=\"tower-bounding-boxes\" type=\"geojson\" data={towerBoundingBoxesGeoJSON as any}>\r\n                ...\r\n            </Source>\r\n            */}\r\n\r\n            {/* 3D Vertical Tower Grounding Lines (Ensures tower connectivity even if model fails) */}\r\n            <Source id=\"tower-vertical-lines\" type=\"geojson\" data={towerTopOutlinesGeoJSON as any}>\r\n                <Layer\r\n                    id=\"tower-vertical-lines-layer\"\r\n                    type=\"line\"\r\n                    paint={{\r\n                        'line-color': ['get', 'color'],\r\n                        'line-width': 2,\r\n                        'line-opacity': 0.6,\r\n                        'line-dasharray': [2, 1]\r\n                    }}\r\n                />\r\n            </Source>\r\n\r\n            {/* 3D Cable Segments (Thickness/Occlusion) */}\r\n\r\n\r\n\r\n            {/* Deck.gl Overlay for Absolute 3D Objects */}\r\n            {show3D && <DeckGLOverlay layers={deckGLLayers} interleaved={true} />}\r\n\r\n            {/* Native 3D Labels removed to avoid duplication - Only keeping yellow KMZ label as requested */}\r\n\r\n\r\n            {/* Solid 3D Cables (fill-extrusion) */}\r\n            {/* Solid 3D Cables removed to fix white bar artifact */}\r\n            {/* \r\n            <Source id=\"solid-cables-source\" type=\"geojson\" data={solidCablesGeoJSON as any}>\r\n               ...\r\n            </Source>\r\n            */}\r\n\r\n\r\n\r\n            {/* Procedural Portico Layer */}\r\n            <Source id=\"procedural-portico-source\" type=\"geojson\" data={proceduralPorticosGeoJSON as any}>\r\n                <Layer\r\n                    id=\"procedural-portico-layer\"\r\n                    type=\"fill-extrusion\"\r\n                    paint={{\r\n                        'fill-extrusion-pattern': ['get', 'texture'],\r\n                        'fill-extrusion-color': ['get', 'color'],\r\n                        'fill-extrusion-height': ['get', 'height'],\r\n                        'fill-extrusion-base': ['get', 'base_height'],\r\n                        'fill-extrusion-opacity': 1\r\n                    }}\r\n                />\r\n            </Source>\r\n\r\n            {isZoomedIn && chunkedTowers.map((p) => {\r\n                // Use the document_id stored in the enriched placemark\r\n                const docId = (p as any).document_id || '';\r\n                if (hiddenPlacemarkIds.has(`${docId}:::${p.id}`)) return null;\r\n\r\n                // Get individual overrides for precise 3D placement\r\n                const override = placemarkOverrides[`${docId}:::${p.id}`];\r\n                // Apply global Yaw default if individual Yaw is 0\r\n                const towerModelUrl = override?.customModelUrl || cableSettings?.customModelUrl || LOCAL_MODEL_URL;\r\n                const transform = getEffectiveTransform(override?.customModelTransform, towerModelUrl);\r\n                const scaleZ = (transform?.scale?.[2] ?? 1) * (transform?.baseHeight ?? 1);\r\n                const offZ = transform?.offset?.[2] ?? 0;\r\n                const towerHeight = (p as any).towerHeight || 30;\r\n\r\n                // FIX: Altitude set to base to stay on ground (soil) as requested\r\n                const effectiveAltitude = (p as any).elevation + offZ + cableSettings.towerVerticalOffset;\r\n\r\n                return (\r\n                    <React.Fragment key={`3d-marker-group-${docId}:::${p.id}`}>\r\n                        {/* Interactive Tower Label Marker - BASE FIXADA AUTOMÁTICA (SNAP TO TERRAIN) */}\r\n                        <Marker\r\n                            key={`3d-marker-${docId}:::${p.id}`}\r\n                            longitude={p.coordinates.lng}\r\n                            latitude={p.coordinates.lat}\r\n                            // altitude removido para snap automático ao terreno\r\n                            anchor=\"bottom\"\r\n                            offset={[0, 0]}\r\n                            clickTolerance={0}\r\n                            draggable={true}\r\n                        >\r\n                            <div\r\n                                className=\"group relative flex flex-col items-center select-none\"\r\n                                style={{\r\n                                    userSelect: 'none',\r\n                                    pointerEvents: 'none',\r\n                                    cursor: 'default'\r\n                                }}\r\n                                onMouseEnter={() => setHoveredMarker(`${docId}:::${p.id}`)}\r\n                                onMouseLeave={() => setHoveredMarker(null)}\r\n                            >\r\n                                <button\r\n                                    onClick={(e) => {\r\n                                        e.preventDefault();\r\n                                        e.stopPropagation();\r\n\r\n                                        if (isConnectingMode && firstTowerToConnect) {\r\n                                            if (firstTowerToConnect.id === p.id) {\r\n                                                toast({\r\n                                                    title: \"Conexão Inválida\",\r\n                                                    description: \"Selecione uma torre diferente para conectar.\",\r\n                                                    variant: \"destructive\"\r\n                                                });\r\n                                                return;\r\n                                            }\r\n                                            handleConnectTowers(p);\r\n                                            return;\r\n                                        }\r\n\r\n                                        onSelectPlacemark?.(p);\r\n                                    }}\r\n                                    onMouseDown={(e) => {\r\n                                        // CRITICAL: Stop propagation to prevent map dragging when interacting with towers\r\n                                        e.stopPropagation();\r\n                                    }}\r\n                                    className=\"relative flex flex-col items-center transition-all duration-300 hover:scale-110 active:scale-95\"\r\n                                    style={{ cursor: 'pointer', pointerEvents: 'auto' }}\r\n                                >\r\n                                    {/* Visual Indicator (Glow Effect) */}\r\n                                    <div\r\n                                        className={cn(\r\n                                            \"w-8 h-8 backdrop-blur-md rounded-xl border-2 flex items-center justify-center shadow-2xl transition-all duration-500\",\r\n                                            selectedPlacemark?.id === p.id\r\n                                                ? \"ring-4 ring-primary/60 scale-125 border-white shadow-[0_0_30px_rgba(var(--primary),0.8)] bg-primary/20\"\r\n                                                : \"border-white/40 hover:border-white shadow-[0_4px_15px_rgba(0,0,0,0.5)] bg-black/20\"\r\n                                        )}\r\n                                        style={{\r\n                                            borderColor: (() => {\r\n                                                const ov = placemarkOverrides[`${docId}:::${p.id}`];\r\n                                                return ov?.color || (p.isLocal ? '#10b981' : '#3b82f6');\r\n                                            })()\r\n                                        }}\r\n                                    >\r\n                                        {p.isLocal ? (\r\n                                            <Tower\r\n                                                className={cn(\"w-5 h-5 transition-all text-white drop-shadow-md\")}\r\n                                                style={{\r\n                                                    color: (placemarkOverrides[`${docId}:::${p.id}`]?.color || '#10b981')\r\n                                                }}\r\n                                            />\r\n                                        ) : (\r\n                                            <Box\r\n                                                className={cn(\"w-5 h-5 transition-all text-white drop-shadow-md\")}\r\n                                                style={{\r\n                                                    color: (placemarkOverrides[`${docId}:::${p.id}`]?.color || '#3b82f6')\r\n                                                }}\r\n                                            />\r\n                                        )}\r\n                                    </div>\r\n\r\n                                    {/* Tower Name Label - RESTAURADO */}\r\n                                    <div className=\"absolute top-full mt-1.5 px-2.5 py-1 bg-black/80 backdrop-blur-md rounded-md border border-white/10 shadow-xl transition-all group-hover:scale-110\">\r\n                                        <span className=\"text-[10px] font-black text-white uppercase tracking-widest whitespace-nowrap flex items-center gap-1.5\">\r\n                                            {p.towerName}\r\n                                        </span>\r\n                                    </div>\r\n                                </button>\r\n                            </div>\r\n                        </Marker>\r\n\r\n                        {/* Tooltip Label removed to avoid redundancy - Only the yellow baseline label is kept */}\r\n\r\n                        {/* Selection Ring (Animated) */}\r\n                        {\r\n                            selectedPlacemark?.id === p.id && (\r\n                                <div className=\"absolute -inset-4 border-2 border-primary/30 rounded-full animate-ping pointer-events-none\" />\r\n                            )\r\n                        }\r\n                    </React.Fragment >\r\n                );\r\n            }) /* Fim do map */}\r\n            { /* Fim do isZoomedIn */}\r\n\r\n\r\n\r\n            {selectedElement && (\r\n                <div className=\"fixed top-24 right-6 bottom-6 z-50 w-[320px] animate-in slide-in-from-right duration-500 pointer-events-none\">\r\n                    <div className=\"flex flex-col h-full bg-background/80 backdrop-blur-3xl border border-white/5 rounded-4xl overflow-hidden shadow-[0_32px_128px_-12px_rgba(0,0,0,1)] pointer-events-auto\">\r\n                        <div className=\"flex-1 overflow-y-auto custom-scrollbar\">\r\n                            <div className=\"bg-primary/10 border-b border-white/5 p-4 relative overflow-hidden group\">\r\n                                <div className=\"flex items-center gap-1.5 mb-1\">\r\n                                    <div className=\"w-1 h-1 rounded-full bg-primary animate-pulse shadow-[0_0_8px_rgba(var(--primary),0.8)]\" />\r\n                                    <span className=\"text-[6.5px] font-black uppercase tracking-[0.2em] text-primary/80\">\r\n                                        {(selectedPlacemark.extendedData as any)?.source === '3d_cable_virtual_layer' ? 'VÃO DE CABO' : 'ESPECIFICAÇÕES TÉCNICAS'}\r\n                                    </span>\r\n                                </div>\r\n\r\n                                <h3 className=\"text-base font-black text-white tracking-tight uppercase leading-none drop-shadow-md flex items-baseline gap-1\">\r\n                                    {(selectedPlacemark.extendedData as any)?.object_id || (selectedPlacemark.extendedData as any)?.objectId || selectedPlacemark.name}\r\n                                    <span className=\"text-primary/40 text-[8px] font-light\">/</span>\r\n                                    <span className=\"text-primary text-[8px] tracking-wider italic truncate max-w-[120px]\">\r\n                                        {(selectedPlacemark.extendedData as any)?.is_auto\r\n                                            ? 'AUTO'\r\n                                            : ((selectedPlacemark as any).towerType || (selectedPlacemark.extendedData as any)?.tower_type || (selectedPlacemark.extendedData as any)?.tipo || (selectedPlacemark.extendedData as any)?.type || (selectedPlacemark.extendedData as any)?.towerType || ((selectedPlacemark.extendedData as any)?.source === '3d_cable_virtual_layer' ? 'CIRCUITO' : 'ESTRUTURA'))}\r\n                                    </span>\r\n                                </h3>\r\n\r\n                                <button\r\n                                    onClick={() => onSelectPlacemark?.(null)}\r\n                                    className=\"absolute top-2.5 right-2.5 p-1 hover:bg-white/10 rounded-full transition-colors z-20 group/close\"\r\n                                >\r\n                                    <X className=\"w-3 h-3 text-white opacity-40 group-hover/close:opacity-100 transition-opacity\" />\r\n                                </button>\r\n\r\n                                <div className=\"absolute top-0 -right-4 opacity-[0.03] pointer-events-none\">\r\n                                    {(selectedPlacemark.extendedData as any)?.source === '3d_cable_virtual_layer' ? (\r\n                                        <Box className=\"w-16 h-16 rotate-12\" />\r\n                                    ) : (\r\n                                        <Tower className=\"w-16 h-16 rotate-12\" />\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"px-4 py-3 bg-black/40 border-b border-white/5 flex gap-2 items-center\">\r\n                                <Button\r\n                                    variant=\"ghost\"\r\n                                    size=\"sm\"\r\n                                    onClick={() => {\r\n                                        let docId = (selectedPlacemark as any).document_id ||\r\n                                            (selectedPlacemark as any).projectId ||\r\n                                            (selectedPlacemark as any).project_id ||\r\n                                            (selectedPlacemark.extendedData as any)?.document_id;\r\n\r\n                                        if (!docId) {\r\n                                            const parentDoc = kmlDocuments.find(doc =>\r\n                                                doc.placemarks.some(p => p.id === selectedPlacemark.id)\r\n                                            );\r\n                                            docId = parentDoc?.id;\r\n                                        }\r\n\r\n                                        if (docId) {\r\n                                            onHidePlacemark?.(docId, selectedPlacemark as KMLPlacemark);\r\n                                            onSelectPlacemark?.(null);\r\n                                        }\r\n                                    }}\r\n                                    className=\"h-8 px-3 glass-card border-red-500/20 hover:bg-red-500/10 text-red-500 text-[9px] font-black uppercase tracking-widest gap-2\"\r\n                                >\r\n                                    <X className=\"w-3 h-3\" />\r\n                                    Ocultar\r\n                                </Button>\r\n\r\n                                <Button\r\n                                    variant=\"ghost\"\r\n                                    size=\"sm\"\r\n                                    onClick={() => {\r\n                                        const docId = (selectedPlacemark as any).document_id || (selectedPlacemark.extendedData as any)?.document_id;\r\n                                        const compositeId = `${docId}:::${selectedPlacemark.id}`;\r\n                                        const override = placemarkOverrides[compositeId];\r\n                                        const currentModelUrl = override?.customModelUrl || cableSettings?.customModelUrl || LOCAL_MODEL_URL;\r\n                                        const currentTransform = override?.customModelTransform || getModelConfig(currentModelUrl) || { scale: [1, 1, 1], rotation: [0, 0, 0], offset: [0, 0, 0], baseHeight: 1 };\r\n\r\n                                        onUpdatePlacemarkTransform?.(docId, selectedPlacemark.id, {\r\n                                            ...currentTransform,\r\n                                            anchorGlobalOffset: undefined,\r\n                                            anchorOverrides: undefined,\r\n                                            phaseOverrides: undefined\r\n                                        });\r\n                                        toast({ title: \"Resetado\", description: \"Ajustes removidos.\" });\r\n                                    }}\r\n                                    className=\"h-8 px-3 border border-orange-500/20 hover:bg-orange-500/10 text-orange-500 text-[9px] font-black uppercase\"\r\n                                >\r\n                                    <RotateCcw className=\"w-3 h-3\" />\r\n                                    Reverter\r\n                                </Button>\r\n\r\n                                <div className=\"relative ml-auto\">\r\n                                    <button\r\n                                        onClick={() => setIsColorPickerOpen(!isColorPickerOpen)}\r\n                                        className=\"w-7 h-7 rounded-md border-2 border-white/30\"\r\n                                        style={{\r\n                                            backgroundColor: (() => {\r\n                                                const docId = (selectedPlacemark as any).document_id || (selectedPlacemark.extendedData as any)?.document_id;\r\n                                                const override = placemarkOverrides[`${docId}:::${selectedPlacemark.id}`];\r\n                                                return override?.color || '#22c55e';\r\n                                            })()\r\n                                        }}\r\n                                    />\r\n                                    {isColorPickerOpen && (\r\n                                        <div className=\"absolute right-0 bottom-full mb-3 z-50 p-3 bg-black/95 backdrop-blur-2xl border border-white/20 rounded-xl shadow-2xl w-48\">\r\n                                            <div className=\"grid grid-cols-5 gap-1.5\">\r\n                                                {PRESET_COLORS.map(color => (\r\n                                                    <button\r\n                                                        key={color}\r\n                                                        onClick={() => {\r\n                                                            const docId = (selectedPlacemark as any).document_id || (selectedPlacemark.extendedData as any)?.document_id;\r\n                                                            if (docId) onUpdatePlacemarkColor?.(docId, selectedPlacemark.id, color);\r\n                                                            setIsColorPickerOpen(false);\r\n                                                        }}\r\n                                                        className=\"w-6 h-6 rounded-md\"\r\n                                                        style={{ backgroundColor: color }}\r\n                                                    />\r\n                                                ))}\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"p-4 space-y-4\">\r\n                                <div className=\"grid grid-cols-3 gap-2\">\r\n                                    <div className=\"bg-white/5 border border-white/5 rounded-2xl p-2.5 flex flex-col items-center justify-center group/card hover:bg-primary/5 transition-colors cursor-pointer\"\r\n                                        onClick={() => {\r\n                                            setEditingHeightValue(((selectedPlacemark as any).towerHeight || (selectedPlacemark.extendedData as any)?.height || '30').toString());\r\n                                            setEditingHeightElement({ docId: (selectedPlacemark as any).document_id || (selectedPlacemark.extendedData as any)?.document_id, elementId: selectedPlacemark.id });\r\n                                            setIsHeightDialogOpen(true);\r\n                                        }}\r\n                                    >\r\n                                        <span className=\"text-[7px] font-bold text-muted-foreground uppercase tracking-widest mb-1 group-hover/card:text-primary transition-colors\">Altura</span>\r\n                                        <span className=\"text-xs font-black text-white antialiased\">\r\n                                            {placemarkOverrides[`${(selectedPlacemark as any).document_id}:::${selectedPlacemark.id}`]?.height || (selectedPlacemark as any).towerHeight || '30'}m\r\n                                        </span>\r\n                                    </div>\r\n\r\n                                    <div className=\"bg-white/5 border border-white/5 rounded-2xl p-2.5 flex flex-col items-center justify-center group/card hover:bg-primary/5 transition-colors cursor-pointer\"\r\n                                        onClick={() => {\r\n                                            setEditingAngleValue(((selectedPlacemark.extendedData as any)?.angle || '0').toString());\r\n                                            setEditingAngleElement({ docId: (selectedPlacemark as any).document_id || (selectedPlacemark.extendedData as any)?.document_id, elementId: selectedPlacemark.id });\r\n                                            setIsAngleDialogOpen(true);\r\n                                        }}\r\n                                    >\r\n                                        <span className=\"text-[7px] font-bold text-muted-foreground uppercase tracking-widest mb-1 group-hover/card:text-primary transition-colors\">Ângulo</span>\r\n                                        <span className=\"text-xs font-black text-white antialiased\">\r\n                                            {(placemarkOverrides[`${(selectedPlacemark as any).document_id}:::${selectedPlacemark.id}`]?.angle\r\n                                                ?? (selectedPlacemark.extendedData as any)?.angle\r\n                                                ?? 0).toFixed(1)}°\r\n                                        </span>\r\n                                    </div>\r\n\r\n                                    <div className=\"bg-white/5 border border-white/5 rounded-2xl p-2.5 flex flex-col items-center justify-center group/card hover:bg-primary/5 transition-colors cursor-pointer\"\r\n                                        onClick={() => {\r\n                                            setEditingElevationValue(((selectedPlacemark as any).elevation || '0').toString());\r\n                                            setEditingElevationElement({ docId: (selectedPlacemark as any).document_id || (selectedPlacemark.extendedData as any)?.document_id, elementId: selectedPlacemark.id });\r\n                                            setIsElevationDialogOpen(true);\r\n                                        }}\r\n                                    >\r\n                                        <span className=\"text-[7px] font-bold text-muted-foreground uppercase tracking-widest mb-1 group-hover/card:text-primary transition-colors\">Cota</span>\r\n                                        <span className=\"text-xs font-black text-white antialiased\">\r\n                                            {(placemarkOverrides[`${(selectedPlacemark as any).document_id}:::${selectedPlacemark.id}`]?.elevation\r\n                                                ?? (selectedPlacemark as any).elevation\r\n                                                ?? 0).toFixed(1)}m\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {canUpdate && (\r\n                                    <div className=\"space-y-4\">\r\n                                        <div className=\"space-y-2\">\r\n                                            <div className=\"grid grid-cols-2 gap-2\">\r\n                                                <Button\r\n                                                    variant=\"outline\"\r\n                                                    size=\"sm\"\r\n                                                    onClick={() => {\r\n                                                        if (isConnectingMode) {\r\n                                                            setIsConnectingMode(false);\r\n                                                            setFirstTowerToConnect(null);\r\n                                                        } else {\r\n                                                            setIsConnectingMode(true);\r\n                                                            setFirstTowerToConnect(selectedElement as KMLPlacemark);\r\n                                                            toast({\r\n                                                                title: \"Link Mode\",\r\n                                                                description: \"Selecione a próxima estrutura.\"\r\n                                                            });\r\n                                                        }\r\n                                                    }}\r\n                                                    className={cn(\r\n                                                        \"h-9 text-[9px] uppercase font-black rounded-xl transition-all shadow-lg active:scale-95\",\r\n                                                        isConnectingMode ? \"bg-red-500/10 border-red-500/20 text-red-500\" : \"bg-primary/5 border-primary/20 text-primary\"\r\n                                                    )}\r\n                                                >\r\n                                                    <Cable className=\"w-3.5 h-3.5 mr-1.5\" />\r\n                                                    {isConnectingMode ? 'Cancelar' : 'Link'}\r\n                                                </Button>\r\n\r\n                                                <Button\r\n                                                    variant=\"outline\"\r\n                                                    size=\"sm\"\r\n                                                    onClick={handleAutoConnectAll}\r\n                                                    disabled={isAutoConnecting || !projectId || projectId === 'all'}\r\n                                                    className=\"h-9 text-[9px] uppercase font-black rounded-xl bg-amber-500/5 border-amber-500/20 text-amber-500\"\r\n                                                >\r\n                                                    <RefreshCw className={cn(\"w-3.5 h-3.5 mr-1.5\", isAutoConnecting && \"animate-spin\")} />\r\n                                                    Auto\r\n                                                </Button>\r\n                                            </div>\r\n\r\n                                            <Select\r\n                                                value={(() => {\r\n                                                    const docId = (selectedPlacemark as any).document_id || (selectedPlacemark.extendedData as any)?.document_id;\r\n                                                    const compositeId = `${docId}:::${selectedPlacemark.id}`;\r\n                                                    const override = placemarkOverrides[compositeId];\r\n                                                    return override?.customModelUrl || cableSettings?.customModelUrl || 'default';\r\n                                                })()}\r\n                                                onValueChange={(val) => {\r\n                                                    const docId = (selectedPlacemark as any).document_id || (selectedPlacemark.extendedData as any)?.document_id;\r\n                                                    onUpdatePlacemarkModel?.(docId, selectedPlacemark.id, val === 'default' ? '' : val);\r\n                                                }}\r\n                                            >\r\n                                                <SelectTrigger className=\"w-full h-9 bg-black/20 border-white/5 text-[9px] font-black uppercase rounded-xl\">\r\n                                                    <div className=\"flex items-center gap-2\">\r\n                                                        <Maximize className=\"w-3 h-3 text-primary\" />\r\n                                                        <SelectValue placeholder=\"Modelo 3D\" />\r\n                                                    </div>\r\n                                                </SelectTrigger>\r\n                                                <SelectContent className=\"bg-[#0a0a0a] border-white/10 text-white\">\r\n                                                    <SelectItem value=\"default\" className=\"text-[9px] uppercase font-black\">Padrão</SelectItem>\r\n                                                    <SelectItem value={`${window.location.origin}/models/towers/scene.gltf`} className=\"text-[9px] uppercase font-black\">Industrial</SelectItem>\r\n                                                    <SelectItem value=\"procedural-portico\" className=\"text-[9px] uppercase font-black\">Pórtico</SelectItem>\r\n                                                </SelectContent>\r\n                                            </Select>\r\n                                        </div>\r\n\r\n                                        <div className=\"bg-primary/5 rounded-2xl p-4 border border-primary/10 space-y-4\">\r\n                                            <div className=\"flex items-center justify-between\">\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <Move className=\"w-4 h-4 text-primary\" />\r\n                                                    <span className=\"text-[10px] font-black uppercase tracking-widest text-primary\">Ajuste Fino</span>\r\n                                                </div>\r\n                                                {(pickingAnchorId || pickingPhaseId) && (\r\n                                                    <button onClick={() => { setPickingAnchorId(null); setPickingPhaseId(null); }} className=\"text-white/40 hover:text-white transition-colors\">\r\n                                                        <X className=\"w-3 h-3\" />\r\n                                                    </button>\r\n                                                )}\r\n                                            </div>\r\n\r\n                                            {['X', 'Y', 'Z'].map((axis) => {\r\n                                                const docId = (selectedPlacemark as any).document_id || (selectedPlacemark.extendedData as any)?.document_id;\r\n                                                const compositeId = `${docId}:::${selectedPlacemark.id}`;\r\n                                                const override = placemarkOverrides[compositeId];\r\n                                                const axisKey = axis.toLowerCase() as 'x' | 'y' | 'z';\r\n\r\n                                                const currentGlobalOffset = override?.customModelTransform?.anchorGlobalOffset || { x: 0, y: 0, z: 0 };\r\n                                                const phaseOverride = pickingPhaseId ? override?.customModelTransform?.phaseOverrides?.[pickingPhaseId] : null;\r\n                                                const individualOffset = pickingAnchorId ? override?.customModelTransform?.anchorOverrides?.[pickingAnchorId] : null;\r\n\r\n                                                const offsetValue = individualOffset\r\n                                                    ? individualOffset[axisKey]\r\n                                                    : (phaseOverride ? phaseOverride[axisKey] : currentGlobalOffset[axisKey]);\r\n\r\n                                                const isPhaseMode = !!pickingPhaseId;\r\n                                                const isIndividualMode = !!pickingAnchorId;\r\n                                                const phaseColor = pickingPhaseId ? cableSettings.anchors.find(a => a.phase === pickingPhaseId)?.color : (pickingAnchorId ? cableSettings.anchors.find(a => a.id === pickingAnchorId)?.color : null);\r\n\r\n                                                return (\r\n                                                    <div key={axis} className=\"space-y-1.5\">\r\n                                                        <div className=\"flex justify-between text-[6px] font-black uppercase text-muted-foreground/60\">\r\n                                                            <span>Eixo {axis} {axis === 'Z' ? '(Altura)' : ''}</span>\r\n                                                            <span className={cn(\r\n                                                                \"tabular-nums font-mono drop-shadow-sm px-1.5 py-0.5 rounded border transition-all\",\r\n                                                                isIndividualMode\r\n                                                                    ? \"bg-emerald-500/10 text-emerald-400 border-emerald-500/20\"\r\n                                                                    : (isPhaseMode\r\n                                                                        ? \"bg-amber-500/10 text-amber-400 border-amber-500/20\"\r\n                                                                        : \"bg-primary/5 text-primary border-primary/10\")\r\n                                                            )}\r\n                                                                style={isPhaseMode || isIndividualMode ? { borderColor: phaseColor + '44', color: phaseColor, backgroundColor: phaseColor + '11' } : {}}\r\n                                                            >\r\n                                                                {offsetValue > 0 ? '+' : ''}{offsetValue.toFixed(2)}m\r\n                                                            </span>\r\n                                                        </div>\r\n                                                        <Slider\r\n                                                            value={[offsetValue]}\r\n                                                            min={axis === 'Z' ? -30 : -50}\r\n                                                            max={axis === 'Z' ? 30 : 50}\r\n                                                            step={0.05}\r\n                                                            onValueChange={([val]) => {\r\n                                                                const currentModelUrl = override?.customModelUrl || cableSettings?.customModelUrl || LOCAL_MODEL_URL;\r\n                                                                const currentTransform = override?.customModelTransform || getModelConfig(currentModelUrl) || { scale: [1, 1, 1], rotation: [0, 0, 0], offset: [0, 0, 0], baseHeight: 1 };\r\n\r\n                                                                const newTransform: ModelTransform = {\r\n                                                                    ...currentTransform\r\n                                                                };\r\n\r\n                                                                if (pickingPhaseId) {\r\n                                                                    newTransform.phaseOverrides = {\r\n                                                                        ...(currentTransform.phaseOverrides || {}),\r\n                                                                        [pickingPhaseId]: {\r\n                                                                            ...(phaseOverride || currentGlobalOffset),\r\n                                                                            [axisKey]: val\r\n                                                                        }\r\n                                                                    };\r\n                                                                } else if (pickingAnchorId) {\r\n                                                                    newTransform.anchorOverrides = {\r\n                                                                        ...(currentTransform.anchorOverrides || {}),\r\n                                                                        [pickingAnchorId]: {\r\n                                                                            ...(individualOffset || currentGlobalOffset),\r\n                                                                            [axisKey]: val\r\n                                                                        }\r\n                                                                    };\r\n                                                                } else {\r\n                                                                    newTransform.anchorGlobalOffset = {\r\n                                                                        ...currentGlobalOffset,\r\n                                                                        [axisKey]: val\r\n                                                                    };\r\n                                                                }\r\n\r\n                                                                onUpdatePlacemarkTransform?.(docId, selectedPlacemark.id, newTransform);\r\n                                                            }}\r\n                                                            className=\"py-1 cursor-pointer\"\r\n                                                        />\r\n                                                    </div>\r\n                                                );\r\n                                            })}\r\n\r\n                                            <p className=\"text-[6px] text-muted-foreground/50 italic leading-relaxed px-1\">\r\n                                                {pickingPhaseId\r\n                                                    ? `* Editando todos os cabos da ${pickingPhaseId}.`\r\n                                                    : (pickingAnchorId\r\n                                                        ? `* Editando apenas a mísula ${pickingAnchorId}.`\r\n                                                        : `* Ajuste global para todas as fases desta torre.`\r\n                                                    )\r\n                                                }\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n                                <div className=\"space-y-4 pt-2\">\r\n                                    <div className=\"space-y-1.5\">\r\n                                        <div className=\"flex items-center justify-between px-1\">\r\n                                            <span className=\"text-[6px] font-black uppercase tracking-[0.3em] text-muted-foreground/40\">UTM</span>\r\n                                            <span className=\"text-[6px] font-black uppercase tracking-widest text-primary/60\">FUSO {(selectedPlacemark.extendedData as any)?.fuso_object || '--'}</span>\r\n                                        </div>\r\n                                        <div className=\"bg-black/40 rounded-lg p-2.5 border border-white/5 font-mono text-[8px] flex flex-col gap-1 shadow-inner\">\r\n                                            <div className=\"flex justify-between items-center opacity-80\">\r\n                                                <span className=\"text-muted-foreground\">X:</span>\r\n                                                <span className=\"font-black text-white\">{(selectedPlacemark.extendedData as any)?.x_coordinate || (selectedPlacemark.extendedData as any)?.x_cord_object || selectedPlacemark.coordinates.lat.toFixed(5)}</span>\r\n                                            </div>\r\n                                            <div className=\"flex justify-between items-center opacity-80\">\r\n                                                <span className=\"text-muted-foreground\">Y:</span>\r\n                                                <span className=\"font-black text-white\">{(selectedPlacemark.extendedData as any)?.y_coordinate || (selectedPlacemark.extendedData as any)?.y_cord_object || selectedPlacemark.coordinates.lng.toFixed(5)}</span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <Button onClick={openInGPS} className=\"w-full bg-linear-to-r from-primary/80 to-primary/60 hover:from-primary hover:to-primary text-white font-black text-[9px] uppercase tracking-widest gap-2 h-9 rounded-xl shadow-glow transition-all active:scale-[0.98] group/btn\">\r\n                                        <Navigation className=\"w-3 h-3 group-hover/btn:translate-x-0.5 group-hover/btn:-translate-y-0.5 transition-transform\" />\r\n                                        Explorar via GPS\r\n                                    </Button>\r\n\r\n                                    {canUpdate && (\r\n                                        <Button\r\n                                            onClick={() => {\r\n                                                if (isConnectingMode) {\r\n                                                    setIsConnectingMode(false);\r\n                                                    setFirstTowerToConnect(null);\r\n                                                } else {\r\n                                                    setIsConnectingMode(true);\r\n                                                    setFirstTowerToConnect(selectedElement as KMLPlacemark);\r\n                                                    toast({\r\n                                                        title: \"Modo de Conexão Ativo 🔗\",\r\n                                                        description: \"Agora selecione a PRÓXIMA TORRE para criar o vão.\",\r\n                                                    });\r\n                                                }\r\n                                            }}\r\n                                            className={cn(\r\n                                                \"w-full font-black text-[9px] uppercase tracking-widest gap-2 h-9 rounded-xl transition-all active:scale-[0.98] group/btn\",\r\n                                                isConnectingMode\r\n                                                    ? \"bg-red-500/20 hover:bg-red-500/30 text-red-400 border border-red-500/30\"\r\n                                                    : \"bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-400 border border-emerald-500/30\"\r\n                                            )}\r\n                                        >\r\n                                            {isConnectingMode ? <X className=\"w-3 h-3\" /> : <Cable className=\"w-3 h-3\" />}\r\n                                            {isConnectingMode ? 'Cancelar Conexão' : 'Conectar com Outra Torre'}\r\n                                        </Button>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            <AlertDialog open={isAngleDialogOpen} onOpenChange={setIsAngleDialogOpen}>\r\n                <AlertDialogContent className=\"glass-card border-white/10 max-w-xl p-8\">\r\n                    <AlertDialogHeader className=\"mb-6\">\r\n                        <AlertDialogTitle className=\"text-2xl font-black uppercase tracking-tight text-white flex items-center gap-3\">\r\n                            <RefreshCw className=\"w-6 h-6 text-primary\" />\r\n                            Editar Ângulo (DMS)\r\n                        </AlertDialogTitle>\r\n                        <AlertDialogDescription className=\"text-muted-foreground text-sm uppercase tracking-widest font-bold opacity-60\">\r\n                            Fuso {(selectedPlacemark?.extendedData as any)?.fuso_object || '--'} • Formato GMS (ex: 45 30 15 S) ou Azimute decimal.\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <div className=\"py-8\">\r\n                        <Input\r\n                            value={editingAngleValue}\r\n                            onChange={(e) => setEditingAngleValue(e.target.value)}\r\n                            placeholder=\"Ex: 47 13 12 NE\"\r\n                            className=\"bg-black/60 border-white/10 text-white font-mono text-3xl h-20 text-center rounded-2xl shadow-inner focus:ring-primary/20\"\r\n                            autoFocus\r\n                            onKeyDown={(e) => {\r\n                                if (e.key === 'Enter') {\r\n\r\n                                    /*\r\n                                        if (!dms || dms === '0') return 0;\r\n                                        try {\r\n                                            // Parse simple decimal first if no formatting\r\n                                            if (!dms.includes('°') && !dms.includes('\\'')) {\r\n                                                const num = parseFloat(dms.replace(',', '.').replace(/[^\\d.-]/g, ''));\r\n                                                return isNaN(num) ? 0 : num;\r\n                                            }\r\n             \r\n                                            // Regex robusto para DMS com ou sem segundos e direção opcional (1 ou 2 letras)\r\n                                            const parts = dms.match(/(\\d+)[°|\\s](\\d+)['|\\s]?(\\d+(?:\\.\\d+)?)?\"?\\s*([NSEW]{1,2})?/i);\r\n             \r\n                                            if (!parts) {\r\n                                                const normalized = dms.replace(',', '.').replace(/[^\\d.-]/g, '');\r\n                                                const num = parseFloat(normalized);\r\n                                                return isNaN(num) ? 0 : num;\r\n                                            }\r\n             \r\n                                            const degrees = parseFloat(parts[1]);\r\n                                            const minutes = parts[2] ? parseFloat(parts[2]) : 0;\r\n                                            const seconds = parts[3] ? parseFloat(parts[3]) : 0;\r\n                                            const direction = parts[4]?.toUpperCase();\r\n             \r\n                                            let dd = degrees + (minutes / 60) + (seconds / 3600);\r\n             \r\n                                            // Ajuste básico de direção se necessário (embora azimute geralmente seja 0-360 direto)\r\n                                            if (direction === 'S' || direction === 'W') {\r\n                                                // Se for apenas S ou W, pode significar negativo ou quadrante\r\n                                                // Assumindo comportamento anterior de inverter para S/W se for coordenada, \r\n                                                // mas para Heading/Ângulo de torre (0-360), isso pode não ser o desejado.\r\n                                                // Heading geralmente é Clockwise from North.\r\n                                                // Se o usuário digita coordenadas lat/lng, S/W é negativo.\r\n                                                // Se é ângulo de torre... vamos manter o valor absoluto se parecer um azimute (>90 e <360).\r\n                                                // Mas para garantir compatibilidade com o que existia:\r\n                                                if (degrees < 90) dd = dd * -1; // Mantém lógica de inverter apenas se parecer quadrante\r\n                                            }\r\n             \r\n                                            return dd;\r\n                                        } catch (err) {\r\n                                            console.error(\"Erro parsing DMS:\", err);\r\n                                            // Fallback simples\r\n                                            const num = parseFloat(dms.replace(',', '.').replace(/[^\\d.-]/g, ''));\r\n                                            return isNaN(num) ? 0 : num;\r\n                                        }\r\n                                    */\r\n\r\n                                    if (editingAngleElement) {\r\n                                        const decimalAngle = dmsToDecimal(editingAngleValue);\r\n                                        onUpdatePlacemarkAngle?.(editingAngleElement.docId, editingAngleElement.elementId, decimalAngle);\r\n                                    }\r\n                                    setIsAngleDialogOpen(false);\r\n                                }\r\n                            }}\r\n                        />\r\n                    </div>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogCancel className=\"glass-card border-white/10 hover:bg-white/5\">\r\n                            Cancelar\r\n                        </AlertDialogCancel>\r\n                        <AlertDialogAction\r\n                            onClick={() => {\r\n                                if (editingAngleElement) {\r\n                                    const decimalAngle = dmsToDecimal(editingAngleValue);\r\n                                    onUpdatePlacemarkAngle?.(editingAngleElement.docId, editingAngleElement.elementId, decimalAngle);\r\n                                }\r\n                                setIsAngleDialogOpen(false);\r\n                            }}\r\n                            className=\"bg-primary hover:bg-primary/90 text-white font-black uppercase tracking-widest\"\r\n                        >\r\n                            Salvar\r\n                        </AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog >\r\n\r\n            <AlertDialog open={isHeightDialogOpen} onOpenChange={setIsHeightDialogOpen}>\r\n                <AlertDialogContent className=\"glass-card border-white/10 max-w-xl p-8\">\r\n                    <AlertDialogHeader className=\"mb-6\">\r\n                        <AlertDialogTitle className=\"text-2xl font-black uppercase tracking-tight text-white flex items-center gap-3\">\r\n                            <Tower className=\"w-6 h-6 text-primary\" />\r\n                            Editar Altura da Estrutura\r\n                        </AlertDialogTitle>\r\n                        <AlertDialogDescription className=\"text-muted-foreground text-sm uppercase tracking-widest font-bold opacity-60\">\r\n                            Defina a altura vertical do modelo 3D em metros.\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <div className=\"py-8\">\r\n                        <Input\r\n                            value={editingHeightValue}\r\n                            onChange={(e) => setEditingHeightValue(e.target.value)}\r\n                            placeholder=\"Ex: 30.00\"\r\n                            className=\"bg-black/60 border-white/10 text-white font-mono text-3xl h-20 text-center rounded-2xl shadow-inner focus:ring-primary/20\"\r\n                            autoFocus\r\n                            type=\"number\"\r\n                            step=\"0.01\"\r\n                            min=\"0\"\r\n                            onKeyDown={(e) => {\r\n                                if (e.key === 'Enter') {\r\n                                    const height = parseFloat(editingHeightValue.replace(',', '.'));\r\n                                    if (!isNaN(height) && height >= 0 && editingHeightElement) {\r\n                                        onUpdatePlacemarkHeight?.(editingHeightElement.docId, editingHeightElement.elementId, height);\r\n                                    }\r\n                                    setIsHeightDialogOpen(false);\r\n                                }\r\n                            }}\r\n                        />\r\n                    </div>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogCancel className=\"glass-card border-white/10 hover:bg-white/5\">\r\n                            Cancelar\r\n                        </AlertDialogCancel>\r\n                        <AlertDialogAction\r\n                            onClick={() => {\r\n                                const height = parseFloat(editingHeightValue.replace(',', '.'));\r\n                                if (!isNaN(height) && height >= 0 && editingHeightElement) {\r\n                                    onUpdatePlacemarkHeight?.(editingHeightElement.docId, editingHeightElement.elementId, height);\r\n                                }\r\n                                setIsHeightDialogOpen(false);\r\n                            }}\r\n                            className=\"bg-primary hover:bg-primary/90 text-white font-black uppercase tracking-widest\"\r\n                        >\r\n                            Salvar\r\n                        </AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n\r\n            {/* Modal de Confirmação de Exclusão de Vão */}\r\n            <AlertDialog open={isDeleteSpanDialogOpen} onOpenChange={setIsDeleteSpanDialogOpen}>\r\n                <AlertDialogContent className=\"glass-card border-white/10 max-w-md\">\r\n                    <AlertDialogHeader>\r\n                        <AlertDialogTitle className=\"text-lg font-black uppercase tracking-tight text-destructive flex items-center gap-2\">\r\n                            <X className=\"w-5 h-5\" /> Confirmar Exclusão de Vão\r\n                        </AlertDialogTitle>\r\n                        <AlertDialogDescription className=\"text-muted-foreground text-sm\">\r\n                            Você tem certeza que deseja remover este vão e todos os seus cabos associados?<br /><br />\r\n                            <div className=\"bg-black/40 p-2 rounded text-xs font-mono border border-white/5\">\r\n                                {disconnectingSpan ? `${disconnectingSpan.start} ➝ ${disconnectingSpan.end}` : 'Seleção inválida'}\r\n                            </div>\r\n                            <br />\r\n                            Esta ação removerá o registro do banco de dados e recalculará as conexões.\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogCancel className=\"glass-card border-white/10 hover:bg-white/5\">\r\n                            Cancelar\r\n                        </AlertDialogCancel>\r\n                        <AlertDialogAction\r\n                            onClick={async () => {\r\n                                // Ensure token is up to date\r\n                                const token = localStorage.getItem('token') || localStorage.getItem('orion_token') || localStorage.getItem('db.auth.token');\r\n                                if (token && !orionApi.token) {\r\n                                    console.log('🔐 Refreshing API token from storage...');\r\n                                    orionApi.setToken(token);\r\n                                }\r\n\r\n                                if (disconnectingSpan) {\r\n                                    /* Lógica de Exclusão via db/API */\r\n                                    console.log('🗑️ Removendo Vão:', disconnectingSpan);\r\n\r\n                                    // IMEDIATO: Ocultar visualmente para feedback instantâneo (mesmo se API falhar)\r\n                                    // Isso atende ao pedido: \"se nao der para remover, oculte!\"\r\n                                    if (disconnectingSpan.towerStartId && disconnectingSpan.towerEndId) {\r\n                                        const n1 = normalizeName(disconnectingSpan.start);\r\n                                        const n2 = normalizeName(disconnectingSpan.end);\r\n                                        const keyAB = `${n1}:::${n2}`;\r\n                                        const keyBA = `${n2}:::${n1}`;\r\n                                        setHiddenSpans(prev => {\r\n                                            const next = new Set(prev);\r\n                                            next.add(keyAB);\r\n                                            next.add(keyBA);\r\n                                            return next;\r\n                                        });\r\n                                    }\r\n\r\n                                    try {\r\n                                        // 1. Tentar remover pelo ID do SpanTechnicalData se disponível (UUID)\r\n                                        const technicalId = disconnectingSpan.id.split('-')[0];\r\n\r\n                                        let result;\r\n\r\n                                        if (technicalId && technicalId.length > 20 && technicalId !== 'auto') {\r\n                                            console.log(`📡 Removendo via OrionAPI por ID: ${technicalId}`);\r\n                                            result = await orionApi.from('span_technical_data').delete().eq('id', technicalId);\r\n                                        } else {\r\n                                            // Fallback Robusto: Remover por conexão de nomes de torres + projeto\r\n                                            // Usamos os NOMES (start/end) pois é como o banco mapeia torres de KMZs\r\n                                            console.log('🔄 Removendo por par de nomes de torres:', disconnectingSpan.start, disconnectingSpan.end);\r\n\r\n                                            let query = orionApi.from('span_technical_data').delete();\r\n\r\n                                            // Adicionar projectId se disponível para precisão\r\n                                            if (disconnectingSpan.projectId && disconnectingSpan.projectId !== 'all') {\r\n                                                query = query.eq('project_id', disconnectingSpan.projectId);\r\n                                            }\r\n\r\n                                            result = await query\r\n                                                .eq('tower_start_id', disconnectingSpan.start)\r\n                                                .eq('tower_end_id', disconnectingSpan.end);\r\n                                        }\r\n\r\n                                        if (result?.error) throw new Error(result.error.message);\r\n\r\n                                        console.log('✅ Vão removido com sucesso do banco de dados');\r\n\r\n                                        // PERSISTÊNCIA DA OCULTAÇÃO ESTÁVEL\r\n                                        // Usamos os NOMES das torres como chave para garantir que vãos duplicados \r\n                                        // em múltiplos KMLs também sejam ocultados.\r\n                                        const targetProjId = disconnectingSpan.projectId || projectId;\r\n\r\n                                        if (onHidePlacemark && targetProjId && targetProjId !== 'all') {\r\n                                            const normalizedStart = normalizeName(disconnectingSpan.start);\r\n                                            const normalizedEnd = normalizeName(disconnectingSpan.end);\r\n                                            const spanKey = `${normalizedStart}:::${normalizedEnd}`;\r\n\r\n                                            onHidePlacemark(targetProjId, {\r\n                                                id: spanKey,\r\n                                                name: `${disconnectingSpan.start} ➝ ${disconnectingSpan.end}`,\r\n                                                type: 'linestring',\r\n                                                coordinates: { lat: 0, lng: 0, altitude: 0 },\r\n                                                extendedData: { source: '3d_cable_interaction' }\r\n                                            });\r\n                                        }\r\n\r\n                                        toast({\r\n                                            title: \"Vão removido\",\r\n                                            description: \"A exclusão foi persistida no banco de dados com sucesso.\",\r\n                                        });\r\n\r\n                                        // Limpar cache local de vãos se existir\r\n                                        if (typeof (window as any).refetchSpans === 'function') {\r\n                                            (window as any).refetchSpans();\r\n                                        }\r\n\r\n                                    } catch (err: any) {\r\n                                        console.warn('⚠️ Nota de exclusão de vão:', err.message);\r\n\r\n                                        // Treat 404 as \"Already gone\"\r\n                                        if (err.message?.includes('404') || err.message?.includes('P2025') || err.message?.includes('not found')) {\r\n                                            toast({\r\n                                                title: \"Sincronizado\",\r\n                                                description: \"O elemento já havia sido removido ou não foi localizado no servidor.\",\r\n                                            });\r\n                                        } else {\r\n                                            toast({\r\n                                                title: \"Falha na exclusão\",\r\n                                                description: err.message || \"Erro de conexão com o servidor\",\r\n                                                variant: \"destructive\"\r\n                                            });\r\n                                        }\r\n                                    }\r\n                                }\r\n                                setIsDeleteSpanDialogOpen(false);\r\n                            }}\r\n                            className=\"bg-destructive hover:bg-destructive/90 text-white font-black uppercase tracking-widest\"\r\n                        >\r\n                            Excluir Vão\r\n                        </AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n\r\n            <AlertDialog open={isElevationDialogOpen} onOpenChange={setIsElevationDialogOpen}>\r\n                <AlertDialogContent className=\"glass-card border-white/10 max-w-xl p-8\">\r\n                    <AlertDialogHeader className=\"mb-6\">\r\n                        <AlertDialogTitle className=\"text-2xl font-black uppercase tracking-tight text-white flex items-center gap-3\">\r\n                            <Navigation className=\"w-6 h-6 text-emerald-400\" />\r\n                            Ajustar Elevação do Terreno\r\n                        </AlertDialogTitle>\r\n                        <AlertDialogDescription className=\"text-muted-foreground text-sm uppercase tracking-widest font-bold opacity-60\">\r\n                            Cota GPS atualizada para a base desta estrutura.\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <div className=\"py-8\">\r\n                        <Input\r\n                            value={editingElevationValue}\r\n                            onChange={(e) => setEditingElevationValue(e.target.value)}\r\n                            placeholder=\"Ex: 850.00\"\r\n                            className=\"bg-black/60 border-white/10 text-white font-mono text-3xl h-20 text-center rounded-2xl shadow-inner focus:ring-emerald-500/20\"\r\n                            autoFocus\r\n                            type=\"number\"\r\n                            step=\"0.01\"\r\n                            onKeyDown={(e) => {\r\n                                if (e.key === 'Enter') {\r\n                                    const elevation = parseFloat(editingElevationValue.replace(',', '.'));\r\n                                    if (!isNaN(elevation) && editingElevationElement) {\r\n                                        onUpdatePlacemarkElevation?.(editingElevationElement.docId, editingElevationElement.elementId, elevation);\r\n                                    }\r\n                                    setIsElevationDialogOpen(false);\r\n                                }\r\n                            }}\r\n                        />\r\n                    </div>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogCancel className=\"glass-card border-white/10 hover:bg-white/5\">\r\n                            Cancelar\r\n                        </AlertDialogCancel>\r\n                        <AlertDialogAction\r\n                            onClick={() => {\r\n                                const elevation = parseFloat(editingElevationValue.replace(',', '.'));\r\n                                if (!isNaN(elevation) && editingElevationElement) {\r\n                                    onUpdatePlacemarkElevation?.(editingElevationElement.docId, editingElevationElement.elementId, elevation);\r\n                                }\r\n                                setIsElevationDialogOpen(false);\r\n                            }}\r\n                            className=\"bg-primary hover:bg-primary/90 text-white font-black uppercase tracking-widest\"\r\n                        >\r\n                            Salvar\r\n                        </AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog >\r\n            <Dialog open={isTransformDialogOpen} onOpenChange={setIsTransformDialogOpen}>\r\n                <DialogContent className=\"glass-card border-white/10 bg-black/95 text-white max-w-5xl p-10 overflow-hidden\">\r\n                    <DialogHeader className=\"mb-8\">\r\n                        <DialogTitle className=\"flex items-center gap-4 text-primary font-black uppercase tracking-[0.3em] text-xl\">\r\n                            <div className=\"p-3 rounded-2xl bg-primary/10 border border-primary/20 shadow-glow-sm\">\r\n                                <Settings className=\"w-7 h-7\" />\r\n                            </div>\r\n                            Transformação 3D: {selectedPlacemark?.name}\r\n                        </DialogTitle>\r\n                        <DialogDescription className=\"text-xs text-white/40 font-bold uppercase tracking-[0.2em] mt-2 ml-14\">\r\n                            Sincronização em tempo real de escala, rotação e offsets técnicos.\r\n                        </DialogDescription>\r\n                    </DialogHeader>\r\n\r\n                    {editingTransform && (\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 py-6\">\r\n                            {/* Escala e Altura Base */}\r\n                            <div className=\"space-y-6\">\r\n                                <div className=\"space-y-4 p-4 bg-white/3 rounded-xl border border-white/5\">\r\n                                    <div className=\"flex items-center justify-between\">\r\n                                        <Label className=\"text-[9px] font-black uppercase tracking-[0.2em] text-white/60 flex items-center gap-2\">\r\n                                            <Ruler className=\"w-3 h-3 text-primary\" /> Multiplicador Base\r\n                                        </Label>\r\n                                        <span className=\"text-xs font-black text-primary font-mono\">{(editingTransform.baseHeight || 1).toFixed(2)}x</span>\r\n                                    </div>\r\n                                    <Slider\r\n                                        value={[editingTransform.baseHeight || 1]}\r\n                                        min={0.1} max={5} step={0.01}\r\n                                        onValueChange={([v]) => setEditingTransform(prev => prev ? ({ ...prev, baseHeight: v }) : null)}\r\n                                        className=\"py-2\"\r\n                                    />\r\n                                </div>\r\n\r\n                                <div className=\"space-y-4\">\r\n                                    <Label className=\"text-[9px] font-black uppercase tracking-[0.2em] text-white/60 flex items-center gap-2\">\r\n                                        <Maximize className=\"w-3 h-3 text-primary\" /> Escala (X, Y, Z)\r\n                                    </Label>\r\n                                    <div className=\"grid grid-cols-3 gap-2\">\r\n                                        {['X', 'Y', 'Z'].map((axis, i) => (\r\n                                            <div key={axis} className=\"space-y-1.5\">\r\n                                                <span className=\"text-[8px] font-black text-white/20 ml-1\">{axis}</span>\r\n                                                <Input\r\n                                                    type=\"number\" step=\"0.01\"\r\n                                                    value={editingTransform.scale[i]}\r\n                                                    onChange={(e) => {\r\n                                                        const val = parseFloat(e.target.value) || 1;\r\n                                                        const ns = [...editingTransform.scale] as [number, number, number];\r\n                                                        ns[i] = val;\r\n                                                        setEditingTransform(prev => prev ? ({ ...prev, scale: ns }) : null);\r\n                                                    }}\r\n                                                    className=\"h-8 bg-black/40 border-white/5 text-[10px] font-mono text-center\"\r\n                                                />\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Rotação e Translação */}\r\n                            <div className=\"space-y-6\">\r\n                                <div className=\"space-y-4\">\r\n                                    <Label className=\"text-[9px] font-black uppercase tracking-[0.2em] text-white/60 flex items-center gap-2\">\r\n                                        <RotateCcw className=\"w-3 h-3 text-primary\" /> Rotação (Graus)\r\n                                    </Label>\r\n                                    <div className=\"grid grid-cols-3 gap-2\">\r\n                                        {['Pitch', 'Roll', 'Yaw'].map((axis, i) => (\r\n                                            <div key={axis} className=\"space-y-1.5\">\r\n                                                <span className=\"text-[8px] font-black text-white/20 ml-1\">{axis}</span>\r\n                                                <Input\r\n                                                    type=\"number\" step=\"1\"\r\n                                                    value={editingTransform.rotation[i]}\r\n                                                    onChange={(e) => {\r\n                                                        const val = parseFloat(e.target.value) || 0;\r\n                                                        const nr = [...editingTransform.rotation] as [number, number, number];\r\n                                                        nr[i] = val;\r\n                                                        setEditingTransform(prev => prev ? ({ ...prev, rotation: nr }) : null);\r\n                                                    }}\r\n                                                    className=\"h-8 bg-black/40 border-white/5 text-[10px] font-mono text-center\"\r\n                                                />\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-4\">\r\n                                    <Label className=\"text-[9px] font-black uppercase tracking-[0.2em] text-white/60 flex items-center gap-2\">\r\n                                        <Move className=\"w-3 h-3 text-primary\" /> Deslocamento (Metros)\r\n                                    </Label>\r\n                                    <div className=\"grid grid-cols-3 gap-2\">\r\n                                        {['E', 'N', 'U'].map((axis, i) => (\r\n                                            <div key={axis} className=\"space-y-1.5\">\r\n                                                <span className=\"text-[8px] font-black text-white/20 ml-1\">{axis}</span>\r\n                                                <Input\r\n                                                    type=\"number\" step=\"0.1\"\r\n                                                    value={editingTransform.offset[i]}\r\n                                                    onChange={(e) => {\r\n                                                        const val = parseFloat(e.target.value) || 0;\r\n                                                        const no = [...editingTransform.offset] as [number, number, number];\r\n                                                        no[i] = val;\r\n                                                        setEditingTransform(prev => prev ? ({ ...prev, offset: no }) : null);\r\n                                                    }}\r\n                                                    className=\"h-8 bg-black/40 border-white/5 text-[10px] font-mono text-center\"\r\n                                                />\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <Button\r\n                                    variant=\"outline\"\r\n                                    onClick={() => setEditingTransform({\r\n                                        scale: [1, 1, 1],\r\n                                        rotation: [0, 0, 0],\r\n                                        offset: [0, 0, 0],\r\n                                        baseHeight: 1\r\n                                    })}\r\n                                    className=\"w-full h-9 border-white/5 bg-white/2 hover:bg-white/5 text-[9px] font-black uppercase tracking-widest gap-2\"\r\n                                >\r\n                                    <RefreshCw className=\"w-3 h-3\" /> Resetar\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    <DialogFooter className=\"border-t border-white/5 pt-6 gap-3\">\r\n                        <Button\r\n                            variant=\"outline\"\r\n                            size=\"sm\"\r\n                            onClick={handleAutoConnectAll}\r\n                            disabled={isAutoConnecting || !projectId || projectId === 'all'}\r\n                            className=\"w-full h-11 border-primary/30 text-primary hover:bg-primary/10 text-[10px] uppercase font-black tracking-widest gap-2\"\r\n                        >\r\n                            <RefreshCw className={cn(\"w-4 h-4\", isAutoConnecting && \"animate-spin\")} />\r\n                            {isAutoConnecting ? 'Conectando...' : 'Auto-Conectar Projeto'}\r\n                        </Button>\r\n\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            onClick={() => setIsTransformDialogOpen(false)}\r\n                            className=\"h-11 px-8 text-[10px] font-black uppercase tracking-widest text-white/40 hover:text-white\"\r\n                        >\r\n                            Cancelar\r\n                        </Button>\r\n                        <Button\r\n                            onClick={() => {\r\n                                if (editingTransform && editingTransformTarget) {\r\n                                    onUpdatePlacemarkTransform?.(\r\n                                        editingTransformTarget.docId,\r\n                                        editingTransformTarget.elementId,\r\n                                        editingTransform\r\n                                    );\r\n                                }\r\n                                setIsTransformDialogOpen(false);\r\n                            }}\r\n                            className=\"h-11 px-8 bg-primary hover:bg-primary/90 text-white font-black uppercase tracking-widest gap-2\"\r\n                        >\r\n                            <SaveIcon className=\"w-4 h-4\" /> Salvar Alterações\r\n                        </Button>\r\n                    </DialogFooter>\r\n                </DialogContent>\r\n            </Dialog>\r\n\r\n\r\n        </>\r\n    );\r\n};\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\map\\mapbox-cable-interaction.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[236,239],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[236,239],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[263,266],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[263,266],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[297,300],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[297,300],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'onSelectSpan' is defined but never used.","line":19,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[753,756],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[753,756],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[847,850],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[847,850],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1574,1577],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1574,1577],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1600,1603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1600,1603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":117,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4844,4847],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4844,4847],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":117,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4869,4872],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4869,4872],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\r\nimport { Source, Layer, useMap } from 'react-map-gl/mapbox';\r\n\r\nimport { CatenaryCalculator } from '@/services/catenary-calculator';\r\n\r\ninterface MapboxCableInteractionProps {\r\n    projectSpans: any[];\r\n    visibleTowers: any[];\r\n    onSelectSpan?: (span: any) => void;\r\n    hiddenPlacemarkIds?: Set<string>;\r\n    projectId?: string;\r\n}\r\n\r\nconst normalizeName = (name: string) => (name || '').trim().toUpperCase();\r\n\r\nexport function MapboxCableInteraction({\r\n    projectSpans,\r\n    visibleTowers,\r\n    onSelectSpan,\r\n    hiddenPlacemarkIds = new Set(),\r\n    projectId\r\n}: MapboxCableInteractionProps) {\r\n    const { current: map } = useMap();\r\n\r\n    const geojsonData = useMemo(() => {\r\n        const features: any[] = [];\r\n        const towerMap = new Map();\r\n        const towersByDoc = new Map<string, any[]>();\r\n        const connectedPairs = new Set<string>();\r\n\r\n        // Pre-process towers with terrain if map is available\r\n        const resolvedTowers = visibleTowers.map(t => {\r\n            let el = t.elevation;\r\n            if ((!el || el === 0) && map) {\r\n                const terrainEl = map.queryTerrainElevation([t.coordinates.lng, t.coordinates.lat]);\r\n                if (terrainEl !== null) el = terrainEl;\r\n            }\r\n            return { ...t, elevation: el };\r\n        });\r\n\r\n        resolvedTowers.forEach(t => {\r\n            const nName = normalizeName(t.name);\r\n            if (nName) towerMap.set(nName, t);\r\n            if (t.id) towerMap.set(t.id.toString(), t);\r\n\r\n            const docId = (t as any).document_id || (t as any).projectId || 'unknown';\r\n            if (!towersByDoc.has(docId)) towersByDoc.set(docId, []);\r\n            towersByDoc.get(docId)!.push(t);\r\n        });\r\n\r\n        // 1. Manual Spans\r\n        projectSpans.forEach(span => {\r\n            const sName = normalizeName(span.tower_start_id);\r\n            const eName = normalizeName(span.tower_end_id);\r\n            const t1 = towerMap.get(sName);\r\n            const t2 = towerMap.get(eName);\r\n\r\n            // CHECK HIDING\r\n            const tProjId = span.project_id || projectId;\r\n            const hKeyAB = `${tProjId}:::${sName}:::${eName}`;\r\n            const hKeyBA = `${tProjId}:::${eName}:::${sName}`;\r\n\r\n            if (hiddenPlacemarkIds.has(hKeyAB) || hiddenPlacemarkIds.has(hKeyBA)) {\r\n                return;\r\n            }\r\n\r\n            if (t1 && t2) {\r\n                connectedPairs.add([sName, eName].sort().join(':::'));\r\n                const hStart = span.height_start || t1.towerHeight || 30;\r\n                const hEnd = span.height_end || t2.towerHeight || 30;\r\n\r\n                const p1 = { x: t1.coordinates.lng, y: t1.coordinates.lat, z: 1000 + hStart };\r\n                const p2 = { x: t2.coordinates.lng, y: t2.coordinates.lat, z: 1000 + hEnd };\r\n\r\n                const points = CatenaryCalculator.generateCatenaryPoints(p1, p2, span.catenary_constant || 1200, 10);\r\n                const coords = points.map(p => [p.x, p.y, p.z]);\r\n\r\n                features.push({\r\n                    type: 'Feature',\r\n                    id: span.id,\r\n                    properties: { ...span, source: 'cable_interaction', isAuto: false },\r\n                    geometry: { type: 'LineString', coordinates: coords }\r\n                });\r\n            }\r\n        });\r\n\r\n        // 2. Auto-detected Spans (Sync with Mapbox3DLayer)\r\n        const MAX_AUTO_SPAN_DISTANCE = 1000;\r\n        const getDist = (lat1: number, lon1: number, lat2: number, lon2: number) => {\r\n            const R = 6371e3;\r\n            const φ1 = lat1 * Math.PI / 180;\r\n            const φ2 = lat2 * Math.PI / 180;\r\n            const Δφ = (lat2 - lat1) * Math.PI / 180;\r\n            const Δλ = (lon2 - lon1) * Math.PI / 180;\r\n            const a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) + Math.cos(φ1) * Math.cos(φ2) * Math.sin(Δλ / 2) * Math.sin(Δλ / 2);\r\n            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n        };\r\n\r\n        towersByDoc.forEach((placemarks, dId) => {\r\n            const sorted = [...placemarks].sort((a, b) => {\r\n                const n1 = parseInt((a.name || '').replace(/\\D/g, ''));\r\n                const n2 = parseInt((b.name || '').replace(/\\D/g, ''));\r\n                if (!isNaN(n1) && !isNaN(n2)) return n1 - n2;\r\n                return (a.name || '').localeCompare(b.name || '');\r\n            });\r\n\r\n            for (let i = 0; i < sorted.length - 1; i++) {\r\n                const t1 = sorted[i];\r\n                const t2 = sorted[i + 1];\r\n                const sName = normalizeName(t1.name);\r\n                const eName = normalizeName(t2.name);\r\n                const pairKey = [sName, eName].sort().join(':::');\r\n\r\n                if (connectedPairs.has(pairKey)) continue;\r\n\r\n                // CHECK HIDING\r\n                const tProjId = (t1 as any).projectId || (t1 as any).document_id || projectId;\r\n                const hKeyAB = `${tProjId}:::${sName}:::${eName}`;\r\n                const hKeyBA = `${tProjId}:::${eName}:::${sName}`;\r\n\r\n                if (hiddenPlacemarkIds.has(hKeyAB) || hiddenPlacemarkIds.has(hKeyBA)) {\r\n                    continue;\r\n                }\r\n\r\n                const d = getDist(t1.coordinates.lat, t1.coordinates.lng, t2.coordinates.lat, t2.coordinates.lng);\r\n                if (d > MAX_AUTO_SPAN_DISTANCE) continue;\r\n\r\n                connectedPairs.add(pairKey);\r\n\r\n                const p1 = { x: t1.coordinates.lng, y: t1.coordinates.lat, z: 1000 + (t1.towerHeight || 30) };\r\n                const p2 = { x: t2.coordinates.lng, y: t2.coordinates.lat, z: 1000 + (t2.towerHeight || 30) };\r\n\r\n                const points = CatenaryCalculator.generateCatenaryPoints(p1, p2, 1200, 10);\r\n                const coords = points.map(p => [p.x, p.y, p.z]);\r\n\r\n                features.push({\r\n                    type: 'Feature',\r\n                    id: `auto-${dId}-${i}`,\r\n                    properties: {\r\n                        id: `auto-${dId}-${i}`,\r\n                        name: `Cabo Automático ${t1.name}-${t2.name}`,\r\n                        source: 'cable_interaction',\r\n                        isAuto: true,\r\n                        document_id: dId\r\n                    },\r\n                    geometry: { type: 'LineString', coordinates: coords }\r\n                });\r\n            }\r\n        });\r\n\r\n        return { type: 'FeatureCollection' as const, features };\r\n    }, [projectSpans, visibleTowers, map, hiddenPlacemarkIds, projectId]);\r\n\r\n\r\n    return (\r\n        <Source id=\"cable-interaction-source\" type=\"geojson\" data={geojsonData}>\r\n            <Layer\r\n                id=\"cable-interaction-layer\"\r\n                type=\"line\"\r\n                layout={{\r\n                    'line-elevation-reference': 'sea'\r\n                }}\r\n                paint={{\r\n                    'line-width': 15,\r\n                    'line-opacity': 0 // Invisible but clickable\r\n                }}\r\n            />\r\n            {/* Debug Layer (Uncomment to see interaction areas) */}\r\n            {/* <Layer\r\n                id=\"cable-debug-layer\"\r\n                type=\"line\"\r\n                paint={{\r\n                    'line-width': 2,\r\n                    'line-color': '#ff0000',\r\n                    'line-opacity': 0.2\r\n                }}\r\n            /> */}\r\n        </Source>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\map\\mapbox-kmz-layer.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useState' is defined but never used.","line":1,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":25},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":48,"column":42,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":48,"endColumn":43,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1955,1956],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1955,1955],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":48,"column":122,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":48,"endColumn":123,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2035,2036],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2035,2035],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":87,"column":38,"nodeType":"BlockStatement","messageId":"unexpected","endLine":88,"endColumn":18,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4021,4039],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":139,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6176,6179],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6176,6179],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'pointLayer' is assigned a value but never used.","line":165,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":165,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'renderDescription' is assigned a value but never used.","line":323,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":323,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":339,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":339,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13082,13085],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13082,13085],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isLineString' is assigned a value but never used.","line":345,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":345,"endColumn":35},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'sourceId'. Either include it or remove the dependency array.","line":381,"column":8,"nodeType":"ArrayExpression","endLine":381,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [map, onMapClick, sourceId]","fix":{"range":[14675,14692],"text":"[map, onMapClick, sourceId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":461,"column":205,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":461,"endColumn":208,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19798,19801],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19798,19801],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":465,"column":196,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":465,"endColumn":199,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20486,20489],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20486,20489],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo, useEffect, useCallback } from 'react';\r\nimport { Source, Layer, Popup, useMap } from 'react-map-gl/mapbox';\r\nimport type { KMLDocument, KMLPlacemark } from '@/types/kmz';\r\nimport type { LayerProps } from 'react-map-gl/mapbox';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Navigation, X } from 'lucide-react';\r\n\r\ninterface MapboxKMZLayerProps {\r\n    document: KMLDocument;\r\n    hiddenPlacemarkIds?: Set<string>;\r\n    placemarkOverrides?: Record<string, { name?: string, angle?: number, color?: string }>;\r\n    show3D?: boolean;\r\n    selectedPlacemark?: KMLPlacemark | null;\r\n    onSelectPlacemark?: (placemark: KMLPlacemark | null) => void;\r\n    onHidePlacemark?: (docId: string, placemark: KMLPlacemark) => void;\r\n    selectedProjectId?: string;\r\n}\r\n\r\nexport function MapboxKMZLayer({\r\n    document,\r\n    hiddenPlacemarkIds = new Set(),\r\n    placemarkOverrides = {},\r\n    show3D = false,\r\n    selectedPlacemark,\r\n    onSelectPlacemark,\r\n    onHidePlacemark,\r\n    selectedProjectId = 'all'\r\n}: MapboxKMZLayerProps) {\r\n    const { current: map } = useMap();\r\n    const sourceId = useMemo(() => `kmz-data-${document.id || Math.random().toString(36).substr(2, 9)}`, [document.id]);\r\n\r\n    const openInGPS = () => {\r\n        if (!selectedPlacemark) return;\r\n        const { lat, lng } = selectedPlacemark.coordinates;\r\n        const url = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;\r\n        window.open(url, '_blank');\r\n    };\r\n\r\n    // Convert KML placemarks to GeoJSON\r\n    const geojsonData = useMemo(() => {\r\n        const docId = document.id || document.name;\r\n\r\n        const features = document.placemarks.map((placemark) => {\r\n            const compositeId = `${docId}:::${placemark.id}`;\r\n            const override = placemarkOverrides[compositeId];\r\n\r\n            const normalizedName = (placemark.name || '').trim().toUpperCase();\r\n            const isTowerFormat = /^(\\d+[\\/-]\\d+[A-Za-z]*|TRIO.*|[A-Za-z]+\\d+.*|.*TORRE.*|.*ESTR.*|.*AP\\d+.*|.*STR.*|.*V[\\/-]\\d+.*|\\d+)(?:\\s*\\/.*)?$/i.test(normalizedName);\r\n            const isGenericPoint = /^PONTO[\\s-]*\\d+.*$/i.test(normalizedName);\r\n            const isTechnicalPoint = placemark.type === 'point' && isTowerFormat && !isGenericPoint;\r\n\r\n            // Ocultar elementos técnicos se nenhuma obra estiver selecionada\r\n            if (selectedProjectId === 'all' && (isTechnicalPoint || placemark.type === 'linestring')) {\r\n                return null;\r\n            }\r\n\r\n            if (placemark.type === 'point') {\r\n                return {\r\n                    type: 'Feature' as const,\r\n                    id: placemark.id,\r\n                    properties: {\r\n                        id: placemark.id,\r\n                        name: override?.name || placemark.name,\r\n                        description: placemark.description,\r\n                        type: placemark.type,\r\n                        color: override?.color,\r\n                        ...placemark.extendedData\r\n                    },\r\n                    geometry: {\r\n                        type: 'Point' as const,\r\n                        coordinates: [placemark.coordinates.lng, placemark.coordinates.lat]\r\n                    }\r\n                };\r\n            }\r\n\r\n            if (placemark.type === 'linestring' && placemark.path) {\r\n                // Technical drawing style: default to electric blue or cyan if not specified\r\n                let baseColor = placemark.style?.lineColor || '#22d3ee';\r\n                if (placemark.name.toLowerCase().includes('área') || placemark.name.toLowerCase().includes('poligonal')) {\r\n                    baseColor = '#22d3ee'; // Cyan for areas/poligonals\r\n                }\r\n\r\n                // If we have an override with an empty string, it means \"Reset/Original\"\r\n                // If it's undefined, we use baseColor\r\n                const finalColor = override?.color === '' ? baseColor : (override?.color || baseColor);\r\n\r\n                if (override?.color) {\r\n                }\r\n\r\n                return {\r\n                    type: 'Feature' as const,\r\n                    id: placemark.id,\r\n                    properties: {\r\n                        id: placemark.id,\r\n                        name: override?.name || placemark.name,\r\n                        description: placemark.description,\r\n                        type: placemark.type,\r\n                        lineColor: finalColor,\r\n                        lineWidth: placemark.style?.lineWidth || 3,\r\n                        ...placemark.extendedData\r\n                    },\r\n                    geometry: {\r\n                        type: 'LineString' as const,\r\n                        coordinates: placemark.path.map(p => [\r\n                            p.lng,\r\n                            p.lat,\r\n                            0 // Fixado no chão conforme solicitado pelo usuário\r\n                        ])\r\n                    }\r\n\r\n                };\r\n            }\r\n\r\n            if (placemark.type === 'polygon' && placemark.path) {\r\n                const baseColor = placemark.style?.fillColor || '#22d3ee';\r\n                const finalColor = override?.color === '' ? baseColor : (override?.color || baseColor);\r\n\r\n                return {\r\n                    type: 'Feature' as const,\r\n                    id: placemark.id,\r\n                    properties: {\r\n                        id: placemark.id,\r\n                        name: override?.name || placemark.name,\r\n                        description: placemark.description,\r\n                        type: placemark.type,\r\n                        lineColor: finalColor, // Use finalColor (override) here as well\r\n                        fillColor: finalColor,\r\n                        fillOpacity: placemark.style?.fillOpacity || 0.25,\r\n                        ...placemark.extendedData\r\n                    },\r\n                    geometry: {\r\n                        type: 'Polygon' as const,\r\n                        coordinates: [placemark.path.map(p => [p.lng, p.lat])]\r\n                    }\r\n                };\r\n            }\r\n\r\n            return null;\r\n        }).filter(Boolean) as any[];\r\n\r\n        // Filter out features that are hidden (either manually by user or by database is_hidden flag)\r\n        const filteredFeatures = features.filter(f => {\r\n            const isManualHidden = hiddenPlacemarkIds.has(`${docId}:::${f.id}`);\r\n            const isDbHidden = f.properties?.is_hidden === true || f.properties?.isHidden === true || String(f.properties?.is_hidden).toLowerCase() === 'true' || Number(f.properties?.is_hidden) === 1;\r\n            return !isManualHidden && !isDbHidden;\r\n        });\r\n\r\n        // TEST MODE: Allow KMZ LineStrings even in 3D to see \"Tours\" (Alignment, Centerline, etc)\r\n        // We no longer strictly filter all LineStrings. \r\n        // We can add logic later to keep only technical ones if needed.\r\n        /* \r\n        if (show3D) {\r\n            filteredFeatures = filteredFeatures.filter(f => f.geometry.type !== 'LineString');\r\n        }\r\n        */\r\n\r\n        return {\r\n            type: 'FeatureCollection' as const,\r\n            features: filteredFeatures\r\n        };\r\n\r\n    }, [document, hiddenPlacemarkIds, placemarkOverrides, selectedProjectId]);\r\n\r\n    // Layer styles\r\n    const pointLayer: LayerProps = {\r\n        id: `${sourceId}-points`,\r\n        type: 'circle',\r\n        source: sourceId,\r\n        filter: ['==', ['get', 'type'], 'point'],\r\n        minzoom: 13.5,\r\n        paint: {\r\n            'circle-radius': 6,\r\n            'circle-color': ['coalesce', ['get', 'color'], '#0ea5e9'],\r\n            'circle-stroke-width': 2,\r\n            'circle-stroke-color': '#ffffff',\r\n            'circle-opacity': 0.8\r\n        }\r\n    };\r\n\r\n    const lineLayer: LayerProps = {\r\n        id: `${sourceId}-lines`,\r\n        type: 'line',\r\n        source: sourceId,\r\n        filter: ['==', ['get', 'type'], 'linestring'],\r\n        layout: {\r\n            'line-join': 'round',\r\n            'line-cap': 'round',\r\n            'line-elevation-reference': 'ground'\r\n        },\r\n        paint: {\r\n            'line-color': [\r\n                'case',\r\n                ['in', 'ALIGNMENT', ['upcase', ['get', 'name']]], '#22d3ee',\r\n                ['in', 'CENTERLINE', ['upcase', ['get', 'name']]], '#4ade80',\r\n                ['in', 'OFFSET', ['upcase', ['get', 'name']]], '#fde047',\r\n                ['coalesce', ['get', 'lineColor'], '#22d3ee']\r\n            ],\r\n            'line-width': [\r\n                'case',\r\n                ['any',\r\n                    ['in', 'ALIGNMENT', ['upcase', ['get', 'name']]],\r\n                    ['in', 'CENTERLINE', ['upcase', ['get', 'name']]],\r\n                    ['in', 'OFFSET', ['upcase', ['get', 'name']]]\r\n                ], 4,\r\n                ['coalesce', ['get', 'lineWidth'], 3]\r\n            ],\r\n            'line-opacity': 1.0,\r\n            // Halo effect for technical look\r\n            'line-blur': 0.2\r\n        }\r\n\r\n    };\r\n\r\n\r\n    const lineHaloLayer: LayerProps = {\r\n        id: `${sourceId}-lines-halo`,\r\n        type: 'line',\r\n        source: sourceId,\r\n        filter: ['==', ['get', 'type'], 'linestring'],\r\n        layout: {\r\n            'line-join': 'round',\r\n            'line-cap': 'round',\r\n            'line-elevation-reference': 'ground'\r\n        },\r\n        paint: {\r\n            'line-color': '#ffffff',\r\n            'line-width': ['+', ['get', 'lineWidth'], 2],\r\n            'line-opacity': 0.3,\r\n            'line-blur': 1\r\n        }\r\n    };\r\n\r\n    const lineInteractionLayer: LayerProps = {\r\n        id: `${sourceId}-lines-interaction`,\r\n        type: 'line',\r\n        source: sourceId,\r\n        filter: ['==', ['get', 'type'], 'linestring'],\r\n        layout: {\r\n            'line-join': 'round',\r\n            'line-cap': 'round',\r\n            'line-elevation-reference': 'ground'\r\n        },\r\n        paint: {\r\n            'line-width': 20,\r\n            'line-opacity': 0\r\n        }\r\n    };\r\n\r\n    const polygonFillLayer: LayerProps = {\r\n        id: `${sourceId}-polygons-fill`,\r\n        type: 'fill',\r\n        source: sourceId,\r\n        filter: ['==', ['get', 'type'], 'polygon'],\r\n        paint: {\r\n            'fill-color': ['get', 'fillColor'],\r\n            'fill-opacity': 0.2\r\n        }\r\n    };\r\n\r\n    const polygonOutlineLayer: LayerProps = {\r\n        id: `${sourceId}-polygons-outline`,\r\n        type: 'line',\r\n        source: sourceId,\r\n        filter: ['==', ['get', 'type'], 'polygon'],\r\n        layout: {\r\n            'line-elevation-reference': 'ground'\r\n        },\r\n        paint: {\r\n            'line-color': ['get', 'lineColor'],\r\n            'line-width': 3,\r\n            'line-opacity': 0.8\r\n        }\r\n    };\r\n\r\n    const labelLayer: LayerProps = {\r\n        id: `${sourceId}-labels`,\r\n        type: 'symbol',\r\n        source: sourceId,\r\n        filter: [\r\n            'all',\r\n            ['==', ['get', 'type'], 'point'],\r\n            ['all',\r\n                ['!', ['in', 'PONTO', ['upcase', ['get', 'name']]]],\r\n                ['!', ['in', 'TOUR', ['upcase', ['get', 'name']]]],\r\n                ['!', ['in', 'FOTO', ['upcase', ['get', 'name']]]]\r\n            ]\r\n        ],\r\n        minzoom: 14, // Começa a aparecer um pouco mais cedo\r\n        layout: {\r\n            'text-field': ['get', 'name'],\r\n            'text-font': ['DIN Pro Bold', 'Arial Unicode MS Bold'],\r\n            'text-size': 10,\r\n            'text-offset': [0, 0.5], // Pequeno ajuste para não sobrepor o ícone circular\r\n            'text-anchor': 'top',\r\n            'text-letter-spacing': 0.1,\r\n            'text-transform': 'uppercase',\r\n            'text-allow-overlap': false,\r\n            'text-ignore-placement': false\r\n        },\r\n        paint: {\r\n            'text-color': '#fbbf24', // Amarelo constante agora (único label)\r\n            'text-halo-color': 'rgba(0, 0, 0, 0.8)',\r\n            'text-halo-width': 1.5,\r\n            'text-halo-blur': 0.5\r\n        }\r\n    };\r\n\r\n    // Detail label removed in favor of unified yellow label layer above\r\n\r\n    const highlightLayer: LayerProps = {\r\n        id: `${sourceId}-highlight`,\r\n        type: 'line',\r\n        source: sourceId,\r\n        filter: ['==', ['get', 'id'], selectedPlacemark?.id || ''],\r\n        paint: {\r\n            'line-color': '#fbbf24',\r\n            'line-width': 5,\r\n            'line-opacity': 1,\r\n            'line-blur': 2\r\n        }\r\n    };\r\n\r\n    const renderDescription = (html: string) => {\r\n        if (!html) return null;\r\n        const parts = html.split(/(<br\\s*\\/?>|<b\\s*>|<\\/b\\s*>)/gi);\r\n        return parts.map((part, i) => {\r\n            const lower = part.toLowerCase();\r\n            if (lower.startsWith('<br')) return <br key={i} />;\r\n            if (lower === '<b>') return null;\r\n            if (lower === '</b>') return null;\r\n\r\n            const isBold = i > 0 && parts[i - 1].toLowerCase() === '<b>';\r\n            if (isBold) return <strong key={i} className=\"text-primary font-black\">{part}</strong>;\r\n\r\n            return part;\r\n        });\r\n    };\r\n\r\n    const onMapClick = useCallback((e: any) => {\r\n        const features = e.features;\r\n        if (features && features.length > 0) {\r\n            const feature = features[0];\r\n            const placemark = document.placemarks.find(p => p.id === feature.properties.id);\r\n            if (placemark) {\r\n                const isLineString = placemark.type === 'linestring';\r\n\r\n                // Se for ponto e estiver no modo 3D com zoom alto, pulamos para evitar conflito com os marcadores 3D\r\n                // Mas permitimos o clique em qualquer outro objeto (linhas, polígonos ou pontos normais)\r\n\r\n                // If 3D is active and we are zoomed in, skip POINTS that have 3D models \r\n                // to avoid double popups, but allow clicking on CABLES/LINES.\r\n                if (show3D && (map?.getZoom() || 0) > 15.5 && placemark.type === 'point') {\r\n                    return;\r\n                }\r\n\r\n                onSelectPlacemark?.(placemark);\r\n            }\r\n        } else {\r\n            onSelectPlacemark?.(null);\r\n        }\r\n    }, [document, show3D, map, onSelectPlacemark]);\r\n\r\n    useEffect(() => {\r\n        if (!map) return;\r\n\r\n        const clickHandlers = [\r\n            `${sourceId}-points`,\r\n            `${sourceId}-lines`,\r\n            `${sourceId}-lines-interaction`,\r\n            `${sourceId}-polygons-fill`\r\n        ];\r\n        clickHandlers.forEach(layerId => {\r\n            map.on('click', layerId, onMapClick);\r\n        });\r\n\r\n        return () => {\r\n            clickHandlers.forEach(layerId => {\r\n                map.off('click', layerId, onMapClick);\r\n            });\r\n        };\r\n    }, [map, onMapClick]);\r\n\r\n    return (\r\n        <>\r\n            <Source\r\n                id={sourceId}\r\n                type=\"geojson\"\r\n                data={geojsonData as GeoJSON.FeatureCollection}\r\n                lineMetrics={true}\r\n            >\r\n                <Layer {...lineHaloLayer} />\r\n                <Layer {...lineLayer} />\r\n                <Layer {...lineInteractionLayer} />\r\n                <Layer {...polygonFillLayer} />\r\n                <Layer {...polygonOutlineLayer} />\r\n                <Layer {...labelLayer} />\r\n                <Layer\r\n                    {...highlightLayer}\r\n                    layout={{ visibility: selectedPlacemark ? 'visible' : 'none' }}\r\n                />\r\n            </Source>\r\n\r\n            {!show3D && selectedPlacemark && document.placemarks.some(p => p.id === selectedPlacemark.id) && (\r\n                <Popup\r\n                    longitude={selectedPlacemark.coordinates.lng}\r\n                    latitude={selectedPlacemark.coordinates.lat}\r\n                    onClose={() => onSelectPlacemark?.(null)}\r\n                    closeOnClick={false}\r\n                    className=\"mapbox-popup-industrial\"\r\n                    maxWidth=\"340px\"\r\n                >\r\n                    <div className=\"p-0 bg-background/95 backdrop-blur-xl border border-white/10 rounded-3xl overflow-hidden shadow-2xl\">\r\n                        {/* Technical Information Header */}\r\n                        <div className=\"bg-primary/20 border-b border-white/5 p-5 relative overflow-hidden group\">\r\n                            <div className=\"flex items-center gap-3 mb-3\">\r\n                                <div className=\"w-2 h-2 rounded-full bg-primary animate-pulse shadow-[0_0_8px_rgba(var(--primary),0.8)]\" />\r\n                                <span className=\"text-[10px] font-black uppercase tracking-[0.2em] text-primary/80 leading-none\">\r\n                                    ESPECIFICAÇÕES TÉCNICAS\r\n                                </span>\r\n                            </div>\r\n\r\n                            <h3 className=\"text-3xl font-black text-white tracking-tighter uppercase leading-none mb-1 drop-shadow-lg flex items-baseline gap-2\">\r\n                                {selectedPlacemark.extendedData?.['object_id'] || selectedPlacemark.extendedData?.['objectId'] || selectedPlacemark.extendedData?.['externalId'] || selectedPlacemark.name}\r\n                                <span className=\"text-primary/40 text-sm font-light\">/</span>\r\n                                <span className=\"text-primary text-[16px] tracking-widest italic leading-none\">\r\n                                    {selectedPlacemark.extendedData?.['type'] || selectedPlacemark.extendedData?.['elementType'] || 'ESTRUTURA'}\r\n                                </span>\r\n                            </h3>\r\n\r\n                            <div className=\"absolute top-2 -right-4 opacity-5 pointer-events-none\">\r\n                                <Navigation className=\"w-24 h-24 rotate-45\" />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"p-6 space-y-6\">\r\n                            <div className=\"flex gap-2\">\r\n                                <Button\r\n                                    onClick={openInGPS}\r\n                                    className=\"flex-1 bg-linear-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary text-white font-black text-[11px] uppercase tracking-widest gap-3 h-12 rounded-2xl shadow-glow transition-all active:scale-[0.98] group/btn\"\r\n                                >\r\n                                    <Navigation className=\"w-4 h-4 fill-white/20 group-hover/btn:translate-x-0.5 group-hover/btn:-translate-y-0.5 transition-transform\" />\r\n                                    Ir para Localização\r\n                                </Button>\r\n                                <Button\r\n                                    variant=\"outline\"\r\n                                    onClick={() => {\r\n                                        if (onHidePlacemark) {\r\n                                            const docId = document.id || document.name;\r\n                                            onHidePlacemark(docId, selectedPlacemark);\r\n                                            onSelectPlacemark?.(null);\r\n                                        }\r\n                                    }}\r\n                                    className=\"glass-card border-white/10 hover:bg-white/5 text-muted-foreground hover:text-white h-12 w-12 p-0 rounded-2xl transition-all active:scale-[0.98]\"\r\n                                    title=\"Ocultar do Mapa\"\r\n                                >\r\n                                    <X className=\"w-5 h-5\" />\r\n                                </Button>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                {(selectedPlacemark.extendedData?.object_height !== undefined || selectedPlacemark.extendedData?.objectHeight !== undefined || (selectedPlacemark.extendedData?.metadata as any)?.object_height !== undefined) && (\r\n                                    <div className=\"bg-white/5 rounded-2xl p-4 border border-white/10 shadow-inner group/spec\">\r\n                                        <div className=\"text-[8px] font-black uppercase tracking-[0.2em] text-muted-foreground mb-2 group-hover/spec:text-primary transition-colors\">ALTURA</div>\r\n                                        <div className=\"text-xl font-black tabular-nums text-white flex items-baseline gap-1\">\r\n                                            {selectedPlacemark.extendedData?.['object_height'] || selectedPlacemark.extendedData?.['objectHeight'] || (selectedPlacemark.extendedData?.metadata as any)?.object_height || '0.00'}\r\n                                            <span className=\"text-sm text-primary opacity-50\">m</span>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                                {selectedPlacemark.extendedData?.deflection && (\r\n                                    <div className=\"bg-white/5 rounded-2xl p-4 border border-white/10 shadow-inner group/spec\">\r\n                                        <div className=\"text-[8px] font-black uppercase tracking-[0.2em] text-muted-foreground mb-2 group-hover/spec:text-primary transition-colors\">ÂNGULO</div>\r\n                                        <div className=\"text-[13px] font-black tabular-nums text-white truncate\">\r\n                                            {selectedPlacemark.extendedData.deflection}\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            <div className=\"space-y-3\">\r\n                                <div className=\"flex items-center justify-between px-1\">\r\n                                    <span className=\"text-[9px] font-black uppercase tracking-[0.3em] text-muted-foreground/40\">POSICIONAMENTO UTM</span>\r\n                                    <div className=\"px-2 py-0.5 bg-primary/10 rounded-full border border-primary/20\">\r\n                                        <span className=\"text-[8px] font-black uppercase tracking-widest text-primary\">FUSO {selectedPlacemark.extendedData?.fuso_object || '--'}</span>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"bg-black/40 rounded-2xl p-4 border border-white/5 font-mono text-[11px] flex flex-col gap-2 shadow-inner ring-1 ring-white/5\">\r\n                                    <div className=\"flex justify-between items-center opacity-80 group/utm transition-colors hover:bg-white/5 p-1 rounded-lg\">\r\n                                        <span className=\"text-[10px] font-bold text-muted-foreground uppercase tracking-tighter group-hover/utm:text-white transition-colors\">FUSO:</span>\r\n                                        <span className=\"font-black tabular-nums tracking-wider text-white\">\r\n                                            {selectedPlacemark.extendedData?.fuso_object || '--'}\r\n                                        </span>\r\n\r\n                                    </div>\r\n                                    <div className=\"flex justify-between items-center opacity-80 group/utm transition-colors hover:bg-white/5 p-1 rounded-lg\">\r\n                                        <span className=\"text-[10px] font-bold text-muted-foreground uppercase tracking-tighter group-hover/utm:text-white transition-colors\">COORD X:</span>\r\n                                        <span className=\"font-black tabular-nums tracking-wider text-white\">\r\n                                            {selectedPlacemark.extendedData?.['x_cord_object'] || selectedPlacemark.coordinates.lat.toFixed(6)}\r\n                                        </span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between items-center opacity-80 group/utm transition-colors hover:bg-white/5 p-1 rounded-lg\">\r\n                                        <span className=\"text-[10px] font-bold text-muted-foreground uppercase tracking-tighter group-hover/utm:text-white transition-colors\">COORD Y:</span>\r\n                                        <span className=\"font-black tabular-nums tracking-wider text-white\">\r\n                                            {selectedPlacemark.extendedData?.['y_cord_object'] || selectedPlacemark.coordinates.lng.toFixed(6)}\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </Popup>\r\n            )}\r\n        </>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\map\\mapbox-map.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Source' is defined but never used.","line":2,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Layer' is defined but never used.","line":2,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useMap' is defined but never used.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'mapboxgl' is defined but never used.","line":12,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AlertDialogAction' is defined but never used.","line":17,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'db' is defined but never used.","line":26,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2519,2522],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2519,2522],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":148,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6449,6452],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6449,6452],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":163,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6844,6847],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6844,6847],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":165,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6952,6955],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6952,6955],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":169,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7182,7185],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7182,7185],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":218,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":218,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9234,9237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9234,9237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'url' is assigned a value but never used.","line":343,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":343,"endColumn":26}],"suppressedMessages":[],"errorCount":13,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useCallback, useRef, useMemo } from 'react';\r\nimport Map, { Marker, Popup, Source, Layer, NavigationControl, FullscreenControl } from 'react-map-gl/mapbox';\r\nimport type { MapLocation, MapConfig } from '@/types/map';\r\nimport type { KMLDocument, KMLPlacemark } from '@/types/kmz';\r\nimport { MapboxKMZLayer } from './mapbox-kmz-layer';\r\nimport { Mapbox3DLayer } from './mapbox-3d-layer';\r\nimport { MapboxCableInteraction } from './mapbox-cable-interaction';\r\nimport { CanvasCableLayer } from './canvas-cable-layer';\r\nimport { useEnrichedPlacemarks } from '@/hooks/useEnrichedPlacemarks';\r\nimport { useMap } from 'react-map-gl/mapbox';\r\nimport 'mapbox-gl/dist/mapbox-gl.css';\r\nimport mapboxgl from 'mapbox-gl';\r\nimport { Camera, Activity, HardHat, Truck, Share2, Download, Cable } from 'lucide-react';\r\nimport { CableConfigModal, CableSettings, DEFAULT_CABLE_SETTINGS, ModelTransform } from './cable-config-modal';\r\nimport {\r\n    AlertDialog,\r\n    AlertDialogAction,\r\n    AlertDialogCancel,\r\n    AlertDialogContent,\r\n    AlertDialogDescription,\r\n    AlertDialogFooter,\r\n    AlertDialogHeader,\r\n    AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { db } from '@/integrations/database';\r\n\r\n\r\nimport { Button } from '@/components/ui/button';\r\n\r\ninterface MapboxMapProps {\r\n    locations?: MapLocation[];\r\n    config?: Partial<MapConfig>;\r\n    onMarkerClick?: (location: MapLocation) => void;\r\n    kmlDocuments?: KMLDocument[];\r\n    isLoading?: boolean;\r\n    hiddenPlacemarkIds?: Set<string>;\r\n    placemarkOverrides?: Record<string, { name?: string, angle?: number, color?: string, height?: number, elevation?: number, customModelUrl?: string }>;\r\n    show3D?: boolean;\r\n    onHidePlacemark?: (docId: string, placemark: KMLPlacemark) => void;\r\n    onUpdatePlacemarkAngle?: (docId: string, elementId: string, newAngle: number) => void;\r\n    onUpdatePlacemarkColor?: (docId: string, elementId: string, newColor: string) => void;\r\n    onUpdatePlacemarkHeight?: (docId: string, elementId: string, newHeight: number) => void;\r\n    onUpdatePlacemarkElevation?: (docId: string, elementId: string, newElevation: number) => void;\r\n    onUpdatePlacemarkModel?: (docId: string, elementId: string, modelUrl: string) => void;\r\n    onUpdatePlacemarkTransform?: (docId: string, elementId: string, transform: ModelTransform) => void;\r\n    onUpdatePlacemarkTexture?: (docId: string, elementId: string, newTexture: string) => void;\r\n    projectSpans?: any[];\r\n    selectedProjectId?: string;\r\n    canUpdate?: boolean;\r\n    onSelectPlacemark?: (placemark: KMLPlacemark | null) => void;\r\n    cableSettings?: CableSettings;\r\n    onUpdateCableSettings?: (settings: CableSettings) => Promise<void>;\r\n}\r\n\r\nexport function MapboxMap({\r\n    locations = [],\r\n    config,\r\n    onMarkerClick,\r\n    kmlDocuments = [],\r\n    isLoading = false,\r\n    hiddenPlacemarkIds = new Set(),\r\n    placemarkOverrides = {},\r\n    show3D = false,\r\n    onHidePlacemark,\r\n    onUpdatePlacemarkAngle,\r\n    onUpdatePlacemarkColor,\r\n    onUpdatePlacemarkHeight,\r\n    onUpdatePlacemarkElevation,\r\n    onUpdatePlacemarkModel,\r\n    onUpdatePlacemarkTransform,\r\n    onUpdatePlacemarkTexture,\r\n    projectSpans = [],\r\n    selectedProjectId,\r\n    canUpdate = false,\r\n    onSelectPlacemark,\r\n    cableSettings: propCableSettings,\r\n    onUpdateCableSettings\r\n}: MapboxMapProps) {\r\n    const [selectedLocation, setSelectedLocation] = useState<MapLocation | null>(null);\r\n    const [selectedPlacemark, setSelectedPlacemark] = useState<KMLPlacemark | null>(null);\r\n    const enrichedPlacemarks = useEnrichedPlacemarks(kmlDocuments, placemarkOverrides, hiddenPlacemarkIds, selectedProjectId);\r\n    const [isMapReady, setIsMapReady] = useState(false);\r\n    const [screenshotData, setScreenshotData] = useState<{ url: string, blob: Blob } | null>(null);\r\n    const [showScreenshotDialog, setShowScreenshotDialog] = useState(false);\r\n    const [terrainElevation, setTerrainElevation] = useState<number | null>(null);\r\n    const { toast } = useToast();\r\n\r\n    // Cable Configuration State\r\n    const [isCableConfigOpen, setIsCableConfigOpen] = useState(false);\r\n\r\n    // Internal state for cable settings if not provided by prop (fallback)\r\n    const [internalCableSettings, setInternalCableSettings] = useState<CableSettings>(DEFAULT_CABLE_SETTINGS);\r\n    const cableSettings = useMemo(() => {\r\n        const base = propCableSettings || internalCableSettings;\r\n        return {\r\n            ...DEFAULT_CABLE_SETTINGS,\r\n            ...base,\r\n            anchors: base?.anchors?.length ? base.anchors : DEFAULT_CABLE_SETTINGS.anchors\r\n        };\r\n    }, [propCableSettings, internalCableSettings]);\r\n\r\n    const handleSaveCableSettings = async (settings: CableSettings) => {\r\n        if (onUpdateCableSettings) {\r\n            await onUpdateCableSettings(settings);\r\n        } else {\r\n            setInternalCableSettings(settings);\r\n        }\r\n    };\r\n\r\n    // Vite picks from .env.local first (if exists), then .env\r\n    // Use a single variable name: VITE_MAPEBOX_API_KEY in both files\r\n    const mapboxToken = import.meta.env.VITE_MAPEBOX_API_KEY;\r\n\r\n    const defaultConfig: MapConfig = {\r\n        center: { lat: -23.5505, lng: -46.6333 }, // São Paulo\r\n        zoom: 12,\r\n        mapTypeId: 'satellite',\r\n        ...config\r\n    };\r\n\r\n    // Convert mapTypeId to Mapbox style\r\n    const getMapStyle = (mapTypeId: string): string | import('mapbox-gl').Style => {\r\n        switch (mapTypeId) {\r\n            case 'satellite':\r\n            case 'hybrid':\r\n                return 'mapbox://styles/mapbox/satellite-streets-v12';\r\n            case 'terrain':\r\n                return 'mapbox://styles/mapbox/outdoors-v12';\r\n            case 'none':\r\n                return {\r\n                    version: 8,\r\n                    sources: {\r\n                        'mapbox-dem': {\r\n                            type: 'raster-dem',\r\n                            url: 'mapbox://mapbox.mapbox-terrain-dem-v1',\r\n                            tileSize: 512,\r\n                            maxzoom: 14\r\n                        }\r\n                    },\r\n                    layers: [\r\n                        {\r\n                            id: 'background',\r\n                            type: 'background',\r\n                            paint: { 'background-color': '#09090b' }\r\n                        }\r\n                    ]\r\n                } as any;\r\n            case 'roadmap':\r\n            default:\r\n                return 'mapbox://styles/mapbox/dark-v11';\r\n        }\r\n    };\r\n\r\n    const [viewState, setViewState] = useState({\r\n        longitude: defaultConfig.center.lng,\r\n        latitude: defaultConfig.center.lat,\r\n        zoom: defaultConfig.zoom,\r\n        bearing: 0,\r\n        pitch: 0\r\n    });\r\n\r\n    const mapRef = React.useRef<any>(null);\r\n    const lastBoundsRef = React.useRef<string>(\"\");\r\n    const pendingFlightRef = React.useRef<any>(null);\r\n    const hasFlownRef = React.useRef<string>(\"\"); // Track which config we've already flown to\r\n\r\n    // Handle map load - execute any pending flights and configure 3D terrain\r\n    const onMapLoad = useCallback((evt: any) => {\r\n        setIsMapReady(true);\r\n        const map = evt.target;\r\n\r\n        if (map) {\r\n            // Add Terrain and 3D Lights for better GLTF rendering\r\n            if (!map.getSource('mapbox-dem')) {\r\n                map.addSource('mapbox-dem', {\r\n                    'type': 'raster-dem',\r\n                    'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',\r\n                    'tileSize': 512,\r\n                    'maxzoom': 14\r\n                });\r\n            }\r\n            //map.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 1.0 });\r\n            map.setTerrain({ source: 'mapbox-dem', exaggeration: 1.0 });\r\n\r\n            // Add Fog for realistic horizon and occlusion of distant objects\r\n            map.setFog({\r\n                'range': [0.5, 10],\r\n                'color': '#1a1c24',\r\n                'high-color': '#242b3b',\r\n                'space-color': '#000000',\r\n                'horizon-blend': 0.1\r\n            });\r\n\r\n            // PREVENTIVE FIX: Explicitly add common missing icons to stop errors immediately\r\n            const addPlaceholder = (id: string) => {\r\n                if (map.hasImage(id)) return;\r\n                const width = 64;\r\n                const height = 64;\r\n                const img = new ImageData(width, height);\r\n                const data = img.data;\r\n                // Generate a transparent or grey placeholder\r\n                for (let i = 0; i < data.length; i += 4) {\r\n                    data[i] = 128;     // R\r\n                    data[i + 1] = 128; // G\r\n                    data[i + 2] = 128; // B\r\n                    data[i + 3] = 128; // Alpha (Semi-transparent)\r\n                }\r\n                map.addImage(id, img);\r\n                console.log(`🛡️ [Mapbox] Preventively added placeholder for '${id}'`);\r\n            };\r\n\r\n            // Fix specific known errors\r\n            addPlaceholder('br-state-4');\r\n            addPlaceholder('icon-default');\r\n\r\n            // Handle any other missing images dynamically\r\n            map.on('styleimagemissing', (e: any) => {\r\n                const id = e.id;\r\n                // Check again to prevent race conditions\r\n                if (!map.hasImage(id)) {\r\n                    console.warn(`⚠️ [Mapbox] Missing image '${id}' detected. Auto-generating placeholder.`);\r\n                    addPlaceholder(id);\r\n                }\r\n            });\r\n\r\n            if (pendingFlightRef.current) {\r\n                const { type, data } = pendingFlightRef.current;\r\n                if (type === 'bounds') {\r\n                    map.fitBounds(data.bounds, data.options);\r\n                } else if (type === 'flyTo') {\r\n                    map.flyTo(data);\r\n                }\r\n                pendingFlightRef.current = null;\r\n            }\r\n        }\r\n    }, []);\r\n\r\n    // Update viewState if config changes (e.g. from parent)\r\n    // RULE: Only fly when NOT loading and map is ready\r\n    React.useEffect(() => {\r\n        // Don't fly if still loading KMZ data\r\n        if (isLoading) return;\r\n\r\n        const configKey = JSON.stringify(config);\r\n\r\n        // Prevent duplicate flights to same destination\r\n        if (hasFlownRef.current === configKey) return;\r\n\r\n        if (config?.bounds) {\r\n            const flightData = {\r\n                type: 'bounds' as const,\r\n                data: {\r\n                    bounds: config.bounds,\r\n                    options: {\r\n                        padding: { top: 120, bottom: 120, left: 120, right: 120 },\r\n                        duration: 3000,\r\n                        essential: true,\r\n                        maxZoom: 18\r\n                    }\r\n                }\r\n            };\r\n\r\n            if (isMapReady && mapRef.current) {\r\n                hasFlownRef.current = configKey;\r\n                lastBoundsRef.current = JSON.stringify(config.bounds);\r\n                mapRef.current.fitBounds(config.bounds, flightData.data.options);\r\n            } else {\r\n                pendingFlightRef.current = flightData;\r\n            }\r\n            return;\r\n        }\r\n\r\n        // For center-based navigation, use flyTo for smooth animation from current position\r\n        if (config?.center) {\r\n            const flightData = {\r\n                type: 'flyTo' as const,\r\n                data: {\r\n                    center: [config.center.lng, config.center.lat],\r\n                    zoom: config.zoom ?? 15,\r\n                    duration: 2500,\r\n                    essential: true\r\n                }\r\n            };\r\n\r\n            if (isMapReady && mapRef.current) {\r\n                hasFlownRef.current = configKey;\r\n                lastBoundsRef.current = \"\";\r\n                mapRef.current.flyTo(flightData.data);\r\n            } else {\r\n                pendingFlightRef.current = flightData;\r\n            }\r\n        }\r\n    }, [config, isLoading, isMapReady]);\r\n\r\n    const [cursor, setCursor] = useState<string>('auto');\r\n\r\n    const onMouseEnter = useCallback(() => setCursor('pointer'), []);\r\n    const onMouseLeave = useCallback(() => setCursor('auto'), []);\r\n\r\n    const interactiveLayerIds = useMemo(() => {\r\n        const base = ['kmz-points', 'kmz-lines', 'kmz-polygons-fill'];\r\n        if (!show3D) base.push('cable-interaction-layer');\r\n        return base;\r\n    }, [show3D]);\r\n\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n    if (!mapboxToken) {\r\n        return (\r\n            <div className=\"flex items-center justify-center p-8 bg-destructive/10 border border-destructive/20 rounded-xl text-destructive font-bold h-full\">\r\n                Erro: API Key do Mapbox não configurada (VITE_MAPEBOX_API_KEY)\r\n            </div>\r\n        );\r\n    }\r\n\r\n\r\n\r\n    // Screenshot function using Mapbox native canvas\r\n    const handleMapScreenshot = async () => {\r\n        if (!mapRef.current) return;\r\n\r\n        try {\r\n            const mapCanvas = mapRef.current.getCanvas();\r\n            const imageUrl = mapCanvas.toDataURL('image/png');\r\n            const blob = await (await fetch(imageUrl)).blob();\r\n\r\n            setScreenshotData({ url: imageUrl, blob });\r\n            setShowScreenshotDialog(true);\r\n        } catch (error) {\r\n            console.error('Erro ao capturar mapa:', error);\r\n            toast({\r\n                title: \"Erro na captura\",\r\n                description: \"Não foi possível capturar o mapa no momento.\",\r\n                variant: \"destructive\"\r\n            });\r\n        }\r\n    };\r\n\r\n    const handleShare = async () => {\r\n        if (!screenshotData) return;\r\n\r\n        const { blob, url } = screenshotData;\r\n        const file = new File([blob], `mapa-${Date.now()}.png`, { type: 'image/png' });\r\n\r\n        if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {\r\n            try {\r\n                await navigator.share({\r\n                    title: 'Captura do Mapa',\r\n                    text: 'Visualização do projeto',\r\n                    files: [file]\r\n                });\r\n                setShowScreenshotDialog(false);\r\n            } catch (e) {\r\n                if ((e as Error).name !== 'AbortError') {\r\n                    handleDownload();\r\n                }\r\n            }\r\n        } else {\r\n            handleDownload();\r\n        }\r\n    };\r\n\r\n    const handleDownload = () => {\r\n        if (!screenshotData) return;\r\n        const link = document.createElement('a');\r\n        link.download = `mapa-${Date.now()}.png`;\r\n        link.href = screenshotData.url;\r\n        link.click();\r\n        setShowScreenshotDialog(false);\r\n        toast({\r\n            title: \"Download iniciado\",\r\n            description: \"O mapa foi salvo em seu dispositivo.\"\r\n        });\r\n    };\r\n\r\n\r\n\r\n    return (\r\n        <>\r\n            <div ref={containerRef} className=\"w-full h-full rounded-2xl overflow-hidden shadow-2xl border border-white/5 relative group/map\">\r\n                <Map\r\n                    ref={mapRef}\r\n                    {...viewState}\r\n                    onMove={evt => {\r\n                        setViewState(evt.viewState);\r\n                        const map = mapRef.current?.getMap();\r\n                        if (map) {\r\n                            const elevation = map.queryTerrainElevation({\r\n                                lng: evt.viewState.longitude,\r\n                                lat: evt.viewState.latitude\r\n                            });\r\n                            setTerrainElevation(elevation);\r\n                        }\r\n                    }}\r\n                    onLoad={onMapLoad}\r\n                    mapboxAccessToken={mapboxToken}\r\n                    style={{ width: '100%', height: '100%', minHeight: '500px' }}\r\n                    mapStyle={getMapStyle(defaultConfig.mapTypeId || 'satellite')}\r\n                    attributionControl={false}\r\n                    interactiveLayerIds={interactiveLayerIds}\r\n                    cursor={cursor}\r\n                    onMouseEnter={onMouseEnter}\r\n                    onMouseLeave={onMouseLeave}\r\n                    preserveDrawingBuffer={true}\r\n                    onClick={(evt) => {\r\n                        const feature = evt.features?.[0];\r\n                        if (feature && feature.layer && feature.layer.id === 'cable-interaction-layer') {\r\n                            const spanData = feature.properties;\r\n                            if (!spanData) return;\r\n                            const virtualPlacemark: KMLPlacemark = {\r\n                                id: spanData.id,\r\n                                name: `Vão ${spanData.tower_start_id} - ${spanData.tower_end_id}`,\r\n                                type: 'linestring',\r\n                                coordinates: { lng: evt.lngLat.lng, lat: evt.lngLat.lat, altitude: 0 },\r\n                                extendedData: {\r\n                                    ...spanData,\r\n                                    source: '3d_cable_virtual_layer',\r\n                                    type: spanData.cable_type || 'Cabo de Transmissão'\r\n                                }\r\n                            };\r\n                            setSelectedPlacemark(virtualPlacemark);\r\n                            onSelectPlacemark?.(virtualPlacemark);\r\n                        }\r\n                    }}\r\n                >\r\n                    {/* Zoom Level Indicator + Screenshot Button */}\r\n                    <div className=\"absolute top-4 left-1/2 -translate-x-1/2 z-10 glass-card px-4 py-1.5 rounded-full border-white/10 flex items-center gap-3 shadow-xl backdrop-blur-md transition-all group-hover/map:scale-105\">\r\n                        <div className=\"flex items-center gap-1.5 border-r border-white/10 pr-3\">\r\n                            <span className=\"text-[8px] font-black uppercase tracking-widest opacity-40\">Magnificação</span>\r\n                            <span className=\"text-xs font-black tabular-nums text-primary\">{viewState.zoom.toFixed(1)}x</span>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-1.5 border-r border-white/10 pr-3 group/elevation\">\r\n                            <span className=\"text-[8px] font-black uppercase tracking-widest text-primary/60 px-1.5 py-0.5 rounded-sm bg-primary/10 border border-primary/20\">ELEVAÇÃO</span>\r\n                            <span className=\"text-xs font-black tabular-nums text-foreground group-hover/elevation:text-primary transition-colors\">\r\n                                {terrainElevation !== null\r\n                                    ? `${Math.round(terrainElevation).toLocaleString()}m`\r\n                                    : `${Math.round(Math.pow(2, 20 - viewState.zoom) * 10).toLocaleString()}m`\r\n                                }\r\n                            </span>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-1.5 border-r border-white/10 pr-3\">\r\n                            <span className=\"text-[8px] font-black uppercase tracking-widest opacity-40\">Ângulo</span>\r\n                            <span className=\"text-xs font-black tabular-nums text-emerald-500\">\r\n                                {(() => {\r\n                                    const bearing = (viewState.bearing + 360) % 360;\r\n                                    const degrees = Math.floor(bearing);\r\n                                    const minutesDecimal = (bearing - degrees) * 60;\r\n                                    const minutes = Math.floor(minutesDecimal);\r\n                                    const seconds = Math.floor((minutesDecimal - minutes) * 60);\r\n\r\n                                    let direction = 'N';\r\n                                    if (bearing >= 22.5 && bearing < 67.5) direction = 'NE';\r\n                                    else if (bearing >= 67.5 && bearing < 112.5) direction = 'E';\r\n                                    else if (bearing >= 112.5 && bearing < 157.5) direction = 'SE';\r\n                                    else if (bearing >= 157.5 && bearing < 202.5) direction = 'S';\r\n                                    else if (bearing >= 202.5 && bearing < 247.5) direction = 'SW';\r\n                                    else if (bearing >= 247.5 && bearing < 292.5) direction = 'W';\r\n                                    else if (bearing >= 292.5 && bearing < 337.5) direction = 'NW';\r\n\r\n                                    return `${degrees}°${minutes}'${seconds}''${direction}`;\r\n                                })()}\r\n                            </span>\r\n                        </div>\r\n                        <button\r\n                            onClick={handleMapScreenshot}\r\n                            className=\"flex items-center gap-1.5 text-white/70 hover:text-white transition-colors\"\r\n                            title=\"Capturar Mapa\"\r\n                        >\r\n                            <Camera className=\"w-4 h-4\" />\r\n                        </button>\r\n                    </div>\r\n\r\n\r\n                    {/* Left-side indicators (visible in fullscreen) */}\r\n                    <div className=\"absolute top-4 left-4 z-10 flex gap-2\">\r\n                        <div className=\"glass-card px-3 py-1.5 rounded-full border-white/10 flex items-center gap-2 shadow-xl backdrop-blur-md\">\r\n                            <Activity className=\"w-3.5 h-3.5 text-emerald-500\" />\r\n                            <span className=\"text-[10px] font-bold uppercase tracking-wider\">Ativo</span>\r\n                        </div>\r\n                        <div className=\"glass-card px-3 py-1.5 rounded-full border-white/10 flex items-center gap-2 shadow-xl backdrop-blur-md\">\r\n                            <HardHat className=\"w-3.5 h-3.5 text-amber-500\" />\r\n                            <span className=\"text-xs font-black tabular-nums\">124</span>\r\n                        </div>\r\n                        <div className=\"glass-card px-3 py-1.5 rounded-full border-white/10 flex items-center gap-2 shadow-xl backdrop-blur-md\">\r\n                            <Truck className=\"w-3.5 h-3.5 text-primary\" />\r\n                            <span className=\"text-xs font-black tabular-nums\">08</span>\r\n                        </div>\r\n                        {/* Cable Config Button */}\r\n                        {canUpdate && (\r\n                            <button\r\n                                onClick={() => setIsCableConfigOpen(true)}\r\n                                className=\"glass-card px-3 py-1.5 rounded-full border-cyan-500/30 flex items-center gap-2 shadow-xl backdrop-blur-md hover:bg-cyan-500/20 transition-all cursor-pointer\"\r\n                                title=\"Configurar Cabos 3D\"\r\n                            >\r\n                                <Cable className=\"w-3.5 h-3.5 text-cyan-400\" />\r\n                                <span className=\"text-[10px] font-bold uppercase tracking-wider text-cyan-400\">Cabos 3D</span>\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n\r\n                    <NavigationControl position=\"bottom-right\" />\r\n                    <FullscreenControl position=\"bottom-right\" />\r\n\r\n                    {locations.map((location) => (\r\n                        <Marker\r\n                            key={location.id}\r\n                            longitude={location.lng}\r\n                            latitude={location.lat}\r\n                            anchor=\"bottom\"\r\n                            draggable={false}\r\n                            onClick={(e) => {\r\n                                e.originalEvent.stopPropagation();\r\n                                setSelectedLocation(location);\r\n                                onMarkerClick?.(location);\r\n                            }}\r\n                        >\r\n                            <div className=\"relative group/marker cursor-pointer\" style={{ pointerEvents: 'none' }}>\r\n                                <div className=\"absolute -inset-2 bg-primary/20 rounded-full blur-sm group-hover/marker:bg-primary/40 transition-all\" />\r\n                                <div className=\"w-6 h-6 bg-linear-to-br from-primary to-primary-foreground rounded-full border-2 border-white shadow-[0_0_15px_rgba(var(--primary),0.5)] transition-transform hover:scale-110 relative z-10 flex items-center justify-center\">\r\n                                    <div className=\"w-2 h-2 bg-white rounded-full shadow-inner\" />\r\n                                </div>\r\n                            </div>\r\n                        </Marker>\r\n                    ))}\r\n\r\n                    {selectedLocation && (\r\n                        <Popup\r\n                            longitude={selectedLocation.lng}\r\n                            latitude={selectedLocation.lat}\r\n                            anchor=\"bottom\"\r\n                            onClose={() => setSelectedLocation(null)}\r\n                            closeOnClick={false}\r\n                            className=\"mapbox-popup-industrial\"\r\n                        >\r\n                            <div className=\"p-4 min-w-[180px] bg-card/95 backdrop-blur-md\">\r\n                                <h3 className=\"font-bold text-sm mb-1 text-primary\">{selectedLocation.title}</h3>\r\n                                {selectedLocation.description && (\r\n                                    <p className=\"text-xs text-muted-foreground leading-relaxed\">\r\n                                        {selectedLocation.description}\r\n                                    </p>\r\n                                )}\r\n                            </div>\r\n                        </Popup>\r\n                    )}\r\n\r\n                    {kmlDocuments.map((doc, idx) => (\r\n                        <MapboxKMZLayer\r\n                            key={`kmz-layer-${doc.id || doc.name}-${idx}`}\r\n                            document={doc}\r\n                            hiddenPlacemarkIds={hiddenPlacemarkIds}\r\n                            placemarkOverrides={placemarkOverrides}\r\n                            show3D={show3D}\r\n                            selectedPlacemark={selectedPlacemark}\r\n                            onSelectPlacemark={(p) => {\r\n                                setSelectedPlacemark(p);\r\n                                onSelectPlacemark?.(p);\r\n                            }}\r\n                            onHidePlacemark={onHidePlacemark}\r\n                            selectedProjectId={selectedProjectId}\r\n                        />\r\n                    ))}\r\n\r\n\r\n                    {!show3D && (\r\n                        <>\r\n                            <CanvasCableLayer\r\n                                projectSpans={projectSpans}\r\n                                visibleTowers={enrichedPlacemarks}\r\n                                hiddenPlacemarkIds={hiddenPlacemarkIds}\r\n                                projectId={selectedProjectId}\r\n                            />\r\n\r\n                            <MapboxCableInteraction\r\n                                projectSpans={projectSpans}\r\n                                visibleTowers={enrichedPlacemarks}\r\n                                hiddenPlacemarkIds={hiddenPlacemarkIds}\r\n                                projectId={selectedProjectId}\r\n                                onSelectSpan={onSelectPlacemark}\r\n                            />\r\n                        </>\r\n                    )}\r\n\r\n                    {/* The 3D/Volumetric cables are handled inside Mapbox3DLayer */}\r\n\r\n                    <Mapbox3DLayer\r\n                        kmlDocuments={kmlDocuments}\r\n                        show3D={show3D}\r\n                        selectedPlacemark={selectedPlacemark}\r\n                        onSelectPlacemark={(p) => {\r\n                            setSelectedPlacemark(p);\r\n                            onSelectPlacemark?.(p);\r\n                        }}\r\n                        onHidePlacemark={onHidePlacemark}\r\n                        onUpdatePlacemarkAngle={onUpdatePlacemarkAngle}\r\n                        onUpdatePlacemarkColor={onUpdatePlacemarkColor}\r\n                        onUpdatePlacemarkHeight={onUpdatePlacemarkHeight}\r\n                        onUpdatePlacemarkElevation={onUpdatePlacemarkElevation}\r\n                        onUpdatePlacemarkModel={onUpdatePlacemarkModel}\r\n                        onUpdatePlacemarkTransform={onUpdatePlacemarkTransform}\r\n                        onUpdatePlacemarkTexture={onUpdatePlacemarkTexture}\r\n                        canUpdate={canUpdate}\r\n                        hiddenPlacemarkIds={hiddenPlacemarkIds}\r\n                        placemarkOverrides={placemarkOverrides}\r\n                        projectSpans={projectSpans}\r\n                        projectId={selectedProjectId}\r\n                        cableSettings={cableSettings}\r\n                        onUpdateCableSettings={handleSaveCableSettings}\r\n                    />\r\n                </Map>\r\n            </div>\r\n\r\n            <AlertDialog open={showScreenshotDialog} onOpenChange={setShowScreenshotDialog}>\r\n                <AlertDialogContent className=\"glass-card border-white/10 max-w-sm\">\r\n                    <AlertDialogHeader>\r\n                        <AlertDialogTitle className=\"flex items-center gap-2\">\r\n                            <Camera className=\"w-5 h-5 text-primary\" />\r\n                            Captura Realizada\r\n                        </AlertDialogTitle>\r\n                        <AlertDialogDescription className=\"text-white/70\">\r\n                            A imagem do mapa foi processada com sucesso.\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n\r\n                    {screenshotData && (\r\n                        <div className=\"my-4 rounded-lg overflow-hidden border border-white/5 aspect-video bg-black/40\">\r\n                            <img src={screenshotData.url} alt=\"Captura\" className=\"w-full h-full object-cover\" />\r\n                        </div>\r\n                    )}\r\n\r\n                    <AlertDialogFooter className=\"flex flex-row justify-center items-center gap-2 mt-6 px-2 sm:justify-center\">\r\n                        <AlertDialogCancel className=\"bg-white/5 border-white/10 hover:bg-white/10 h-8 text-[10px] uppercase font-bold tracking-wider px-4 mt-0 sm:mt-0\">\r\n                            Fechar\r\n                        </AlertDialogCancel>\r\n                        <Button\r\n                            variant=\"outline\"\r\n                            className=\"border-primary/30 hover:bg-primary/5 text-primary gap-1.5 h-8 text-[10px] uppercase font-bold tracking-wider px-4\"\r\n                            onClick={handleDownload}\r\n                        >\r\n                            <Download className=\"w-3.5 h-3.5\" />\r\n                            Salvar\r\n                        </Button>\r\n                        <Button\r\n                            className=\"gradient-primary gap-1.5 h-8 text-[10px] uppercase font-bold tracking-wider px-4\"\r\n                            onClick={handleShare}\r\n                        >\r\n                            <Share2 className=\"w-3.5 h-3.5\" />\r\n                            Enviar\r\n                        </Button>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n\r\n            {/* Cable Configuration Modal */}\r\n            <CableConfigModal\r\n                isOpen={isCableConfigOpen}\r\n                onClose={() => setIsCableConfigOpen(false)}\r\n                settings={cableSettings}\r\n                onSave={handleSaveCableSettings}\r\n            />\r\n        </>\r\n    );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\map\\model-3d-manager.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Check' is defined but never used.","line":4,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'db' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1372,1375],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1372,1375],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":56,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":56,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2651,2654],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2651,2654],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":123,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4853,4856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4853,4856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":161,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6468,6471],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6468,6471],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":187,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7668,7671],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7668,7671],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useRef, useEffect, useCallback } from 'react';\r\nimport { Card, CardContent } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Box, Upload, Loader2, Trash2, Check, RefreshCw, Pencil, Save, RotateCcw, Move, Maximize, Ruler, Settings2 } from 'lucide-react';\r\nimport { db } from '@/integrations/database';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { CableSettings, ModelTransform } from './cable-config-modal';\r\nimport { cn } from '@/lib/utils';\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogDescription,\r\n    DialogFooter,\r\n    DialogHeader,\r\n    DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Slider } from '@/components/ui/slider';\r\n\r\ninterface Model3DManagerProps {\r\n    projectId: string;\r\n    cableSettings: CableSettings;\r\n    onUpdateSettings: (settings: CableSettings) => Promise<void>;\r\n}\r\n\r\nconst DEFAULT_TRANSFORM: ModelTransform = {\r\n    displayName: '',\r\n    scale: [1, 1, 1],\r\n    rotation: [0, 0, 0],\r\n    offset: [0, 0, 0],\r\n    baseHeight: 1\r\n};\r\n\r\nexport function Model3DManager({ projectId, cableSettings, onUpdateSettings }: Model3DManagerProps) {\r\n    const [uploading, setUploading] = useState(false);\r\n    const [existingModels, setExistingModels] = useState<any[]>([]);\r\n    const [loadingModels, setLoadingModels] = useState(false);\r\n    const [editingModel, setEditingModel] = useState<{ url: string; name: string } | null>(null);\r\n    const [tempTransform, setTempTransform] = useState<ModelTransform>(DEFAULT_TRANSFORM);\r\n\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n    const { toast } = useToast();\r\n\r\n    const fetchExistingModels = useCallback(async () => {\r\n        if (!projectId || projectId === 'all') return;\r\n        setLoadingModels(true);\r\n        try {\r\n            const API_URL = (import.meta.env.VITE_API_URL || '').replace(/\\/api\\/v1$/, '');\r\n            const response = await fetch(`${API_URL}/api/v1/storage/3d-models/list?path=models/${projectId}`);\r\n            const textResponse = await response.text();\r\n\r\n            let result;\r\n            try {\r\n                result = JSON.parse(textResponse);\r\n            } catch (e) {\r\n                console.error('❌ [Model3DManager] Server returned non-JSON response:', textResponse.substring(0, 100));\r\n                throw new Error('Servidor retornou uma resposta inválida (não-JSON).');\r\n            }\r\n\r\n            if (result.error) throw new Error(result.error);\r\n            setExistingModels(result.data || []);\r\n        } catch (error: any) {\r\n            console.error('❌ [Model3DManager] Error fetching models from API:', error);\r\n            // Fallback para lista vazia em caso de erro na API\r\n            setExistingModels([]);\r\n        } finally {\r\n            setLoadingModels(false);\r\n        }\r\n    }, [projectId]);\r\n\r\n    useEffect(() => {\r\n        fetchExistingModels();\r\n    }, [fetchExistingModels]);\r\n\r\n    const handleUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file || !projectId || projectId === 'all') return;\r\n\r\n        const ext = file.name.split('.').pop()?.toLowerCase();\r\n        if (ext !== 'glb' && ext !== 'gltf') {\r\n            toast({\r\n                title: \"Formato Inválido\",\r\n                description: \"Por favor, selecione um arquivo .glb ou .gltf\",\r\n                variant: \"destructive\"\r\n            });\r\n            return;\r\n        }\r\n\r\n        setUploading(true);\r\n        try {\r\n            const sanitizedName = file.name.replace(/[^a-zA-Z0-9._-]/g, \"_\");\r\n            const fileName = `${Date.now()}_${sanitizedName}`;\r\n            const filePath = `models/${projectId}/${fileName}`;\r\n\r\n            const API_URL = (import.meta.env.VITE_API_URL || '').replace(/\\/api\\/v1$/, '');\r\n            const formData = new FormData();\r\n            formData.append('file', file);\r\n            formData.append('path', filePath);\r\n\r\n            const response = await fetch(`${API_URL}/api/v1/storage/3d-models/upload`, {\r\n                method: 'POST',\r\n                body: formData\r\n            });\r\n\r\n            const result = await response.json();\r\n            if (!response.ok || result.error) throw new Error(result.error || 'Erro no upload');\r\n\r\n            const publicUrl = result.data.publicUrl;\r\n\r\n            const updatedSettings = {\r\n                ...cableSettings,\r\n                customModelUrl: publicUrl\r\n            };\r\n\r\n            await onUpdateSettings(updatedSettings);\r\n\r\n            toast({\r\n                title: \"Modelo 3D Atualizado\",\r\n                description: \"O novo modelo foi carregado e aplicado ao mapa.\",\r\n            });\r\n            fetchExistingModels();\r\n        } catch (error: any) {\r\n            console.error('❌ [Model3DManager] Error uploading 3D model:', error);\r\n            toast({\r\n                title: \"Erro no Upload\",\r\n                description: error.message,\r\n                variant: \"destructive\"\r\n            });\r\n        } finally {\r\n            setUploading(false);\r\n            if (fileInputRef.current) fileInputRef.current.value = '';\r\n        }\r\n    };\r\n\r\n    const handleSelectModel = async (modelKey: string) => {\r\n        if (modelKey === 'default') {\r\n            await onUpdateSettings({ ...cableSettings, customModelUrl: undefined });\r\n            toast({ title: \"Modelo Padrão\", description: \"O mapa agora utiliza a torre industrial padrão.\" });\r\n            return;\r\n        }\r\n\r\n        if (modelKey === 'PORTICO-001') {\r\n            const url = `${window.location.origin}/models/PORTICO-001/scene.gltf`;\r\n            await onUpdateSettings({ ...cableSettings, customModelUrl: url });\r\n            toast({ title: \"Modelo Selecionado\", description: \"O Pórtico 001 foi aplicado.\" });\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const API_URL = (import.meta.env.VITE_API_URL || '').replace(/\\/api\\/v1$/, '');\r\n            const publicUrl = `${API_URL}/api/v1/storage/3d-models/get?path=models/${projectId}/${modelKey}`;\r\n\r\n            const updatedSettings = {\r\n                ...cableSettings,\r\n                customModelUrl: publicUrl\r\n            };\r\n\r\n            await onUpdateSettings(updatedSettings);\r\n            toast({ title: \"Modelo Alterado\", description: \"O Digital Twin selecionado foi aplicado.\" });\r\n        } catch (error: any) {\r\n            toast({ title: \"Erro\", description: error.message, variant: \"destructive\" });\r\n        }\r\n    };\r\n\r\n    const handleRemoveFile = async (modelName: string, e: React.MouseEvent) => {\r\n        e.stopPropagation();\r\n        if (!window.confirm(\"Deseja excluir este arquivo permanentemente?\")) return;\r\n\r\n        try {\r\n            const API_URL = (import.meta.env.VITE_API_URL || '').replace(/\\/api\\/v1$/, '');\r\n            const response = await fetch(`${API_URL}/api/v1/storage/3d-models/remove`, {\r\n                method: 'DELETE',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ path: `models/${projectId}/${modelName}` })\r\n            });\r\n\r\n            const result = await response.json();\r\n            if (!response.ok || result.error) throw new Error(result.error || 'Erro ao remover');\r\n\r\n            if (cableSettings.customModelUrl?.includes(modelName)) {\r\n                await onUpdateSettings({ ...cableSettings, customModelUrl: undefined });\r\n            }\r\n\r\n            fetchExistingModels();\r\n            toast({ title: \"Excluído\", description: \"Arquivo removido com sucesso.\" });\r\n        } catch (error: any) {\r\n            toast({ title: \"Erro ao excluir\", description: error.message, variant: \"destructive\" });\r\n        }\r\n    };\r\n\r\n    const openEditModel = (modelName: string, url: string, e: React.MouseEvent) => {\r\n        e.stopPropagation();\r\n        const currentCfg = cableSettings.modelConfigs?.[url] || { ...DEFAULT_TRANSFORM };\r\n        setTempTransform(currentCfg);\r\n        setEditingModel({ url, name: modelName });\r\n    };\r\n\r\n    const handleSaveTransform = async () => {\r\n        if (!editingModel) return;\r\n\r\n        const newConfigs = {\r\n            ...(cableSettings.modelConfigs || {}),\r\n            [editingModel.url]: tempTransform\r\n        };\r\n\r\n        const updatedSettings = {\r\n            ...cableSettings,\r\n            modelConfigs: newConfigs\r\n        };\r\n\r\n        await onUpdateSettings(updatedSettings);\r\n        setEditingModel(null);\r\n        toast({\r\n            title: \"Propriedades Salvas\",\r\n            description: `Configurações do modelo \"${tempTransform.displayName || editingModel.name}\" atualizadas.`,\r\n        });\r\n    };\r\n\r\n    const hasCustomModel = !!cableSettings.customModelUrl;\r\n\r\n    return (\r\n        <Card className=\"glass-card border-amber-500/30 bg-amber-500/5 animate-in slide-in-from-left duration-500 overflow-hidden relative mt-4\">\r\n            <div className=\"absolute top-0 right-0 p-3 opacity-5\">\r\n                <Box className=\"w-7 h-7\" />\r\n            </div>\r\n            <CardContent className=\"p-5 space-y-4\">\r\n                <div className=\"flex items-center gap-2 text-amber-500\">\r\n                    <Box className=\"w-4 h-4\" />\r\n                    <h3 className=\"text-[10px] font-black uppercase tracking-[0.2em]\">Gestor de Modelos 3D</h3>\r\n                </div>\r\n\r\n                <div className=\"bg-black/20 p-4 rounded-xl border border-white/5 space-y-3\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[9px] font-black text-muted-foreground uppercase tracking-widest\">Digital Twin Ativo</span>\r\n                            <span className={cn(\r\n                                \"text-xs font-black uppercase mt-0.5\",\r\n                                hasCustomModel ? \"text-amber-400\" : \"text-emerald-500\"\r\n                            )}>\r\n                                {hasCustomModel ? \"Personalizado\" : \"Padrão Industrial\"}\r\n                            </span>\r\n                        </div>\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            onClick={fetchExistingModels}\r\n                            className=\"h-7 w-7 p-0 hover:bg-white/5\"\r\n                        >\r\n                            <RefreshCw className={cn(\"w-3 h-3\", loadingModels && \"animate-spin\")} />\r\n                        </Button>\r\n                    </div>\r\n\r\n                    <div className=\"flex flex-col gap-2\">\r\n                        <input\r\n                            type=\"file\"\r\n                            ref={fileInputRef}\r\n                            onChange={handleUpload}\r\n                            accept=\".glb,.gltf\"\r\n                            className=\"hidden\"\r\n                        />\r\n                        <div className=\"grid grid-cols-2 gap-2\">\r\n                            <Button\r\n                                onClick={() => fileInputRef.current?.click()}\r\n                                disabled={uploading || !projectId || projectId === 'all'}\r\n                                className=\"h-9 bg-amber-500 hover:bg-amber-600 text-black font-black text-[9px] uppercase tracking-widest transition-all gap-2 shadow-lg shadow-amber-500/10\"\r\n                            >\r\n                                {uploading ? <Loader2 className=\"w-3 h-3 animate-spin\" /> : <Upload className=\"w-3 h-3\" />}\r\n                                Novo Upload\r\n                            </Button>\r\n                            <Button\r\n                                onClick={() => window.open('/viewer-3d', '_blank')}\r\n                                className=\"h-9 bg-zinc-800 hover:bg-zinc-700 text-white font-black text-[9px] uppercase tracking-widest transition-all gap-2 border border-white/10\"\r\n                            >\r\n                                <Box className=\"w-3 h-3 text-amber-500\" />\r\n                                Editor 3D\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Model Library List */}\r\n                    <div className=\"space-y-2 mt-4 pt-4 border-t border-white/5\">\r\n                        <span className=\"text-[8px] font-black text-white/40 uppercase tracking-widest block mb-2\">\r\n                            Modelos Disponíveis ({existingModels.length + 2})\r\n                        </span>\r\n\r\n                        <div className=\"max-h-[180px] overflow-y-auto space-y-1.5 pr-1 custom-scrollbar\">\r\n                            {/* System Default Item */}\r\n                            <div\r\n                                onClick={() => handleSelectModel('default')}\r\n                                className={cn(\r\n                                    \"flex items-center justify-between p-2 rounded-lg border transition-all cursor-pointer group/item\",\r\n                                    !hasCustomModel ? \"bg-emerald-500/10 border-emerald-500/40\" : \"bg-white/5 border-transparent hover:border-white/10\"\r\n                                )}\r\n                            >\r\n                                <div className=\"flex items-center gap-2 min-w-0\">\r\n                                    <div className={cn(\r\n                                        \"w-1.5 h-1.5 rounded-full shrink-0\",\r\n                                        !hasCustomModel ? \"bg-emerald-500 animate-pulse\" : \"bg-white/10\"\r\n                                    )} />\r\n                                    <span className={cn(\r\n                                        \"text-[9px] font-bold truncate\",\r\n                                        !hasCustomModel ? \"text-emerald-400\" : \"text-white/50 group-hover/item:text-white\"\r\n                                    )}>\r\n                                        {cableSettings.modelConfigs?.['default']?.displayName || \"Torre Industrial (Padrão)\"}\r\n                                    </span>\r\n                                </div>\r\n                                <button\r\n                                    onClick={(e) => openEditModel(\"Torre Industrial (Padrão)\", \"default\", e)}\r\n                                    className=\"p-1 opacity-100 lg:opacity-0 group-hover/item:opacity-100 hover:text-amber-500 transition-all text-white/20\"\r\n                                >\r\n                                    <Settings2 className=\"w-3 h-3\" />\r\n                                </button>\r\n                            </div>\r\n\r\n                            {/* Portico 001 Local Item */}\r\n                            <div\r\n                                onClick={() => handleSelectModel('PORTICO-001')}\r\n                                className={cn(\r\n                                    \"flex items-center justify-between p-2 rounded-lg border transition-all cursor-pointer group/item\",\r\n                                    cableSettings.customModelUrl?.includes('PORTICO-001') ? \"bg-amber-500/10 border-amber-500/40\" : \"bg-white/5 border-transparent hover:border-white/10\"\r\n                                )}\r\n                            >\r\n                                <div className=\"flex items-center gap-2 min-w-0\">\r\n                                    <div className={cn(\r\n                                        \"w-1.5 h-1.5 rounded-full shrink-0\",\r\n                                        cableSettings.customModelUrl?.includes('PORTICO-001') ? \"bg-amber-500 animate-pulse\" : \"bg-white/10\"\r\n                                    )} />\r\n                                    <span className={cn(\r\n                                        \"text-[9px] font-bold truncate\",\r\n                                        cableSettings.customModelUrl?.includes('PORTICO-001') ? \"text-amber-400\" : \"text-white/50 group-hover/item:text-white\"\r\n                                    )}>\r\n                                        {cableSettings.modelConfigs?.[`${window.location.origin}/models/PORTICO-001/scene.gltf`]?.displayName || \"Pórtico 001 (Sistema)\"}\r\n                                    </span>\r\n                                </div>\r\n                                <button\r\n                                    onClick={(e) => openEditModel(\"Pórtico 001\", `${window.location.origin}/models/PORTICO-001/scene.gltf`, e)}\r\n                                    className=\"p-1 opacity-100 lg:opacity-0 group-hover/item:opacity-100 hover:text-amber-500 transition-all text-white/20\"\r\n                                >\r\n                                    <Settings2 className=\"w-3 h-3\" />\r\n                                </button>\r\n                            </div>\r\n\r\n                            {loadingModels && existingModels.length === 0 ? (\r\n                                <div className=\"py-8 flex justify-center\"><Loader2 className=\"w-4 h-4 animate-spin text-amber-500/20\" /></div>\r\n                            ) : existingModels.map((model) => {\r\n                                const API_URL = (import.meta.env.VITE_API_URL || '').replace(/\\/api\\/v1$/, '');\r\n                                const isActive = cableSettings.customModelUrl?.includes(model.name);\r\n                                const modelUrl = `${API_URL}/api/v1/storage/3d-models/get?path=models/${projectId}/${model.name}`;\r\n                                const config = cableSettings.modelConfigs?.[modelUrl];\r\n                                const displayName = config?.displayName || model.name.split('_').slice(1).join('_') || model.name;\r\n\r\n                                return (\r\n                                    <div\r\n                                        key={model.name}\r\n                                        onClick={() => handleSelectModel(model.name)}\r\n                                        className={cn(\r\n                                            \"flex items-center justify-between p-2 rounded-lg border transition-all cursor-pointer group/item\",\r\n                                            isActive ? \"bg-amber-500/10 border-amber-500/40\" : \"bg-white/3 border-transparent hover:border-white/10\"\r\n                                        )}\r\n                                    >\r\n                                        <div className=\"flex items-center gap-2 min-w-0\">\r\n                                            <div className={cn(\r\n                                                \"w-1.5 h-1.5 rounded-full shrink-0\",\r\n                                                isActive ? \"bg-amber-500 animate-pulse\" : \"bg-white/10\"\r\n                                            )} />\r\n                                            <span className={cn(\r\n                                                \"text-[9px] font-bold truncate max-w-[120px]\",\r\n                                                isActive ? \"text-amber-400\" : \"text-white/60 group-hover/item:text-white\"\r\n                                            )}>\r\n                                                {displayName}\r\n                                            </span>\r\n                                        </div>\r\n                                        <div className=\"flex items-center gap-1\">\r\n                                            <button\r\n                                                onClick={(e) => openEditModel(displayName, modelUrl, e)}\r\n                                                className=\"p-1 opacity-100 lg:opacity-0 group-hover/item:opacity-100 hover:text-amber-500 transition-all text-white/20\"\r\n                                            >\r\n                                                <Pencil className=\"w-2.5 h-2.5\" />\r\n                                            </button>\r\n                                            <button\r\n                                                onClick={(e) => handleRemoveFile(model.name, e)}\r\n                                                className=\"p-1 opacity-100 lg:opacity-0 group-hover/item:opacity-100 hover:text-red-500 transition-all text-white/20\"\r\n                                            >\r\n                                                <Trash2 className=\"w-2.5 h-2.5\" />\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </CardContent>\r\n\r\n            {/* Edit Dialog */}\r\n            <Dialog open={!!editingModel} onOpenChange={(open) => !open && setEditingModel(null)}>\r\n                <DialogContent className=\"glass-card border-white/10 bg-black/95 text-white max-w-2xl\">\r\n                    <DialogHeader>\r\n                        <DialogTitle className=\"flex items-center gap-3 text-amber-500 font-black uppercase tracking-widest text-sm\">\r\n                            <Settings2 className=\"w-5 h-5\" />\r\n                            Propriedades do Modelo: {editingModel?.name}\r\n                        </DialogTitle>\r\n                        <DialogDescription className=\"text-[10px] text-white/40 font-bold uppercase tracking-widest\">\r\n                            Ajuste as dimensões e posicionamento do Digital Twin no mapa.\r\n                        </DialogDescription>\r\n                    </DialogHeader>\r\n\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 py-6\">\r\n                        {/* Nome e Altura Base */}\r\n                        <div className=\"space-y-6\">\r\n                            <div className=\"space-y-3\">\r\n                                <Label className=\"text-[9px] font-black uppercase tracking-[0.2em] text-white/60\">Apelido do Modelo</Label>\r\n                                <Input\r\n                                    value={tempTransform.displayName || ''}\r\n                                    onChange={(e) => setTempTransform(prev => ({ ...prev, displayName: e.target.value }))}\r\n                                    className=\"h-10 bg-white/5 border-white/10 text-xs font-bold\"\r\n                                    placeholder=\"Ex: Torre Suspensão T1, Torre Ângulo...\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"space-y-4 p-4 bg-white/3 rounded-xl border border-white/5\">\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <Label className=\"text-[9px] font-black uppercase tracking-[0.2em] text-white/60 flex items-center gap-2\">\r\n                                        <Ruler className=\"w-3 h-3 text-amber-500\" /> Multiplicador de Altura\r\n                                    </Label>\r\n                                    <span className=\"text-xs font-black text-amber-400 font-mono\">{(tempTransform.baseHeight || 1).toFixed(2)}x</span>\r\n                                </div>\r\n                                <Slider\r\n                                    value={[tempTransform.baseHeight || 1]}\r\n                                    min={0.1} max={5} step={0.01}\r\n                                    onValueChange={([v]) => setTempTransform(prev => ({ ...prev, baseHeight: v }))}\r\n                                    className=\"py-2\"\r\n                                />\r\n                                <p className=\"text-[8px] text-white/40 italic\">Ajusta a altura total do modelo proporcionalmente à base do KMZ.</p>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-4\">\r\n                                <Label className=\"text-[9px] font-black uppercase tracking-[0.2em] text-white/60 flex items-center gap-2\">\r\n                                    <Maximize className=\"w-3 h-3 text-amber-500\" /> Escala (X, Y, Z)\r\n                                </Label>\r\n                                <div className=\"grid grid-cols-3 gap-2\">\r\n                                    {['X', 'Y', 'Z'].map((axis, i) => (\r\n                                        <div key={axis} className=\"space-y-1.5\">\r\n                                            <span className=\"text-[8px] font-black text-white/20 ml-1\">{axis}</span>\r\n                                            <Input\r\n                                                type=\"number\" step=\"0.01\"\r\n                                                value={tempTransform.scale[i]}\r\n                                                onChange={(e) => {\r\n                                                    const val = parseFloat(e.target.value) || 1;\r\n                                                    const ns = [...tempTransform.scale] as [number, number, number];\r\n                                                    ns[i] = val;\r\n                                                    setTempTransform(prev => ({ ...prev, scale: ns }));\r\n                                                }}\r\n                                                className=\"h-8 bg-black/40 border-white/5 text-[10px] font-mono text-center\"\r\n                                            />\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Rotação e Translação */}\r\n                        <div className=\"space-y-6\">\r\n                            <div className=\"space-y-4\">\r\n                                <Label className=\"text-[9px] font-black uppercase tracking-[0.2em] text-white/60 flex items-center gap-2\">\r\n                                    <RotateCcw className=\"w-3 h-3 text-amber-500\" /> Rotação Inicial (Graus)\r\n                                </Label>\r\n                                <div className=\"grid grid-cols-3 gap-2\">\r\n                                    {['Pitch', 'Roll', 'Yaw'].map((axis, i) => (\r\n                                        <div key={axis} className=\"space-y-1.5\">\r\n                                            <span className=\"text-[8px] font-black text-white/20 ml-1\">{axis}</span>\r\n                                            <Input\r\n                                                type=\"number\" step=\"1\"\r\n                                                value={tempTransform.rotation[i]}\r\n                                                onChange={(e) => {\r\n                                                    const val = parseFloat(e.target.value) || 0;\r\n                                                    const nr = [...tempTransform.rotation] as [number, number, number];\r\n                                                    nr[i] = val;\r\n                                                    setTempTransform(prev => ({ ...prev, rotation: nr }));\r\n                                                }}\r\n                                                className=\"h-8 bg-black/40 border-white/5 text-[10px] font-mono text-center\"\r\n                                            />\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-4\">\r\n                                <Label className=\"text-[9px] font-black uppercase tracking-[0.2em] text-white/60 flex items-center gap-2\">\r\n                                    <Move className=\"w-3 h-3 text-amber-500\" /> Deslocamento (X, Y, Z Metros)\r\n                                </Label>\r\n                                <div className=\"grid grid-cols-3 gap-2\">\r\n                                    {['Easting', 'Northing', 'Up'].map((axis, i) => (\r\n                                        <div key={axis} className=\"space-y-1.5\">\r\n                                            <span className=\"text-[8px] font-black text-white/20 ml-1\">{axis}</span>\r\n                                            <Input\r\n                                                type=\"number\" step=\"0.1\"\r\n                                                value={tempTransform.offset[i]}\r\n                                                onChange={(e) => {\r\n                                                    const val = parseFloat(e.target.value) || 0;\r\n                                                    const no = [...tempTransform.offset] as [number, number, number];\r\n                                                    no[i] = val;\r\n                                                    setTempTransform(prev => ({ ...prev, offset: no }));\r\n                                                }}\r\n                                                className=\"h-8 bg-black/40 border-white/5 text-[10px] font-mono text-center\"\r\n                                            />\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <Button\r\n                                variant=\"outline\"\r\n                                onClick={() => setTempTransform(DEFAULT_TRANSFORM)}\r\n                                className=\"w-full h-9 border-white/5 bg-white/2 hover:bg-white/5 text-[9px] font-black uppercase tracking-widest gap-2\"\r\n                            >\r\n                                <RefreshCw className=\"w-3 h-3\" /> Resetar Valores\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <DialogFooter className=\"border-t border-white/5 pt-6 gap-3\">\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            onClick={() => setEditingModel(null)}\r\n                            className=\"h-11 px-8 text-[10px] font-black uppercase tracking-widest text-white/40 hover:text-white\"\r\n                        >\r\n                            Cancelar\r\n                        </Button>\r\n                        <Button\r\n                            onClick={handleSaveTransform}\r\n                            className=\"h-11 px-12 bg-amber-500 hover:bg-amber-600 text-black font-black text-[10px] uppercase tracking-[0.2em] shadow-lg shadow-amber-500/20 gap-2\"\r\n                        >\r\n                            <Save className=\"w-4 h-4\" /> Salvar Alterações\r\n                        </Button>\r\n                    </DialogFooter>\r\n                </DialogContent>\r\n            </Dialog>\r\n        </Card>\r\n    );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\map\\suspended-cable.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1491,1494],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1491,1494],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect } from 'react';\r\nimport { useMap } from 'react-map-gl/mapbox';\r\nimport * as turf from '@turf/turf';\r\n\r\ninterface towerData {\r\n    coordinates: { lng: number; lat: number };\r\n    height: number;\r\n    id?: string;\r\n}\r\n\r\ninterface SuspendedCableProps {\r\n    tower1: towerData;\r\n    tower2: towerData;\r\n    towerVerticalOffset?: number;\r\n    color?: string;\r\n    width?: number; // width in meters\r\n    id?: string;\r\n}\r\n\r\nexport const SuspendedCable: React.FC<SuspendedCableProps> = ({\r\n    tower1,\r\n    tower2,\r\n    towerVerticalOffset = 0,\r\n    color = '#000000',\r\n    width = 0.5,\r\n    id = 'suspended-cable'\r\n}) => {\r\n    const { current: map } = useMap();\r\n\r\n    useEffect(() => {\r\n        if (!map) return;\r\n\r\n        const h1 = tower1.height + towerVerticalOffset;\r\n        const h2 = tower2.height + towerVerticalOffset;\r\n        const averageHeight = (h1 + h2) / 2;\r\n\r\n        // Create line between the two towers\r\n        const line = turf.lineString([\r\n            [tower1.coordinates.lng, tower1.coordinates.lat],\r\n            [tower2.coordinates.lng, tower2.coordinates.lat]\r\n        ]);\r\n\r\n        // Create a buffer (strip) around the line\r\n        const buffer = turf.buffer(line, width / 2, { units: 'meters' });\r\n\r\n        const sourceId = `cable-source-${id}`;\r\n        const layerId = `cable-layer-${id}`;\r\n\r\n        const mapInstance = map.getMap();\r\n        if (mapInstance.getSource(sourceId)) {\r\n            (mapInstance.getSource(sourceId) as any).setData(buffer);\r\n        } else {\r\n            mapInstance.addSource(sourceId, {\r\n                type: 'geojson',\r\n                data: buffer\r\n            });\r\n\r\n            mapInstance.addLayer({\r\n                id: layerId,\r\n                type: 'fill-extrusion',\r\n                source: sourceId,\r\n                paint: {\r\n                    'fill-extrusion-color': color,\r\n                    'fill-extrusion-height': averageHeight,\r\n                    'fill-extrusion-base': averageHeight - 0.2, // Small thickness\r\n                    'fill-extrusion-opacity': 0.8\r\n                }\r\n            });\r\n        }\r\n\r\n        return () => {\r\n            if (mapInstance.getLayer(layerId)) mapInstance.removeLayer(layerId);\r\n            if (mapInstance.getSource(sourceId)) mapInstance.removeSource(sourceId);\r\n        };\r\n    }, [map, tower1, tower2, towerVerticalOffset, color, width, id]);\r\n\r\n    return null;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\projects\\DelegationModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\projects\\DelegationPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useAuth' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":17},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":48,"column":8,"nodeType":"ArrayExpression","endLine":48,"endColumn":19,"suggestions":[{"desc":"Update the dependencies array to be: [fetchData, projectId]","fix":{"range":[1530,1541],"text":"[fetchData, projectId]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":85,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":85,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":97,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":97,"endColumn":23}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Shield, UserPlus, Trash2, Loader2, Info } from 'lucide-react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { orionApi } from '@/integrations/orion/client';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\ninterface Delegation {\r\n    id: string;\r\n    jobFunction: { name: string };\r\n    module: { name: string; code: string };\r\n    canCreate: boolean;\r\n    canRead: boolean;\r\n    canUpdate: boolean;\r\n    canDelete: boolean;\r\n}\r\n\r\ninterface JobFunction {\r\n    id: string;\r\n    name: string;\r\n}\r\n\r\ninterface Module {\r\n    id: string;\r\n    name: string;\r\n    code: string;\r\n}\r\n\r\nexport function DelegationPanel({ projectId }: { projectId: string }) {\r\n    const [delegations, setDelegations] = useState<Delegation[]>([]);\r\n    const [functions, setFunctions] = useState<JobFunction[]>([]);\r\n    const [modules, setModules] = useState<Module[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [saving, setSaving] = useState(false);\r\n    const { toast } = useToast();\r\n\r\n    const [selection, setSelection] = useState({\r\n        jobFunctionId: '',\r\n        moduleId: ''\r\n    });\r\n\r\n    useEffect(() => {\r\n        fetchData();\r\n    }, [projectId]);\r\n\r\n    const fetchData = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const [delRes, funcRes, modRes] = await Promise.all([\r\n                orionApi.get(`/projects/${projectId}/delegations`),\r\n                orionApi.get(`/job_functions?projectId=${projectId}`),\r\n                orionApi.get(`/permission_modules`)\r\n            ]);\r\n\r\n            setDelegations((delRes.data as Delegation[]) || []);\r\n            setFunctions((funcRes.data as JobFunction[]) || []);\r\n            setModules((modRes.data as Module[]) || []);\r\n        } catch (error) {\r\n            console.error('Erro ao carregar dados de delegação:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleGrant = async () => {\r\n        if (!selection.jobFunctionId || !selection.moduleId) return;\r\n\r\n        setSaving(true);\r\n        try {\r\n            await orionApi.post(`/projects/${projectId}/delegations`, {\r\n                ...selection,\r\n                canCreate: true,\r\n                canRead: true,\r\n                canUpdate: true,\r\n                canDelete: true\r\n            });\r\n\r\n            toast({ title: 'Poderes Delegados', description: 'A função agora possui acesso administrativo ao módulo.' });\r\n            fetchData();\r\n            setSelection({ jobFunctionId: '', moduleId: '' });\r\n        } catch (error) {\r\n            toast({ title: 'Erro', description: 'Não foi possível delegar a permissão.', variant: 'destructive' });\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const handleRevoke = async (id: string) => {\r\n        try {\r\n            await orionApi.delete(`/projects/${projectId}/delegations/${id}`);\r\n            toast({ title: 'Permissão Revogada' });\r\n            setDelegations(prev => prev.filter(d => d.id !== id));\r\n        } catch (error) {\r\n            toast({ title: 'Erro', description: 'Não foi possível revogar a permissão.', variant: 'destructive' });\r\n        }\r\n    };\r\n\r\n    if (loading) return <div className=\"flex justify-center p-8\"><Loader2 className=\"animate-spin\" /></div>;\r\n\r\n    return (\r\n        <Card className=\"glass-card mt-6 border-l-4 border-l-blue-500\">\r\n            <CardHeader>\r\n                <CardTitle className=\"flex items-center gap-2\">\r\n                    <Shield className=\"w-5 h-5 text-blue-500\" />\r\n                    Delegação de Poderes Extras (PM)\r\n                </CardTitle>\r\n                <CardDescription>\r\n                    Atribua poderes de gestão para cargos específicos neste projeto.\r\n                </CardDescription>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-6\">\r\n                <div className=\"flex items-start gap-4 p-4 rounded-lg bg-blue-500/10 border border-blue-500/20 text-sm text-blue-200\">\r\n                    <Info className=\"w-5 h-5 shrink-0\" />\r\n                    <p>\r\n                        Aqui você pode delegar o controle de módulos (ex: Gestão de Funcionários) para cargos como\r\n                        <strong> RH</strong> ou <strong> Administrativo</strong>, permitindo que eles ajudem na gestão da obra.\r\n                    </p>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 items-end bg-white/5 p-4 rounded-xl border border-white/10\">\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-xs font-bold uppercase text-muted-foreground\">Escolha o Cargo</label>\r\n                        <Select value={selection.jobFunctionId} onValueChange={id => setSelection(prev => ({ ...prev, jobFunctionId: id }))}>\r\n                            <SelectTrigger className=\"industrial-input\">\r\n                                <SelectValue placeholder=\"Selecione o cargo\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent className=\"glass-card\">\r\n                                {functions.map(f => (\r\n                                    <SelectItem key={f.id} value={f.id}>{f.name}</SelectItem>\r\n                                ))}\r\n                            </SelectContent>\r\n                        </Select>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-xs font-bold uppercase text-muted-foreground\">Pacote de Poderes (Módulo)</label>\r\n                        <Select value={selection.moduleId} onValueChange={id => setSelection(prev => ({ ...prev, moduleId: id }))}>\r\n                            <SelectTrigger className=\"industrial-input\">\r\n                                <SelectValue placeholder=\"Selecione o módulo\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent className=\"glass-card\">\r\n                                {modules.map(m => (\r\n                                    <SelectItem key={m.id} value={m.id}>{m.name}</SelectItem>\r\n                                ))}\r\n                            </SelectContent>\r\n                        </Select>\r\n                    </div>\r\n\r\n                    <Button onClick={handleGrant} disabled={!selection.jobFunctionId || !selection.moduleId || saving} className=\"gradient-primary text-white\">\r\n                        {saving ? <Loader2 className=\"animate-spin mr-2\" /> : <UserPlus className=\"w-4 h-4 mr-2\" />}\r\n                        Delegar Poderes\r\n                    </Button>\r\n                </div>\r\n\r\n                <div className=\"space-y-3\">\r\n                    <h3 className=\"text-xs font-bold uppercase text-muted-foreground tracking-widest px-1\">Poderes Ativos</h3>\r\n                    {delegations.length === 0 ? (\r\n                        <div className=\"text-center py-8 text-muted-foreground bg-white/5 rounded-lg border border-dashed border-white/10\">\r\n                            Nenhuma delegação ativa para este projeto.\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"grid gap-2\">\r\n                            {delegations.map(del => (\r\n                                <div key={del.id} className=\"flex items-center justify-between p-3 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition-colors\">\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className=\"w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-500\">\r\n                                            <Shield className=\"w-4 h-4\" />\r\n                                        </div>\r\n                                        <div>\r\n                                            <div className=\"text-sm font-bold\">{del.jobFunction?.name}</div>\r\n                                            <div className=\"text-[10px] text-muted-foreground uppercase\">{del.module?.name}</div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <Badge variant=\"outline\" className=\"text-[10px] border-emerald-500/50 text-emerald-500 bg-emerald-500/5\">FULL ACCESS</Badge>\r\n                                        <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 text-muted-foreground hover:text-destructive\" onClick={() => handleRevoke(del.id)}>\r\n                                            <Trash2 className=\"w-4 h-4\" />\r\n                                        </Button>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </CardContent>\r\n        </Card>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\pwa\\InstallPrompt.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[345,348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[345,348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isOpera' is assigned a value but never used.","line":11,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":93,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":96,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[775,778],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[775,778],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-expressions","severity":2,"message":"Expected an assignment or function call and instead saw an expression.","line":18,"column":10,"nodeType":"ExpressionStatement","messageId":"unusedExpression","endLine":18,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[977,980],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[977,980],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1083,1086],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1083,1086],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Download, Share, Smartphone, CheckCircle2, MoreVertical, PlusSquare } from 'lucide-react';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\nexport function InstallPrompt() {\r\n    const [deferredPrompt, setDeferredPrompt] = useState<any>(null);\r\n    const [isInstallable, setIsInstallable] = useState(false);\r\n    const [isStandalone, setIsStandalone] = useState(false);\r\n    const [isIOS, setIsIOS] = useState(false);\r\n    const [isOpera, setIsOpera] = useState(false);\r\n    const { toast } = useToast();\r\n\r\n    useEffect(() => {\r\n        // Check if already installed\r\n        if (window.matchMedia('(display-mode: standalone)').matches || (window.navigator as any).standalone) {\r\n            setIsStandalone(true);\r\n        }''\r\n\r\n        // Detect browser/OS\r\n        const ua = navigator.userAgent;\r\n        setIsIOS(/iPad|iPhone|iPod/.test(ua) && !(window as any).MSStream);\r\n        setIsOpera(/OPR/i.test(ua) || /Opera/i.test(ua));\r\n\r\n        const handler = (e: any) => {\r\n            e.preventDefault();\r\n            setDeferredPrompt(e);\r\n            setIsInstallable(true);\r\n        };\r\n\r\n        window.addEventListener('beforeinstallprompt', handler);\r\n\r\n        return () => {\r\n            window.removeEventListener('beforeinstallprompt', handler);\r\n        };\r\n    }, []);\r\n\r\n    const handleInstallClick = async () => {\r\n        if (!deferredPrompt) return;\r\n\r\n        deferredPrompt.prompt();\r\n        const { outcome } = await deferredPrompt.userChoice;\r\n\r\n        if (outcome === 'accepted') {\r\n            toast({\r\n                title: \"Instalando...\",\r\n                description: \"O aplicativo está sendo instalado no seu dispositivo.\",\r\n            });\r\n            setIsInstallable(false);\r\n        }\r\n        setDeferredPrompt(null);\r\n    };\r\n\r\n    if (isStandalone) {\r\n        return (\r\n            <div className=\"flex items-center gap-2 text-success bg-success/10 p-3 rounded-lg border border-success/20 w-full\">\r\n                <CheckCircle2 className=\"h-5 w-5\" />\r\n                <span className=\"text-sm font-medium\">Aplicativo já instalado</span>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (isIOS && !isStandalone) {\r\n        return (\r\n            <div className=\"space-y-3 bg-secondary/30 p-4 rounded-xl border border-white/10 w-full\">\r\n                <p className=\"text-sm font-medium flex items-center gap-2\">\r\n                    <Smartphone className=\"h-4 w-4\" />\r\n                    Instalar no iPhone / iPad\r\n                </p>\r\n                <ol className=\"text-xs text-muted-foreground space-y-2 list-decimal list-inside\">\r\n                    <li>Toque no botão de compartilhar <Share className=\"h-3 w-3 inline\" /> abaixo</li>\r\n                    <li>Role para baixo e selecione \"Adicionar à Tela de Início\"</li>\r\n                </ol>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Caso não seja instalável automaticamente (comum no Opera)\r\n    if (!isInstallable) {\r\n        return (\r\n            <div className=\"space-y-3 bg-secondary/30 p-4 rounded-xl border border-white/10 w-full animate-fade-in\">\r\n                <div className=\"flex items-center gap-2 text-primary font-medium\">\r\n                    <Download className=\"h-4 w-4\" />\r\n                    <span>Instalar Aplicativo</span>\r\n                </div>\r\n\r\n                <div className=\"text-xs text-muted-foreground space-y-2\">\r\n                    <p>O navegador (Opera) pode exigir a instalação manual. Siga os passos:</p>\r\n                    <ul className=\"list-disc list-inside space-y-1\">\r\n                        <li>Procure o ícone de <strong>Adicionar</strong> <PlusSquare className=\"h-3 w-3 inline\" /> na barra de endereços (lado direito).</li>\r\n                        <li>Ou abra o menu <MoreVertical className=\"h-3 w-3 inline\" /> e selecione <strong>\"Instalar Aplicativo\"</strong>.</li>\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Button\r\n            onClick={handleInstallClick}\r\n            disabled={!isInstallable}\r\n            className=\"w-full gap-2 gradient-primary text-white shadow-glow hover:opacity-90 transition-all h-11\"\r\n        >\r\n            <Download className=\"h-5 w-5\" />\r\n            {isInstallable ? 'Instalar Aplicativo' : 'Verificando Compatibilidade...'}\r\n        </Button>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\scene\\AnchorMarker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\scene\\AnchorPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'FileDown' is defined but never used.","line":7,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3021,3024],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3021,3024],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":129,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":129,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":159,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":159,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":181,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":181,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":290,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":290,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13678,13681],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13678,13681],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":318,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15515,15518],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15515,15518],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":318,"column":94,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":97,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15556,15559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15556,15559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":319,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":319,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15641,15644],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15641,15644],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":319,"column":136,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":319,"endColumn":139,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15700,15703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15700,15703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":334,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":334,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16970,16973],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16970,16973],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":334,"column":98,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":334,"endColumn":101,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17007,17010],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17007,17010],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":335,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":335,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17090,17093],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17090,17093],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":335,"column":98,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":335,"endColumn":101,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17127,17130],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17127,17130],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":336,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":336,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17210,17213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17210,17213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":336,"column":98,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":336,"endColumn":101,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17247,17250],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17247,17250],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":350,"column":93,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":350,"endColumn":96,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18148,18151],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18148,18151],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":366,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":366,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19395,19398],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19395,19398],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":366,"column":109,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":366,"endColumn":112,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19436,19439],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19436,19439],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":376,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":376,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20285,20288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20285,20288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":20,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Trash2, X, Download, Save, Upload } from 'lucide-react'\r\nimport { useAnchorStore } from '../../store/anchorStore'\r\nimport { Button } from '../ui/button'\r\nimport { serializeAnchors, saveAnchors, loadTemplateAnchors, saveAsTemplate, STANDARD_PROJECT_ID } from '../../services/anchorService'\r\nimport { useState, useRef } from 'react'\r\nimport { useToast } from '../../hooks/use-toast'\r\nimport { Copy, FileDown, FileUp } from 'lucide-react'\r\nimport * as THREE from 'three'\r\n\r\ninterface AnchorPanelProps {\r\n    context: {\r\n        companyId: string\r\n        projectId: string\r\n        towerId: string\r\n    }\r\n}\r\n\r\nexport function AnchorPanel({ context }: AnchorPanelProps) {\r\n    const anchors = useAnchorStore(s => s.anchors)\r\n    const remove = useAnchorStore(s => s.removeAnchor)\r\n    const clear = useAnchorStore(s => s.clearAnchors)\r\n    const setAnchors = useAnchorStore(s => s.setAnchors)\r\n    const updateName = useAnchorStore(s => s.updateAnchorName)\r\n    const updateType = useAnchorStore(s => s.updateAnchorType)\r\n\r\n    // Tower Sequencing (Reactive)\r\n    const technicalKm = useAnchorStore(s => s.technicalKm)\r\n    const technicalIndex = useAnchorStore(s => s.technicalIndex)\r\n    const circuitId = useAnchorStore(s => s.circuitId)\r\n    const setTechnicalKm = useAnchorStore(s => s.setTechnicalKm)\r\n    const setTechnicalIndex = useAnchorStore(s => s.setTechnicalIndex)\r\n    const setCircuitId = useAnchorStore(s => s.setCircuitId)\r\n\r\n    const [isSaving, setIsSaving] = useState(false)\r\n    const { toast } = useToast()\r\n    const fileInputRef = useRef<HTMLInputElement>(null)\r\n\r\n    const baseAnchor = anchors.find(a => a.type === 'calibration_base')\r\n\r\n    const handleExport = () => {\r\n        const serialized = serializeAnchors(anchors)\r\n        const data = JSON.stringify(serialized, null, 2)\r\n        const blob = new Blob([data], { type: 'application/json' })\r\n        const url = URL.createObjectURL(blob)\r\n        const link = document.createElement('a')\r\n        link.href = url\r\n        link.download = `anchors_${new Date().toISOString().split('T')[0]}.json`\r\n        document.body.appendChild(link)\r\n        link.click()\r\n        document.body.removeChild(link)\r\n        URL.revokeObjectURL(url)\r\n    }\r\n\r\n    const handleImport = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = event.target.files?.[0]\r\n        if (!file) return\r\n\r\n        const reader = new FileReader()\r\n        reader.onload = (e) => {\r\n            try {\r\n                const content = e.target?.result as string\r\n                const parsed = JSON.parse(content)\r\n\r\n                // Handle both array format and wrapped format\r\n                const anchorsArray = Array.isArray(parsed) ? parsed : parsed.anchors\r\n\r\n                if (!Array.isArray(anchorsArray)) {\r\n                    throw new Error('Formato inválido: esperado um array de âncoras')\r\n                }\r\n\r\n                // Convert to our internal format\r\n                const importedAnchors = anchorsArray.map((a: any, idx: number) => ({\r\n                    id: a.id || `imported-${idx}-${Date.now()}`,\r\n                    name: a.name || a.label || `Anchor ${idx + 1}`,\r\n                    type: a.type || 'cable_attach',\r\n                    meshName: a.meshName || 'imported',\r\n                    position: Array.isArray(a.position)\r\n                        ? new THREE.Vector3(a.position[0], a.position[1], a.position[2])\r\n                        : new THREE.Vector3(a.position.x, a.position.y, a.position.z),\r\n                    normal: a.normal,\r\n                    faceIndex: a.faceIndex,\r\n                    createdAt: a.createdAt || new Date().toISOString()\r\n                }))\r\n\r\n                setAnchors(importedAnchors)\r\n\r\n                toast({\r\n                    title: \"Importação Concluída\",\r\n                    description: `${importedAnchors.length} âncoras carregadas com sucesso.`,\r\n                })\r\n            } catch (error) {\r\n                console.error('Import error:', error)\r\n                toast({\r\n                    title: \"Erro na Importação\",\r\n                    description: \"Arquivo JSON inválido ou formato incorreto.\",\r\n                    variant: \"destructive\"\r\n                })\r\n            }\r\n        }\r\n        reader.readAsText(file)\r\n\r\n        // Reset input so the same file can be selected again\r\n        if (fileInputRef.current) {\r\n            fileInputRef.current.value = ''\r\n        }\r\n    }\r\n\r\n    const handleSave = async () => {\r\n        if (!context.companyId || !context.projectId || !context.towerId) {\r\n            toast({\r\n                title: \"Erro de Contexto\",\r\n                description: \"Faltam informações de Empresa, Obra ou Torre na URL.\",\r\n                variant: \"destructive\"\r\n            })\r\n            return\r\n        }\r\n\r\n        setIsSaving(true)\r\n        try {\r\n            await saveAnchors(context, anchors, {\r\n                technicalKm,\r\n                technicalIndex,\r\n                circuitId\r\n            })\r\n            toast({\r\n                title: \"Configuração Salva\",\r\n                description: \"As âncoras e sequência técnica foram persistidas globalmente.\",\r\n            })\r\n        } catch (error) {\r\n            toast({\r\n                title: \"Erro ao Salvar\",\r\n                description: \"Não foi possível salvar as âncoras no banco de dados.\",\r\n                variant: \"destructive\"\r\n            })\r\n        } finally {\r\n            setIsSaving(false)\r\n        }\r\n    }\r\n\r\n    const handleLoadTemplate = async () => {\r\n        if (!window.confirm('Isso substituirá todas as âncoras atuais pelo modelo padrão. Continuar?')) return\r\n\r\n        try {\r\n            const templateAnchors = await loadTemplateAnchors(context.towerId)\r\n\r\n            // Regenerate IDs to ensure they are treated as new instances for this project\r\n            const newAnchors = templateAnchors.map(a => ({\r\n                ...a,\r\n                id: `instance-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n                companyId: context.companyId,\r\n                projectId: context.projectId\r\n            }))\r\n\r\n            setAnchors(newAnchors)\r\n            toast({\r\n                title: \"Modelo Carregado\",\r\n                description: \"As âncoras padrão foram carregadas. Lembre-se de salvar para persistir neste projeto.\",\r\n            })\r\n        } catch (error) {\r\n            toast({\r\n                title: \"Erro\",\r\n                description: \"Não foi possível carregar o modelo padrão.\",\r\n                variant: \"destructive\"\r\n            })\r\n        }\r\n    }\r\n\r\n    const handleSaveAsTemplate = async () => {\r\n        if (!window.confirm('ATENÇÃO: Isso atualizará o MODELO PADRÃO para todas as obras. Tem certeza?')) return\r\n\r\n        setIsSaving(true)\r\n        try {\r\n            // Ensure we are sending clean anchors without project-specific IDs if possible, \r\n            // but the backend might handle ID generation. \r\n            // We pass the current anchors.\r\n            await saveAsTemplate(context.towerId, anchors)\r\n            toast({\r\n                title: \"Template Atualizado\",\r\n                description: \"Esta configuração agora é o padrão para este tipo de torre.\",\r\n            })\r\n        } catch (error) {\r\n            toast({\r\n                title: \"Erro ao Salvar Template\",\r\n                description: \"Falha ao atualizar o modelo padrão.\",\r\n                variant: \"destructive\"\r\n            })\r\n        } finally {\r\n            setIsSaving(false)\r\n        }\r\n    }\r\n\r\n    const isTemplateContext = context.projectId === STANDARD_PROJECT_ID\r\n\r\n    return (\r\n        <div className=\"absolute top-6 right-6 bg-zinc-900/90 backdrop-blur-md text-white p-5 rounded-2xl w-80 shadow-2xl border border-white/10 flex flex-col max-h-[80vh]\">\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n                <div>\r\n                    <h2 className=\"font-black uppercase tracking-tighter text-lg\">Anchors</h2>\r\n                    <p className=\"text-[10px] text-white/40 uppercase tracking-widest leading-none\">\r\n                        {isTemplateContext ? 'EDITANDO TEMPLATE' : 'Configuração do Projeto'}\r\n                    </p>\r\n                </div>\r\n                <Button variant=\"ghost\" size=\"icon\" onClick={() => { if (window.confirm('Limpar todas as âncoras?')) clear() }} className=\"text-white/20 hover:text-red-500 hover:bg-red-500/10\">\r\n                    <Trash2 className=\"w-4 h-4\" />\r\n                </Button>\r\n            </div>\r\n\r\n            {/* Seção de Topologia e Sequenciamento */}\r\n            {!isTemplateContext && (\r\n                <div className=\"bg-black/40 rounded-xl p-3 mb-4 border border-white/10 shadow-inner group\">\r\n                    <div className=\"flex items-center gap-2 mb-2\">\r\n                        <div className=\"p-1 bg-cyan-500/20 rounded\">\r\n                            <Save className=\"w-3 h-3 text-cyan-400\" />\r\n                        </div>\r\n                        <span className=\"text-[10px] font-black uppercase tracking-widest text-white/70\">Topologia da Linha</span>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-3\">\r\n                        <div className=\"flex flex-col gap-1\">\r\n                            <span className=\"text-[8px] text-white/40 font-bold uppercase\">Estrutura (KM/ÍNDICE)</span>\r\n                            <div className=\"flex items-center gap-1.5 bg-black/20 rounded-lg p-1 border border-white/5 focus-within:border-cyan-500/30 transition-all\">\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={technicalKm}\r\n                                    onFocus={(e) => e.target.select()}\r\n                                    onChange={(e) => setTechnicalKm(parseInt(e.target.value) || 0)}\r\n                                    className=\"w-full bg-transparent border-none text-[11px] font-mono text-center text-cyan-400 focus:outline-none focus:ring-0 p-0\"\r\n                                    placeholder=\"KM\"\r\n                                />\r\n                                <span className=\"text-white/10 font-bold\">/</span>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={technicalIndex}\r\n                                    onFocus={(e) => e.target.select()}\r\n                                    onChange={(e) => setTechnicalIndex(parseInt(e.target.value) || 0)}\r\n                                    className=\"w-full bg-transparent border-none text-[11px] font-mono text-center text-cyan-400 focus:outline-none focus:ring-0 p-0\"\r\n                                    placeholder=\"IND\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex flex-col gap-1\">\r\n                            <span className=\"text-[8px] text-white/40 font-bold uppercase\">Circuito ID</span>\r\n                            <div className=\"flex items-center bg-black/20 rounded-lg p-1 h-[32px] border border-white/5 focus-within:border-cyan-500/30 transition-all\">\r\n                                <span className=\"text-[9px] text-white/20 font-black ml-1 mr-2 px-1 bg-white/5 rounded\">C</span>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={circuitId.replace(/^C/, '')}\r\n                                    onFocus={(e) => e.target.select()}\r\n                                    onChange={(e) => setCircuitId(`C${e.target.value.toUpperCase().replace(/^C/, '')}`)}\r\n                                    className=\"w-full bg-transparent border-none text-[11px] font-mono text-white focus:outline-none focus:ring-0 p-0\"\r\n                                    placeholder=\"1\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Template Controls */}\r\n            {!isTemplateContext && (\r\n                <div className=\"flex gap-2 mb-4 pb-4 border-b border-white/5\">\r\n                    <Button\r\n                        variant=\"outline\"\r\n                        size=\"sm\"\r\n                        onClick={handleLoadTemplate}\r\n                        className=\"flex-1 border-amber-500/30 text-amber-500 hover:bg-amber-500/10 text-[9px] font-black uppercase tracking-widest h-8\"\r\n                    >\r\n                        <Copy className=\"w-3 h-3 mr-2\" />\r\n                        Usar Padrão\r\n                    </Button>\r\n                    <Button\r\n                        variant=\"ghost\"\r\n                        size=\"sm\"\r\n                        onClick={handleSaveAsTemplate}\r\n                        className=\"w-8 px-0 text-white/20 hover:text-amber-500\"\r\n                        title=\"Salvar como Template (CUIDADO)\"\r\n                    >\r\n                        <FileUp className=\"w-3 h-3\" />\r\n                    </Button>\r\n                </div>\r\n            )}\r\n            <div className=\"mb-4 pb-4 border-b border-white/5\">\r\n                <Button\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    onClick={() => {\r\n                        if (!window.confirm('Isso ajustará a escala das âncoras de 4.5x para 1.0x. Use apenas se as âncoras estiverem flutuando longe da torre. Continuar?')) return\r\n                        const newAnchors = anchors.map(a => {\r\n                            const pos = (a.position as any).isVector3 ? a.position.clone() : new THREE.Vector3(a.position[0], a.position[1], a.position[2])\r\n                            // Reverse the previous transformation: (World - Offset) / Scale\r\n                            // Old Transform was: World = Local * 4.5 + [0, 4, 0]\r\n                            // New Transform is: World = Local * 1 + [0, 0, 0]\r\n                            // So to adapt Old World to New World:\r\n                            // Local = (OldWorld - [0, 4, 0]) / 4.5\r\n                            // NewWorld = Local\r\n                            pos.sub(new THREE.Vector3(0, 4, 0)).divideScalar(4.5)\r\n                            return { ...a, position: pos }\r\n                        })\r\n                        setAnchors(newAnchors)\r\n                        toast({ title: \"Escala Corrigida\", description: \"Âncoras ajustadas para escala 1.0x.\" })\r\n                    }}\r\n                    className=\"w-full border-red-500/30 text-red-400 hover:bg-red-500/10 text-[9px] font-black uppercase tracking-widest h-8\"\r\n                >\r\n                    <Download className=\"w-3 h-3 mr-2 rotate-180\" />\r\n                    Corrigir Escala (4.5x → 1x)\r\n                </Button>\r\n            </div>\r\n\r\n            <div className=\"flex-1 overflow-y-auto custom-scrollbar space-y-2 pr-2\">\r\n                {anchors.length === 0 ? (\r\n                    <div className=\"py-8 text-center border-2 border-dashed border-white/5 rounded-xl\">\r\n                        <p className=\"text-[10px] font-bold uppercase tracking-widest text-white/20\">Nenhum anchor criado</p>\r\n                        <p className=\"text-[9px] text-white/10\">Clique no modelo para adicionar</p>\r\n                    </div>\r\n                ) : (\r\n                    anchors.map(a => {\r\n                        const posZ = (a.position as any).z ?? a.position.z ?? (a.position as any)[2]\r\n                        const baseZ = baseAnchor ? ((baseAnchor.position as any).z ?? baseAnchor.position.z ?? (baseAnchor.position as any)[2]) : 0\r\n                        const relHeight = baseAnchor && a.id !== baseAnchor.id ? Math.abs(posZ - baseZ).toFixed(2) : null\r\n\r\n                        return (\r\n                            <div key={a.id} className=\"flex flex-col p-3 bg-white/5 border border-white/5 rounded-xl group hover:border-white/20 transition-all gap-2\">\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <div className=\"flex flex-col flex-1 mr-2\">\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={a.name ?? a.meshName ?? 'Mesh'}\r\n                                            onChange={(e) => updateName(a.id, e.target.value)}\r\n                                            className=\"bg-transparent border-none text-[10px] font-black uppercase text-cyan-400 leading-none mb-1 focus:outline-none focus:ring-0 w-full\"\r\n                                            placeholder=\"Nome do Ponto\"\r\n                                        />\r\n                                        <span className=\"text-[9px] text-white/40 font-mono tracking-tighter\">\r\n                                            {(a.position as any).x?.toFixed(2) ?? (a.position as any)[0]?.toFixed(2)},\r\n                                            {(a.position as any).y?.toFixed(2) ?? (a.position as any)[1]?.toFixed(2)},\r\n                                            {(a.position as any).z?.toFixed(2) ?? (a.position as any)[2]?.toFixed(2)}\r\n                                        </span>\r\n                                    </div>\r\n                                    <button\r\n                                        onClick={() => remove(a.id)}\r\n                                        className=\"p-1.5 text-white/20 hover:text-red-400 hover:bg-red-400/10 rounded-lg transition-colors\"\r\n                                    >\r\n                                        <X className=\"w-3.5 h-3.5\" />\r\n                                    </button>\r\n                                </div>\r\n\r\n                                <div className=\"flex items-center justify-between gap-2 border-t border-white/5 pt-2\">\r\n                                    <select\r\n                                        value={a.type || 'cable_attach'}\r\n                                        onChange={(e) => updateType(a.id, e.target.value as any)}\r\n                                        className=\"bg-black/20 text-[9px] text-white/70 border border-white/10 rounded px-1.5 py-1 focus:outline-none focus:border-cyan-500/50 w-full uppercase font-bold\"\r\n                                    >\r\n                                        <option value=\"cable_attach\">Ponto de Fixação</option>\r\n                                        <option value=\"calibration_base\">Base (Ref. Altura)</option>\r\n                                        <option value=\"accessory_mount\">Acessório</option>\r\n                                    </select>\r\n\r\n                                    {relHeight && (\r\n                                        <div className=\"whitespace-nowrap bg-cyan-500/10 text-cyan-400 px-2 py-1 rounded text-[9px] font-bold border border-cyan-500/20\">\r\n                                            {relHeight}m\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                                <div className=\"grid grid-cols-3 gap-1 mt-1 border-t border-white/5 pt-2\">\r\n                                    {['x', 'y', 'z'].map((axis, i) => {\r\n                                        const val = (a.position as any)[axis]?.toFixed(3) ?? (a.position as any)[i]?.toFixed(3)\r\n                                        return (\r\n                                            <div key={axis} className=\"flex items-center bg-black/20 rounded px-1\">\r\n                                                <span className=\"text-[8px] font-bold text-white/30 uppercase mr-1\">{axis}</span>\r\n                                                <input\r\n                                                    type=\"number\"\r\n                                                    step=\"0.01\"\r\n                                                    value={val}\r\n                                                    onChange={(e) => {\r\n                                                        // Garantir que estamos lidando com Vector3 para consistencia\r\n                                                        const newPos = (a.position as any).isVector3 ? a.position.clone() : new THREE.Vector3(a.position[0], a.position[1], a.position[2])\r\n                                                        const v = parseFloat(e.target.value)\r\n\r\n                                                        // Atualizar eixo correto\r\n                                                        if (axis === 'x') newPos.x = v\r\n                                                        if (axis === 'y') newPos.y = v\r\n                                                        if (axis === 'z') newPos.z = v\r\n\r\n                                                        useAnchorStore.getState().updateAnchorPosition(a.id, newPos)\r\n                                                    }}\r\n                                                    className=\"w-full bg-transparent border-none text-[9px] text-white font-mono focus:outline-none p-0 py-0.5\"\r\n                                                />\r\n                                            </div>\r\n                                        )\r\n                                    })}\r\n                                </div>\r\n                            </div>\r\n                        )\r\n                    })\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"mt-4 pt-4 border-t border-white/5 flex flex-col gap-2\">\r\n                <Button\r\n                    onClick={handleSave}\r\n                    disabled={isSaving || anchors.length === 0}\r\n                    className=\"w-full bg-green-600 hover:bg-green-700 text-white font-black uppercase text-[10px] tracking-widest h-10 shadow-glow-green flex items-center gap-2\"\r\n                >\r\n                    <Save className=\"w-3.5 h-3.5\" />\r\n                    {isSaving ? 'Salvando...' : 'Aplicar Configuração'}\r\n                </Button>\r\n\r\n                <div className=\"flex gap-2\">\r\n                    <Button\r\n                        onClick={handleExport}\r\n                        variant=\"outline\"\r\n                        className=\"flex-1 border-white/10 hover:bg-white/5 text-white/60 font-black uppercase text-[10px] tracking-widest h-10 flex items-center gap-2\"\r\n                    >\r\n                        <Download className=\"w-3.5 h-3.5\" />\r\n                        Exportar\r\n                    </Button>\r\n\r\n                    <Button\r\n                        onClick={() => fileInputRef.current?.click()}\r\n                        variant=\"outline\"\r\n                        className=\"flex-1 border-cyan-500/30 hover:bg-cyan-500/10 text-cyan-400 font-black uppercase text-[10px] tracking-widest h-10 flex items-center gap-2\"\r\n                    >\r\n                        <Upload className=\"w-3.5 h-3.5\" />\r\n                        Importar\r\n                    </Button>\r\n\r\n                    <input\r\n                        ref={fileInputRef}\r\n                        type=\"file\"\r\n                        accept=\".json\"\r\n                        onChange={handleImport}\r\n                        className=\"hidden\"\r\n                    />\r\n                </div>\r\n            </div>\r\n        </div >\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\scene\\Anchors.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\scene\\CameraSettingsPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\scene\\Model.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Center' is defined but never used.","line":1,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useEffect' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useGLTF, Center } from '@react-three/drei'\r\nimport { ThreeEvent } from '@react-three/fiber'\r\nimport { v4 as uuid } from 'uuid'\r\nimport { useAnchorStore } from '../../store/anchorStore'\r\nimport { useEffect } from 'react'\r\nexport function Model() {\r\n    const MODEL_URL = '/models/towers/scene.gltf'\r\n    const { scene } = useGLTF(MODEL_URL)\r\n    const addAnchor = useAnchorStore(s => s.addAnchor)\r\n\r\n\r\n    const handleClick = (e: ThreeEvent<PointerEvent>) => {\r\n        e.stopPropagation()\r\n\r\n        addAnchor({\r\n            id: uuid(),\r\n            position: e.point.clone(),\r\n            normal: e.face?.normal.clone(),\r\n            faceIndex: e.faceIndex ?? undefined,\r\n            meshName: e.object.name,\r\n            createdAt: new Date().toISOString()\r\n        })\r\n    }\r\n\r\n    return (\r\n        // Rotate 90 degrees on X to stand it up (fix orientation)\r\n        // Use Center to ensure it sits on the grid (ground level)\r\n        // Note: This is inside the Scene group which handles rotation, but Center handles the offset.\r\n        // If we rotate in Scene, we might not need rotation here, or we need to align axes.\r\n        // Actually, if Scene is rotated, Model is effectively upright.\r\n        // Center 'bottom' aligns the geometric bottom to 0.\r\n        <primitive object={scene} onPointerDown={handleClick} scale={1} position={[0, 1, 0]} />\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\scene\\Scene.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CameraView' is defined but never used.","line":6,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'view' is assigned a value but never used.","line":12,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":17},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'setCameraPosition'. Either include it or remove the dependency array.","line":60,"column":8,"nodeType":"ArrayExpression","endLine":60,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [setCameraPosition]","fix":{"range":[2630,2632],"text":"[setCameraPosition]"}}]},{"ruleId":"no-prototype-builtins","severity":2,"message":"Do not access Object.prototype method 'hasOwnProperty' from target object.","line":69,"column":30,"nodeType":"CallExpression","messageId":"prototypeBuildIn","endLine":69,"endColumn":44,"suggestions":[{"messageId":"callObjectPrototype","data":{"prop":"hasOwnProperty"},"fix":{"range":[2951,2979],"text":"Object.prototype.hasOwnProperty.call(keys.current, "},"desc":"Call Object.prototype.hasOwnProperty explicitly."}]},{"ruleId":"no-prototype-builtins","severity":2,"message":"Do not access Object.prototype method 'hasOwnProperty' from target object.","line":74,"column":30,"nodeType":"CallExpression","messageId":"prototypeBuildIn","endLine":74,"endColumn":44,"suggestions":[{"messageId":"callObjectPrototype","data":{"prop":"hasOwnProperty"},"fix":{"range":[3221,3249],"text":"Object.prototype.hasOwnProperty.call(keys.current, "},"desc":"Call Object.prototype.hasOwnProperty explicitly."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Canvas } from '@react-three/fiber'\r\nimport { CameraControls, GizmoHelper, GizmoViewcube, GizmoViewport } from '@react-three/drei'\r\nimport { useState, useEffect, useRef, Suspense } from 'react'\r\nimport { useFrame } from '@react-three/fiber'\r\nimport * as THREE from 'three'\r\nimport { useCameraStore, CameraView } from '@/store/useCameraStore'\r\nimport { Model } from './Model'\r\nimport { Anchors } from './Anchors'\r\nimport { CameraSettingsPanel } from './CameraSettingsPanel'\r\n\r\nfunction CameraController({ enabled }: { enabled: boolean }) {\r\n    const { view, zoomToCursor, cameraPosition, setCameraPosition, sensitivity } = useCameraStore()\r\n    const cameraControlsRef = useRef<CameraControls>(null)\r\n    const [isCtrlPressed, setIsCtrlPressed] = useState(false)\r\n    const isUpdatingRef = useRef(false)\r\n\r\n    // Sync Store -> Camera (Code-driven update)\r\n    useEffect(() => {\r\n        const controls = cameraControlsRef.current\r\n        if (!controls) return\r\n\r\n        const currentPos = new THREE.Vector3()\r\n        controls.getPosition(currentPos)\r\n\r\n        // Only update if difference is significant (> 0.01m)\r\n        const dist = currentPos.distanceTo(new THREE.Vector3(cameraPosition.x, cameraPosition.y, cameraPosition.z))\r\n        if (dist > 0.1) {\r\n            isUpdatingRef.current = true\r\n            controls.setPosition(cameraPosition.x, cameraPosition.y, cameraPosition.z, true).then(() => {\r\n                isUpdatingRef.current = false\r\n            })\r\n        }\r\n    }, [cameraPosition])\r\n\r\n    // Sync Camera -> Store (User-driven update)\r\n    useEffect(() => {\r\n        const controls = cameraControlsRef.current\r\n        if (!controls) return\r\n\r\n        const onUpdate = () => {\r\n            // Block if we are currently syncing from store to camera\r\n            if (isUpdatingRef.current) return\r\n\r\n            const pos = new THREE.Vector3()\r\n            controls.getPosition(pos)\r\n\r\n            // Use getState() to always have the latest reference for comparison without dependency thrashing\r\n            const latestPos = useCameraStore.getState().cameraPosition\r\n            const currentPosVec = new THREE.Vector3(pos.x, pos.y, pos.z)\r\n            const latestPosVec = new THREE.Vector3(latestPos.x, latestPos.y, latestPos.z)\r\n\r\n            // Only update store if difference is significant\r\n            if (currentPosVec.distanceTo(latestPosVec) > 0.05) {\r\n                setCameraPosition({ x: pos.x, y: pos.y, z: pos.z })\r\n            }\r\n        }\r\n\r\n        controls.addEventListener('update', onUpdate)\r\n        return () => controls.removeEventListener('update', onUpdate)\r\n    }, []) // Stable listener\r\n\r\n    // WASD Fly Controls\r\n    const keys = useRef({ w: false, a: false, s: false, d: false })\r\n\r\n    useEffect(() => {\r\n        const handleKeyDown = (e: KeyboardEvent) => {\r\n            if (e.key === 'Control') setIsCtrlPressed(true)\r\n            const k = e.key.toLowerCase()\r\n            if (keys.current.hasOwnProperty(k)) keys.current[k as keyof typeof keys.current] = true\r\n        }\r\n        const handleKeyUp = (e: KeyboardEvent) => {\r\n            if (e.key === 'Control') setIsCtrlPressed(false)\r\n            const k = e.key.toLowerCase()\r\n            if (keys.current.hasOwnProperty(k)) keys.current[k as keyof typeof keys.current] = false\r\n        }\r\n\r\n        window.addEventListener('keydown', handleKeyDown)\r\n        window.addEventListener('keyup', handleKeyUp)\r\n\r\n        return () => {\r\n            window.removeEventListener('keydown', handleKeyDown)\r\n            window.removeEventListener('keyup', handleKeyUp)\r\n        }\r\n    }, [])\r\n\r\n    useFrame((_, delta) => {\r\n        const controls = cameraControlsRef.current\r\n        if (!controls || !enabled) return\r\n\r\n        const speed = isCtrlPressed ? 20 : 10 // Faster with Ctrl (or Shift?) usually Shift. User used Ctrl for Dolly mode, sticking to simple speed.\r\n        // Actually, let's use Ctrl for speed boost if not conflicting? \r\n        // Current config uses Ctrl+LeftClick for Dolly.\r\n        // WASD usage:\r\n        const moveSpeed = speed * delta\r\n\r\n        if (keys.current.w) controls.forward(moveSpeed, true)\r\n        if (keys.current.s) controls.forward(-moveSpeed, true)\r\n        if (keys.current.d) controls.truck(moveSpeed, 0, true)\r\n        if (keys.current.a) controls.truck(-moveSpeed, 0, true)\r\n    })\r\n\r\n    return (\r\n        <CameraControls\r\n            ref={cameraControlsRef}\r\n            enabled={enabled}\r\n            makeDefault\r\n            minPolarAngle={0}\r\n            maxPolarAngle={Math.PI / 2}\r\n            azimuthRotateSpeed={sensitivity.rotate}\r\n            polarRotateSpeed={sensitivity.rotate}\r\n            dollySpeed={sensitivity.dolly}\r\n            truckSpeed={sensitivity.truck}\r\n            dollyToCursor={zoomToCursor}\r\n            minDistance={0.1}\r\n            maxDistance={Infinity}\r\n            mouseButtons={{\r\n                left: isCtrlPressed ? 8 : 2, // 8=DOLLY (Ctrl+Click), 2=TRUCK (Pan)\r\n                right: 1, // ACTION.ROTATE (Right Click Orbit) - CONFIRMED\r\n                middle: 0, // ACTION.NONE\r\n                wheel: 8 // ACTION.DOLLY\r\n            }}\r\n            touches={{\r\n                one: 32, // ACTION.TOUCH_ROTATE\r\n                two: 512, // ACTION.TOUCH_DOLLY_TRUCK\r\n                three: 128 // ACTION.TOUCH_TRUCK\r\n            }}\r\n            smoothTime={0.2}\r\n        />\r\n    )\r\n}\r\n\r\nexport function Scene() {\r\n    const [controlsEnabled, setControlsEnabled] = useState(true)\r\n    const projection = useCameraStore(state => state.projection)\r\n\r\n    return (\r\n        <div className=\"relative w-full h-full bg-zinc-950\">\r\n            <Canvas\r\n                shadows\r\n                camera={{ position: [10, -10, 8], fov: 45, up: [0, 0, 1] }}\r\n                gl={{ antialias: true }}\r\n                orthographic={projection === 'orthographic'}\r\n            >\r\n                <Suspense fallback={null}>\r\n                    {/* Unified Group for Model + Anchors */}\r\n                    {/* Rotate 90deg X to stand upright (Y-up to Z-up) */}\r\n                    <group rotation={[Math.PI / 2, 0, 0]}>\r\n                        <Model />\r\n                    </group>\r\n                    {/* Anchors stay in World Space (Z-up) to avoid double rotation */}\r\n                    <Anchors />\r\n                </Suspense>\r\n\r\n                <CameraController enabled={controlsEnabled} />\r\n\r\n                <GizmoHelper\r\n                    alignment=\"bottom-right\"\r\n                    margin={[80, 80]}\r\n                    renderPriority={1}\r\n                >\r\n                    <group\r\n                        onPointerEnter={() => setControlsEnabled(false)}\r\n                        onPointerLeave={() => setControlsEnabled(true)}\r\n                    >\r\n                        <GizmoViewcube\r\n                            font=\"bold 24px Inter\"\r\n                            color=\"#18181b\"\r\n                            strokeColor=\"#eab308\"\r\n                            textColor=\"#ffffff\"\r\n                            hoverColor=\"#facc15\"\r\n                            opacity={0.9}\r\n                            // Remapped for Z-up (Mapbox standard)\r\n                            faces={['DIREITA', 'ESQUERDA', 'BAIXO', 'TOPO', 'FRENTE', 'TRÁS']}\r\n                        />\r\n                    </group>\r\n                </GizmoHelper>\r\n\r\n                {/* Eixos RGB (X=Red, Y=Green, Z=Blue) no canto inferior esquerdo */}\r\n                <GizmoHelper alignment=\"bottom-left\" margin={[80, 140]}>\r\n                    <GizmoViewport\r\n                        axisColors={['#ef4444', '#22c55e', '#3b82f6']}\r\n                        labelColor=\"white\"\r\n                    />\r\n                </GizmoHelper>\r\n\r\n                <ambientLight intensity={0.7} />\r\n                <directionalLight position={[10, 10, 10]} intensity={1.2} castShadow />\r\n                <hemisphereLight intensity={0.4} groundColor=\"#000000\" />\r\n\r\n                {/* Base Grid - XY Plane (Z-up) */}\r\n                <gridHelper args={[100, 100, 0x444444, 0x222222]} rotation={[Math.PI / 2, 0, 0]} />\r\n            </Canvas>\r\n            <CameraSettingsPanel />\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\shared\\BackgroundMonitor.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2027,2030],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2027,2030],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect } from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { storageService } from '@/services/storageService';\r\n\r\nexport function BackgroundMonitor() {\r\n    const { user, profile } = useAuth();\r\n\r\n    useEffect(() => {\r\n        if (!user) return;\r\n\r\n        // Monitoramento de Localização contínuo usando watchPosition\r\n        let watchId: number | null = null;\r\n\r\n        if ('geolocation' in navigator) {\r\n            watchId = navigator.geolocation.watchPosition(\r\n                (position) => {\r\n                    const loc = {\r\n                        lat: position.coords.latitude,\r\n                        lng: position.coords.longitude,\r\n                        accuracy: position.coords.accuracy,\r\n                        timestamp: new Date().toISOString()\r\n                    };\r\n                    storageService.setItem('last_known_location', loc);\r\n                    console.debug('Background Location Sync (Watch):', loc);\r\n                },\r\n                (error: GeolocationPositionError) => {\r\n                    console.warn('Background Location Error:', error.message);\r\n                },\r\n                {\r\n                    enableHighAccuracy: false, // Modo econômico\r\n                    timeout: 10000,\r\n                    maximumAge: 30000 // Aceita cache de 30s\r\n                }\r\n            );\r\n        }\r\n\r\n        // Persistência de Sessão e Perfil (a cada 10 segundos para redundância)\r\n        const sessionInterval = setInterval(async () => {\r\n            if (user && profile) {\r\n                // Garantir que os dados mais recentes estejam sempre no cache offline\r\n                await storageService.setItem('offline_auth_snapshot', {\r\n                    user,\r\n                    profile,\r\n                    timestamp: new Date().toISOString()\r\n                });\r\n\r\n                // Também atualizar o cache de login offline unificado se necessário\r\n                const offlineLogins = await storageService.getItem<any[]>('offline_login_cache') || [];\r\n                const existingIndex = offlineLogins.findIndex(l => l.profile?.id === profile.id);\r\n\r\n                if (existingIndex !== -1) {\r\n                    offlineLogins[existingIndex].profile = profile;\r\n                    await storageService.setItem('offline_login_cache', offlineLogins);\r\n                }\r\n            }\r\n        }, 10000);\r\n\r\n        return () => {\r\n            if (watchId !== null) navigator.geolocation.clearWatch(watchId);\r\n            clearInterval(sessionInterval);\r\n        };\r\n    }, [user, profile]);\r\n\r\n    return null; // Componente invisível de serviço\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\shared\\ConfirmationDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\shared\\ConnectionBanner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\shared\\PermissionsModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2338,2341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2338,2341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2455,2458],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2455,2458],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2571,2574],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2571,2574],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2690,2693],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2690,2693],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2820,2823],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2820,2823],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2885,2888],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2885,2888],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2945,2948],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2945,2948],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3017,3020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3017,3020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":68,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":68,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":132,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6181,6184],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6181,6184],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Switch } from '@/components/ui/switch';\r\nimport { Camera, MapPin, Mic, Bell, X, Loader2 } from 'lucide-react';\r\nimport { storageService } from '@/services/storageService';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\ninterface PermissionItemProps {\r\n    icon: React.ReactNode;\r\n    title: string;\r\n    description: string;\r\n    onToggle: (checked: boolean) => void;\r\n    checked: boolean;\r\n    loading?: boolean;\r\n}\r\n\r\nconst PermissionItem = ({ icon, title, description, onToggle, checked, loading }: PermissionItemProps) => (\r\n    <div className=\"flex items-start gap-4 py-4\">\r\n        <div className=\"p-2 rounded-xl bg-primary/10 text-primary\">\r\n            {icon}\r\n        </div>\r\n        <div className=\"flex-1 space-y-1\">\r\n            <h4 className=\"font-bold text-[#7C3AED] text-sm leading-none\">{title}</h4>\r\n            <p className=\"text-[10px] text-muted-foreground leading-snug\">{description}</p>\r\n        </div>\r\n        <div className=\"flex items-center gap-2\">\r\n            {loading && <Loader2 className=\"w-4 h-4 text-primary animate-spin\" />}\r\n            <Switch\r\n                checked={checked}\r\n                onCheckedChange={onToggle}\r\n                disabled={loading || checked}\r\n                className=\"data-[state=checked]:bg-primary\"\r\n            />\r\n        </div>\r\n    </div>\r\n);\r\n\r\nexport function PermissionsModal() {\r\n    const { toast } = useToast();\r\n    const [open, setOpen] = React.useState(false);\r\n    const [isLoading, setIsLoading] = React.useState<Record<string, boolean>>({});\r\n    const [perms, setPerms] = React.useState({\r\n        camera: false,\r\n        location: false,\r\n        mic: false,\r\n        notifications: false\r\n    });\r\n\r\n    const checkCurrentPermissions = React.useCallback(async () => {\r\n        if (navigator.permissions && navigator.permissions.query) {\r\n            try {\r\n                // Wrap queries in a helper to handle potential prompt-triggering behavior in some browsers\r\n                // though query() itself shouldn't prompt.\r\n                const [cam, loc, mic, notif] = await Promise.all([\r\n                    navigator.permissions.query({ name: 'camera' as any }).catch(() => ({ state: 'prompt' })),\r\n                    navigator.permissions.query({ name: 'geolocation' as any }).catch(() => ({ state: 'prompt' })),\r\n                    navigator.permissions.query({ name: 'microphone' as any }).catch(() => ({ state: 'prompt' })),\r\n                    navigator.permissions.query({ name: 'notifications' as any }).catch(() => ({ state: 'prompt' }))\r\n                ]);\r\n\r\n                setPerms({\r\n                    camera: (cam as any).state === 'granted',\r\n                    location: (loc as any).state === 'granted',\r\n                    mic: (mic as any).state === 'granted',\r\n                    notifications: (notif as any).state === 'granted'\r\n                });\r\n            } catch (e) {\r\n                console.warn('Permission query not fully supported');\r\n            }\r\n        }\r\n    }, []);\r\n\r\n    React.useEffect(() => {\r\n        const check = async () => {\r\n            const acknowledged = await storageService.getItem('permissions_acknowledged');\r\n            if (!acknowledged) {\r\n                setOpen(true);\r\n            }\r\n            await checkCurrentPermissions();\r\n        };\r\n        check();\r\n\r\n        // Listen for global trigger\r\n        const handleForceOpen = () => setOpen(true);\r\n        window.addEventListener('open-permissions-modal', handleForceOpen);\r\n        return () => window.removeEventListener('open-permissions-modal', handleForceOpen);\r\n    }, [checkCurrentPermissions]);\r\n\r\n    const handleToggle = async (type: keyof typeof perms) => {\r\n        if (perms[type] || isLoading[type]) return;\r\n\r\n        setIsLoading(prev => ({ ...prev, [type]: true }));\r\n        try {\r\n            if (type === 'camera') {\r\n                const stream = await navigator.mediaDevices.getUserMedia({ video: true });\r\n                stream.getTracks().forEach(t => t.stop());\r\n                setPerms(prev => ({ ...prev, camera: true }));\r\n                toast({ title: 'Câmera permitida', description: 'Acesso autorizado com sucesso.' });\r\n            } else if (type === 'location') {\r\n                // Use a promise with timeout for geolocation as it's the most likely to hang\r\n                await new Promise<void>((resolve, reject) => {\r\n                    const timeout = setTimeout(() => reject(new Error('TIMEOUT')), 10000);\r\n                    navigator.geolocation.getCurrentPosition(\r\n                        () => {\r\n                            clearTimeout(timeout);\r\n                            setPerms(prev => ({ ...prev, location: true }));\r\n                            resolve();\r\n                        },\r\n                        (err) => {\r\n                            clearTimeout(timeout);\r\n                            reject(err);\r\n                        },\r\n                        { enableHighAccuracy: false, timeout: 8000 }\r\n                    );\r\n                });\r\n                toast({ title: 'Localização permitida', description: 'Coordenadas autorizadas.' });\r\n            } else if (type === 'mic') {\r\n                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n                stream.getTracks().forEach(t => t.stop());\r\n                setPerms(prev => ({ ...prev, mic: true }));\r\n                toast({ title: 'Microfone permitido', description: 'Acesso autorizado com sucesso.' });\r\n            } else if (type === 'notifications') {\r\n                const res = await Notification.requestPermission();\r\n                setPerms(prev => ({ ...prev, notifications: res === 'granted' }));\r\n                if (res === 'granted') {\r\n                    toast({ title: 'Notificações permitidas', description: 'Você receberá alertas do app.' });\r\n                } else {\r\n                    throw new Error('DENIED');\r\n                }\r\n            }\r\n    } catch (err: any) {\r\n            console.error(`Error requesting ${type} permission:`, err);\r\n            let message = 'Não foi possível autorizar a permissão.';\r\n\r\n            if (type === 'location' && err.code === 1) {\r\n                message = 'Acesso negado no navegador. Clique no ícone de cadeado (barra de endereço) para permitir.';\r\n            } else if (err.message === 'TIMEOUT') {\r\n                message = 'A busca de localização demorou muito. Tente novamente em um local aberto.';\r\n            } else if (err.name === 'NotAllowedError' || err.message === 'DENIED') {\r\n                const label = type === 'notifications' ? 'notificações' : type === 'camera' ? 'câmera' : 'microfone';\r\n                message = `O acesso às ${label} foi negado. Verifique as configurações do cadeado no seu navegador.`;\r\n            }\r\n\r\n            toast({\r\n                title: `Acesso negado: ${type === 'location' ? 'Localização' : type}`,\r\n                description: message,\r\n                variant: 'destructive'\r\n            });\r\n        } finally {\r\n            setIsLoading(prev => ({ ...prev, [type]: false }));\r\n            // Re-check just in case the state didn't update as expected\r\n            await checkCurrentPermissions();\r\n        }\r\n    };\r\n\r\n    const handleClose = async () => {\r\n        await storageService.setItem('permissions_acknowledged', true);\r\n        setOpen(false);\r\n    };\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={setOpen}>\r\n            <DialogContent className=\"sm:max-w-md p-0 overflow-hidden border-none bg-background rounded-[2.5rem] shadow-2xl\">\r\n                <div className=\"p-8 space-y-8 max-h-[90vh] overflow-y-auto\">\r\n                    <DialogHeader className=\"text-center space-y-3 pt-4 relative\">\r\n                        <button\r\n                            onClick={handleClose}\r\n                            className=\"absolute right-0 top-0 p-2 text-muted-foreground hover:text-foreground transition-colors\"\r\n                        >\r\n                            <X className=\"w-5 h-5\" />\r\n                        </button>\r\n                        <DialogTitle className=\"text-3xl font-black tracking-tight text-foreground\">Bem-vindo!</DialogTitle>\r\n                        <p className=\"text-[13px] text-center text-muted-foreground font-medium px-4\">\r\n                            Antes de começar por favor conceda as seguintes permissões ao aplicativo:\r\n                        </p>\r\n                    </DialogHeader>\r\n\r\n                    <div className=\"space-y-2 divide-y divide-white/5\">\r\n                        <PermissionItem\r\n                            icon={<Camera className=\"w-5 h-5\" />}\r\n                            title=\"Uso da câmera\"\r\n                            description=\"Para registrar uma foto do colaborador ao bater ponto\"\r\n                            checked={perms.camera}\r\n                            loading={isLoading.camera}\r\n                            onToggle={() => handleToggle('camera')}\r\n                        />\r\n                        <PermissionItem\r\n                            icon={<MapPin className=\"w-5 h-5\" />}\r\n                            title=\"Localização\"\r\n                            description=\"Para registrar o local exato dos pontos batidos\"\r\n                            checked={perms.location}\r\n                            loading={isLoading.location}\r\n                            onToggle={() => handleToggle('location')}\r\n                        />\r\n                        <PermissionItem\r\n                            icon={<Mic className=\"w-5 h-5\" />}\r\n                            title=\"Uso do microfone\"\r\n                            description=\"Para gravar e guardar áudio dos pontos batidos\"\r\n                            checked={perms.mic}\r\n                            loading={isLoading.mic}\r\n                            onToggle={() => handleToggle('mic')}\r\n                        />\r\n                        <PermissionItem\r\n                            icon={<Bell className=\"w-5 h-5\" />}\r\n                            title=\"Uso das notificações\"\r\n                            description=\"Para enviar notificações de lembrete de ponto e outras informações importantes\"\r\n                            checked={perms.notifications}\r\n                            loading={isLoading.notifications}\r\n                            onToggle={() => handleToggle('notifications')}\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"pt-4\">\r\n                        <Button\r\n                            onClick={handleClose}\r\n                            className=\"w-full h-16 rounded-full bg-[#F5F3F7] hover:bg-[#EBE7F0] text-[#7C3AED] font-bold text-lg shadow-none\"\r\n                        >\r\n                            {Object.values(perms).every(p => p) ? 'Começar Agora' : 'Permitir depois'}\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\shared\\ProjectEmptyState.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'HardHat' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { HardHat, Plus, Upload, Users, MapPin, Construction, AlertCircle } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface ProjectEmptyStateProps {\r\n    title: string;\r\n    description: string;\r\n    type: 'towers' | 'sites' | 'workers' | 'generic';\r\n    onAction?: () => void;\r\n    onSecondaryAction?: () => void;\r\n    actionLabel?: string;\r\n    secondaryActionLabel?: string;\r\n    className?: string;\r\n    hideAction?: boolean;\r\n}\r\n\r\nexport function ProjectEmptyState({\r\n    title,\r\n    description,\r\n    type,\r\n    onAction,\r\n    onSecondaryAction,\r\n    actionLabel,\r\n    secondaryActionLabel,\r\n    className,\r\n    hideAction\r\n}: ProjectEmptyStateProps) {\r\n    const getIcon = () => {\r\n        switch (type) {\r\n            case 'towers': return <Construction className=\"w-12 h-12 text-primary\" />;\r\n            case 'sites': return <MapPin className=\"w-12 h-12 text-amber-500\" />;\r\n            case 'workers': return <Users className=\"w-12 h-12 text-sky-500\" />;\r\n            default: return <AlertCircle className=\"w-12 h-12 text-primary\" />;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Card className={cn(\"bg-black/40 border-white/5 backdrop-blur-xl border-dashed border-2 py-12 px-6 text-center shadow-2xl overflow-hidden relative group\", className)}>\r\n            {/* Background Glow */}\r\n            <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-primary/10 rounded-full blur-[100px] group-hover:bg-primary/20 transition-all duration-700\" />\r\n\r\n            <CardContent className=\"relative flex flex-col items-center gap-6\">\r\n                <div className=\"p-5 rounded-3xl bg-white/5 border border-white/10 shadow-inner group-hover:scale-110 transition-transform duration-500\">\r\n                    {getIcon()}\r\n                </div>\r\n\r\n                <div className=\"space-y-2 max-w-sm\">\r\n                    <h3 className=\"text-xl font-black tracking-tight text-foreground uppercase italic\">{title}</h3>\r\n                    <p className=\"text-sm text-muted-foreground font-medium leading-relaxed\">\r\n                        {description}\r\n                    </p>\r\n                </div>\r\n\r\n                <div className=\"flex flex-wrap items-center justify-center gap-3 mt-2\">\r\n                    {onAction && !hideAction && (\r\n                        <Button\r\n                            onClick={onAction}\r\n                            className=\"gradient-primary text-primary-foreground font-black uppercase tracking-wider h-11 px-6 rounded-xl shadow-lg shadow-primary/20 hover:shadow-primary/40 hover:scale-[1.05] active:scale-95 transition-all text-xs\"\r\n                        >\r\n                            <Plus className=\"w-4 h-4 mr-2\" />\r\n                            {actionLabel || 'Adicionar Novo'}\r\n                        </Button>\r\n                    )}\r\n\r\n                    {onSecondaryAction && (\r\n                        <Button\r\n                            variant=\"outline\"\r\n                            onClick={onSecondaryAction}\r\n                            className=\"border-white/10 bg-white/5 hover:bg-white/10 text-foreground font-bold uppercase tracking-widest h-11 px-6 rounded-xl text-[10px] transition-all\"\r\n                        >\r\n                            <Upload className=\"w-4 h-4 mr-2 text-primary\" />\r\n                            {secondaryActionLabel || 'Importar Dados'}\r\n                        </Button>\r\n                    )}\r\n                </div>\r\n            </CardContent>\r\n        </Card>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\shared\\ProjectSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\su\\SUDocumentHub.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useEffect' is defined but never used.","line":1,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Filter' is defined but never used.","line":9,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'HistoryIcon' is defined but never used.","line":9,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":63},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ShieldCheck' is defined but never used.","line":10,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Activity' is defined but never used.","line":10,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Archive' is defined but never used.","line":10,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Edit2' is defined but never used.","line":10,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Star' is defined but never used.","line":10,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Shield' is defined but never used.","line":11,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":11},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1868,1871],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1868,1871],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":53,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":53,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3688,3691],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3688,3691],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3758,3761],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3758,3761],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3847,3850],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3847,3850],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":92,"column":21,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":92,"endColumn":34,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[4591,4604],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":248,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":248,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10527,10530],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10527,10530],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":259,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":259,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11203,11206],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11203,11206],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":319,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":319,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13685,13688],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13685,13688],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":18,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useConstructionDocuments } from '@/hooks/useConstructionDocuments';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Input } from '@/components/ui/input';\r\nimport {\r\n    FileText, Upload, Filter, Download, History as HistoryIcon,\r\n    ShieldCheck, Activity, Archive, Edit2, Trash2, Star, Zap, Eye,\r\n    Shield, FolderInput\r\n} from 'lucide-react';\r\nimport { format } from 'date-fns';\r\nimport { DocumentSidebar, type FileNode } from '../gapo/file-explorer/document-sidebar';\r\nimport { toast } from 'sonner';\r\nimport { db } from '@/integrations/database';\r\nimport { useDownloadQueue } from '@/hooks/useDownloadQueue';\r\nimport { FolderPermissionsModal } from './permission-modal';\r\n\r\nexport default function SUDocumentHub() {\r\n    // No projectId or siteId passed = Global SU Documents\r\n    const { documents, isLoading, uploadDocument, updateDocument, downloadDocument, previewDocument, createFolder, deleteDocument, refresh } = useConstructionDocuments();\r\n    const { addToQueue, isProcessing, currentDownload, queueLength } = useDownloadQueue(downloadDocument);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [selectedFile, setSelectedFile] = useState<FileNode | null>(null);\r\n    const [selectedDocIds, setSelectedDocIds] = useState<string[]>([]);\r\n    const [lastSelectedId, setLastSelectedId] = useState<string | null>(null);\r\n    const fileInputRef = React.useRef<HTMLInputElement>(null);\r\n    const [permissionModalOpen, setPermissionModalOpen] = useState(false);\r\n    const [contextFolder, setContextFolder] = useState<any>(null);\r\n\r\n    // Manual creation of base structure\r\n    const handleCreateBaseStructure = async () => {\r\n        if (!window.confirm(\"Deseja criar a estrutura de pastas padrão (Empresa, Obra, Canteiro)?\")) return;\r\n\r\n        const structure = [\r\n            { name: '01. Empresa', path: '/' },\r\n            { name: '02. Obra', path: '/' },\r\n            { name: '03. Canteiro', path: '/' }\r\n        ];\r\n\r\n        toast.loading(\"Criando estrutura base...\");\r\n        try {\r\n            for (const item of structure) {\r\n                // Check if exists to avoid duplicates/errors\r\n                const exists = documents.some(d => d.fileUrl === 'folder' && d.name === item.name);\r\n                if (!exists) {\r\n                    await createFolder(item.name, item.path);\r\n                }\r\n            }\r\n            toast.dismiss();\r\n            toast.success(\"Estrutura criada com sucesso!\");\r\n        } catch (error) {\r\n            toast.dismiss();\r\n            toast.error(\"Erro ao criar estrutura.\");\r\n        }\r\n    };\r\n\r\n    const handleOrganizeRoot = async () => {\r\n        const rootFiles = documents.filter(d => d.folderPath === '/' && d.fileUrl !== 'folder');\r\n        if (rootFiles.length === 0) {\r\n            toast.info(\"A raiz já está organizada! Nenhum arquivo solto encontrado.\");\r\n            return;\r\n        }\r\n\r\n        const confirmOrganize = window.confirm(`Encontrei ${rootFiles.length} arquivos soltos. Deseja organizá-los automaticamente nas pastas Empresa/Obra/Canteiro com base no contexto?`);\r\n        if (!confirmOrganize) return;\r\n\r\n        toast.loading(\"Analisando e organizando arquivos...\");\r\n\r\n        try {\r\n            // Prioridade: Mais específico (Site) -> Menos específico (Empresa)\r\n            const structure = [\r\n                { name: '03. Canteiro', match: (d: any) => !!d.siteId },\r\n                { name: '02. Obra', match: (d: any) => !!d.projectId && !d.siteId },\r\n                { name: '01. Empresa', match: (d: any) => !d.projectId && !d.siteId }\r\n            ];\r\n\r\n            let movedCount = 0;\r\n            const processedIds = new Set<string>();\r\n\r\n            for (const target of structure) {\r\n                // Filter files that match criteria AND haven't been processed yet\r\n                const filesToMove = rootFiles.filter(d => target.match(d) && !processedIds.has(d.id));\r\n\r\n                if (filesToMove.length === 0) continue;\r\n\r\n                // Find or create target folder\r\n                let folderNode = documents.find(d => d.fileUrl === 'folder' && d.name === target.name && d.folderPath === '/');\r\n                if (!folderNode) {\r\n                    const res = await createFolder(target.name, '/');\r\n                    // @ts-ignore\r\n                    if (res?.data) folderNode = res.data;\r\n                }\r\n\r\n                if (folderNode) {\r\n                    const newPath = `/${folderNode.id}/`;\r\n                    for (const file of filesToMove) {\r\n                        await updateDocument(file.id, { folderPath: newPath });\r\n                        processedIds.add(file.id);\r\n                        movedCount++;\r\n                    }\r\n                }\r\n            }\r\n\r\n            toast.dismiss();\r\n            toast.success(`${movedCount} arquivos organizados por contexto!`);\r\n            refresh();\r\n\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.dismiss();\r\n            toast.error(\"Erro ao organizar arquivos.\");\r\n        }\r\n    };\r\n\r\n    const handleNewFile = () => {\r\n        fileInputRef.current?.click();\r\n    };\r\n\r\n    const handleFileChange = async (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = event.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        toast.promise(uploadDocument(file, {}), {\r\n            loading: 'Enviando documento SU...',\r\n            success: 'Documento enviado com sucesso!',\r\n            error: 'Erro ao enviar documento'\r\n        });\r\n\r\n        if (fileInputRef.current) fileInputRef.current.value = '';\r\n    };\r\n\r\n    const MAX_EXPORT_FILES = 20;\r\n    const MAX_EXPORT_SIZE_MB = 100;\r\n\r\n    const handleExportAll = () => {\r\n        const filesToExport = documents.filter(d => d.fileUrl !== 'folder');\r\n        if (filesToExport.length === 0) {\r\n            toast.error(\"Nenhum documento para exportar.\");\r\n            return;\r\n        }\r\n\r\n        if (filesToExport.length > MAX_EXPORT_FILES) {\r\n            toast.error(`Muitos arquivos (${filesToExport.length}). Limite: ${MAX_EXPORT_FILES}`);\r\n            return;\r\n        }\r\n\r\n        const totalSize = filesToExport.reduce((acc, d) => acc + (d.fileSize || 0), 0);\r\n        if (totalSize / (1024 * 1024) > MAX_EXPORT_SIZE_MB) {\r\n            toast.error(\"Tamanho total excede o limite de 100MB.\");\r\n            return;\r\n        }\r\n\r\n        // toast.success(`Exportando ${filesToExport.length} itens...`);\r\n        addToQueue(filesToExport);\r\n    };\r\n\r\n    const handleBulkDownload = () => {\r\n        const selectedDocs = documents.filter(d => selectedDocIds.includes(d.id) && d.fileUrl !== 'folder');\r\n        if (selectedDocs.length === 0) return;\r\n\r\n        if (selectedDocs.length > MAX_EXPORT_FILES) {\r\n            toast.error(`Selecione no máximo ${MAX_EXPORT_FILES} arquivos.`);\r\n            return;\r\n        }\r\n\r\n        const totalSize = selectedDocs.reduce((acc, d) => acc + (d.fileSize || 0), 0);\r\n        if (totalSize / (1024 * 1024) > MAX_EXPORT_SIZE_MB) {\r\n            toast.error(\"Tamanho selecionado excede 100MB.\");\r\n            return;\r\n        }\r\n\r\n        // toast.success(`Baixando ${selectedDocs.length} itens...`);\r\n        addToQueue(selectedDocs);\r\n    };\r\n\r\n    const handleNewFolder = async () => {\r\n        const folderName = window.prompt(\"Digite o nome da nova pasta:\");\r\n        if (folderName) {\r\n            await createFolder(folderName, selectedFile?.type === 'folder' ? `${selectedFile.id}/` : '/');\r\n        }\r\n    };\r\n\r\n    const handleSmartFolder = async (parentId: string, templateType: string = 'Padrao') => {\r\n        const templates: Record<string, string[]> = {\r\n            'template-su': ['Políticas', 'Manuais', 'Compliance', 'Certificados'],\r\n            'template-niveis': ['Diretoria', 'Gerência', 'Operacional', 'TI'],\r\n            'Padrao': ['Docs', 'Configs', 'Backups']\r\n        };\r\n\r\n        const folders = templates[parentId] || templates[templateType] || templates['Padrao'];\r\n        const path = parentId.startsWith('template-') ? '/' : `/${parentId}/`;\r\n\r\n        toast.loading(\"Criando estrutura SU...\");\r\n        for (const name of folders) {\r\n            await createFolder(name, path);\r\n        }\r\n        toast.dismiss();\r\n        toast.success(\"Estrutura SU criada!\");\r\n    };\r\n\r\n    const handleSidebarAction = (action: string, node: FileNode) => {\r\n        const doc = documents.find(d => d.id === node.id);\r\n\r\n        if (action === \"Abrir\") {\r\n            if (node.type === 'file') {\r\n                setSelectedFile(node);\r\n                if (doc) previewDocument(doc);\r\n            } else {\r\n                setSelectedFile(node);\r\n                toast.info(`Nível/Pasta \"${node.name}\" selecionado`);\r\n            }\r\n        } else if (action === \"Visualizar\") {\r\n            if (doc) previewDocument(doc);\r\n        } else if (action === \"Renomear\") {\r\n            if (doc) {\r\n                const newName = window.prompt(\"Novo nome:\", doc.name);\r\n                if (newName && newName !== doc.name) {\r\n                    toast.promise(updateDocument(doc.id, { name: newName }), {\r\n                        loading: 'Renomeando...',\r\n                        success: 'Sucesso!',\r\n                        error: 'Erro'\r\n                    });\r\n                }\r\n            }\r\n        } else if (action === \"Informações\") {\r\n            if (doc) {\r\n                const info = `Nome: ${doc.name}\\nCaminho: ${doc.folderPath}\\nModificado: ${format(new Date(doc.updatedAt), 'dd/MM/yyyy HH:mm')}`;\r\n                window.alert(info);\r\n            }\r\n        } else if (action === \"Excluir\") {\r\n            if (window.confirm(`Excluir \"${node.name}\"?`)) {\r\n                deleteDocument(node.id, doc?.fileUrl);\r\n            }\r\n        } else if (action === \"Nova Pasta Inteligente\") {\r\n            handleSmartFolder(node.id, node.name);\r\n        } else if (action === \"Mover para Raiz\") {\r\n            handleMove(node.id, \"root\");\r\n        } else if (action === \"Permissões\") {\r\n            if (doc) {\r\n                setContextFolder(doc);\r\n                setPermissionModalOpen(true);\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleSavePermissions = async (docId: string, permissions: any) => {\r\n        const standardFolders = ['01. Empresa', '02. Obra', '03. Canteiro'];\r\n        const isStandard = standardFolders.includes(contextFolder.name);\r\n        const updates = { metadata: { ...contextFolder.metadata, ...permissions } };\r\n\r\n        if (isStandard) {\r\n            const confirmSync = window.confirm(`Esta é uma pasta padrão. Deseja aplicar estas permissões para TODAS as pastas \"${contextFolder.name}\" em todos os projetos?`);\r\n\r\n            if (confirmSync) {\r\n                toast.loading(`Sincronizando permissões para ${contextFolder.name}...`);\r\n                const { error } = await db\r\n                    .from('construction_documents' as any)\r\n                    .update(updates)\r\n                    .eq('file_url', 'folder')\r\n                    .eq('name', contextFolder.name);\r\n\r\n                if (error) {\r\n                    toast.dismiss();\r\n                    toast.error(\"Erro ao sincronizar permissões.\");\r\n                } else {\r\n                    toast.dismiss();\r\n                    toast.success(\"Permissões sincronizadas globalmente!\");\r\n                    refresh();\r\n                }\r\n                return;\r\n            }\r\n        }\r\n\r\n        await updateDocument(docId, updates);\r\n    };\r\n\r\n    const handleMove = async (sourceId: string, targetId: string) => {\r\n        const newPath = targetId === 'root' || !targetId ? '/' : `/${targetId}/`;\r\n        toast.promise(updateDocument(sourceId, { folderPath: newPath }), {\r\n            loading: 'Movendo...',\r\n            success: 'Movido!',\r\n            error: 'Erro'\r\n        });\r\n    };\r\n\r\n    const handleRowClick = (e: React.MouseEvent, docId: string) => {\r\n        if ((e.target as HTMLElement).closest('button')) return;\r\n        if (e.ctrlKey || e.metaKey) {\r\n            setSelectedDocIds(prev => prev.includes(docId) ? prev.filter(id => id !== docId) : [...prev, docId]);\r\n            setLastSelectedId(docId);\r\n        } else if (e.shiftKey && lastSelectedId) {\r\n            const docList = filteredDocs;\r\n            const currentIndex = docList.findIndex(d => d.id === docId);\r\n            const lastIndex = docList.findIndex(d => d.id === lastSelectedId);\r\n            if (currentIndex !== -1 && lastIndex !== -1) {\r\n                const start = Math.min(currentIndex, lastIndex);\r\n                const end = Math.max(currentIndex, lastIndex);\r\n                const rangeIds = docList.slice(start, end + 1).map(d => d.id);\r\n                setSelectedDocIds(prev => Array.from(new Set([...prev, ...rangeIds])));\r\n            }\r\n        } else {\r\n            setSelectedDocIds([docId]);\r\n            setLastSelectedId(docId);\r\n        }\r\n    };\r\n\r\n    const filteredDocs = documents.filter(doc => {\r\n        if (doc.fileUrl === 'folder') return false;\r\n        const matchesSearch = doc.name.toLowerCase().includes(searchTerm.toLowerCase());\r\n        if (selectedFile) {\r\n            if (selectedFile.type === 'folder') return matchesSearch && doc.folderPath.includes(selectedFile.id);\r\n            return doc.id === selectedFile.id;\r\n        }\r\n        return matchesSearch;\r\n    });\r\n\r\n    const documentsToTree = (docs: any[]): FileNode[] => {\r\n        const tree: FileNode[] = [];\r\n        const foldersMap: Record<string, FileNode> = {};\r\n\r\n        docs.filter(d => d.fileUrl === 'folder')\r\n            .sort((a, b) => a.name.localeCompare(b.name)) // Sort folders alphabetically\r\n            .forEach(d => {\r\n                foldersMap[d.id] = { id: d.id, name: d.name, type: 'folder', children: [] };\r\n            });\r\n\r\n        docs.filter(d => d.fileUrl === 'folder').forEach(d => {\r\n            const node = foldersMap[d.id];\r\n            const parentId = d.folderPath.split('/').filter(Boolean).pop();\r\n            if (parentId && foldersMap[parentId]) foldersMap[parentId].children?.push(node);\r\n            else tree.push(node);\r\n        });\r\n\r\n        docs.filter(d => d.fileUrl !== 'folder').forEach(d => {\r\n            const fileNode: FileNode = { id: d.id, name: d.name, type: 'file', extension: d.name.split('.').pop() };\r\n            const parentId = d.folderPath.split('/').filter(Boolean).pop();\r\n            if (parentId && foldersMap[parentId]) foldersMap[parentId].children?.push(fileNode);\r\n            else tree.push(fileNode);\r\n        });\r\n\r\n        return tree;\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex gap-4 h-[calc(100vh-250px)] min-h-[500px]\">\r\n            <input type=\"file\" className=\"hidden\" ref={fileInputRef} onChange={handleFileChange} />\r\n\r\n            <div className=\"w-72 shrink-0 glass-card rounded-lg overflow-hidden border border-white/5 flex flex-col\">\r\n                {selectedFile && (\r\n                    <div className=\"p-2 border-b border-white/5 bg-primary/5 text-center\">\r\n                        <Button variant=\"ghost\" size=\"sm\" className=\"w-full text-xs\" onClick={() => setSelectedFile(null)}>\r\n                            Limpar Seleção\r\n                        </Button>\r\n                    </div>\r\n                )}\r\n                <DocumentSidebar\r\n                    onFileSelect={(n) => setSelectedFile(n)}\r\n                    onNewFile={handleNewFile}\r\n                    onNewFolder={handleNewFolder}\r\n                    onRefresh={refresh}\r\n                    onAction={handleSidebarAction}\r\n                    onMove={handleMove}\r\n                    files={documentsToTree(documents)}\r\n                />\r\n            </div>\r\n\r\n            <div className=\"flex-1 space-y-4 overflow-auto\">\r\n                {(isProcessing || queueLength > 0) && (\r\n                    <div className=\"flex items-center justify-between p-3 glass-card bg-emerald-500/10 rounded-lg border-emerald-500/20 animate-pulse\">\r\n                        <span className=\"text-sm font-bold uppercase text-emerald-400 flex items-center gap-2\">\r\n                            <Download className=\"size-4 animate-bounce\" />\r\n                            Baixando: {currentDownload || 'Preparando...'}\r\n                        </span>\r\n                        <Badge variant=\"outline\" className=\"text-emerald-400 border-emerald-400/30\">\r\n                            Fila: {queueLength}\r\n                        </Badge>\r\n                    </div>\r\n                )}\r\n\r\n                {selectedDocIds.length > 0 && (\r\n                    <div className=\"flex items-center justify-between p-3 glass-card bg-primary/5 rounded-lg border-primary/20\">\r\n                        <span className=\"text-sm font-bold uppercase\">{selectedDocIds.length} Itens Selecionados</span>\r\n                        <div className=\"flex gap-2\">\r\n                            <Button size=\"sm\" variant=\"ghost\" onClick={handleBulkDownload}><Download className=\"size-4 mr-2\" /> Baixar</Button>\r\n                            <Button size=\"sm\" variant=\"ghost\" onClick={() => setSelectedDocIds([])}>Cancelar</Button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                <div className=\"flex gap-4 justify-between\">\r\n                    <Input\r\n                        placeholder=\"Buscar arquivos de sistema...\"\r\n                        value={searchTerm}\r\n                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                        className=\"max-w-md industrial-input\"\r\n                    />\r\n                    <div className=\"flex gap-2\">\r\n                        <Button variant=\"outline\" size=\"icon\" onClick={handleOrganizeRoot} title=\"Organizar Arquivos Soltos\">\r\n                            <FolderInput className=\"size-4\" />\r\n                        </Button>\r\n                        <Button variant=\"outline\" size=\"icon\" onClick={handleCreateBaseStructure} title=\"Gerar Estrutura Padrão\">\r\n                            <Zap className=\"size-4\" />\r\n                        </Button>\r\n                        <Button variant=\"outline\" onClick={handleExportAll}><Download className=\"size-4 mr-2\" /> Baixar Tudo</Button>\r\n                        <Button className=\"gradient-primary\" onClick={handleNewFile}><Upload className=\"size-4 mr-2\" /> Upload SU</Button>\r\n                    </div>\r\n                </div>\r\n\r\n                <Card className=\"glass-card\">\r\n                    <CardHeader>\r\n                        <CardTitle className=\"text-sm uppercase tracking-widest font-black\">Documentação por Nível Hierárquico</CardTitle>\r\n                        <CardDescription>Manuais, Políticas e Arquivos de Configuração do Sistema.</CardDescription>\r\n                    </CardHeader>\r\n                    <CardContent className=\"p-0\">\r\n                        <Table>\r\n                            <TableHeader>\r\n                                <TableRow>\r\n                                    <TableHead className=\"pl-6 uppercase text-[10px] font-bold\">Arquivo</TableHead>\r\n                                    <TableHead className=\"uppercase text-[10px] font-bold\">Tipo</TableHead>\r\n                                    <TableHead className=\"uppercase text-[10px] font-bold\">Data</TableHead>\r\n                                    <TableHead className=\"text-right pr-6 uppercase text-[10px] font-bold\">Ações</TableHead>\r\n                                </TableRow>\r\n                            </TableHeader>\r\n                            <TableBody>\r\n                                {isLoading ? (\r\n                                    <TableRow><TableCell colSpan={4} className=\"text-center py-10\">Carregando...</TableCell></TableRow>\r\n                                ) : filteredDocs.length === 0 ? (\r\n                                    <TableRow><TableCell colSpan={4} className=\"text-center py-10 italic opacity-50\">Pasta vazia</TableCell></TableRow>\r\n                                ) : (\r\n                                    filteredDocs.map((doc) => (\r\n                                        <TableRow\r\n                                            key={doc.id}\r\n                                            onClick={(e) => handleRowClick(e, doc.id)}\r\n                                            className={`cursor-pointer ${selectedDocIds.includes(doc.id) ? 'bg-primary/10' : 'hover:bg-white/5'}`}\r\n                                        >\r\n                                            <TableCell className=\"pl-6 py-4\">\r\n                                                <div className=\"flex items-center gap-3\">\r\n                                                    <FileText className=\"size-4 text-primary\" />\r\n                                                    <span className=\"font-bold text-sm\">{doc.name}</span>\r\n                                                </div>\r\n                                            </TableCell>\r\n                                            <TableCell>\r\n                                                <Badge variant=\"outline\" className=\"text-[10px]\">{doc.docType}</Badge>\r\n                                            </TableCell>\r\n                                            <TableCell className=\"text-xs\">\r\n                                                {format(new Date(doc.updatedAt), 'dd/MM/yyyy')}\r\n                                            </TableCell>\r\n                                            <TableCell className=\"text-right pr-6\">\r\n                                                <div className=\"flex justify-end gap-2\">\r\n                                                    <Button size=\"icon\" variant=\"ghost\" className=\"size-8\" onClick={() => previewDocument(doc)} title=\"Visualizar\"><Eye className=\"size-4\" /></Button>\r\n                                                    <Button size=\"icon\" variant=\"ghost\" className=\"size-8\" onClick={() => downloadDocument(doc)} title=\"Download\"><Download className=\"size-4\" /></Button>\r\n                                                    <Button size=\"icon\" variant=\"ghost\" className=\"size-8\" onClick={() => deleteDocument(doc.id, doc.fileUrl)} title=\"Excluir\"><Trash2 className=\"size-4\" /></Button>\r\n                                                </div>\r\n                                            </TableCell>\r\n                                        </TableRow>\r\n                                    ))\r\n                                )}\r\n                            </TableBody>\r\n                        </Table>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            {contextFolder && (\r\n                <FolderPermissionsModal\r\n                    open={permissionModalOpen}\r\n                    onOpenChange={setPermissionModalOpen}\r\n                    document={contextFolder}\r\n                    onSave={handleSavePermissions}\r\n                />\r\n            )}\r\n        </div >\r\n    );\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\su\\permission-modal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[985,988],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[985,988],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":83,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":83,"endColumn":23}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Checkbox } from '@/components/ui/checkbox';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\r\nimport { db } from '@/integrations/database';\r\nimport { toast } from 'sonner';\r\nimport { Shield, Save, Plus, Trash2, Lock } from 'lucide-react';\r\nimport { ConstructionDocument } from '@/hooks/useConstructionDocuments';\r\n\r\ninterface PermissionModalProps {\r\n    open: boolean;\r\n    onOpenChange: (open: boolean) => void;\r\n    document: ConstructionDocument;\r\n    onSave: (docId: string, permissions: any) => Promise<void>;\r\n}\r\n\r\ninterface PermissionRule {\r\n    roleId: string; // The level name or ID\r\n    canView: boolean;\r\n    canEdit: boolean; // Upload, Rename\r\n    canDelete: boolean;\r\n}\r\n\r\nexport function FolderPermissionsModal({ open, onOpenChange, document, onSave }: PermissionModalProps) {\r\n    const [permissions, setPermissions] = useState<PermissionRule[]>([]);\r\n    const [availableRoles, setAvailableRoles] = useState<{ id: string, name: string }[]>([]);\r\n    const [selectedRole, setSelectedRole] = useState<string>('');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const fetchRoles = async () => {\r\n            const { data } = await db.from('permission_levels').select('id, name').order('rank');\r\n            if (data) setAvailableRoles(data);\r\n        };\r\n        fetchRoles();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (open && document) {\r\n            // Load existing permissions from metadata\r\n            const existing = document.metadata?.permissions || [];\r\n            // Ensure format\r\n            setPermissions(Array.isArray(existing) ? existing : []);\r\n        }\r\n    }, [open, document]);\r\n\r\n    const handleAddRule = () => {\r\n        if (!selectedRole) return;\r\n        if (permissions.some(p => p.roleId === selectedRole)) {\r\n            toast.error(\"Esta regra já existe.\");\r\n            return;\r\n        }\r\n\r\n        setPermissions(prev => [...prev, {\r\n            roleId: selectedRole,\r\n            canView: true,\r\n            canEdit: false,\r\n            canDelete: false\r\n        }]);\r\n        setSelectedRole('');\r\n    };\r\n\r\n    const handleRemoveRule = (roleId: string) => {\r\n        setPermissions(prev => prev.filter(p => p.roleId !== roleId));\r\n    };\r\n\r\n    const updateRule = (roleId: string, field: keyof PermissionRule, value: boolean) => {\r\n        setPermissions(prev => prev.map(p =>\r\n            p.roleId === roleId ? { ...p, [field]: value } : p\r\n        ));\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        setIsLoading(true);\r\n        try {\r\n            await onSave(document.id, { permissions });\r\n            onOpenChange(false);\r\n            toast.success(\"Permissões atualizadas com sucesso!\");\r\n        } catch (error) {\r\n            toast.error(\"Erro ao salvar permissões.\");\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const getRoleName = (id: string) => availableRoles.find(r => r.name === id || r.id === id)?.name || id;\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent className=\"max-w-xl glass-card border-white/10\">\r\n                <DialogHeader>\r\n                    <DialogTitle className=\"flex items-center gap-2\">\r\n                        <Shield className=\"size-5 text-primary\" />\r\n                        Permissões da Pasta\r\n                    </DialogTitle>\r\n                    <DialogDescription>\r\n                        Configurando acesso para: <span className=\"font-bold text-white\">{document?.name}</span>\r\n                    </DialogDescription>\r\n                </DialogHeader>\r\n\r\n                <div className=\"space-y-6 py-4\">\r\n                    <div className=\"flex gap-2 items-end\">\r\n                        <div className=\"flex-1 space-y-2\">\r\n                            <Label>Adicionar Regra para Cargo/Nível</Label>\r\n                            <Select value={selectedRole} onValueChange={setSelectedRole}>\r\n                                <SelectTrigger className=\"industrial-input\">\r\n                                    <SelectValue placeholder=\"Selecione um nível...\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    {availableRoles\r\n                                        .filter(r => !permissions.some(p => p.roleId === r.name))\r\n                                        .map(role => (\r\n                                            <SelectItem key={role.id} value={role.name}>\r\n                                                {role.name}\r\n                                            </SelectItem>\r\n                                        ))\r\n                                    }\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                        <Button onClick={handleAddRule} disabled={!selectedRole} className=\"gradient-primary mb-0.5\">\r\n                            <Plus className=\"size-4 mr-2\" /> Adicionar\r\n                        </Button>\r\n                    </div>\r\n\r\n                    <div className=\"border border-white/10 rounded-lg overflow-hidden bg-black/20\">\r\n                        <Table>\r\n                            <TableHeader>\r\n                                <TableRow className=\"hover:bg-transparent\">\r\n                                    <TableHead>Nível</TableHead>\r\n                                    <TableHead className=\"text-center w-20\">Ver</TableHead>\r\n                                    <TableHead className=\"text-center w-20\">Editar</TableHead>\r\n                                    <TableHead className=\"text-center w-20\">Excluir</TableHead>\r\n                                    <TableHead className=\"w-10\"></TableHead>\r\n                                </TableRow>\r\n                            </TableHeader>\r\n                            <TableBody>\r\n                                {permissions.length === 0 ? (\r\n                                    <TableRow>\r\n                                        <TableCell colSpan={5} className=\"text-center py-8 text-muted-foreground italic\">\r\n                                            Nenhuma regra definida. Acesso padrão do sistema.\r\n                                        </TableCell>\r\n                                    </TableRow>\r\n                                ) : (\r\n                                    permissions.map((rule) => (\r\n                                        <TableRow key={rule.roleId} className=\"hover:bg-white/5\">\r\n                                            <TableCell className=\"font-medium\">\r\n                                                <Badge variant=\"outline\">{getRoleName(rule.roleId)}</Badge>\r\n                                            </TableCell>\r\n                                            <TableCell className=\"text-center\">\r\n                                                <Checkbox\r\n                                                    checked={rule.canView}\r\n                                                    onCheckedChange={(c) => updateRule(rule.roleId, 'canView', c as boolean)}\r\n                                                />\r\n                                            </TableCell>\r\n                                            <TableCell className=\"text-center\">\r\n                                                <Checkbox\r\n                                                    checked={rule.canEdit}\r\n                                                    onCheckedChange={(c) => updateRule(rule.roleId, 'canEdit', c as boolean)}\r\n                                                />\r\n                                            </TableCell>\r\n                                            <TableCell className=\"text-center\">\r\n                                                <Checkbox\r\n                                                    checked={rule.canDelete}\r\n                                                    onCheckedChange={(c) => updateRule(rule.roleId, 'canDelete', c as boolean)}\r\n                                                />\r\n                                            </TableCell>\r\n                                            <TableCell>\r\n                                                <Button size=\"icon\" variant=\"ghost\" className=\"h-6 w-6 text-red-500 hover:text-red-400\" onClick={() => handleRemoveRule(rule.roleId)}>\r\n                                                    <Trash2 className=\"size-3\" />\r\n                                                </Button>\r\n                                            </TableCell>\r\n                                        </TableRow>\r\n                                    ))\r\n                                )}\r\n                            </TableBody>\r\n                        </Table>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2 text-xs text-muted-foreground bg-primary/5 p-3 rounded border border-primary/10\">\r\n                        <Lock className=\"size-3\" />\r\n                        <span>Admins e Super Admins possuem acesso total irrestrito independente destas regras.</span>\r\n                    </div>\r\n                </div>\r\n\r\n                <DialogFooter>\r\n                    <Button variant=\"ghost\" onClick={() => onOpenChange(false)}>Cancelar</Button>\r\n                    <Button onClick={handleSave} disabled={isLoading} className=\"gradient-primary\">\r\n                        {isLoading ? <span className=\"animate-spin mr-2\">⏳</span> : <Save className=\"size-4 mr-2\" />}\r\n                        Salvar Permissões\r\n                    </Button>\r\n                </DialogFooter>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\theme-provider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\tickets\\CreateTicketModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Wrench' is defined but never used.","line":13,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'HelpCircle' is defined but never used.","line":13,"column":73,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":83},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Key' is defined but never used.","line":13,"column":85,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":88},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'user' is assigned a value but never used.","line":53,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":53,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":87,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4160,4163],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4160,4163],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4878,4881],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4878,4881],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":123,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5344,5347],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5344,5347],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger, DialogFooter } from '@/components/ui/dialog';\r\nimport { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList } from '@/components/ui/command';\r\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\r\nimport { useMessages, TicketType, CreateTicketPayload, SystemMessage } from '@/hooks/useMessages';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { db } from '@/integrations/database';\r\nimport { Loader2, Plus, Ticket, FileText, Users, Wrench, MessageSquare, HelpCircle, Key, Shield, Search, Check, Reply, User } from 'lucide-react';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { cn } from '@/lib/utils';\r\nimport { getRoleLabel } from '@/utils/roleUtils';\r\n\r\ninterface CreateTicketModalProps {\r\n    trigger?: React.ReactNode;\r\n    defaultType?: TicketType;\r\n    replyTo?: SystemMessage; // Para responder mensagens\r\n    onSuccess?: () => void;\r\n}\r\n\r\ninterface UserOption {\r\n    id: string;\r\n    fullName: string;\r\n    email: string;\r\n    role: string;\r\n    type: 'profile' | 'employee';\r\n}\r\n//    { value: 'PASSWORD_RESET', label: 'Redefinição de Senha', icon: <Key className=\"w-4 h-4\" />, description: 'Solicitar nova senha de acesso' },\r\n\r\nconst TICKET_TYPES: { value: TicketType; label: string; icon: React.ReactNode; description: string }[] = [\r\n    { value: 'DIRECT', label: 'Mensagem Direta', icon: <MessageSquare className=\"w-4 h-4 text-red-500\" />, description: 'Enviar mensagem para um usuário específico' },\r\n    { value: 'ADMINISTRATIVE', label: 'Administrativo', icon: <FileText className=\"w-4 h-4 text-primary\" />, description: 'Solicitações administrativas gerais' },\r\n    { value: 'RH', label: 'Recursos Humanos', icon: <Users className=\"w-4 h-4 border border-primary rounded-full p-1 text-primary\" />, description: 'Questões de RH, folha, benefícios' },\r\n];\r\n\r\nconst RECIPIENT_ROLES = [\r\n    { value: 'admin', label: 'Administração' },\r\n    { value: 'ti_software', label: 'TI / Software' },\r\n    { value: 'RH', label: 'Recursos Humanos' },\r\n];\r\n\r\n// Tipos que não precisam de seleção de destinatário\r\nconst AUTO_RECIPIENT_TYPES: TicketType[] = ['PASSWORD_RESET'];\r\n\r\nexport function CreateTicketModal({ trigger, defaultType, replyTo, onSuccess }: CreateTicketModalProps) {\r\n    const [open, setOpen] = useState(false);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const { sendMessage } = useMessages();\r\n    const { profile, user } = useAuth();\r\n\r\n    // Para busca de usuários\r\n    const [userSearchOpen, setUserSearchOpen] = useState(false);\r\n    const [userSearch, setUserSearch] = useState('');\r\n    const [users, setUsers] = useState<UserOption[]>([]);\r\n    const [selectedUser, setSelectedUser] = useState<UserOption | null>(null);\r\n    const [isSearching, setIsSearching] = useState(false);\r\n\r\n    const [form, setForm] = useState<CreateTicketPayload>({\r\n        type: replyTo ? 'DIRECT' : (defaultType || TICKET_TYPES[0].value),\r\n        subject: replyTo ? `RE: ${replyTo.subject}` : '',\r\n        content: '',\r\n        recipientRole: 'admin',\r\n        recipientId: replyTo?.senderId,\r\n    });\r\n\r\n    // Configurar resposta\r\n    useEffect(() => {\r\n        if (replyTo) {\r\n            setForm({\r\n                type: 'DIRECT',\r\n                subject: `RE: ${replyTo.subject}`,\r\n                content: '',\r\n                recipientId: replyTo.senderId,\r\n            });\r\n            // Buscar dados do remetente para preencher selectedUser\r\n            if (replyTo.senderId) {\r\n                fetchUserById(replyTo.senderId);\r\n            }\r\n        }\r\n    }, [replyTo]);\r\n\r\n    const fetchUserById = async (userId: string) => {\r\n        const { data: userData } = await (db as any)\r\n            .from('users')\r\n            .select('id, name, email, role')\r\n            .eq('id', userId)\r\n            .maybeSingle();\r\n\r\n        if (userData) {\r\n            setSelectedUser({\r\n                id: userData.id,\r\n                fullName: userData.name || '',\r\n                email: userData.email || '',\r\n                role: userData.role || '',\r\n                type: 'profile'\r\n            });\r\n            return;\r\n        }\r\n    };\r\n\r\n    // Buscar usuários e funcionários\r\n    const searchUsers = useCallback(async (query: string) => {\r\n        setIsSearching(true);\r\n        try {\r\n            // 1. Buscar Usuários e Funcionários (Unificado em users)\r\n            let usersQuery = (db as any)\r\n                .from('users')\r\n                .select('id, name, email, role');\r\n\r\n            if (query) {\r\n                usersQuery = usersQuery.or(`name.ilike.%${query}%,email.ilike.%${query}%`);\r\n            }\r\n            const { data: usersData } = await usersQuery.neq('id', profile?.id).limit(20);\r\n\r\n            const results: UserOption[] = [];\r\n\r\n            // Mapear perfis\r\n            if (usersData) {\r\n                usersData.forEach((u: any) => {\r\n                    results.push({\r\n                        id: u.id,\r\n                        fullName: u.name || '',\r\n                        email: u.email || '',\r\n                        role: u.role || '',\r\n                        type: 'profile'\r\n                    });\r\n                });\r\n            }\r\n\r\n            setUsers(results);\r\n        } catch (e) {\r\n            console.error('Catch error searching users/employees:', e);\r\n        } finally {\r\n            setIsSearching(false);\r\n        }\r\n    }, [profile?.id]);\r\n\r\n    // Buscar usuários inicialmente ao abrir a busca ou ao digitar\r\n    useEffect(() => {\r\n        if (!userSearchOpen) return;\r\n\r\n        const timer = setTimeout(() => {\r\n            searchUsers(userSearch);\r\n        }, userSearch ? 300 : 0); // Sem delay para busca inicial vazia\r\n\r\n        return () => clearTimeout(timer);\r\n    }, [userSearch, userSearchOpen, searchUsers]);\r\n\r\n    // Quando o tipo mudar\r\n    useEffect(() => {\r\n        if (AUTO_RECIPIENT_TYPES.includes(form.type)) {\r\n            setForm(prev => ({ ...prev, recipientRole: 'gestao', recipientId: undefined }));\r\n            setSelectedUser(null);\r\n        }\r\n        if (form.type !== 'DIRECT') {\r\n            setSelectedUser(null);\r\n            setForm(prev => ({ ...prev, recipientId: undefined }));\r\n        }\r\n    }, [form.type]);\r\n\r\n    const handleSelectUser = (userOption: UserOption) => {\r\n        setSelectedUser(userOption);\r\n        setForm(prev => ({ ...prev, recipientId: userOption.id }));\r\n        setUserSearchOpen(false);\r\n        setUserSearch('');\r\n    };\r\n\r\n    const resetForm = useCallback(() => {\r\n        setForm({\r\n            type: replyTo ? 'DIRECT' : (defaultType || TICKET_TYPES[0].value),\r\n            subject: replyTo ? `RE: ${replyTo.subject}` : '',\r\n            content: '',\r\n            recipientRole: 'admin',\r\n            recipientId: replyTo?.senderId,\r\n        });\r\n        setSelectedUser(null);\r\n        setUserSearch('');\r\n        setUsers([]);\r\n\r\n        // Se for resposta, buscar o usuário novamente para o cache de seleção\r\n        if (replyTo?.senderId) {\r\n            fetchUserById(replyTo.senderId);\r\n        }\r\n    }, [defaultType, replyTo]);\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setIsLoading(true);\r\n\r\n        // Determinar destinatário\r\n        let recipientRole = form.recipientRole;\r\n        let recipientId = form.recipientId;\r\n        let recipientIdEmployee = undefined;\r\n\r\n        if (AUTO_RECIPIENT_TYPES.includes(form.type)) {\r\n            recipientRole = 'gestao';\r\n        } else if (form.type === 'DIRECT' && selectedUser) {\r\n            if (selectedUser.type === 'employee') {\r\n                recipientIdEmployee = selectedUser.id;\r\n                recipientId = undefined;\r\n            } else {\r\n                recipientId = selectedUser.id;\r\n            }\r\n            recipientRole = undefined;\r\n        }\r\n\r\n        const result = await sendMessage({\r\n            ...form,\r\n            recipientRole,\r\n            recipientId,\r\n            recipientIdEmployee,\r\n            companyId: profile?.companyId,\r\n            projectId: profile?.projectId,\r\n            siteId: profile?.siteId,\r\n            metadata: {\r\n                createdFrom: replyTo ? 'reply' : 'ticket_modal',\r\n                userRole: profile?.role,\r\n                userName: profile?.fullName,\r\n                replyToId: replyTo?.id,\r\n                recipientType: selectedUser?.type\r\n            }\r\n        });\r\n\r\n        setIsLoading(false);\r\n\r\n        if (result.success) {\r\n            setOpen(false);\r\n            resetForm();\r\n            onSuccess?.();\r\n        }\r\n    };\r\n\r\n    const selectedType = TICKET_TYPES.find(t => t.value === form.type);\r\n    const isAutoRecipient = AUTO_RECIPIENT_TYPES.includes(form.type);\r\n    const isDirectMessage = form.type === 'DIRECT';\r\n\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={(isOpen) => {\r\n            setOpen(isOpen);\r\n            if (!isOpen) resetForm();\r\n        }}>\r\n            <DialogTrigger asChild>\r\n                {trigger || (\r\n                    <Button className=\"gradient-primary\">\r\n                        {replyTo ? (\r\n                            <>\r\n                                <Reply className=\"w-4 h-4 mr-2\" />\r\n                                Responder\r\n                            </>\r\n                        ) : (\r\n                            <>\r\n                                <Plus className=\"w-4 h-4 mr-2\" />\r\n                                Novo Ticket\r\n                            </>\r\n                        )}\r\n                    </Button>\r\n                )}\r\n            </DialogTrigger>\r\n            <DialogContent className=\"max-w-lg\">\r\n                <DialogHeader>\r\n                    <DialogTitle className=\"flex items-center gap-2\">\r\n                        {replyTo ? <Reply className=\"w-5 h-5 text-primary\" /> : <Ticket className=\"w-5 h-5 text-primary\" />}\r\n                        {replyTo ? 'Responder Mensagem' : 'Criar Novo Ticket'}\r\n                    </DialogTitle>\r\n                    <DialogDescription>\r\n                        {replyTo\r\n                            ? `Respondendo a: ${replyTo.sender?.full_name || replyTo.senderEmail}`\r\n                            : 'Preencha os campos abaixo para abrir uma solicitação formal.'\r\n                        }\r\n                    </DialogDescription>\r\n                </DialogHeader>\r\n\r\n                <form onSubmit={handleSubmit} className=\"space-y-4 pt-4\">\r\n                    {/* Tipo de Ticket - Desabilitado se for resposta */}\r\n                    {!replyTo && (\r\n                        <div className=\"space-y-2\">\r\n                            <Label>Tipo de Ticket *</Label>\r\n                            <Select\r\n                                value={form.type}\r\n                                onValueChange={(value: TicketType) => setForm({ ...form, type: value })}\r\n                            >\r\n                                <SelectTrigger className=\"industrial-input\">\r\n                                    <SelectValue placeholder=\"Selecione o tipo\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    {TICKET_TYPES.map(type => (\r\n                                        <SelectItem key={type.value} value={type.value}>\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                {type.icon}\r\n                                                <span>{type.label}</span>\r\n                                            </div>\r\n                                        </SelectItem>\r\n                                    ))}\r\n                                </SelectContent>\r\n                            </Select>\r\n                            {selectedType && (\r\n                                <p className=\"text-xs text-muted-foreground\">{selectedType.description}</p>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Destinatário */}\r\n                    {isAutoRecipient ? (\r\n                        <div className=\"p-3 bg-primary/5 border border-primary/20 rounded-lg text-center\">\r\n                            <div className=\"flex items-center justify-center gap-2 text-sm\">\r\n                                <Shield className=\"w-4 h-4 text-primary\" />\r\n                                <span className=\"font-light\">Encaminhamento automático</span>\r\n                            </div>\r\n                            <p className=\"text-xs text-muted-foreground mt-1\">\r\n                                Este tipo de solicitação será enviado para a <Badge variant=\"outline\" className=\"ml-1\">Gestão</Badge>\r\n                            </p>\r\n                        </div>\r\n                    ) : isDirectMessage || replyTo ? (\r\n                        // Autocomplete de usuários para mensagem direta\r\n                        <div className=\"space-y-2\">\r\n                            <Label>Destinatário *</Label>\r\n                            <Popover open={userSearchOpen} onOpenChange={setUserSearchOpen}>\r\n                                <PopoverTrigger asChild>\r\n                                    <Button\r\n                                        variant=\"outline\"\r\n                                        role=\"combobox\"\r\n                                        aria-expanded={userSearchOpen}\r\n                                        className=\"w-full justify-between industrial-input h-10\"\r\n                                        disabled={!!replyTo}\r\n                                    >\r\n                                        {selectedUser ? (\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <User className=\"w-4 h-4 text-muted-foreground\" />\r\n                                                <span>{selectedUser.fullName}</span>\r\n                                                <span className=\"text-xs text-muted-foreground\">({selectedUser.email})</span>\r\n                                            </div>\r\n                                        ) : (\r\n                                            <span className=\"text-muted-foreground\">Buscar usuário...</span>\r\n                                        )}\r\n                                        <Search className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\r\n                                    </Button>\r\n                                </PopoverTrigger>\r\n                                <PopoverContent className=\"w-[400px] p-0\" align=\"start\">\r\n                                    <Command shouldFilter={false}>\r\n                                        <CommandInput\r\n                                            placeholder=\"Digite nome ou email...\"\r\n                                            value={userSearch}\r\n                                            onValueChange={setUserSearch}\r\n                                        />\r\n                                        <CommandList>\r\n                                            <CommandEmpty>\r\n                                                {isSearching ? 'Buscando...' : 'Nenhum usuário encontrado.'}\r\n                                            </CommandEmpty>\r\n                                            <CommandGroup heading=\"Usuários\">\r\n                                                {users.map((u) => (\r\n                                                    <CommandItem\r\n                                                        key={u.id}\r\n                                                        value={u.id}\r\n                                                        onSelect={() => handleSelectUser(u)}\r\n                                                        className=\"cursor-pointer\"\r\n                                                    >\r\n                                                        <div className=\"flex items-center gap-3 flex-1\">\r\n                                                            <div className=\"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center\">\r\n                                                                <User className=\"w-4 h-4 text-primary\" />\r\n                                                            </div>\r\n                                                            <div className=\"flex-1 min-w-0\">\r\n                                                                <p className=\"font-medium truncate\">{u.fullName}</p>\r\n                                                                <p className=\"text-xs text-muted-foreground truncate\">{u.email || 'Sem e-mail'}</p>\r\n                                                            </div>\r\n                                                            <Badge\r\n                                                                variant={u.type === 'employee' ? \"secondary\" : \"outline\"}\r\n                                                                className={cn(\r\n                                                                    \"text-[10px]\",\r\n                                                                    u.type === 'employee' ? \"bg-amber-500/10 text-amber-500 border-amber-500/20\" : \"bg-blue-500/10 text-blue-500 border-blue-500/20\"\r\n                                                                )}\r\n                                                            >\r\n                                                                {u.type === 'employee' ? 'Equipe' : getRoleLabel(u.role)}\r\n                                                            </Badge>\r\n                                                        </div>\r\n                                                        <Check\r\n                                                            className={cn(\r\n                                                                \"ml-auto h-4 w-4\",\r\n                                                                selectedUser?.id === u.id ? \"opacity-100\" : \"opacity-0\"\r\n                                                            )}\r\n                                                        />\r\n                                                    </CommandItem>\r\n                                                ))}\r\n                                            </CommandGroup>\r\n                                        </CommandList>\r\n                                    </Command>\r\n                                </PopoverContent>\r\n                            </Popover>\r\n                            {selectedUser && (\r\n                                <p className=\"text-xs text-muted-foreground\">\r\n                                    Mensagem será enviada diretamente para {selectedUser.fullName}\r\n                                </p>\r\n                            )}\r\n                        </div>\r\n                    ) : (\r\n                        // Seleção de role\r\n                        <div className=\"space-y-2\">\r\n                            <Label>Encaminhar para *</Label>\r\n                            <Select\r\n                                value={form.recipientRole}\r\n                                onValueChange={(value) => setForm({ ...form, recipientRole: value })}\r\n                            >\r\n                                <SelectTrigger className=\"industrial-input\">\r\n                                    <SelectValue placeholder=\"Selecione o destinatário\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    {RECIPIENT_ROLES.map(role => (\r\n                                        <SelectItem key={role.value} value={role.value}>\r\n                                            {role.label}\r\n                                        </SelectItem>\r\n                                    ))}\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Assunto */}\r\n                    <div className=\"space-y-2\">\r\n                        <Label htmlFor=\"ticket-subject\">Assunto *</Label>\r\n                        <Input\r\n                            id=\"ticket-subject\"\r\n                            value={form.subject}\r\n                            onChange={(e) => setForm({ ...form, subject: e.target.value })}\r\n                            placeholder=\"Resumo da solicitação\"\r\n                            className=\"industrial-input\"\r\n                            required\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Mensagem */}\r\n                    <div className=\"space-y-2\">\r\n                        <Label htmlFor=\"ticket-content\">Mensagem *</Label>\r\n                        <Textarea\r\n                            id=\"ticket-content\"\r\n                            value={form.content}\r\n                            onChange={(e) => setForm({ ...form, content: e.target.value })}\r\n                            placeholder=\"Descreva detalhadamente sua solicitação...\"\r\n                            className=\"industrial-input min-h-[120px]\"\r\n                            required\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Escopo (informativo) - Só para tickets novos */}\r\n                    {!replyTo && (\r\n                        <div className=\"p-3 bg-muted/50 rounded-lg text-xs text-muted-foreground\">\r\n                            <p className=\"font-semibold mb-1\">Escopo do ticket:</p>\r\n                            <p>Empresa: {profile?.companyId ? '✓ Vinculado' : 'N/A'}</p>\r\n                            <p>Obra: {profile?.projectId ? '✓ Vinculado' : 'N/A'}</p>\r\n                            <p>Canteiro: {profile?.siteId ? '✓ Vinculado' : 'N/A'}</p>\r\n                        </div>\r\n                    )}\r\n\r\n                    <DialogFooter className=\"pt-4\">\r\n                        <Button type=\"button\" variant=\"outline\" onClick={() => {\r\n                            setOpen(false);\r\n                            resetForm();\r\n                        }}>\r\n                            Cancelar\r\n                        </Button>\r\n                        <Button\r\n                            type=\"submit\"\r\n                            className=\"gradient-primary\"\r\n                            disabled={isLoading || !form.subject || !form.content || (isDirectMessage && !selectedUser && !replyTo)}\r\n                        >\r\n                            {isLoading ? <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> : replyTo ? <Reply className=\"w-4 h-4 mr-2\" /> : <Ticket className=\"w-4 h-4 mr-2\" />}\r\n                            {replyTo ? 'Enviar Resposta' : 'Enviar Ticket'}\r\n                        </Button>\r\n                    </DialogFooter>\r\n                </form>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\accordion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\alert.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\aspect-ratio.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\breadcrumb.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\calendar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_props' is defined but never used.","line":45,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_props' is defined but never used.","line":46,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":32}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\r\nimport { ChevronLeft, ChevronRight } from \"lucide-react\";\r\nimport { DayPicker } from \"react-day-picker\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\nimport { buttonVariants } from \"@/components/ui/button\";\r\n\r\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>;\r\n\r\nfunction Calendar({ className, classNames, showOutsideDays = true, ...props }: CalendarProps) {\r\n  return (\r\n    <DayPicker\r\n      showOutsideDays={showOutsideDays}\r\n      className={cn(\"p-3\", className)}\r\n      classNames={{\r\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\r\n        month: \"space-y-4\",\r\n        caption: \"flex justify-center pt-1 relative items-center\",\r\n        caption_label: \"text-sm font-medium\",\r\n        nav: \"space-x-1 flex items-center\",\r\n        nav_button: cn(\r\n          buttonVariants({ variant: \"outline\" }),\r\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\",\r\n        ),\r\n        nav_button_previous: \"absolute left-1\",\r\n        nav_button_next: \"absolute right-1\",\r\n        table: \"w-full border-collapse space-y-1\",\r\n        head_row: \"flex\",\r\n        head_cell: \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\r\n        row: \"flex w-full mt-2\",\r\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\r\n        day: cn(buttonVariants({ variant: \"ghost\" }), \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"),\r\n        day_range_end: \"day-range-end\",\r\n        day_selected:\r\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\r\n        day_today: \"bg-accent text-accent-foreground\",\r\n        day_outside:\r\n          \"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30\",\r\n        day_disabled: \"text-muted-foreground opacity-50\",\r\n        day_range_middle: \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\r\n        day_hidden: \"invisible\",\r\n        ...classNames,\r\n      }}\r\n      components={{\r\n        IconLeft: ({ ..._props }) => <ChevronLeft className=\"h-4 w-4\" />,\r\n        IconRight: ({ ..._props }) => <ChevronRight className=\"h-4 w-4\" />,\r\n      }}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\nCalendar.displayName = \"Calendar\";\r\n\r\nexport { Calendar };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\carousel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\chart.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":62,"column":55,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":56}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\r\nimport * as RechartsPrimitive from \"recharts\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\n\r\n// Format: { THEME_NAME: CSS_SELECTOR }\r\nconst THEMES = { light: \"\", dark: \".dark\" } as const;\r\n\r\nexport type ChartConfig = {\r\n  [k in string]: {\r\n    label?: React.ReactNode;\r\n    icon?: React.ComponentType;\r\n  } & ({ color?: string; theme?: never } | { color?: never; theme: Record<keyof typeof THEMES, string> });\r\n};\r\n\r\ntype ChartContextProps = {\r\n  config: ChartConfig;\r\n};\r\n\r\nconst ChartContext = React.createContext<ChartContextProps | null>(null);\r\n\r\nfunction useChart() {\r\n  const context = React.useContext(ChartContext);\r\n\r\n  if (!context) {\r\n    throw new Error(\"useChart must be used within a <ChartContainer />\");\r\n  }\r\n\r\n  return context;\r\n}\r\n\r\nconst ChartContainer = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\"> & {\r\n    config: ChartConfig;\r\n    children: React.ComponentProps<typeof RechartsPrimitive.ResponsiveContainer>[\"children\"];\r\n  }\r\n>(({ id, className, children, config, ...props }, ref) => {\r\n  const uniqueId = React.useId();\r\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`;\r\n\r\n  return (\r\n    <ChartContext.Provider value={{ config }}>\r\n      <div\r\n        data-chart={chartId}\r\n        ref={ref}\r\n        className={cn(\r\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\r\n          className,\r\n        )}\r\n        {...props}\r\n      >\r\n        <ChartStyle id={chartId} config={config} />\r\n        <RechartsPrimitive.ResponsiveContainer>{children}</RechartsPrimitive.ResponsiveContainer>\r\n      </div>\r\n    </ChartContext.Provider>\r\n  );\r\n});\r\nChartContainer.displayName = \"Chart\";\r\n\r\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\r\n  const colorConfig = Object.entries(config).filter(([_, config]) => config.theme || config.color);\r\n\r\n  if (!colorConfig.length) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <style\r\n      dangerouslySetInnerHTML={{\r\n        __html: Object.entries(THEMES)\r\n          .map(\r\n            ([theme, prefix]) => `\r\n${prefix} [data-chart=${id}] {\r\n${colorConfig\r\n  .map(([key, itemConfig]) => {\r\n    const color = itemConfig.theme?.[theme as keyof typeof itemConfig.theme] || itemConfig.color;\r\n    return color ? `  --color-${key}: ${color};` : null;\r\n  })\r\n  .join(\"\\n\")}\r\n}\r\n`,\r\n          )\r\n          .join(\"\\n\"),\r\n      }}\r\n    />\r\n  );\r\n};\r\n\r\nconst ChartTooltip = RechartsPrimitive.Tooltip;\r\n\r\nconst ChartTooltipContent = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\r\n    React.ComponentProps<\"div\"> & {\r\n      hideLabel?: boolean;\r\n      hideIndicator?: boolean;\r\n      indicator?: \"line\" | \"dot\" | \"dashed\";\r\n      nameKey?: string;\r\n      labelKey?: string;\r\n    }\r\n>(\r\n  (\r\n    {\r\n      active,\r\n      payload,\r\n      className,\r\n      indicator = \"dot\",\r\n      hideLabel = false,\r\n      hideIndicator = false,\r\n      label,\r\n      labelFormatter,\r\n      labelClassName,\r\n      formatter,\r\n      color,\r\n      nameKey,\r\n      labelKey,\r\n    },\r\n    ref,\r\n  ) => {\r\n    const { config } = useChart();\r\n\r\n    const tooltipLabel = React.useMemo(() => {\r\n      if (hideLabel || !payload?.length) {\r\n        return null;\r\n      }\r\n\r\n      const [item] = payload;\r\n      const key = `${labelKey || item.dataKey || item.name || \"value\"}`;\r\n      const itemConfig = getPayloadConfigFromPayload(config, item, key);\r\n      const value =\r\n        !labelKey && typeof label === \"string\"\r\n          ? config[label as keyof typeof config]?.label || label\r\n          : itemConfig?.label;\r\n\r\n      if (labelFormatter) {\r\n        return <div className={cn(\"font-medium\", labelClassName)}>{labelFormatter(value, payload)}</div>;\r\n      }\r\n\r\n      if (!value) {\r\n        return null;\r\n      }\r\n\r\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>;\r\n    }, [label, labelFormatter, payload, hideLabel, labelClassName, config, labelKey]);\r\n\r\n    if (!active || !payload?.length) {\r\n      return null;\r\n    }\r\n\r\n    const nestLabel = payload.length === 1 && indicator !== \"dot\";\r\n\r\n    return (\r\n      <div\r\n        ref={ref}\r\n        className={cn(\r\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\r\n          className,\r\n        )}\r\n      >\r\n        {!nestLabel ? tooltipLabel : null}\r\n        <div className=\"grid gap-1.5\">\r\n          {payload.map((item, index) => {\r\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`;\r\n            const itemConfig = getPayloadConfigFromPayload(config, item, key);\r\n            const indicatorColor = color || item.payload.fill || item.color;\r\n\r\n            return (\r\n              <div\r\n                key={item.dataKey}\r\n                className={cn(\r\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\r\n                  indicator === \"dot\" && \"items-center\",\r\n                )}\r\n              >\r\n                {formatter && item?.value !== undefined && item.name ? (\r\n                  formatter(item.value, item.name, item, index, item.payload)\r\n                ) : (\r\n                  <>\r\n                    {itemConfig?.icon ? (\r\n                      <itemConfig.icon />\r\n                    ) : (\r\n                      !hideIndicator && (\r\n                        <div\r\n                          className={cn(\"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\", {\r\n                            \"h-2.5 w-2.5\": indicator === \"dot\",\r\n                            \"w-1\": indicator === \"line\",\r\n                            \"w-0 border-[1.5px] border-dashed bg-transparent\": indicator === \"dashed\",\r\n                            \"my-0.5\": nestLabel && indicator === \"dashed\",\r\n                          })}\r\n                          style={\r\n                            {\r\n                              \"--color-bg\": indicatorColor,\r\n                              \"--color-border\": indicatorColor,\r\n                            } as React.CSSProperties\r\n                          }\r\n                        />\r\n                      )\r\n                    )}\r\n                    <div\r\n                      className={cn(\r\n                        \"flex flex-1 justify-between leading-none\",\r\n                        nestLabel ? \"items-end\" : \"items-center\",\r\n                      )}\r\n                    >\r\n                      <div className=\"grid gap-1.5\">\r\n                        {nestLabel ? tooltipLabel : null}\r\n                        <span className=\"text-muted-foreground\">{itemConfig?.label || item.name}</span>\r\n                      </div>\r\n                      {item.value && (\r\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\r\n                          {item.value.toLocaleString()}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n    );\r\n  },\r\n);\r\nChartTooltipContent.displayName = \"ChartTooltip\";\r\n\r\nconst ChartLegend = RechartsPrimitive.Legend;\r\n\r\nconst ChartLegendContent = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\"> &\r\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\r\n      hideIcon?: boolean;\r\n      nameKey?: string;\r\n    }\r\n>(({ className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey }, ref) => {\r\n  const { config } = useChart();\r\n\r\n  if (!payload?.length) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      className={cn(\"flex items-center justify-center gap-4\", verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\", className)}\r\n    >\r\n      {payload.map((item) => {\r\n        const key = `${nameKey || item.dataKey || \"value\"}`;\r\n        const itemConfig = getPayloadConfigFromPayload(config, item, key);\r\n\r\n        return (\r\n          <div\r\n            key={item.value}\r\n            className={cn(\"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\")}\r\n          >\r\n            {itemConfig?.icon && !hideIcon ? (\r\n              <itemConfig.icon />\r\n            ) : (\r\n              <div\r\n                className=\"h-2 w-2 shrink-0 rounded-[2px]\"\r\n                style={{\r\n                  backgroundColor: item.color,\r\n                }}\r\n              />\r\n            )}\r\n            {itemConfig?.label}\r\n          </div>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n});\r\nChartLegendContent.displayName = \"ChartLegend\";\r\n\r\n// Helper to extract item config from a payload.\r\nfunction getPayloadConfigFromPayload(config: ChartConfig, payload: unknown, key: string) {\r\n  if (typeof payload !== \"object\" || payload === null) {\r\n    return undefined;\r\n  }\r\n\r\n  const payloadPayload =\r\n    \"payload\" in payload && typeof payload.payload === \"object\" && payload.payload !== null\r\n      ? payload.payload\r\n      : undefined;\r\n\r\n  let configLabelKey: string = key;\r\n\r\n  if (key in payload && typeof payload[key as keyof typeof payload] === \"string\") {\r\n    configLabelKey = payload[key as keyof typeof payload] as string;\r\n  } else if (\r\n    payloadPayload &&\r\n    key in payloadPayload &&\r\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\r\n  ) {\r\n    configLabelKey = payloadPayload[key as keyof typeof payloadPayload] as string;\r\n  }\r\n\r\n  return configLabelKey in config ? config[configLabelKey] : config[key as keyof typeof config];\r\n}\r\n\r\nexport { ChartContainer, ChartTooltip, ChartTooltipContent, ChartLegend, ChartLegendContent, ChartStyle };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\collapsible.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\command.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":24,"column":11,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":24,"endColumn":29,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[733,784],"text":"type CommandDialogProps = DialogProps"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\r\nimport { type DialogProps } from \"@radix-ui/react-dialog\";\r\nimport { Command as CommandPrimitive } from \"cmdk\";\r\nimport { Search } from \"lucide-react\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\";\r\n\r\nconst Command = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive\r\n    ref={ref}\r\n    className={cn(\r\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nCommand.displayName = CommandPrimitive.displayName;\r\n\r\ninterface CommandDialogProps extends DialogProps {}\r\n\r\nconst CommandDialog = ({ children, ...props }: CommandDialogProps) => {\r\n  return (\r\n    <Dialog {...props}>\r\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\r\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\r\n          {children}\r\n        </Command>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nconst CommandInput = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Input>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\r\n>(({ className, ...props }, ref) => (\r\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\r\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\r\n    <CommandPrimitive.Input\r\n      ref={ref}\r\n      className={cn(\r\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  </div>\r\n));\r\n\r\nCommandInput.displayName = CommandPrimitive.Input.displayName;\r\n\r\nconst CommandList = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.List>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.List\r\n    ref={ref}\r\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\r\n    {...props}\r\n  />\r\n));\r\n\r\nCommandList.displayName = CommandPrimitive.List.displayName;\r\n\r\nconst CommandEmpty = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Empty>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\r\n>((props, ref) => <CommandPrimitive.Empty ref={ref} className=\"py-6 text-center text-sm\" {...props} />);\r\n\r\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName;\r\n\r\nconst CommandGroup = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Group>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Group\r\n    ref={ref}\r\n    className={cn(\r\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\n\r\nCommandGroup.displayName = CommandPrimitive.Group.displayName;\r\n\r\nconst CommandSeparator = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Separator>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Separator ref={ref} className={cn(\"-mx-1 h-px bg-border\", className)} {...props} />\r\n));\r\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName;\r\n\r\nconst CommandItem = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Item>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Item\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\n\r\nCommandItem.displayName = CommandPrimitive.Item.displayName;\r\n\r\nconst CommandShortcut = ({ className, ...props }: React.HTMLAttributes<HTMLSpanElement>) => {\r\n  return <span className={cn(\"ml-auto text-xs tracking-widest text-muted-foreground\", className)} {...props} />;\r\n};\r\nCommandShortcut.displayName = \"CommandShortcut\";\r\n\r\nexport {\r\n  Command,\r\n  CommandDialog,\r\n  CommandInput,\r\n  CommandList,\r\n  CommandEmpty,\r\n  CommandGroup,\r\n  CommandItem,\r\n  CommandShortcut,\r\n  CommandSeparator,\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\context-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\drawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\form.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\hover-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\input-otp.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\menubar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\navigation-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\pagination.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\radio-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\resizable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\slider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\sonner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\textarea.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":5,"column":18,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":5,"endColumn":31,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[79,163],"text":"type TextareaProps = React.TextareaHTMLAttributes<HTMLTextAreaElement>"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nexport interface TextareaProps extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\r\n\r\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(({ className, ...props }, ref) => {\r\n  return (\r\n    <textarea\r\n      className={cn(\r\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\r\n        className,\r\n      )}\r\n      ref={ref}\r\n      {...props}\r\n    />\r\n  );\r\n});\r\nTextarea.displayName = \"Textarea\";\r\n\r\nexport { Textarea };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\toaster.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\toggle-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\toggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\components\\ui\\use-toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\contexts\\AuthContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3297,3300],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3297,3300],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":124,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5216,5219],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5216,5219],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":159,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6763,6766],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6763,6766],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":197,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8273,8276],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8273,8276],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":199,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8377,8380],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8377,8380],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":292,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":292,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11547,11550],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11547,11550],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":320,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":320,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":359,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":359,"endColumn":19}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\r\nimport { storageService } from '@/services/storageService';\r\nimport { logError } from '@/lib/errorHandler';\r\nimport { localApi } from '@/integrations/orion/client';\r\nimport { permissionsSignal, uiSignal, currentUserSignal, isAuthLoadingSignal } from '@/signals/authSignals';\r\n\r\n\r\ninterface Profile {\r\n  id: string;\r\n  fullName: string;\r\n  username: string;\r\n  email?: string;\r\n  avatarUrl: string | null;\r\n  image?: string | null;\r\n  role: 'SUPER_ADMIN' | 'SUPER_ADMIN_GOD' | 'ADMIN' | 'TI_SOFTWARE' | 'GESTOR_PROJECT' | 'GESTOR_CANTEIRO' | 'SUPERVISOR' | 'WORKER' | 'VIEWER' | 'HELPER_SYSTEM';\r\n  registrationNumber?: string;\r\n  employeeId?: string;\r\n  companyId?: string;\r\n  projectId?: string;\r\n  siteId?: string | null;\r\n  isSystemAdmin?: boolean;\r\n  hierarchyLevel?: number;\r\n  mfaEnabled?: boolean;\r\n  mfaSecret?: string;\r\n  permissionsMap?: Record<string, boolean>;\r\n  ui?: Record<string, boolean>;\r\n}\r\n\r\ninterface OfflineAccount {\r\n  identifier: string;\r\n  fullName: string;\r\n  avatarUrl?: string | null;\r\n  role: string;\r\n  cachedAt: number;\r\n}\r\n\r\ninterface AuthContextType {\r\n  user: { id: string; email?: string } & Record<string, unknown> | null;\r\n  session: Record<string, unknown> | null;\r\n  profile: Profile | null;\r\n  isLoading: boolean;\r\n  login: (email: string, password: string) => Promise<{ success: boolean; error?: string; mfaRequired?: boolean; profile?: Profile }>;\r\n  loginOffline: () => Promise<{ success: boolean; error?: string }>;\r\n  getLastOfflineAccount: () => Promise<OfflineAccount | null>;\r\n  logout: () => Promise<void>;\r\n  register: (email: string, password: string, name: string, phone?: string) => Promise<{ success: boolean; error?: string }>;\r\n  resetPassword: (email: string) => Promise<{ success: boolean; error?: string }>;\r\n  changePassword: (newPassword: string) => Promise<{ success: boolean; error?: string }>;\r\n  disableMfa: () => Promise<{ success: boolean; error?: string }>;\r\n  enableMfa: (secret: string) => Promise<{ success: boolean; error?: string }>;\r\n  isMfaVerified: boolean;\r\n  setMfaVerified: (verified: boolean) => void;\r\n  refreshProfile: () => Promise<void>;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport function AuthProvider({ children }: { children: ReactNode }) {\r\n  const [user, setUser] = useState<({ id: string; email?: string } & Record<string, unknown>) | null>(null);\r\n  const [session, setSession] = useState<Record<string, unknown> | null>(null);\r\n  const [profile, setProfile] = useState<Profile | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [isMfaVerified, setIsMfaVerified] = useState<boolean>(() => {\r\n    return sessionStorage.getItem('mfa_verified') === 'true';\r\n  });\r\n\r\n  const setMfaVerified = (verified: boolean) => {\r\n    setIsMfaVerified(verified);\r\n    sessionStorage.setItem('mfa_verified', verified ? 'true' : 'false');\r\n  };\r\n\r\n  const fetchProfile = React.useCallback(async (userId: string): Promise<Profile | undefined> => {\r\n    if (!userId || userId === 'undefined') {\r\n      console.warn('[AuthContext] fetchProfile called with invalid userId:', userId);\r\n      return undefined;\r\n    }\r\n    try {\r\n      let userData: Record<string, any> = {};\r\n      let permissions: Record<string, boolean> = {};\r\n      let ui: Record<string, boolean> = {};\r\n\r\n      // 1. Buscar Perfil do Backend Local (Endpoint dedicado que calcula permissões)\r\n      try {\r\n        // Tentativa via REST padrão do Backend ORION\r\n        const response = await localApi.get('/users/me');\r\n\r\n        if (response.data) {\r\n          console.log('[AuthContext] Fetched profile with permissions from /users/me:', response.data);\r\n          userData = response.data;\r\n        } else {\r\n          // Fallback se falhar\r\n          console.warn('[AuthContext] /users/me returned empty. Trying fallback DB fetch.');\r\n          const { data: localProfile } = await localApi.from('users').eq('id', userId).single();\r\n          if (localProfile) userData = localProfile;\r\n        }\r\n\r\n      } catch (err) {\r\n        console.error('[AuthContext] Failed to fetch profile from API:', err);\r\n        // Fallback final\r\n        const { data: localProfile } = await localApi.from('users').eq('id', userId).single();\r\n        userData = localProfile;\r\n      }\r\n\r\n      if (!userData) {\r\n        console.warn('[AuthContext] No profile data found for userId:', userId);\r\n        return undefined;\r\n      }\r\n\r\n      // Buscar Matriz de Permissões e UI Flags (Agora vem pronto do Backend no userData)\r\n      if (userData.permissions) {\r\n        permissions = userData.permissions;\r\n      }\r\n      if (userData.ui) {\r\n        ui = userData.ui;\r\n      }\r\n\r\n      const newProfile: Profile = {\r\n        id: userData.id || userId,\r\n        username: userData.username || userData.email?.split('@')[0],\r\n        fullName: userData.name || userData.fullName || 'Usuário',\r\n        email: userData.email,\r\n        avatarUrl: userData.image || userData.avatarUrl || userData.avatar_url,\r\n        image: userData.image || userData.avatarUrl || userData.avatar_url,\r\n        role: (userData.role?.toUpperCase() as any) || 'WORKER',\r\n        registrationNumber: userData.registrationNumber || userData.registration_number,\r\n        employeeId: userData.id,\r\n        companyId: userData.companyId || userData.company_id,\r\n        projectId: userData.projectId || userData.project_id,\r\n        siteId: userData.siteId || userData.site_id,\r\n        isSystemAdmin: (() => {\r\n          const GodRoles = ['SUPER_ADMIN_GOD', 'SUPERADMINGOD', 'SOCIO_DIRETOR', 'SOCIODIRETOR', 'TI_SOFTWARE', 'TISOFTWARE', 'HELPER_SYSTEM'];\r\n          return !!userData.isSystemAdmin || GodRoles.includes((userData.role || '').toUpperCase());\r\n        })(),\r\n        mfaEnabled: !!userData.mfaEnabled,\r\n        mfaSecret: userData?.mfaSecret,\r\n        permissionsMap: permissions,\r\n        ui\r\n      };\r\n\r\n      setProfile(newProfile);\r\n      permissionsSignal.value = permissions; // Popular Signal global\r\n      uiSignal.value = ui; // Popular UI Signal global\r\n      currentUserSignal.value = newProfile;\r\n\r\n      const cacheKey = `profile_cache_${newProfile.id}`;\r\n      await storageService.setItem(cacheKey, newProfile);\r\n      return newProfile;\r\n    } catch (error) {\r\n      console.error('Error fetching profile:', error);\r\n      return undefined;\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const { data: { subscription } } = localApi.auth.onAuthStateChange(\r\n      (event, session) => {\r\n        setSession(session);\r\n        setUser((session?.user as ({ id: string; email?: string } & Record<string, unknown>)) ?? null);\r\n        currentUserSignal.value = (session?.user as any) ?? null; // Sincronizar Signal\r\n\r\n        if (session?.user) {\r\n          setTimeout(() => fetchProfile(session.user.id), 0);\r\n        } else {\r\n          setProfile(null);\r\n          permissionsSignal.value = {}; // Limpar permissões\r\n          uiSignal.value = {}; // Limpar UI flags\r\n          currentUserSignal.value = null;\r\n        }\r\n      }\r\n    );\r\n\r\n    const initAuth = async () => {\r\n      isAuthLoadingSignal.value = true;\r\n      // Carregar estado de verificação MFA do storage\r\n      const savedMfa = sessionStorage.getItem('mfa_verified') === 'true';\r\n      if (savedMfa) setIsMfaVerified(true);\r\n\r\n      const { data: { session: currentSession } } = await localApi.auth.getSession();\r\n\r\n      if (currentSession?.user) {\r\n        setSession(currentSession);\r\n        setUser(currentSession.user as ({ id: string; email?: string } & Record<string, unknown>));\r\n        currentUserSignal.value = currentSession.user;\r\n\r\n        const cacheKey = `profile_cache_${currentSession.user.id}`;\r\n        const cachedProfile = await storageService.getItem<Profile>(cacheKey);\r\n\r\n        if (cachedProfile && cachedProfile.id === currentSession.user.id) {\r\n          setProfile(cachedProfile);\r\n          permissionsSignal.value = cachedProfile.permissionsMap || {};\r\n          uiSignal.value = cachedProfile.ui || {};\r\n        }\r\n\r\n        await fetchProfile(currentSession.user.id);\r\n      } else {\r\n        // ... (resto do código igual)\r\n        const savedWorker = await storageService.getItem<any>('manual_worker_session');\r\n        if (savedWorker) {\r\n          setUser({ id: savedWorker.id } as any);\r\n          setProfile(savedWorker.profile);\r\n        }\r\n      }\r\n      setIsLoading(false);\r\n      isAuthLoadingSignal.value = false;\r\n    };\r\n\r\n    initAuth();\r\n    return () => subscription.unsubscribe();\r\n  }, [fetchProfile]);\r\n\r\n  const login = React.useCallback(async (usernameOrEmail: string, password: string): Promise<{ success: boolean; error?: string; mfaRequired?: boolean; profile?: Profile }> => {\r\n    try {\r\n      const { data, error } = await localApi.auth.signInWithPassword({\r\n        email: usernameOrEmail,\r\n        password: password,\r\n      });\r\n\r\n      if (error) {\r\n        return { success: false, error: error.message || 'Erro ao realizar login' };\r\n      }\r\n\r\n      if (data?.user && data?.session) {\r\n        const fetchedProfile = await fetchProfile(data.user.id);\r\n        setIsMfaVerified(false);\r\n        sessionStorage.removeItem('mfa_verified');\r\n\r\n        if (fetchedProfile?.mfaEnabled) {\r\n          return { success: true, mfaRequired: true, profile: fetchedProfile };\r\n        }\r\n        return { success: true, profile: fetchedProfile };\r\n      }\r\n\r\n      return { success: false, error: 'Erro inesperado durante o login' };\r\n    } catch (error) {\r\n      logError('Login', error);\r\n      return { success: false, error: error.message || 'Erro ao realizar login' };\r\n    }\r\n  }, [fetchProfile]);\r\n\r\n  const getLastOfflineAccount = React.useCallback(async (): Promise<OfflineAccount | null> => {\r\n    try {\r\n      const lastAccount = await storageService.getItem<{\r\n        identifier: string;\r\n        profile: Profile;\r\n        cachedAt: number;\r\n      }>('last_offline_account');\r\n\r\n      if (!lastAccount) return null;\r\n\r\n      const thirtyDays = 30 * 24 * 60 * 60 * 1000;\r\n      if (Date.now() - lastAccount.cachedAt > thirtyDays) {\r\n        await storageService.removeItem('last_offline_account');\r\n        return null;\r\n      }\r\n\r\n      return {\r\n        identifier: lastAccount.identifier,\r\n        fullName: lastAccount.profile.fullName,\r\n        avatarUrl: lastAccount.profile.avatarUrl,\r\n        role: lastAccount.profile.role,\r\n        cachedAt: lastAccount.cachedAt\r\n      };\r\n    } catch {\r\n      return null;\r\n    }\r\n  }, []);\r\n\r\n  const loginOffline = React.useCallback(async (): Promise<{ success: boolean; error?: string }> => {\r\n    try {\r\n      const lastAccount = await storageService.getItem<{\r\n        identifier: string;\r\n        profile: Profile;\r\n        passwordHash: string;\r\n        cachedAt: number;\r\n      }>('last_offline_account');\r\n\r\n      if (!lastAccount) return { success: false, error: 'Nenhuma conta disponível para login offline' };\r\n\r\n      const thirtyDays = 30 * 24 * 60 * 60 * 1000;\r\n      if (Date.now() - lastAccount.cachedAt > thirtyDays) {\r\n        await storageService.removeItem('last_offline_account');\r\n        return { success: false, error: 'Credenciais offline expiradas. Conecte-se online.' };\r\n      }\r\n\r\n      const workerProfile = lastAccount.profile;\r\n      await storageService.setItem('manual_worker_session', {\r\n        id: workerProfile.id,\r\n        profile: workerProfile\r\n      });\r\n\r\n      setProfile(workerProfile);\r\n      setUser({ id: workerProfile.id } as any);\r\n      setIsLoading(false);\r\n\r\n      return { success: true };\r\n    } catch (error) {\r\n      logError('LoginOffline', error);\r\n      return { success: false, error: 'Erro ao realizar login offline' };\r\n    }\r\n  }, []);\r\n\r\n  const register = React.useCallback(async (email: string, password: string, name: string, phone?: string): Promise<{ success: boolean; error?: string }> => {\r\n    try {\r\n      const { error } = await localApi.auth.signUp({\r\n        email,\r\n        password,\r\n        options: {\r\n          data: {\r\n            name,\r\n            phone,\r\n          },\r\n        },\r\n      });\r\n\r\n      if (error) {\r\n        return { success: false, error: error.message };\r\n      }\r\n\r\n      return { success: true };\r\n    } catch (error) {\r\n      return { success: false, error: 'Erro ao criar conta' };\r\n    }\r\n  }, []);\r\n\r\n  const logout = React.useCallback(async () => {\r\n    if (profile) {\r\n      try {\r\n        await storageService.setItem('last_offline_account', {\r\n          identifier: profile.email || profile.registrationNumber || profile.username,\r\n          profile: profile,\r\n          passwordHash: '',\r\n          cachedAt: Date.now()\r\n        });\r\n      } catch (err) {\r\n        console.warn('[Auth] Failed to cache last account:', err);\r\n      }\r\n    }\r\n\r\n    await localApi.auth.signOut();\r\n\r\n    await storageService.removeItem('manual_worker_session');\r\n    sessionStorage.removeItem('mfa_verified');\r\n\r\n    setUser(null);\r\n    setSession(null);\r\n    setProfile(null);\r\n    setIsMfaVerified(false);\r\n  }, [profile]);\r\n\r\n  const resetPassword = React.useCallback(async (email: string): Promise<{ success: boolean; error?: string }> => {\r\n    try {\r\n      const { error } = await localApi.auth.resetPasswordForEmail(email);\r\n\r\n      if (error) {\r\n        return { success: false, error: error.message };\r\n      }\r\n\r\n      return { success: true };\r\n    } catch (error) {\r\n      return { success: false, error: 'Erro ao recuperar senha' };\r\n    }\r\n  }, []);\r\n\r\n  const changePassword = React.useCallback(async (newPassword: string): Promise<{ success: boolean; error?: string }> => {\r\n    try {\r\n      const { error } = await localApi.auth.updateUser({ password: newPassword });\r\n      if (error) throw error;\r\n      return { success: true };\r\n    } catch (error) {\r\n      console.error('Change Password Error:', error);\r\n      return { success: false, error: error.message || 'Erro ao alterar senha' };\r\n    }\r\n  }, []);\r\n\r\n  const disableMfa = React.useCallback(async (): Promise<{ success: boolean; error?: string }> => {\r\n    try {\r\n      if (!user) throw new Error('Usuário não autenticado');\r\n      const { error } = await localApi\r\n        .from('users')\r\n        .update({ mfaEnabled: false, mfaSecret: null })\r\n        .eq('id', user.id);\r\n      if (error) throw error;\r\n\r\n      setMfaVerified(false);\r\n      await fetchProfile(user.id);\r\n      return { success: true };\r\n    } catch (error) {\r\n      console.error('Disable MFA Error:', error);\r\n      return { success: false, error: error.message || 'Erro ao desativar MFA' };\r\n    }\r\n  }, [user, fetchProfile]);\r\n\r\n  const enableMfa = React.useCallback(async (secret: string): Promise<{ success: boolean; error?: string }> => {\r\n    try {\r\n      if (!user) throw new Error('Usuário não autenticado');\r\n      const { error } = await localApi\r\n        .from('users')\r\n        .update({ mfaEnabled: true, mfaSecret: secret })\r\n        .eq('id', user.id);\r\n      if (error) throw error;\r\n\r\n      setMfaVerified(true);\r\n      await fetchProfile(user.id);\r\n      return { success: true };\r\n    } catch (error) {\r\n      console.error('Enable MFA Error:', error);\r\n      return { success: false, error: error.message || 'Erro ao ativar MFA' };\r\n    }\r\n  }, [user, fetchProfile]);\r\n\r\n  const value = React.useMemo(() => ({\r\n    user,\r\n    session,\r\n    profile,\r\n    isLoading,\r\n    login,\r\n    loginOffline,\r\n    getLastOfflineAccount,\r\n    logout,\r\n    register,\r\n    resetPassword,\r\n    changePassword,\r\n    disableMfa,\r\n    enableMfa,\r\n    isMfaVerified,\r\n    setMfaVerified,\r\n    refreshProfile: async () => {\r\n      if (user?.id) await fetchProfile(user.id);\r\n    }\r\n  }), [user, session, profile, isLoading, login, loginOffline, getLastOfflineAccount, logout, register, resetPassword, changePassword, disableMfa, enableMfa, isMfaVerified, fetchProfile]);\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useAuth() {\r\n  const context = useContext(AuthContext);\r\n  if (context === undefined) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\contexts\\CacheWarmingContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[382,385],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[382,385],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'profile', 'user', and 'warmCache'. Either include them or remove the dependency array.","line":53,"column":8,"nodeType":"ArrayExpression","endLine":53,"endColumn":42,"suggestions":[{"desc":"Update the dependencies array to be: [user.id, profile.id, isLoading, user, profile, warmCache]","fix":{"range":[2155,2189],"text":"[user.id, profile.id, isLoading, user, profile, warmCache]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useEffect, useRef, ReactNode } from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useCacheWarming } from '@/hooks/useCacheWarming';\r\nimport { cacheService } from '@/services/cacheService';\r\n\r\ninterface CacheWarmingContextType {\r\n    warmCache: (force?: boolean) => Promise<void>;\r\n    getCacheStatus: () => Promise<any[]>;\r\n    clearAllCaches: () => Promise<void>;\r\n    isWarming: boolean;\r\n}\r\n\r\nconst CacheWarmingContext = createContext<CacheWarmingContextType | undefined>(undefined);\r\n\r\n/**\r\n * CacheWarmingProvider - Gerencia cache warming automático após login\r\n * \r\n * Este provider deve ser usado DENTRO do AuthProvider para ter acesso ao contexto de auth.\r\n * Automaticamente inicia o cache warming quando detecta um login bem-sucedido.\r\n */\r\nexport function CacheWarmingProvider({ children }: { children: ReactNode }) {\r\n    const { user, profile, isLoading } = useAuth();\r\n    const { warmCache, getCacheStatus, clearAllCaches, isWarming } = useCacheWarming();\r\n\r\n    // Refs para controle estável (evita re-renders disparando múltiplas vezes)\r\n    const hasWarmedRef = useRef(false);\r\n    const lastUserIdRef = useRef<string | null>(null);\r\n\r\n    // Executar cache warming quando usuário faz login (apenas uma vez por sessão)\r\n    useEffect(() => {\r\n        // Aguardar carregamento inicial\r\n        if (isLoading) return;\r\n\r\n        // Se tem usuário e perfil\r\n        if (user && profile) {\r\n            // Verificar se já fez warming para este usuário\r\n            if (hasWarmedRef.current && lastUserIdRef.current === user.id) {\r\n                return; // Já executou para este usuário\r\n            }\r\n\r\n            hasWarmedRef.current = true;\r\n            lastUserIdRef.current = user.id;\r\n\r\n            // Executar de forma assíncrona sem bloquear\r\n            warmCache(false).catch(err => {\r\n                console.error('[CacheWarmingProvider] Cache warming error:', err);\r\n            });\r\n        } else {\r\n            // Resetar flags quando não há usuário\r\n            hasWarmedRef.current = false;\r\n            lastUserIdRef.current = null;\r\n        }\r\n    }, [user?.id, profile?.id, isLoading]); // Dependências estáveis\r\n\r\n    // Limpar caches quando usuário faz logout\r\n    useEffect(() => {\r\n        if (!isLoading && !user) {\r\n            cacheService.clearAll();\r\n        }\r\n    }, [user, isLoading]);\r\n\r\n    // Limpar caches expirados periodicamente (a cada 5 minutos)\r\n    useEffect(() => {\r\n        const interval = setInterval(() => {\r\n            cacheService.cleanExpired();\r\n        }, 5 * 60 * 1000);\r\n\r\n        return () => clearInterval(interval);\r\n    }, []);\r\n\r\n    return (\r\n        <CacheWarmingContext.Provider value={{\r\n            warmCache,\r\n            getCacheStatus,\r\n            clearAllCaches,\r\n            isWarming,\r\n        }}>\r\n            {children}\r\n        </CacheWarmingContext.Provider>\r\n    );\r\n}\r\n\r\n/**\r\n * Hook para acessar o contexto de cache warming\r\n */\r\nexport function useCacheWarmingContext() {\r\n    const context = useContext(CacheWarmingContext);\r\n    if (context === undefined) {\r\n        throw new Error('useCacheWarmingContext must be used within a CacheWarmingProvider');\r\n    }\r\n    return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\contexts\\SyncContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3429,3432],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3429,3432],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":138,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4817,4820],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4817,4820],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":139,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4855,4858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4855,4858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":145,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5148,5151],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5148,5151],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":155,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5616,5619],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5616,5619],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":159,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5769,5772],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5769,5772],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":167,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5940,5943],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5940,5943],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":168,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":168,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6024,6027],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6024,6027],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":174,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6312,6315],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6312,6315],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":175,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6350,6353],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6350,6353],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":180,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6590,6593],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6590,6593],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'isSyncing'. Either include it or remove the dependency array.","line":263,"column":6,"nodeType":"ArrayExpression","endLine":263,"endColumn":63,"suggestions":[{"desc":"Update the dependencies array to be: [checkConnectivity, isSyncing, syncNow, toast, updatePendingChanges]","fix":{"range":[9048,9105],"text":"[checkConnectivity, isSyncing, syncNow, toast, updatePendingChanges]"}}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useEffect, ReactNode, useCallback } from 'react';\r\nimport { db as db, isLocalMode } from '@/integrations/database';\r\nimport { storageService } from '@/services/storageService';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\ninterface SyncContextType {\r\n  isOnline: boolean;\r\n  isConnected: boolean;\r\n  isSyncing: boolean;\r\n  pendingChanges: number;\r\n  lastSyncTime: Date | null;\r\n  syncNow: () => Promise<void>;\r\n}\r\n\r\nconst SyncContext = createContext<SyncContextType | undefined>(undefined);\r\n\r\nexport function SyncProvider({ children }: { children: ReactNode }) {\r\n  const [isOnline, setIsOnline] = useState(navigator.onLine);\r\n  const [isConnected, setIsConnected] = useState(navigator.onLine);\r\n  const [isSyncing, setIsSyncing] = useState(false);\r\n  const [pendingChanges, setPendingChanges] = useState(0);\r\n  const [lastSyncTime, setLastSyncTime] = useState<Date | null>(null);\r\n  const { toast } = useToast();\r\n\r\n  const updatePendingChanges = useCallback(async () => {\r\n    const queue = await storageService.getSyncQueue();\r\n    setPendingChanges(queue.length);\r\n  }, []);\r\n\r\n  const checkConnectivity = useCallback(async () => {\r\n    if (!navigator.onLine) {\r\n      setIsOnline(false);\r\n      setIsConnected(false);\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      let healthUrl = '';\r\n      if (isLocalMode) {\r\n        const baseUrl = import.meta.env.VITE_API_URL || 'http://localhost:3001';\r\n        healthUrl = baseUrl.includes('/api/v1') ? `${baseUrl}/health` : `${baseUrl}/api/v1/health`;\r\n      } else {\r\n        healthUrl = `${import.meta.env.VITE_db_URL}/rest/v1/`;\r\n      }\r\n\r\n      const headers: Record<string, string> = {};\r\n      if (!isLocalMode) {\r\n        headers['apikey'] = import.meta.env.VITE_db_PUBLISHABLE_KEY;\r\n      }\r\n\r\n      const response = await fetch(healthUrl, {\r\n        method: 'GET',\r\n        headers,\r\n        cache: 'no-store'\r\n      });\r\n\r\n      if (!response.ok && !isLocalMode) throw new Error('Health check failed');\r\n      // No modo local, se o servidor responder (mesmo com 503), consideramos que há conectividade\r\n      // O 503 geralmente indica que o backend está ocupado ou em warmup.\r\n\r\n      setIsOnline(true);\r\n      setIsConnected(true);\r\n      return true;\r\n    } catch (error) {\r\n      if (!isLocalMode) console.warn('Connectivity check failed:', error);\r\n      setIsConnected(isLocalMode); // No local mode, assumimos conectado se falhar o fetch (server down vs health missing)\r\n      return isLocalMode;\r\n    }\r\n  }, []);\r\n\r\n  const isSyncingRef = React.useRef(false);\r\n\r\n  const syncNow = useCallback(async () => {\r\n    // Evitar múltiplas execuções simultâneas usando um ref para estabilidade\r\n    if (isSyncingRef.current) return;\r\n\r\n    // Verificar conectividade real antes de começar\r\n    const connected = await checkConnectivity();\r\n    if (!connected) return;\r\n\r\n    isSyncingRef.current = true;\r\n    setIsSyncing(true);\r\n    try {\r\n      // Create a mutable copy of the queue\r\n      const queueData = await storageService.getSyncQueue();\r\n      const queue = [...queueData];\r\n\r\n      if (queue.length === 0) {\r\n        setLastSyncTime(new Date());\r\n        return;\r\n      }\r\n\r\n      console.log(`Iniciando sincronização de ${queue.length} itens...`);\r\n      let syncedCount = 0;\r\n\r\n      // Helper to update references in the remaining queue items\r\n      const updateQueueReferences = (currentQueue: any[], oldId: string, newId: string, startIndex: number) => {\r\n        for (let i = startIndex; i < currentQueue.length; i++) {\r\n          const item = currentQueue[i];\r\n          if (item.data) {\r\n            Object.keys(item.data).forEach(key => {\r\n              if (item.data[key] === oldId) {\r\n                item.data[key] = newId;\r\n              }\r\n            });\r\n          }\r\n        }\r\n      };\r\n\r\n      for (const item of queue) {\r\n        const syncItem = item as {\r\n          id: number;\r\n          operation: string;\r\n          table: string;\r\n          data?: Record<string, unknown>;\r\n          itemId?: string;\r\n        };\r\n\r\n        try {\r\n          if (syncItem.operation === 'insert') {\r\n            const insertData = { ...syncItem.data };\r\n            const localId = (insertData.localId || syncItem.itemId) as string | undefined;\r\n\r\n            const hasLocalIdColumn = ['time_records', 'daily_reports'].includes(syncItem.table);\r\n            if (!hasLocalIdColumn) {\r\n              delete insertData.localId;\r\n            }\r\n\r\n            Object.keys(insertData).forEach(key => {\r\n              if (insertData[key] === 'none') {\r\n                insertData[key] = null;\r\n              }\r\n            });\r\n\r\n            const dbData = mapToDbColumns(syncItem.table, insertData);\r\n\r\n            let { data, error } = await db\r\n              .from(syncItem.table as any)\r\n              .insert(dbData as any)\r\n              .select()\r\n              .single();\r\n\r\n            if (error && error.code === '23505') {\r\n              if (syncItem.table === 'daily_reports' && dbData['employee_id'] && dbData['report_date']) {\r\n                const { data: existing, error: fetchError } = await (db as any)\r\n                  .from('daily_reports')\r\n                  .select('id')\r\n                  .eq('employee_id', dbData['employee_id'] as string)\r\n                  .eq('report_date', dbData['report_date'] as string)\r\n                  .maybeSingle();\r\n\r\n                if (!fetchError && existing) {\r\n                  const { data: updatedData, error: updateError } = await db\r\n                    .from('daily_reports')\r\n                    .update(dbData as any)\r\n                    .eq('id', existing.id)\r\n                    .select()\r\n                    .single();\r\n                  data = updatedData as any;\r\n                  error = updateError;\r\n                }\r\n              }\r\n            }\r\n\r\n            if (error) throw error;\r\n\r\n            if (data && (data as any).id && localId) {\r\n              updateQueueReferences(queue, localId, (data as any).id, queue.indexOf(item) + 1);\r\n            }\r\n\r\n          } else if (syncItem.operation === 'update' && syncItem.itemId) {\r\n            const dbData = mapToDbColumns(syncItem.table, syncItem.data || {});\r\n            const { error } = await db\r\n              .from(syncItem.table as any)\r\n              .update(dbData as any)\r\n              .eq('id', syncItem.itemId);\r\n            if (error) throw error;\r\n          } else if (syncItem.operation === 'delete' && syncItem.itemId) {\r\n            const { error } = await db\r\n              .from(syncItem.table as any)\r\n              .delete()\r\n              .eq('id', syncItem.itemId);\r\n            if (error) throw error;\r\n          }\r\n\r\n          await storageService.removeFromSyncQueue(syncItem.id);\r\n          syncedCount++;\r\n        } catch (error) {\r\n          console.error(`Falha ao sincronizar item ${syncItem.id} da tabela ${syncItem.table}:`, error);\r\n        }\r\n      }\r\n\r\n      if (syncedCount > 0) {\r\n        toast({\r\n          title: 'Sincronização concluída',\r\n          description: `${syncedCount} ${syncedCount === 1 ? 'item sincronizado' : 'itens sincronizados'}`,\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error('Erro geral no motor de sincronização:', error);\r\n    } finally {\r\n      isSyncingRef.current = false;\r\n      setIsSyncing(false);\r\n      setLastSyncTime(new Date());\r\n      updatePendingChanges();\r\n    }\r\n  }, [checkConnectivity, toast, updatePendingChanges]);\r\n\r\n  useEffect(() => {\r\n    const handleOnline = async () => {\r\n      setIsOnline(true);\r\n      const connected = await checkConnectivity();\r\n      if (connected) {\r\n        const queue = await storageService.getSyncQueue();\r\n        if (queue.length > 0) {\r\n          syncNow();\r\n        }\r\n      }\r\n    };\r\n\r\n    const handleOffline = () => {\r\n      setIsOnline(false);\r\n      setIsConnected(false);\r\n      toast({\r\n        title: 'Sem conexão',\r\n        description: 'Suas alterações serão salvas localmente',\r\n        variant: 'destructive',\r\n      });\r\n    };\r\n\r\n    window.addEventListener('online', handleOnline);\r\n    window.addEventListener('offline', handleOffline);\r\n\r\n    // Initial check\r\n    updatePendingChanges();\r\n    checkConnectivity().then(async connected => {\r\n      if (connected) {\r\n        const queue = await storageService.getSyncQueue();\r\n        if (queue.length > 0) {\r\n          syncNow();\r\n        }\r\n      }\r\n    });\r\n\r\n    // Heartbeat: Check connection and sync every 15 seconds\r\n    const interval = setInterval(async () => {\r\n      const connected = await checkConnectivity();\r\n      if (connected && !isSyncing) {\r\n        const currentQueue = await storageService.getSyncQueue();\r\n        if (currentQueue.length > 0) {\r\n          syncNow();\r\n        } else {\r\n          updatePendingChanges();\r\n        }\r\n      }\r\n    }, 15000);\r\n\r\n    return () => {\r\n      window.removeEventListener('online', handleOnline);\r\n      window.removeEventListener('offline', handleOffline);\r\n      clearInterval(interval);\r\n    };\r\n  }, [checkConnectivity, syncNow, toast, updatePendingChanges]);\r\n\r\n  return (\r\n    <SyncContext.Provider value={{ isOnline, isConnected, isSyncing, pendingChanges, lastSyncTime, syncNow }}>\r\n      {children}\r\n    </SyncContext.Provider>\r\n  );\r\n}\r\n\r\n// Helper function to map frontend field names to database column names\r\nfunction mapToDbColumns(table: string, data: Record<string, unknown>): Record<string, unknown> {\r\n  const mappings: Record<string, Record<string, string>> = {\r\n    job_functions: {\r\n      name: 'name',\r\n      description: 'description',\r\n      canLeadTeam: 'can_lead_team',\r\n    },\r\n    employees: {\r\n      fullName: 'full_name',\r\n      registrationNumber: 'registration_number',\r\n      functionId: 'function_id',\r\n      phone: 'phone',\r\n      email: 'email',\r\n      isActive: 'is_active',\r\n    },\r\n    teams: {\r\n      name: 'name',\r\n      supervisorId: 'supervisor_id',\r\n      isActive: 'is_active',\r\n    },\r\n    time_records: {\r\n      employeeId: 'employee_id',\r\n      teamId: 'team_id',\r\n      recordType: 'record_type',\r\n      photoUrl: 'photo_url',\r\n      latitude: 'latitude',\r\n      longitude: 'longitude',\r\n      recordedAt: 'recorded_at',\r\n      localId: 'local_id',\r\n      createdBy: 'created_by',\r\n      companyId: 'company_id',\r\n    },\r\n    daily_reports: {\r\n      teamId: 'team_id',\r\n      employeeId: 'employee_id',\r\n      reportDate: 'report_date',\r\n      activities: 'activities',\r\n      observations: 'observations',\r\n      localId: 'local_id',\r\n      createdBy: 'created_by',\r\n      companyId: 'company_id',\r\n    },\r\n  };\r\n\r\n  const tableMapping = mappings[table] || {};\r\n  const result: Record<string, unknown> = {};\r\n\r\n  for (const [key, value] of Object.entries(data)) {\r\n    const dbKey = tableMapping[key] || key;\r\n    result[dbKey] = value;\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nexport function useSync() {\r\n  const context = useContext(SyncContext);\r\n  if (context === undefined) {\r\n    throw new Error('useSync must be used within a SyncProvider');\r\n  }\r\n  return context;\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\data\\orion-sequence.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\use-mobile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\use-toast.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'actionTypes' is assigned a value but only used as a type.","line":15,"column":7,"nodeType":null,"messageId":"usedOnlyAsType","endLine":15,"endColumn":18}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\r\n\r\nimport type { ToastActionElement, ToastProps } from \"@/components/ui/toast\";\r\n\r\nconst TOAST_LIMIT = 1;\r\nconst TOAST_REMOVE_DELAY = 1000000;\r\n\r\ntype ToasterToast = ToastProps & {\r\n  id: string;\r\n  title?: React.ReactNode;\r\n  description?: React.ReactNode;\r\n  action?: ToastActionElement;\r\n};\r\n\r\nconst actionTypes = {\r\n  ADD_TOAST: \"ADD_TOAST\",\r\n  UPDATE_TOAST: \"UPDATE_TOAST\",\r\n  DISMISS_TOAST: \"DISMISS_TOAST\",\r\n  REMOVE_TOAST: \"REMOVE_TOAST\",\r\n} as const;\r\n\r\nlet count = 0;\r\n\r\nfunction genId() {\r\n  count = (count + 1) % Number.MAX_SAFE_INTEGER;\r\n  return count.toString();\r\n}\r\n\r\ntype ActionType = typeof actionTypes;\r\n\r\ntype Action =\r\n  | {\r\n      type: ActionType[\"ADD_TOAST\"];\r\n      toast: ToasterToast;\r\n    }\r\n  | {\r\n      type: ActionType[\"UPDATE_TOAST\"];\r\n      toast: Partial<ToasterToast>;\r\n    }\r\n  | {\r\n      type: ActionType[\"DISMISS_TOAST\"];\r\n      toastId?: ToasterToast[\"id\"];\r\n    }\r\n  | {\r\n      type: ActionType[\"REMOVE_TOAST\"];\r\n      toastId?: ToasterToast[\"id\"];\r\n    };\r\n\r\ninterface State {\r\n  toasts: ToasterToast[];\r\n}\r\n\r\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>();\r\n\r\nconst addToRemoveQueue = (toastId: string) => {\r\n  if (toastTimeouts.has(toastId)) {\r\n    return;\r\n  }\r\n\r\n  const timeout = setTimeout(() => {\r\n    toastTimeouts.delete(toastId);\r\n    dispatch({\r\n      type: \"REMOVE_TOAST\",\r\n      toastId: toastId,\r\n    });\r\n  }, TOAST_REMOVE_DELAY);\r\n\r\n  toastTimeouts.set(toastId, timeout);\r\n};\r\n\r\nexport const reducer = (state: State, action: Action): State => {\r\n  switch (action.type) {\r\n    case \"ADD_TOAST\":\r\n      return {\r\n        ...state,\r\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\r\n      };\r\n\r\n    case \"UPDATE_TOAST\":\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.map((t) => (t.id === action.toast.id ? { ...t, ...action.toast } : t)),\r\n      };\r\n\r\n    case \"DISMISS_TOAST\": {\r\n      const { toastId } = action;\r\n\r\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\r\n      // but I'll keep it here for simplicity\r\n      if (toastId) {\r\n        addToRemoveQueue(toastId);\r\n      } else {\r\n        state.toasts.forEach((toast) => {\r\n          addToRemoveQueue(toast.id);\r\n        });\r\n      }\r\n\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.map((t) =>\r\n          t.id === toastId || toastId === undefined\r\n            ? {\r\n                ...t,\r\n                open: false,\r\n              }\r\n            : t,\r\n        ),\r\n      };\r\n    }\r\n    case \"REMOVE_TOAST\":\r\n      if (action.toastId === undefined) {\r\n        return {\r\n          ...state,\r\n          toasts: [],\r\n        };\r\n      }\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\r\n      };\r\n  }\r\n};\r\n\r\nconst listeners: Array<(state: State) => void> = [];\r\n\r\nlet memoryState: State = { toasts: [] };\r\n\r\nfunction dispatch(action: Action) {\r\n  memoryState = reducer(memoryState, action);\r\n  listeners.forEach((listener) => {\r\n    listener(memoryState);\r\n  });\r\n}\r\n\r\ntype Toast = Omit<ToasterToast, \"id\">;\r\n\r\nfunction toast({ ...props }: Toast) {\r\n  const id = genId();\r\n\r\n  const update = (props: ToasterToast) =>\r\n    dispatch({\r\n      type: \"UPDATE_TOAST\",\r\n      toast: { ...props, id },\r\n    });\r\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id });\r\n\r\n  dispatch({\r\n    type: \"ADD_TOAST\",\r\n    toast: {\r\n      ...props,\r\n      id,\r\n      open: true,\r\n      onOpenChange: (open) => {\r\n        if (!open) dismiss();\r\n      },\r\n    },\r\n  });\r\n\r\n  return {\r\n    id: id,\r\n    dismiss,\r\n    update,\r\n  };\r\n}\r\n\r\nfunction useToast() {\r\n  const [state, setState] = React.useState<State>(memoryState);\r\n\r\n  React.useEffect(() => {\r\n    listeners.push(setState);\r\n    return () => {\r\n      const index = listeners.indexOf(setState);\r\n      if (index > -1) {\r\n        listeners.splice(index, 1);\r\n      }\r\n    };\r\n  }, [state]);\r\n\r\n  return {\r\n    ...state,\r\n    toast,\r\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\r\n  };\r\n}\r\n\r\nexport { useToast, toast };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\useAuditLogs.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AuditLog' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'companyId' is defined but never used.","line":4,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":39}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect } from 'react';\r\nimport { AuditLog, auditLogs, isLoadingAudit, fetchAuditLogs } from '@/signals/auditSignals';\r\n\r\nexport function useAuditLogs(companyId?: string) {\r\n    useEffect(() => {\r\n        fetchAuditLogs();\r\n    }, []);\r\n\r\n    return {\r\n        data: auditLogs.value,\r\n        isLoading: isLoadingAudit.value,\r\n        refetch: fetchAuditLogs\r\n    };\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\useAuditStats.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[530,533],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[530,533],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { orionApi } from '@/integrations/orion/client';\r\n\r\nexport function useAuditStats() {\r\n    const [pendingCount, setPendingCount] = useState<number>(0);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n\r\n    const loadStats = useCallback(async () => {\r\n        setIsLoading(true);\r\n        try {\r\n            if (navigator.onLine) {\r\n                // Busca logs com status PENDING da rota especializada\r\n                const response = await orionApi.get<any[]>('/production/logs', {\r\n                    pendingOnly: 'true'\r\n                });\r\n\r\n                if (response.error) throw new Error(response.error.message);\r\n                setPendingCount(response.data?.length || 0);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error loading audit stats:', error);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        loadStats();\r\n        // Polling facultativo para manter o dashboard atualizado (ex: a cada 1 minuto)\r\n        const interval = setInterval(loadStats, 60000);\r\n        return () => clearInterval(interval);\r\n    }, [loadStats]);\r\n\r\n    return {\r\n        pendingCount,\r\n        isLoading,\r\n        refresh: loadStats\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\useCacheWarming.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1128,1131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1128,1131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1686,1689],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1686,1689],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2077,2080],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2077,2080],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2464,2467],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2464,2467],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":116,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3953,3956],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3953,3956],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":127,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4376,4379],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4376,4379],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":137,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4746,4749],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4746,4749],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":187,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6265,6268],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6265,6268],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'entitiesToCache'. Either include it or remove the dependency array.","line":204,"column":8,"nodeType":"ArrayExpression","endLine":204,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [entitiesToCache, status.isWarming]","fix":{"range":[6748,6766],"text":"[entitiesToCache, status.isWarming]"}}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useState } from 'react';\r\nimport { db } from '@/integrations/database';\r\nimport { cacheService } from '@/services/cacheService';\r\nimport { CacheableEntity } from '@/services/db';\r\n\r\ninterface CacheWarmingStatus {\r\n    isWarming: boolean;\r\n    progress: number;\r\n    currentEntity: string | null;\r\n    completedEntities: CacheableEntity[];\r\n    errors: { entity: string; error: string }[];\r\n}\r\n\r\n/**\r\n * useCacheWarming - Hook para pré-carregar dados essenciais no cache\r\n * \r\n * Uso após login para garantir funcionamento offline:\r\n * - Carrega dados de referência (funcionários, equipes, funções, etc.)\r\n * - Executa em background sem bloquear a UX\r\n * - Resiliência a erros parciais\r\n */\r\nexport function useCacheWarming() {\r\n    const [status, setStatus] = useState<CacheWarmingStatus>({\r\n        isWarming: false,\r\n        progress: 0,\r\n        currentEntity: null,\r\n        completedEntities: [],\r\n        errors: [],\r\n    });\r\n\r\n    /**\r\n     * Lista de entidades a cachear na ordem de prioridade\r\n     */\r\n    const entitiesToCache: {\r\n        entity: CacheableEntity;\r\n        query: () => Promise<any>;\r\n    }[] = [\r\n            {\r\n                entity: 'jobFunctions',\r\n                query: async () => {\r\n                    const { data, error } = await db\r\n                        .from('job_functions')\r\n                        .select('*')\r\n                        .order('name');\r\n                    if (error) throw error;\r\n                    return data;\r\n                },\r\n            },\r\n            {\r\n                entity: 'companies',\r\n                query: async () => {\r\n                    const { data, error } = await (db as any)\r\n                        .from('companies')\r\n                        .select('*')\r\n                        .order('name');\r\n                    if (error) throw error;\r\n                    return data;\r\n                },\r\n            },\r\n            {\r\n                entity: 'projects',\r\n                query: async () => {\r\n                    const { data, error } = await (db as any)\r\n                        .from('projects')\r\n                        .select('*')\r\n                        .order('name');\r\n                    if (error) throw error;\r\n                    return data;\r\n                },\r\n            },\r\n            {\r\n                entity: 'sites',\r\n                query: async () => {\r\n                    const { data, error } = await (db as any)\r\n                        .from('sites')\r\n                        .select('*')\r\n                        .order('name');\r\n                    if (error) throw error;\r\n                    return data;\r\n                },\r\n            },\r\n            {\r\n                entity: 'teams',\r\n                query: async () => {\r\n                    const { data, error } = await db\r\n                        .from('teams')\r\n                        .select(`\r\n            *,\r\n            supervisor:users!teams_supervisor_id_fkey(id, name)\r\n          `)\r\n                        .eq('is_active', true)\r\n                        .order('name');\r\n                    if (error) throw error;\r\n                    return data;\r\n                },\r\n            },\r\n            {\r\n                entity: 'employees',\r\n                query: async () => {\r\n                    const { data, error } = await db\r\n                        .from('users')\r\n                        .select(`\r\n            *,\r\n            jobFunction:job_functions(id, name, can_lead_team)\r\n          `)\r\n                        .eq('status', 'ACTIVE')\r\n                        .order('name');\r\n                    if (error) throw error;\r\n                    return data;\r\n                },\r\n            },\r\n            {\r\n                entity: 'constructionDocuments',\r\n                query: async () => {\r\n                    const { data, error } = await db\r\n                        .from('construction_documents' as any)\r\n                        .select('*')\r\n                        .order('created_at', { ascending: false });\r\n                    if (error) throw error;\r\n                    return data;\r\n                },\r\n            },\r\n            {\r\n                entity: 'mapElements',\r\n                query: async () => {\r\n                    const { data, error } = await db\r\n                        .from('map_elements' as any)\r\n                        .select('*');\r\n                    if (error) throw error;\r\n                    return data;\r\n                },\r\n            },\r\n            {\r\n                entity: 'towerTechnicalData',\r\n                query: async () => {\r\n                    const { data, error } = await db\r\n                        .from('tower_technical_data' as any)\r\n                        .select('*');\r\n                    if (error) throw error;\r\n                    return data;\r\n                },\r\n            },\r\n        ];\r\n\r\n    /**\r\n     * Executa o warming do cache\r\n     * @param force - Se true, força recarga mesmo com cache válido\r\n     */\r\n    const warmCache = useCallback(async (force: boolean = false) => {\r\n        if (status.isWarming) {\r\n            return;\r\n        }\r\n\r\n\r\n        setStatus({\r\n            isWarming: true,\r\n            progress: 0,\r\n            currentEntity: null,\r\n            completedEntities: [],\r\n            errors: [],\r\n        });\r\n\r\n        const completed: CacheableEntity[] = [];\r\n        const errors: { entity: string; error: string }[] = [];\r\n\r\n        for (let i = 0; i < entitiesToCache.length; i++) {\r\n            const { entity, query } = entitiesToCache[i];\r\n\r\n            setStatus(prev => ({\r\n                ...prev,\r\n                currentEntity: entity,\r\n                progress: (i / entitiesToCache.length) * 100,\r\n            }));\r\n\r\n            try {\r\n                // Verificar se cache já é válido (a menos que force=true)\r\n                if (!force && await cacheService.isValid(entity)) {\r\n                    completed.push(entity);\r\n                    continue;\r\n                }\r\n\r\n                // Buscar dados e cachear\r\n                const data = await query();\r\n                await cacheService.set(entity, data);\r\n                completed.push(entity);\r\n\r\n            } catch (error: any) {\r\n                console.error(`[CacheWarming] Error caching ${entity}:`, error);\r\n                errors.push({ entity, error: error.message || 'Unknown error' });\r\n            }\r\n        }\r\n\r\n        setStatus({\r\n            isWarming: false,\r\n            progress: 100,\r\n            currentEntity: null,\r\n            completedEntities: completed,\r\n            errors,\r\n        });\r\n\r\n        // Limpar caches expirados\r\n        await cacheService.cleanExpired();\r\n\r\n    }, [status.isWarming]);\r\n\r\n    /**\r\n     * Verifica status de todos os caches\r\n     */\r\n    const getCacheStatus = useCallback(async () => {\r\n        return await cacheService.getStatus();\r\n    }, []);\r\n\r\n    /**\r\n     * Invalida todos os caches (útil para logout)\r\n     */\r\n    const clearAllCaches = useCallback(async () => {\r\n        await cacheService.clearAll();\r\n        setStatus({\r\n            isWarming: false,\r\n            progress: 0,\r\n            currentEntity: null,\r\n            completedEntities: [],\r\n            errors: [],\r\n        });\r\n    }, []);\r\n\r\n    return {\r\n        warmCache,\r\n        getCacheStatus,\r\n        clearAllCaches,\r\n        status,\r\n        isWarming: status.isWarming,\r\n    };\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\useCompanies.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[945,948],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[945,948],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1416,1419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1416,1419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2610,2613],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2610,2613],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3106,3109],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3106,3109],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":108,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4034,4037],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4034,4037],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":117,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4431,4434],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4431,4434],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":125,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4917,4920],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4917,4920],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":146,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5694,5697],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5694,5697],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":154,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6006,6009],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6006,6009],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":163,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6277,6280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6277,6280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { db } from '@/integrations/database';\r\nimport { storageService } from '@/services/storageService';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\nexport interface Company {\r\n    id: string;\r\n    name: string;\r\n    taxId: string | null;\r\n    address: string | null;\r\n    phone: string | null;\r\n    logoUrl: string | null;\r\n    createdAt: Date;\r\n}\r\n\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { isGestaoGlobal, isCorporateRole } from '@/utils/permissionHelpers';\r\n\r\nexport function useCompanies() {\r\n    const [companies, setCompanies] = useState<Company[]>([]);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const { toast } = useToast();\r\n    const { profile } = useAuth();\r\n\r\n    const loadCompanies = useCallback(async () => {\r\n        setIsLoading(true);\r\n        try {\r\n            if (navigator.onLine) {\r\n                let query = (db as any).from('companies').select('*').order('name');\r\n\r\n                // Security filtering\r\n                const isGod = isGestaoGlobal(profile) || isCorporateRole(profile?.role);\r\n                if (!isGod && profile?.companyId) {\r\n                    query = query.eq('id', profile.companyId);\r\n                }\r\n\r\n                const { data, error } = await query;\r\n\r\n                if (error) throw error;\r\n\r\n                const mapped = (data || []).map((c: any) => ({\r\n                    id: c.id,\r\n                    name: c.name,\r\n                    taxId: c.taxId || c.tax_id,\r\n                    address: c.address,\r\n                    phone: c.phone,\r\n                    logoUrl: c.logoUrl || c.logo_url,\r\n                    createdAt: new Date(c.createdAt || c.created_at || Date.now()),\r\n                }));\r\n\r\n                setCompanies(mapped);\r\n                storageService.setItem('companies', mapped);\r\n            } else {\r\n                const cached = await storageService.getItem<Company[]>('companies') || [];\r\n                setCompanies(cached);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error loading companies:', error);\r\n            const cached = await storageService.getItem<Company[]>('companies') || [];\r\n            setCompanies(cached);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }, [profile]);\r\n\r\n    useEffect(() => {\r\n        loadCompanies();\r\n    }, [loadCompanies]);\r\n\r\n    const createCompany = async (data: Partial<Company>) => {\r\n        console.log('[useCompanies] Criando empresa com dados:', data);\r\n        try {\r\n            const payload: any = {\r\n                name: data.name?.trim()\r\n            };\r\n            if (data.taxId?.trim()) payload.taxId = data.taxId.trim();\r\n            if (data.address?.trim()) payload.address = data.address.trim();\r\n            if (data.phone?.trim()) payload.phone = data.phone.trim();\r\n            if (data.logoUrl?.trim()) payload.logoUrl = data.logoUrl.trim();\r\n\r\n            console.log('[useCompanies] Payload final:', payload);\r\n\r\n            const { data: created, error } = await (db as any)\r\n                .from('companies')\r\n                .insert(payload)\r\n                .select()\r\n                .single();\r\n\r\n            if (error) {\r\n                console.error('[useCompanies] Erro na inserção:', error);\r\n                throw error;\r\n            }\r\n\r\n            console.log('[useCompanies] Empresa criada com sucesso:', created);\r\n\r\n            const newCompany: Company = {\r\n                id: created.id,\r\n                name: created.name,\r\n                taxId: created.taxId || created.tax_id,\r\n                address: created.address,\r\n                phone: created.phone,\r\n                logoUrl: created.logoUrl || created.logo_url,\r\n                createdAt: new Date(created.createdAt || created.created_at || Date.now())\r\n            };\r\n\r\n            setCompanies(prev => [...prev, newCompany]);\r\n            return { success: true, data: newCompany };\r\n        } catch (error: any) {\r\n            console.error('[useCompanies] Exception in createCompany:', error);\r\n            toast({ title: 'Erro ao criar empresa', description: error.message, variant: 'destructive' });\r\n            return { success: false, error: error.message };\r\n        }\r\n    };\r\n\r\n    const updateCompany = async (id: string, data: Partial<Company>) => {\r\n        try {\r\n            const payload: any = {\r\n                name: data.name?.trim()\r\n            };\r\n            if (data.taxId !== undefined) payload.taxId = data.taxId?.trim() || null;\r\n            if (data.address !== undefined) payload.address = data.address?.trim() || null;\r\n            if (data.phone !== undefined) payload.phone = data.phone?.trim() || null;\r\n            if (data.logoUrl !== undefined) payload.logoUrl = data.logoUrl?.trim() || null;\r\n\r\n            const { data: updated, error } = await (db as any)\r\n                .from('companies')\r\n                .update(payload)\r\n                .eq('id', id)\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n\r\n            const mapped: Company = {\r\n                id: updated.id,\r\n                name: updated.name,\r\n                taxId: updated.taxId || updated.tax_id,\r\n                address: updated.address,\r\n                phone: updated.phone,\r\n                logoUrl: updated.logoUrl || updated.logo_url,\r\n                createdAt: new Date(updated.createdAt || updated.created_at || Date.now())\r\n            };\r\n\r\n            setCompanies(prev => prev.map(c => c.id === id ? mapped : c));\r\n            return { success: true, data: mapped };\r\n        } catch (error: any) {\r\n            toast({ title: 'Erro ao atualizar empresa', description: error.message, variant: 'destructive' });\r\n            return { success: false, error: error.message };\r\n        }\r\n    };\r\n\r\n    const deleteCompany = async (id: string) => {\r\n        try {\r\n            const { error } = await (db as any)\r\n                .from('companies')\r\n                .delete()\r\n                .eq('id', id);\r\n\r\n            if (error) throw error;\r\n\r\n            setCompanies(prev => prev.filter(c => c.id !== id));\r\n            return { success: true };\r\n        } catch (error: any) {\r\n            toast({ title: 'Erro ao excluir empresa', description: error.message, variant: 'destructive' });\r\n            return { success: false, error: error.message };\r\n        }\r\n    };\r\n\r\n    return {\r\n        companies,\r\n        isLoading,\r\n        createCompany,\r\n        updateCompany,\r\n        deleteCompany,\r\n        refresh: loadCompanies\r\n    };\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\useConstructionDocuments.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[592,595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[592,595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1097,1100],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1097,1100],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1529,1532],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1529,1532],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2226,2229],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2226,2229],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'companyId'. Either include it or remove the dependency array.","line":65,"column":8,"nodeType":"ArrayExpression","endLine":65,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [companyId, projectId, siteId]","fix":{"range":[2370,2389],"text":"[companyId, projectId, siteId]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'uploadData' is assigned a value but never used.","line":76,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":76,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3250,3253],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3250,3253],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":106,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4147,4150],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4147,4150],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4536,4539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4536,4539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":132,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5208,5211],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5208,5211],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":161,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6319,6322],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6319,6322],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":175,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6807,6810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6807,6810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":183,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7130,7133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7130,7133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":200,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7721,7724],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7721,7724],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":224,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8727,8730],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8727,8730],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":233,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":233,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9115,9118],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9115,9118],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":246,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":246,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9562,9565],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9562,9565],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":16,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { db } from '@/integrations/database';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\nexport interface ConstructionDocument {\r\n    id: string;\r\n    projectId: string;\r\n    siteId: string | null;\r\n    companyId: string | null;\r\n    name: string;\r\n    docType: 'contract' | 'project' | 'safety' | 'report' | 'quality';\r\n    version: number;\r\n    fileUrl: string;\r\n    folderPath: string;\r\n    status: 'valid' | 'expired' | 'archived' | 'superseded' | 'pending' | 'rejected' | 'active';\r\n    createdBy: string;\r\n    metadata: any;\r\n    fileSize: number;\r\n    createdAt: Date;\r\n    updatedAt: Date;\r\n}\r\n\r\nexport function useConstructionDocuments(projectId?: string, siteId?: string, companyId?: string) {\r\n    const [documents, setDocuments] = useState<ConstructionDocument[]>([]);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const { toast } = useToast();\r\n\r\n    const loadDocuments = useCallback(async () => {\r\n        setIsLoading(true);\r\n        try {\r\n            let query = db.from('construction_documents' as any).select('*');\r\n\r\n            if (projectId) query = query.eq('project_id', projectId);\r\n            if (siteId) query = query.eq('site_id', siteId);\r\n            if (companyId) query = query.eq('company_id', companyId);\r\n\r\n            const { data, error } = await query.order('created_at', { ascending: false });\r\n\r\n            if (error) throw error;\r\n\r\n            const mapped: ConstructionDocument[] = (data || []).map((d: any) => ({\r\n                id: d.id,\r\n                projectId: d.project_id,\r\n                siteId: d.site_id,\r\n                companyId: d.company_id,\r\n                name: d.name,\r\n                docType: d.doc_type,\r\n                version: d.version,\r\n                fileUrl: d.file_url,\r\n                folderPath: d.folder_path || '/',\r\n                status: d.status,\r\n                createdBy: d.created_by,\r\n                metadata: d.metadata,\r\n                fileSize: d.file_size || 0,\r\n                createdAt: new Date(d.created_at),\r\n                updatedAt: new Date(d.updated_at)\r\n            }));\r\n\r\n            setDocuments(mapped);\r\n        } catch (error: any) {\r\n            console.error('Error loading documents:', error);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }, [projectId, siteId]);\r\n\r\n    useEffect(() => {\r\n        loadDocuments();\r\n    }, [loadDocuments]);\r\n\r\n    const uploadDocument = async (file: File, d: Partial<ConstructionDocument>) => {\r\n        try {\r\n            // 1. Upload file to storage (assuming a 'documents' bucket exists)\r\n            const sanitizedName = file.name.normalize('NFD').replace(/[\\u0300-\\u036f]/g, \"\").replace(/[^a-zA-Z0-9._-]/g, \"_\");\r\n            const filePath = `${d.projectId || 'global'}/${Date.now()}_${sanitizedName}`;\r\n            const { data: uploadData, error: uploadError } = await db.storage\r\n                .from('documents')\r\n                .upload(filePath, file);\r\n\r\n            if (uploadError) throw uploadError;\r\n\r\n            // 2. Register document in table\r\n            const { data: insertData, error: insertError } = await db\r\n                .from('construction_documents' as any)\r\n                .insert({\r\n                    project_id: d.projectId,\r\n                    site_id: d.siteId,\r\n                    company_id: d.companyId,\r\n                    name: d.name || file.name,\r\n                    doc_type: d.docType || 'report',\r\n                    version: d.version || 1,\r\n                    file_url: filePath,\r\n                    folder_path: d.folderPath || '/',\r\n                    status: d.status || 'pending',\r\n                    file_size: file.size,\r\n                    metadata: d.metadata || {}\r\n                })\r\n                .select()\r\n                .single();\r\n\r\n            if (insertError) throw insertError;\r\n\r\n            toast({ title: \"Documento enviado\", description: \"O arquivo foi registrado com sucesso.\" });\r\n            loadDocuments();\r\n            return { success: true, data: insertData };\r\n        } catch (error: any) {\r\n            toast({ title: \"Erro no upload\", description: error.message, variant: \"destructive\" });\r\n            return { success: false, error: error.message };\r\n        }\r\n    };\r\n\r\n    const updateDocument = async (id: string, updates: Partial<ConstructionDocument>) => {\r\n        try {\r\n            const { error } = await db\r\n                .from('construction_documents' as any)\r\n                .update({\r\n                    name: updates.name,\r\n                    status: updates.status,\r\n                    doc_type: updates.docType,\r\n                    version: updates.version,\r\n                    folder_path: updates.folderPath,\r\n                    metadata: updates.metadata,\r\n                    updated_at: new Date().toISOString()\r\n                })\r\n                .eq('id', id);\r\n\r\n            if (error) throw error;\r\n\r\n            toast({ title: \"Documento atualizado\", description: \"As alterações foram salvas com sucesso.\" });\r\n            loadDocuments();\r\n            return { success: true };\r\n        } catch (error: any) {\r\n            toast({ title: \"Erro ao atualizar\", description: error.message, variant: \"destructive\" });\r\n            return { success: false, error: error.message };\r\n        }\r\n    };\r\n\r\n    const downloadDocument = async (doc: ConstructionDocument) => {\r\n        try {\r\n            const { data, error } = await db.storage\r\n                .from('documents')\r\n                .download(doc.fileUrl);\r\n\r\n            if (error) throw error;\r\n\r\n            // Create a link and trigger download\r\n            const url = window.URL.createObjectURL(data);\r\n            const link = document.createElement('a');\r\n            link.href = url;\r\n\r\n            // Ensure the name has the correct extension for the storage content\r\n            link.setAttribute('download', doc.name);\r\n            document.body.appendChild(link);\r\n            link.click();\r\n\r\n            // Cleanup\r\n            document.body.removeChild(link);\r\n            window.URL.revokeObjectURL(url);\r\n\r\n            toast({ title: \"Download iniciado\", description: `O arquivo ${doc.name} está sendo baixado.` });\r\n        } catch (error: any) {\r\n            toast({ title: \"Erro no download\", description: error.message, variant: \"destructive\" });\r\n        }\r\n    };\r\n\r\n    const previewDocument = async (doc: ConstructionDocument) => {\r\n        try {\r\n            const { data, error } = await db.storage\r\n                .from('documents')\r\n                .createSignedUrl(doc.fileUrl, 300); // 5 minutes\r\n\r\n            if (error) throw error;\r\n\r\n            window.open(data.signedUrl, '_blank');\r\n        } catch (error: any) {\r\n            toast({ title: \"Erro ao visualizar\", description: error.message, variant: \"destructive\" });\r\n        }\r\n    };\r\n\r\n    const createFolder = async (name: string, folderPath: string = '/') => {\r\n        try {\r\n            const { data, error } = await db\r\n                .from('construction_documents' as any)\r\n                .insert({\r\n                    projectId: projectId,\r\n                    siteId: siteId,\r\n                    name: name,\r\n                    documentType: 'folder',\r\n                    version: 1,\r\n                    fileUrl: 'file:///folder',  // Valid URL placeholder for folders\r\n                    folderPath: folderPath,\r\n                    status: 'valid',\r\n                    metadata: { type: 'folder' }\r\n                })\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n\r\n            const raw = data as any;\r\n\r\n            // Map raw response to proper ConstructionDocument interface\r\n            const newFolder: ConstructionDocument = {\r\n                id: raw.id,\r\n                projectId: raw.project_id,\r\n                siteId: raw.site_id,\r\n                companyId: raw.company_id,\r\n                name: raw.name,\r\n                docType: raw.doc_type,\r\n                version: raw.version,\r\n                fileUrl: raw.file_url,\r\n                folderPath: raw.folder_path || '/',\r\n                status: raw.status,\r\n                createdBy: raw.created_by,\r\n                metadata: raw.metadata,\r\n                fileSize: raw.file_size || 0,\r\n                createdAt: new Date(raw.created_at),\r\n                updatedAt: new Date(raw.updated_at)\r\n            };\r\n\r\n            toast({ title: \"Pasta criada\", description: `A pasta \"${name}\" foi criada com sucesso.` });\r\n            loadDocuments();\r\n            return { success: true, data: newFolder };\r\n        } catch (error: any) {\r\n            toast({ title: \"Erro ao criar pasta\", description: error.message, variant: \"destructive\" });\r\n            return { success: false, error: error.message };\r\n        }\r\n    };\r\n\r\n    const deleteDocument = async (id: string, storagePath?: string) => {\r\n        try {\r\n            const { error: tableError } = await db\r\n                .from('construction_documents' as any)\r\n                .delete()\r\n                .eq('id', id);\r\n\r\n            if (tableError) throw tableError;\r\n\r\n            if (storagePath && storagePath !== 'folder') {\r\n                await db.storage.from('documents').remove([storagePath]);\r\n            }\r\n\r\n            toast({ title: \"Excluído\", description: \"Item removido com sucesso.\" });\r\n            loadDocuments();\r\n            return { success: true };\r\n        } catch (error: any) {\r\n            toast({ title: \"Erro ao excluir\", description: error.message, variant: \"destructive\" });\r\n            return { success: false, error: error.message };\r\n        }\r\n    };\r\n\r\n    return {\r\n        documents,\r\n        isLoading,\r\n        uploadDocument,\r\n        updateDocument,\r\n        downloadDocument,\r\n        previewDocument, // Added\r\n        createFolder,\r\n        deleteDocument,\r\n        refresh: loadDocuments\r\n    };\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\useDailyReports.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1895,1898],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1895,1898],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2150,2153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2150,2153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":108,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":108,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":127,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":127,"endColumn":21},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":127,"column":23,"nodeType":"BlockStatement","messageId":"unexpected","endLine":127,"endColumn":26,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4391,4392],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":174,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5959,5962],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5959,5962],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":196,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6784,6787],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6784,6787],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { db } from '@/integrations/database';\r\nimport { storageService } from '@/services/storageService';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { generateId } from '@/lib/utils';\r\n\r\nexport interface DailyReport {\r\n  id: string;\r\n  teamId: string | null;\r\n  teamName?: string;\r\n  employeeId: string | null;\r\n  employeeName?: string;\r\n  reportDate: Date;\r\n  activities: string;\r\n  observations: string | null;\r\n  companyId: string | null;\r\n  createdBy: string | null;\r\n  syncedAt: Date | null;\r\n  localId: string | null;\r\n  createdAt: Date;\r\n}\r\n\r\nexport function useDailyReports() {\r\n  const [reports, setReports] = useState<DailyReport[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const { toast } = useToast();\r\n\r\n  const saveToStorage = async (reportsToSave: DailyReport[]) => {\r\n    // Com IndexedDB não temos mais o limite de 5MB\r\n    await storageService.setItem('dailyReports', reportsToSave);\r\n  };\r\n\r\n  const loadReports = useCallback(async () => {\r\n    setIsLoading(true);\r\n    try {\r\n      // Always load local reports first to preserve offline data\r\n      const localCached = await storageService.getItem<DailyReport[]>('dailyReports') || [];\r\n      const unsyncedReports = localCached.filter(r => !r.syncedAt);\r\n\r\n      if (navigator.onLine) {\r\n        const { data, error } = await db\r\n          .from('daily_reports')\r\n          .select(`\r\n            *,\r\n            user:users!daily_reports_user_id_fkey(name)\r\n          `)\r\n          .order('report_date', { ascending: false })\r\n          .limit(100);\r\n\r\n        if (error) throw error;\r\n\r\n        const mapped = (data || []).map(r => ({\r\n          id: r.id,\r\n          teamId: r.team_id,\r\n          teamName: r.teams?.name, // This will be undefined if teams are not selected\r\n          userId: r.user_id,\r\n          userName: (r as any).user?.name || 'Sistema',\r\n          reportDate: new Date(r.report_date),\r\n          activities: r.activities,\r\n          observations: r.observations,\r\n          employeeId: r.user_id, // Mapeado corretamente para user_id\r\n          companyId: (r as any).company_id,\r\n          createdBy: r.created_by,\r\n          syncedAt: r.synced_at ? new Date(r.synced_at) : null,\r\n          localId: r.local_id,\r\n          createdAt: new Date(r.created_at || Date.now()),\r\n        }) as DailyReport);\r\n\r\n        // Merge unsynced local reports with server reports\r\n        // Filter out any local reports that might be present in server data\r\n        const serverLocalIds = new Set(mapped.map(r => r.localId).filter(Boolean));\r\n        const uniqueUnsynced = unsyncedReports.filter(r => !r.localId || !serverLocalIds.has(r.localId));\r\n\r\n        const mergedReports = [...uniqueUnsynced, ...mapped];\r\n\r\n        setReports(mergedReports);\r\n        await saveToStorage(mergedReports);\r\n      } else {\r\n        setReports(localCached);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading daily reports:', error);\r\n      const cached = await storageService.getItem<DailyReport[]>('dailyReports') || [];\r\n      setReports(cached);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    loadReports();\r\n  }, [loadReports]);\r\n\r\n  const createReport = async (data: {\r\n    teamId?: string;\r\n    employeeId: string;\r\n    companyId?: string;\r\n    activities: string;\r\n    observations?: string;\r\n  }) => {\r\n    const localId = generateId();\r\n\r\n    // Auth check that works offline\r\n    let userId = null;\r\n    try {\r\n      const session = await db.auth.getSession();\r\n      userId = session.data.session?.user?.id || null;\r\n    } catch (e) {\r\n      console.warn('Network auth check failed, using local fallback');\r\n    }\r\n\r\n    // Fallback to storage if db fails (try to find the SB token in localStorage)\r\n    if (!userId) {\r\n      // Loop through localStorage to find the db token key\r\n      for (let i = 0; i < localStorage.length; i++) {\r\n        const key = localStorage.key(i);\r\n        if (key && key.startsWith('sb-') && key.endsWith('-auth-token')) {\r\n          try {\r\n            const item = localStorage.getItem(key);\r\n            if (item) {\r\n              const parsed = JSON.parse(item);\r\n              if (parsed.user?.id) {\r\n                userId = parsed.user.id;\r\n                break;\r\n              }\r\n            }\r\n          } catch (e) { }\r\n        }\r\n      }\r\n    }\r\n\r\n    // Detect manual worker session\r\n    const manualSession = await storageService.getItem('manual_worker_session');\r\n    const isManualWorker = !!manualSession;\r\n    const effectiveUserId = isManualWorker ? null : userId;\r\n\r\n    const today = new Date();\r\n\r\n    const newReport: DailyReport = {\r\n      id: localId,\r\n      teamId: data.teamId || null,\r\n      reportDate: today,\r\n      activities: data.activities,\r\n      observations: data.observations || null,\r\n      employeeId: data.employeeId,\r\n      companyId: data.companyId || null,\r\n      createdBy: effectiveUserId,\r\n      syncedAt: null,\r\n      localId,\r\n      createdAt: today,\r\n    };\r\n\r\n    const isOnline = navigator.onLine;\r\n\r\n    // Optimistically update UI\r\n    setReports(prev => [newReport, ...prev]);\r\n    const currentStorage = await storageService.getItem<DailyReport[]>('dailyReports') || [];\r\n    await saveToStorage([newReport, ...currentStorage]);\r\n\r\n    if (isOnline) {\r\n      try {\r\n        const { data: created, error } = await db\r\n          .from('daily_reports')\r\n          .insert({\r\n            team_id: data.teamId || null,\r\n            report_date: today.toISOString().split('T')[0],\r\n            activities: data.activities,\r\n            observations: data.observations || null,\r\n            user_id: data.employeeId, // Mapeado para user_id na tabela users\r\n            company_id: data.companyId || null,\r\n            created_by: effectiveUserId,\r\n            synced_at: new Date().toISOString(),\r\n            local_id: localId,\r\n          } as any)\r\n          .select(`*, teams(name), user:users!daily_reports_user_id_fkey(name)`)\r\n          .single();\r\n\r\n        if (error) throw error;\r\n\r\n        const updatedReport = {\r\n          ...newReport,\r\n          id: created.id,\r\n          teamName: created.teams?.name,\r\n          syncedAt: new Date(created.synced_at || new Date()),\r\n        };\r\n\r\n        // Update state\r\n        setReports(prev => prev.map(r => r.localId === localId ? updatedReport : r));\r\n\r\n        // Update storage correctly!\r\n        const freshStorage = await storageService.getItem<DailyReport[]>('dailyReports') || [];\r\n        const updatedStorage = freshStorage.map(r => r.localId === localId ? updatedReport : r);\r\n        await saveToStorage(updatedStorage);\r\n\r\n        return { success: true, data: updatedReport };\r\n      } catch (error: any) {\r\n        console.warn('Online sync failed, falling back to offline mode:', error);\r\n\r\n        await storageService.addToSyncQueue({\r\n          operation: 'insert',\r\n          table: 'daily_reports',\r\n          data: { ...data, localId, reportDate: today.toISOString(), createdBy: userId },\r\n        });\r\n\r\n        toast({\r\n          title: 'Salvo offline',\r\n          description: 'Relatório salvo localmente. Será sincronizado quando houver conexão.',\r\n          duration: 3000,\r\n        });\r\n\r\n        return { success: true, data: newReport, offline: true };\r\n      }\r\n    } else {\r\n      await storageService.addToSyncQueue({\r\n        operation: 'insert',\r\n        table: 'daily_reports',\r\n        data: { ...data, localId, reportDate: today.toISOString(), createdBy: userId },\r\n      });\r\n\r\n      toast({\r\n        title: 'Modo Offline',\r\n        description: 'Relatório salvo localmente.',\r\n        duration: 3000,\r\n      });\r\n\r\n      return { success: true, data: newReport, offline: true };\r\n    }\r\n  };\r\n\r\n  const getTodayReports = () => {\r\n    const today = new Date().toDateString();\r\n    return reports.filter(r => new Date(r.reportDate).toDateString() === today);\r\n  };\r\n\r\n  return {\r\n    reports,\r\n    isLoading,\r\n    createReport,\r\n    getTodayReports,\r\n    refresh: loadReports,\r\n  };\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\useDownloadQueue.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\useEmployees.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useState' is defined but never used.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'fetchEmployees' is defined but never used.","line":7,"column":70,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":84},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1747,1750],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1747,1750],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2100,2103],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2100,2103],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has an unnecessary dependency: 'isAnyJobProcessing.value'. Either exclude it or remove the dependency array. Outer scope values like 'isAnyJobProcessing.value' aren't valid dependencies because mutating them doesn't re-render the component.","line":93,"column":6,"nodeType":"ArrayExpression","endLine":93,"endColumn":47,"suggestions":[{"desc":"Update the dependencies array to be: [loadEmployees]","fix":{"range":[3272,3313],"text":"[loadEmployees]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":149,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5048,5051],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5048,5051],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":173,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5990,5993],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5990,5993],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":216,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7219,7222],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7219,7222],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":241,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":241,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8475,8478],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8475,8478],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":279,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":279,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9643,9646],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9643,9646],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":316,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":316,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10809,10812],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10809,10812],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { db } from '@/integrations/database';\r\nimport { storageService } from '@/services/storageService';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { generateId } from '@/lib/utils';\r\nimport { mapDatabaseError, logError } from '@/lib/errorHandler';\r\nimport { Employee, employees as employeesSignal, isLoadingEmployees, fetchEmployees } from '@/signals/employeeSignals';\r\nexport type { Employee };\r\nimport { isAnyJobProcessing } from '@/signals/jobSignals';\r\n\r\nexport interface EmployeeFilters {\r\n  companyId?: string;\r\n  projectId?: string;\r\n  siteId?: string;\r\n  excludeCorporate?: boolean;\r\n}\r\n\r\nexport function useEmployees(options?: EmployeeFilters) {\r\n  const companyId = options?.companyId;\r\n  const excludeCorporate = options?.excludeCorporate ?? true;\r\n  const { toast } = useToast();\r\n\r\n  const loadEmployees = useCallback(async () => {\r\n    isLoadingEmployees.value = true;\r\n    try {\r\n      if (navigator.onLine) {\r\n        let query = db\r\n          .from('users')\r\n          .select(`\r\n            *,\r\n            site_id,\r\n            company_id,\r\n            project_id,\r\n            jobFunction:job_functions(name, level, can_lead_team)\r\n          `);\r\n\r\n        if (companyId) query = query.eq('company_id', companyId);\r\n        if (excludeCorporate) query = query.eq('excludeCorporate', true);\r\n\r\n        const { data, error } = await query\r\n          .order('name');\r\n\r\n        if (error) throw error;\r\n\r\n        const mapped = (data || []).map(e => ({\r\n          id: e.id,\r\n          fullName: e.name || 'Sem nome',\r\n          registrationNumber: e.registrationNumber || '',\r\n          functionId: e.functionId,\r\n          functionName: (e.jobFunction as any)?.name || 'Não definida',\r\n          role: e.role || 'WORKER',\r\n          professionalLevel: e.jobFunction?.hierarchyLevel || 0,\r\n          canLeadTeam: !!e.jobFunction?.canLeadTeam,\r\n          phone: e.phone || null,\r\n          email: e.email || null,\r\n          cpf: e.cpf || null,\r\n          photoUrl: e.image || null,\r\n          password: (e as any).password,\r\n          isActive: e.status === 'ACTIVE',\r\n          faceDescriptor: e.face_descriptor || null,\r\n          siteId: e.siteId || null,\r\n          companyId: e.companyId || null,\r\n          projectId: e.projectId || null,\r\n          level: e.hierarchyLevel || 0,\r\n          laborType: e.laborType || 'MOD',\r\n          createdAt: new Date(e.createdAt || Date.now()),\r\n        }));\r\n\r\n        employeesSignal.value = mapped;\r\n        await storageService.setItem('employees', mapped);\r\n      } else {\r\n        const cached = await storageService.getItem<Employee[]>('employees') || [];\r\n        employeesSignal.value = cached;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading employees:', error);\r\n      const cached = await storageService.getItem<Employee[]>('employees') || [];\r\n      employeesSignal.value = cached;\r\n    } finally {\r\n      isLoadingEmployees.value = false;\r\n    }\r\n  }, [companyId, excludeCorporate]);\r\n\r\n  useEffect(() => {\r\n    loadEmployees();\r\n  }, [loadEmployees]);\r\n\r\n  // Sincronização automática quando jobs terminam\r\n  useEffect(() => {\r\n    if (!isAnyJobProcessing.value) {\r\n      loadEmployees();\r\n    }\r\n  }, [isAnyJobProcessing.value, loadEmployees]);\r\n\r\n  const createEmployee = async (data: {\r\n    fullName: string;\r\n    registrationNumber: string;\r\n    functionId?: string;\r\n    phone?: string;\r\n    email?: string;\r\n    cpf?: string;\r\n    password?: string;\r\n    siteId?: string;\r\n    companyId?: string;\r\n    projectId?: string;\r\n    level?: number;\r\n    laborType?: string;\r\n  }) => {\r\n    const localId = generateId();\r\n    const newEmployee: Employee = {\r\n      id: localId,\r\n      fullName: data.fullName,\r\n      registrationNumber: data.registrationNumber,\r\n      functionId: data.functionId || null,\r\n      phone: data.phone || null,\r\n      email: data.email || null,\r\n      cpf: data.cpf || null,\r\n      role: 'WORKER',\r\n      photoUrl: null,\r\n      isActive: true,\r\n      siteId: data.siteId || null,\r\n      companyId: data.companyId || null,\r\n      projectId: data.projectId || null,\r\n      level: data.level || 0,\r\n      laborType: data.laborType || 'MOD',\r\n      professionalLevel: data.level || 0,\r\n      canLeadTeam: false,\r\n      createdAt: new Date(),\r\n    };\r\n\r\n    // Optimistically update UI\r\n    employeesSignal.value = [...employeesSignal.value, newEmployee];\r\n    await storageService.setItem('employees', employeesSignal.value);\r\n\r\n    const isOnline = navigator.onLine;\r\n\r\n    if (isOnline) {\r\n      try {\r\n        const { data: created, error } = await db\r\n          .from('users')\r\n          .insert({\r\n            name: data.fullName,\r\n            registration_number: data.registrationNumber,\r\n            function_id: data.functionId || null,\r\n            phone: data.phone || null,\r\n            email: data.email || null,\r\n            cpf: data.cpf || null,\r\n            password: data.password || null,\r\n            face_descriptor: (newEmployee as any).faceDescriptor || null,\r\n            site_id: data.siteId || null,\r\n            company_id: data.companyId || null,\r\n            project_id: data.projectId || null,\r\n            hierarchy_level: data.level || 0,\r\n            labor_type: data.laborType || 'MOD',\r\n            status: 'ACTIVE',\r\n            role: 'WORKER' // Default role for field workers\r\n          })\r\n          .select(`*, jobFunction:job_functions(name, level, can_lead_team)`)\r\n          .single();\r\n\r\n        if (error) throw error;\r\n\r\n        const updatedEmployee = {\r\n          ...newEmployee,\r\n          id: created.id,\r\n          functionName: created.jobFunction?.name || 'Não definida',\r\n        };\r\n\r\n        employeesSignal.value = employeesSignal.value.map(e => e.id === localId ? updatedEmployee : e);\r\n        storageService.setItem('employees', employeesSignal.value);\r\n\r\n        return { success: true, data: updatedEmployee };\r\n      } catch (error: any) {\r\n        console.warn('Online sync failed, falling back to offline mode:', error);\r\n\r\n        await storageService.addToSyncQueue({\r\n          operation: 'insert',\r\n          table: 'employees',\r\n          data: { ...data, localId },\r\n        });\r\n\r\n        toast({\r\n          title: 'Salvo offline',\r\n          description: 'Funcionário salvo localmente. Será sincronizado quando houver conexão.',\r\n          duration: 3000,\r\n        });\r\n\r\n        return { success: true, data: newEmployee, offline: true };\r\n      }\r\n    } else {\r\n      await storageService.addToSyncQueue({\r\n        operation: 'insert',\r\n        table: 'employees',\r\n        data: { ...data, localId },\r\n      });\r\n\r\n      toast({\r\n        title: 'Modo Offline',\r\n        description: 'Funcionário salvo localmente.',\r\n        duration: 3000,\r\n      });\r\n\r\n      return { success: true, data: newEmployee, offline: true };\r\n    }\r\n  };\r\n\r\n  const updateEmployee = async (id: string, data: Partial<Employee>) => {\r\n    const oldEmployees = [...employeesSignal.value];\r\n\r\n    employeesSignal.value = employeesSignal.value.map(e =>\r\n      e.id === id ? { ...e, ...data } : e\r\n    );\r\n\r\n    if (navigator.onLine) {\r\n      try {\r\n        const updateData: any = {};\r\n        if (data.fullName) updateData.name = data.fullName;\r\n        if (data.registrationNumber) updateData.registration_number = data.registrationNumber;\r\n        if (data.functionId !== undefined) updateData.function_id = data.functionId;\r\n        if (data.phone !== undefined) updateData.phone = data.phone;\r\n        if (data.email !== undefined) updateData.email = data.email;\r\n        if (data.cpf !== undefined) updateData.cpf = data.cpf;\r\n        if (data.isActive !== undefined) updateData.status = data.isActive ? 'ACTIVE' : 'INACTIVE';\r\n        if (data.siteId !== undefined) updateData.site_id = data.siteId;\r\n        if (data.companyId !== undefined) updateData.company_id = data.companyId;\r\n        if (data.projectId !== undefined) updateData.project_id = data.projectId;\r\n        if (data.level !== undefined) updateData.hierarchy_level = data.level;\r\n        if (data.laborType !== undefined) updateData.labor_type = data.laborType;\r\n\r\n\r\n        const { error } = await db\r\n          .from('users')\r\n          .update(updateData)\r\n          .eq('id', id);\r\n\r\n        if (error) throw error;\r\n\r\n        await storageService.setItem('employees', employeesSignal.value);\r\n\r\n        return { success: true };\r\n      } catch (error: any) {\r\n        logError('Employee Update', error);\r\n        employeesSignal.value = oldEmployees;\r\n        const userMessage = mapDatabaseError(error);\r\n        toast({\r\n          title: 'Erro ao atualizar funcionário',\r\n          description: userMessage,\r\n          variant: 'destructive',\r\n        });\r\n        return { success: false, error: userMessage };\r\n      }\r\n    } else {\r\n      await storageService.addToSyncQueue({\r\n        operation: 'update',\r\n        table: 'employees',\r\n        id,\r\n        data,\r\n      });\r\n      await storageService.setItem('employees', employeesSignal.value);\r\n      return { success: true, offline: true };\r\n    }\r\n  };\r\n\r\n  const deleteEmployee = async (id: string) => {\r\n    const oldEmployees = [...employeesSignal.value];\r\n    employeesSignal.value = employeesSignal.value.filter(e => e.id !== id);\r\n\r\n    if (navigator.onLine) {\r\n      try {\r\n        const { error } = await db\r\n          .from('users')\r\n          .delete()\r\n          .eq('id', id);\r\n\r\n        if (error) throw error;\r\n\r\n        await storageService.setItem('employees', employeesSignal.value);\r\n        return { success: true };\r\n      } catch (error: any) {\r\n        logError('Employee Delete', error);\r\n        employeesSignal.value = oldEmployees;\r\n        const userMessage = mapDatabaseError(error);\r\n        toast({\r\n          title: 'Erro ao remover funcionário',\r\n          description: userMessage,\r\n          variant: 'destructive',\r\n        });\r\n        return { success: false, error: userMessage };\r\n      }\r\n    } else {\r\n      await storageService.addToSyncQueue({\r\n        operation: 'delete',\r\n        table: 'employees',\r\n        id,\r\n      });\r\n      await storageService.setItem('employees', employeesSignal.value);\r\n      return { success: true, offline: true };\r\n    }\r\n  };\r\n\r\n  const deleteMultipleEmployees = async (ids: string[]) => {\r\n    const oldEmployees = [...employeesSignal.value];\r\n    employeesSignal.value = employeesSignal.value.filter(e => !ids.includes(e.id));\r\n\r\n    if (navigator.onLine) {\r\n      try {\r\n        const { error } = await db\r\n          .from('users')\r\n          .delete()\r\n          .in('id', ids);\r\n\r\n        if (error) throw error;\r\n\r\n        storageService.setItem('employees', employeesSignal.value);\r\n        return { success: true };\r\n      } catch (error: any) {\r\n        logError('Employees Bulk Delete', error);\r\n        employeesSignal.value = oldEmployees;\r\n        const userMessage = mapDatabaseError(error);\r\n        toast({\r\n          title: 'Erro ao remover funcionários',\r\n          description: userMessage,\r\n          variant: 'destructive',\r\n        });\r\n        return { success: false, error: userMessage };\r\n      }\r\n    } else {\r\n      for (const id of ids) {\r\n        await storageService.addToSyncQueue({\r\n          operation: 'delete',\r\n          table: 'employees',\r\n          id,\r\n        });\r\n      }\r\n      await storageService.setItem('employees', employeesSignal.value);\r\n      return { success: true, offline: true };\r\n    }\r\n  };\r\n\r\n  return {\r\n    employees: employeesSignal.value,\r\n    isLoading: isLoadingEmployees.value,\r\n    createEmployee,\r\n    updateEmployee,\r\n    deleteEmployee,\r\n    deleteMultipleEmployees,\r\n    refresh: loadEmployees,\r\n  };\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\useEnrichedPlacemarks.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[453,456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[453,456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'discardedCount' is assigned a value but never used.","line":21,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'compositeId' is assigned a value but never used.","line":30,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isDbHidden' is assigned a value but never used.","line":35,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":33},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":40,"column":46,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":40,"endColumn":47,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1712,1713],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1712,1712],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":40,"column":86,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":40,"endColumn":87,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1752,1753],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1752,1752],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":40,"column":158,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":40,"endColumn":159,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1824,1825],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1824,1824],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has an unnecessary dependency: 'hiddenPlacemarkIds'. Either exclude it or remove the dependency array.","line":187,"column":8,"nodeType":"ArrayExpression","endLine":187,"endColumn":81,"suggestions":[{"desc":"Update the dependencies array to be: [kmlDocuments, placemarkOverrides, selectedProjectId]","fix":{"range":[10670,10743],"text":"[kmlDocuments, placemarkOverrides, selectedProjectId]"}}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useMemo } from 'react';\r\nimport type { KMLDocument, KMLPlacemark } from '@/types/kmz';\r\n\r\nconst LOCAL_MODEL_ID = 'local-3d-model';\r\n\r\nexport function useEnrichedPlacemarks(\r\n    kmlDocuments: KMLDocument[],\r\n    placemarkOverrides: Record<string, {\r\n        name?: string,\r\n        angle?: number,\r\n        color?: string,\r\n        height?: number,\r\n        elevation?: number,\r\n        customModelUrl?: string,\r\n        customModelTransform?: any\r\n    }>,\r\n    hiddenPlacemarkIds: Set<string> = new Set(),\r\n    selectedProjectId: string = 'all'\r\n) {\r\n    return useMemo(() => {\r\n        let discardedCount = 0;\r\n        // let hiddenCount = 0; // Removed as filtering based on hiddenPlacemarkIds is removed\r\n        const combined = kmlDocuments.flatMap(doc => {\r\n            const docProjectId = (doc as { projectId?: string; id?: string } & KMLDocument).projectId || doc.id;\r\n            const docId = doc.id || '';\r\n\r\n            if (!doc.placemarks) return [];\r\n\r\n            return doc.placemarks.filter(p => {\r\n                const compositeId = `${docId}:::${p.id}`;\r\n\r\n\r\n                // 2. Identify hidden towers (Database state)\r\n                const ext = p.extendedData as Record<string, unknown>;\r\n                const isDbHidden = ext?.is_hidden === true || ext?.isHidden === true || String(ext?.is_hidden).toLowerCase() === 'true' || Number(ext?.is_hidden) === 1;\r\n\r\n                const normalizedName = (p.name || '').trim().toUpperCase();\r\n                // Regex seletivo: Captura formatos de torre (17/1, 10-A, 1A, A1, AP10, TORRE)\r\n                // Relaxado para permitir números simples (1, 2, 3) e combinações alfanuméricas\r\n                const isTowerFormat = /^(\\d+[\\/-]\\d+[A-Za-z]*|\\d+[A-Za-z]+|[A-Za-z]+[\\/-]?\\d+|TRIO.*|[A-Za-z]+\\d+.*|.*TORRE.*|.*ESTR.*|.*AP\\d+.*|.*STR.*|.*V[\\/-]\\d+.*|\\d+)(?:\\s*\\/.*)?$/i.test(normalizedName);\r\n                const isGenericPoint = /^PONTO[\\s-]*\\d+.*$/i.test(normalizedName);\r\n                const isManualReference = /^(?:PE|BASE|REF|MARK)[\\s-]*.*$/i.test(normalizedName);\r\n\r\n                const hasSketchfab = p.extendedData && (p.extendedData['sketchfab_id'] || p.extendedData['SKETCHFAB_ID']);\r\n                const hasObjectId = p.extendedData && (p.extendedData['object_id'] || p.extendedData['OBJECT_ID'] || p.extendedData['externalId'] || p.extendedData['external_id']);\r\n\r\n                const isTechnicalPoint = p.type === 'point' && isTowerFormat && !isGenericPoint;\r\n                const isReferencePoint = p.type === 'point' && (isGenericPoint || isManualReference);\r\n                const isTour = /TOUR|FOTO|VISTA|CAMER|MAPA/i.test(normalizedName);\r\n\r\n                // Ocultar elementos técnicos se nenhuma obra estiver selecionada\r\n                if (selectedProjectId === 'all' && (isTechnicalPoint || p.type === 'linestring')) {\r\n                    return false;\r\n                }\r\n\r\n                const keep = (hasSketchfab || hasObjectId || isTechnicalPoint || isReferencePoint) && !isTour;\r\n                if (!keep && p.type === 'point' && !isTour) {\r\n                    console.log(`🚫 [EnrichedPlacemarks] Descartando ponto \"${p.name}\" - ID=${p.id}. TowerFormat=${isTowerFormat}, hasObjectId=${hasObjectId}, isTechnical=${isTechnicalPoint}`);\r\n                }\r\n                if (!keep) discardedCount++;\r\n                return keep;\r\n            }).map(p => {\r\n                const compositeId = `${docId}:::${p.id}`;\r\n                const override = placemarkOverrides[compositeId];\r\n\r\n                const normalizedName = (p.name || '').trim().toUpperCase();\r\n                const isGenericPoint = /^PONTO[\\s-]*\\d+.*$/i.test(normalizedName);\r\n                const isManualReference = /^(?:PE|BASE|REF|MARK)[\\s-]*.*$/i.test(normalizedName);\r\n                const isReferencePoint = p.type === 'point' && (isGenericPoint || isManualReference);\r\n\r\n                const skId = override?.customModelUrl || p.extendedData?.['sketchfab_id'] || p.extendedData?.['SKETCHFAB_ID'];\r\n                const isLocal = !skId;\r\n\r\n                const extData = p.extendedData as Record<string, string | number | undefined>;\r\n                const deflectionValue = parseFloat(extData?.['deflection'] || extData?.['DEFLECTION'] || '0');\r\n\r\n                let heading = deflectionValue;\r\n                if (!heading && p.coordinates.heading) {\r\n                    heading = p.coordinates.heading;\r\n                }\r\n\r\n                const finalHeading = override?.angle !== undefined\r\n                    ? override.angle % 360\r\n                    : (heading || 0) % 360;\r\n\r\n                const finalName = override?.name || p.name;\r\n                const finalColor = override?.color;\r\n\r\n                // Suporte para snake_case (KML/DB raw) e camelCase (Prisma/JS)\r\n                const finalHeight = override?.height ||\r\n                    parseFloat(String(extData?.['object_height'] || extData?.['objectHeight'] || 30));\r\n\r\n                const finalElevation = override?.elevation ||\r\n                    parseFloat(String(extData?.['object_elevation'] || extData?.['objectElevation'] || p.coordinates.altitude || 0));\r\n\r\n                const finalSeq = parseInt(String(extData?.['object_seq'] || extData?.['OBJECT_SEQ'] || extData?.['objectSeq']));\r\n                const circuitId = extData?.['circuit_id'] || extData?.['CIRCUIT_ID'] || extData?.['circuitId'] || extData?.['circuito'] || extData?.['CIRCUITO'];\r\n                const towerType = extData?.['tower_type'] || extData?.['TOWER_TYPE'] || extData?.['tipo'] || extData?.['TIPO'] || extData?.['type'] || extData?.['TYPE'];\r\n\r\n                // Technical Aliases from KML-KMZ-IMPORT Skill\r\n                const fixConductor = parseFloat(String(extData?.['fix_conductor'] || extData?.['cabo_cond'] || extData?.['FIX_CONDUCTOR']));\r\n                const fixParaRaio = parseFloat(String(extData?.['fix_pararaio'] || extData?.['cabo_para'] || extData?.['FIX_PARARAIO']));\r\n                const goForward = parseFloat(String(extData?.['go_forward'] || extData?.['vao'] || extData?.['GO_FORWARD']));\r\n\r\n                return {\r\n                    ...p,\r\n                    name: finalName,\r\n                    color: finalColor || '',\r\n                    projectId: (p as { projectId?: string } & KMLPlacemark).projectId || docProjectId,\r\n                    document_id: docId,\r\n                    isLocal,\r\n                    isReferencePoint,\r\n                    modelId: skId || LOCAL_MODEL_ID,\r\n                    customModelTransform: override?.customModelTransform,\r\n                    calculatedHeading: finalHeading,\r\n                    elevation: finalElevation,\r\n                    towerHeight: finalHeight,\r\n                    object_seq: isNaN(finalSeq) ? undefined : finalSeq,\r\n                    circuitId: circuitId ? String(circuitId).toUpperCase() : undefined,\r\n                    towerType: towerType ? String(towerType).toUpperCase() : undefined,\r\n                    fix_conductor: isNaN(fixConductor) ? undefined : fixConductor,\r\n                    fix_pararaio: isNaN(fixParaRaio) ? undefined : fixParaRaio,\r\n                    go_forward: isNaN(goForward) ? undefined : goForward,\r\n                    is_hidden: false\r\n                };\r\n            });\r\n        });\r\n\r\n        // if (discardedCount > 0 || hiddenCount > 0) {\r\n        //    console.log(`🧹 [useEnrichedPlacemarks] Filtragem: ${discardedCount} descartados (tours, etc), ${hiddenCount} ocultos pelo usuário.`);\r\n        // }\r\n\r\n        // Deduplicate by Site Core (e.g., \"17/1\") to avoid overlapping towers for dual circuits\r\n        const uniqueMap = new Map<string, typeof combined[0] & { circuitIds?: Set<string> }>();\r\n        combined.forEach(p => {\r\n            const rawName = (p.name || '').toUpperCase().trim();\r\n            // Identifica sufixos de circuito e variantes técnicas para remoção\r\n            const circuitSuffixes = /[-_](?:C\\d+|CIRCUITO\\s*\\d+|CIR\\d+|VA|RE|VANTE|RE|V|R)$|(?:\\s+)(?:C\\d+|CIRCUITO\\s*\\d+|CIR\\d+|VA|RE|VANTE|RE|V|R)$/i;\r\n\r\n            // Remove o sufixo para extrair o núcleo da torre (siteCore)\r\n            // Isso garante que \"1/1A\" e \"1/1A-C1\" → \"1/1A\", mantendo o identificador alfanumérico\r\n            const siteCore = rawName.replace(circuitSuffixes, '').trim();\r\n\r\n            // DEDUPLICATION FIX: Ignore projectId in the key to merge KML and DB representations of the same tower\r\n            // Use location to differentiate if names are identical but towers are physically distinct (rare but possible)\r\n            // Rounding to ~10m precision (3 decimal places) to catch same-tower variations\r\n            const latKey = p.coordinates.lat.toFixed(4);\r\n            const lngKey = p.coordinates.lng.toFixed(4);\r\n\r\n            // Primary Key: Name + Location\r\n            const key = `${siteCore}::${latKey}:${lngKey}`;\r\n\r\n            const existing = uniqueMap.get(key);\r\n\r\n            if (!existing) {\r\n                const newPlacemark = { ...p } as typeof combined[0] & { circuitIds?: Set<string> };\r\n                newPlacemark.circuitIds = new Set();\r\n                if (p.circuitId) newPlacemark.circuitIds.add(p.circuitId);\r\n                uniqueMap.set(key, newPlacemark);\r\n            } else {\r\n                if (p.circuitId) existing.circuitIds?.add(p.circuitId);\r\n\r\n                // Merge metadata - prefer the one that has values\r\n                if (!existing.object_seq && p.object_seq) existing.object_seq = p.object_seq;\r\n                if (!existing.towerHeight && p.towerHeight) existing.towerHeight = p.towerHeight;\r\n                if (!existing.elevation && p.elevation) existing.elevation = p.elevation;\r\n\r\n                // If one is from the selected project (likely DB) and the other is generic, keep the specific project ID?\r\n                // Actually, if we are merging, we might want to prefer the one with a real UUID projectId over a generic one if applicable.\r\n                if (selectedProjectId !== 'all' && (p as { projectId?: string } & KMLPlacemark).projectId === selectedProjectId) {\r\n                    existing.projectId = selectedProjectId;\r\n                    existing.document_id = (p as { document_id?: string } & KMLPlacemark).document_id || '';\r\n                }\r\n            }\r\n        });\r\n\r\n\r\n        // Convert circuitIds Set to Array or keep as Set if preferred\r\n        const result = Array.from(uniqueMap.values()).map(p => {\r\n            if (p.circuitIds) {\r\n                (p as { allCircuits?: string[] } & typeof p).allCircuits = Array.from(p.circuitIds);\r\n            }\r\n            return p;\r\n        });\r\n\r\n        return result;\r\n    }, [kmlDocuments, placemarkOverrides, hiddenPlacemarkIds, selectedProjectId]);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\useGAPOAnalytics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\useJobFunctions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":101,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3155,3158],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3155,3158],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":148,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4709,4712],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4709,4712],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":186,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5826,5829],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5826,5829],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { db } from '@/integrations/database';\r\nimport { storageService } from '@/services/storageService';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { generateId } from '@/lib/utils';\r\nimport { mapDatabaseError, logError } from '@/lib/errorHandler';\r\n\r\nexport interface JobFunction {\r\n  id: string;\r\n  name: string;\r\n  description: string | null;\r\n  canLeadTeam: boolean;\r\n  level: number;\r\n  createdAt: Date;\r\n}\r\n\r\nexport function useJobFunctions() {\r\n  const [functions, setFunctions] = useState<JobFunction[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const { toast } = useToast();\r\n\r\n  const loadFunctions = useCallback(async () => {\r\n    setIsLoading(true);\r\n    try {\r\n      if (navigator.onLine) {\r\n        const { data, error } = await db\r\n          .from('job_functions')\r\n          .select('*')\r\n          .order('level', { ascending: false })\r\n          .order('name');\r\n\r\n        if (error) throw error;\r\n\r\n        const mapped = (data || []).map(f => ({\r\n          id: f.id,\r\n          name: f.name,\r\n          description: f.description,\r\n          canLeadTeam: f.canLeadTeam || false,\r\n          level: f.level || 0,\r\n          createdAt: new Date(f.created_at || Date.now()),\r\n        }));\r\n\r\n        setFunctions(mapped);\r\n        storageService.setItem('functions', mapped);\r\n      } else {\r\n        const cached = await storageService.getItem<JobFunction[]>('functions') || [];\r\n        setFunctions(cached);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading functions:', error);\r\n      const cached = await storageService.getItem<JobFunction[]>('functions') || [];\r\n      setFunctions(cached);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    loadFunctions();\r\n  }, [loadFunctions]);\r\n\r\n  const createFunction = async (data: { name: string; description: string; canLeadTeam: boolean; level?: number }) => {\r\n    const localId = generateId();\r\n    const newFunc: JobFunction = {\r\n      id: localId,\r\n      name: data.name,\r\n      description: data.description || null,\r\n      canLeadTeam: data.canLeadTeam,\r\n      level: data.level || 0,\r\n      createdAt: new Date(),\r\n    };\r\n\r\n    // Optimistic update\r\n    setFunctions(prev => [...prev, newFunc]);\r\n    storageService.setItem('functions', [...functions, newFunc]);\r\n\r\n    if (navigator.onLine) {\r\n      try {\r\n        const { data: created, error } = await db\r\n          .from('job_functions')\r\n          .insert({\r\n            name: data.name,\r\n            description: data.description || null,\r\n            can_lead_team: data.canLeadTeam,\r\n            level: data.level || 0,\r\n          })\r\n          .select()\r\n          .single();\r\n\r\n        if (error) throw error;\r\n\r\n        const updatedFunc = {\r\n          ...newFunc,\r\n          id: created.id,\r\n        };\r\n\r\n        setFunctions(prev => prev.map(f => f.id === localId ? updatedFunc : f));\r\n        storageService.setItem('functions', functions.map(f => f.id === localId ? updatedFunc : f));\r\n\r\n        return { success: true, data: updatedFunc };\r\n      } catch (error: any) {\r\n        logError('Function Create', error);\r\n        const userMessage = mapDatabaseError(error);\r\n        toast({\r\n          title: 'Erro ao criar função',\r\n          description: userMessage,\r\n          variant: 'destructive',\r\n        });\r\n        setFunctions(prev => prev.filter(f => f.id !== localId));\r\n        return { success: false, error: userMessage };\r\n      }\r\n    } else {\r\n      storageService.addToSyncQueue({\r\n        operation: 'insert',\r\n        table: 'job_functions',\r\n        data: { ...data, localId },\r\n      });\r\n      return { success: true, data: newFunc, offline: true };\r\n    }\r\n  };\r\n\r\n  const updateFunction = async (id: string, data: { name: string; description: string; canLeadTeam: boolean; level?: number }) => {\r\n    const oldFunctions = [...functions];\r\n\r\n    setFunctions(prev => prev.map(f =>\r\n      f.id === id ? { ...f, name: data.name, description: data.description, canLeadTeam: data.canLeadTeam, level: data.level ?? f.level } : f\r\n    ));\r\n\r\n    if (navigator.onLine) {\r\n      try {\r\n        const { error } = await db\r\n          .from('job_functions')\r\n          .update({\r\n            name: data.name,\r\n            description: data.description || null,\r\n            can_lead_team: data.canLeadTeam,\r\n            level: data.level ?? 0,\r\n          })\r\n          .eq('id', id);\r\n\r\n        if (error) throw error;\r\n\r\n        storageService.setItem('functions', functions.map(f =>\r\n          f.id === id ? { ...f, ...data } : f\r\n        ));\r\n\r\n        return { success: true };\r\n      } catch (error: any) {\r\n        logError('Function Update', error);\r\n        setFunctions(oldFunctions);\r\n        const userMessage = mapDatabaseError(error);\r\n        toast({\r\n          title: 'Erro ao atualizar função',\r\n          description: userMessage,\r\n          variant: 'destructive',\r\n        });\r\n        return { success: false, error: userMessage };\r\n      }\r\n    } else {\r\n      storageService.addToSyncQueue({\r\n        operation: 'update',\r\n        table: 'job_functions',\r\n        id,\r\n        data,\r\n      });\r\n      storageService.setItem('functions', functions);\r\n      return { success: true, offline: true };\r\n    }\r\n  };\r\n\r\n  const deleteFunction = async (id: string) => {\r\n    const oldFunctions = [...functions];\r\n    setFunctions(prev => prev.filter(f => f.id !== id));\r\n\r\n    if (navigator.onLine) {\r\n      try {\r\n        const { error } = await db\r\n          .from('job_functions')\r\n          .delete()\r\n          .eq('id', id);\r\n\r\n        if (error) throw error;\r\n\r\n        storageService.setItem('functions', functions.filter(f => f.id !== id));\r\n        return { success: true };\r\n      } catch (error: any) {\r\n        logError('Function Delete', error);\r\n        setFunctions(oldFunctions);\r\n        const userMessage = mapDatabaseError(error);\r\n        toast({\r\n          title: 'Erro ao remover função',\r\n          description: userMessage,\r\n          variant: 'destructive',\r\n        });\r\n        return { success: false, error: userMessage };\r\n      }\r\n    } else {\r\n      storageService.addToSyncQueue({\r\n        operation: 'delete',\r\n        table: 'job_functions',\r\n        id,\r\n      });\r\n      storageService.setItem('functions', functions.filter(f => f.id !== id));\r\n      return { success: true, offline: true };\r\n    }\r\n  };\r\n\r\n  return {\r\n    functions,\r\n    isLoading,\r\n    createFunction,\r\n    updateFunction,\r\n    deleteFunction,\r\n    refresh: loadFunctions,\r\n  };\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\useMessages.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1017,1020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1017,1020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1715,1718],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1715,1718],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2254,2257],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2254,2257],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":91,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2719,2722],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2719,2722],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2881,2884],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2881,2884],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2993,2996],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2993,2996],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3215,3218],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3215,3218],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":114,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3578,3581],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3578,3581],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":139,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4602,4605],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4602,4605],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":155,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5205,5208],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5205,5208],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":172,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6026,6029],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6026,6029],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":181,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6354,6357],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6354,6357],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":190,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6744,6747],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6744,6747],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":198,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":198,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7104,7107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7104,7107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":206,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":206,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7326,7329],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7326,7329],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":220,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7953,7956],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7953,7956],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":240,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":240,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8872,8875],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8872,8875],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":279,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":279,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10464,10467],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10464,10467],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":293,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":293,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10965,10968],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10965,10968],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":312,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":312,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11556,11559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11556,11559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":326,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":326,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12127,12130],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12127,12130],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":334,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":334,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12389,12392],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12389,12392],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":22,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { db } from '@/integrations/database';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { isGestaoGlobal } from '@/utils/permissionHelpers';\r\n\r\n// Tipos de Ticket\r\nexport type TicketType = 'PASSWORD_RESET' | 'ADMINISTRATIVE' | 'RH' | 'OPERATIONAL' | 'DIRECT' | 'OTHER';\r\n\r\n// Status do Ticket\r\nexport type TicketStatus = 'PENDING' | 'IN_ANALYSIS' | 'AWAITING_RESPONSE' | 'APPROVED' | 'REJECTED' | 'CLOSED';\r\n\r\nexport interface SystemMessage {\r\n    id: string;\r\n    senderId?: string;\r\n    senderEmail?: string;\r\n    recipientRole?: string;\r\n    recipientId?: string;\r\n    companyId?: string;\r\n    projectId?: string;\r\n    siteId?: string;\r\n    type: TicketType;\r\n    subject: string;\r\n    content: string;\r\n    attachmentUrl?: string;\r\n    status: TicketStatus;\r\n    createdAt: string;\r\n    updatedAt?: string;\r\n    resolvedBy?: string;\r\n    resolvedAt?: string;\r\n    metadata?: Record<string, any>;\r\n    sender?: {\r\n        full_name: string;\r\n        email: string;\r\n    };\r\n}\r\n\r\nexport interface TicketHistory {\r\n    id: string;\r\n    ticketId: string;\r\n    action: string;\r\n    oldStatus?: string;\r\n    newStatus?: string;\r\n    performedBy?: string;\r\n    comment?: string;\r\n    createdAt: string;\r\n}\r\n\r\nexport interface CreateTicketPayload {\r\n    type: TicketType;\r\n    subject: string;\r\n    content: string;\r\n    recipientRole?: string;\r\n    recipientId?: string;\r\n    recipientIdEmployee?: string;\r\n    companyId?: string;\r\n    projectId?: string;\r\n    siteId?: string;\r\n    attachmentUrl?: string;\r\n    senderEmail?: string; // Para solicitações anônimas\r\n    metadata?: Record<string, any>;\r\n}\r\n\r\nexport function useMessages() {\r\n    const [messages, setMessages] = useState<SystemMessage[]>([]);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const { profile, user } = useAuth();\r\n    const { toast } = useToast();\r\n\r\n    const fetchMessages = useCallback(async () => {\r\n        if (!profile) {\r\n            setIsLoading(false);\r\n            return;\r\n        }\r\n        setIsLoading(true);\r\n        try {\r\n            // 1. Fetch Messages\r\n            const { data: msgsData, error: msgsError } = await (db as any)\r\n                .from('system_messages')\r\n                .select('*')\r\n                .order('created_at', { ascending: false });\r\n\r\n            if (msgsError) throw msgsError;\r\n\r\n            if (!msgsData || msgsData.length === 0) {\r\n                setMessages([]);\r\n                return;\r\n            }\r\n\r\n            // 2. Extrair IDs de remetentes (podem ser perfis ou funcionários)\r\n            const senderIds = Array.from(new Set(msgsData.map((m: any) => m.sender_id).filter(Boolean))) as string[];\r\n\r\n            // 3. Buscar Perfis e Funcionários para Remetentes\r\n            const namesMap: Record<string, any> = {};\r\n\r\n            if (senderIds.length > 0) {\r\n                const { data: usersData } = await (db as any)\r\n                    .from('users')\r\n                    .select('id, name, full_name, email')\r\n                    .in('id', senderIds);\r\n\r\n                if (usersData) {\r\n                    usersData.forEach((p: any) => {\r\n                        namesMap[p.id] = {\r\n                            id: p.id,\r\n                            full_name: p.name || p.full_name,\r\n                            email: p.email\r\n                        };\r\n                    });\r\n                }\r\n            }\r\n\r\n            // 4. Merge Data\r\n            setMessages(msgsData.map((msg: any) => ({\r\n                id: msg.id,\r\n                senderId: msg.sender_id,\r\n                senderEmail: msg.sender_email,\r\n                recipientRole: msg.recipient_role,\r\n                recipientId: msg.recipient_id || msg.recipient_id_employee,\r\n                companyId: msg.company_id,\r\n                projectId: msg.project_id,\r\n                siteId: msg.site_id,\r\n                type: msg.type,\r\n                subject: msg.subject,\r\n                content: msg.content,\r\n                attachmentUrl: msg.attachment_url,\r\n                status: msg.status,\r\n                createdAt: msg.created_at,\r\n                updatedAt: msg.updated_at,\r\n                resolvedBy: msg.resolved_by,\r\n                resolvedAt: msg.resolved_at,\r\n                metadata: msg.metadata,\r\n                sender: namesMap[msg.sender_id] || {\r\n                    full_name: 'Desconhecido',\r\n                    email: msg.sender_email || ''\r\n                }\r\n            })));\r\n\r\n        } catch (error: any) {\r\n            console.error('Error fetching messages:', error);\r\n            if (error.code === '42P01' || error.message?.includes('does not exist')) {\r\n                toast({\r\n                    title: 'Tabela não encontrada',\r\n                    description: 'Execute o SQL do schema de tickets no db.',\r\n                    variant: 'destructive'\r\n                });\r\n            }\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }, [profile, toast]);\r\n\r\n    const sendMessage = async (payload: CreateTicketPayload) => {\r\n        try {\r\n            const insertData: any = {\r\n                sender_id: profile?.id,\r\n                sender_email: payload.senderEmail || user?.email,\r\n                recipient_role: payload.recipientRole,\r\n                recipient_id: payload.recipientId,\r\n                recipient_id_employee: payload.recipientIdEmployee,\r\n                company_id: payload.companyId || profile?.companyId,\r\n                project_id: payload.projectId || profile?.projectId,\r\n                site_id: payload.siteId || profile?.siteId,\r\n                type: payload.type,\r\n                subject: payload.subject,\r\n                content: payload.content,\r\n                attachment_url: payload.attachmentUrl,\r\n                status: 'PENDING',\r\n                metadata: payload.metadata || {}\r\n            };\r\n\r\n            const { error } = await (db as any)\r\n                .from('system_messages')\r\n                .insert(insertData);\r\n\r\n            if (error) throw error;\r\n\r\n            toast({ title: 'Ticket criado', description: 'Sua solicitação foi registrada com sucesso.' });\r\n            fetchMessages();\r\n            return { success: true };\r\n        } catch (error: any) {\r\n            console.error('Send Error:', error);\r\n            toast({ title: 'Erro ao criar ticket', description: error.message, variant: 'destructive' });\r\n            return { success: false, error: error.message };\r\n        }\r\n    };\r\n\r\n    const updateMessageStatus = async (id: string, status: TicketStatus, comment?: string) => {\r\n        try {\r\n            const updateData: any = { status };\r\n\r\n            // Se aprovado ou rejeitado, registrar quem resolveu\r\n            if (status === 'APPROVED' || status === 'REJECTED' || status === 'CLOSED') {\r\n                updateData.resolved_by = profile?.id;\r\n                updateData.resolved_at = new Date().toISOString();\r\n            }\r\n\r\n            const { error } = await (db as any)\r\n                .from('system_messages')\r\n                .update(updateData)\r\n                .eq('id', id);\r\n\r\n            if (error) throw error;\r\n\r\n            // Registrar no histórico\r\n            await (db as any)\r\n                .from('ticket_history')\r\n                .insert({\r\n                    ticket_id: id,\r\n                    action: 'status_changed',\r\n                    old_status: messages.find(m => m.id === id)?.status,\r\n                    new_status: status,\r\n                    performed_by: profile?.id,\r\n                    comment: comment\r\n                });\r\n\r\n            setMessages(prev => prev.map(m => m.id === id ? { ...m, status } : m));\r\n            toast({ title: 'Status atualizado', description: `Ticket marcado como ${status}` });\r\n            return { success: true };\r\n        } catch (error: any) {\r\n            toast({ title: 'Erro ao atualizar', description: error.message, variant: 'destructive' });\r\n            return { success: false };\r\n        }\r\n    };\r\n\r\n    // Aprovar solicitação de redefinição de senha\r\n    const approvePasswordReset = async (ticketId: string, targetUserId: string) => {\r\n        try {\r\n            // 1. Buscar o ticket para obter o e-mail do remetente\r\n            const ticket = messages.find(m => m.id === ticketId);\r\n            const userEmail = ticket?.senderEmail || ticket?.sender?.email;\r\n\r\n            // 2. Atualizar status do ticket\r\n            await updateMessageStatus(ticketId, 'APPROVED', 'Redefinição de senha autorizada e e-mail enviado.');\r\n\r\n            // 3. Criar permissão temporária (12 horas)\r\n            const expiresAt = new Date();\r\n            expiresAt.setHours(expiresAt.getHours() + 12);\r\n\r\n            const { error: permError } = await (db as any)\r\n                .from('temporary_permissions')\r\n                .insert({\r\n                    user_id: targetUserId,\r\n                    permission_type: 'password_change',\r\n                    granted_by: profile?.id,\r\n                    ticket_id: ticketId,\r\n                    expires_at: expiresAt.toISOString()\r\n                });\r\n\r\n            if (permError) throw permError;\r\n\r\n            // 4. Enviar e-mail de recuperação do db se o e-mail estiver disponível\r\n            if (userEmail) {\r\n                const { error: resetError } = await db.auth.resetPasswordForEmail(userEmail, {\r\n                    redirectTo: `${window.location.origin}/auth?mode=reset`,\r\n                });\r\n\r\n                if (resetError) {\r\n                    console.warn('Erro ao enviar e-mail de reset:', resetError);\r\n                    toast({\r\n                        title: 'Aviso',\r\n                        description: 'Ticket aprovado, mas houve um problema ao disparar o e-mail automático.',\r\n                        variant: 'destructive'\r\n                    });\r\n                } else {\r\n                    toast({\r\n                        title: 'E-mail enviado',\r\n                        description: `Um e-mail de redefinição foi enviado para ${userEmail}.`\r\n                    });\r\n                }\r\n            }\r\n\r\n            toast({\r\n                title: 'Redefinição autorizada',\r\n                description: 'Acesso liberado para alteração de senha nas próximas 12 horas.'\r\n            });\r\n\r\n            return { success: true };\r\n        } catch (error: any) {\r\n            toast({ title: 'Erro', description: error.message, variant: 'destructive' });\r\n            return { success: false };\r\n        }\r\n    };\r\n\r\n    // Verificar se o usuário tem permissão para alterar senha\r\n    const checkPasswordPermission = async (): Promise<boolean> => {\r\n        if (!profile?.id) return false;\r\n\r\n        // SuperAdmin sempre pode\r\n        if (isGestaoGlobal(profile || undefined)) return true;\r\n\r\n        try {\r\n            const { data, error } = await (db as any)\r\n                .from('temporary_permissions')\r\n                .select('id')\r\n                .eq('user_id', profile.id)\r\n                .eq('permission_type', 'password_change')\r\n                .gt('expires_at', new Date().toISOString())\r\n                .is('used_at', null)\r\n                .limit(1);\r\n\r\n            if (error) throw error;\r\n            return data && data.length > 0;\r\n        } catch {\r\n            return false;\r\n        }\r\n    };\r\n\r\n    // Marcar permissão como usada\r\n    const usePasswordPermission = async () => {\r\n        try {\r\n            await (db as any)\r\n                .from('temporary_permissions')\r\n                .update({ used_at: new Date().toISOString() })\r\n                .eq('user_id', profile?.id)\r\n                .eq('permission_type', 'password_change')\r\n                .is('used_at', null);\r\n        } catch (error) {\r\n            console.error('Error marking permission as used:', error);\r\n        }\r\n    };\r\n\r\n    // Buscar histórico de um ticket\r\n    const fetchTicketHistory = async (ticketId: string): Promise<TicketHistory[]> => {\r\n        try {\r\n            const { data, error } = await (db as any)\r\n                .from('ticket_history')\r\n                .select('*')\r\n                .eq('ticket_id', ticketId)\r\n                .order('created_at', { ascending: true });\r\n\r\n            if (error) throw error;\r\n\r\n            return (data || []).map((h: any) => ({\r\n                id: h.id,\r\n                ticketId: h.ticket_id,\r\n                action: h.action,\r\n                oldStatus: h.old_status,\r\n                newStatus: h.new_status,\r\n                performedBy: h.performed_by,\r\n                comment: h.comment,\r\n                createdAt: h.created_at\r\n            }));\r\n        } catch {\r\n            return [];\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchMessages();\r\n    }, [fetchMessages]);\r\n\r\n    return {\r\n        messages,\r\n        isLoading,\r\n        sendMessage,\r\n        updateMessageStatus,\r\n        approvePasswordReset,\r\n        checkPasswordPermission,\r\n        usePasswordPermission,\r\n        fetchTicketHistory,\r\n        refresh: fetchMessages\r\n    };\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\usePermissions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1147,1150],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1147,1150],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback } from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\n\r\nexport type UserPermission =\r\n    | 'employees.view' | 'employees.edit' | 'employees.delete'\r\n    | 'teams.view' | 'teams.edit' | 'teams.delete'\r\n    | 'records.view' | 'records.edit' | 'records.delete'\r\n    | 'reports.view' | 'reports.create' | 'reports.delete'\r\n    | 'su.manage' | 'settings.view' | 'messages.view'\r\n    | 'map.view' | 'map.edit' | 'map.manage';\r\n\r\nexport function usePermissions() {\r\n    const { profile } = useAuth();\r\n\r\n    /**\r\n     * Verifica se o usuário tem uma permissão específica.\r\n     * @param permission Código do módulo/ação (ex: 'employees.delete')\r\n     * @returns boolean\r\n     */\r\n    const can = useCallback((permission: UserPermission): boolean => {\r\n        if (!profile) return false;\r\n\r\n        // Regra de Ouro: SUPERADMINGOD (isSystemAdmin) tem passe livre em tudo\r\n        if (profile.isSystemAdmin) return true;\r\n\r\n        // Se o mapa de permissões estiver carregado no profile, verificamos lá\r\n        // Caso contrário, retorna falso por segurança (fail-closed)\r\n        const userPermissions = (profile as any).permissions || {};\r\n        return !!userPermissions[permission];\r\n    }, [profile]);\r\n\r\n    /**\r\n     * Verifica multiplas permissões (AND)\r\n     */\r\n    const canAll = useCallback((permissions: UserPermission[]): boolean => {\r\n        return permissions.every(p => can(p));\r\n    }, [can]);\r\n\r\n    /**\r\n     * Verifica se tem pelo menos uma das permissões (OR)\r\n     */\r\n    const canAny = useCallback((permissions: UserPermission[]): boolean => {\r\n        return permissions.some(p => can(p));\r\n    }, [can]);\r\n\r\n    return {\r\n        can,\r\n        canAll,\r\n        canAny\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\useProductionLogs.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\useProjectVisibility.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'cacheService' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1520,1523],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1520,1523],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":108,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4534,4537],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4534,4537],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5892,5895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5892,5895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":167,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6701,6704],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6701,6704],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":189,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7814,7817],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7814,7817],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":220,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9150,9153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9150,9153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { orionApi } from '@/integrations/orion/client';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { cacheService } from '@/services/cacheService';\r\nimport type { ModelTransform } from '@/components/map/cable-config-modal';\r\n\r\nexport interface PlacemarkOverride {\r\n    name?: string;\r\n    angle?: number;\r\n    color?: string;\r\n    height?: number;\r\n    elevation?: number;\r\n    customModelUrl?: string;\r\n    customModelTransform?: ModelTransform;\r\n    texture?: string;\r\n}\r\n\r\nexport function useProjectVisibility(selectedProjectId: string) {\r\n    const { profile } = useAuth();\r\n    const { toast } = useToast();\r\n    const [hiddenPlacemarkIds, setHiddenPlacemarkIds] = useState<Set<string>>(new Set());\r\n    const [placemarkOverrides, setPlacemarkOverrides] = useState<Record<string, PlacemarkOverride>>({});\r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    const loadVisibility = useCallback(async () => {\r\n        if (!profile?.id) return;\r\n        setIsLoading(true);\r\n        try {\r\n            const { data, error } = await orionApi\r\n                .from('map_element_visibility')\r\n                .select('*')\r\n                .eq('userId', profile.id);\r\n\r\n            if (error) throw error;\r\n\r\n            if (data) {\r\n                const hiddenSet = new Set<string>();\r\n                const overrides: Record<string, PlacemarkOverride> = {};\r\n\r\n                (data as any[]).forEach(item => {\r\n                    const eElementId = item.elementId || item.element_id;\r\n                    const eProjectId = item.projectId || item.project_id;\r\n                    const eDocumentId = item.documentId || item.document_id;\r\n                    const eIsHidden = item.isHidden !== undefined ? item.isHidden : item.is_hidden;\r\n\r\n                    const effectiveDocId = eDocumentId || eProjectId;\r\n                    const compositeId = `${effectiveDocId}:::${eElementId}`;\r\n\r\n                    if (eIsHidden) {\r\n                        hiddenSet.add(compositeId);\r\n                    }\r\n\r\n                    overrides[compositeId] = {\r\n                        name: item.elementName || item.element_name,\r\n                        angle: item.elementAngle !== undefined ? item.elementAngle : item.element_angle,\r\n                        color: item.elementColor || item.element_color,\r\n                        height: item.elementHeight !== undefined ? item.elementHeight : item.element_height,\r\n                        elevation: item.elementElevation !== undefined ? item.elementElevation : item.element_elevation,\r\n                        customModelUrl: item.customModelUrl || item.custom_model_url,\r\n                        customModelTransform: (item.customModelTransform || item.custom_model_transform) as ModelTransform,\r\n                        texture: item.elementTexture || item.element_texture\r\n                    };\r\n                });\r\n\r\n                setHiddenPlacemarkIds(hiddenSet);\r\n                setPlacemarkOverrides(overrides);\r\n            }\r\n        } catch (err) {\r\n            console.error('Error loading visibility settings:', err);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }, [profile?.id]);\r\n\r\n    useEffect(() => {\r\n        loadVisibility();\r\n    }, [loadVisibility]);\r\n\r\n    const hidePlacemark = async (docId: string, elementId: string, name: string) => {\r\n        if (!profile?.id) return;\r\n        const compositeId = `${docId}:::${elementId}`;\r\n\r\n        // Optimistic update\r\n        setHiddenPlacemarkIds(prev => {\r\n            const next = new Set(prev);\r\n            next.add(compositeId);\r\n            return next;\r\n        });\r\n\r\n        try {\r\n            const projectId = (docId === selectedProjectId) ? selectedProjectId : undefined; // Simplified\r\n\r\n            const { error } = await orionApi\r\n                .from('map_element_visibility')\r\n                .upsert({\r\n                    userId: profile.id,\r\n                    projectId: selectedProjectId !== 'all' ? selectedProjectId : (projectId || null),\r\n                    documentId: docId === selectedProjectId ? null : docId,\r\n                    elementId: elementId,\r\n                    elementName: name,\r\n                    isHidden: true\r\n                }, {\r\n                    onConflict: 'user_id, project_id, element_id, document_id'\r\n                });\r\n\r\n            if (error) throw error;\r\n        } catch (err: any) {\r\n            console.error('Error hiding placemark:', err);\r\n            setHiddenPlacemarkIds(prev => {\r\n                const next = new Set(prev);\r\n                next.delete(compositeId);\r\n                return next;\r\n            });\r\n            toast({ title: \"Erro ao ocultar\", description: err.message, variant: \"destructive\" });\r\n        }\r\n    };\r\n\r\n    const showPlacemark = async (docId: string, elementId: string, name: string) => {\r\n        if (!profile?.id) return;\r\n        const compositeId = `${docId}:::${elementId}`;\r\n\r\n        setHiddenPlacemarkIds(prev => {\r\n            const next = new Set(prev);\r\n            next.delete(compositeId);\r\n            return next;\r\n        });\r\n\r\n        try {\r\n            const { error } = await orionApi\r\n                .from('map_element_visibility')\r\n                .upsert({\r\n                    userId: profile.id,\r\n                    projectId: selectedProjectId !== 'all' ? selectedProjectId : null,\r\n                    documentId: docId === selectedProjectId ? null : docId,\r\n                    elementId: elementId,\r\n                    elementName: name,\r\n                    isHidden: false\r\n                }, {\r\n                    onConflict: 'user_id, project_id, element_id, document_id'\r\n                });\r\n\r\n            if (error) throw error;\r\n        } catch (err: any) {\r\n            console.error('Error showing placemark:', err);\r\n            setHiddenPlacemarkIds(prev => {\r\n                const next = new Set(prev);\r\n                next.add(compositeId);\r\n                return next;\r\n            });\r\n            toast({ title: \"Erro ao reativar\", description: err.message, variant: \"destructive\" });\r\n        }\r\n    };\r\n\r\n    const updateOverride = async (docId: string, elementId: string, override: Partial<PlacemarkOverride>) => {\r\n        if (!profile?.id) return;\r\n        const compositeId = `${docId}:::${elementId}`;\r\n\r\n        // Local State\r\n        setPlacemarkOverrides(prev => ({\r\n            ...prev,\r\n            [compositeId]: { ...prev[compositeId], ...override }\r\n        }));\r\n\r\n        try {\r\n            // Save to DB\r\n            const data: any = {\r\n                userId: profile.id,\r\n                projectId: selectedProjectId !== 'all' ? selectedProjectId : null,\r\n                documentId: docId === selectedProjectId ? null : docId,\r\n                elementId: elementId,\r\n                isHidden: false,\r\n                ...override\r\n            };\r\n\r\n            // Map frontend override keys to DB expected keys if necessary\r\n            // e.g. height -> elementHeight\r\n            if (override.height !== undefined) data.elementHeight = override.height;\r\n            if (override.angle !== undefined) data.elementAngle = override.angle;\r\n            if (override.color !== undefined) data.elementColor = override.color;\r\n            if (override.name !== undefined) data.elementName = override.name;\r\n            if (override.texture !== undefined) data.elementTexture = override.texture;\r\n\r\n            const { error } = await orionApi.from('map_element_visibility').upsert(data, {\r\n                onConflict: 'user_id, project_id, element_id, document_id'\r\n            });\r\n\r\n            if (error) throw error;\r\n        } catch (err: any) {\r\n            console.error('Error updating override:', err);\r\n            toast({ title: \"Erro ao salvar\", description: err.message, variant: \"destructive\" });\r\n        }\r\n    };\r\n\r\n    const showAllHidden = async () => {\r\n        if (!profile?.id) return;\r\n\r\n        // Optimistic clear\r\n        setHiddenPlacemarkIds(new Set());\r\n\r\n        try {\r\n            // Construir query params manualmente para garantir UPDATE em massa (PUT com query params)\r\n            // O OrionClient pode não converter .eq() em query params para métodos de UPDATE corretamente\r\n            const params: Record<string, string> = { userId: profile.id };\r\n            if (selectedProjectId && selectedProjectId !== 'all') {\r\n                params['projectId'] = selectedProjectId;\r\n            }\r\n\r\n            // Usamos o método 'request' diretamente para ter controle total\r\n            // Enviando PUT /api/v1/map_element_visibility?userId=...\r\n            const { error } = await orionApi['request'](\r\n                '/map_element_visibility',\r\n                'PUT',\r\n                { isHidden: false }, // Body\r\n                params // Query params\r\n            );\r\n\r\n            if (error) throw error;\r\n            toast({ title: \"Lista limpa\", description: \"Todos os elementos foram reativados com sucesso.\" });\r\n        } catch (err: any) {\r\n            console.error('Error showing all placemarks:', err);\r\n            // Revert state on error by reloading\r\n            loadVisibility();\r\n            toast({ title: \"Erro ao reativar\", description: err.message, variant: \"destructive\" });\r\n        }\r\n    };\r\n\r\n    return {\r\n        hiddenPlacemarkIds,\r\n        placemarkOverrides,\r\n        isLoading,\r\n        hidePlacemark,\r\n        showPlacemark,\r\n        showAllHidden,\r\n        updateOverride,\r\n        refresh: loadVisibility,\r\n        setHiddenPlacemarkIds,\r\n        setPlacemarkOverrides\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\useProjects.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'companyId' is defined but never used.","line":8,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":38}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useCallback } from 'react';\r\nimport { projects as projectsSignal, isLoadingData, fetchGlobalData, Project } from '@/signals/globalDataSignals';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { orionApi } from '@/integrations/orion/client';\r\n\r\nexport type { Project };\r\n\r\nexport function useProjects(companyId?: string) {\r\n    const { toast } = useToast();\r\n\r\n    const loadProjects = useCallback(async () => {\r\n        await fetchGlobalData();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        loadProjects();\r\n    }, [loadProjects]);\r\n\r\n    const createProject = async (data: Partial<Project>) => {\r\n        const { data: created, error } = await orionApi.post<Project>('projects', data);\r\n        if (error) {\r\n            toast({ title: 'Erro ao criar obra', description: error.message, variant: 'destructive' });\r\n            return null;\r\n        }\r\n        await fetchGlobalData();\r\n        toast({ title: 'Obra criada com sucesso' });\r\n        return created;\r\n    };\r\n\r\n    const updateProject = async (id: string, data: Partial<Project>) => {\r\n        const { error } = await orionApi.put(`projects/${id}`, data);\r\n        if (error) {\r\n            toast({ title: 'Erro ao atualizar obra', description: error.message, variant: 'destructive' });\r\n            return false;\r\n        }\r\n        await fetchGlobalData();\r\n        toast({ title: 'Obra atualizada com sucesso' });\r\n        return true;\r\n    };\r\n\r\n    const deleteProject = async (id: string) => {\r\n        const { error } = await orionApi.delete(`projects/${id}`);\r\n        if (error) {\r\n            toast({ title: 'Erro ao excluir obra', description: error.message, variant: 'destructive' });\r\n            return false;\r\n        }\r\n        await fetchGlobalData();\r\n        toast({ title: 'Obra excluída com sucesso' });\r\n        return true;\r\n    };\r\n\r\n    return {\r\n        projects: projectsSignal.value,\r\n        isLoading: isLoadingData.value,\r\n        createProject,\r\n        updateProject,\r\n        deleteProject,\r\n        refresh: fetchGlobalData\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\useSites.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1020,1023],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1020,1023],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1681,1684],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1681,1684],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3171,3174],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3171,3174],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3425,3428],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3425,3428],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4365,4368],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4365,4368],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4707,4710],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4707,4710],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4961,4964],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4961,4964],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5002,5005],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5002,5005],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":145,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6041,6044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6041,6044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":153,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6351,6354],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6351,6354],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":162,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6614,6617],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6614,6617],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { db } from '@/integrations/database';\r\nimport { storageService } from '@/services/storageService';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\nexport interface Site {\r\n    id: string;\r\n    projectId: string;\r\n    companyId: string;\r\n    name: string;\r\n    locationDetails: string | null;\r\n    plannedHHH: number;\r\n    latitude: number | null;\r\n    longitude: number | null;\r\n    createdAt: Date;\r\n}\r\n\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { isGestaoGlobal, isCorporateRole } from '@/utils/permissionHelpers';\r\n\r\nexport function useSites(projectId?: string, companyId?: string) {\r\n    const [sites, setSites] = useState<Site[]>([]);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const { toast } = useToast();\r\n    const { profile } = useAuth();\r\n\r\n    const loadSites = useCallback(async () => {\r\n        setIsLoading(true);\r\n        try {\r\n            if (navigator.onLine) {\r\n                let query = (db as any).from('sites').select('*, projects!inner(company_id)');\r\n\r\n                // Security/Filtering Logic:\r\n                const isGod = isGestaoGlobal(profile) || isCorporateRole(profile?.role, profile);\r\n                const effectiveCompanyId = companyId || (isGod ? undefined : profile?.companyId);\r\n\r\n                if (projectId) query = query.eq('project_id', projectId);\r\n                if (effectiveCompanyId) query = query.eq('projects.company_id', effectiveCompanyId);\r\n\r\n                const { data, error } = await query.order('name');\r\n\r\n                if (error) throw error;\r\n\r\n                const mapped: Site[] = (data || []).map((s: any) => ({\r\n                    id: s.id,\r\n                    projectId: s.project_id || s.projectId || s.project?.id,\r\n                    companyId: s.companyId || s.project?.companyId || s.project?.company_id,\r\n                    name: s.name,\r\n                    locationDetails: s.location_details || s.locationDetails,\r\n                    plannedHHH: s.planned_hhh || s.plannedHours || 0,\r\n                    latitude: s.latitude || null,\r\n                    longitude: s.longitude || null,\r\n                    createdAt: new Date(s.created_at || s.createdAt || Date.now()),\r\n                }));\r\n\r\n                setSites(mapped);\r\n                await storageService.setItem('sites', mapped);\r\n            } else {\r\n                const cached = await storageService.getItem<Site[]>('sites') || [];\r\n                let filtered = cached;\r\n                if (projectId) filtered = filtered.filter(s => s.projectId === projectId);\r\n                if (companyId) filtered = filtered.filter(s => s.companyId === companyId);\r\n                setSites(filtered);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error loading sites:', error);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }, [projectId, companyId, profile]);\r\n\r\n    useEffect(() => {\r\n        loadSites();\r\n    }, [loadSites]);\r\n\r\n    const createSite = async (data: Partial<Site>) => {\r\n        try {\r\n            const { data: created, error } = await (db as any)\r\n                .from('sites')\r\n                .insert({\r\n                    projectId: data.projectId,\r\n                    name: data.name,\r\n                    locationDetails: data.locationDetails,\r\n                    plannedHours: (data as any).plannedHHH || 0,\r\n                    latitude: data.latitude || null,\r\n                    longitude: data.longitude || null\r\n                })\r\n                .select()\r\n                .single();\r\n\r\n            if (error) throw error;\r\n\r\n            const newSite: Site = {\r\n                id: created.id,\r\n                projectId: created.project_id,\r\n                companyId: created.projects?.company_id, // We might need to ensure the select includes this\r\n                name: created.name,\r\n                locationDetails: created.location_details,\r\n                plannedHHH: created.planned_hhh || 0,\r\n                latitude: created.latitude || null,\r\n                longitude: created.longitude || null,\r\n                createdAt: new Date(created.created_at)\r\n            };\r\n\r\n            setSites(prev => [...prev, newSite]);\r\n            return { success: true, data: newSite };\r\n        } catch (error: any) {\r\n            toast({ title: 'Erro ao criar canteiro', description: error.message, variant: 'destructive' });\r\n            return { success: false, error: error.message };\r\n        }\r\n    };\r\n\r\n    const updateSite = async (id: string, data: Partial<Site>) => {\r\n        try {\r\n            const { data: updated, error } = await (db as any)\r\n                .from('sites')\r\n                .update({\r\n                    projectId: data.projectId,\r\n                    name: data.name,\r\n                    locationDetails: data.locationDetails,\r\n                    plannedHours: (data as any).plannedHHH !== undefined ? (data as any).plannedHHH : undefined,\r\n                    latitude: data.latitude !== undefined ? data.latitude : undefined,\r\n                    longitude: data.longitude !== undefined ? data.longitude : undefined\r\n                })\r\n                .eq('id', id)\r\n                .select('*, projects(company_id)')\r\n                .single();\r\n\r\n            if (error) throw error;\r\n\r\n            const mapped: Site = {\r\n                id: updated.id,\r\n                projectId: updated.project_id,\r\n                companyId: updated.projects?.company_id,\r\n                name: updated.name,\r\n                locationDetails: updated.location_details,\r\n                plannedHHH: updated.planned_hhh || 0,\r\n                latitude: updated.latitude || null,\r\n                longitude: updated.longitude || null,\r\n                createdAt: new Date(updated.created_at)\r\n            };\r\n\r\n            setSites(prev => prev.map(s => s.id === id ? mapped : s));\r\n            return { success: true, data: mapped };\r\n        } catch (error: any) {\r\n            toast({ title: 'Erro ao atualizar canteiro', description: error.message, variant: 'destructive' });\r\n            return { success: false, error: error.message };\r\n        }\r\n    };\r\n\r\n    const deleteSite = async (id: string) => {\r\n        try {\r\n            const { error } = await (db as any)\r\n                .from('sites')\r\n                .delete()\r\n                .eq('id', id);\r\n\r\n            if (error) throw error;\r\n\r\n            setSites(prev => prev.filter(s => s.id !== id));\r\n            return { success: true };\r\n        } catch (error: any) {\r\n            toast({ title: 'Erro ao excluir canteiro', description: error.message, variant: 'destructive' });\r\n            return { success: false, error: error.message };\r\n        }\r\n    };\r\n\r\n    return {\r\n        sites,\r\n        isLoading,\r\n        createSite,\r\n        updateSite,\r\n        deleteSite,\r\n        refresh: loadSites\r\n    };\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\useSpanTechnicalData.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[678,681],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[678,681],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1870,1873],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1870,1873],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":101,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4213,4216],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4213,4216],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'towerError' is assigned a value but never used.","line":144,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":144,"endColumn":52},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":147,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6589,6592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6589,6592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":206,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":206,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10009,10012],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10009,10012],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSpans'. Either include it or remove the dependency array.","line":216,"column":8,"nodeType":"ArrayExpression","endLine":216,"endColumn":30,"suggestions":[{"desc":"Update the dependencies array to be: [projectId, companyId, fetchSpans]","fix":{"range":[10244,10266],"text":"[projectId, companyId, fetchSpans]"}}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { orionApi } from '@/integrations/orion/client';\r\n\r\nexport interface SpanTechnicalData {\r\n    id: string;\r\n    project_id: string;\r\n    tower_start_id: string;\r\n    tower_end_id: string;\r\n    span_name: string;\r\n    span_length: number;\r\n    height_start: number;\r\n    height_end: number;\r\n    elevation_start: number;\r\n    elevation_end: number;\r\n    sag: number;\r\n    tension: number;\r\n    weight_per_meter: number;\r\n    catenary_constant: number;\r\n    arc_length: number;\r\n    cable_color: string;\r\n    cable_phases: number;\r\n    cable_spacing?: number;\r\n    voltage_kv?: number;\r\n    cable_type?: string;\r\n    geometry?: any; // PostGIS Geometry (GeoJSON)\r\n    sourceTable?: 'segments' | 'span_technical_data' | 'synthesized';\r\n}\r\n\r\nexport function useSpanTechnicalData(projectId?: string, companyId?: string) {\r\n    const [spans, setSpans] = useState<SpanTechnicalData[]>([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState<Error | null>(null);\r\n\r\n    const fetchSpans = async () => {\r\n        if (!projectId && !companyId) {\r\n            setSpans([]);\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n        try {\r\n            let combinedResult: SpanTechnicalData[] = [];\r\n\r\n            // 1. Tentar buscar da nova tabela de SEGMENTS\r\n            let segmentQuery = orionApi.from('segments')\r\n                .select('*, conductors(*)')\r\n                .order('created_at', { ascending: false });\r\n\r\n            if (projectId && projectId !== 'all') {\r\n                segmentQuery = segmentQuery.eq('project_id', projectId);\r\n            }\r\n\r\n            const { data: segments, error: segError } = await segmentQuery;\r\n\r\n            if (!segError && segments && segments.length > 0) {\r\n                const mappedFromSegments = segments.map((seg: any) => {\r\n                    const conductors = seg.conductors || [];\r\n                    const phases = conductors.length;\r\n                    const primaryColor = conductors[0]?.color || '#0ea5e9';\r\n                    const voltage = conductors[0]?.voltageKv || 0;\r\n\r\n                    return {\r\n                        id: seg.id,\r\n                        project_id: seg.projectId || seg.project_id,\r\n                        tower_start_id: seg.fromTowerId || seg.from_tower_id || seg.towerStartId || seg.tower_start_id,\r\n                        tower_end_id: seg.toTowerId || seg.to_tower_id || seg.towerEndId || seg.tower_end_id,\r\n                        span_name: `${seg.fromTowerId} - ${seg.toTowerId}`,\r\n                        span_length: Number(seg.length) || 0,\r\n                        height_start: 30, // Fallback height\r\n                        height_end: 30,\r\n                        elevation_start: 0,\r\n                        elevation_end: 0,\r\n                        sag: Number(conductors[0]?.sag) || 0,\r\n                        tension: Number(conductors[0]?.tension) || 0,\r\n                        weight_per_meter: 0,\r\n                        catenary_constant: 0,\r\n                        arc_length: 0,\r\n                        cable_color: primaryColor,\r\n                        cable_phases: phases > 0 ? phases : 3,\r\n                        cable_spacing: 0.5,\r\n                        voltage_kv: Number(voltage),\r\n                        cable_type: conductors[0]?.cableType || 'Segment',\r\n                        geometry: null,\r\n                        sourceTable: 'segments' as const,\r\n                        _conductors: conductors\r\n                    };\r\n                });\r\n                combinedResult = [...mappedFromSegments];\r\n            }\r\n\r\n            // 2. Fallback/Add: Buscar da tabela antiga SPAN_TECHNICAL_DATA\r\n            let query = orionApi.from('span_technical_data').select('*');\r\n            if (projectId && projectId !== 'all') {\r\n                query = query.eq('project_id', projectId);\r\n            } else if (companyId) {\r\n                query = query.eq('company_id', companyId);\r\n            }\r\n\r\n            const { data, error: apiError } = await query;\r\n            if (!apiError && data && data.length > 0) {\r\n                const mapped = data.map((s: any) => ({\r\n                    id: s.id,\r\n                    project_id: s.project_id || s.projectId,\r\n                    tower_start_id: s.tower_start_id || s.towerStartId,\r\n                    tower_end_id: s.tower_end_id || s.towerEndId,\r\n                    span_name: s.span_name || s.spanName,\r\n                    span_length: s.span_length || s.spanLength,\r\n                    height_start: s.height_start || s.heightStart,\r\n                    height_end: s.height_end || s.heightEnd,\r\n                    elevation_start: s.elevation_start || s.elevationStart,\r\n                    elevation_end: s.elevation_end || s.elevationEnd,\r\n                    sag: s.sag,\r\n                    tension: s.tension,\r\n                    weight_per_meter: s.weight_per_meter || s.weightPerMeter,\r\n                    catenary_constant: s.catenary_constant || s.catenaryConstant,\r\n                    arc_length: s.arc_length || s.arcLength,\r\n                    cable_color: s.cable_color || s.cableColor,\r\n                    cable_phases: s.cable_phases || s.cablePhases,\r\n                    cable_spacing: s.cable_spacing || s.cableSpacing,\r\n                    voltage_kv: s.voltage_kv || s.voltageKv,\r\n                    cable_type: s.cable_type || s.cableType,\r\n                    geometry: s.geometry || s.geometryData,\r\n                    sourceTable: 'span_technical_data' as const\r\n                }));\r\n\r\n                // Add to result if not already matched\r\n                mapped.forEach(s => {\r\n                    const exists = combinedResult.some(cr =>\r\n                        (cr.tower_start_id === s.tower_start_id && cr.tower_end_id === s.tower_end_id)\r\n                    );\r\n                    if (!exists) combinedResult.push(s);\r\n                });\r\n            }\r\n\r\n            // 3. Synthesis: Always attempt to synthesize if we have towers, to fill gaps.\r\n            let towerQuery = orionApi.from('tower_technical_data')\r\n                .select('*')\r\n                .order('object_seq', { ascending: true });\r\n\r\n            if (projectId && projectId !== 'all') {\r\n                towerQuery = towerQuery.eq('project_id', projectId);\r\n            }\r\n\r\n            const { data: towers, error: towerError } = await towerQuery;\r\n\r\n            if (towers && towers.length > 0) {\r\n                const projectGroups = new Map<string, any[]>();\r\n                towers.forEach(t => {\r\n                    const pid = t.project_id || t.projectId || 'default';\r\n                    if (!projectGroups.has(pid)) projectGroups.set(pid, []);\r\n                    projectGroups.get(pid)?.push(t);\r\n                });\r\n\r\n                projectGroups.forEach((groupTowers, pid) => {\r\n                    const sortedTowers = groupTowers.sort((a, b) => (a.object_seq || 0) - (b.object_seq || 0));\r\n\r\n                    for (let i = 0; i < sortedTowers.length - 1; i++) {\r\n                        const current = sortedTowers[i];\r\n                        const next = sortedTowers[i + 1];\r\n\r\n                        const dist = Number(current.distance || current.go_forward || 0);\r\n                        const weight = Math.max(Number(current.weight || 1200), 1000);\r\n                        const currentName = current.object_id || current.objectId || current.name;\r\n                        const nextName = next.object_id || next.objectId || next.name;\r\n\r\n                        if (next && currentName && nextName) {\r\n                            // Only add synthetic if no manual span connects these two towers\r\n                            const exists = combinedResult.some(s =>\r\n                                (s.tower_start_id === currentName && s.tower_end_id === nextName) ||\r\n                                (s.tower_start_id === current.id && s.tower_end_id === next.id)\r\n                            );\r\n\r\n                            if (!exists) {\r\n                                combinedResult.push({\r\n                                    id: `synth-${pid}-${current.id}-${next.id}`,\r\n                                    project_id: pid,\r\n                                    tower_start_id: currentName,\r\n                                    tower_end_id: nextName,\r\n                                    span_name: `${currentName} - ${nextName}`,\r\n                                    span_length: dist || 0,\r\n                                    height_start: Number(current.object_height || current.objectHeight || 30),\r\n                                    height_end: Number(next.object_height || next.objectHeight || 30),\r\n                                    elevation_start: Number(current.object_elevation || current.objectElevation || 0),\r\n                                    elevation_end: Number(next.object_elevation || next.objectElevation || 0),\r\n                                    sag: 0,\r\n                                    tension: weight,\r\n                                    weight_per_meter: 1.5,\r\n                                    catenary_constant: 1000,\r\n                                    arc_length: 0,\r\n                                    cable_color: '#0ea5e9',\r\n                                    cable_phases: 3,\r\n                                    cable_spacing: 0.5,\r\n                                    voltage_kv: 138,\r\n                                    cable_type: 'Synthesized',\r\n                                    geometry: null,\r\n                                    sourceTable: 'synthesized'\r\n                                });\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n\r\n            console.log(`✅ [useSpanTechnicalData] Final spans: ${combinedResult.length}`);\r\n            setSpans(combinedResult);\r\n        } catch (err: any) {\r\n            console.error('Error fetching span technical data:', err);\r\n            setError(err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchSpans();\r\n    }, [projectId, companyId]);\r\n\r\n    return { spans, loading, error, refetchSpans: fetchSpans };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\useTeams.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useState' is defined but never used.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'fetchTeams' is defined but never used.","line":7,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":58},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1364,1367],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1364,1367],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2700,2703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2700,2703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5361,5364],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5361,5364],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":171,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6225,6228],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6225,6228],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":237,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":237,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8347,8350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8347,8350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":275,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9446,9449],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9446,9449],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":309,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":309,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10595,10598],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10595,10598],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":320,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":320,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11203,11206],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11203,11206],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'data' is assigned a value but never used.","line":327,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":327,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":327,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":327,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11550,11553],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11550,11553],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":348,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":348,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12345,12348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12345,12348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":13,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { db } from '@/integrations/database';\r\nimport { storageService } from '@/services/storageService';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { generateId } from '@/lib/utils';\r\nimport { mapDatabaseError, logError } from '@/lib/errorHandler';\r\nimport { teams as teamsSignal, isLoadingTeams, fetchTeams } from '@/signals/teamSignals';\r\n\r\nexport interface Team {\r\n  id: string;\r\n  name: string;\r\n  supervisorId: string | null;\r\n  supervisorName?: string;\r\n  leaderId: string | null;\r\n  members: string[];\r\n  siteId: string | null;\r\n  companyId: string | null;\r\n  projectId: string | null;\r\n  isActive: boolean;\r\n  displayOrder: number;\r\n  laborType: 'MOD' | 'MOI' | null;\r\n  createdAt: string | Date;\r\n}\r\n\r\nexport function useTeams(companyId?: string) {\r\n  const { toast } = useToast();\r\n  const teams = teamsSignal.value; // Alias local para evitar erros de lint em massa\r\n\r\n\r\n  const loadTeams = useCallback(async () => {\r\n    console.log('[useTeams] loadTeams started');\r\n    isLoadingTeams.value = true;\r\n    try {\r\n      if (navigator.onLine) {\r\n        console.log('[useTeams] Online: fetching teams from API...');\r\n        let query = (db\r\n          .from('teams')\r\n          .select(`\r\n            *,\r\n            supervisor:users!teams_supervisor_id_fkey(name)\r\n          `) as any);\r\n\r\n        if (companyId) query = query.eq('company_id', companyId);\r\n\r\n        const { data: teamsData, error: teamsError } = await query.order('name');\r\n\r\n        if (teamsError) {\r\n          console.error('[useTeams] API Teams Error:', teamsError);\r\n          throw teamsError;\r\n        }\r\n\r\n        console.log(`[useTeams] Teams received: ${teamsData?.length || 0}. Fetching members...`);\r\n        const { data: membersData, error: membersError } = await db\r\n          .from('team_members')\r\n          .select('teamId, userId');\r\n\r\n        if (membersError) {\r\n          console.error('[useTeams] API Members Error:', membersError);\r\n          throw membersError;\r\n        }\r\n\r\n        console.log(`[useTeams] Members received: ${membersData?.length || 0}. Processing...`);\r\n        const membersByTeam = (membersData || []).reduce((acc, m) => {\r\n          const tId = m.teamId || m.team_id;\r\n          const uId = m.userId || m.user_id;\r\n          if (!tId) return acc;\r\n          if (!acc[tId]) acc[tId] = [];\r\n          if (uId) acc[tId].push(uId);\r\n          return acc;\r\n        }, {} as Record<string, string[]>);\r\n\r\n        const mapped = (teamsData || []).map(t => ({\r\n          id: t.id,\r\n          name: t.name,\r\n          supervisorId: t.supervisorId || t.supervisor_id,\r\n          supervisorName: (t.supervisor as any)?.name || undefined,\r\n          leaderId: t.supervisorId || t.supervisor_id,\r\n          members: membersByTeam[t.id] || [],\r\n          siteId: t.siteId || t.site_id,\r\n          companyId: t.companyId || t.company_id,\r\n          projectId: t.project_id || t.projectId || null,\r\n          isActive: t.isActive ?? t.is_active ?? true,\r\n          displayOrder: t.displayOrder ?? t.display_order ?? 0,\r\n          laborType: t.laborType || t.labor_type || 'MOD',\r\n          createdAt: new Date(t.createdAt || t.created_at || Date.now()),\r\n        })) as Team[];\r\n\r\n        console.log('[useTeams] Mapping finished. Updating signal and storage...');\r\n        teamsSignal.value = mapped;\r\n        await storageService.setItem('teams', mapped);\r\n        console.log('[useTeams] Storage updated');\r\n      } else {\r\n        console.log('[useTeams] Offline: using cached teams');\r\n        const cached = await storageService.getItem<Team[]>('teams') || [];\r\n        teamsSignal.value = cached;\r\n      }\r\n    } catch (error) {\r\n      console.error('[useTeams] Error loading teams:', error);\r\n      const cached = await storageService.getItem<Team[]>('teams') || [];\r\n      teamsSignal.value = cached;\r\n    } finally {\r\n      console.log('[useTeams] Setting isLoadingTeams to false');\r\n      isLoadingTeams.value = false;\r\n    }\r\n  }, [companyId]);\r\n\r\n  useEffect(() => {\r\n    loadTeams();\r\n  }, [loadTeams]);\r\n\r\n  const createTeam = async (data: { name: string; supervisorId?: string; members: string[]; siteId?: string; companyId?: string; laborType?: 'MOD' | 'MOI' }) => {\r\n    const localId = generateId();\r\n    const newTeam: Team = {\r\n      id: localId,\r\n      name: data.name,\r\n      supervisorId: data.supervisorId || null,\r\n      leaderId: data.supervisorId || null,\r\n      members: data.members,\r\n      siteId: data.siteId || null,\r\n      companyId: data.companyId || null,\r\n      projectId: null,\r\n      isActive: true,\r\n      displayOrder: 0,\r\n      laborType: data.laborType || 'MOD',\r\n      createdAt: new Date(),\r\n    };\r\n\r\n    teamsSignal.value = [...teamsSignal.value, newTeam];\r\n    await storageService.setItem('teams', teamsSignal.value);\r\n\r\n    if (navigator.onLine) {\r\n      try {\r\n        const { data: created, error } = await (db\r\n          .from('teams')\r\n          .insert({\r\n            name: data.name,\r\n            supervisor_id: data.supervisorId || null,\r\n            site_id: data.siteId || null,\r\n            company_id: data.companyId || null,\r\n            display_order: 0,\r\n            labor_type: data.laborType || 'MOD',\r\n          })\r\n          .select(`*, supervisor:users!teams_supervisor_id_fkey(name)`)\r\n          .single() as any);\r\n\r\n        if (error) throw error;\r\n\r\n        // Add team members\r\n        if (data.members.length > 0) {\r\n          const { error: membersError } = await db\r\n            .from('team_members')\r\n            .insert(data.members.map(empId => ({\r\n              team_id: created.id,\r\n              user_id: empId,\r\n            })));\r\n\r\n          if (membersError) console.error('Error adding members:', membersError);\r\n        }\r\n\r\n        const updatedTeam = {\r\n          ...newTeam,\r\n          id: created.id,\r\n          supervisorName: created.supervisor?.name,\r\n          leaderId: created.supervisor_id,\r\n        };\r\n\r\n        teamsSignal.value = teamsSignal.value.map(t => t.id === localId ? updatedTeam : t);\r\n        await storageService.setItem('teams', teamsSignal.value);\r\n\r\n        return { success: true, data: updatedTeam };\r\n      } catch (error: any) {\r\n        logError('Team Create', error);\r\n        teamsSignal.value = teamsSignal.value.filter(t => t.id !== localId);\r\n        const userMessage = mapDatabaseError(error);\r\n        toast({\r\n          title: 'Erro ao criar equipe',\r\n          description: userMessage,\r\n          variant: 'destructive',\r\n        });\r\n        return { success: false, error: userMessage };\r\n      }\r\n    } else {\r\n      await storageService.addToSyncQueue({\r\n        operation: 'insert',\r\n        table: 'teams',\r\n        data: { ...data, localId },\r\n      });\r\n      return { success: true, data: newTeam, offline: true };\r\n    }\r\n  };\r\n\r\n  const updateTeam = async (id: string, data: { name: string; supervisorId?: string; members: string[]; siteId?: string; companyId?: string; laborType?: 'MOD' | 'MOI' }) => {\r\n    const oldTeams = [...teamsSignal.value];\r\n\r\n    teamsSignal.value = teamsSignal.value.map(t =>\r\n      t.id === id ? {\r\n        ...t,\r\n        name: data.name,\r\n        supervisorId: data.supervisorId || null,\r\n        members: data.members,\r\n        siteId: data.siteId || null,\r\n        companyId: data.companyId || null,\r\n        laborType: data.laborType || t.laborType\r\n      } : t\r\n    );\r\n\r\n    if (navigator.onLine) {\r\n      try {\r\n        const { error } = await db\r\n          .from('teams')\r\n          .update({\r\n            name: data.name,\r\n            supervisor_id: data.supervisorId || null,\r\n            site_id: data.siteId || null,\r\n            company_id: data.companyId || null,\r\n            labor_type: data.laborType || undefined,\r\n          })\r\n          .eq('id', id);\r\n\r\n        if (error) throw error;\r\n\r\n        // Update members: delete all and re-insert\r\n        await db.from('team_members').delete().eq('team_id', id);\r\n\r\n        if (data.members.length > 0) {\r\n          await db.from('team_members').insert(\r\n            data.members.map(empId => ({\r\n              team_id: id,\r\n              user_id: empId,\r\n            }))\r\n          );\r\n        }\r\n\r\n        await storageService.setItem('teams', teamsSignal.value);\r\n\r\n        return { success: true };\r\n      } catch (error: any) {\r\n        logError('Team Update', error);\r\n        teamsSignal.value = oldTeams;\r\n        const userMessage = mapDatabaseError(error);\r\n        toast({\r\n          title: 'Erro ao atualizar equipe',\r\n          description: userMessage,\r\n          variant: 'destructive',\r\n        });\r\n        return { success: false, error: userMessage };\r\n      }\r\n    } else {\r\n      await storageService.addToSyncQueue({\r\n        operation: 'update',\r\n        table: 'teams',\r\n        id,\r\n        data,\r\n      });\r\n      await storageService.setItem('teams', teams);\r\n      return { success: true, offline: true };\r\n    }\r\n  };\r\n\r\n  const deleteTeam = async (id: string) => {\r\n    const oldTeams = [...teamsSignal.value];\r\n    teamsSignal.value = teamsSignal.value.filter(t => t.id !== id);\r\n\r\n    if (navigator.onLine) {\r\n      try {\r\n        const { error } = await db\r\n          .from('teams')\r\n          .delete()\r\n          .eq('id', id);\r\n\r\n        if (error) throw error;\r\n\r\n        await storageService.setItem('teams', teamsSignal.value);\r\n        return { success: true };\r\n      } catch (error: any) {\r\n        logError('Team Delete', error);\r\n        teamsSignal.value = oldTeams;\r\n        const userMessage = mapDatabaseError(error);\r\n        toast({\r\n          title: 'Erro ao remover equipe',\r\n          description: userMessage,\r\n          variant: 'destructive',\r\n        });\r\n        return { success: false, error: userMessage };\r\n      }\r\n    } else {\r\n      await storageService.addToSyncQueue({\r\n        operation: 'delete',\r\n        table: 'teams',\r\n        id,\r\n      });\r\n      await storageService.setItem('teams', teamsSignal.value);\r\n      return { success: true, offline: true };\r\n    }\r\n  };\r\n\r\n  return {\r\n    teams: teamsSignal.value,\r\n    isLoading: isLoadingTeams.value,\r\n    createTeam,\r\n    updateTeam,\r\n    deleteTeam,\r\n    addMember: async (teamId: string, employeeId: string) => {\r\n      try {\r\n        const { error } = await db.from('team_members').insert({ team_id: teamId, user_id: employeeId });\r\n        if (error) throw error;\r\n        teamsSignal.value = teamsSignal.value.map(t => t.id === teamId ? { ...t, members: [...t.members, employeeId] } : t);\r\n        return { success: true };\r\n      } catch (err: any) {\r\n        toast({ title: 'Erro ao adicionar membro', description: err.message, variant: 'destructive' });\r\n        return { success: false, error: err.message };\r\n      }\r\n    },\r\n    removeMember: async (teamId: string, employeeId: string) => {\r\n      try {\r\n        const { error } = await db.from('team_members').delete().eq('team_id', teamId).eq('user_id', employeeId);\r\n        if (error) throw error;\r\n        teamsSignal.value = teamsSignal.value.map(t => t.id === teamId ? { ...t, members: t.members.filter(m => m !== employeeId) } : t);\r\n        return { success: true };\r\n      } catch (err: any) {\r\n        toast({ title: 'Erro ao remover membro', description: err.message, variant: 'destructive' });\r\n        return { success: false, error: err.message };\r\n      }\r\n    },\r\n    moveMember: async (employeeId: string, fromTeamId: string | null, toTeamId: string | null) => {\r\n      try {\r\n        const { data, error } = await (db.rpc as any)('move_team_member', {\r\n          p_employee_id: employeeId,\r\n          p_from_team_id: fromTeamId,\r\n          p_to_team_id: toTeamId\r\n        });\r\n        if (error) throw error;\r\n\r\n        teamsSignal.value = teamsSignal.value.map(t => {\r\n          let newMembers = [...t.members];\r\n          // Garante que o ID seja removido se for de onde ele veio (ou qualquer lugar)\r\n          if (t.id === fromTeamId || newMembers.includes(employeeId)) {\r\n            newMembers = newMembers.filter(m => m !== employeeId);\r\n          }\r\n          // Adiciona se for o destino\r\n          if (t.id === toTeamId) {\r\n            newMembers = [...newMembers, employeeId];\r\n          }\r\n          return { ...t, members: newMembers };\r\n        });\r\n\r\n        return { success: true };\r\n      } catch (err: any) {\r\n        toast({ title: 'Erro ao mover membro', description: err.message, variant: 'destructive' });\r\n        return { success: false, error: err.message };\r\n      }\r\n    },\r\n    refresh: loadTeams,\r\n  };\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\useTimeRecords.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useState' is defined but never used.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'fetchTimeRecords' is defined but never used.","line":6,"column":58,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":74},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2410,2413],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2410,2413],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":125,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":125,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":144,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":144,"endColumn":21},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":144,"column":23,"nodeType":"BlockStatement","messageId":"unexpected","endLine":144,"endColumn":26,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[5319,5320],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":217,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8023,8026],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8023,8026],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":275,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10182,10185],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10182,10185],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":314,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":314,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11409,11412],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11409,11412],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":340,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":340,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12293,12296],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12293,12296],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":358,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":358,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12985,12988],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12985,12988],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":378,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":378,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13557,13560],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13557,13560],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { db } from '@/integrations/database';\r\nimport { storageService } from '@/services/storageService';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { generateId } from '@/lib/utils';\r\nimport { timeRecords as recordsSignal, isLoadingRecords, fetchTimeRecords } from '@/signals/timeSignals';\r\n\r\nexport interface TimeRecord {\r\n  id: string;\r\n  employeeId: string;\r\n  userId: string;\r\n  employeeName?: string;\r\n  teamId: string | null;\r\n  companyId: string | null;\r\n  recordType: 'entry' | 'exit';\r\n  type: 'IN' | 'OUT';\r\n  photoUrl: string | null;\r\n  location: string;\r\n  latitude: number | null;\r\n  longitude: number | null;\r\n  recordedAt: string | Date;\r\n  createdBy: string | null;\r\n  syncedAt: string | Date | null;\r\n  localId: string | null;\r\n}\r\n\r\nexport function useTimeRecords() {\r\n  const { toast } = useToast();\r\n\r\n  const saveToStorage = async (recordsToSave: TimeRecord[]) => {\r\n    // Com IndexedDB não precisamos mais limitar fotos ou quantidade\r\n    await storageService.setItem('timeRecords', recordsToSave);\r\n  };\r\n\r\n  const loadRecords = useCallback(async () => {\r\n    console.log('[useTimeRecords] loadRecords started');\r\n    isLoadingRecords.value = true;\r\n    try {\r\n      console.log('[useTimeRecords] Fetching from storage...');\r\n      const localCached = await storageService.getItem<TimeRecord[]>('timeRecords') || [];\r\n      const unsyncedRecords = localCached.filter(r => !r.syncedAt);\r\n      console.log(`[useTimeRecords] Local cached found: ${localCached.length}, Unsynced: ${unsyncedRecords.length}`);\r\n\r\n      if (navigator.onLine) {\r\n        console.log('[useTimeRecords] Online: fetching from API...');\r\n        const { data, error } = await db\r\n          .from('time_records')\r\n          .select(`\r\n            *,\r\n            user:users!time_records_user_id_fkey(name)\r\n          `)\r\n          .order('recorded_at', { ascending: false })\r\n          .limit(100);\r\n\r\n        if (error) {\r\n          console.error('[useTimeRecords] API Error:', error);\r\n          throw error;\r\n        }\r\n\r\n        console.log(`[useTimeRecords] API Data received: ${data?.length || 0} items`);\r\n        const mapped = (data || []).map(r => ({\r\n          id: r.id,\r\n          employeeId: r.user_id,\r\n          userId: r.user_id,\r\n          employeeName: r.user?.name,\r\n          teamId: r.team_id,\r\n          companyId: (r as any).company_id,\r\n          recordType: r.record_type as 'entry' | 'exit',\r\n          type: r.record_type === 'entry' ? 'IN' : 'OUT',\r\n          photoUrl: r.photo_url,\r\n          location: r.latitude ? `${r.latitude},${r.longitude}` : 'N/A',\r\n          latitude: r.latitude,\r\n          longitude: r.longitude,\r\n          recordedAt: new Date(r.recorded_at),\r\n          createdBy: r.created_by,\r\n          syncedAt: r.synced_at ? new Date(r.synced_at) : null,\r\n          localId: r.local_id,\r\n        }) as TimeRecord);\r\n\r\n        console.log('[useTimeRecords] Mapping finished, merging results...');\r\n        const serverLocalIds = new Set(mapped.map(r => r.localId).filter(Boolean));\r\n        const uniqueUnsynced = unsyncedRecords.filter(r => !r.localId || !serverLocalIds.has(r.localId));\r\n\r\n        const mergedRecords = [...uniqueUnsynced, ...mapped];\r\n\r\n        recordsSignal.value = mergedRecords;\r\n        console.log('[useTimeRecords] Signal updated, saving to storage...');\r\n        await saveToStorage(mergedRecords);\r\n        console.log('[useTimeRecords] Storage updated');\r\n      } else {\r\n        console.log('[useTimeRecords] Offline: using cached records');\r\n        recordsSignal.value = localCached;\r\n      }\r\n    } catch (error) {\r\n      console.error('[useTimeRecords] Error loading time records:', error);\r\n      const cached = await storageService.getItem<TimeRecord[]>('timeRecords') || [];\r\n      recordsSignal.value = cached;\r\n    } finally {\r\n      console.log('[useTimeRecords] Setting isLoadingRecords to false');\r\n      isLoadingRecords.value = false;\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    loadRecords();\r\n  }, [loadRecords]);\r\n\r\n  const createRecord = async (data: {\r\n    employeeId: string;\r\n    teamId?: string;\r\n    companyId?: string;\r\n    recordType: 'entry' | 'exit';\r\n    photoUrl?: string;\r\n    latitude?: number;\r\n    longitude?: number;\r\n    recordedAt?: Date;\r\n  }) => {\r\n    const localId = generateId();\r\n\r\n    // Auth check that works offline\r\n    let userId = null;\r\n    try {\r\n      const session = await db.auth.getSession();\r\n      userId = session.data.session?.user?.id || null;\r\n    } catch (e) {\r\n      console.warn('Network auth check failed, using local fallback');\r\n    }\r\n\r\n    // Fallback to storage if db fails (try to find the SB token in localStorage)\r\n    if (!userId) {\r\n      // Loop through localStorage to find the db token key (it usually starts with 'sb-')\r\n      for (let i = 0; i < localStorage.length; i++) {\r\n        const key = localStorage.key(i);\r\n        if (key && key.startsWith('sb-') && key.endsWith('-auth-token')) {\r\n          try {\r\n            const item = localStorage.getItem(key);\r\n            if (item) {\r\n              const parsed = JSON.parse(item);\r\n              if (parsed.user?.id) {\r\n                userId = parsed.user.id;\r\n                break;\r\n              }\r\n            }\r\n          } catch (e) { }\r\n        }\r\n      }\r\n    }\r\n\r\n    // Detect manual worker session\r\n    const manualSession = await storageService.getItem('manual_worker_session');\r\n    const isManualWorker = !!manualSession;\r\n    const effectiveUserId = isManualWorker ? null : userId;\r\n\r\n    const newRecord: TimeRecord = {\r\n      id: localId,\r\n      employeeId: data.employeeId,\r\n      userId: data.employeeId,\r\n      teamId: data.teamId || null,\r\n      companyId: data.companyId || null,\r\n      recordType: data.recordType,\r\n      type: data.recordType === 'entry' ? 'IN' : 'OUT',\r\n      photoUrl: data.photoUrl || null,\r\n      location: data.latitude ? `${data.latitude},${data.longitude}` : 'N/A',\r\n      latitude: data.latitude ?? null,\r\n      longitude: data.longitude ?? null,\r\n      recordedAt: data.recordedAt || new Date(),\r\n      createdBy: effectiveUserId,\r\n      syncedAt: null,\r\n      localId,\r\n    };\r\n\r\n    const isOnline = navigator.onLine;\r\n\r\n    // Optimistically update UI\r\n    recordsSignal.value = [newRecord, ...recordsSignal.value];\r\n    // Save to storage immediately\r\n    await saveToStorage(recordsSignal.value);\r\n\r\n    if (isOnline) {\r\n      try {\r\n        const { data: created, error } = await db\r\n          .from('time_records')\r\n          .insert({\r\n            user_id: data.employeeId,\r\n            team_id: data.teamId || null,\r\n            company_id: data.companyId || null,\r\n            record_type: data.recordType,\r\n            photo_url: data.photoUrl || null,\r\n            latitude: data.latitude ?? null,\r\n            longitude: data.longitude ?? null,\r\n            recorded_at: (newRecord.recordedAt instanceof Date ? newRecord.recordedAt : new Date(newRecord.recordedAt)).toISOString(),\r\n            created_by: effectiveUserId,\r\n            synced_at: new Date().toISOString(),\r\n            local_id: localId,\r\n          })\r\n          .select(`*, user:users!time_records_user_id_fkey(name)`)\r\n          .single();\r\n\r\n        if (error) throw error;\r\n\r\n        const updatedRecord = {\r\n          ...newRecord,\r\n          id: created.id,\r\n          employeeName: created.user?.name,\r\n          syncedAt: new Date(created.synced_at || new Date()),\r\n        };\r\n\r\n        // Update state with confirmed record\r\n        recordsSignal.value = recordsSignal.value.map(r => r.localId === localId ? updatedRecord : r);\r\n\r\n        // Update storage - We reconstruct the list using the current 'records' \r\n        // PLUS the updated record (replacing the optimistic one).\r\n        // Since 'records' captured in closure doesn't have the new record, we prepend it.\r\n        await saveToStorage(recordsSignal.value);\r\n\r\n        return { success: true, data: updatedRecord };\r\n      } catch (error: any) {\r\n        console.warn('Online sync failed, falling back to offline mode. Error:', error instanceof Error ? error.message : 'Unknown error');\r\n        // Fallback to offline mode\r\n        await storageService.addToSyncQueue({\r\n          operation: 'insert',\r\n          table: 'time_records',\r\n          data: { ...data, localId, recordedAt: (newRecord.recordedAt instanceof Date ? newRecord.recordedAt : new Date(newRecord.recordedAt)).toISOString(), createdBy: effectiveUserId },\r\n        });\r\n\r\n        toast({\r\n          title: 'Salvo offline',\r\n          description: 'Registro salvo no dispositivo. Será sincronizado quando houver conexão.',\r\n          duration: 3000,\r\n        });\r\n\r\n        return { success: true, data: newRecord, offline: true };\r\n      }\r\n    } else {\r\n      // Offline mode\r\n      await storageService.addToSyncQueue({\r\n        operation: 'insert',\r\n        table: 'time_records',\r\n        data: { ...data, localId, recordedAt: (newRecord.recordedAt instanceof Date ? newRecord.recordedAt : new Date(newRecord.recordedAt)).toISOString(), createdBy: effectiveUserId },\r\n      });\r\n\r\n      toast({\r\n        title: 'Modo Offline',\r\n        description: 'Registro salvo localmente.',\r\n        duration: 3000,\r\n      });\r\n\r\n      return { success: true, data: newRecord, offline: true };\r\n    }\r\n  };\r\n\r\n\r\n  const updateRecord = async (id: string, data: Partial<TimeRecord>) => {\r\n    try {\r\n      const { error } = await db\r\n        .from('time_records')\r\n        .update({\r\n          user_id: data.employeeId,\r\n          team_id: data.teamId,\r\n          record_type: data.recordType,\r\n          photo_url: data.photoUrl,\r\n          recorded_at: (data.recordedAt instanceof Date ? data.recordedAt : new Date(data.recordedAt!)).toISOString(),\r\n          latitude: data.latitude,\r\n          longitude: data.longitude,\r\n        })\r\n        .eq('id', id);\r\n\r\n      if (error) throw error;\r\n\r\n      const updatedRecords = recordsSignal.value.map(r => r.id === id ? { ...r, ...data } : r);\r\n      recordsSignal.value = updatedRecords;\r\n      await saveToStorage(updatedRecords);\r\n\r\n      return { success: true };\r\n    } catch (error: any) {\r\n      console.warn('Online update failed, falling back to offline mode. Error:', error instanceof Error ? error.message : 'Unknown error');\r\n\r\n      // Fallback: update local state immediately\r\n      const updatedRecords = recordsSignal.value.map(r => r.id === id ? { ...r, ...data } : r);\r\n      recordsSignal.value = updatedRecords;\r\n      await saveToStorage(updatedRecords);\r\n\r\n      // Add to sync queue\r\n      await storageService.addToSyncQueue({\r\n        operation: 'update',\r\n        table: 'time_records',\r\n        itemId: id,\r\n        data: data,\r\n      });\r\n\r\n      toast({\r\n        title: 'Atualização offline',\r\n        description: 'As alterações foram salvas localmente e serão sincronizadas em breve.',\r\n      });\r\n\r\n      return { success: true, offline: true };\r\n    }\r\n  };\r\n\r\n  const deleteRecord = async (id: string) => {\r\n    try {\r\n      const { error } = await db\r\n        .from('time_records')\r\n        .delete()\r\n        .eq('id', id);\r\n\r\n      if (error) throw error;\r\n\r\n      const updatedRecords = recordsSignal.value.filter(r => r.id !== id);\r\n      recordsSignal.value = updatedRecords;\r\n      await saveToStorage(updatedRecords);\r\n\r\n      return { success: true };\r\n    } catch (error: any) {\r\n      console.warn('Online delete failed, falling back to offline mode. Error:', error instanceof Error ? error.message : 'Unknown error');\r\n\r\n      // Fallback: update local state immediately\r\n      const updatedRecords = recordsSignal.value.filter(r => r.id !== id);\r\n      recordsSignal.value = updatedRecords;\r\n      await saveToStorage(updatedRecords);\r\n\r\n      // Add to sync queue\r\n      await storageService.addToSyncQueue({\r\n        operation: 'delete',\r\n        table: 'time_records',\r\n        itemId: id,\r\n      });\r\n\r\n      toast({\r\n        title: 'Exclusão offline',\r\n        description: 'O registro foi removido localmente e será excluído do servidor em breve.',\r\n      });\r\n\r\n      return { success: true, offline: true };\r\n    }\r\n  };\r\n\r\n  const bulkUpdateRecords = async (ids: string[], data: Partial<TimeRecord>) => {\r\n    try {\r\n      const updatePayload: any = {};\r\n      if (data.photoUrl === null) updatePayload.photo_url = null;\r\n      if (data.latitude === null) updatePayload.latitude = null;\r\n      if (data.longitude === null) updatePayload.longitude = null;\r\n      if (data.recordType) updatePayload.record_type = data.recordType;\r\n\r\n      const { error } = await db\r\n        .from('time_records')\r\n        .update(updatePayload)\r\n        .in('id', ids);\r\n\r\n      if (error) throw error;\r\n\r\n      const updatedRecords = recordsSignal.value.map(r => ids.includes(r.id) ? { ...r, ...data } : r);\r\n      recordsSignal.value = updatedRecords;\r\n      await saveToStorage(updatedRecords);\r\n\r\n      return { success: true };\r\n    } catch (error: any) {\r\n      console.error('Error in bulk update:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  };\r\n\r\n  const bulkDeleteRecords = async (ids: string[]) => {\r\n    try {\r\n      const { error } = await db\r\n        .from('time_records')\r\n        .delete()\r\n        .in('id', ids);\r\n\r\n      if (error) throw error;\r\n\r\n      const updatedRecords = recordsSignal.value.filter(r => !ids.includes(r.id));\r\n      recordsSignal.value = updatedRecords;\r\n      await saveToStorage(updatedRecords);\r\n\r\n      return { success: true };\r\n    } catch (error: any) {\r\n      console.error('Error in bulk delete:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  };\r\n\r\n  const getTodayRecords = () => {\r\n    const today = new Date().toDateString();\r\n    return recordsSignal.value.filter(r => new Date(r.recordedAt).toDateString() === today);\r\n  };\r\n\r\n  return {\r\n    records: recordsSignal.value,\r\n    isLoading: isLoadingRecords.value,\r\n    createRecord,\r\n    updateRecord,\r\n    bulkUpdateRecords,\r\n    bulkDeleteRecords,\r\n    deleteRecord,\r\n    getTodayRecords,\r\n    refresh: loadRecords,\r\n  };\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\useTowerTechnicalData.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":104,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":107,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[496,499],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[496,499],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[614,617],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[614,617],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1235,1238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1235,1238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2183,2186],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2183,2186],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback } from 'react';\r\nimport { orionApi } from '@/integrations/orion/client';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { cacheService } from '@/services/cacheService';\r\n\r\nexport function useTowerTechnicalData(selectedProjectId: string) {\r\n    const { profile } = useAuth();\r\n    const { toast } = useToast();\r\n\r\n    const updateTowerTechnicalProperty = useCallback(async (objectId: string, property: string, value: any) => {\r\n        if (!profile?.id || selectedProjectId === 'all') return;\r\n\r\n        try {\r\n            const data: any = {\r\n                projectId: selectedProjectId,\r\n                companyId: profile.companyId,\r\n                objectId: objectId,\r\n                [property]: value\r\n            };\r\n\r\n            const { error } = await orionApi\r\n                .from('tower_technical_data')\r\n                .upsert([data], { // Envolvendo em array conforme exigido pelo backend (route.ts:96)\r\n                    onConflict: 'project_id, object_id'\r\n                });\r\n\r\n            if (error) throw error;\r\n\r\n            await cacheService.invalidate('towerTechnicalData');\r\n            return true;\r\n        } catch (err: any) {\r\n            console.error(`Error updating tower ${property}:`, err);\r\n            toast({\r\n                title: \"Erro ao salvar dado técnico\",\r\n                description: err.message,\r\n                variant: \"destructive\"\r\n            });\r\n            return false;\r\n        }\r\n    }, [profile, selectedProjectId, toast]);\r\n\r\n    const wipeAllProjectData = useCallback(async () => {\r\n        if (!selectedProjectId || selectedProjectId === 'all') return;\r\n\r\n        try {\r\n            const { error } = await orionApi\r\n                .from('tower_technical_data')\r\n                .delete()\r\n                .eq('projectId', selectedProjectId);\r\n\r\n            if (error) throw error;\r\n\r\n            await cacheService.invalidate('towerTechnicalData');\r\n            toast({ title: \"Dados removidos\", description: \"Todos os dados técnicos das torres deste projeto foram excluídos.\" });\r\n            return true;\r\n        } catch (err: any) {\r\n            console.error('Error wiping data:', err);\r\n            toast({ title: \"Erro ao remover dados\", description: err.message, variant: \"destructive\" });\r\n            return false;\r\n        }\r\n    }, [selectedProjectId, toast]);\r\n\r\n    return {\r\n        updateTowerTechnicalProperty,\r\n        wipeAllProjectData\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\useUsers.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":285,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":285,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11987,11990],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11987,11990],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { db as localApi } from '@/integrations/database';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { mapDatabaseError, logError } from '@/lib/errorHandler';\r\nimport { canManageUser, UserScope } from '@/utils/permissionHelpers';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\n\r\nexport interface SystemUser {\r\n    id: string;\r\n    fullName: string;\r\n    email: string;\r\n    role: string;\r\n    registrationNumber: string | null;\r\n    companyId: string | null;\r\n    projectId: string | null;\r\n    siteId: string | null;\r\n    isBlocked: boolean;\r\n    status?: string;\r\n    createdAt: string;\r\n    isSystemAdmin?: boolean;\r\n    userRole?: {\r\n        role: string;\r\n    } | null;\r\n    image?: string | null;\r\n}\r\n\r\nexport interface UserFilters {\r\n    companyId?: string;\r\n    projectId?: string;\r\n    siteId?: string;\r\n    search?: string;\r\n    onlyCorporate?: boolean;\r\n    excludeCorporate?: boolean;\r\n}\r\n\r\nexport function useUsers(filters?: UserFilters) {\r\n    const [users, setUsers] = useState<SystemUser[]>([]);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const { toast } = useToast();\r\n    const { profile: currentProfile } = useAuth();\r\n\r\n    const companyIdFilter = filters?.companyId;\r\n    const projectIdFilter = filters?.projectId;\r\n    const siteIdFilter = filters?.siteId;\r\n    const searchFilter = filters?.search;\r\n    const onlyCorporateFilter = filters?.onlyCorporate;\r\n    const excludeCorporateFilter = filters?.excludeCorporate;\r\n\r\n    const loadUsers = useCallback(async () => {\r\n        if (!currentProfile) return;\r\n\r\n        setIsLoading(true);\r\n        try {\r\n            // Fetch profiles from Local API with a higher limit for management view\r\n            let query = localApi\r\n                .from('users')\r\n                .select('id, name, email, role, image, registrationNumber, createdAt, companyId, projectId, siteId, status, isSystemAdmin, hierarchyLevel, userRole(role)');\r\n\r\n            // IMPORTANT: Search must be sent to API for global search in backend\r\n            if (searchFilter && searchFilter.trim().length > 0) {\r\n                query = query.eq('search', searchFilter.trim());\r\n            }\r\n            if (companyIdFilter) query = query.eq('companyId', companyIdFilter);\r\n            if (projectIdFilter) query = query.eq('projectId', projectIdFilter);\r\n            if (siteIdFilter) query = query.eq('siteId', siteIdFilter);\r\n            if (onlyCorporateFilter) query = query.eq('onlyCorporate', true);\r\n            if (excludeCorporateFilter) query = query.eq('excludeCorporate', true);\r\n\r\n            const { data, error } = await query;\r\n\r\n            if (error) throw error;\r\n\r\n            const mapped = (data || []).map((p) => {\r\n                const name = (p.name as string) || (p.fullName as string) || (p.email as string)?.split('@')[0] || 'Usuário';\r\n                return {\r\n                    id: p.id,\r\n                    fullName: name,\r\n                    email: p.email || '',\r\n                    registrationNumber: p.registrationNumber,\r\n                    createdAt: p.createdAt,\r\n                    role: (p.role || 'WORKER').toUpperCase(),\r\n                    companyId: p.companyId,\r\n                    projectId: p.projectId,\r\n                    siteId: p.siteId,\r\n                    isBlocked: (p.status || p.isBlocked) === 'SUSPENDED' || (p.status || p.isBlocked) === 'INACTIVE' || p.isBlocked === true,\r\n                    status: p.status,\r\n                    isSystemAdmin: p.isSystemAdmin || false,\r\n                    hierarchyLevel: p.hierarchyLevel,\r\n                    userRole: p.userRole,\r\n                    image: p.image\r\n                };\r\n            });\r\n\r\n            setUsers(mapped as SystemUser[]);\r\n        } catch (error: unknown) {\r\n            logError('Users Load', error);\r\n            const userMessage = mapDatabaseError(error);\r\n            toast({\r\n                title: 'Erro ao carregar usuários',\r\n                description: userMessage,\r\n                variant: 'destructive',\r\n            });\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }, [toast, currentProfile, companyIdFilter, projectIdFilter, siteIdFilter, searchFilter, onlyCorporateFilter, excludeCorporateFilter]);\r\n\r\n    useEffect(() => {\r\n        if (currentProfile) {\r\n            loadUsers();\r\n        }\r\n    }, [currentProfile, loadUsers]);\r\n\r\n    const createUser = async (email: string, password: string, name: string, role: string, companyId?: string, projectId?: string, siteId?: string, registrationNumber?: string, image?: string) => {\r\n        try {\r\n            if (password.length < 6) {\r\n                throw new Error('A senha deve ter pelo menos 6 caracteres.');\r\n            }\r\n\r\n            const cleanEmail = email.trim().toLowerCase();\r\n            const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n\r\n            if (!emailRegex.test(cleanEmail)) {\r\n                throw new Error('O formato do e-mail parece inválido.');\r\n            }\r\n\r\n            // Usar endpoint de cadastro do backend local\r\n            const { data, error } = await localApi.auth.signUp({\r\n                email: cleanEmail,\r\n                password: password,\r\n                options: {\r\n                    data: {\r\n                        name,\r\n                        role: role.toUpperCase(),\r\n                        companyId: companyId || null,\r\n                        projectId: projectId || null,\r\n                        siteId: siteId || null,\r\n                        registrationNumber: registrationNumber || null,\r\n                        image: image || null\r\n                    }\r\n                }\r\n            });\r\n\r\n            if (error) throw error;\r\n\r\n            if (data?.user) {\r\n                toast({ title: 'Usuário criado', description: 'A nova conta foi cadastrada com sucesso.' });\r\n                loadUsers();\r\n                return { success: true, userId: data.user.id };\r\n            }\r\n            return { success: false, error: 'Erro desconhecido na criação' };\r\n\r\n        } catch (error: unknown) {\r\n            logError('User Create', error);\r\n            const message = error instanceof Error ? error.message : 'Erro desconhecido';\r\n            return { success: false, error: message };\r\n        }\r\n    };\r\n\r\n    const updateUser = async (\r\n        userId: string,\r\n        updates: {\r\n            fullName?: string;\r\n            email?: string;\r\n            role?: string;\r\n            registrationNumber?: string | null;\r\n            companyId?: string | null;\r\n            projectId?: string | null;\r\n            siteId?: string | null;\r\n            isBlocked?: boolean;\r\n            status?: string;\r\n            image?: string | null;\r\n        },\r\n        targetUserOverride?: SystemUser | null\r\n    ) => {\r\n        const isSelfUpdate = currentProfile?.id === userId;\r\n        const targetUserFromList = users.find(u => u.id === userId);\r\n        const targetUser = targetUserOverride || targetUserFromList || (isSelfUpdate ? currentProfile : null);\r\n\r\n        if (!currentProfile || !targetUser) {\r\n            return { success: false, error: 'Usuário não encontrado.' };\r\n        }\r\n\r\n        if (!isSelfUpdate && !canManageUser(currentProfile as UserScope, targetUser as UserScope)) {\r\n            return { success: false, error: 'Você não tem permissão para editar este usuário.' };\r\n        }\r\n\r\n        try {\r\n            const profileUpdates: Record<string, unknown> = { id: userId };\r\n            if (updates.fullName !== undefined) profileUpdates.name = updates.fullName;\r\n            if (updates.email !== undefined) profileUpdates.email = updates.email;\r\n            if (updates.role !== undefined) profileUpdates.role = updates.role.toUpperCase();\r\n            if (updates.companyId !== undefined) profileUpdates.companyId = updates.companyId;\r\n            if (updates.projectId !== undefined) profileUpdates.projectId = updates.projectId;\r\n            if (updates.siteId !== undefined) profileUpdates.siteId = updates.siteId;\r\n            if (updates.registrationNumber !== undefined) profileUpdates.registrationNumber = updates.registrationNumber;\r\n            if (updates.isBlocked !== undefined) {\r\n                profileUpdates.status = updates.isBlocked ? 'SUSPENDED' : 'ACTIVE';\r\n            }\r\n            if (updates.status !== undefined) profileUpdates.status = updates.status;\r\n            if (updates.image !== undefined) profileUpdates.image = updates.image;\r\n\r\n            const { error } = await localApi\r\n                .from('users')\r\n                .update(profileUpdates)\r\n                .eq('id', userId);\r\n\r\n            if (error) throw error;\r\n\r\n            toast({ title: 'Usuário atualizado', description: 'Os dados foram salvos com sucesso.' });\r\n            await loadUsers();\r\n            return { success: true };\r\n        } catch (error: unknown) {\r\n            logError('Update User', error);\r\n            const err = error instanceof Error ? error : new Error(String(error));\r\n            return { success: false, error: mapDatabaseError(err) };\r\n        }\r\n    };\r\n\r\n    const deleteUser = async (userId: string) => {\r\n        const targetUser = users.find(u => u.id === userId);\r\n        if (!currentProfile || !targetUser || !canManageUser(currentProfile, targetUser)) {\r\n            return { success: false, error: 'Você não tem permissão para excluir este usuário.' };\r\n        }\r\n        try {\r\n            // Em modo local, o delete do QueryBuilder já remove corretamente\r\n            const { error } = await localApi.from('users').delete().eq('id', userId);\r\n            if (error) throw error;\r\n\r\n            setUsers(prev => prev.filter(u => u.id !== userId));\r\n            toast({ title: 'Usuário excluído', description: 'A conta foi removida permanentemente.' });\r\n            return { success: true };\r\n        } catch (error: unknown) {\r\n            logError('User Delete', error);\r\n            return { success: false, error: mapDatabaseError(error) };\r\n        }\r\n    };\r\n\r\n    const adminChangePassword = async (userId: string, newPassword: string) => {\r\n        try {\r\n            const { error } = await localApi.from('users').update({\r\n                id: userId,\r\n                password: newPassword\r\n            }).eq('id', userId);\r\n\r\n            if (error) throw error;\r\n\r\n            toast({ title: 'Senha alterada', description: 'A senha do usuário foi atualizada com sucesso.' });\r\n            return { success: true };\r\n        } catch (error: unknown) {\r\n            logError('Admin Change Password', error);\r\n            const message = error instanceof Error ? error.message : 'Erro ao alterar senha';\r\n            return { success: false, error: message };\r\n        }\r\n    };\r\n\r\n    const adminToggleBlock = async (userId: string, isBlocked: boolean) => {\r\n        try {\r\n            const { error } = await localApi.from('users').update({\r\n                id: userId,\r\n                status: isBlocked ? 'SUSPENDED' : 'ACTIVE'\r\n            }).eq('id', userId);\r\n\r\n            if (error) throw error;\r\n\r\n            toast({\r\n                title: isBlocked ? 'Usuário bloqueado' : 'Usuário desbloqueado',\r\n                description: isBlocked ? 'O usuário não poderá mais acessar o sistema.' : 'O acesso do usuário foi restaurado.'\r\n            });\r\n\r\n            await loadUsers();\r\n            return { success: true };\r\n        } catch (error: unknown) {\r\n            logError('Admin Toggle Block', error);\r\n            const message = error instanceof Error ? error.message : 'Erro ao mudar status';\r\n            return { success: false, error: message };\r\n        }\r\n    };\r\n\r\n    const resetUserPassword = async (email: string) => {\r\n        try {\r\n            const { error } = await localApi.auth.resetPasswordForEmail(email);\r\n            if (error) throw error;\r\n            return { success: true };\r\n        } catch (error: any) {\r\n            logError('Password Reset', error);\r\n            return { success: false, error: mapDatabaseError(error) };\r\n        }\r\n    };\r\n\r\n    return {\r\n        users,\r\n        isLoading,\r\n        updateUser,\r\n        createUser,\r\n        deleteUser,\r\n        adminChangePassword,\r\n        adminToggleBlock,\r\n        resetUserPassword,\r\n        refresh: loadUsers,\r\n    };\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\hooks\\useWorkStages.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1353,1356],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1353,1356],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1419,1422],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1419,1422],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2309,2312],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2309,2312],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":96,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3364,3367],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3364,3367],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3543,3546],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3543,3546],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":113,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4161,4164],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4161,4164],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":126,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4685,4688],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4685,4688],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":145,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5465,5468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5465,5468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":157,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6001,6004],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6001,6004],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":173,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6617,6620],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6617,6620],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":186,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7150,7153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7150,7153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { orionApi } from '@/integrations/orion/client';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\n\r\nexport interface WorkStage {\r\n    id: string;\r\n    siteId: string;\r\n    parentId: string | null;\r\n    name: string;\r\n    description: string | null;\r\n    weight: number;\r\n    displayOrder: number;\r\n    createdAt: Date;\r\n    progress?: {\r\n        actualPercentage: number;\r\n        plannedPercentage: number;\r\n    };\r\n    productionActivityId?: string | null;\r\n}\r\n\r\nexport interface CreateStageData {\r\n    name: string;\r\n    description?: string;\r\n    weight?: number;\r\n    parentId?: string;\r\n    productionActivityId?: string | null;\r\n}\r\n\r\nexport function useWorkStages(siteId?: string) {\r\n    const [stages, setStages] = useState<WorkStage[]>([]);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const { toast } = useToast();\r\n    const { profile } = useAuth();\r\n\r\n    const loadStages = useCallback(async () => {\r\n        if (!siteId || siteId === 'all') {\r\n            setStages([]);\r\n            setIsLoading(false);\r\n            return;\r\n        }\r\n        setIsLoading(true);\r\n        try {\r\n            const response = await orionApi.get(`/work-stages?siteId=${siteId}`);\r\n            const data = (response.data as any) || [];\r\n            const mapped: WorkStage[] = data.map((s: any) => {\r\n                const latestProgress = s.progress?.[0] || { actualPercentage: 0, plannedPercentage: 0 };\r\n                return {\r\n                    id: s.id,\r\n                    siteId: s.siteId,\r\n                    parentId: s.parentId,\r\n                    name: s.name,\r\n                    description: s.description,\r\n                    weight: Number(s.weight),\r\n                    displayOrder: s.displayOrder,\r\n                    createdAt: new Date(s.createdAt),\r\n                    progress: {\r\n                        actualPercentage: Number(latestProgress.actualPercentage || 0),\r\n                        plannedPercentage: Number(latestProgress.plannedPercentage || 0)\r\n                    },\r\n                    productionActivityId: s.productionActivityId\r\n                };\r\n            });\r\n\r\n            setStages(mapped);\r\n        } catch (error: any) {\r\n            console.error('Erro ao carregar etapas de obra:', error);\r\n            setStages([]);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }, [siteId]);\r\n\r\n    useEffect(() => {\r\n        loadStages();\r\n    }, [loadStages]);\r\n\r\n    const createStage = async (data: CreateStageData, silent = false) => {\r\n        try {\r\n            const response = await orionApi.post('/work-stages', {\r\n                siteId,\r\n                name: data.name,\r\n                description: data.description || null,\r\n                weight: data.weight || 1.0,\r\n                parentId: data.parentId || null,\r\n                displayOrder: stages.length,\r\n                productionActivityId: data.productionActivityId || null\r\n            });\r\n\r\n            if (!silent) {\r\n                toast({ title: \"Etapa criada\", description: `A etapa \"${data.name}\" foi criada com sucesso.` });\r\n                loadStages();\r\n            }\r\n\r\n            // Retorna o ID da etapa criada\r\n            const createdId = (response.data as any)?.id;\r\n            console.log('[CriarEtapa] Etapa criada:', data.name, 'ID:', createdId);\r\n            return { success: true, stageId: createdId };\r\n        } catch (error: any) {\r\n            console.error('[createStage] Error:', error);\r\n            toast({ title: \"Erro ao criar etapa\", description: error.message, variant: \"destructive\" });\r\n            return { success: false, error: error.message };\r\n        }\r\n    };\r\n\r\n    const updateStage = async (stageId: string, data: Partial<CreateStageData>) => {\r\n        try {\r\n            await orionApi.put(`/work-stages/${stageId}`, data);\r\n\r\n            toast({ title: \"Etapa atualizada\", description: \"A etapa foi atualizada com sucesso.\" });\r\n            loadStages();\r\n            return { success: true };\r\n        } catch (error: any) {\r\n            toast({ title: \"Erro ao atualizar etapa\", description: error.message, variant: \"destructive\" });\r\n            return { success: false, error: error.message };\r\n        }\r\n    };\r\n\r\n    const deleteStage = async (stageId: string) => {\r\n        try {\r\n            await orionApi.delete(`/work-stages/${stageId}`);\r\n\r\n            toast({ title: \"Etapa removida\", description: \"A etapa foi removida com sucesso.\" });\r\n            loadStages();\r\n            return { success: true };\r\n        } catch (error: any) {\r\n            toast({ title: \"Erro ao remover etapa\", description: error.message, variant: \"destructive\" });\r\n            return { success: false, error: error.message };\r\n        }\r\n    };\r\n\r\n    const updateProgress = async (stageId: string, actual: number, planned: number, notes?: string) => {\r\n        try {\r\n            await orionApi.post('/stage-progress', {\r\n                stageId,\r\n                actualPercentage: actual,\r\n                plannedPercentage: planned,\r\n                notes,\r\n                updatedById: profile?.id\r\n            });\r\n\r\n            toast({ title: \"Avanço registrado\", description: \"O progresso da etapa foi atualizado com sucesso.\" });\r\n            loadStages();\r\n            return { success: true };\r\n        } catch (error: any) {\r\n            toast({ title: \"Erro ao registrar avanço\", description: error.message, variant: \"destructive\" });\r\n            return { success: false, error: error.message };\r\n        }\r\n    };\r\n\r\n    const deleteAllStages = async () => {\r\n        try {\r\n            await orionApi.delete(`/work-stages/bulk?siteId=${siteId}`);\r\n            toast({ title: \"Etapas removidas\", description: \"Todas as etapas foram removidas com sucesso.\" });\r\n            loadStages();\r\n            return { success: true };\r\n        } catch (error: any) {\r\n            toast({ title: \"Erro ao remover etapas\", description: error.message, variant: \"destructive\" });\r\n            return { success: false, error: error.message };\r\n        }\r\n    };\r\n\r\n    const reorderStages = async (reorderedStages: WorkStage[]) => {\r\n        try {\r\n            const updates = reorderedStages.map((stage, index) => ({\r\n                id: stage.id,\r\n                displayOrder: index\r\n            }));\r\n\r\n            await orionApi.put('/work-stages/reorder', { updates });\r\n            setStages(reorderedStages);\r\n            return { success: true };\r\n        } catch (error: any) {\r\n            toast({ title: \"Erro ao reordenar\", description: error.message, variant: \"destructive\" });\r\n            loadStages(); // Revert to server state\r\n            return { success: false, error: error.message };\r\n        }\r\n    };\r\n\r\n    const syncStages = async () => {\r\n        if (!siteId || siteId === 'all') return { success: false };\r\n        try {\r\n            await orionApi.post('/work-stages/sync', { siteId });\r\n            await loadStages();\r\n            return { success: true };\r\n        } catch (error: any) {\r\n            console.error('[SincronizarEtapas] Erro:', error);\r\n            return { success: false, error: error.message };\r\n        }\r\n    };\r\n\r\n    return {\r\n        stages,\r\n        isLoading,\r\n        createStage,\r\n        updateStage,\r\n        deleteStage,\r\n        deleteAllStages,\r\n        reorderStages,\r\n        updateProgress,\r\n        syncStages, // New method\r\n        refresh: loadStages\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\integrations\\database\\index.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[313,316],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[313,316],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Unified Database Client\r\n * \r\n * Exporta o cliente local ORION (Next.js 14+ / Prisma).\r\n * A integração com db foi removida.\r\n * \r\n * Uso: import { db } from '@/integrations/database';\r\n */\r\n\r\nimport { orionApi } from '../orion/client';\r\n\r\n// Força o uso do Orion API local\r\nexport const db = orionApi as any;\r\n\r\n// Exporta o modo atual como sempre local para compatibilidade\r\nexport const isLocalMode = true;\r\n\r\n// Re-exporta o cliente principal\r\nexport { orionApi };\r\n\r\n// Tipo para compatibilidade\r\nexport type DatabaseClient = typeof orionApi;\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\integrations\\orion\\client.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[534,537],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[534,537],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[883,886],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[883,886],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[942,945],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[942,945],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1000,1003],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1000,1003],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1059,1062],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1059,1062],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1603,1606],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1603,1606],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1681,1684],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1681,1684],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":91,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":91,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3996,3999],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3996,3999],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":122,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4703,4706],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4703,4706],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":164,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6578,6581],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6578,6581],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":199,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8193,8196],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8193,8196],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":246,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":246,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10106,10109],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10106,10109],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":259,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":259,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10584,10587],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10584,10587],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":263,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":263,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10700,10703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10700,10703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":267,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":267,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10817,10820],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10817,10820],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":275,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11060,11063],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11060,11063],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":329,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":329,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13543,13546],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13543,13546],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":330,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":330,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13622,13625],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13622,13625],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'selectedColumns' is assigned a value but never used.","line":331,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":331,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":371,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":371,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15469,15472],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15469,15472],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":499,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":499,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21083,21086],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21083,21086],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":499,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":499,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21134,21137],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21134,21137],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":501,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":501,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21285,21288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21285,21288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":518,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":518,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21987,21990],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21987,21990],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":554,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":554,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23321,23324],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23321,23324],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":555,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":555,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23388,23391],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23388,23391],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":571,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":571,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24005,24008],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24005,24008],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":576,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":576,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24268,24271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24268,24271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":603,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":603,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25766,25769],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25766,25769],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":623,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":623,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26467,26470],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26467,26470],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":628,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":628,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26777,26780],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26777,26780],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":629,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":629,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26834,26837],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26834,26837],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'expiresIn' is defined but never used.","line":658,"column":51,"nodeType":null,"messageId":"unusedVar","endLine":658,"endColumn":60},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'paths' is defined but never used.","line":663,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":663,"endColumn":33}],"suppressedMessages":[],"errorCount":35,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * ORION API Client\r\n * \r\n * Cliente HTTP para comunicação com o backend local ORION (Next.js 14+ App Router).\r\n * Implementa interface compatível com o db JS SDK para facilitar a migração.\r\n */\r\n\r\nconst API_URL = import.meta.env.VITE_API_URL || '/api/v1';\r\nconst DB_MODE = import.meta.env.VITE_DB_MODE || 'orion_db';\r\n\r\nexport const isLocalMode = DB_MODE === 'local';\r\n\r\ninterface ApiResponse<T> {\r\n    data: T | null;\r\n    error: { message: string; code?: string } | null;\r\n    count?: number;\r\n}\r\n\r\ninterface QueryBuilder<T = any> {\r\n    select: (columns?: string) => QueryBuilder<T>;\r\n    insert: (data: Partial<T> | Partial<T>[]) => QueryBuilder<T>;\r\n    update: (data: Partial<T>) => QueryBuilder<T>;\r\n    upsert: (data: Partial<T> | Partial<T>[], options?: { onConflict?: string }) => QueryBuilder<T>;\r\n    delete: () => QueryBuilder<T>;\r\n    eq: (column: string, value: any) => QueryBuilder<T>;\r\n    neq: (column: string, value: any) => QueryBuilder<T>;\r\n    is: (column: string, value: any) => QueryBuilder<T>;\r\n    in: (column: string, values: any[]) => QueryBuilder<T>;\r\n    order: (column: string, options?: { ascending?: boolean }) => QueryBuilder<T>;\r\n    limit: (count: number) => QueryBuilder<T>;\r\n    single: () => Promise<ApiResponse<T>>;\r\n    maybeSingle: () => Promise<ApiResponse<T | null>>;\r\n    then: (resolve: (value: ApiResponse<T[]>) => void) => Promise<void>;\r\n}\r\n\r\nimport { signal, effect } from \"@preact/signals-react\";\r\n\r\nexport class OrionApiClient {\r\n    public baseUrl: string;\r\n    public tokenSignal = signal<string | null>(null);\r\n    public userSignal = signal<any | null>(null);\r\n    private authListeners: Array<(event: string, session: any) => void> = [];\r\n\r\n    constructor(baseUrl: string) {\r\n        // Remover trailing slash da baseUrl para evitar double slashes\r\n        this.baseUrl = baseUrl.endsWith('/') ? baseUrl.slice(0, -1) : baseUrl;\r\n\r\n        // Recuperar token do localStorage se existir\r\n        this.loadToken();\r\n\r\n        // Sincronizar tokenSignal com a propriedade legada token (para compatibilidade interna temporária)\r\n        effect(() => {\r\n            const currentToken = this.tokenSignal.value;\r\n            if (currentToken) {\r\n                localStorage.setItem('orion_token', currentToken);\r\n                localStorage.setItem('token', currentToken);\r\n            } else {\r\n                localStorage.removeItem('orion_token');\r\n                localStorage.removeItem('token');\r\n            }\r\n        });\r\n    }\r\n\r\n    // Getter para compatibilidade com código que usa .token\r\n    get token(): string | null {\r\n        return this.tokenSignal.value;\r\n    }\r\n\r\n    set token(value: string | null) {\r\n        this.tokenSignal.value = value;\r\n    }\r\n\r\n    private loadToken() {\r\n        const storedToken = localStorage.getItem('token') ||\r\n            localStorage.getItem('orion_token') ||\r\n            localStorage.getItem('next-auth.session-token') ||\r\n            localStorage.getItem('db.auth.token'); // Compatibilidade extrema\r\n\r\n        let finalToken = (storedToken && storedToken !== 'undefined' && storedToken !== 'null') ? storedToken : null;\r\n\r\n        // SE o token parece um JSON (vindo do db), extraímos apenas o access_token\r\n        if (finalToken && (finalToken.trim().startsWith('{') || finalToken.trim().startsWith('['))) {\r\n            try {\r\n                const parsed = JSON.parse(finalToken);\r\n                if (parsed.access_token) {\r\n                    finalToken = parsed.access_token;\r\n                    console.log('[ORION CLIENT] Access token extracted from db JSON');\r\n                } else if (parsed.currentSession?.access_token) {\r\n                    finalToken = parsed.currentSession.access_token;\r\n                }\r\n            } catch (e) {\r\n                // Se falhar o parse, mantém o original (pode ser um token JWT puro)\r\n            }\r\n        }\r\n\r\n        this.tokenSignal.value = finalToken;\r\n    }\r\n\r\n    private notifyAuthChange(event: string, session: any) {\r\n        this.authListeners.forEach(listener => listener(event, session));\r\n    }\r\n\r\n    setToken(token: string) {\r\n        this.tokenSignal.value = token;\r\n\r\n        this.auth.getSession().then(res => {\r\n            const user = res.data?.session?.user || null;\r\n            this.userSignal.value = user;\r\n            this.notifyAuthChange('SIGNED_IN', res.data?.session);\r\n        });\r\n    }\r\n\r\n    clearToken() {\r\n        this.tokenSignal.value = null;\r\n        this.userSignal.value = null;\r\n        this.notifyAuthChange('SIGNED_OUT', null);\r\n    }\r\n\r\n    private async request<T>(\r\n        endpoint: string,\r\n        method: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE' = 'GET',\r\n        body?: any,\r\n        params?: Record<string, string>\r\n    ): Promise<ApiResponse<T>> {\r\n        try {\r\n            // Construir URL final\r\n            // Se a URL do endpoint começar com /, removemos para evitar double slash se a baseUrl terminar com /\r\n            const cleanEndpoint = endpoint.startsWith('/') ? endpoint.slice(1) : endpoint;\r\n            const cleanBaseUrl = this.baseUrl.endsWith('/') ? this.baseUrl : `${this.baseUrl}/`;\r\n\r\n            const fullUrl = this.baseUrl.startsWith('http')\r\n                ? `${cleanBaseUrl}${cleanEndpoint}`\r\n                : `${window.location.origin}${cleanBaseUrl}${cleanEndpoint}`;\r\n\r\n            const url = new URL(fullUrl);\r\n            if (params) {\r\n                Object.entries(params).forEach(([key, value]) => {\r\n                    url.searchParams.append(key, value);\r\n                });\r\n            }\r\n\r\n            const headers: Record<string, string> = {\r\n                'Content-Type': 'application/json',\r\n                'Cache-Control': 'no-cache, no-store, must-revalidate',\r\n                'Pragma': 'no-cache',\r\n                'Expires': '0'\r\n            };\r\n\r\n            if (this.token) {\r\n                headers['Authorization'] = `Bearer ${this.token}`;\r\n            }\r\n\r\n            const options: RequestInit = {\r\n                method,\r\n                headers,\r\n                cache: 'no-store' as RequestCache,\r\n                credentials: 'include', // Ensure cookies are sent for session-based auth\r\n            };\r\n\r\n            if (method !== 'GET' && body) {\r\n                // Mapeamento automático de snake_case para camelCase para o body\r\n                // Isso garante compatibilidade com o Backend ORION sem mudar todo o frontend\r\n                if (typeof body === 'object' && !Array.isArray(body) && !(body instanceof FormData)) {\r\n                    const mappedBody: any = { ...body };\r\n                    const mappings: Record<string, string> = {\r\n                        'employee_id': 'userId',\r\n                        'user_id': 'userId',\r\n                        'project_id': 'projectId',\r\n                        'company_id': 'companyId',\r\n                        'team_id': 'teamId',\r\n                        'record_type': 'recordType',\r\n                        'recorded_at': 'recordedAt',\r\n                        'photo_url': 'photoUrl',\r\n                        'local_id': 'localId',\r\n                        'created_by': 'createdById',\r\n                        'is_active': 'isActive',\r\n                        'display_order': 'displayOrder'\r\n                    };\r\n\r\n                    Object.entries(mappings).forEach(([snake, camel]) => {\r\n                        if (mappedBody[snake] !== undefined) {\r\n                            mappedBody[camel] = mappedBody[snake];\r\n                            // Opcionalmente remove o antigo se preferir, mas manter ambos é mais seguro\r\n                        }\r\n                    });\r\n                    options.body = JSON.stringify(mappedBody);\r\n                } else {\r\n                    options.body = body instanceof FormData ? body : JSON.stringify(body);\r\n                }\r\n            }\r\n\r\n            const response = await fetch(url.toString(), options);\r\n\r\n            // Se for DELETE e status 204 (No Content), retorna sucesso vazio\r\n            if (method === 'DELETE' && response.status === 204) {\r\n                return { data: null, error: null };\r\n            }\r\n\r\n            let json: any = {};\r\n            const contentType = response.headers.get('content-type');\r\n\r\n            if (contentType && contentType.includes('application/json')) {\r\n                try {\r\n                    json = await response.json();\r\n                } catch (err) {\r\n                    console.warn('[ORION API] Failed to parse JSON response', err);\r\n                }\r\n            } else {\r\n                return {\r\n                    data: null,\r\n                    error: {\r\n                        message: response.status === 404\r\n                            ? `Endpoint ${endpoint} não encontrado (404).`\r\n                            : `Erro ${response.status} no servidor (Resposta não-JSON).`,\r\n                        code: String(response.status)\r\n                    }\r\n                };\r\n            }\r\n\r\n            if (!response.ok) {\r\n                return {\r\n                    data: null,\r\n                    error: { message: json.message || json.error || `Erro ${response.status} no servidor ORION`, code: String(response.status) }\r\n                };\r\n            }\r\n\r\n            const data = json.data !== undefined ? json.data : json;\r\n\r\n            // Suporte para respostas paginadas do Backend ORION (que vêm em { items: [], pagination: {} })\r\n            if (data && typeof data === 'object' && !Array.isArray(data) && Array.isArray(data.items)) {\r\n                // Se for uma lista paginada, extraímos os itens e preservamos o total se disponível\r\n                const items = data.items;\r\n                const total = data.pagination?.total || items.length;\r\n                return {\r\n                    data: items,\r\n                    error: null,\r\n                    count: total\r\n                };\r\n            }\r\n\r\n            return {\r\n                data,\r\n                error: null,\r\n                count: json.count\r\n            };\r\n        } catch (err: any) {\r\n            console.error(`[ORION API] Fetch error on ${method} ${this.baseUrl}${endpoint}:`, err);\r\n            return {\r\n                data: null,\r\n                error: { message: 'Não foi possível conectar ao servidor ORION local.' }\r\n            };\r\n        }\r\n    }\r\n\r\n    async get<T>(endpoint: string, params?: Record<string, string>) {\r\n        return this.request<T>(endpoint, 'GET', undefined, params);\r\n    }\r\n\r\n    async post<T>(endpoint: string, body?: any) {\r\n        return this.request<T>(endpoint, 'POST', body);\r\n    }\r\n\r\n    async put<T>(endpoint: string, body?: any) {\r\n        return this.request<T>(endpoint, 'PUT', body);\r\n    }\r\n\r\n    async patch<T>(endpoint: string, body?: any) {\r\n        return this.request<T>(endpoint, 'PATCH', body);\r\n    }\r\n\r\n    async delete<T>(endpoint: string, params?: Record<string, string>) {\r\n        return this.request<T>(endpoint, 'DELETE', undefined, params);\r\n    }\r\n\r\n    from<T = any>(table: string): QueryBuilder<T> {\r\n        // Mapeamento automático para o padrão Prisma/ORION (Singular PascalCase)\r\n        const tableMap: Record<string, string> = {\r\n            'users': 'users',\r\n            'profiles': 'users',\r\n            'User': 'users',\r\n            'user_roles': 'user_roles',\r\n            'UserRole': 'user_roles',\r\n            'employees': 'users',\r\n            'Employee': 'users',\r\n            'teams': 'teams',\r\n            'Team': 'teams',\r\n            'projects': 'projects',\r\n            'Project': 'projects',\r\n            'sites': 'sites',\r\n            'Site': 'sites',\r\n            'companies': 'companies',\r\n            'Company': 'companies',\r\n            'job_functions': 'job_functions',\r\n            'JobFunction': 'job_functions',\r\n            'system_messages': 'system_messages',\r\n            'SystemMessage': 'system_messages',\r\n            'messages': 'system_messages',\r\n            'audit_logs': 'audit_logs',\r\n            'AuditLog': 'audit_logs',\r\n            'time_records': 'time_records',\r\n            'TimeRecord': 'time_records',\r\n            'team_members': 'team_members',\r\n            'TeamMember': 'team_members',\r\n            'permission_levels': 'permission_levels',\r\n            'PermissionLevel': 'permission_levels',\r\n            'permission_modules': 'permission_modules',\r\n            'PermissionModule': 'permission_modules',\r\n            'permission_matrix': 'permission_matrix',\r\n            'PermissionMatrix': 'permission_matrix',\r\n            'permission_overrides': 'permission_overrides',\r\n            'PermissionOverride': 'permission_overrides',\r\n            'ticket_history': 'ticket_history',\r\n            'TicketHistory': 'ticket_history',\r\n            'temporary_permissions': 'temporary_permissions',\r\n            'TemporaryPermission': 'temporary_permissions',\r\n            'segments': 'segments',\r\n            'circuits': 'circuits',\r\n            'conductors': 'conductors',\r\n            'segment_circuits': 'segment_circuits',\r\n            'tower_technical_data': 'map_elements',\r\n            'span_technical_data': 'map_elements',\r\n            'map_element_technical_data': 'map_elements',\r\n            'Project3dCableSettings': 'project_3d_cable_settings',\r\n            'project_3d_cable_settings': 'project_3d_cable_settings'\r\n        };\r\n        const activeTable = tableMap[table] || table;\r\n\r\n        let method: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE' = 'GET';\r\n        let body: any = null;\r\n        const filters: Array<{ column: string; op: string; value: any }> = [];\r\n        let selectedColumns = '*';\r\n        let orderBy: { column: string; ascending: boolean } | null = null;\r\n        let limitCount: number | null = null;\r\n\r\n        const getIdFromFilters = () => {\r\n            const idFilter = filters.find(f => f.column === 'id' && f.op === 'eq');\r\n            return idFilter ? idFilter.value : null;\r\n        };\r\n\r\n        const buildQueryParams = (): Record<string, string> => {\r\n            const p: Record<string, string> = {};\r\n            // Adicionar filtros ao query params\r\n            filters.forEach((f) => {\r\n                // Mapeamento de snake_case para camelCase para compatibilidade com os esquemas Zod do backend Orion\r\n                let key = f.column;\r\n                if (key === 'project_id') key = 'projectId';\r\n                if (key === 'company_id') key = 'companyId';\r\n                if (key === 'team_id') key = 'teamId';\r\n                if (key === 'user_id') key = 'userId';\r\n                if (key === 'employee_id') key = 'userId';\r\n                if (key === 'tower_type') key = 'towerType';\r\n\r\n                // Se o ID não foi usado no path, incluímos na query\r\n                const currentId = getIdFromFilters();\r\n                const tablesWithPathId = ['users', 'profiles', 'projects', 'teams', 'sites', 'companies'];\r\n                const usesPathId = currentId && method !== 'POST' && tablesWithPathId.includes(activeTable);\r\n\r\n                if (f.column !== 'id' || f.op !== 'eq' || !usesPathId) {\r\n                    p[key] = String(f.value);\r\n                }\r\n            });\r\n\r\n            // Enviar limit para o backend se estiver definido\r\n            if (limitCount) {\r\n                p['limit'] = String(limitCount);\r\n            }\r\n\r\n            return p;\r\n        };\r\n\r\n        const execute = async (): Promise<ApiResponse<any>> => {\r\n            let id = getIdFromFilters();\r\n            console.log('[OrionClient] Execute table:', activeTable, 'Method:', method, 'Initial ID from filters:', id);\r\n\r\n            // Debug filters if id is missing\r\n            if (!id && (method === 'PUT' || method === 'PATCH')) {\r\n                console.log('[ORION DEBUG] PUT/PATCH missing ID from filters. Checking body...');\r\n            }\r\n\r\n            // Fallback: Se não achou ID nos filtros (eq), tentar achar no body (apenas para PUT/PATCH)\r\n            if (!id && (method === 'PUT' || method === 'PATCH') && body && typeof body === 'object' && !Array.isArray(body)) {\r\n                id = body.id || body.userId;\r\n                console.log('[OrionClient] ID found in body for update:', id);\r\n            }\r\n\r\n            // Se temos ID e é update, garantir que o ID esteja no body também\r\n            if ((method === 'PUT' || method === 'PATCH') && id && body && typeof body === 'object' && !Array.isArray(body)) {\r\n                body = { ...body, id };\r\n            }\r\n\r\n            // SÓ anexa o ID na URL se NÃO for POST e for uma tabela que suporta [id]\r\n            const tablesWithPathId = ['users', 'profiles', 'projects', 'teams', 'sites', 'companies'];\r\n            const usePathId = id && method !== 'POST' && tablesWithPathId.includes(activeTable);\r\n\r\n            const endpoint = usePathId ? `/${activeTable}/${id}` : `/${activeTable}`;\r\n            console.log('[OrionClient] Final Endpoint:', endpoint);\r\n\r\n            if (method === 'PATCH' && !id) {\r\n                console.warn('[ORION API] Global updates without ID might not be supported');\r\n            }\r\n\r\n            const result = await this.request(endpoint, method, body, (method === 'GET' || method === 'DELETE') ? buildQueryParams() : undefined);\r\n\r\n            // Aplicar ordenação localmente se necessário\r\n            if (result.data && Array.isArray(result.data) && orderBy) {\r\n                result.data.sort((a, b) => {\r\n                    const aVal = a[orderBy.column];\r\n                    const bVal = b[orderBy.column];\r\n                    const comparison = aVal < bVal ? -1 : aVal > bVal ? 1 : 0;\r\n                    return orderBy.ascending ? comparison : -comparison;\r\n                });\r\n            }\r\n\r\n            // Aplicar limit localmente se necessário\r\n            if (result.data && Array.isArray(result.data) && limitCount) {\r\n                result.data = result.data.slice(0, limitCount);\r\n            }\r\n\r\n            return result;\r\n        };\r\n\r\n        const builder: QueryBuilder<T> = {\r\n            select: (columns = '*') => {\r\n                selectedColumns = columns;\r\n                return builder;\r\n            },\r\n            insert: (data) => {\r\n                method = 'POST';\r\n                body = data;\r\n                return builder;\r\n            },\r\n            update: (data) => {\r\n                method = 'PUT'; // ORION Backend bypass: Use PUT instead of PATCH\r\n                body = data;\r\n                return builder;\r\n            },\r\n            upsert: (data) => {\r\n                method = 'POST'; // upsert is complex, we try POST first. If backend supports upsert on POST, great.\r\n                body = data;\r\n                return builder;\r\n            },\r\n            delete: () => {\r\n                method = 'DELETE';\r\n                return builder;\r\n            },\r\n            eq: (column, value) => {\r\n                console.log(`[ORION DEBUG] Adding filter eq: ${column}=${value}`);\r\n                filters.push({ column, op: 'eq', value });\r\n                return builder;\r\n            },\r\n            neq: (column, value) => {\r\n                filters.push({ column, op: 'neq', value });\r\n                return builder;\r\n            },\r\n            is: (column, value) => {\r\n                filters.push({ column, op: 'is', value });\r\n                return builder;\r\n            },\r\n            in: (column, values) => {\r\n                filters.push({ column, op: 'in', value: values.join(',') });\r\n                return builder;\r\n            },\r\n            order: (column, options = { ascending: true }) => {\r\n                orderBy = { column, ascending: options.ascending ?? true };\r\n                return builder;\r\n            },\r\n            limit: (count) => {\r\n                limitCount = count;\r\n                return builder;\r\n            },\r\n            single: async () => {\r\n                const result = await execute();\r\n                if (result.error) return result;\r\n                const data = Array.isArray(result.data) ? result.data[0] : result.data;\r\n                if (!data) return { data: null, error: { message: 'Not found', code: '404' } };\r\n                return { data, error: null };\r\n            },\r\n            maybeSingle: async () => {\r\n                const result = await execute();\r\n                if (result.error) return result;\r\n                const data = Array.isArray(result.data) ? result.data[0] : result.data;\r\n                return { data: data || null, error: null };\r\n            },\r\n            then: async (resolve) => {\r\n                const result = await execute();\r\n                // Garantir que retorne array para chamadas .then() padrão (listas)\r\n                const arrayData = Array.isArray(result.data) ? result.data : (result.data ? [result.data] : []);\r\n                resolve({ ...result, data: arrayData });\r\n            }\r\n        };\r\n\r\n        return builder;\r\n    }\r\n\r\n\r\n    /**\r\n     * RPC compatível com Next.js Server Actions ou API Routes separadas\r\n     */\r\n    async rpc<T = any>(functionName: string, params?: Record<string, any>): Promise<ApiResponse<T>> {\r\n        // Mapeamento automático de parâmetros para padrão ORION Backend\r\n        const mappedParams: Record<string, any> = { ...params };\r\n\r\n        if (params?.p_identifier) mappedParams.identifier = params.p_identifier;\r\n        if (params?.p_matricula) mappedParams.identifier = params.p_matricula;\r\n        if (params?.p_senha) mappedParams.password = params.p_senha;\r\n\r\n        // Se for resolve_login_identifier, retornamos um mock se o backend falhar, \r\n        // mas tentamos o backend primeiro\r\n        const result = await this.request<T>(`/rpc/${functionName}`, 'POST', mappedParams);\r\n\r\n        return result;\r\n\r\n        return result;\r\n    }\r\n\r\n    auth = {\r\n        signInWithPassword: async (credentials: { email: string; password: string }) => {\r\n            const result = await this.request<{ user: any; token: string; access_token: string }>('/auth/login', 'POST', credentials);\r\n\r\n            const token = result.data?.access_token || result.data?.token;\r\n\r\n            if (token && result.data?.user) {\r\n                this.setToken(token);\r\n\r\n                const user = {\r\n                    id: result.data.user.id || result.data.user.userId,\r\n                    email: result.data.user.email || credentials.email,\r\n                    ...result.data.user\r\n                };\r\n\r\n                const session = {\r\n                    access_token: token,\r\n                    token_type: 'bearer',\r\n                    expires_in: 3600,\r\n                    refresh_token: 'local-mock-refresh',\r\n                    user: user\r\n                };\r\n\r\n                return {\r\n                    data: { user, session },\r\n                    error: null\r\n                };\r\n            }\r\n\r\n            return {\r\n                data: { user: null, session: null },\r\n                error: result.error\r\n            };\r\n        },\r\n        // Alias para compatibilidade ou uso interno\r\n        signIn: async (credentials: { email: string; password: string }) => {\r\n            return this.auth.signInWithPassword(credentials);\r\n        },\r\n        signUp: async (credentials: { email: string; password: string; options?: any }) => {\r\n            const result = await this.request<{ user: any }>('/auth/register', 'POST', {\r\n                email: credentials.email,\r\n                password: credentials.password,\r\n                ...credentials.options?.data\r\n            });\r\n            return {\r\n                data: { user: result.data?.user || null, session: null },\r\n                error: result.error\r\n            };\r\n        },\r\n        signOut: async () => {\r\n            this.clearToken();\r\n            return { error: null };\r\n        },\r\n        getUser: async () => {\r\n            if (!this.token) return { data: { user: null }, error: null };\r\n            const res = await this.request<any>('/auth/me', 'GET');\r\n            return { data: { user: res.data }, error: res.error };\r\n        },\r\n        getSession: async () => {\r\n            if (!this.token) return { data: { session: null }, error: null };\r\n            const res = await this.request<any>('/auth/session', 'GET'); // Endpoint padrão NextAuth session\r\n            // Formatar mock de sessão se tiver dados de usuário\r\n            const sessionData = res.data?.user || res.data;\r\n            const session = (sessionData && Object.keys(sessionData).length > 0 && (sessionData.id || sessionData.userId)) ? {\r\n                access_token: this.token,\r\n                token_type: 'bearer',\r\n                expires_in: 3600,\r\n                refresh_token: 'local-mock-refresh',\r\n                user: sessionData\r\n            } : null;\r\n            return { data: { session }, error: res.error };\r\n        },\r\n        setSession: async (session: { access_token: string; refresh_token: string }) => {\r\n            if (session.access_token) {\r\n                this.setToken(session.access_token);\r\n                // Mock de sessão para retorno\r\n                const mockSession = {\r\n                    access_token: session.access_token,\r\n                    token_type: 'bearer',\r\n                    expires_in: 3600,\r\n                    refresh_token: session.refresh_token,\r\n                    user: null // Será carregado via getUser ou já presente no payload se o backend enviar\r\n                };\r\n                return { data: { session: mockSession, user: null }, error: null };\r\n            }\r\n            return { data: { session: null, user: null }, error: { message: 'Invalid session' } };\r\n        },\r\n        onAuthStateChange: (callback: (event: string, session: any) => void) => {\r\n            this.authListeners.push(callback);\r\n\r\n            // Inicializar com estado atual\r\n            this.auth.getSession().then(res => {\r\n                if (res.data?.session) {\r\n                    callback('INITIAL_SESSION', res.data.session);\r\n                }\r\n            });\r\n\r\n            return {\r\n                data: {\r\n                    subscription: {\r\n                        unsubscribe: () => {\r\n                            this.authListeners = this.authListeners.filter(l => l !== callback);\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n        },\r\n        resetPasswordForEmail: async (email: string, options?: any) => {\r\n            console.warn('[ORION API] resetPasswordForEmail fallback in local backend');\r\n            const result = await this.request('/auth/reset-password', 'POST', { email, ...options });\r\n            return { data: {}, error: result.error };\r\n        },\r\n        updateUser: async (attributes: any) => {\r\n            const result = await this.request<any>('/auth/update', 'PUT', attributes);\r\n            return { data: { user: result.data }, error: result.error };\r\n        }\r\n    };\r\n\r\n    storage = {\r\n        from: (bucket: string) => ({\r\n            getPublicUrl: (path: string) => {\r\n                // A URL pública agora aponta para o endpoint da API especificado pelo bucket\r\n                const endpoint = bucket === 'photos' ? 'photos' : 'documents';\r\n                return { data: { publicUrl: `${this.baseUrl}/storage/${endpoint}?path=${path}` } };\r\n            },\r\n            upload: async (path: string, file: File) => {\r\n                const endpoint = bucket === 'photos' ? 'photos' : 'documents';\r\n                const formData = new FormData();\r\n                formData.append('file', file);\r\n                formData.append('path', path); // Passamos o path sugerido como metadado se necessário\r\n                return this.request(`/storage/${endpoint}`, 'POST', formData);\r\n            },\r\n            download: async (path: string) => {\r\n                const endpoint = bucket === 'photos' ? 'photos' : 'documents';\r\n                const url = `${this.baseUrl}/storage/${endpoint}?path=${path}`;\r\n                const response = await fetch(url, {\r\n                    headers: this.token ? { 'Authorization': `Bearer ${this.token}` } : {}\r\n                });\r\n                if (!response.ok) throw new Error('Download failed');\r\n                const blob = await response.blob();\r\n                return { data: blob, error: null };\r\n            },\r\n            createSignedUrl: async (path: string, expiresIn: number) => {\r\n                // Simplificação: no backend local, a URL pública já serve como \"assinada\" por enquanto\r\n                const endpoint = bucket === 'photos' ? 'photos' : 'documents';\r\n                return { data: { signedUrl: `${this.baseUrl}/storage/${endpoint}?path=${path}` }, error: null };\r\n            },\r\n            remove: async (paths: string[]) => {\r\n                // TODO: Implementar DELETE no backend storage se necessário\r\n                console.warn('[ORION STORAGE] Remove not yet implemented in backend');\r\n                return { error: null };\r\n            }\r\n        })\r\n    };\r\n}\r\n\r\nexport const orionApi = new OrionApiClient(API_URL);\r\nexport const localApi = orionApi;\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\lib\\errorHandler.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[188,191],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[188,191],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2400,2403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2400,2403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Maps database/API error messages to user-friendly Portuguese messages\r\n * Prevents exposing internal database schema details to users\r\n */\r\nexport const mapDatabaseError = (error: any): string => {\r\n  const message = error?.message?.toLowerCase() || '';\r\n  \r\n  // RLS policy violations\r\n  if (message.includes('row-level security') || message.includes('permission denied') || message.includes('rls')) {\r\n    return 'Você não tem permissão para realizar esta ação.';\r\n  }\r\n  \r\n  // Unique constraint violations\r\n  if (message.includes('duplicate key') || message.includes('unique constraint') || message.includes('already exists')) {\r\n    if (message.includes('email')) return 'Este email já está cadastrado.';\r\n    if (message.includes('registration_number')) return 'Este número de registro já existe.';\r\n    if (message.includes('name')) return 'Já existe um registro com este nome.';\r\n    return 'Já existe um registro com estas informações.';\r\n  }\r\n  \r\n  // NOT NULL violations\r\n  if (message.includes('null value') || message.includes('not-null') || message.includes('violates not-null')) {\r\n    return 'Preencha todos os campos obrigatórios.';\r\n  }\r\n  \r\n  // Foreign key violations\r\n  if (message.includes('foreign key') || message.includes('fkey') || message.includes('references')) {\r\n    return 'Não é possível realizar esta operação devido a dependências existentes.';\r\n  }\r\n  \r\n  // Check constraint violations  \r\n  if (message.includes('check constraint') || message.includes('violates check')) {\r\n    return 'Os dados fornecidos não atendem aos requisitos.';\r\n  }\r\n  \r\n  // Type conversion errors\r\n  if (message.includes('invalid input syntax') || message.includes('type')) {\r\n    return 'Formato de dados inválido.';\r\n  }\r\n  \r\n  // Network/connection errors\r\n  if (message.includes('fetch') || message.includes('network') || message.includes('connection')) {\r\n    return 'Erro de conexão. Verifique sua internet e tente novamente.';\r\n  }\r\n  \r\n  // Generic database/db errors\r\n  if (message.includes('postgresql') || message.includes('pgrst') || message.includes('db')) {\r\n    return 'Erro ao processar sua solicitação. Tente novamente.';\r\n  }\r\n  \r\n  // Default safe message\r\n  return 'Ocorreu um erro inesperado. Entre em contato com o suporte se persistir.';\r\n};\r\n\r\n/**\r\n * Logs errors to console only in development mode\r\n */\r\nexport const logError = (context: string, error: any): void => {\r\n  if (import.meta.env.DEV) {\r\n    console.error(`[${context}]`, error);\r\n  }\r\n};\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\lib\\geo-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\auth\\Account.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\auth\\Session.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\auth\\UserRole.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\auth\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\core\\Company.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\core\\JobFunction.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\core\\User.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\core\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\enums.ts","messages":[{"ruleId":"@typescript-eslint/no-duplicate-enum-values","severity":2,"message":"Duplicate enum member value Worker.","line":5,"column":5,"nodeType":"TSEnumMember","messageId":"duplicateValue","endLine":5,"endColumn":22}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export enum Role {\r\n    USER = 'Worker',\r\n    ADMIN = 'Admin',\r\n    SUPERVISOR = 'Supervisor',\r\n    WORKER = 'Worker',\r\n    COORDINATOR = 'Coordinator',\r\n    MANAGER = 'Manager',\r\n    TI_SOFTWARE = 'TI_Software',\r\n    GESTOR_PROJECT = 'Gestor_Project',\r\n    GESTOR_CANTEIRO = 'Gestor_Canteiro',\r\n    SUPERADMIN = 'SuperAdmin'\r\n}\r\n\r\nexport enum AccountStatus {\r\n    PENDING_VERIFICATION = 'PENDING_VERIFICATION',\r\n    ACTIVE = 'ACTIVE',\r\n    INACTIVE = 'INACTIVE',\r\n    SUSPENDED = 'SUSPENDED',\r\n    BLOCKED = 'BLOCKED'\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\monitoring\\AuditLog.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[146,149],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[146,149],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export interface AuditLog {\r\n    id: string;\r\n    userId: string;\r\n    action: string;\r\n    entity: string;\r\n    entityId: string;\r\n    details?: any;\r\n    ipAddress?: string | null;\r\n    userAgent?: string | null;\r\n    createdAt: Date;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\monitoring\\SystemMessage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\monitoring\\TimeRecord.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\monitoring\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\project\\ConstructionDocument.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\project\\DailyReport.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\project\\Project.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\project\\Site.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\project\\StageProgress.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\project\\Team.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\project\\TeamMember.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\project\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\models\\schemas.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\costs\\pages\\CostsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ArrowLeft' is defined but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Filter' is defined but never used.","line":11,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":45},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2346,2349],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2346,2349],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from \"react\";\r\nimport { useQuery } from \"@tanstack/react-query\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { orionApi } from \"@/integrations/orion/client\";\r\nimport { kpiService } from \"@/services/kpiService\";\r\nimport { TowerProductionData } from \"@/modules/production/types\";\r\nimport ProductionCostDashboard from \"@/modules/production/components/ProductionCostDashboard\";\r\nimport CostConfigurationModal from \"@/modules/production/components/CostConfigurationModal\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { ArrowLeft, Coins, Settings2, Filter, DollarSign, Loader2 } from \"lucide-react\";\r\nimport { useProjects } from \"@/hooks/useProjects\";\r\nimport { ProjectSelector } from \"@/components/shared/ProjectSelector\";\r\nimport { ProjectEmptyState } from \"@/components/shared/ProjectEmptyState\";\r\nimport DelayCostModal from \"@/modules/production/components/DelayCostModal\";\r\n\r\nexport default function CostsPage() {\r\n    const { profile } = useAuth();\r\n    const navigate = useNavigate();\r\n    const { projects } = useProjects();\r\n    const isGod = (profile?.role as string) === 'SUPER_ADMIN' || (profile?.role as string) === 'SUPER_ADMIN_GOD' || (profile?.role as string) === 'ADMIN' || !!profile?.isSystemAdmin;\r\n    const [selectedProjectId, setSelectedProjectId] = useState<string>(profile?.projectId || 'all');\r\n    const [isConfigOpen, setIsConfigOpen] = useState(false);\r\n    const [isDelayModalOpen, setIsDelayModalOpen] = useState(false);\r\n\r\n    const projectId = selectedProjectId;\r\n\r\n    // Fetch Data\r\n    const { data: towers, isLoading: loadingTowers } = useQuery({\r\n        queryKey: [\"production-towers\", projectId, profile?.companyId],\r\n        queryFn: async () => {\r\n            const companyIdParam = isGod ? 'all' : profile?.companyId;\r\n            const response = await orionApi.get(`/production/tower-status?projectId=${projectId}&companyId=${companyIdParam}`);\r\n            return response.data as TowerProductionData[];\r\n        },\r\n        enabled: !!profile?.companyId\r\n    });\r\n\r\n    const { data: categories } = useQuery({\r\n        queryKey: [\"production-categories\"],\r\n        queryFn: async () => {\r\n            const response = await orionApi.get(\"/production/categories\");\r\n            return response.data as any[];\r\n        }\r\n    });\r\n\r\n    const { data: unitCosts } = useQuery({\r\n        queryKey: [\"unit-costs\", projectId],\r\n        queryFn: () => kpiService.getUnitCosts(projectId),\r\n        enabled: !!projectId && projectId !== 'all'\r\n    });\r\n\r\n    const currentProjectName = projects.find(p => p.id === projectId)?.name || \"Todas as Obras\";\r\n\r\n    return (\r\n        <div className=\"h-screen w-full bg-background flex flex-col overflow-hidden font-sans\">\r\n            {/* Header */}\r\n            <header className=\"shrink-0 flex items-center justify-between px-6 py-4 border-b border-primary/20 bg-background/95 backdrop-blur-xl z-50 shadow-2xl relative\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <div className=\"flex flex-col\">\r\n                        <h1 className=\"text-xl md:text-2xl font-black tracking-tighter bg-linear-to-r from-amber-500 via-yellow-500 to-amber-700 bg-clip-text text-transparent uppercase italic drop-shadow-sm flex items-center gap-2\">\r\n                            <Coins className=\"h-6 w-6 text-amber-500\" />\r\n                            GESTÃO DE CUSTOS\r\n                        </h1>\r\n                        <p className=\"text-muted-foreground text-[10px] font-bold uppercase tracking-[0.3em] pl-1\">\r\n                            Financeiro de Produção - {currentProjectName}\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-3\">\r\n                    <Button\r\n                        variant=\"outline\"\r\n                        size=\"sm\"\r\n                        className=\"border-rose-500/30 text-rose-500 hover:bg-rose-500/10 uppercase text-[10px] font-bold tracking-wider\"\r\n                        onClick={() => setIsDelayModalOpen(true)}\r\n                        disabled={projectId === 'all'}\r\n                    >\r\n                        <DollarSign className=\"h-3.5 w-3.5 mr-2\" />\r\n                        Multas\r\n                    </Button>\r\n                    <Button\r\n                        variant=\"outline\"\r\n                        size=\"sm\"\r\n                        className=\"border-amber-500/30 text-amber-500 hover:bg-amber-500/10 uppercase text-[10px] font-bold tracking-wider\"\r\n                        onClick={() => setIsConfigOpen(true)}\r\n                        disabled={projectId === 'all'}\r\n                    >\r\n                        <Settings2 className=\"h-3.5 w-3.5 mr-2\" />\r\n                        Configurar Custos\r\n                    </Button>\r\n                    <ProjectSelector\r\n                        value={selectedProjectId}\r\n                        onValueChange={setSelectedProjectId}\r\n                        className=\"w-[200px]\"\r\n                    />\r\n                </div>\r\n            </header>\r\n\r\n            <main className=\"flex-1 overflow-auto p-6 bg-black/20\">\r\n                <div className=\"max-w-7xl mx-auto space-y-6\">\r\n                    {loadingTowers ? (\r\n                        <div className=\"flex flex-col items-center justify-center min-h-[400px] gap-4\">\r\n                            <Loader2 className=\"h-10 w-10 text-amber-500 animate-spin\" />\r\n                            <p className=\"text-white animate-pulse font-bold\">Calculando financeiro...</p>\r\n                        </div>\r\n                    ) : (!towers || towers.length === 0) ? (\r\n                        <div className=\"flex items-center justify-center min-h-[500px]\">\r\n                            <ProjectEmptyState\r\n                                type=\"towers\"\r\n                                title=\"Sem Dados Financeiros\"\r\n                                description=\"Para visualizar a gestão de custos, é necessário que a obra possua torres e atividades cadastradas com seus respectivos pesos (Concreto, Aço, Estrutura).\"\r\n                                onAction={() => navigate('/producao')}\r\n                                actionLabel=\"Ir para Produção\"\r\n                            />\r\n                        </div>\r\n                    ) : (\r\n                        <ProductionCostDashboard\r\n                            projectId={projectId}\r\n                            towers={towers || []}\r\n                            categories={categories || []}\r\n                            unitCosts={unitCosts || []}\r\n                        />\r\n                    )}\r\n                </div>\r\n            </main>\r\n\r\n            {projectId !== 'all' && (\r\n                <>\r\n                    <CostConfigurationModal\r\n                        isOpen={isConfigOpen}\r\n                        onClose={() => setIsConfigOpen(false)}\r\n                        projectId={projectId}\r\n                    />\r\n                    <DelayCostModal\r\n                        isOpen={isDelayModalOpen}\r\n                        onClose={() => setIsDelayModalOpen(false)}\r\n                        projectId={projectId}\r\n                    />\r\n                </>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\geo-viewer\\components\\MapPlane.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TILE_SIZE' is defined but never used.","line":4,"column":59,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":68},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'EARTH_RADIUS' is defined but never used.","line":4,"column":70,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":82},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'posY' is assigned a value but never used.","line":28,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":26}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\r\nimport { useLoader } from '@react-three/fiber';\r\nimport { TextureLoader, DoubleSide } from 'three';\r\nimport { latLonToTile, latLonToWorld, tileToLatLonBounds, TILE_SIZE, EARTH_RADIUS } from '../utils/tileUtils';\r\nimport { useGeoStore } from '../stores/useGeoStore';\r\n\r\ninterface TileProps {\r\n    x: number;\r\n    y: number;\r\n    z: number;\r\n    worldCenterLat: number;\r\n    worldCenterLon: number;\r\n    offline?: boolean;\r\n}\r\n\r\nconst Tile = ({ x, y, z, worldCenterLat, worldCenterLon, offline = false }: TileProps) => {\r\n    const url = offline\r\n        ? `/tiles/${z}/${x}/${y}.png`\r\n        : `https://a.tile.openstreetmap.org/${z}/${x}/${y}.png`;\r\n\r\n    const texture = useLoader(TextureLoader, url);\r\n\r\n    const position = useMemo(() => {\r\n        const bounds = tileToLatLonBounds(x, y, z);\r\n        const centerLat = (bounds.minLat + bounds.maxLat) / 2;\r\n        const centerLon = (bounds.minLon + bounds.maxLon) / 2;\r\n        // Calculate global position relative to world center\r\n        const [posX, posY, posZ] = latLonToWorld(centerLat, centerLon, worldCenterLat, worldCenterLon);\r\n        return [posX, 0, posZ] as [number, number, number];\r\n    }, [x, y, z, worldCenterLat, worldCenterLon]);\r\n\r\n    // Calculate generic tile size in meters at this latitude (approximate)\r\n    // At equator, 1 degree longitude is ~111km.\r\n    // This is a simplified scale for visualization, for high precision we would need more complex math per tile\r\n    // But for now, we just want to see the tiles.\r\n    // Actually, latLonToWorld gives us meters from center. We can compute bounds in meters to determine plane size.\r\n    const size = useMemo(() => {\r\n        const bounds = tileToLatLonBounds(x, y, z);\r\n        const bl = latLonToWorld(bounds.minLat, bounds.minLon, worldCenterLat, worldCenterLon);\r\n        const tr = latLonToWorld(bounds.maxLat, bounds.maxLon, worldCenterLat, worldCenterLon);\r\n\r\n        // Width (East-West)\r\n        const width = Math.abs(tr[0] - bl[0]);\r\n        // Height (North-South) - in 3D this is Z\r\n        const height = Math.abs(tr[2] - bl[2]);\r\n\r\n        return [width, height];\r\n    }, [x, y, z, worldCenterLat, worldCenterLon]);\r\n\r\n    return (\r\n        <mesh position={position} rotation={[-Math.PI / 2, 0, 0]}>\r\n            <planeGeometry args={[size[0], size[1]]} />\r\n            <meshBasicMaterial map={texture} side={DoubleSide} />\r\n        </mesh>\r\n    );\r\n};\r\n\r\nexport const MapPlane = ({ offline = false }: { offline?: boolean }) => {\r\n    const { center, zoom } = useGeoStore();\r\n\r\n    // Determine visible tiles based on center and zoom\r\n    // For MVP, we just render a 3x3 grid around the center tile\r\n    const tiles = useMemo(() => {\r\n        const centerTile = latLonToTile(center.lat, center.lng, zoom);\r\n        const tileList = [];\r\n        const range = 2; // Render 5x5 grid\r\n\r\n        for (let dx = -range; dx <= range; dx++) {\r\n            for (let dy = -range; dy <= range; dy++) {\r\n                tileList.push({\r\n                    x: centerTile.x + dx,\r\n                    y: centerTile.y + dy,\r\n                    z: zoom\r\n                });\r\n            }\r\n        }\r\n        return tileList;\r\n    }, [center, zoom]);\r\n\r\n    return (\r\n        <group>\r\n            {tiles.map((t) => (\r\n                <Tile\r\n                    key={`${t.z}-${t.x}-${t.y}`}\r\n                    x={t.x}\r\n                    y={t.y}\r\n                    z={t.z}\r\n                    worldCenterLat={center.lat}\r\n                    worldCenterLon={center.lng}\r\n                    offline={offline}\r\n                />\r\n            ))}\r\n        </group>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\geo-viewer\\components\\ModelLoader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\geo-viewer\\components\\Scene.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\geo-viewer\\pages\\GeoViewerPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\geo-viewer\\stores\\useGeoStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\geo-viewer\\utils\\tileUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\production\\components\\ActivityStatusModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3789,3792],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3789,3792],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":113,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4312,4315],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4312,4315],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":113,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4328,4331],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4328,4331],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":120,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4537,4540],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4537,4540],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":123,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4671,4674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4671,4674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":167,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6685,6688],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6685,6688],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from \"react\";\r\nimport { format } from \"date-fns\";\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogDescription,\r\n    DialogFooter,\r\n} from \"@/components/ui/dialog\";\r\nimport {\r\n    Tabs,\r\n    TabsContent,\r\n    TabsList,\r\n    TabsTrigger,\r\n} from \"@/components/ui/tabs\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Calendar } from \"@/components/ui/calendar\";\r\nimport {\r\n    Popover,\r\n    PopoverContent,\r\n    PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport {\r\n    Command,\r\n    CommandEmpty,\r\n    CommandGroup,\r\n    CommandInput,\r\n    CommandItem,\r\n    CommandList,\r\n} from \"@/components/ui/command\";\r\nimport { CalendarIcon, Loader2, Check, ChevronsUpDown, User } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { ActivityStatus, TowerActivityStatus, LandStatus, ImpedimentType } from \"../types\";\r\nimport { orionApi } from \"@/integrations/orion/client\";\r\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\r\nimport { toast } from \"sonner\";\r\nimport { useEmployees } from \"@/hooks/useEmployees\";\r\nimport { show } from \"@/signals/authSignals\";\r\n\r\n// Sub-componentes Refatorados (SRP)\r\nimport { StatusTab } from \"./ActivityStatusModal/StatusTab\";\r\nimport { HistoryTab } from \"./ActivityStatusModal/HistoryTab\";\r\nimport { ScheduleSection } from \"./ActivityStatusModal/ScheduleSection\";\r\n\r\ninterface ActivityStatusModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    elementId: string;\r\n    towerName: string;\r\n    towerType: string | null;\r\n    activityId: string;\r\n    activityName: string;\r\n    currentStatus?: TowerActivityStatus;\r\n    projectId?: string;\r\n}\r\n\r\nconst ActivityStatusModal = React.memo(({\r\n    isOpen,\r\n    onClose,\r\n    elementId,\r\n    towerName,\r\n    towerType,\r\n    activityId,\r\n    activityName,\r\n    currentStatus,\r\n    projectId\r\n}: ActivityStatusModalProps) => {\r\n    const queryClient = useQueryClient();\r\n\r\n    // Estado Principal\r\n    const [status, setStatus] = useState<ActivityStatus>(currentStatus?.status || 'PENDING');\r\n    const [landStatus, setLandStatus] = useState<LandStatus>(currentStatus?.landStatus || 'FREE');\r\n    const [impedimentType, setImpedimentType] = useState<ImpedimentType>(currentStatus?.impedimentType || 'NONE');\r\n    const [progressPercent, setProgressPercent] = useState<number>(currentStatus?.progressPercent || 0);\r\n    const [startDate, setStartDate] = useState<Date | undefined>(\r\n        currentStatus?.startDate ? new Date(currentStatus.startDate) : undefined\r\n    );\r\n    const [endDate, setEndDate] = useState<Date | undefined>(\r\n        currentStatus?.endDate ? new Date(currentStatus.endDate) : undefined\r\n    );\r\n    const [notes, setNotes] = useState(currentStatus?.notes || \"\");\r\n    const [foremanName, setForemanName] = useState<string>(currentStatus?.metadata?.leadName || \"\");\r\n    const [foremanSearchOpen, setForemanSearchOpen] = useState(false);\r\n\r\n    // Estado de Planejamento\r\n    const [plannedStart, setPlannedStart] = useState<Date | undefined>();\r\n    const [plannedEnd, setPlannedEnd] = useState<Date | undefined>();\r\n    const [plannedQuantity, setPlannedQuantity] = useState<string>(\"\");\r\n    const [plannedHHH, setPlannedHHH] = useState<string>(\"\");\r\n    const [selectedReasonId, setSelectedReasonId] = useState<string>(\"\");\r\n\r\n    const { employees } = useEmployees();\r\n\r\n    // Consultas\r\n    const { data: history = [], isLoading: isLoadingHistory } = useQuery({\r\n        queryKey: [\"production-logs\", elementId, activityId],\r\n        queryFn: async () => {\r\n            const res = await orionApi.get<any[]>(`/production/logs?elementId=${elementId}&activityId=${activityId}`);\r\n            return res.data || [];\r\n        },\r\n        enabled: isOpen && !!elementId && !!activityId,\r\n    });\r\n\r\n    const { data: scheduleData } = useQuery({\r\n        queryKey: [\"production-schedule\", elementId, activityId],\r\n        queryFn: async () => {\r\n            const res = await orionApi.get(`/production/schedule?elementId=${elementId}`);\r\n            if (res.data && Array.isArray(res.data)) {\r\n                return (res.data as any[]).find((s: any) => s.activityId === activityId);\r\n            }\r\n            return null;\r\n        },\r\n        enabled: isOpen && !!elementId && !!activityId,\r\n    });\r\n\r\n    const { data: delayReasons = [] } = useQuery<any[]>({\r\n        queryKey: [\"delay-reasons\", elementId],\r\n        queryFn: async () => {\r\n            const res = await orionApi.get<any[]>(`/production/delay-reasons?projectId=${projectId}`);\r\n            return res.data || [];\r\n        },\r\n        enabled: isOpen && !!projectId && projectId !== 'all'\r\n    });\r\n\r\n    // Efeitos\r\n    React.useEffect(() => {\r\n        if (scheduleData) {\r\n            if (scheduleData.plannedStart) setPlannedStart(new Date(scheduleData.plannedStart));\r\n            if (scheduleData.plannedEnd) setPlannedEnd(new Date(scheduleData.plannedEnd));\r\n            if (scheduleData.plannedQuantity) setPlannedQuantity(scheduleData.plannedQuantity.toString());\r\n            if (scheduleData.plannedHHH) setPlannedHHH(scheduleData.plannedHHH.toString());\r\n        }\r\n    }, [scheduleData]);\r\n\r\n    const leaders = React.useMemo(() =>\r\n        employees.filter(e => e.canLeadTeam || e.professionalLevel >= 3)\r\n        , [employees]);\r\n\r\n    const isFoundation = React.useMemo(() =>\r\n        [\"fundação\", \"escavação\", \"armação\", \"concretagem\", \"reaterro\"].some(v => activityName.toLowerCase().includes(v))\r\n        , [activityName]);\r\n\r\n    const componentLabels = React.useMemo(() => {\r\n        const isEstaiada = towerType?.toLowerCase().includes(\"estaiada\");\r\n        return isEstaiada\r\n            ? [\"Mastro\", \"Estai A\", \"Estai B\", \"Estai C\", \"Estai D\"]\r\n            : [\"Pé A\", \"Pé B\", \"Pé C\", \"Pé D\"];\r\n    }, [towerType]);\r\n\r\n    const [components, setComponents] = useState<Record<string, ActivityStatus>>(\r\n        currentStatus?.metadata?.components ||\r\n        Object.fromEntries(componentLabels.map(label => [label, 'PENDING']))\r\n    );\r\n\r\n    const approveMutation = useMutation({\r\n        mutationFn: async ({ progressId, logTimestamp }: { progressId: string, logTimestamp: string }) => {\r\n            return orionApi.post(\"/production/logs\", { progressId, logTimestamp });\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"production-logs\", elementId, activityId] });\r\n            toast.success(\"Log aprovado com sucesso\");\r\n        },\r\n        onError: (error: any) => {\r\n            toast.error(\"Erro ao aprovar log: \" + (error.response?.data?.message || error.message));\r\n        }\r\n    });\r\n\r\n    const updateMutation = useMutation({\r\n        mutationFn: async () => {\r\n            const finalProgress = status === 'FINISHED' ? 100 : progressPercent;\r\n\r\n            if (status === 'PENDING' && notes.length < 10 && foremanName === \"none\") {\r\n                toast.error(\"Status 'Pendente' exige justificativa nas observações ou programação.\");\r\n                throw new Error(\"Validation failed\");\r\n            }\r\n\r\n            let isRegression = false;\r\n            let regressionMsg = \"\";\r\n            if (currentStatus) {\r\n                if (currentStatus.progressPercent && finalProgress < currentStatus.progressPercent && status !== 'PENDING') {\r\n                    isRegression = true;\r\n                    regressionMsg = `Redução de avanço detectada (${currentStatus.progressPercent}% -> ${finalProgress}%).`;\r\n                }\r\n                if (currentStatus.startDate && !startDate) {\r\n                    isRegression = true;\r\n                    regressionMsg += \" Remoção de data de início.\";\r\n                }\r\n            }\r\n\r\n            if (isRegression && notes.length < 5) {\r\n                toast.error(\"Detectada regressão de dados. É OBRIGATÓRIO informar uma justificativa.\");\r\n                throw new Error(\"Validation failed\");\r\n            }\r\n\r\n            const payload = {\r\n                elementId,\r\n                activityId,\r\n                status,\r\n                landStatus,\r\n                impedimentType,\r\n                foremanName,\r\n                progressPercent: finalProgress,\r\n                startDate: startDate?.toISOString(),\r\n                endDate: endDate?.toISOString(),\r\n                notes,\r\n                requiresApproval: isRegression,\r\n                approvalReason: isRegression ? regressionMsg : null,\r\n                metadata: {\r\n                    components: isFoundation ? components : undefined,\r\n                    leadName: foremanName\r\n                }\r\n            };\r\n\r\n            if (plannedStart && plannedEnd) {\r\n                const toNoon = (d: Date) => new Date(d.setHours(12, 0, 0, 0)).toISOString();\r\n                await orionApi.post(\"/production/schedule\", {\r\n                    elementId,\r\n                    activityId,\r\n                    plannedStart: toNoon(plannedStart),\r\n                    plannedEnd: toNoon(plannedEnd),\r\n                    plannedQuantity: plannedQuantity ? parseFloat(plannedQuantity) : null,\r\n                    plannedHHH: plannedHHH ? parseFloat(plannedHHH) : null\r\n                });\r\n            }\r\n\r\n            const response = await orionApi.post(\"/production/tower-status\", payload);\r\n            return response.data;\r\n        },\r\n        onSuccess: () => {\r\n            [\"production-towers\", \"production-schedule\", \"production-logs\"].forEach(k =>\r\n                queryClient.invalidateQueries({ queryKey: [k] })\r\n            );\r\n            toast.success(\"Dados atualizados com sucesso\");\r\n            onClose();\r\n        },\r\n        \r\n    });\r\n\r\n    React.useEffect(() => {\r\n        if (!isFoundation) return;\r\n        const total = Object.keys(components).length;\r\n        if (total === 0) return;\r\n        const finished = Object.values(components).filter(s => s === 'FINISHED').length;\r\n        const calc = Math.round((finished / total) * 100);\r\n        if (status !== 'FINISHED') setProgressPercent(calc);\r\n    }, [components, isFoundation, status]);\r\n\r\n    React.useEffect(() => {\r\n        if (status === 'FINISHED') setProgressPercent(100);\r\n    }, [status]);\r\n\r\n    const toggleComponentStatus = React.useCallback((label: string) => {\r\n        setComponents(prev => {\r\n            const current = prev[label];\r\n            const next: ActivityStatus = current === 'PENDING' ? 'IN_PROGRESS' : current === 'IN_PROGRESS' ? 'FINISHED' : 'PENDING';\r\n            return { ...prev, [label]: next };\r\n        });\r\n    }, []);\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={onClose}>\r\n            <DialogContent className=\"sm:max-w-[480px] p-0 border-amber-900/20 bg-slate-950 text-slate-100 overflow-hidden\">\r\n                <Tabs defaultValue=\"status\" className=\"w-full\">\r\n                    <div className=\"px-6 pt-6 pb-2 border-b border-white/5 space-y-4\">\r\n                        <DialogHeader className=\"p-0\">\r\n                            <DialogTitle className=\"flex items-center gap-2 text-lg font-bold text-amber-500\">\r\n                                {towerName}\r\n                                <Badge variant=\"outline\" className=\"text-[9px] bg-amber-500/10 text-amber-500 border-amber-500/20 px-1.5 py-0\">{activityName}</Badge>\r\n                            </DialogTitle>\r\n                            <DialogDescription className=\"text-xs text-slate-400\">Gestão de Produção Unificada</DialogDescription>\r\n                        </DialogHeader>\r\n\r\n                        <TabsList className=\"bg-black/40 border border-white/5 w-full h-9 p-1\">\r\n                            <TabsTrigger value=\"status\" className=\"flex-1 text-[10px] uppercase font-bold tracking-widest data-[state=active]:bg-amber-500/10 data-[state=active]:text-amber-500 h-7\">Status & Avanço</TabsTrigger>\r\n                            <TabsTrigger value=\"history\" className=\"flex-1 text-[10px] uppercase font-bold tracking-widest data-[state=active]:bg-amber-500/10 data-[state=active]:text-amber-500 h-7\">Histórico de Logs</TabsTrigger>\r\n                        </TabsList>\r\n                    </div>\r\n\r\n                    <TabsContent value=\"status\" className=\"m-0 focus-visible:outline-hidden\">\r\n                        <div className=\"px-6 py-4 max-h-[60vh] overflow-y-auto custom-scrollbar\">\r\n                            <div className=\"grid gap-6\">\r\n                                {/* Componente de Liderança */}\r\n                                <div className=\"grid gap-2\">\r\n                                    <Label className=\"text-xs font-semibold uppercase text-slate-500\">Encarregado</Label>\r\n                                    <Popover open={foremanSearchOpen} onOpenChange={setForemanSearchOpen}>\r\n                                        <PopoverTrigger asChild>\r\n                                            <Button variant=\"outline\" className=\"h-9 w-full justify-between bg-slate-900 border-slate-800 text-slate-200 px-3 text-xs\">\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <User className=\"w-3 h-3 text-amber-500\" />\r\n                                                    <span className=\"truncate\">{foremanName && foremanName !== \"none\" ? foremanName : \"Selecionar...\"}</span>\r\n                                                </div>\r\n                                                <ChevronsUpDown className=\"ml-1 h-3 w-3 opacity-50\" />\r\n                                            </Button>\r\n                                        </PopoverTrigger>\r\n                                        <PopoverContent className=\"w-[300px] p-0 bg-slate-900 border-slate-800\" align=\"start\">\r\n                                            <Command className=\"bg-slate-900 text-slate-200\">\r\n                                                <CommandInput placeholder=\"Procurar líder...\" className=\"h-9 border-none focus:ring-0\" />\r\n                                                <CommandList className=\"max-h-[300px] custom-scrollbar\">\r\n                                                    <CommandEmpty className=\"py-6 text-center text-xs text-slate-500\">Ninguém encontrado.</CommandEmpty>\r\n                                                    <CommandGroup heading=\"Liderança de Campo\">\r\n                                                        <CommandItem value=\"none\" onSelect={() => { setForemanName(\"none\"); setForemanSearchOpen(false); }} className=\"flex items-center gap-2 p-2 cursor-pointer hover:bg-slate-800\">\r\n                                                            <div className=\"w-4 h-4\" /> <span>Nenhum</span>\r\n                                                            <Check className={cn(\"ml-auto h-4 w-4\", foremanName === \"none\" ? \"opacity-100\" : \"opacity-0\")} />\r\n                                                        </CommandItem>\r\n                                                        {leaders.map((leader) => (\r\n                                                            <CommandItem key={leader.id} value={leader.fullName} onSelect={() => { setForemanName(leader.fullName); setForemanSearchOpen(false); }} className=\"flex items-center gap-3 p-2 cursor-pointer hover:bg-slate-800 group\">\r\n                                                                <div className=\"w-4 h-4 rounded-full bg-amber-500/10 flex items-center justify-center shrink-0\"><User className=\"w-2.5 h-2.5 text-amber-500\" /></div>\r\n                                                                <div className=\"flex flex-col min-w-0\">\r\n                                                                    <span className=\"text-sm font-semibold truncate group-hover:text-amber-500\">{leader.fullName}</span>\r\n                                                                    <span className=\"text-[10px] text-slate-500 uppercase font-bold\">{leader.functionName || 'Encarregado'}</span>\r\n                                                                </div>\r\n                                                                <Check className={cn(\"ml-auto h-4 w-4 text-amber-500\", foremanName === leader.fullName ? \"opacity-100\" : \"opacity-0\")} />\r\n                                                            </CommandItem>\r\n                                                        ))}\r\n                                                    </CommandGroup>\r\n                                                </CommandList>\r\n                                            </Command>\r\n                                        </PopoverContent>\r\n                                    </Popover>\r\n                                </div>\r\n\r\n                                <StatusTab\r\n                                    status={status} setStatus={setStatus}\r\n                                    landStatus={landStatus} setLandStatus={setLandStatus}\r\n                                    selectedReasonId={selectedReasonId} setSelectedReasonId={setSelectedReasonId}\r\n                                    setImpedimentType={setImpedimentType}\r\n                                    delayReasons={delayReasons}\r\n                                    progressPercent={progressPercent} setProgressPercent={setProgressPercent}\r\n                                    isFoundation={isFoundation}\r\n                                    componentLabels={componentLabels}\r\n                                    components={components}\r\n                                    toggleComponentStatus={toggleComponentStatus}\r\n                                />\r\n\r\n                                <div className=\"grid grid-cols-2 gap-4 border-t border-slate-800 pt-4\">\r\n                                    <div className=\"grid gap-1\">\r\n                                        <Label className=\"text-[10px] font-bold uppercase text-slate-500\">Início Real</Label>\r\n                                        <Popover>\r\n                                            <PopoverTrigger asChild>\r\n                                                <Button variant=\"outline\" className=\"h-9 bg-slate-900 border-slate-800 justify-start text-[11px] font-bold\">\r\n                                                    <CalendarIcon className=\"mr-2 h-3 w-3 text-sky-500\" />\r\n                                                    {startDate ? format(startDate, \"dd/MM/yyyy\") : \"Definir\"}\r\n                                                </Button>\r\n                                            </PopoverTrigger>\r\n                                            <PopoverContent className=\"w-auto p-0 bg-slate-900 border-slate-800\">\r\n                                                <Calendar mode=\"single\" selected={startDate} onSelect={setStartDate} className=\"bg-slate-900 text-slate-100\" />\r\n                                            </PopoverContent>\r\n                                        </Popover>\r\n                                    </div>\r\n                                    <div className=\"grid gap-1\">\r\n                                        <Label className=\"text-[10px] font-bold uppercase text-slate-500\">Fim Real</Label>\r\n                                        <Popover>\r\n                                            <PopoverTrigger asChild>\r\n                                                <Button variant=\"outline\" className=\"h-9 bg-slate-900 border-slate-800 justify-start text-[11px] font-bold\">\r\n                                                    <CalendarIcon className=\"mr-2 h-3 w-3 text-sky-500\" />\r\n                                                    {endDate ? format(endDate, \"dd/MM/yyyy\") : \"Definir\"}\r\n                                                </Button>\r\n                                            </PopoverTrigger>\r\n                                            <PopoverContent className=\"w-auto p-0 bg-slate-900 border-slate-800\">\r\n                                                <Calendar mode=\"single\" selected={endDate} onSelect={setEndDate} className=\"bg-slate-900 text-slate-100\" />\r\n                                            </PopoverContent>\r\n                                        </Popover>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {show('showProjectManagement') && (\r\n                                    <ScheduleSection\r\n                                        plannedStart={plannedStart} setPlannedStart={setPlannedStart}\r\n                                        plannedEnd={plannedEnd} setPlannedEnd={setPlannedEnd}\r\n                                        plannedQuantity={plannedQuantity} setPlannedQuantity={setPlannedQuantity}\r\n                                        plannedHHH={plannedHHH} setPlannedHHH={setPlannedHHH}\r\n                                    />\r\n                                )}\r\n\r\n                                <div className=\"grid gap-2 border-t border-slate-800 pt-4 pb-2\">\r\n                                    <div className=\"flex justify-between items-center\">\r\n                                        <Label className=\"text-xs font-semibold uppercase text-slate-500\">Justificativa / Notas</Label>\r\n                                        {status === 'PENDING' && <Badge variant=\"outline\" className=\"text-[8px] text-amber-500 bg-amber-500/5 border-amber-500/20 h-4\">Obrigatória</Badge>}\r\n                                    </div>\r\n                                    <Textarea\r\n                                        placeholder=\"Descreva observações de campo...\"\r\n                                        className=\"bg-slate-900 border-slate-800 text-slate-200 text-xs min-h-[60px]\"\r\n                                        value={notes}\r\n                                        onChange={(e) => setNotes(e.target.value)}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <DialogFooter className=\"px-6 py-4 border-t border-white/5 bg-black/20 flex flex-row justify-end gap-2\">\r\n                            <Button variant=\"ghost\" size=\"sm\" onClick={onClose} disabled={updateMutation.isPending} className=\"text-slate-400 font-bold h-9 px-4 text-xs\">CANCEL</Button>\r\n                            {show('production.canRegisterAdvance') && (\r\n                                <Button size=\"sm\" onClick={() => updateMutation.mutate()} disabled={updateMutation.isPending} className=\"bg-amber-600 hover:bg-amber-500 text-white font-black px-6 h-9 text-xs uppercase shadow-glow\">\r\n                                    {updateMutation.isPending && <Loader2 className=\"mr-2 h-3 w-3 animate-spin\" />}\r\n                                    Registrar Avanço\r\n                                </Button>\r\n                            )}\r\n                        </DialogFooter>\r\n                    </TabsContent>\r\n\r\n                    <TabsContent value=\"history\" className=\"m-0 focus-visible:outline-hidden\">\r\n                        <HistoryTab isLoadingHistory={isLoadingHistory} history={history} approveMutation={approveMutation} />\r\n                    </TabsContent>\r\n                </Tabs>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n});\r\n\r\nexport default ActivityStatusModal;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\production\\components\\ActivityStatusModal\\HistoryTab.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[389,392],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[389,392],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[418,421],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[418,421],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1440,1443],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1440,1443],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\r\nimport { format } from \"date-fns\";\r\nimport { Loader2, AlertTriangle, Check, User } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { show } from \"@/signals/authSignals\";\r\n\r\ninterface HistoryTabProps {\r\n    isLoadingHistory: boolean;\r\n    history: any[];\r\n    approveMutation: any;\r\n}\r\n\r\nexport const HistoryTab = ({ isLoadingHistory, history, approveMutation }: HistoryTabProps) => {\r\n    if (isLoadingHistory) {\r\n        return (\r\n            <div className=\"flex flex-col items-center justify-center py-20 gap-3\">\r\n                <Loader2 className=\"w-6 h-6 text-amber-500 animate-spin\" />\r\n                <span className=\"text-xs text-slate-500 font-bold uppercase tracking-widest\">Carregando Histórico...</span>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (history.length === 0) {\r\n        return (\r\n            <div className=\"flex flex-col items-center justify-center py-20 gap-3 text-slate-600\">\r\n                <AlertTriangle className=\"w-8 h-8 opacity-20\" />\r\n                <p className=\"text-xs font-bold uppercase tracking-widest\">Nenhum registro encontrado</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"px-6 py-4 max-h-[65vh] overflow-y-auto custom-scrollbar\">\r\n            <div className=\"space-y-4\">\r\n                {history.map((log: any, idx: number) => (\r\n                    <div key={idx} className=\"relative pl-6 border-l border-white/5 group\">\r\n                        <div className={cn(\r\n                            \"absolute -left-[5px] top-1 w-2.5 h-2.5 rounded-full border-2 border-slate-950\",\r\n                            log.status === 'APPROVED' ? \"bg-green-500\" : \"bg-amber-500\"\r\n                        )} />\r\n\r\n                        <div className=\"bg-white/5 rounded-xl p-3 border border-white/5 group-hover:bg-white/8 transition-all\">\r\n                            <div className=\"flex justify-between items-start mb-2\">\r\n                                <div className=\"flex flex-col\">\r\n                                    <span className=\"text-[10px] font-black text-slate-400 font-mono tracking-tighter\">\r\n                                        {format(new Date(log.timestamp), \"dd/MM/yyyy HH:mm\")}\r\n                                    </span>\r\n                                    <div className=\"flex items-center gap-2 mt-0.5\">\r\n                                        <Badge className={cn(\r\n                                            \"text-[9px] font-black h-4 px-1.5 uppercase tracking-tighter\",\r\n                                            log.status === 'FINISHED' && \"bg-green-600\",\r\n                                            log.status === 'IN_PROGRESS' && \"bg-yellow-500 text-blue-900\",\r\n                                            log.status === 'PENDING' && \"bg-slate-700\",\r\n                                            log.status === 'APPROVED' && \"bg-sky-600\"\r\n                                        )}>\r\n                                            {log.status}\r\n                                        </Badge>\r\n                                        <span className=\"text-[10px] font-bold text-sky-400\">{log.progress}%</span>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {log.status !== 'APPROVED' && show('production.canApproveLogs') && (\r\n                                    <Button\r\n                                        size=\"sm\" variant=\"outline\"\r\n                                        className=\"h-6 px-2 text-[9px] font-black uppercase border-green-500/30 text-green-400 hover:bg-green-500/20 hover:text-green-300\"\r\n                                        onClick={() => approveMutation.mutate({\r\n                                            progressId: log.progressId,\r\n                                            logTimestamp: log.timestamp\r\n                                        })}\r\n                                        disabled={approveMutation.isPending}\r\n                                    >\r\n                                        {approveMutation.isPending ? <Loader2 className=\"w-2.5 h-2.5 animate-spin\" /> : <Check className=\"w-2.5 h-2.5 mr-1\" />}\r\n                                        Aprovar\r\n                                    </Button>\r\n                                )}\r\n\r\n                                {log.status === 'APPROVED' && (\r\n                                    <div className=\"flex items-center gap-1.5 text-[9px] font-bold text-green-500/60 uppercase\">\r\n                                        <Check className=\"w-3 h-3\" />\r\n                                        Aprovado por {log.approvedBy || 'Gestor'}\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            {log.notes && (\r\n                                <p className=\"text-xs text-slate-300 mt-2 bg-black/20 p-2 rounded-lg leading-relaxed italic border-l-2 border-amber-500/20\">\r\n                                    \"{log.notes}\"\r\n                                </p>\r\n                            )}\r\n\r\n                            <div className=\"flex items-center gap-3 mt-3 pt-2 border-t border-white/5 opacity-40\">\r\n                                <div className=\"flex items-center gap-1\">\r\n                                    <User className=\"w-2.5 h-2.5\" />\r\n                                    <span className=\"text-[9px] font-bold uppercase tracking-widest\">{log.metadata?.leadName || 'Sistema'}</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\production\\components\\ActivityStatusModal\\ScheduleSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\production\\components\\ActivityStatusModal\\StatusTab.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[674,677],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[674,677],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4714,4717],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4714,4717],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5287,5290],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5287,5290],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { ActivityStatus, LandStatus, ImpedimentType } from \"../../types\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface StatusTabProps {\r\n    status: ActivityStatus;\r\n    setStatus: (val: ActivityStatus) => void;\r\n    landStatus: LandStatus;\r\n    setLandStatus: (val: LandStatus) => void;\r\n    selectedReasonId: string;\r\n    setSelectedReasonId: (val: string) => void;\r\n    setImpedimentType: (val: ImpedimentType) => void;\r\n    delayReasons: any[];\r\n    progressPercent: number;\r\n    setProgressPercent: (val: number) => void;\r\n    isFoundation: boolean;\r\n    componentLabels: string[];\r\n    components: Record<string, ActivityStatus>;\r\n    toggleComponentStatus: (label: string) => void;\r\n}\r\n\r\nexport const StatusTab = ({\r\n    status, setStatus,\r\n    landStatus, setLandStatus,\r\n    selectedReasonId, setSelectedReasonId,\r\n    setImpedimentType,\r\n    delayReasons,\r\n    progressPercent, setProgressPercent,\r\n    isFoundation,\r\n    componentLabels,\r\n    components,\r\n    toggleComponentStatus\r\n}: StatusTabProps) => {\r\n    return (\r\n        <div className=\"px-6 py-4 max-h-[60vh] overflow-y-auto custom-scrollbar\">\r\n            <div className=\"grid gap-6\">\r\n                <div className=\"grid gap-2\">\r\n                    <Label htmlFor=\"status\" className=\"text-xs font-semibold uppercase text-slate-500\">Status Atividade</Label>\r\n                    <Select value={status} onValueChange={(val: ActivityStatus) => setStatus(val)}>\r\n                        <SelectTrigger className={cn(\r\n                            \"h-9 border-slate-800 text-xs font-bold\",\r\n                            status === 'PENDING' && \"bg-[#5D4037] text-white\",\r\n                            status === 'IN_PROGRESS' && \"bg-[#FFD600] text-blue-900\",\r\n                            status === 'FINISHED' && \"bg-green-600 text-white\",\r\n                            status !== 'PENDING' && status !== 'IN_PROGRESS' && status !== 'FINISHED' && \"bg-slate-900\"\r\n                        )}>\r\n                            <SelectValue />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"bg-slate-900 border-slate-800 text-slate-200\">\r\n                            <SelectItem value=\"PENDING\">Pendente</SelectItem>\r\n                            <SelectItem value=\"IN_PROGRESS\">Em Andamento</SelectItem>\r\n                            <SelectItem value=\"FINISHED\">Concluído</SelectItem>\r\n                        </SelectContent>\r\n                    </Select>\r\n                </div>\r\n\r\n                <div className={cn(\r\n                    \"grid gap-4 border-t border-slate-800 pt-4\",\r\n                    landStatus === 'EMBARGO' ? \"grid-cols-1\" : \"grid-cols-2\"\r\n                )}>\r\n                    <div className=\"grid gap-2\">\r\n                        <Label className=\"text-xs font-semibold uppercase text-slate-500\">Status Fundiário</Label>\r\n                        <Select value={landStatus} onValueChange={(val: LandStatus) => setLandStatus(val)}>\r\n                            <SelectTrigger className={cn(\r\n                                \"h-9 border-slate-800 text-xs\",\r\n                                landStatus === 'EMBARGO' && \"bg-red-800 text-white border-red-700\",\r\n                                landStatus === 'IMPEDIMENT' && \"bg-orange-700 text-white\",\r\n                                landStatus === 'FREE' && \"bg-slate-900\"\r\n                            )}>\r\n                                <SelectValue />\r\n                            </SelectTrigger>\r\n                            <SelectContent className=\"bg-slate-900 border-slate-800 text-slate-200\">\r\n                                <SelectItem value=\"FREE\">Liberado</SelectItem>\r\n                                <SelectItem value=\"IMPEDIMENT\">Impedimento Técnico</SelectItem>\r\n                                <SelectItem value=\"EMBARGO\">Embargo Fundiário</SelectItem>\r\n                            </SelectContent>\r\n                        </Select>\r\n                    </div>\r\n\r\n                    {landStatus !== 'EMBARGO' && (\r\n                        <div className=\"grid gap-2\">\r\n                            <Label className=\"text-xs font-semibold uppercase text-slate-500\">Motivo / Detalhe</Label>\r\n                            <Select\r\n                                value={selectedReasonId}\r\n                                onValueChange={(val) => {\r\n                                    setSelectedReasonId(val);\r\n                                    const reason = delayReasons.find((r: any) => r.id === val);\r\n                                    if (reason) setImpedimentType(reason.category);\r\n                                }}\r\n                            >\r\n                                <SelectTrigger className=\"h-9 bg-slate-900 border-slate-800 text-xs\">\r\n                                    <SelectValue placeholder=\"Selecione...\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent className=\"bg-slate-900 border-slate-800 text-slate-200\">\r\n                                    {delayReasons.map((r: any) => (\r\n                                        <SelectItem key={r.id} value={r.id} className=\"text-xs\">\r\n                                            <span className=\"font-bold text-amber-500 mr-2\">{r.code}</span>\r\n                                            {r.description}\r\n                                        </SelectItem>\r\n                                    ))}\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                <div className=\"grid gap-2 border-t border-slate-800 pt-3\">\r\n                    <div className=\"flex justify-between items-center\">\r\n                        <Label className=\"text-[10px] font-bold uppercase text-slate-500\">\r\n                            Avanço Físico: <span className=\"text-sky-400 font-bold ml-1\">{progressPercent}%</span>\r\n                        </Label>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <input\r\n                            type=\"range\" min=\"0\" max=\"100\" step=\"1\"\r\n                            value={progressPercent}\r\n                            onChange={(e) => setProgressPercent(parseInt(e.target.value))}\r\n                            className=\"flex-1 h-1.5 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-sky-500\"\r\n                            disabled={status === 'FINISHED'}\r\n                        />\r\n                        <div className=\"w-10 text-right text-[10px] font-mono font-bold text-sky-400\">\r\n                            {progressPercent}%\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {isFoundation && (\r\n                    <div className=\"grid gap-2 border border-slate-800 p-3 rounded-xl bg-slate-900/50\">\r\n                        <Label className=\"text-[10px] uppercase font-bold text-slate-500 tracking-wider\">Componentes da Estrutura</Label>\r\n                        <div className=\"grid grid-cols-2 gap-2 mt-1\">\r\n                            {componentLabels.map(label => {\r\n                                const cStatus = components[label];\r\n                                return (\r\n                                    <div\r\n                                        key={label}\r\n                                        className={cn(\r\n                                            \"flex items-center justify-between p-2 rounded-lg cursor-pointer transition-all border\",\r\n                                            cStatus === 'FINISHED' && \"bg-green-500/10 border-green-500/40 shadow-[0_0_10px_rgba(34,197,94,0.1)]\",\r\n                                            cStatus === 'IN_PROGRESS' && \"bg-yellow-500/5 border-yellow-500/30\",\r\n                                            cStatus === 'PENDING' && \"bg-slate-900 border-slate-800 hover:border-slate-700\",\r\n                                        )}\r\n                                        onClick={() => toggleComponentStatus(label)}\r\n                                    >\r\n                                        <span className={cn(\r\n                                            \"text-xs font-bold\",\r\n                                            cStatus === 'FINISHED' && \"text-green-300\",\r\n                                            cStatus === 'IN_PROGRESS' && \"text-yellow-200\",\r\n                                            cStatus === 'PENDING' && \"text-slate-500\"\r\n                                        )}>{label}</span>\r\n                                        <Badge\r\n                                            className={cn(\r\n                                                \"text-[8px] px-1.5 h-4 font-black tracking-wider\",\r\n                                                cStatus === 'FINISHED' && \"bg-green-600 text-white border-0\",\r\n                                                cStatus === 'IN_PROGRESS' && \"bg-yellow-500 text-blue-900 border-0\",\r\n                                                cStatus === 'PENDING' && \"bg-slate-800 text-slate-500 border-slate-700\"\r\n                                            )}\r\n                                        >\r\n                                            {cStatus === 'FINISHED' ? '100%' : cStatus === 'IN_PROGRESS' ? 'EXEC' : 'PEN'}\r\n                                        </Badge>\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\production\\components\\BulkScheduleModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'DialogHeader' is defined but never used.","line":7,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TowerIcon' is defined but never used.","line":17,"column":60,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":69},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CalendarDays' is defined but never used.","line":17,"column":71,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":83},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'projectId' is defined but never used.","line":42,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":89,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3480,3483],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3480,3483],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":135,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5715,5718],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5715,5718],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo } from \"react\";\r\nimport { format, addDays, isSameDay } from \"date-fns\";\r\nimport { ptBR } from \"date-fns/locale\";\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogDescription,\r\n    DialogFooter,\r\n} from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Search, CheckCircle2, LayoutGrid, TowerControl as TowerIcon, CalendarDays, Loader2, User, Check, ArrowRight, ArrowLeft } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { TowerProductionData, ProductionCategory } from \"../types\";\r\nimport { orionApi } from \"@/integrations/orion/client\";\r\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { toast } from \"sonner\";\r\nimport { useEmployees } from \"@/hooks/useEmployees\";\r\n\r\ninterface BulkScheduleModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    towers: TowerProductionData[];\r\n    categories: ProductionCategory[];\r\n    defaultStartDate?: Date;\r\n    projectId?: string;\r\n}\r\n\r\ntype Step = \"activities\" | \"towers\" | \"config\";\r\n\r\nexport default function BulkScheduleModal({\r\n    isOpen,\r\n    onClose,\r\n    towers,\r\n    categories,\r\n    defaultStartDate = new Date(),\r\n    projectId\r\n}: BulkScheduleModalProps) {\r\n    const queryClient = useQueryClient();\r\n    const { employees } = useEmployees();\r\n    const [step, setStep] = useState<Step>(\"activities\");\r\n\r\n    // Selection State\r\n    const [selectedActivityIds, setSelectedActivityIds] = useState<string[]>([]);\r\n    const [selectedTowerIds, setSelectedTowerIds] = useState<string[]>([]);\r\n    const [selectedDays, setSelectedDays] = useState<Date[]>([]);\r\n    const [selectedForemanIds, setSelectedForemanIds] = useState<string[]>([]);\r\n    const [plannedQuantity, setPlannedQuantity] = useState<string>(\"\");\r\n\r\n    // Search states\r\n    const [towerSearch, setTowerSearch] = useState(\"\");\r\n\r\n    const weekDays = useMemo(() => {\r\n        return Array.from({ length: 7 }).map((_, i) => addDays(defaultStartDate, i));\r\n    }, [defaultStartDate]);\r\n\r\n    const filteredTowers = useMemo(() => {\r\n        return towers.filter(t =>\r\n            t.objectId.toLowerCase().includes(towerSearch.toLowerCase()) ||\r\n            t.trecho?.toLowerCase().includes(towerSearch.toLowerCase())\r\n        );\r\n    }, [towers, towerSearch]);\r\n\r\n    const leaders = useMemo(() =>\r\n        employees.filter(e => e.canLeadTeam || e.professionalLevel >= 3)\r\n        , [employees]);\r\n\r\n    const saveMutation = useMutation({\r\n        mutationFn: async () => {\r\n            if (selectedActivityIds.length === 0 || selectedTowerIds.length === 0 || selectedDays.length === 0) {\r\n                throw new Error(\"Preencha todos os campos obrigatórios.\");\r\n            }\r\n\r\n            // Normalize to Noon to avoid timezone shifting\r\n            const toNoonDate = (d: Date) => {\r\n                const copy = new Date(d);\r\n                copy.setHours(12, 0, 0, 0);\r\n                return copy;\r\n            };\r\n\r\n            const startDate = toNoonDate(selectedDays.sort((a, b) => a.getTime() - b.getTime())[0]);\r\n            const endDate = toNoonDate(selectedDays.sort((a, b) => a.getTime() - b.getTime())[selectedDays.length - 1]);\r\n\r\n            const promises: Promise<any>[] = [];\r\n\r\n            selectedTowerIds.forEach(towerId => {\r\n                const tower = towers.find(t => t.id === towerId);\r\n                selectedActivityIds.forEach(activityId => {\r\n                    // CRITICAL: Block scheduling for activities already finished\r\n                    const isFinished = tower?.activityStatuses?.some(s => s.activityId === activityId && s.status === 'FINISHED');\r\n                    if (isFinished) return;\r\n\r\n                    // Update Schedule\r\n                    promises.push(orionApi.post(\"/production/schedule\", {\r\n                        towerId,\r\n                        activityId,\r\n                        plannedStart: startDate.toISOString(),\r\n                        plannedEnd: endDate.toISOString(),\r\n                        plannedQuantity: plannedQuantity ? parseFloat(plannedQuantity) : null\r\n                    }));\r\n\r\n                    // Update foreman if selected (using the first one for status metadata for now)\r\n                    if (selectedForemanIds.length > 0) {\r\n                        const foremanName = employees.find(e => e.id === selectedForemanIds[0])?.fullName;\r\n                        promises.push(orionApi.post(\"/production/tower-status\", {\r\n                            towerId,\r\n                            activityId,\r\n                            foremanName,\r\n                            metadata: {\r\n                                leadName: foremanName,\r\n                                additionalLeads: selectedForemanIds.slice(1).map(id => employees.find(e => e.id === id)?.fullName)\r\n                            }\r\n                        }));\r\n                    }\r\n                });\r\n            });\r\n\r\n            await Promise.all(promises);\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"production-towers\"] });\r\n            toast.success(`${selectedTowerIds.length * selectedActivityIds.length} agendamentos criados com sucesso!`);\r\n            onClose();\r\n            // Reset wizard\r\n            setStep(\"activities\");\r\n            setSelectedActivityIds([]);\r\n            setSelectedTowerIds([]);\r\n            setSelectedDays([]);\r\n        },\r\n        onError: (err: any) => {\r\n            toast.error(err.message || \"Erro ao salvar programação em lote.\");\r\n        }\r\n    });\r\n\r\n    const toggleDay = (day: Date) => {\r\n        const exists = selectedDays.find(d => isSameDay(d, day));\r\n        if (exists) {\r\n            setSelectedDays(selectedDays.filter(d => !isSameDay(d, day)));\r\n        } else {\r\n            setSelectedDays([...selectedDays, day]);\r\n        }\r\n    };\r\n\r\n    const selectAllWeek = () => {\r\n        setSelectedDays(weekDays);\r\n    };\r\n\r\n    const getTowerStatusColor = (tower: TowerProductionData) => {\r\n        const overallStatus = tower.overallStatus || 'PENDING';\r\n        switch (overallStatus) {\r\n            case 'FINISHED': return 'bg-emerald-500';\r\n            case 'IN_PROGRESS': return 'bg-amber-500';\r\n            default: return 'bg-slate-700';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={onClose}>\r\n            <DialogContent className=\"sm:max-w-[700px] bg-slate-950 border-amber-500/20 text-slate-100 p-0 overflow-hidden shadow-2xl flex flex-col max-h-[90vh]\">\r\n                <div className=\"bg-amber-500/10 p-6 border-b border-amber-500/10 flex items-center justify-between shrink-0\">\r\n                    <div>\r\n                        <DialogTitle className=\"flex items-center gap-3 text-lg font-black text-amber-500 uppercase tracking-widest\">\r\n                            <LayoutGrid className=\"w-5 h-5\" />\r\n                            Programação em Lote\r\n                        </DialogTitle>\r\n                        <DialogDescription className=\"text-xs text-slate-400 font-bold uppercase tracking-wider mt-1\">\r\n                            Agendamento massivo para a {format(defaultStartDate, \"'Semana de' dd/MM\", { locale: ptBR })}\r\n                        </DialogDescription>\r\n                    </div>\r\n                    {/* Progress Steps Indicator */}\r\n                    <div className=\"flex items-center gap-2\">\r\n                        {[1, 2, 3].map(s => (\r\n                            <div key={s} className={cn(\r\n                                \"w-2.5 h-2.5 rounded-full transition-all duration-300\",\r\n                                (s === 1 && step === \"activities\") || (s === 2 && step === \"towers\") || (s === 3 && step === \"config\") ? \"bg-amber-500 w-8\" :\r\n                                    (s === 1 && (step === \"towers\" || step === \"config\")) || (s === 2 && step === \"config\") ? \"bg-emerald-500/50\" : \"bg-white/10\"\r\n                            )} />\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex-1 overflow-hidden flex flex-col\">\r\n                    {/* Step Content */}\r\n                    <div className=\"p-6 flex-1 overflow-hidden flex flex-col\">\r\n                        {step === \"activities\" && (\r\n                            <div className=\"space-y-4 flex-1 flex flex-col overflow-hidden\">\r\n                                <div className=\"flex items-center justify-between shrink-0\">\r\n                                    <h4 className=\"text-[10px] font-black uppercase text-slate-500 tracking-widest\">Etapa 1: Selecionar Atividades</h4>\r\n                                    <span className=\"text-[10px] font-bold text-amber-500\">{selectedActivityIds.length} selecionadas</span>\r\n                                </div>\r\n                                <ScrollArea className=\"flex-1 pr-4\">\r\n                                    <div className=\"grid grid-cols-2 gap-3\">\r\n                                        {categories.map(cat => (\r\n                                            <div key={cat.id} className=\"space-y-3 p-4 rounded-xl bg-white/5 border border-white/5\">\r\n                                                <h5 className=\"text-[10px] font-black text-slate-400 uppercase tracking-tighter border-b border-white/5 pb-2 mb-2\">{cat.name}</h5>\r\n                                                {cat.activities.map(act => (\r\n                                                    <div key={act.id} className=\"flex items-center space-x-3 group cursor-pointer\" onClick={() => {\r\n                                                        if (selectedActivityIds.includes(act.id)) {\r\n                                                            setSelectedActivityIds(selectedActivityIds.filter(id => id !== act.id));\r\n                                                        } else {\r\n                                                            setSelectedActivityIds([...selectedActivityIds, act.id]);\r\n                                                        }\r\n                                                    }}>\r\n                                                        <Checkbox\r\n                                                            id={act.id}\r\n                                                            checked={selectedActivityIds.includes(act.id)}\r\n                                                            className=\"data-[state=checked]:bg-amber-500 border-white/10\"\r\n                                                        />\r\n                                                        <label htmlFor={act.id} className=\"text-xs font-bold text-slate-200 group-hover:text-amber-500 transition-colors cursor-pointer uppercase\">{act.name}</label>\r\n                                                    </div>\r\n                                                ))}\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                </ScrollArea>\r\n                            </div>\r\n                        )}\r\n\r\n                        {step === \"towers\" && (\r\n                            <div className=\"space-y-4 flex-1 flex flex-col overflow-hidden animate-in slide-in-from-right-4 duration-300\">\r\n                                <div className=\"space-y-3 shrink-0\">\r\n                                    <div className=\"flex items-center justify-between\">\r\n                                        <h4 className=\"text-[10px] font-black uppercase text-slate-500 tracking-widest\">Etapa 2: Selecionar Estruturas</h4>\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <Button variant=\"link\" className=\"text-[9px] font-bold text-slate-400 uppercase\" onClick={() => setSelectedTowerIds(towers.map(t => t.id))}>Selecionar Tudo</Button>\r\n                                            <span className=\"text-[10px] font-bold text-amber-500\">{selectedTowerIds.length} selecionadas</span>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"relative\">\r\n                                        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500\" />\r\n                                        <Input\r\n                                            placeholder=\"Buscar por torre ou trecho...\"\r\n                                            className=\"pl-10 bg-slate-900 border-white/5 text-xs h-10 uppercase font-bold\"\r\n                                            value={towerSearch}\r\n                                            onChange={e => setTowerSearch(e.target.value)}\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                                <ScrollArea className=\"flex-1 h-[400px] pr-4\">\r\n                                    <div className=\"grid grid-cols-3 gap-2 pb-4\">\r\n                                        {filteredTowers.map(tower => {\r\n                                            const finishedCount = selectedActivityIds.filter(actId =>\r\n                                                tower.activityStatuses?.find(s => s.activityId === actId && s.status === 'FINISHED')\r\n                                            ).length;\r\n\r\n                                            const isAllFinished = finishedCount === selectedActivityIds.length;\r\n                                            const isSomeFinished = finishedCount > 0 && finishedCount < selectedActivityIds.length;\r\n\r\n                                            return (\r\n                                                <div\r\n                                                    key={tower.id}\r\n                                                    className={cn(\r\n                                                        \"p-3 rounded-lg border flex flex-col gap-1.5 transition-all cursor-pointer group relative overflow-hidden\",\r\n                                                        selectedTowerIds.includes(tower.id)\r\n                                                            ? \"bg-amber-500/10 border-amber-500/40 shadow-glow-sm\"\r\n                                                            : \"bg-white/5 border-white/5 hover:border-white/20\",\r\n                                                        isAllFinished && \"opacity-40 cursor-not-allowed grayscale bg-slate-900\"\r\n                                                    )}\r\n                                                    onClick={() => {\r\n                                                        if (isAllFinished) return;\r\n                                                        if (selectedTowerIds.includes(tower.id)) {\r\n                                                            setSelectedTowerIds(selectedTowerIds.filter(id => id !== tower.id));\r\n                                                        } else {\r\n                                                            setSelectedTowerIds([...selectedTowerIds, tower.id]);\r\n                                                        }\r\n                                                    }}\r\n                                                >\r\n                                                    <div className=\"flex items-center justify-between\">\r\n                                                        <div className=\"flex items-center gap-2\">\r\n                                                            <div className={cn(\"w-2 h-2 rounded-full\", getTowerStatusColor(tower))} />\r\n                                                            <span className=\"text-xs font-black uppercase tracking-tighter text-slate-100\">{tower.objectId}</span>\r\n                                                        </div>\r\n                                                        {isAllFinished ? (\r\n                                                            <CheckCircle2 className=\"w-3 h-3 text-emerald-500\" />\r\n                                                        ) : selectedTowerIds.includes(tower.id) && (\r\n                                                            <CheckCircle2 className=\"w-3 h-3 text-amber-500\" />\r\n                                                        )}\r\n                                                    </div>\r\n                                                    <div className=\"flex flex-col\">\r\n                                                        <span className=\"text-[9px] font-bold text-slate-500 uppercase truncate\">\r\n                                                            ({tower.towerType || 'N/A'})\r\n                                                        </span>\r\n                                                        <span className={cn(\r\n                                                            \"text-[8px] font-bold uppercase tracking-widest mt-0.5 truncate border-t border-white/5 pt-1\",\r\n                                                            isAllFinished ? \"text-emerald-500\" : isSomeFinished ? \"text-amber-500\" : \"text-slate-600\"\r\n                                                        )}>\r\n                                                            {isAllFinished ? 'JÁ CONCLUÍDA' : isSomeFinished ? 'PARCIAL CONCLUÍDA' : (tower.trecho || 'Sem trecho')}\r\n                                                        </span>\r\n                                                    </div>\r\n                                                </div>\r\n                                            );\r\n                                        })}\r\n                                    </div>\r\n                                </ScrollArea>\r\n                            </div>\r\n                        )}\r\n\r\n                        {step === \"config\" && (\r\n                            <div className=\"space-y-6 flex-1 flex flex-col overflow-hidden animate-in slide-in-from-right-4 duration-300\">\r\n                                <h4 className=\"text-[10px] font-black uppercase text-slate-500 tracking-widest shrink-0\">Etapa 3: Configurar Programação</h4>\r\n\r\n                                <div className=\"grid grid-cols-2 gap-8 flex-1 overflow-hidden\">\r\n                                    {/* Days Selection */}\r\n                                    <div className=\"space-y-4 flex flex-col overflow-hidden\">\r\n                                        <div className=\"flex items-center justify-between\">\r\n                                            <Label className=\"text-[10px] font-black uppercase text-amber-500/70 tracking-widest\">Calendário de Execução</Label>\r\n                                            <Button variant=\"link\" className=\"text-[9px] font-bold text-slate-400 h-auto p-0 uppercase\" onClick={selectAllWeek}>Semana Toda</Button>\r\n                                        </div>\r\n                                        <div className=\"grid grid-cols-2 gap-2\">\r\n                                            {weekDays.map((day, i) => {\r\n                                                const isSelected = selectedDays.some(d => isSameDay(d, day));\r\n                                                return (\r\n                                                    <button\r\n                                                        key={i}\r\n                                                        onClick={() => toggleDay(day)}\r\n                                                        className={cn(\r\n                                                            \"p-3 rounded-lg border text-left flex flex-col gap-0.5 transition-all\",\r\n                                                            isSelected ? \"bg-amber-500 border-amber-500 text-black shadow-lg\" : \"bg-white/5 border-white/5 text-slate-400 hover:bg-white/10\"\r\n                                                        )}\r\n                                                    >\r\n                                                        <span className=\"text-[8px] font-black uppercase\">{format(day, 'EEEE', { locale: ptBR })}</span>\r\n                                                        <span className=\"text-xs font-black\">{format(day, 'dd/MM')}</span>\r\n                                                    </button>\r\n                                                );\r\n                                            })}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Foremen Selection */}\r\n                                    <div className=\"space-y-4 flex flex-col overflow-hidden\">\r\n                                        <Label className=\"text-[10px] font-black uppercase text-amber-500/70 tracking-widest leading-none\">Encarregados (Multi-seleção)</Label>\r\n                                        <ScrollArea className=\"flex-1 pr-4 bg-white/5 rounded-xl border border-white/5 p-2\">\r\n                                            <div className=\"space-y-1\">\r\n                                                {leaders.map(lead => (\r\n                                                    <div\r\n                                                        key={lead.id}\r\n                                                        className={cn(\r\n                                                            \"flex items-center gap-3 p-2.5 rounded-lg cursor-pointer transition-colors group\",\r\n                                                            selectedForemanIds.includes(lead.id) ? \"bg-amber-500/20 border border-amber-500/30\" : \"hover:bg-white/5\"\r\n                                                        )}\r\n                                                        onClick={() => {\r\n                                                            if (selectedForemanIds.includes(lead.id)) {\r\n                                                                setSelectedForemanIds(selectedForemanIds.filter(id => id !== lead.id));\r\n                                                            } else {\r\n                                                                setSelectedForemanIds([...selectedForemanIds, lead.id]);\r\n                                                            }\r\n                                                        }}\r\n                                                    >\r\n                                                        <div className=\"w-5 h-5 rounded-full bg-amber-500/10 flex items-center justify-center shrink-0\">\r\n                                                            <User className=\"w-3 h-3 text-amber-500\" />\r\n                                                        </div>\r\n                                                        <div className=\"flex flex-col flex-1 overflow-hidden\">\r\n                                                            <span className=\"text-[10px] font-black uppercase text-slate-200 truncate\">{lead.fullName}</span>\r\n                                                            <span className=\"text-[8px] font-bold text-slate-500 uppercase\">{lead.functionName || 'Encarregado'}</span>\r\n                                                        </div>\r\n                                                        {selectedForemanIds.includes(lead.id) && <Check className=\"w-3 h-3 text-amber-500\" />}\r\n                                                    </div>\r\n                                                ))}\r\n                                            </div>\r\n                                        </ScrollArea>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Common Meta */}\r\n                                <div className=\"grid grid-cols-2 gap-4 pt-4 border-t border-white/5 shrink-0\">\r\n                                    <div className=\"space-y-2\">\r\n                                        <Label className=\"text-[10px] font-black uppercase text-slate-500 tracking-widest\">Qtd. Planejada (Padrão)</Label>\r\n                                        <Input\r\n                                            type=\"number\"\r\n                                            placeholder=\"Ex: 1\"\r\n                                            className=\"h-10 bg-slate-900 border-white/5 text-xs font-black font-mono focus:border-amber-500/50\"\r\n                                            value={plannedQuantity}\r\n                                            onChange={e => setPlannedQuantity(e.target.value)}\r\n                                        />\r\n                                    </div>\r\n                                    <div className=\"flex items-end justify-end\">\r\n                                        <div className=\"text-right p-3 rounded-lg bg-emerald-500/5 border border-emerald-500/10\">\r\n                                            <span className=\"block text-[8px] font-black text-slate-500 uppercase\">Resumo da Execução</span>\r\n                                            <span className=\"text-[11px] font-black text-emerald-500 uppercase tracking-tighter\">\r\n                                                {selectedTowerIds.length} torres x {selectedActivityIds.length} atividades\r\n                                            </span>\r\n                                            <div className=\"text-[10px] font-bold text-slate-400\">Total: {selectedTowerIds.length * selectedActivityIds.length} Programações</div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                <DialogFooter className=\"bg-slate-900/40 p-6 flex items-center justify-between border-t border-white/5 shrink-0\">\r\n                    <Button\r\n                        variant=\"ghost\"\r\n                        size=\"sm\"\r\n                        className=\"text-slate-500 hover:text-white font-bold h-10 px-6 uppercase text-[10px]\"\r\n                        onClick={() => {\r\n                            if (step === \"activities\") onClose();\r\n                            if (step === \"towers\") setStep(\"activities\");\r\n                            if (step === \"config\") setStep(\"towers\");\r\n                        }}\r\n                    >\r\n                        {step === \"activities\" ? \"Cancelar\" : (\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <ArrowLeft className=\"w-3 h-3\" />\r\n                                Voltar\r\n                            </div>\r\n                        )}\r\n                    </Button>\r\n\r\n                    <Button\r\n                        size=\"sm\"\r\n                        disabled={\r\n                            (step === \"activities\" && selectedActivityIds.length === 0) ||\r\n                            (step === \"towers\" && selectedTowerIds.length === 0) ||\r\n                            saveMutation.isPending\r\n                        }\r\n                        onClick={() => {\r\n                            if (step === \"activities\") setStep(\"towers\");\r\n                            else if (step === \"towers\") setStep(\"config\");\r\n                            else saveMutation.mutate();\r\n                        }}\r\n                        className={cn(\r\n                            \"font-black px-10 h-10 text-[10px] uppercase tracking-widest transition-all\",\r\n                            step === \"config\" ? \"bg-emerald-600 hover:bg-emerald-500 text-white shadow-glow\" : \"bg-amber-600 hover:bg-amber-500 text-black shadow-glow\"\r\n                        )}\r\n                    >\r\n                        {saveMutation.isPending ? (\r\n                            <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n                        ) : step === \"config\" ? (\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <Check className=\"w-3.5 h-3.5\" />\r\n                                Finalizar e Agendar\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"flex items-center gap-2\">\r\n                                Próximo\r\n                                <ArrowRight className=\"w-3.5 h-3.5\" />\r\n                            </div>\r\n                        )}\r\n                    </Button>\r\n                </DialogFooter>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\production\\components\\CostConfigurationModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'formatCurrency' is assigned a value but never used.","line":39,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":119,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4613,4616],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4613,4616],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":186,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":186,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":200,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7452,7455],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7452,7455],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState, useCallback } from \"react\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { orionApi } from \"@/integrations/orion/client\";\r\nimport { kpiService } from \"@/services/kpiService\";\r\nimport { ProductionCategory } from \"../types\";\r\nimport { toast } from \"sonner\";\r\nimport { DollarSign, Save, AlertCircle } from \"lucide-react\";\r\n\r\n// Common measurement units for construction activities\r\nconst UNIT_OPTIONS = [\r\n    { value: 'UN', label: 'UN (Unidade)' },\r\n    { value: 'M³', label: 'M³ (Metro Cúbico)' },\r\n    { value: 'M²', label: 'M² (Metro Quadrado)' },\r\n    { value: 'M', label: 'M (Metro Linear)' },\r\n    { value: 'KG', label: 'KG (Quilograma)' },\r\n    { value: 'TON', label: 'TON (Tonelada)' },\r\n    { value: 'L', label: 'L (Litro)' },\r\n    { value: 'VB', label: 'VB (Verba)' },\r\n    { value: 'CJ', label: 'CJ (Conjunto)' },\r\n    { value: 'PC', label: 'PC (Peça)' },\r\n    { value: 'HR', label: 'HR (Hora)' },\r\n    { value: 'DIA', label: 'DIA (Diária)' },\r\n    { value: 'KM', label: 'KM (Quilômetro)' },\r\n    { value: 'HA', label: 'HA (Hectare)' },\r\n];\r\n\r\ninterface CostConfigurationModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    projectId: string;\r\n}\r\n\r\n// Utility: Format number to Brazilian currency string (display only)\r\nconst formatCurrency = (value: number): string => {\r\n    return new Intl.NumberFormat('pt-BR', {\r\n        style: 'currency',\r\n        currency: 'BRL',\r\n        minimumFractionDigits: 2,\r\n        maximumFractionDigits: 2\r\n    }).format(value);\r\n};\r\n\r\n// Utility: Format number to Brazilian locale (without currency symbol)\r\nconst formatNumber = (value: number): string => {\r\n    return new Intl.NumberFormat('pt-BR', {\r\n        minimumFractionDigits: 2,\r\n        maximumFractionDigits: 2\r\n    }).format(value);\r\n};\r\n\r\n// Utility: Parse Brazilian currency string to number\r\nconst parseCurrencyInput = (value: string): number => {\r\n    // Remove currency symbol, spaces, and replace Brazilian decimal separator\r\n    const cleaned = value\r\n        .replace(/[R$\\s]/g, '')\r\n        .replace(/\\./g, '') // Remove thousand separators\r\n        .replace(',', '.'); // Convert decimal separator\r\n\r\n    const parsed = parseFloat(cleaned);\r\n    return isNaN(parsed) ? 0 : parsed;\r\n};\r\n\r\n// Utility: Format input as user types (Brazilian format)\r\nconst formatInputAsCurrency = (value: string): string => {\r\n    // Remove non-numeric characters except comma\r\n    let cleaned = value.replace(/[^\\d,]/g, '');\r\n\r\n    // Ensure only one comma\r\n    const parts = cleaned.split(',');\r\n    if (parts.length > 2) {\r\n        cleaned = parts[0] + ',' + parts.slice(1).join('');\r\n    }\r\n\r\n    // Limit decimal places to 2\r\n    if (parts.length === 2 && parts[1].length > 2) {\r\n        cleaned = parts[0] + ',' + parts[1].substring(0, 2);\r\n    }\r\n\r\n    // Add thousand separators to integer part\r\n    if (parts[0]) {\r\n        const intPart = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, '.');\r\n        cleaned = parts.length === 2 ? intPart + ',' + parts[1] : intPart;\r\n    }\r\n\r\n    return cleaned;\r\n};\r\n\r\nexport default function CostConfigurationModal({ isOpen, onClose, projectId }: CostConfigurationModalProps) {\r\n    const queryClient = useQueryClient();\r\n    const [localCosts, setLocalCosts] = useState<Record<string, { displayPrice: string, unit: string }>>({});\r\n    const [errors, setErrors] = useState<Record<string, string>>({});\r\n\r\n    // Fetch Categories (Activities)\r\n    const { data: categories } = useQuery({\r\n        queryKey: [\"production-categories\"],\r\n        queryFn: async () => {\r\n            const res = await orionApi.get(\"/production/categories\");\r\n            return res.data as ProductionCategory[];\r\n        },\r\n        enabled: isOpen\r\n    });\r\n\r\n    // Fetch Existing Costs\r\n    const { data: existingCosts } = useQuery({\r\n        queryKey: [\"unit-costs\", projectId],\r\n        queryFn: () => kpiService.getUnitCosts(projectId),\r\n        enabled: isOpen && !!projectId\r\n    });\r\n\r\n    // Initialize state with formatted values\r\n    useEffect(() => {\r\n        if (existingCosts && existingCosts.length > 0) {\r\n            const map: Record<string, { displayPrice: string, unit: string }> = {};\r\n            existingCosts.forEach((c: any) => {\r\n                const numValue = Number(c.unitPrice);\r\n                map[c.activityId] = {\r\n                    displayPrice: formatNumber(numValue),\r\n                    unit: c.measureUnit\r\n                };\r\n            });\r\n            setLocalCosts(map);\r\n        }\r\n    }, [existingCosts]);\r\n\r\n    const handlePriceChange = useCallback((activityId: string, rawValue: string) => {\r\n        const formatted = formatInputAsCurrency(rawValue);\r\n\r\n        setLocalCosts(prev => ({\r\n            ...prev,\r\n            [activityId]: {\r\n                ...prev[activityId] || { displayPrice: '0,00', unit: 'UN' },\r\n                displayPrice: formatted\r\n            }\r\n        }));\r\n\r\n        // Clear error if value is valid\r\n        const numValue = parseCurrencyInput(formatted);\r\n        if (numValue >= 0) {\r\n            setErrors(prev => {\r\n                const newErrors = { ...prev };\r\n                delete newErrors[activityId];\r\n                return newErrors;\r\n            });\r\n        }\r\n    }, []);\r\n\r\n    const handleUnitChange = useCallback((activityId: string, value: string) => {\r\n        setLocalCosts(prev => ({\r\n            ...prev,\r\n            [activityId]: {\r\n                ...prev[activityId] || { displayPrice: '0,00', unit: 'UN' },\r\n                unit: value.toUpperCase()\r\n            }\r\n        }));\r\n    }, []);\r\n\r\n    const validateForm = (): boolean => {\r\n        const newErrors: Record<string, string> = {};\r\n\r\n        Object.entries(localCosts).forEach(([activityId, data]) => {\r\n            const numValue = parseCurrencyInput(data.displayPrice);\r\n            if (numValue < 0) {\r\n                newErrors[activityId] = 'Valor inválido';\r\n            }\r\n            if (!data.unit || data.unit.trim() === '') {\r\n                newErrors[activityId] = 'Unidade obrigatória';\r\n            }\r\n        });\r\n\r\n        setErrors(newErrors);\r\n        return Object.keys(newErrors).length === 0;\r\n    };\r\n\r\n    const mutation = useMutation({\r\n        mutationFn: async () => {\r\n            if (!validateForm()) {\r\n                throw new Error('Validação falhou');\r\n            }\r\n\r\n            const costsToSave = Object.entries(localCosts)\r\n                .filter(([_, data]) => parseCurrencyInput(data.displayPrice) > 0)\r\n                .map(([activityId, data]) => ({\r\n                    activityId,\r\n                    unitPrice: parseCurrencyInput(data.displayPrice),\r\n                    measureUnit: data.unit.toUpperCase().trim()\r\n                }));\r\n\r\n            await kpiService.saveUnitCosts(projectId, costsToSave);\r\n        },\r\n        onSuccess: () => {\r\n            toast.success(\"Custos atualizados com sucesso!\");\r\n            queryClient.invalidateQueries({ queryKey: [\"unit-costs\", projectId] });\r\n            onClose();\r\n        },\r\n        onError: (error: any) => {\r\n            if (error.message !== 'Validação falhou') {\r\n                toast.error(\"Erro ao salvar custos.\");\r\n            }\r\n        }\r\n    });\r\n\r\n    const getTotalConfigured = () => {\r\n        return Object.values(localCosts).filter(c => parseCurrencyInput(c.displayPrice) > 0).length;\r\n    };\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={onClose}>\r\n            <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col bg-slate-950 border-slate-800 text-slate-100\">\r\n                <DialogHeader className=\"border-b border-slate-800 pb-4\">\r\n                    <DialogTitle className=\"flex items-center gap-2 text-xl font-bold text-amber-500\">\r\n                        <DollarSign className=\"h-6 w-6\" />\r\n                        Configuração de Custos Unitários\r\n                    </DialogTitle>\r\n                    <p className=\"text-xs text-slate-500 mt-1\">\r\n                        Defina o preço por unidade para cada atividade. Use formato brasileiro (ex: 1.500,00)\r\n                    </p>\r\n                </DialogHeader>\r\n\r\n                <div className=\"flex-1 overflow-y-auto p-4 space-y-6\">\r\n                    {categories?.map((category) => (\r\n                        <div key={category.id} className=\"space-y-3\">\r\n                            <h3 className=\"text-sm font-black uppercase tracking-widest text-slate-400 border-b border-slate-800 pb-1 flex items-center gap-2\">\r\n                                <span className=\"w-2 h-2 bg-amber-500 rounded-full\"></span>\r\n                                {category.name}\r\n                            </h3>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                                {category.activities.map((activity) => {\r\n                                    const cost = localCosts[activity.id] || { displayPrice: '0,00', unit: 'UN' };\r\n                                    const hasError = !!errors[activity.id];\r\n\r\n                                    return (\r\n                                        <div\r\n                                            key={activity.id}\r\n                                            className={`bg-slate-900/50 p-3 rounded-lg border transition-colors ${hasError\r\n                                                ? 'border-rose-500/50 bg-rose-950/20'\r\n                                                : parseCurrencyInput(cost.displayPrice) > 0\r\n                                                    ? 'border-emerald-500/30 bg-emerald-950/10'\r\n                                                    : 'border-slate-800 hover:border-amber-500/30'\r\n                                                }`}\r\n                                        >\r\n                                            <Label\r\n                                                className=\"text-xs font-bold text-slate-300 mb-2 block truncate\"\r\n                                                title={activity.name}\r\n                                            >\r\n                                                {activity.name}\r\n                                            </Label>\r\n                                            <div className=\"flex gap-2\">\r\n                                                <div className=\"relative flex-1\">\r\n                                                    <span className=\"absolute left-2 top-1/2 -translate-y-1/2 text-xs text-amber-500 font-bold\">R$</span>\r\n                                                    <Input\r\n                                                        type=\"text\"\r\n                                                        inputMode=\"decimal\"\r\n                                                        className={`pl-8 h-9 text-sm bg-black/40 border-slate-700 text-right font-mono ${hasError ? 'border-rose-500 focus:ring-rose-500' : ''\r\n                                                            }`}\r\n                                                        value={cost.displayPrice}\r\n                                                        onChange={(e) => handlePriceChange(activity.id, e.target.value)}\r\n                                                        placeholder=\"0,00\"\r\n                                                    />\r\n                                                </div>\r\n                                                <div className=\"w-24\">\r\n                                                    <Select\r\n                                                        value={cost.unit}\r\n                                                        onValueChange={(value) => handleUnitChange(activity.id, value)}\r\n                                                    >\r\n                                                        <SelectTrigger className=\"h-9 text-xs bg-black/40 border-slate-700 uppercase font-bold\">\r\n                                                            <SelectValue placeholder=\"UN\" />\r\n                                                        </SelectTrigger>\r\n                                                        <SelectContent className=\"max-h-[200px]\">\r\n                                                            {UNIT_OPTIONS.map(opt => (\r\n                                                                <SelectItem\r\n                                                                    key={opt.value}\r\n                                                                    value={opt.value}\r\n                                                                    className=\"text-xs\"\r\n                                                                >\r\n                                                                    {opt.label}\r\n                                                                </SelectItem>\r\n                                                            ))}\r\n                                                        </SelectContent>\r\n                                                    </Select>\r\n                                                </div>\r\n                                            </div>\r\n                                            {hasError && (\r\n                                                <p className=\"text-[10px] text-rose-400 mt-1 flex items-center gap-1\">\r\n                                                    <AlertCircle className=\"h-3 w-3\" />\r\n                                                    {errors[activity.id]}\r\n                                                </p>\r\n                                            )}\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n\r\n                <DialogFooter className=\"border-t border-slate-800 pt-4 flex items-center justify-between\">\r\n                    <span className=\"text-xs text-slate-500\">\r\n                        {getTotalConfigured()} atividades com custo definido\r\n                    </span>\r\n                    <div className=\"flex gap-2\">\r\n                        <Button variant=\"outline\" onClick={onClose} className=\"border-slate-700 hover:bg-slate-800\">\r\n                            Cancelar\r\n                        </Button>\r\n                        <Button\r\n                            onClick={() => mutation.mutate()}\r\n                            disabled={mutation.isPending}\r\n                            className=\"bg-amber-600 hover:bg-amber-700 text-white font-bold\"\r\n                        >\r\n                            <Save className=\"h-4 w-4 mr-2\" />\r\n                            {mutation.isPending ? \"Salvando...\" : \"Salvar Configurações\"}\r\n                        </Button>\r\n                    </div>\r\n                </DialogFooter>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\production\\components\\DelayCostModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2519,2522],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2519,2522],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from \"react\";\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogDescription,\r\n    DialogFooter,\r\n} from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { toast } from \"sonner\";\r\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\r\nimport { orionApi } from \"@/integrations/orion/client\";\r\nimport { Loader2, DollarSign, Plus, Trash2, AlertCircle } from \"lucide-react\";\r\nimport { ImpedimentType } from \"../types\";\r\n\r\ninterface DelayCostModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    projectId: string;\r\n}\r\n\r\ninterface DelayReason {\r\n    id: string;\r\n    code: string;\r\n    description: string;\r\n    dailyCost: number;\r\n    category: ImpedimentType;\r\n}\r\n\r\nconst DelayCostModal = ({ isOpen, onClose, projectId }: DelayCostModalProps) => {\r\n    const queryClient = useQueryClient();\r\n    const [code, setCode] = useState(\"\");\r\n    const [description, setDescription] = useState(\"\");\r\n    const [dailyCost, setDailyCost] = useState(\"\");\r\n    const [category, setCategory] = useState<ImpedimentType>(\"NONE\");\r\n\r\n    const { data: reasons = [], isLoading } = useQuery({\r\n        queryKey: [\"delay-reasons\", projectId],\r\n        queryFn: async () => {\r\n            if (!projectId || projectId === 'all') return [];\r\n            const response = await orionApi.get(`/production/delay-reasons?projectId=${projectId}`);\r\n            return response.data as DelayReason[];\r\n        },\r\n        enabled: isOpen && projectId !== 'all'\r\n    });\r\n\r\n    const createMutation = useMutation({\r\n        mutationFn: async () => {\r\n            if (!code || !description || !dailyCost) throw new Error(\"Preencha todos os campos\");\r\n\r\n            await orionApi.post(`/production/delay-reasons?projectId=${projectId}`, {\r\n                code,\r\n                description,\r\n                dailyCost: parseFloat(dailyCost),\r\n                category\r\n            });\r\n        },\r\n        onSuccess: () => {\r\n            toast.success(\"Motivo adicionado\");\r\n            queryClient.invalidateQueries({ queryKey: [\"delay-reasons\"] });\r\n            setCode(\"\");\r\n            setDescription(\"\");\r\n            setDailyCost(\"\");\r\n            setCategory(\"NONE\");\r\n        },\r\n        onError: (err: any) => toast.error(\"Erro ao adicionar: \" + err.message)\r\n    });\r\n\r\n    const deleteMutation = useMutation({\r\n        mutationFn: async (id: string) => {\r\n            await orionApi.delete(`/production/delay-reasons?id=${id}`);\r\n        },\r\n        onSuccess: () => {\r\n            toast.success(\"Motivo removido\");\r\n            queryClient.invalidateQueries({ queryKey: [\"delay-reasons\"] });\r\n        }\r\n    });\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={onClose}>\r\n            <DialogContent className=\"sm:max-w-[700px] bg-[#0a0806] border-white/10 text-white\">\r\n                <DialogHeader>\r\n                    <DialogTitle className=\"flex items-center gap-2 text-xl font-bold text-amber-500\">\r\n                        <DollarSign className=\"h-5 w-5\" />\r\n                        Catálogo de Custos de Atraso\r\n                    </DialogTitle>\r\n                    <DialogDescription className=\"text-white/50\">\r\n                        Cadastre os motivos de impedimento e seus respectivos custos diários para esta obra.\r\n                    </DialogDescription>\r\n                </DialogHeader>\r\n\r\n                <div className=\"grid gap-6 py-4\">\r\n                    {/* Form de Cadastro */}\r\n                    <div className=\"grid grid-cols-12 gap-3 p-3 rounded-lg bg-white/5 border border-white/10 items-end\">\r\n                        <div className=\"col-span-2\">\r\n                            <Label className=\"text-[10px] uppercase font-bold text-amber-500/80\">Código</Label>\r\n                            <Input value={code} onChange={e => setCode(e.target.value)} placeholder=\"Ex: CHUVA\" className=\"h-8 bg-black/40 border-white/10 text-xs\" />\r\n                        </div>\r\n                        <div className=\"col-span-4\">\r\n                            <Label className=\"text-[10px] uppercase font-bold text-amber-500/80\">Descrição</Label>\r\n                            <Input value={description} onChange={e => setDescription(e.target.value)} placeholder=\"Descrição detalhada\" className=\"h-8 bg-black/40 border-white/10 text-xs\" />\r\n                        </div>\r\n                        <div className=\"col-span-2\">\r\n                            <Label className=\"text-[10px] uppercase font-bold text-amber-500/80\">Categoria</Label>\r\n                            <Select value={category} onValueChange={(v: ImpedimentType) => setCategory(v)}>\r\n                                <SelectTrigger className=\"h-8 bg-black/40 border-white/10 text-xs\"><SelectValue /></SelectTrigger>\r\n                                <SelectContent className=\"bg-slate-900 border-slate-800\">\r\n                                    <SelectItem value=\"NONE\">Nenhum</SelectItem>\r\n                                    <SelectItem value=\"OWNER\">Proprietário</SelectItem>\r\n                                    <SelectItem value=\"CONTRACTOR\">Empreiteira</SelectItem>\r\n                                    <SelectItem value=\"PROJECT\">Projeto</SelectItem>\r\n                                    <SelectItem value=\"WORK\">Obra/Clima</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                        <div className=\"col-span-2\">\r\n                            <Label className=\"text-[10px] uppercase font-bold text-amber-500/80\">Custo/Dia (R$)</Label>\r\n                            <Input type=\"number\" value={dailyCost} onChange={e => setDailyCost(e.target.value)} placeholder=\"0.00\" className=\"h-8 bg-black/40 border-white/10 text-xs\" />\r\n                        </div>\r\n                        <div className=\"col-span-2\">\r\n                            <Button size=\"sm\" onClick={() => createMutation.mutate()} disabled={createMutation.isPending} className=\"w-full h-8 bg-amber-600 hover:bg-amber-500 font-bold text-xs\">\r\n                                <Plus className=\"h-3 w-3 mr-1\" /> Adicionar\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Lista */}\r\n                    <div className=\"border border-white/10 rounded-lg overflow-hidden\">\r\n                        <div className=\"grid grid-cols-12 bg-white/5 p-2 text-[10px] font-bold uppercase text-white/50 border-b border-white/10\">\r\n                            <div className=\"col-span-2\">Código</div>\r\n                            <div className=\"col-span-4\">Descrição</div>\r\n                            <div className=\"col-span-2\">Categoria</div>\r\n                            <div className=\"col-span-2 text-right\">Custo Diário</div>\r\n                            <div className=\"col-span-2 text-center\">Ações</div>\r\n                        </div>\r\n                        <div className=\"max-h-[300px] overflow-y-auto\">\r\n                            {isLoading ? (\r\n                                <div className=\"p-4 text-center text-white/30\"><Loader2 className=\"h-5 w-5 animate-spin mx-auto\" /></div>\r\n                            ) : reasons.length === 0 ? (\r\n                                <div className=\"p-8 text-center text-white/30 flex flex-col items-center gap-2\">\r\n                                    <AlertCircle className=\"h-8 w-8 opacity-20\" />\r\n                                    Nenhum motivo cadastrado.\r\n                                </div>\r\n                            ) : (\r\n                                reasons.map((r) => (\r\n                                    <div key={r.id} className=\"grid grid-cols-12 p-2 text-xs border-b border-white/5 hover:bg-white/5 items-center transition-colors\">\r\n                                        <div className=\"col-span-2 font-mono text-amber-500\">{r.code}</div>\r\n                                        <div className=\"col-span-4 truncate\" title={r.description}>{r.description}</div>\r\n                                        <div className=\"col-span-2\">\r\n                                            <span className=\"px-1.5 py-0.5 rounded bg-white/10 text-[10px] font-bold text-white/70\">{r.category}</span>\r\n                                        </div>\r\n                                        <div className=\"col-span-2 text-right font-mono text-green-400\">\r\n                                            {new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(r.dailyCost)}\r\n                                        </div>\r\n                                        <div className=\"col-span-2 flex justify-center\">\r\n                                            <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6 text-red-400 hover:text-red-300 hover:bg-red-900/20\"\r\n                                                onClick={() => deleteMutation.mutate(r.id)}\r\n                                            >\r\n                                                <Trash2 className=\"h-3 w-3\" />\r\n                                            </Button>\r\n                                        </div>\r\n                                    </div>\r\n                                ))\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <DialogFooter>\r\n                    <Button variant=\"ghost\" onClick={onClose} className=\"text-white/50 hover:text-white\">Fechar</Button>\r\n                </DialogFooter>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n};\r\n\r\nexport default DelayCostModal;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\production\\components\\ExcelImportModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Label' is defined but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AlertCircle' is defined but never used.","line":13,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":48},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[998,1001],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[998,1001],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1144,1147],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1144,1147],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2355,2358],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2355,2358],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2402,2405],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2402,2405],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2932,2935],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2932,2935],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":187,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8476,8479],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8476,8479],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from \"react\";\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogDescription,\r\n    DialogFooter,\r\n} from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Loader2, Download, Upload, AlertCircle, CheckCircle2, Info } from \"lucide-react\";\r\nimport { orionApi } from \"@/integrations/orion/client\";\r\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { toast } from \"sonner\";\r\nimport * as XLSX from \"xlsx\";\r\n\r\ninterface ExcelImportModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    projectId: string;\r\n}\r\n\r\nconst ExcelImportModal = ({\r\n    isOpen,\r\n    onClose,\r\n    projectId,\r\n}: ExcelImportModalProps) => {\r\n    const queryClient = useQueryClient();\r\n    const [file, setFile] = useState<File | null>(null);\r\n    const [previewData, setPreviewData] = useState<any[]>([]);\r\n    const [isParsing, setIsParsing] = useState(false);\r\n\r\n    const importMutation = useMutation({\r\n        mutationFn: async (data: any[]) => {\r\n            const formattedData = data.map(row => ({\r\n                project_id: projectId,\r\n                object_id: String(row.NumeroTorre || row['Número da Torre'] || \"\"),\r\n                trecho: String(row.Trecho || \"\"),\r\n                tower_type: row.TipoTorre || row['Tipo de Torre'] || \"Autoportante\",\r\n                tipo_fundacao: row.TipoFundacao || row['Tipo de Fundação'] || \"\",\r\n                total_concreto: parseFloat(row.Concreto || row['Total Concreto'] || 0),\r\n                peso_armacao: parseFloat(row.PesoArmacao || row['Peso Armação'] || 0),\r\n                peso_estrutura: parseFloat(row.PesoEstrutura || row['Peso Estrutura'] || 0),\r\n                tramo_lancamento: String(row.TramoLancamento || row['Tramo de Lançamento'] || \"\"),\r\n                tipificacao_estrutura: String(row.TipificacaoEstrutura || row['Tipificação'] || \"\"),\r\n                object_seq: parseInt(row.Sequencia || row['Sequência'] || 0),\r\n                go_forward: parseFloat(row.VaoVante || row['Vão Vante'] || row.VaoVante_m || row.VaoVante_m_km || 0),\r\n            }));\r\n\r\n            const { data: result, error } = await orionApi\r\n                .from('tower_technical_data' as any)\r\n                .insert(formattedData as any);\r\n\r\n            if (error) throw error;\r\n            return result;\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"production-towers\"] });\r\n            toast.success(\"Torres importadas com sucesso!\");\r\n\r\n            // Reordering for stability: close modal first, then clear internal state\r\n            onClose();\r\n            setTimeout(() => {\r\n                setFile(null);\r\n                setPreviewData([]);\r\n            }, 100);\r\n        },\r\n        onError: (error: any) => {\r\n            toast.error(\"Erro na importação: \" + (error.response?.data?.message || error.message));\r\n        },\r\n    });\r\n\r\n    const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const selectedFile = e.target.files?.[0];\r\n        if (selectedFile) {\r\n            setFile(selectedFile);\r\n            parseExcel(selectedFile);\r\n        }\r\n    };\r\n\r\n    const parseExcel = (file: File) => {\r\n        setIsParsing(true);\r\n        const reader = new FileReader();\r\n        reader.onload = (e) => {\r\n            const data = e.target?.result;\r\n            const workbook = XLSX.read(data, { type: \"binary\" });\r\n            const sheetName = workbook.SheetNames[0];\r\n            const sheet = workbook.Sheets[sheetName];\r\n            const json = XLSX.utils.sheet_to_json(sheet);\r\n            setPreviewData(json);\r\n            setIsParsing(false);\r\n        };\r\n        reader.readAsBinaryString(file);\r\n    };\r\n\r\n    const downloadTemplate = () => {\r\n        const template = [\r\n            {\r\n                Sequencia: 1,\r\n                Trecho: \"TR-01\",\r\n                NumeroTorre: \"0/1\",\r\n                VaoVante_m: 450,\r\n                TipoTorre: \"Autoportante\",\r\n                TipoFundacao: \"Grelha\",\r\n                Concreto_m3: 15.5,\r\n                PesoArmacao_ton: 1.2,\r\n                PesoEstrutura_ton: 8.5,\r\n                TramoLancamento: \"T1\",\r\n                TipificacaoEstrutura: \"A1\"\r\n            }\r\n        ];\r\n        const ws = XLSX.utils.json_to_sheet(template);\r\n        const wb = XLSX.utils.book_new();\r\n        XLSX.utils.book_append_sheet(wb, ws, \"Modelo Importação\");\r\n        XLSX.writeFile(wb, \"Modelo_Importacao_Torres.xlsx\");\r\n    };\r\n\r\n    const handleConfirmImport = () => {\r\n        if (previewData.length > 0) {\r\n            importMutation.mutate(previewData);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={onClose}>\r\n            <DialogContent className=\"sm:max-w-[600px]\">\r\n                <DialogHeader>\r\n                    <DialogTitle className=\"flex items-center gap-2\">\r\n                        <Upload className=\"h-5 w-5\" />\r\n                        Importar Torres via Excel\r\n                    </DialogTitle>\r\n                    <DialogDescription>\r\n                        Faça o upload de uma planilha para importar ou atualizar torres no projeto.\r\n                    </DialogDescription>\r\n                </DialogHeader>\r\n\r\n                <div className=\"grid gap-6 py-4\">\r\n                    <div className=\"flex flex-col gap-2 p-4 border-2 border-dashed rounded-lg bg-muted/30 items-center justify-center hover:bg-muted/50 transition-colors cursor-pointer relative\">\r\n                        <Input\r\n                            type=\"file\"\r\n                            accept=\".xlsx, .xls, .csv\"\r\n                            className=\"absolute inset-0 opacity-0 cursor-pointer\"\r\n                            onChange={handleFileChange}\r\n                        />\r\n                        <Upload className=\"h-8 w-8 text-muted-foreground mb-2\" />\r\n                        <p className=\"text-sm font-medium\">Clique ou arraste o arquivo aqui</p>\r\n                        <p className=\"text-xs text-muted-foreground\">Formatos suportados: .xlsx, .xls, .csv</p>\r\n                        {file && (\r\n                            <div className=\"mt-2 flex items-center gap-2 text-primary font-bold text-sm\">\r\n                                <CheckCircle2 className=\"h-4 w-4\" />\r\n                                {file.name}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-center bg-primary/5 p-3 rounded-md border border-primary/20\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <Info className=\"h-4 w-4 text-primary\" />\r\n                            <span className=\"text-xs text-muted-foreground\">Baixe o modelo padrão. O campo **Vão Vante** deve ser informado em **metros**.</span>\r\n                        </div>\r\n                        <Button variant=\"outline\" size=\"sm\" onClick={downloadTemplate} className=\"gap-2\">\r\n                            <Download className=\"h-4 w-4\" />\r\n                            Baixar Modelo\r\n                        </Button>\r\n                    </div>\r\n\r\n                    {isParsing && (\r\n                        <div className=\"flex items-center justify-center py-4\">\r\n                            <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\r\n                            <span className=\"ml-2 text-sm\">Processando planilha...</span>\r\n                        </div>\r\n                    )}\r\n\r\n                    {previewData.length > 0 && !isParsing && (\r\n                        <div className=\"max-h-[200px] overflow-auto border rounded-md\">\r\n                            <table className=\"w-full text-[10px]\">\r\n                                <thead className=\"bg-muted sticky top-0\">\r\n                                    <tr>\r\n                                        {Object.keys(previewData[0]).map(k => <th key={k} className=\"p-2 border-b text-left\">{k}</th>)}\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody>\r\n                                    {previewData.slice(0, 5).map((row, i) => (\r\n                                        <tr key={i}>\r\n                                            {Object.values(row).map((v: any, j) => <td key={j} className=\"p-2 border-b\">{v}</td>)}\r\n                                        </tr>\r\n                                    ))}\r\n                                </tbody>\r\n                            </table>\r\n                            {previewData.length > 5 && (\r\n                                <p className=\"text-[10px] text-muted-foreground p-2 text-center\">... e mais {previewData.length - 5} linhas</p>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                <DialogFooter className=\"flex items-center justify-between sm:justify-between\">\r\n                    <p className=\"text-xs text-muted-foreground\">\r\n                        {previewData.length} torres detectadas na planilha.\r\n                    </p>\r\n                    <div className=\"flex gap-2\">\r\n                        <Button variant=\"outline\" onClick={onClose} disabled={importMutation.isPending}>\r\n                            Cancelar\r\n                        </Button>\r\n                        <Button\r\n                            onClick={handleConfirmImport}\r\n                            disabled={importMutation.isPending || previewData.length === 0}\r\n                            className=\"gap-2\"\r\n                        >\r\n                            {importMutation.isPending ? (\r\n                                <Loader2 key=\"loader-icon\" className=\"h-4 w-4 animate-spin\" />\r\n                            ) : (\r\n                                <Upload key=\"upload-icon\" className=\"h-4 w-4\" />\r\n                            )}\r\n                            Confirmar Importação\r\n                        </Button>\r\n                    </div>\r\n                </DialogFooter>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n};\r\n\r\nexport default ExcelImportModal;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\production\\components\\LaborAnalyticsDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useState' is defined but never used.","line":1,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Legend' is defined but never used.","line":5,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CardDescription' is defined but never used.","line":7,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Select' is defined but never used.","line":13,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'SelectContent' is defined but never used.","line":13,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'SelectItem' is defined but never used.","line":13,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'SelectTrigger' is defined but never used.","line":13,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":58},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'SelectValue' is defined but never used.","line":13,"column":60,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":71},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ptBR' is defined but never used.","line":19,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1014,1017],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1014,1017],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'companies' is assigned a value but never used.","line":32,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2875,2878],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2875,2878],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo, useState } from 'react';\r\nimport {\r\n    BarChart, Bar, AreaChart, Area,\r\n    PieChart, Pie, Cell, XAxis, YAxis, CartesianGrid,\r\n    Tooltip, Legend, ResponsiveContainer, LineChart, Line\r\n} from 'recharts';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport {\r\n    Clock, TrendingUp, Users, HardHat, Filter,\r\n    BarChart3, PieChart as PieChartIcon, LineChart as LineChartIcon,\r\n    ArrowUpRight, Loader2\r\n} from 'lucide-react';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { useTimeRecords } from '@/hooks/useTimeRecords';\r\nimport { useEmployees } from '@/hooks/useEmployees';\r\nimport { useSites } from '@/hooks/useSites';\r\nimport { useCompanies } from '@/hooks/useCompanies';\r\nimport { format, subDays, eachDayOfInterval } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\n\r\ninterface LaborAnalyticsDashboardProps {\r\n    projectId: string;\r\n    projects: any[];\r\n    timeRange: string;\r\n}\r\n\r\nexport default function LaborAnalyticsDashboard({ projectId: selectedProjectId, projects, timeRange }: LaborAnalyticsDashboardProps) {\r\n    // Database Hooks\r\n    const { records, isLoading: loadingRecords } = useTimeRecords();\r\n    const { employees, isLoading: loadingEmployees } = useEmployees();\r\n    const { sites, isLoading: loadingSites } = useSites();\r\n    const { companies, isLoading: loadingCompanies } = useCompanies();\r\n\r\n    const isLoading = loadingRecords || loadingEmployees || loadingSites || loadingCompanies;\r\n\r\n    const processedData = useMemo(() => {\r\n        if (!records.length || !employees.length) return {\r\n            hhhStats: [],\r\n            distribution: [],\r\n            totalHHH: 0,\r\n            activeWorkers: 0,\r\n            efficiency: 0\r\n        };\r\n\r\n        // Pre-map for performance\r\n        const employeeMap = new Map(employees.map(e => [e.id, e]));\r\n        const siteMap = new Map(sites.map(s => [s.id, s]));\r\n\r\n        const now = new Date();\r\n        let startDate = subDays(now, 30);\r\n        if (timeRange === 'week') startDate = subDays(now, 7);\r\n        if (timeRange === 'quarter') startDate = subDays(now, 90);\r\n        if (timeRange === 'year') startDate = subDays(now, 365);\r\n\r\n        // Filter Records\r\n        const filteredRecords = records.filter(r => {\r\n            const date = new Date(r.recordedAt);\r\n            if (date < startDate) return false;\r\n\r\n            const employee = employeeMap.get(r.employeeId);\r\n            if (!employee) return false;\r\n\r\n            const site = siteMap.get(employee.siteId);\r\n            const matchesProject = selectedProjectId === 'all' || (site && site.projectId === selectedProjectId);\r\n\r\n            return matchesProject;\r\n        });\r\n\r\n        // Calculate HHH\r\n        const employeeDayRecords: { [key: string]: any[] } = {};\r\n        filteredRecords.forEach(r => {\r\n            const dayKey = format(new Date(r.recordedAt), 'yyyy-MM-dd');\r\n            const key = `${r.employeeId}_${dayKey}`;\r\n            if (!employeeDayRecords[key]) employeeDayRecords[key] = [];\r\n            employeeDayRecords[key].push(r);\r\n        });\r\n\r\n        const dailyHHH: { [key: string]: number } = {};\r\n        let totalHHHSum = 0;\r\n\r\n        Object.values(employeeDayRecords).forEach(recs => {\r\n            const sorted = recs.sort((a, b) => new Date(a.recordedAt).getTime() - new Date(b.recordedAt).getTime());\r\n            let hours = 0;\r\n            for (let i = 0; i < sorted.length - 1; i += 2) {\r\n                if (sorted[i].recordType === 'entry' && sorted[i + 1].recordType === 'exit') {\r\n                    const diff = new Date(sorted[i + 1].recordedAt).getTime() - new Date(sorted[i].recordedAt).getTime();\r\n                    hours += diff / (1000 * 60 * 60);\r\n                }\r\n            }\r\n            totalHHHSum += hours;\r\n            const dateStr = format(new Date(sorted[0].recordedAt), 'dd/MM');\r\n            dailyHHH[dateStr] = (dailyHHH[dateStr] || 0) + hours;\r\n        });\r\n\r\n        // Format Stats\r\n        const days = eachDayOfInterval({ start: startDate, end: now });\r\n        const activeProject = selectedProjectId !== 'all' ? projects.find(p => p.id === selectedProjectId) : null;\r\n        const totalProjectPlanned = activeProject?.plannedHHH || 0;\r\n\r\n        const hhhStats = days.map(d => {\r\n            const key = format(d, 'dd/MM');\r\n            const realizado = dailyHHH[key] || 0;\r\n            let planejado = 0;\r\n\r\n            if (activeProject && activeProject.startDate && activeProject.endDate && totalProjectPlanned > 0) {\r\n                const durationDays = Math.max(1, (new Date(activeProject.endDate).getTime() - new Date(activeProject.startDate).getTime()) / (1000 * 60 * 60 * 24));\r\n                planejado = totalProjectPlanned / durationDays;\r\n            } else {\r\n                const workersThatDay = new Set(filteredRecords.filter(r => format(new Date(r.recordedAt), 'dd/MM') === key).map(r => r.employeeId)).size;\r\n                planejado = workersThatDay * 8.8;\r\n            }\r\n\r\n            return {\r\n                name: key,\r\n                realizado: parseFloat(realizado.toFixed(1)),\r\n                planejado: parseFloat(planejado.toFixed(1)),\r\n                acumulado: 0\r\n            };\r\n        });\r\n\r\n        let acc = 0;\r\n        hhhStats.forEach(s => {\r\n            acc += s.realizado;\r\n            s.acumulado = parseFloat(acc.toFixed(1));\r\n        });\r\n\r\n        // Distribution\r\n        const funcCount: { [key: string]: number } = {};\r\n        const filteredEmployees = employees.filter(e => {\r\n            const site = siteMap.get(e.siteId);\r\n            return selectedProjectId === 'all' || (site && site.projectId === selectedProjectId);\r\n        });\r\n\r\n        filteredEmployees.forEach(e => {\r\n            const func = e.functionName || 'Outros';\r\n            funcCount[func] = (funcCount[func] || 0) + 1;\r\n        });\r\n\r\n        const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899'];\r\n        const distribution = Object.entries(funcCount).map(([name, count], i) => ({\r\n            name,\r\n            value: count,\r\n            percentage: Math.round((count / Math.max(1, filteredEmployees.length)) * 100),\r\n            color: colors[i % colors.length]\r\n        })).slice(0, 6);\r\n\r\n        return {\r\n            hhhStats,\r\n            distribution,\r\n            totalHHH: Math.round(totalHHHSum),\r\n            activeWorkers: filteredEmployees.length,\r\n            efficiency: totalHHHSum > 0 ? Math.min(98, Math.round(((totalHHHSum) / (Math.max(1, filteredEmployees.length) * 8.8 * hhhStats.length)) * 100 * 2)) : 0\r\n        };\r\n    }, [records, employees, sites, timeRange, selectedProjectId, projects]);\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"flex flex-col items-center justify-center min-h-[400px] gap-4\">\r\n                <Loader2 className=\"w-10 h-10 animate-spin text-primary\" />\r\n                <p className=\"text-white animate-pulse font-bold uppercase text-[10px] tracking-widest\">Sincronizando Mão de Obra...</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in duration-500\">\r\n            {/* Real Stats Cards */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n                <Card className=\"bg-slate-950/40 border-white/5 backdrop-blur-md overflow-hidden group hover:border-primary/30 transition-all\">\r\n                    <CardContent className=\"p-6\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <div>\r\n                                <p className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em]\">HHH REALIZADO</p>\r\n                                <h3 className=\"text-2xl font-black mt-1 text-white\">{processedData.totalHHH.toLocaleString()}h</h3>\r\n                            </div>\r\n                            <div className=\"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center border border-primary/20 group-hover:scale-110 transition-transform\">\r\n                                <Clock className=\"text-primary w-5 h-5\" />\r\n                            </div>\r\n                        </div>\r\n                        <p className=\"text-[9px] font-bold text-primary/60 mt-4 uppercase\">Baseado em {records.length} registros</p>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <Card className=\"bg-slate-950/40 border-white/5 backdrop-blur-md overflow-hidden group hover:border-amber-500/30 transition-all\">\r\n                    <CardContent className=\"p-6\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <div>\r\n                                <p className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em]\">APROVEITAMENTO</p>\r\n                                <h3 className=\"text-2xl font-black mt-1 text-white\">{processedData.efficiency}%</h3>\r\n                            </div>\r\n                            <div className=\"w-10 h-10 rounded-xl bg-amber-500/10 flex items-center justify-center border border-amber-500/20 group-hover:scale-110 transition-transform\">\r\n                                <TrendingUp className=\"text-amber-500 w-5 h-5\" />\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-1.5 mt-4 text-[9px] font-bold text-emerald-500 uppercase\">\r\n                            <ArrowUpRight className=\"w-3 h-3\" />\r\n                            <span>Controle de jornada ativo</span>\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <Card className=\"bg-slate-950/40 border-white/5 backdrop-blur-md overflow-hidden group hover:border-emerald-500/30 transition-all\">\r\n                    <CardContent className=\"p-6\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <div>\r\n                                <p className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em]\">MÃO DE OBRA</p>\r\n                                <h3 className=\"text-2xl font-black mt-1 text-white\">{processedData.activeWorkers}</h3>\r\n                            </div>\r\n                            <div className=\"w-10 h-10 rounded-xl bg-emerald-500/10 flex items-center justify-center border border-emerald-500/20 group-hover:scale-110 transition-transform\">\r\n                                <Users className=\"text-emerald-500 w-5 h-5\" />\r\n                            </div>\r\n                        </div>\r\n                        <p className=\"text-[9px] font-bold text-muted-foreground mt-4 uppercase\">Funcionários no escopo</p>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <Card className=\"bg-slate-950/40 border-white/5 backdrop-blur-md overflow-hidden group hover:border-purple-500/30 transition-all\">\r\n                    <CardContent className=\"p-6\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <div>\r\n                                <p className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em]\">CANTEIROS</p>\r\n                                <h3 className=\"text-2xl font-black mt-1 text-white\">{sites.length}</h3>\r\n                            </div>\r\n                            <div className=\"w-10 h-10 rounded-xl bg-purple-500/10 flex items-center justify-center border border-purple-500/20 group-hover:scale-110 transition-transform\">\r\n                                <HardHat className=\"text-purple-500 w-5 h-5\" />\r\n                            </div>\r\n                        </div>\r\n                        <p className=\"text-[9px] font-bold text-muted-foreground mt-4 uppercase\">Áreas monitoradas</p>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            {/* Controls */}\r\n            <div className=\"flex items-center justify-between bg-black/40 p-4 rounded-xl border border-white/5 backdrop-blur-md\">\r\n                <div className=\"flex items-center gap-3\">\r\n                    <Filter className=\"w-4 h-4 text-primary\" />\r\n                    <h2 className=\"text-[11px] font-black uppercase tracking-widest leading-none\">Análise de Jornada</h2>\r\n                </div>\r\n                <div className=\"text-[10px] font-bold text-muted-foreground uppercase tracking-widest px-3 py-1 bg-white/5 rounded-md\">\r\n                    Periodo: {timeRange === 'week' ? 'Semana' : timeRange === 'month' ? 'Mês' : timeRange === 'quarter' ? 'Trimestre' : 'Ano'}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Charts Grid */}\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                <Card className=\"bg-slate-950/40 border-white/5 backdrop-blur-md\">\r\n                    <CardHeader className=\"pb-2 border-b border-white/5\">\r\n                        <CardTitle className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2\">\r\n                            <BarChart3 className=\"w-4 h-4 text-primary\" />\r\n                            HHH Diário Realizado\r\n                        </CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent className=\"h-[300px] pt-4\">\r\n                        {processedData.hhhStats.length > 0 ? (\r\n                            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                <BarChart data={processedData.hhhStats}>\r\n                                    <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(255,255,255,0.05)\" vertical={false} />\r\n                                    <XAxis dataKey=\"name\" stroke=\"#6b7280\" fontSize={10} tickLine={false} axisLine={false} />\r\n                                    <YAxis stroke=\"#6b7280\" fontSize={10} tickLine={false} axisLine={false} />\r\n                                    <Tooltip\r\n                                        contentStyle={{ backgroundColor: '#0f172a', borderColor: 'rgba(255,255,255,0.1)', borderRadius: '12px', fontSize: '10px' }}\r\n                                    />\r\n                                    <Bar dataKey=\"realizado\" fill=\"#fbbf24\" radius={[4, 4, 0, 0]} name=\"Realizado\" />\r\n                                    <Bar dataKey=\"planejado\" fill=\"#3b82f6\" fillOpacity={0.2} radius={[4, 4, 0, 0]} name=\"Planejado\" />\r\n                                </BarChart>\r\n                            </ResponsiveContainer>\r\n                        ) : (\r\n                            <div className=\"flex items-center justify-center h-full text-muted-foreground text-[10px] font-bold uppercase tracking-widest opacity-30\">Sem registros</div>\r\n                        )}\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <Card className=\"bg-slate-950/40 border-white/5 backdrop-blur-md\">\r\n                    <CardHeader className=\"pb-2 border-b border-white/5\">\r\n                        <CardTitle className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2\">\r\n                            <TrendingUp className=\"w-4 h-4 text-emerald-500\" />\r\n                            Curva de Esforço (HHH)\r\n                        </CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent className=\"h-[300px] pt-4\">\r\n                        <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                            <AreaChart data={processedData.hhhStats}>\r\n                                <defs>\r\n                                    <linearGradient id=\"colorHHH\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                        <stop offset=\"5%\" stopColor=\"#3b82f6\" stopOpacity={0.3} />\r\n                                        <stop offset=\"95%\" stopColor=\"#3b82f6\" stopOpacity={0} />\r\n                                    </linearGradient>\r\n                                </defs>\r\n                                <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(255,255,255,0.05)\" />\r\n                                <XAxis dataKey=\"name\" stroke=\"#6b7280\" fontSize={10} />\r\n                                <YAxis stroke=\"#6b7280\" fontSize={10} />\r\n                                <Tooltip contentStyle={{ backgroundColor: '#0f172a', borderColor: 'rgba(255,255,255,0.1)', borderRadius: '12px', fontSize: '10px' }} />\r\n                                <Area type=\"monotone\" dataKey=\"acumulado\" stroke=\"#3b82f6\" fillOpacity={1} fill=\"url(#colorHHH)\" name=\"Acumulado\" strokeWidth={2} />\r\n                            </AreaChart>\r\n                        </ResponsiveContainer>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <Card className=\"bg-slate-950/40 border-white/5 backdrop-blur-md\">\r\n                    <CardHeader className=\"pb-2 border-b border-white/5\">\r\n                        <CardTitle className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2\">\r\n                            <PieChartIcon className=\"w-4 h-4 text-primary\" />\r\n                            Distribuição por Função\r\n                        </CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent className=\"h-[300px] flex items-center justify-center\">\r\n                        {processedData.distribution.length > 0 ? (\r\n                            <div className=\"w-full h-full flex flex-col md:flex-row items-center\">\r\n                                <ResponsiveContainer width=\"70%\" height=\"100%\">\r\n                                    <PieChart>\r\n                                        <Pie\r\n                                            data={processedData.distribution}\r\n                                            cx=\"50%\"\r\n                                            cy=\"50%\"\r\n                                            innerRadius={60}\r\n                                            outerRadius={90}\r\n                                            paddingAngle={5}\r\n                                            dataKey=\"value\"\r\n                                            stroke=\"none\"\r\n                                        >\r\n                                            {processedData.distribution.map((entry, index) => (\r\n                                                <Cell key={`cell-${index}`} fill={entry.color} />\r\n                                            ))}\r\n                                        </Pie>\r\n                                        <Tooltip contentStyle={{ backgroundColor: '#0f172a', borderColor: 'rgba(255,255,255,0.1)', borderRadius: '12px', fontSize: '10px' }} />\r\n                                    </PieChart>\r\n                                </ResponsiveContainer>\r\n                                <div className=\"flex flex-col gap-2 shrink-0 min-w-[140px] border-l border-white/5 pl-4\">\r\n                                    {processedData.distribution.map((item, i) => (\r\n                                        <div key={i} className=\"flex items-center gap-2\">\r\n                                            <div className=\"w-2 h-2 rounded-full\" style={{ backgroundColor: item.color }} />\r\n                                            <span className=\"text-[9px] font-bold text-slate-400 truncate w-20\">{item.name}</span>\r\n                                            <span className=\"text-[9px] font-black text-white ml-auto\">{item.percentage}%</span>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"text-muted-foreground text-[10px] uppercase font-bold tracking-widest opacity-30\">Sem dados de funcionários</div>\r\n                        )}\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <Card className=\"bg-slate-950/40 border-white/5 backdrop-blur-md\">\r\n                    <CardHeader className=\"pb-2 border-b border-white/5\">\r\n                        <CardTitle className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2\">\r\n                            <LineChartIcon className=\"w-4 h-4 text-emerald-500\" />\r\n                            Tendência de Mobilização\r\n                        </CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent className=\"h-[300px] pt-4\">\r\n                        <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                            <LineChart data={processedData.hhhStats}>\r\n                                <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(255,255,255,0.05)\" vertical={false} />\r\n                                <XAxis dataKey=\"name\" stroke=\"#6b7280\" fontSize={10} tickLine={false} />\r\n                                <YAxis stroke=\"#6b7280\" fontSize={10} tickLine={false} />\r\n                                <Tooltip contentStyle={{ backgroundColor: '#0f172a', borderColor: 'rgba(255,255,255,0.1)', borderRadius: '12px', fontSize: '10px' }} />\r\n                                <Line type=\"stepAfter\" dataKey=\"realizado\" stroke=\"#10b981\" strokeWidth={2} dot={{ r: 3, fill: '#10b981' }} name=\"Volume HHH\" />\r\n                            </LineChart>\r\n                        </ResponsiveContainer>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\production\\components\\ProductionCostDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'startOfWeek' is defined but never used.","line":6,"column":116,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":127},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1014,1017],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1014,1017],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'getCost'. Either include it or remove the dependency array.","line":181,"column":8,"nodeType":"ArrayExpression","endLine":181,"endColumn":72,"suggestions":[{"desc":"Update the dependencies array to be: [towers, unitCosts, categories, startDate, endDate, granularity, getCost]","fix":{"range":[8411,8475],"text":"[towers, unitCosts, categories, startDate, endDate, granularity, getCost]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo, useState } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { ResponsiveContainer, AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, Legend, BarChart, Bar, Cell } from 'recharts';\r\nimport { TowerProductionData, ProductionCategory } from '../types';\r\nimport { format, startOfMonth, endOfMonth, eachMonthOfInterval, eachWeekOfInterval, isBefore, min, max, addMonths, startOfWeek, endOfWeek, addWeeks, eachQuarterOfInterval, eachYearOfInterval, endOfQuarter, endOfYear, isWithinInterval, startOfDay, endOfDay, subDays } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Input } from '@/components/ui/input';\r\nimport { CalendarDays } from 'lucide-react';\r\n\r\ninterface ProductionCostDashboardProps {\r\n    projectId: string;\r\n    towers?: TowerProductionData[];\r\n    categories?: ProductionCategory[];\r\n    unitCosts?: any[];\r\n}\r\n\r\ntype GranularityType = 'weekly' | 'monthly' | 'quarterly' | 'annual' | 'total';\r\n\r\nexport default function ProductionCostDashboard({ towers, categories, unitCosts }: ProductionCostDashboardProps) {\r\n    const [granularity, setGranularity] = useState<GranularityType>('monthly');\r\n    const [startDate, setStartDate] = useState<string>('');\r\n    const [endDate, setEndDate] = useState<string>('');\r\n\r\n    const getCost = (activityId: string) => {\r\n        const cost = unitCosts?.find(c => c.activityId === activityId);\r\n        return cost ? Number(cost.unitPrice) : 0;\r\n    };\r\n\r\n    // Auto-detect project dates\r\n    const detectedDates = useMemo(() => {\r\n        if (!towers) return { start: '', end: '' };\r\n        const dates: Date[] = [];\r\n        towers.forEach(t => {\r\n            t.activitySchedules?.forEach(s => {\r\n                if (s.plannedStart) dates.push(new Date(s.plannedStart));\r\n                if (s.plannedEnd) dates.push(new Date(s.plannedEnd));\r\n            });\r\n        });\r\n        if (dates.length === 0) return { start: '', end: '' };\r\n        return {\r\n            start: format(min(dates), 'yyyy-MM-dd'),\r\n            end: format(max(dates), 'yyyy-MM-dd')\r\n        };\r\n    }, [towers]);\r\n\r\n    const financialData = useMemo(() => {\r\n        if (!towers || !unitCosts || !categories) return { curve: [], stats: { budget: 0, earned: 0 }, pareto: [] };\r\n\r\n        let totalBudget = 0;\r\n        let totalEarned = 0;\r\n\r\n        const items: {\r\n            name: string;\r\n            plannedEnd: Date;\r\n            actualEnd?: Date;\r\n            cost: number;\r\n            isFinished: boolean;\r\n        }[] = [];\r\n\r\n        towers.forEach(t => {\r\n            categories.forEach(cat => {\r\n                cat.activities.forEach(act => {\r\n                    const price = getCost(act.id);\r\n                    if (price <= 0) return;\r\n\r\n                    const schedule = t.activitySchedules?.find(s => s.activityId === act.id);\r\n                    const status = t.activityStatuses?.find(s => s.activityId === act.id);\r\n\r\n                    if (schedule && schedule.plannedEnd) {\r\n                        const qty = schedule.plannedQuantity ? Number(schedule.plannedQuantity) : 1;\r\n                        const itemValue = qty * price;\r\n\r\n                        // totalBudget += itemValue; // REMOVIDO: Agora calculado dinamicamente com base no filtro\r\n                        // if (status?.status === 'FINISHED') {\r\n                        //     totalEarned += itemValue; // REMOVIDO\r\n                        // }\r\n\r\n                        items.push({\r\n                            name: act.name,\r\n                            plannedEnd: startOfDay(new Date(schedule.plannedEnd)),\r\n                            actualEnd: status?.endDate ? startOfDay(new Date(status.endDate)) : undefined,\r\n                            cost: itemValue,\r\n                            isFinished: status?.status === 'FINISHED'\r\n                        });\r\n                    }\r\n                });\r\n            });\r\n        });\r\n\r\n        if (items.length === 0) return { curve: [], stats: { budget: 0, earned: 0 }, pareto: [] };\r\n\r\n        const allDates = items.flatMap(i => [i.plannedEnd, i.actualEnd].filter(Boolean) as Date[]);\r\n        const minDetected = allDates.length > 0 ? min(allDates) : new Date();\r\n        const maxDetected = allDates.length > 0 ? max(allDates) : new Date();\r\n\r\n        const filterStart = startDate ? startOfDay(new Date(startDate)) : startOfMonth(minDetected);\r\n        const filterEnd = endDate ? endOfDay(new Date(endDate)) : endOfMonth(maxDetected);\r\n\r\n        const periodActivityCosts: Record<string, number> = {};\r\n\r\n        // Reset stats for the filtered period\r\n        totalBudget = 0;\r\n        totalEarned = 0;\r\n\r\n        items.forEach(item => {\r\n            // Stats: Filter by period\r\n            const budgetDate = item.plannedEnd;\r\n            if (isWithinInterval(budgetDate, { start: filterStart, end: filterEnd })) {\r\n                totalBudget += item.cost;\r\n            }\r\n\r\n            if (item.isFinished && item.actualEnd) {\r\n                if (isWithinInterval(item.actualEnd, { start: filterStart, end: filterEnd })) {\r\n                    totalEarned += item.cost;\r\n                }\r\n            }\r\n\r\n            // Pareto: Filter by relevant date (Actual for realized, Planned for future/budget?)\r\n            // Usually Pareto of Costs implies \"Where money is going\".\r\n            // Let's stick to the previous key date logic or align with Budget?\r\n            // The Original code used `refDate = actualEnd || plannedEnd` for Pareto.\r\n            // Let's keep consistency for Pareto.\r\n            const refDate = item.actualEnd || item.plannedEnd;\r\n            if (isWithinInterval(refDate, { start: filterStart, end: filterEnd })) {\r\n                periodActivityCosts[item.name] = (periodActivityCosts[item.name] || 0) + item.cost;\r\n            }\r\n        });\r\n\r\n        let timeline: Date[];\r\n        if (granularity === 'weekly') {\r\n            timeline = eachWeekOfInterval({ start: filterStart, end: addWeeks(filterEnd, 1) }, { weekStartsOn: 1 });\r\n        } else if (granularity === 'monthly') {\r\n            timeline = eachMonthOfInterval({ start: filterStart, end: addMonths(filterEnd, 1) });\r\n        } else if (granularity === 'quarterly') {\r\n            timeline = eachQuarterOfInterval({ start: filterStart, end: filterEnd });\r\n        } else if (granularity === 'annual') {\r\n            timeline = eachYearOfInterval({ start: filterStart, end: filterEnd });\r\n        } else {\r\n            timeline = [filterStart];\r\n        }\r\n\r\n        const curve = timeline.map((period) => {\r\n            let periodEnd: Date;\r\n            if (granularity === 'weekly') periodEnd = endOfWeek(period, { weekStartsOn: 1 });\r\n            else if (granularity === 'monthly') periodEnd = endOfMonth(period);\r\n            else if (granularity === 'quarterly') periodEnd = endOfQuarter(period);\r\n            else if (granularity === 'annual') periodEnd = endOfYear(period);\r\n            else periodEnd = filterEnd;\r\n\r\n            const plannedAcc = items\r\n                .filter(i => isBefore(i.plannedEnd, periodEnd))\r\n                .reduce((acc, curr) => acc + curr.cost, 0);\r\n\r\n            const actualAcc = items\r\n                .filter(i => i.actualEnd && isBefore(i.actualEnd, periodEnd))\r\n                .reduce((acc, curr) => acc + curr.cost, 0);\r\n\r\n            let label: string;\r\n            if (granularity === 'weekly') label = `S${format(period, 'ww')} - ${format(period, 'dd/MM')}`;\r\n            else if (granularity === 'monthly') label = format(period, 'MMM/yy', { locale: ptBR });\r\n            else if (granularity === 'quarterly') label = `${Math.floor(period.getMonth() / 3) + 1}º Trim/${format(period, 'yy')}`;\r\n            else if (granularity === 'annual') label = format(period, 'yyyy');\r\n            else label = 'GERAL';\r\n\r\n            return {\r\n                period: label,\r\n                planned: plannedAcc,\r\n                actual: actualAcc\r\n            };\r\n        });\r\n\r\n        const pareto = Object.entries(periodActivityCosts)\r\n            .map(([name, value]) => ({ name, value }))\r\n            .sort((a, b) => b.value - a.value)\r\n            .slice(0, 10);\r\n\r\n        return { curve, stats: { budget: totalBudget, earned: totalEarned }, pareto };\r\n\r\n    }, [towers, unitCosts, categories, granularity, startDate, endDate]);\r\n\r\n    const { curve, stats, pareto } = financialData;\r\n\r\n    const formatCurrency = (val: number) => {\r\n        return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(val);\r\n    };\r\n\r\n    const handleGranularityChange = (newGranularity: GranularityType) => {\r\n        setGranularity(newGranularity);\r\n        const now = new Date();\r\n        if (newGranularity === 'weekly') {\r\n            setStartDate(format(subDays(now, 7), 'yyyy-MM-dd'));\r\n            setEndDate(format(now, 'yyyy-MM-dd'));\r\n        } else if (newGranularity === 'monthly') {\r\n            setStartDate(format(subDays(now, 30), 'yyyy-MM-dd'));\r\n            setEndDate(format(now, 'yyyy-MM-dd'));\r\n        } else if (newGranularity === 'quarterly') {\r\n            setStartDate(format(subDays(now, 90), 'yyyy-MM-dd'));\r\n            setEndDate(format(now, 'yyyy-MM-dd'));\r\n        } else if (newGranularity === 'annual') {\r\n            setStartDate(format(subDays(now, 365), 'yyyy-MM-dd'));\r\n            setEndDate(format(now, 'yyyy-MM-dd'));\r\n        } else if (newGranularity === 'total') {\r\n            setStartDate(detectedDates.start);\r\n            setEndDate(detectedDates.end);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in slide-in-from-top-4 duration-500\">\r\n            {/* Stats Cards */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                <Card className=\"bg-slate-950/50 border-amber-900/20 backdrop-blur-sm\">\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-[10px] items-center text-slate-400 uppercase tracking-widest font-bold\">Orçamento Total (CAPEX)</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold text-amber-500 font-mono\">\r\n                            {formatCurrency(stats.budget)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card className=\"bg-slate-950/50 border-sky-900/20 backdrop-blur-sm\">\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-[10px] items-center text-slate-400 uppercase tracking-widest font-bold\">Valor Agregado (Realizado)</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold text-sky-500 font-mono\">\r\n                            {formatCurrency(stats.earned)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card className=\"bg-slate-950/50 border-slate-800 backdrop-blur-sm\">\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-[10px] items-center text-slate-400 uppercase tracking-widest font-bold\">Desvio</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className={`text-2xl font-bold font-mono ${stats.earned < stats.budget ? 'text-rose-500' : 'text-emerald-500'}`}>\r\n                            {((stats.earned / (stats.budget || 1)) * 100).toFixed(1)}%\r\n                        </div>\r\n                        <p className=\"text-[10px] text-slate-500\">do orçamento total</p>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            {/* Date Range + Granularity Controls */}\r\n            <div className=\"flex flex-col sm:flex-row gap-4 items-end bg-slate-950/40 p-4 rounded-xl border border-white/5\">\r\n                <div className=\"flex items-center gap-2\">\r\n                    <CalendarDays className=\"h-4 w-4 text-amber-500\" />\r\n                    <Label className=\"text-[10px] uppercase font-bold text-muted-foreground tracking-widest whitespace-nowrap\">Período</Label>\r\n                </div>\r\n\r\n                <div className=\"flex gap-2 items-center\">\r\n                    <div className=\"space-y-1\">\r\n                        <Label className=\"text-[9px] text-slate-500 uppercase\">Início</Label>\r\n                        <Input\r\n                            type=\"date\"\r\n                            className=\"h-8 text-xs bg-black/40 border-slate-700 w-36 font-bold\"\r\n                            value={startDate || detectedDates.start}\r\n                            onChange={(e) => setStartDate(e.target.value)}\r\n                        />\r\n                    </div>\r\n                    <span className=\"text-slate-500 mt-4\">→</span>\r\n                    <div className=\"space-y-1\">\r\n                        <Label className=\"text-[9px] text-slate-500 uppercase\">Fim</Label>\r\n                        <Input\r\n                            type=\"date\"\r\n                            className=\"h-8 text-xs bg-black/40 border-slate-700 w-36 font-bold\"\r\n                            value={endDate || detectedDates.end}\r\n                            onChange={(e) => setEndDate(e.target.value)}\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-2 ml-auto\">\r\n                    <Label className=\"text-[10px] uppercase font-bold text-muted-foreground tracking-widest\">Granularidade</Label>\r\n                    <div className=\"flex bg-black/40 rounded-lg p-0.5 border border-slate-700\">\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            className={`h-7 px-3 text-[10px] font-bold uppercase tracking-tight rounded-md ${granularity === 'weekly' ? 'bg-amber-500 text-black' : 'text-slate-400'}`}\r\n                            onClick={() => handleGranularityChange('weekly')}\r\n                        >\r\n                            Semanal\r\n                        </Button>\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            className={`h-7 px-3 text-[10px] font-bold uppercase tracking-tight rounded-md ${granularity === 'monthly' ? 'bg-amber-500 text-black' : 'text-slate-400'}`}\r\n                            onClick={() => handleGranularityChange('monthly')}\r\n                        >\r\n                            Mensal\r\n                        </Button>\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            className={`h-7 px-3 text-[10px] font-bold uppercase tracking-tight rounded-md ${granularity === 'quarterly' ? 'bg-amber-500 text-black' : 'text-slate-400'}`}\r\n                            onClick={() => handleGranularityChange('quarterly')}\r\n                        >\r\n                            Trimestral\r\n                        </Button>\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            className={`h-7 px-3 text-[10px] font-bold uppercase tracking-tight rounded-md ${granularity === 'annual' ? 'bg-amber-500 text-black' : 'text-slate-400'}`}\r\n                            onClick={() => handleGranularityChange('annual')}\r\n                        >\r\n                            Anual\r\n                        </Button>\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            className={`h-7 px-3 text-[10px] font-bold uppercase tracking-tight rounded-md ${granularity === 'total' ? 'bg-amber-500 text-black' : 'text-slate-400'}`}\r\n                            onClick={() => handleGranularityChange('total')}\r\n                        >\r\n                            Geral\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n                {/* S-Curve */}\r\n                <Card className=\"lg:col-span-2 bg-slate-950/50 border-amber-900/20 backdrop-blur-sm\">\r\n                    <CardHeader>\r\n                        <CardTitle className=\"text-sm font-medium text-slate-400 uppercase tracking-wider flex items-center gap-2\">\r\n                            Curva S Financeira (Acumulada)\r\n                            <span className=\"text-[10px] text-slate-600 font-normal\">({granularity === 'weekly' ? 'Semanal' : 'Mensal'})</span>\r\n                        </CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent className=\"h-[350px]\">\r\n                        <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                            <AreaChart data={curve} margin={{ top: 10, right: 10, left: 30, bottom: granularity === 'weekly' ? 50 : 10 }}>\r\n                                <defs>\r\n                                    <linearGradient id=\"gradFinPlanned\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                        <stop offset=\"5%\" stopColor=\"#f59e0b\" stopOpacity={0.3} />\r\n                                        <stop offset=\"95%\" stopColor=\"#f59e0b\" stopOpacity={0} />\r\n                                    </linearGradient>\r\n                                    <linearGradient id=\"gradFinActual\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                        <stop offset=\"5%\" stopColor=\"#0ea5e9\" stopOpacity={0.3} />\r\n                                        <stop offset=\"95%\" stopColor=\"#0ea5e9\" stopOpacity={0} />\r\n                                    </linearGradient>\r\n                                </defs>\r\n                                <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#333\" vertical={false} />\r\n                                <XAxis\r\n                                    dataKey=\"period\"\r\n                                    stroke=\"#666\"\r\n                                    fontSize={10}\r\n                                    tickLine={false}\r\n                                    axisLine={false}\r\n                                    dy={10}\r\n                                    interval={granularity === 'weekly' ? 1 : 0}\r\n                                    angle={granularity === 'weekly' ? -45 : 0}\r\n                                    textAnchor={granularity === 'weekly' ? 'end' : 'middle'}\r\n                                />\r\n                                <YAxis stroke=\"#666\" fontSize={10} tickLine={false} axisLine={false} tickFormatter={(val) => `R$ ${(val / 1000).toFixed(0)}k`} />\r\n                                <Tooltip\r\n                                    contentStyle={{ backgroundColor: '#0f172a', borderColor: '#334155', color: '#f1f5f9' }}\r\n                                    formatter={(value: number) => formatCurrency(value)}\r\n                                />\r\n                                <Legend />\r\n                                <Area type=\"monotone\" dataKey=\"planned\" name=\"Orçado Acumulado\" stroke=\"#f59e0b\" fill=\"url(#gradFinPlanned)\" strokeWidth={2} />\r\n                                <Area type=\"monotone\" dataKey=\"actual\" name=\"Realizado Acumulado\" stroke=\"#0ea5e9\" fill=\"url(#gradFinActual)\" strokeWidth={2} />\r\n                            </AreaChart>\r\n                        </ResponsiveContainer>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                {/* Pareto */}\r\n                <Card className=\"bg-slate-950/50 border-slate-800 backdrop-blur-sm\">\r\n                    <CardHeader>\r\n                        <CardTitle className=\"text-sm font-medium text-slate-400 uppercase tracking-wider\">Top Custos (Pareto)</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent className=\"h-[350px]\">\r\n                        <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                            <BarChart data={pareto} layout=\"vertical\" margin={{ left: 0 }}>\r\n                                <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#333\" horizontal={false} />\r\n                                <XAxis type=\"number\" hide />\r\n                                <YAxis dataKey=\"name\" type=\"category\" width={100} tick={{ fontSize: 10, fill: '#94a3b8' }} interval={0} />\r\n                                <Tooltip\r\n                                    cursor={{ fill: 'transparent' }}\r\n                                    contentStyle={{ backgroundColor: '#0f172a', borderColor: '#334155', color: '#f1f5f9' }}\r\n                                    formatter={(value: number) => formatCurrency(value)}\r\n                                />\r\n                                <Bar dataKey=\"value\" fill=\"#f59e0b\" radius={[0, 4, 4, 0]}>\r\n                                    {pareto.map((entry, index) => (\r\n                                        <Cell key={`cell-${index}`} fill={index < 3 ? '#f59e0b' : '#334155'} />\r\n                                    ))}\r\n                                </Bar>\r\n                            </BarChart>\r\n                        </ResponsiveContainer>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\production\\components\\ProductionDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isAfter' is defined but never used.","line":6,"column":95,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":102},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'startOfWeek' is defined but never used.","line":6,"column":125,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":136},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'subWeeks' is defined but never used.","line":6,"column":159,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":167},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'subMonths' is defined but never used.","line":6,"column":169,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":178},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ChevronLeft' is defined but never used.","line":11,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ChevronRight' is defined but never used.","line":11,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":49},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'projectId' is defined but never used.","line":21,"column":68,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":77},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2594,2597],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2594,2597],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":307,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":307,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16736,16739],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16736,16739],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":307,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":307,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16747,16750],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16747,16750],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo, useState } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { ResponsiveContainer, AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, Legend } from 'recharts';\r\nimport { TowerProductionData, ProductionCategory } from '../types';\r\nimport { format, startOfMonth, endOfMonth, eachMonthOfInterval, eachWeekOfInterval, isBefore, isAfter, min, max, addMonths, startOfWeek, endOfWeek, addWeeks, subWeeks, subMonths } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { CalendarDays, ChevronLeft, ChevronRight, ZoomIn, ZoomOut } from 'lucide-react';\r\n\r\ninterface ProductionDashboardProps {\r\n    projectId: string;\r\n    towers?: TowerProductionData[];\r\n    categories?: ProductionCategory[];\r\n}\r\n\r\ntype GranularityType = 'weekly' | 'monthly';\r\n\r\nconst ProductionDashboard: React.FC<ProductionDashboardProps> = ({ projectId, towers, categories }) => {\r\n    const [selectedActivityId, setSelectedActivityId] = useState<string>(\"all\");\r\n    const [granularity, setGranularity] = useState<GranularityType>('monthly');\r\n    const [startDate, setStartDate] = useState<string>('');\r\n    const [endDate, setEndDate] = useState<string>('');\r\n\r\n    // Calculate S-Curve Data based on Bottom-up data (Schedules vs Actuals)\r\n    const curveData = useMemo(() => {\r\n        if (!towers || towers.length === 0) return [];\r\n\r\n        // 1. Identify relevant items based on filter\r\n        const relevantActivities: {\r\n            plannedEnd?: Date;\r\n            history: { date: Date; percent: number }[];\r\n            weight: number;\r\n        }[] = [];\r\n\r\n        towers.forEach(t => {\r\n            const activitiesToProcess = selectedActivityId !== 'all'\r\n                ? [selectedActivityId]\r\n                : categories?.flatMap(c => c.activities.map(a => a.id)) || [];\r\n\r\n            activitiesToProcess.forEach(actId => {\r\n                const schedule = t.activitySchedules?.find(s => s.activityId === actId);\r\n                const status = t.activityStatuses?.find(s => s.activityId === actId);\r\n\r\n                if (schedule || status) {\r\n                    const activityHistory: { date: Date; percent: number }[] = [];\r\n\r\n                    if (status?.history && Array.isArray(status.history)) {\r\n                        status.history.forEach((h: any) => {\r\n                            if (h.changedAt || h.timestamp) {\r\n                                activityHistory.push({\r\n                                    date: new Date(h.changedAt || h.timestamp),\r\n                                    percent: h.progressPercent || h.progress || 0\r\n                                });\r\n                            }\r\n                        });\r\n                    } else if (status?.status === 'FINISHED' && status.endDate) {\r\n                        activityHistory.push({\r\n                            date: new Date(status.endDate),\r\n                            percent: 100\r\n                        });\r\n                    }\r\n\r\n                    relevantActivities.push({\r\n                        plannedEnd: schedule?.plannedEnd ? new Date(schedule.plannedEnd) : undefined,\r\n                        history: activityHistory,\r\n                        weight: 1 // For now weights are equal, but could be cat.weight\r\n                    });\r\n                }\r\n            });\r\n        });\r\n\r\n        if (relevantActivities.length === 0) return [];\r\n\r\n        // 2. Determine Time Range\r\n        const dates = [\r\n            ...relevantActivities.map(i => i.plannedEnd),\r\n            ...relevantActivities.flatMap(i => i.history.map(h => h.date))\r\n        ].filter(d => !!d) as Date[];\r\n\r\n        if (dates.length === 0) return [];\r\n\r\n        const minDate = startDate ? new Date(startDate) : startOfMonth(min(dates));\r\n        const maxDate = endDate ? new Date(endDate) : endOfMonth(max(dates));\r\n\r\n        // Build timeline\r\n        let timeline: Date[];\r\n        if (granularity === 'weekly') {\r\n            timeline = eachWeekOfInterval({ start: minDate, end: addWeeks(maxDate, 1) }, { weekStartsOn: 1 });\r\n        } else {\r\n            timeline = eachMonthOfInterval({ start: minDate, end: addMonths(maxDate, 1) });\r\n        }\r\n\r\n        // 3. Build Cumulative Data\r\n        const totalWeight = relevantActivities.length; // Cada atividade-torre conta como 1 \"unidade\"\r\n\r\n        return timeline.map(period => {\r\n            const periodEnd = granularity === 'weekly' ? endOfWeek(period, { weekStartsOn: 1 }) : endOfMonth(period);\r\n\r\n            // Planned: simple binary (100% if plannedEnd <= periodEnd)\r\n            const plannedSum = relevantActivities.reduce((acc, i) => {\r\n                return acc + (i.plannedEnd && isBefore(i.plannedEnd, periodEnd) ? 1 : 0);\r\n            }, 0);\r\n\r\n            // Actual: based on history points (find max progress before periodEnd)\r\n            const actualSum = relevantActivities.reduce((acc, i) => {\r\n                const historyBefore = i.history.filter(h => isBefore(h.date, periodEnd));\r\n                if (historyBefore.length === 0) return acc;\r\n                const maxProgress = Math.max(...historyBefore.map(h => h.percent));\r\n                return acc + (maxProgress / 100);\r\n            }, 0);\r\n\r\n            const label = granularity === 'weekly'\r\n                ? `S${format(period, 'ww', { locale: ptBR })} - ${format(period, 'dd/MM', { locale: ptBR })}`\r\n                : format(period, 'MMM/yy', { locale: ptBR });\r\n\r\n            return {\r\n                period: label,\r\n                date: period.toISOString(),\r\n                planned: (plannedSum / totalWeight) * 100,\r\n                actual: (actualSum / totalWeight) * 100,\r\n                qtyPlanned: Math.round(plannedSum),\r\n                qtyActual: Math.round(actualSum),\r\n                total: totalWeight\r\n            };\r\n        });\r\n    }, [towers, selectedActivityId, categories, granularity, startDate, endDate]);\r\n\r\n    // Calculate current metrics\r\n    const currentMetric = useMemo(() => {\r\n        if (curveData.length === 0) return { actual: 0, planned: 0 };\r\n        const today = new Date();\r\n        const currentData = curveData.find(d => {\r\n            const date = new Date(d.date);\r\n            return date.getMonth() === today.getMonth() && date.getFullYear() === today.getFullYear();\r\n        }) || curveData[curveData.length - 1];\r\n\r\n        return {\r\n            actual: currentData.actual,\r\n            planned: currentData.planned\r\n        };\r\n    }, [curveData]);\r\n\r\n    const activityOptions = useMemo(() => {\r\n        if (!categories) return [];\r\n        return categories.flatMap(c => c.activities.map(a => ({\r\n            id: a.id,\r\n            name: `${c.name} - ${a.name}`\r\n        })));\r\n    }, [categories]);\r\n\r\n    // Auto-detect project dates from data\r\n    const detectedDates = useMemo(() => {\r\n        if (!towers) return { start: '', end: '' };\r\n        const dates: Date[] = [];\r\n        towers.forEach(t => {\r\n            t.activitySchedules?.forEach(s => {\r\n                if (s.plannedStart) dates.push(new Date(s.plannedStart));\r\n                if (s.plannedEnd) dates.push(new Date(s.plannedEnd));\r\n            });\r\n        });\r\n        if (dates.length === 0) return { start: '', end: '' };\r\n        return {\r\n            start: format(min(dates), 'yyyy-MM-dd'),\r\n            end: format(max(dates), 'yyyy-MM-dd')\r\n        };\r\n    }, [towers]);\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in slide-in-from-top-4 duration-500\">\r\n\r\n            {/* Control Panel */}\r\n            <div className=\"flex flex-col gap-4 bg-slate-950/40 p-4 rounded-xl border border-white/5\">\r\n                {/* Row 1: Activity Filter + Metrics */}\r\n                <div className=\"flex flex-col sm:flex-row gap-4 items-end sm:items-center\">\r\n                    <div className=\"w-full sm:w-[300px] space-y-1.5\">\r\n                        <Label className=\"text-[10px] uppercase font-bold text-muted-foreground tracking-widest\">Filtrar por Atividade</Label>\r\n                        <Select value={selectedActivityId} onValueChange={setSelectedActivityId}>\r\n                            <SelectTrigger className=\"bg-black/40 border-white/10 text-xs h-9\">\r\n                                <SelectValue placeholder=\"Selecione...\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent className=\"max-h-[300px]\">\r\n                                <SelectItem value=\"all\">VISÃO GERAL (TODAS)</SelectItem>\r\n                                {activityOptions.map(opt => (\r\n                                    <SelectItem key={opt.id} value={opt.id}>{opt.name}</SelectItem>\r\n                                ))}\r\n                            </SelectContent>\r\n                        </Select>\r\n                    </div>\r\n\r\n                    <div className=\"flex gap-4 ml-auto\">\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] uppercase font-bold text-muted-foreground tracking-widest text-right\">Real</span>\r\n                            <span className=\"text-xl font-bold text-sky-500 font-mono text-right\">{currentMetric.actual.toFixed(1)}%</span>\r\n                        </div>\r\n                        <div className=\"h-10 w-px bg-white/10\" />\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"text-[10px] uppercase font-bold text-muted-foreground tracking-widest text-right\">Planejado</span>\r\n                            <span className=\"text-xl font-bold text-amber-500 font-mono text-right\">{currentMetric.planned.toFixed(1)}%</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Row 2: Date Range + Granularity */}\r\n                <div className=\"flex flex-col sm:flex-row gap-4 items-end border-t border-white/5 pt-4\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <CalendarDays className=\"h-4 w-4 text-amber-500\" />\r\n                        <Label className=\"text-[10px] uppercase font-bold text-muted-foreground tracking-widest whitespace-nowrap\">Período do Projeto</Label>\r\n                    </div>\r\n\r\n                    <div className=\"flex gap-2 items-center\">\r\n                        <div className=\"space-y-1\">\r\n                            <Label className=\"text-[9px] text-slate-500 uppercase\">Início</Label>\r\n                            <Input\r\n                                type=\"date\"\r\n                                className=\"h-8 text-xs bg-black/40 border-slate-700 w-36\"\r\n                                value={startDate || detectedDates.start}\r\n                                onChange={(e) => setStartDate(e.target.value)}\r\n                            />\r\n                        </div>\r\n                        <span className=\"text-slate-500 mt-4\">→</span>\r\n                        <div className=\"space-y-1\">\r\n                            <Label className=\"text-[9px] text-slate-500 uppercase\">Fim</Label>\r\n                            <Input\r\n                                type=\"date\"\r\n                                className=\"h-8 text-xs bg-black/40 border-slate-700 w-36\"\r\n                                value={endDate || detectedDates.end}\r\n                                onChange={(e) => setEndDate(e.target.value)}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center gap-2 ml-auto\">\r\n                        <Label className=\"text-[10px] uppercase font-bold text-muted-foreground tracking-widest\">Granularidade</Label>\r\n                        <div className=\"flex bg-black/40 rounded-lg p-0.5 border border-slate-700\">\r\n                            <Button\r\n                                variant=\"ghost\"\r\n                                size=\"sm\"\r\n                                className={`h-7 px-3 text-xs rounded-md ${granularity === 'weekly' ? 'bg-amber-500/20 text-amber-500' : 'text-slate-400'}`}\r\n                                onClick={() => setGranularity('weekly')}\r\n                            >\r\n                                <ZoomIn className=\"h-3 w-3 mr-1\" />\r\n                                Semanal\r\n                            </Button>\r\n                            <Button\r\n                                variant=\"ghost\"\r\n                                size=\"sm\"\r\n                                className={`h-7 px-3 text-xs rounded-md ${granularity === 'monthly' ? 'bg-amber-500/20 text-amber-500' : 'text-slate-400'}`}\r\n                                onClick={() => setGranularity('monthly')}\r\n                            >\r\n                                <ZoomOut className=\"h-3 w-3 mr-1\" />\r\n                                Mensal\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid gap-4 md:grid-cols-1\">\r\n                <Card className=\"bg-slate-950/50 border-amber-900/20 backdrop-blur-sm\">\r\n                    <CardHeader className=\"pb-2 border-b border-white/5\">\r\n                        <CardTitle className=\"text-sm font-medium text-slate-400 uppercase tracking-wider flex items-center gap-2\">\r\n                            Curva S - {selectedActivityId === 'all' ? 'Físico Geral' : activityOptions.find(a => a.id === selectedActivityId)?.name}\r\n                            <span className=\"text-[10px] text-slate-600 font-normal\">({granularity === 'weekly' ? 'Semanal' : 'Mensal'})</span>\r\n                        </CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent className=\"h-[350px] pt-4\">\r\n                        {curveData.length > 0 ? (\r\n                            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                <AreaChart data={curveData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>\r\n                                    <defs>\r\n                                        <linearGradient id=\"gradActual\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                            <stop offset=\"5%\" stopColor=\"#0ea5e9\" stopOpacity={0.3} />\r\n                                            <stop offset=\"95%\" stopColor=\"#0ea5e9\" stopOpacity={0} />\r\n                                        </linearGradient>\r\n                                        <linearGradient id=\"gradPlanned\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                            <stop offset=\"5%\" stopColor=\"#f59e0b\" stopOpacity={0.3} />\r\n                                            <stop offset=\"95%\" stopColor=\"#f59e0b\" stopOpacity={0} />\r\n                                        </linearGradient>\r\n                                    </defs>\r\n                                    <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#333\" vertical={false} />\r\n                                    <XAxis\r\n                                        dataKey=\"period\"\r\n                                        stroke=\"#666\"\r\n                                        fontSize={10}\r\n                                        tickLine={false}\r\n                                        axisLine={false}\r\n                                        dy={10}\r\n                                        interval={granularity === 'weekly' ? 1 : 0}\r\n                                        angle={granularity === 'weekly' ? -45 : 0}\r\n                                        textAnchor={granularity === 'weekly' ? 'end' : 'middle'}\r\n                                        height={granularity === 'weekly' ? 60 : 30}\r\n                                    />\r\n                                    <YAxis\r\n                                        stroke=\"#666\"\r\n                                        fontSize={10}\r\n                                        tickLine={false}\r\n                                        axisLine={false}\r\n                                        unit=\"%\"\r\n                                        domain={[0, 100]}\r\n                                    />\r\n                                    <Tooltip\r\n                                        contentStyle={{ backgroundColor: '#0f172a', borderColor: '#334155', color: '#f1f5f9', fontSize: '12px' }}\r\n                                        labelStyle={{ color: '#94a3b8', marginBottom: '4px' }}\r\n                                        formatter={(value: any, name: any) => [\r\n                                            typeof value === 'number' ? `${value.toFixed(2)}%` : value,\r\n                                            name === 'planned' ? 'Planejado' : 'Realizado'\r\n                                        ]}\r\n                                    />\r\n                                    <Legend wrapperStyle={{ paddingTop: '20px' }} />\r\n                                    <Area\r\n                                        type=\"monotone\"\r\n                                        dataKey=\"planned\"\r\n                                        name=\"planned\"\r\n                                        stroke=\"#f59e0b\"\r\n                                        strokeWidth={2}\r\n                                        fill=\"url(#gradPlanned)\"\r\n                                        activeDot={{ r: 4, fill: '#f59e0b' }}\r\n                                    />\r\n                                    <Area\r\n                                        type=\"monotone\"\r\n                                        dataKey=\"actual\"\r\n                                        name=\"actual\"\r\n                                        stroke=\"#0ea5e9\"\r\n                                        strokeWidth={2}\r\n                                        fill=\"url(#gradActual)\"\r\n                                        activeDot={{ r: 4, fill: '#0ea5e9' }}\r\n                                    />\r\n                                </AreaChart>\r\n                            </ResponsiveContainer>\r\n                        ) : (\r\n                            <div className=\"flex flex-col items-center justify-center h-full text-muted-foreground gap-2\">\r\n                                <p className=\"text-sm\">Sem dados suficientes para gerar a curva.</p>\r\n                                <p className=\"text-xs opacity-50\">Certifique-se de preencher as datas de planejamento e atualizar os status.</p>\r\n                            </div>\r\n                        )}\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ProductionDashboard;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\production\\components\\QuickScheduleModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'parseISO' is defined but never used.","line":2,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1911,1914],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1911,1914],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'projectId' is defined but never used.","line":68,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":68,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isLoadingSchedule' is assigned a value but never used.","line":94,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":94,"endColumn":61},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":100,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3636,3639],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3636,3639],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":100,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3652,3655],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3652,3655],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4304,4307],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4304,4307],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4320,4323],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4320,4323],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":200,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7829,7832],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7829,7832],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":244,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":244,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11049,11052],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11049,11052],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport { format, parseISO } from \"date-fns\";\r\nimport { ptBR } from \"date-fns/locale\";\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogDescription,\r\n    DialogFooter,\r\n} from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Calendar } from \"@/components/ui/calendar\";\r\nimport {\r\n    Popover,\r\n    PopoverContent,\r\n    PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport {\r\n    Command,\r\n    CommandEmpty,\r\n    CommandGroup,\r\n    CommandInput,\r\n    CommandItem,\r\n    CommandList,\r\n} from \"@/components/ui/command\";\r\nimport { CalendarIcon, Loader2, Check, User, ChevronsUpDown, CalendarDays } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { orionApi } from \"@/integrations/orion/client\";\r\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\r\nimport { toast } from \"sonner\";\r\nimport { useEmployees } from \"@/hooks/useEmployees\";\r\n\r\n/**\r\n * Parse date string preserving local day (avoids UTC timezone shift)\r\n * Input: \"2026-01-26T12:00:00\" or ISO strings\r\n * Output: Date object at noon LOCAL time for the same calendar day\r\n */\r\nconst parseLocalDate = (dateStr: string): Date => {\r\n    // Extract just the date part (YYYY-MM-DD)\r\n    const datePart = dateStr.substring(0, 10);\r\n    const [year, month, day] = datePart.split('-').map(Number);\r\n    // Create date at NOON local time to avoid any timezone boundary issues\r\n    return new Date(year, month - 1, day, 12, 0, 0, 0);\r\n};\r\n\r\ninterface QuickScheduleModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    towerId: string;\r\n    towerName: string;\r\n    activityId: string;\r\n    activityName: string;\r\n    projectId?: string;\r\n    initialPlannedStart?: string;\r\n    initialPlannedEnd?: string;\r\n    availableTowers?: any[]; // For when we need to pick a tower\r\n}\r\n\r\nconst QuickScheduleModal = ({\r\n    isOpen,\r\n    onClose,\r\n    towerId,\r\n    towerName,\r\n    activityId,\r\n    activityName,\r\n    projectId,\r\n    initialPlannedStart,\r\n    initialPlannedEnd,\r\n    availableTowers\r\n}: QuickScheduleModalProps) => {\r\n    const queryClient = useQueryClient();\r\n    const { employees } = useEmployees();\r\n\r\n    const [plannedStart, setPlannedStart] = useState<Date | undefined>(\r\n        initialPlannedStart ? parseLocalDate(initialPlannedStart) : undefined\r\n    );\r\n    const [plannedEnd, setPlannedEnd] = useState<Date | undefined>(\r\n        initialPlannedEnd ? parseLocalDate(initialPlannedEnd) : undefined\r\n    );\r\n    const [plannedQuantity, setPlannedQuantity] = useState<string>(\"\");\r\n    const [plannedHHH, setPlannedHHH] = useState<string>(\"\");\r\n    const [foremanName, setForemanName] = useState<string>(\"none\");\r\n    const [foremanSearchOpen, setForemanSearchOpen] = useState(false);\r\n\r\n    // New state for tower selection if not provided\r\n    const [selectedTower, setSelectedTower] = useState<{ id: string, name: string } | null>(\r\n        towerId ? { id: towerId, name: towerName } : null\r\n    );\r\n    const [towerSearchOpen, setTowerSearchOpen] = useState(false);\r\n\r\n    // Fetch existing schedule only\r\n    const { data: scheduleData, isLoading: isLoadingSchedule } = useQuery({\r\n        queryKey: [\"production-schedule\", selectedTower?.id, activityId],\r\n        queryFn: async () => {\r\n            if (!selectedTower?.id) return null;\r\n            const res = await orionApi.get(`/production/schedule?towerId=${selectedTower.id}`);\r\n            if (res.data && Array.isArray(res.data)) {\r\n                const found = (res.data as any[]).find((s: any) => s.activityId === activityId);\r\n                return found || null;\r\n            }\r\n            return null;\r\n        },\r\n        enabled: isOpen && !!selectedTower?.id && !!activityId,\r\n    });\r\n\r\n    // Fetch current status to get leadName\r\n    const { data: statusData } = useQuery({\r\n        queryKey: [\"production-status\", selectedTower?.id, activityId],\r\n        queryFn: async () => {\r\n            if (!selectedTower?.id) return null;\r\n            const res = await orionApi.get(`/production/tower-status?towerId=${selectedTower.id}`);\r\n            if (res.data && Array.isArray(res.data)) {\r\n                const found = (res.data as any[]).find((s: any) => s.activityId === activityId);\r\n                return found || null;\r\n            }\r\n            return null;\r\n        },\r\n        enabled: isOpen && !!selectedTower?.id && !!activityId,\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (scheduleData) {\r\n            // Only overwrite dates if we are editing an existing item (initial towerId was provided)\r\n            const isEditing = !!towerId;\r\n\r\n            if (isEditing) {\r\n                if (scheduleData.plannedStart) setPlannedStart(parseLocalDate(scheduleData.plannedStart));\r\n                if (scheduleData.plannedEnd) setPlannedEnd(parseLocalDate(scheduleData.plannedEnd));\r\n            }\r\n\r\n            // Always load other metadata to help user\r\n            if (scheduleData.plannedQuantity) setPlannedQuantity(scheduleData.plannedQuantity.toString());\r\n            if (scheduleData.plannedHHH) setPlannedHHH(scheduleData.plannedHHH.toString());\r\n        }\r\n        if (statusData?.metadata?.leadName) {\r\n            setForemanName(statusData.metadata.leadName);\r\n        }\r\n    }, [scheduleData, statusData, towerId]);\r\n\r\n    const leaders = React.useMemo(() =>\r\n        employees.filter(e => e.canLeadTeam || e.professionalLevel >= 3)\r\n        , [employees]);\r\n\r\n    const saveMutation = useMutation({\r\n        mutationFn: async () => {\r\n            if (!plannedStart || !plannedEnd) {\r\n                toast.error(\"Datas de início e fim são obrigatórias.\");\r\n                throw new Error(\"Validation failed\");\r\n            }\r\n\r\n            if (!selectedTower?.id) {\r\n                toast.error(\"Selecione uma torre.\");\r\n                throw new Error(\"Validation failed\");\r\n            }\r\n\r\n            // Parse numbers handling comma as decimal separator (PT-BR)\r\n            const parseMeasure = (val: string) => {\r\n                if (!val) return null;\r\n                const normalized = val.replace(',', '.');\r\n                const num = parseFloat(normalized);\r\n                return isNaN(num) ? null : num;\r\n            };\r\n\r\n            // Helper: Normalize to Noon to avoid timezone shifting (e.g. 00:00 -> 21:00 previous day)\r\n            const toNoonISO = (d: Date) => {\r\n                const copy = new Date(d);\r\n                copy.setHours(12, 0, 0, 0);\r\n                return copy.toISOString();\r\n            };\r\n\r\n            // 1. Update Schedule\r\n            await orionApi.post(\"/production/schedule\", {\r\n                towerId: selectedTower.id,\r\n                activityId,\r\n                plannedStart: toNoonISO(plannedStart),\r\n                plannedEnd: toNoonISO(plannedEnd),\r\n                plannedQuantity: parseMeasure(plannedQuantity),\r\n                plannedHHH: parseMeasure(plannedHHH)\r\n            });\r\n\r\n            // 2. Update status metadata (Encarregado) if changed\r\n            if (foremanName !== \"none\") {\r\n                await orionApi.post(\"/production/tower-status\", {\r\n                    towerId: selectedTower.id,\r\n                    activityId,\r\n                    status: statusData?.status || 'PENDING',\r\n                    foremanName,\r\n                    metadata: { leadName: foremanName }\r\n                });\r\n            }\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"production-towers\"] });\r\n            queryClient.invalidateQueries({ queryKey: [\"production-schedule\"] });\r\n            toast.success(\"Programação atualizada com sucesso\");\r\n            onClose();\r\n        },\r\n        onError: (error: any) => {\r\n            if (error.message === \"Validation failed\") return;\r\n            toast.error(\"Erro ao salvar programação: \" + (error.response?.data?.message || error.message));\r\n        }\r\n    });\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={onClose}>\r\n            <DialogContent className=\"sm:max-w-[400px] border-amber-500/20 bg-slate-950 text-slate-100 p-0 overflow-hidden shadow-2xl\">\r\n                <div className=\"bg-amber-500/10 p-6 border-b border-amber-500/10\">\r\n                    <DialogHeader>\r\n                        <DialogTitle className=\"flex items-center gap-3 text-lg font-black text-amber-500 uppercase tracking-widest\">\r\n                            <CalendarDays className=\"w-5 h-5\" />\r\n                            Programar Atividade\r\n                        </DialogTitle>\r\n                        <DialogDescription className=\"text-xs text-slate-400 font-bold uppercase tracking-wider mt-1\">\r\n                            {selectedTower?.name || 'Selecione a Torre'} — {activityName}\r\n                        </DialogDescription>\r\n                    </DialogHeader>\r\n                </div>\r\n\r\n                <div className=\"p-6 space-y-6\">\r\n                    {/* Seleção de Torre (se não fornecida) */}\r\n                    {!towerId && (\r\n                        <div className=\"space-y-2\">\r\n                            <Label className=\"text-[10px] font-black uppercase text-slate-500 tracking-widest leading-none\">Selecione a Torre</Label>\r\n                            <Popover open={towerSearchOpen} onOpenChange={setTowerSearchOpen}>\r\n                                <PopoverTrigger asChild>\r\n                                    <Button\r\n                                        variant=\"outline\"\r\n                                        className=\"h-11 w-full justify-between bg-slate-900 border-slate-800 text-slate-200 hover:bg-slate-800 px-4 text-xs font-bold\"\r\n                                    >\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <ChevronsUpDown className=\"w-3.5 h-3.5 text-amber-500\" />\r\n                                            <span>{selectedTower ? selectedTower.name : \"Selecionar Torre...\"}</span>\r\n                                        </div>\r\n                                    </Button>\r\n                                </PopoverTrigger>\r\n                                <PopoverContent className=\"w-[340px] p-0 bg-slate-950 border-white/10 shadow-3xl z-50 overflow-hidden\" align=\"start\">\r\n                                    <Command className=\"bg-slate-950 text-slate-200\">\r\n                                        <CommandInput placeholder=\"Procurar torre...\" className=\"h-10 border-none uppercase\" />\r\n                                        <CommandList className=\"max-h-[250px] overflow-y-auto\">\r\n                                            <CommandEmpty className=\"py-6 text-center text-xs text-slate-500 uppercase font-black px-4\">Nenhuma torre encontrada.</CommandEmpty>\r\n                                            <CommandGroup heading=\"Estruturas do Projeto\">\r\n                                                {availableTowers?.map((t: any) => (\r\n                                                    <CommandItem\r\n                                                        key={t.id}\r\n                                                        value={t.objectId}\r\n                                                        onSelect={() => {\r\n                                                            setSelectedTower({ id: t.id, name: t.objectId });\r\n                                                            setTowerSearchOpen(false);\r\n                                                        }}\r\n                                                        className=\"flex items-center gap-3 p-3 cursor-pointer hover:bg-white/5 border-b border-white/5 font-bold uppercase\"\r\n                                                    >\r\n                                                        <span className=\"text-xs\">{t.objectId}</span>\r\n                                                        <Check className={cn(\"ml-auto h-4 w-4 text-amber-500\", selectedTower?.id === t.id ? \"opacity-100\" : \"opacity-0\")} />\r\n                                                    </CommandItem>\r\n                                                ))}\r\n                                            </CommandGroup>\r\n                                        </CommandList>\r\n                                    </Command>\r\n                                </PopoverContent>\r\n                            </Popover>\r\n                        </div>\r\n                    )}\r\n                    {/* Datas do Cronograma */}\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <Label className=\"text-[10px] font-black uppercase text-slate-500 tracking-widest\">Início Planejado</Label>\r\n                            <Popover>\r\n                                <PopoverTrigger asChild>\r\n                                    <Button variant=\"outline\" className=\"w-full h-11 bg-slate-900 border-slate-800 justify-start text-xs font-bold hover:bg-slate-800 transition-colors\">\r\n                                        <CalendarIcon className=\"mr-2 h-4 w-4 text-amber-500\" />\r\n                                        {plannedStart ? format(plannedStart, \"dd/MM/yyyy\") : \"Selecione\"}\r\n                                    </Button>\r\n                                </PopoverTrigger>\r\n                                <PopoverContent className=\"w-auto p-0 bg-slate-900 border-slate-800\" align=\"start\">\r\n                                    <Calendar mode=\"single\" selected={plannedStart} onSelect={setPlannedStart} className=\"bg-slate-900 text-slate-100\" locale={ptBR} />\r\n                                </PopoverContent>\r\n                            </Popover>\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <Label className=\"text-[10px] font-black uppercase text-slate-500 tracking-widest\">Fim Planejado</Label>\r\n                            <Popover>\r\n                                <PopoverTrigger asChild>\r\n                                    <Button variant=\"outline\" className=\"w-full h-11 bg-slate-900 border-slate-800 justify-start text-xs font-bold hover:bg-slate-800 transition-colors\">\r\n                                        <CalendarIcon className=\"mr-2 h-4 w-4 text-amber-500\" />\r\n                                        {plannedEnd ? format(plannedEnd, \"dd/MM/yyyy\") : \"Selecione\"}\r\n                                    </Button>\r\n                                </PopoverTrigger>\r\n                                <PopoverContent className=\"w-auto p-0 bg-slate-900 border-slate-800\" align=\"start\">\r\n                                    <Calendar mode=\"single\" selected={plannedEnd} onSelect={setPlannedEnd} className=\"bg-slate-900 text-slate-100\" locale={ptBR} />\r\n                                </PopoverContent>\r\n                            </Popover>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Encarregado */}\r\n                    <div className=\"space-y-2\">\r\n                        <Label className=\"text-[10px] font-black uppercase text-slate-500 tracking-widest\">Liderança Responsável</Label>\r\n                        <Popover open={foremanSearchOpen} onOpenChange={setForemanSearchOpen}>\r\n                            <PopoverTrigger asChild>\r\n                                <Button\r\n                                    variant=\"outline\"\r\n                                    className=\"h-11 w-full justify-between bg-slate-900 border-slate-800 text-slate-200 hover:bg-slate-800 px-4 text-xs font-bold\"\r\n                                >\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <User className=\"w-3.5 h-3.5 text-amber-500\" />\r\n                                        <span>{foremanName && foremanName !== \"none\" ? foremanName : \"Selecionar Encarregado...\"}</span>\r\n                                    </div>\r\n                                    <ChevronsUpDown className=\"ml-1 h-3 w-3 opacity-50\" />\r\n                                </Button>\r\n                            </PopoverTrigger>\r\n                            <PopoverContent className=\"w-[340px] p-0 bg-slate-900 border-slate-800 shadow-2xl\" align=\"start\">\r\n                                <Command className=\"bg-slate-900 text-slate-200\">\r\n                                    <CommandInput placeholder=\"Procurar líder...\" className=\"h-10 border-none\" />\r\n                                    <CommandList className=\"max-h-[250px] overflow-y-auto\">\r\n                                        <CommandEmpty className=\"py-6 text-center text-xs text-slate-500 uppercase font-black\">Nenhum líder encontrado.</CommandEmpty>\r\n                                        <CommandGroup heading=\"Corpo Técnico / Campo\">\r\n                                            <CommandItem value=\"none\" onSelect={() => { setForemanName(\"none\"); setForemanSearchOpen(false); }} className=\"flex items-center p-3 cursor-pointer hover:bg-slate-800\">\r\n                                                <span className=\"text-xs font-bold uppercase\">Nenhum</span>\r\n                                                <Check className={cn(\"ml-auto h-4 w-4 text-amber-500\", foremanName === \"none\" ? \"opacity-100\" : \"opacity-0\")} />\r\n                                            </CommandItem>\r\n                                            {leaders.map((leader) => (\r\n                                                <CommandItem\r\n                                                    key={leader.id}\r\n                                                    value={leader.fullName}\r\n                                                    onSelect={() => { setForemanName(leader.fullName); setForemanSearchOpen(false); }}\r\n                                                    className=\"flex items-center gap-3 p-3 cursor-pointer hover:bg-slate-800\"\r\n                                                >\r\n                                                    <div className=\"w-5 h-5 rounded-full bg-amber-500/10 flex items-center justify-center shrink-0\">\r\n                                                        <User className=\"w-3 h-3 text-amber-500\" />\r\n                                                    </div>\r\n                                                    <div className=\"flex flex-col\">\r\n                                                        <span className=\"text-xs font-bold uppercase tracking-tight text-white\">{leader.fullName}</span>\r\n                                                        <span className=\"text-[9px] text-slate-500 font-bold uppercase\">{leader.functionName || 'Encarregado'}</span>\r\n                                                    </div>\r\n                                                    <Check className={cn(\"ml-auto h-4 w-4 text-amber-500\", foremanName === leader.fullName ? \"opacity-100\" : \"opacity-0\")} />\r\n                                                </CommandItem>\r\n                                            ))}\r\n                                        </CommandGroup>\r\n                                    </CommandList>\r\n                                </Command>\r\n                            </PopoverContent>\r\n                        </Popover>\r\n                    </div>\r\n\r\n                    {/* Quantidade e HHH */}\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <Label className=\"text-[10px] font-black uppercase text-slate-500 tracking-widest\">Qtd. Planejada</Label>\r\n                            <input\r\n                                type=\"number\"\r\n                                placeholder=\"0.00\"\r\n                                className=\"w-full h-11 bg-slate-900 border border-slate-800 rounded-lg px-4 text-xs font-black text-white focus:outline-hidden focus:border-amber-500 transition-all font-mono\"\r\n                                value={plannedQuantity}\r\n                                onChange={e => setPlannedQuantity(e.target.value)}\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <Label className=\"text-[10px] font-black uppercase text-slate-500 tracking-widest\">HHH Previsto</Label>\r\n                            <input\r\n                                type=\"number\"\r\n                                placeholder=\"0.00\"\r\n                                className=\"w-full h-11 bg-slate-900 border border-slate-800 rounded-lg px-4 text-xs font-black text-white focus:outline-hidden focus:border-amber-500 transition-all font-mono\"\r\n                                value={plannedHHH}\r\n                                onChange={e => setPlannedHHH(e.target.value)}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <DialogFooter className=\"bg-slate-900/40 p-6 flex flex-row items-center justify-end gap-3 border-t border-white/5\">\r\n                    <Button variant=\"ghost\" size=\"sm\" onClick={onClose} disabled={saveMutation.isPending} className=\"text-slate-500 hover:text-white font-bold h-10 px-6 uppercase text-[10px]\">\r\n                        Cancelar\r\n                    </Button>\r\n                    <Button\r\n                        size=\"sm\"\r\n                        onClick={() => saveMutation.mutate()}\r\n                        disabled={saveMutation.isPending}\r\n                        className=\"bg-amber-600 hover:bg-amber-500 text-black font-black px-10 h-10 text-[11px] uppercase tracking-widest shadow-glow\"\r\n                    >\r\n                        {saveMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                        Salvar Planejamento\r\n                    </Button>\r\n                </DialogFooter>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n};\r\n\r\nexport default QuickScheduleModal;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\production\\components\\SixWeekLookAhead.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":152,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6532,6535],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6532,6535],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":225,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":225,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9621,9624],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9621,9624],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'d' is defined but never used.","line":248,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":248,"endColumn":45},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":250,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":250,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10772,10775],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10772,10775],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":309,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":309,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13536,13539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13536,13539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":310,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":310,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13642,13645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13642,13645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":311,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13762,13765],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13762,13765],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":336,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":336,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14951,14954],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14951,14954],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":535,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":535,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28215,28218],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28215,28218],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":557,"column":102,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":557,"endColumn":105,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30541,30544],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30541,30544],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":629,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":629,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37828,37831],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37828,37831],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo, useState } from 'react';\r\nimport { ScrollArea } from '@/components/ui/scroll-area';\r\nimport { TowerProductionData, ProductionCategory, ActivityStatus } from '../types';\r\nimport { format, addWeeks, startOfWeek, endOfWeek, addDays } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\nimport {\r\n    Plus,\r\n    CalendarDays,\r\n    CheckCircle2,\r\n} from 'lucide-react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { cn } from '@/lib/utils';\r\nimport {\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableHead,\r\n    TableHeader,\r\n    TableRow,\r\n} from \"@/components/ui/table\";\r\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\r\nimport {\r\n    DropdownMenu,\r\n    DropdownMenuContent,\r\n    DropdownMenuItem,\r\n    DropdownMenuLabel,\r\n    DropdownMenuSeparator,\r\n    DropdownMenuTrigger,\r\n} from \"@/components/ui/dropdown-menu\";\r\nimport {\r\n    AlertDialog,\r\n    AlertDialogAction,\r\n    AlertDialogCancel,\r\n    AlertDialogContent,\r\n    AlertDialogDescription,\r\n    AlertDialogFooter,\r\n    AlertDialogHeader,\r\n    AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport { MoreHorizontal, Trash2, CalendarX2, AlertTriangle } from 'lucide-react';\r\nimport { orionApi } from \"@/integrations/orion/client\";\r\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { toast } from \"sonner\";\r\n\r\n/**\r\n * Parse date string preserving local day (avoids UTC timezone shift)\r\n * Input: \"2026-01-26T12:00:00\" or ISO strings like \"2026-01-26T15:00:00.000Z\"\r\n * Output: Date object at noon LOCAL time for the same calendar day\r\n */\r\nconst parseLocalDate = (dateStr: string): Date => {\r\n    // Extract just the date part (YYYY-MM-DD) from various formats\r\n    const datePart = dateStr.substring(0, 10);\r\n    const [year, month, day] = datePart.split('-').map(Number);\r\n    // Create date at NOON local time to avoid any timezone boundary issues\r\n    return new Date(year, month - 1, day, 12, 0, 0, 0);\r\n};\r\n\r\ninterface SixWeekLookAheadProps {\r\n    towers?: TowerProductionData[];\r\n    categories?: ProductionCategory[];\r\n    startDate?: string; // Optional override\r\n    onEditActivity?: (towerId: string, activityId: string, plannedStart?: string, plannedEnd?: string) => void;\r\n    onWeekClick?: (startDate: Date) => void;\r\n    projectId?: string;\r\n    companyId?: string;\r\n}\r\n\r\nexport default function SixWeekLookAhead({ towers, categories, startDate, onEditActivity, onWeekClick, projectId, companyId }: SixWeekLookAheadProps) {\r\n    const [activeWeekId, setActiveWeekId] = useState(1);\r\n    const [showAllActivities, setShowAllActivities] = useState(false);\r\n\r\n    // Bulk Delete State\r\n    const [deleteConfirmOpen, setDeleteConfirmOpen] = useState(false);\r\n    const [deleteType, setDeleteType] = useState<'day' | 'week' | 'all' | 'project_all' | null>(null);\r\n    const [deleteTargetDate, setDeleteTargetDate] = useState<Date | null>(null);\r\n    const [deleteTargetWeekId, setDeleteTargetWeekId] = useState<number | null>(null);\r\n    const [deleteTargetActivityId, setDeleteTargetActivityId] = useState<string | null>(null);\r\n\r\n    const queryClient = useQueryClient();\r\n\r\n    // 1. Generate the 6 weeks for the selector/mutations (available everywhere)\r\n    const weeks = useMemo(() => {\r\n        const baseDate = startDate ? new Date(startDate) : new Date();\r\n        const startOfPeriod = startOfWeek(baseDate, { weekStartsOn: 1 });\r\n\r\n        return Array.from({ length: 6 }).map((_, i) => {\r\n            const weekStart = addWeeks(startOfPeriod, i);\r\n            const weekEnd = endOfWeek(weekStart, { weekStartsOn: 1 });\r\n            return {\r\n                id: i + 1,\r\n                label: `Semana ${i + 1}`,\r\n                dateRange: `${format(weekStart, 'dd/MM')} - ${format(weekEnd, 'dd/MM')}`,\r\n                start: weekStart,\r\n                end: weekEnd\r\n            };\r\n        });\r\n    }, [startDate]);\r\n\r\n    const clearScheduleMutation = useMutation({\r\n        mutationFn: async (params: { type: 'day' | 'week' | 'all' | 'project_all', targetWeekId?: number, targetDate?: Date, activityId?: string }) => {\r\n            const { type, targetWeekId, targetDate, activityId } = params || {};\r\n            if (!type) throw new Error(\"Parâmetros inválidos para limpeza (type is missing)\");\r\n            // 1. Calculate Date Range\r\n            let startDate: Date;\r\n            let endDate: Date;\r\n\r\n            if (type === 'day' && targetDate) {\r\n                startDate = new Date(targetDate);\r\n                startDate.setHours(0, 0, 0, 0); // Local Midnight start\r\n                endDate = new Date(targetDate);\r\n                endDate.setHours(23, 59, 59, 999); // Local Midnight end\r\n            } else if (type === 'week' && targetWeekId) {\r\n                const targetWeek = weeks.find(w => w.id === targetWeekId);\r\n                if (!targetWeek) throw new Error(\"Semana não encontrada\");\r\n                startDate = targetWeek.start;\r\n                endDate = targetWeek.end;\r\n            } else if (type === 'all') {\r\n                startDate = weeks[0].start;\r\n                endDate = weeks[weeks.length - 1].end;\r\n            } else if (type === 'project_all') {\r\n                // No date range - delete EVERYTHING in project\r\n                toast.info(\"Enviando solicitação de limpeza TOTAL do projeto...\");\r\n                const res = await orionApi.delete('/production/schedule', {\r\n                    scope: 'project_all',\r\n                    projectId: projectId || 'all',\r\n                    companyId: companyId || ''\r\n                });\r\n                if (res.error) throw new Error(res.error.message);\r\n                return (res.data as unknown as { count: number })?.count || 0;\r\n            } else {\r\n                throw new Error(\"Invalid delete parameters\");\r\n            }\r\n\r\n            const startDateStr = format(startDate, 'yyyy-MM-dd');\r\n            const endDateStr = format(endDate, 'yyyy-MM-dd');\r\n\r\n            toast.info(\"Enviando solicitação de limpeza em massa...\");\r\n\r\n            const res = await orionApi.delete('/production/schedule', {\r\n                scope: 'batch',\r\n                projectId: projectId || 'all',\r\n                companyId: companyId || '',\r\n                startDate: startDateStr,\r\n                endDate: endDateStr,\r\n                activityId: activityId\r\n            });\r\n\r\n            if (res.error) {\r\n                throw new Error(res.error.message);\r\n            }\r\n\r\n            return (res.data as any)?.count || 0;\r\n        },\r\n        onSuccess: (data) => {\r\n            const count = typeof data === 'object' ? data.count : data;\r\n            const skipped = typeof data === 'object' ? data.skipped : 0;\r\n\r\n            if (skipped > 0) {\r\n                toast.success(`${count} agendamentos removidos. ${skipped} foram preservados por já terem execução.`);\r\n            } else {\r\n                toast.success(`${count} agendamentos removidos com sucesso!`);\r\n            }\r\n\r\n            queryClient.invalidateQueries({ queryKey: [\"production-towers\"] });\r\n            queryClient.invalidateQueries({ queryKey: [\"production-schedule\"] });\r\n            queryClient.invalidateQueries({ queryKey: [\"production-status\"] });\r\n            setDeleteConfirmOpen(false);\r\n            setDeleteType(null);\r\n            setDeleteTargetDate(null);\r\n            setDeleteTargetActivityId(null);\r\n        },\r\n    });\r\n\r\n    const deleteUnitaryMutation = useMutation({\r\n        mutationFn: async (params: { scheduleId: string, targetDate: string }) => {\r\n            const res = await orionApi.delete('/production/schedule', {\r\n                scheduleId: params.scheduleId,\r\n                targetDate: params.targetDate // Send target date to allow smart splitting\r\n            });\r\n            if (res.error) throw new Error(res.error.message);\r\n            return res.data;\r\n        },\r\n        onSuccess: () => {\r\n            toast.success(\"Agendamento atualizado!\");\r\n            queryClient.invalidateQueries({ queryKey: [\"production-towers\"] });\r\n            queryClient.invalidateQueries({ queryKey: [\"production-schedule\"] });\r\n        },\r\n        onError: (err) => {\r\n            toast.error(`Erro ao remover: ${(err as Error).message}`);\r\n        }\r\n    });\r\n\r\n    const confirmDelete = (type: 'day' | 'week' | 'all' | 'project_all', date?: Date, weekId?: number, activityId?: string) => {\r\n        setDeleteType(type);\r\n        if (date) setDeleteTargetDate(date);\r\n\r\n        // Reset activity ID unless provided\r\n        setDeleteTargetActivityId(activityId || null);\r\n\r\n        if (weekId) {\r\n            setDeleteTargetWeekId(weekId);\r\n        } else if (type === 'week') {\r\n            // Default to current active week if not specified\r\n            setDeleteTargetWeekId(activeWeekId);\r\n        }\r\n        setDeleteConfirmOpen(true);\r\n    };\r\n\r\n    const lookAheadData = useMemo(() => {\r\n        if (!towers) return { activeWeekDays: [], rows: [], dailyTotals: [] };\r\n\r\n        // Get the active week and its days (Mon-Sun)\r\n        const activeWeek = weeks.find(w => w.id === activeWeekId) || weeks[0];\r\n        const daysList = Array.from({ length: 7 }).map((_, i) => {\r\n            const day = addDays(activeWeek.start, i);\r\n            return {\r\n                date: day,\r\n                label: format(day, 'EEEE', { locale: ptBR }),\r\n                shortLabel: format(day, 'EEE', { locale: ptBR }).toUpperCase(),\r\n                dayNum: format(day, 'dd/MM')\r\n            };\r\n        });\r\n\r\n        // Group by Activity ID\r\n        const activityGroups = new Map<string, any>();\r\n\r\n        towers.forEach(tower => {\r\n            tower.activitySchedules?.forEach(schedule => {\r\n                if (!schedule.plannedStart) return;\r\n\r\n                const actStart = parseLocalDate(schedule.plannedStart);\r\n                const actEnd = schedule.plannedEnd ? parseLocalDate(schedule.plannedEnd) : actStart;\r\n\r\n                // Check intersection with any day of the *active* week\r\n                const activityId = schedule.activityId;\r\n\r\n                if (!activityGroups.has(activityId)) {\r\n                    const activity = categories\r\n                        ?.flatMap(c => c.activities)\r\n                        .find(a => a.id === activityId);\r\n\r\n                    const categoryName = categories?.find(c => c.id === activity?.categoryId)?.name || 'Outros';\r\n\r\n                    activityGroups.set(activityId, {\r\n                        activityId,\r\n                        activityName: activity?.name || 'Desconhecida',\r\n                        categoryName,\r\n                        days: daysList.map(d => ({\r\n                            isScheduled: false,\r\n                            towers: [] as any[]\r\n                        }))\r\n                    });\r\n                }\r\n\r\n                const group = activityGroups.get(activityId);\r\n                const towerStatus = tower.activityStatuses?.find(s => s.activityId === activityId);\r\n\r\n                daysList.forEach((d, dIdx) => {\r\n                    // Use string comparison (YYYY-MM-DD) for absolute date matching regardless of timezone\r\n                    const dayKey = format(d.date, 'yyyy-MM-dd');\r\n                    const startKey = format(actStart, 'yyyy-MM-dd');\r\n                    const endKey = format(actEnd, 'yyyy-MM-dd');\r\n\r\n                    const overlapsDay = dayKey >= startKey && dayKey <= endKey;\r\n\r\n                    if (overlapsDay) {\r\n                        group.days[dIdx].isScheduled = true;\r\n                        group.days[dIdx].towers.push({\r\n                            id: tower.id,\r\n                            scheduleId: schedule.id, // Keep the schedule ID for unitary delete\r\n                            name: tower.objectId,\r\n                            status: towerStatus?.status || 'PENDING',\r\n                            progress: towerStatus?.progressPercent || 0,\r\n                            plannedQuantity: schedule.plannedQuantity || 0\r\n                        });\r\n                    }\r\n                });\r\n            });\r\n        });\r\n\r\n        // Ensure all activities exist if showAllActivities is true\r\n        if (showAllActivities && categories) {\r\n            categories.forEach(cat => {\r\n                cat.activities.forEach(act => {\r\n                    if (!activityGroups.has(act.id)) {\r\n                        activityGroups.set(act.id, {\r\n                            activityId: act.id,\r\n                            activityName: act.name,\r\n                            categoryName: cat.name,\r\n                            days: daysList.map(() => ({\r\n                                isScheduled: false,\r\n                                towers: [] as TowerProductionData[]\r\n                            }))\r\n                        });\r\n                    }\r\n                });\r\n            });\r\n        }\r\n\r\n        // Final Filter: Only rows that have at least one scheduled day in the active week\r\n        // OR if showAllActivities is true\r\n        const rowsList = Array.from(activityGroups.values())\r\n            .filter(row => showAllActivities || row.days.some((d: { isScheduled: boolean }) => d.isScheduled))\r\n            .map(row => ({\r\n                ...row,\r\n                daySchedules: row.days.map((d: { isScheduled: boolean; towers: TowerProductionData[] }) => {\r\n                    if (!d.isScheduled) return { isScheduled: false };\r\n\r\n                    const finishedCount = d.towers.filter((t: any) => t.status === 'FINISHED').length;\r\n                    const inProgressCount = d.towers.filter((t: any) => t.status === 'IN_PROGRESS').length;\r\n                    const totalProgress = d.towers.reduce((acc: number, t: any) => acc + Number(t.progress || 0), 0);\r\n\r\n                    let combinedStatus: ActivityStatus = 'PENDING';\r\n                    if (finishedCount === d.towers.length) combinedStatus = 'FINISHED';\r\n                    else if (inProgressCount > 0 || finishedCount > 0) combinedStatus = 'IN_PROGRESS';\r\n\r\n                    return {\r\n                        isScheduled: true,\r\n                        towers: d.towers,\r\n                        combinedStatus,\r\n                        avgProgress: d.towers.length > 0 ? Math.round(totalProgress / d.towers.length) : 0\r\n                    };\r\n                })\r\n            }));\r\n\r\n        rowsList.sort((a, b) => a.categoryName.localeCompare(b.categoryName) || a.activityName.localeCompare(b.activityName));\r\n\r\n        // Calculate Daily Totals\r\n        const dailyTotals = daysList.map((_, dIdx) => {\r\n            let towerCount = 0;\r\n            let totalQuantity = 0;\r\n            rowsList.forEach(row => {\r\n                const day = row.daySchedules[dIdx];\r\n                if (day.isScheduled) {\r\n                    towerCount += day.towers.length;\r\n                    totalQuantity += day.towers.reduce((acc: number, t: any) => acc + (t.plannedQuantity || 0), 0);\r\n                }\r\n            });\r\n            return { towerCount, totalQuantity };\r\n        });\r\n\r\n        return { activeWeekDays: daysList, rows: rowsList, dailyTotals };\r\n\r\n    }, [towers, categories, activeWeekId, weeks, showAllActivities]);\r\n\r\n    const { activeWeekDays, rows, dailyTotals } = lookAheadData;\r\n\r\n    const activeWeek = weeks.find(w => w.id === activeWeekId);\r\n\r\n\r\n    return (\r\n        <div className=\"space-y-4 animate-in fade-in slide-in-from-bottom-2 duration-700\">\r\n            {/* Week Tab Selector */}\r\n            <div className=\"grid grid-cols-6 gap-2 bg-slate-900/40 p-2 rounded-xl border border-white/5 backdrop-blur-md\">\r\n                {weeks.map(week => (\r\n                    <button\r\n                        key={week.id}\r\n                        onClick={() => setActiveWeekId(week.id)}\r\n                        className={cn(\r\n                            \"flex flex-col items-center justify-center p-3 rounded-lg border transition-all relative overflow-hidden group\",\r\n                            activeWeekId === week.id\r\n                                ? \"bg-amber-500/10 border-amber-500/50 shadow-glow-sm\"\r\n                                : \"bg-white/5 border-white/5 hover:bg-white/10 hover:border-white/20\"\r\n                        )}\r\n                    >\r\n                        {activeWeekId === week.id && (\r\n                            <div className=\"absolute top-0 left-0 w-full h-1 bg-amber-500 shadow-glow\" />\r\n                        )}\r\n                        <span className={cn(\r\n                            \"text-[10px] font-black uppercase tracking-widest transition-colors\",\r\n                            activeWeekId === week.id ? \"text-amber-500\" : \"text-slate-500 group-hover:text-slate-300\"\r\n                        )}>\r\n                            S{week.id}\r\n                        </span>\r\n                        <span className={cn(\r\n                            \"text-[9px] font-bold font-mono transition-colors\",\r\n                            activeWeekId === week.id ? \"text-white\" : \"text-slate-600 group-hover:text-slate-400\"\r\n                        )}>\r\n                            {week.dateRange}\r\n                        </span>\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Matrix Header / Controls */}\r\n            <div className=\"flex items-center justify-between bg-black/40 p-3 rounded-xl border border-white/5 backdrop-blur-md h-16\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <div className=\"flex items-center gap-3 border-r border-white/5 pr-4\">\r\n                        <div className=\"p-2 bg-emerald-500/10 rounded-lg\">\r\n                            <CalendarDays className=\"w-4 h-4 text-emerald-500\" />\r\n                        </div>\r\n                        <div>\r\n                            <h3 className=\"text-[10px] font-black text-white uppercase tracking-widest leading-none\">Visão Diária Detalhada</h3>\r\n                            <p className=\"text-[9px] text-slate-500 font-bold uppercase tracking-wider mt-1.5\">{activeWeek?.label} — {activeWeek?.dateRange}</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <Button\r\n                        size=\"sm\"\r\n                        variant=\"link\"\r\n                        className=\"text-[9px] font-black uppercase text-amber-500 hover:text-amber-400 gap-2 h-auto p-0\"\r\n                        onClick={() => activeWeek && onWeekClick?.(activeWeek.start)}\r\n                    >\r\n                        <Plus className=\"w-3 h-3\" />\r\n                        Programar p/ Lote nesta semana\r\n                    </Button>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-6\">\r\n                    <Button\r\n                        variant={showAllActivities ? \"secondary\" : \"ghost\"}\r\n                        size=\"sm\"\r\n                        onClick={() => setShowAllActivities(!showAllActivities)}\r\n                        className=\"text-[10px] uppercase font-black tracking-widest h-8\"\r\n                    >\r\n                        {showAllActivities ? \"Ocultar Vazios\" : \"Ver Tudo\"}\r\n                    </Button>\r\n\r\n                    {/* Bulk Actions Menu */}\r\n                    <DropdownMenu>\r\n                        <DropdownMenuTrigger asChild>\r\n                            <Button variant=\"ghost\" size=\"sm\" className=\"h-8 px-2 text-slate-400 hover:text-white hover:bg-white/5\">\r\n                                <MoreHorizontal className=\"w-4 h-4\" />\r\n                            </Button>\r\n                        </DropdownMenuTrigger>\r\n                        <DropdownMenuContent align=\"end\" className=\"bg-slate-950 border-white/10 w-56\">\r\n                            <DropdownMenuLabel className=\"text-[10px] font-black uppercase text-slate-500 tracking-widest\">Ações da Matriz</DropdownMenuLabel>\r\n                            <DropdownMenuSeparator className=\"bg-white/5\" />\r\n                            <DropdownMenuItem\r\n                                className=\"text-xs font-bold text-slate-300 focus:text-white focus:bg-white/5 cursor-pointer gap-2 my-1\"\r\n                                onClick={() => confirmDelete('week', undefined, activeWeekId)}\r\n                            >\r\n                                <CalendarX2 className=\"w-3.5 h-3.5\" />\r\n                                <span>Limpar Semana {activeWeekId}</span>\r\n                            </DropdownMenuItem>\r\n                            <DropdownMenuSeparator className=\"bg-white/5\" />\r\n                            <DropdownMenuItem\r\n                                className=\"text-xs font-bold text-red-500 focus:text-red-400 focus:bg-red-500/10 cursor-pointer gap-2 my-1\"\r\n                                onClick={() => confirmDelete('all')}\r\n                            >\r\n                                <Trash2 className=\"w-3.5 h-3.5\" />\r\n                                <span>Limpar TUDO (6 Semanas)</span>\r\n                            </DropdownMenuItem>\r\n                            <DropdownMenuItem\r\n                                className=\"text-xs font-bold text-red-600 focus:text-red-500 focus:bg-red-500/20 cursor-pointer gap-2 my-1\"\r\n                                onClick={() => confirmDelete('project_all')}\r\n                            >\r\n                                <AlertTriangle className=\"w-3.5 h-3.5\" />\r\n                                <span>LIMPAR PROJETO INTEIRO</span>\r\n                            </DropdownMenuItem>\r\n                        </DropdownMenuContent>\r\n                    </DropdownMenu>\r\n\r\n                    <div className=\"flex items-center gap-4 text-[9px] font-black uppercase tracking-widest text-slate-500\">\r\n                        <div className=\"flex items-center gap-1.5\"><div className=\"w-2 h-2 rounded-full bg-slate-700 shadow-glow-none\" /> Pendente</div>\r\n                        <div className=\"flex items-center gap-1.5\"><div className=\"w-2 h-2 rounded-full bg-amber-500 shadow-glow-sm\" /> Andamento</div>\r\n                        <div className=\"flex items-center gap-1.5\"><div className=\"w-2 h-2 rounded-full bg-emerald-500 shadow-glow-sm\" /> Concluído</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <ScrollArea className=\"h-[calc(100vh-380px)] border border-white/5 rounded-xl bg-black/40 shadow-2xl overflow-hidden\">\r\n                <Table className=\"border-collapse\">\r\n                    <TableHeader className=\"bg-slate-950/80 sticky top-0 z-20 backdrop-blur-xl\">\r\n                        <TableRow className=\"hover:bg-transparent border-white/10\">\r\n                            <TableHead className=\"w-[240px] bg-slate-950/90 border-r border-white/5 text-[10px] font-black uppercase text-amber-500 py-6 px-4 sticky left-0 z-30\">\r\n                                Atividade / Categoria\r\n                            </TableHead>\r\n                            {activeWeekDays.map((day, dIdx) => (\r\n                                <TableHead key={dIdx} className=\"min-w-[120px] text-center p-0 border-l border-white/5\">\r\n                                    <div className=\"flex flex-col items-center py-4 gap-1 group/header relative\">\r\n                                        <div className=\"flex items-center gap-1.5\">\r\n                                            <span className=\"text-[9px] font-black text-amber-500 bg-amber-500/10 px-1.5 py-0.5 rounded-md border border-amber-500/20\">{dIdx + 1}</span>\r\n                                            <span className=\"text-[11px] font-black uppercase tracking-tighter text-slate-300\">{day.shortLabel}</span>\r\n                                        </div>\r\n                                        <span className=\"text-[10px] font-black text-amber-500/70 font-mono tracking-widest\">{day.dayNum}</span>\r\n\r\n                                        {/* Daily Summary */}\r\n                                        {dailyTotals[dIdx] && dailyTotals[dIdx].towerCount > 0 && (\r\n                                            <div className=\"flex flex-col items-center mt-1 pt-1 border-t border-white/5 w-full\">\r\n                                                <div className=\"flex items-center gap-1.5\">\r\n                                                    <span className=\"text-[8px] font-black text-slate-400 uppercase\">T: {dailyTotals[dIdx].towerCount}</span>\r\n                                                    <span className=\"text-[8px] font-black text-emerald-500 uppercase\">Q: {dailyTotals[dIdx].totalQuantity}</span>\r\n                                                </div>\r\n                                            </div>\r\n                                        )}\r\n\r\n                                        {/* Day Clear Button */}\r\n                                        <button\r\n                                            onClick={() => confirmDelete('day', day.date)}\r\n                                            className=\"absolute top-1 right-1 p-1 rounded hover:bg-red-500/20 text-slate-600 hover:text-red-500 opacity-0 group-hover/header:opacity-100 transition-all\"\r\n                                            title=\"Limpar dia\"\r\n                                        >\r\n                                            <Trash2 className=\"w-3 h-3\" />\r\n                                        </button>\r\n                                    </div>\r\n                                </TableHead>\r\n                            ))}\r\n                        </TableRow>\r\n                    </TableHeader>\r\n                    <TableBody>\r\n                        {rows.length === 0 ? (\r\n                            <TableRow>\r\n                                <TableCell colSpan={8} className=\"h-48 text-center\">\r\n                                    <div className=\"flex flex-col items-center gap-3 opacity-30 grayscale group\">\r\n                                        <CalendarDays className=\"w-10 h-10 text-slate-500 transition-transform group-hover:scale-110\" />\r\n                                        <p className=\"text-[10px] font-black uppercase text-slate-700 tracking-[0.4em] font-mono\">\r\n                                            Nenhuma atividade programada para {activeWeek?.label}\r\n                                        </p>\r\n                                        <Button\r\n                                            variant=\"outline\"\r\n                                            size=\"sm\"\r\n                                            onClick={() => setShowAllActivities(true)}\r\n                                            className=\"opacity-0 group-hover:opacity-100 transition-opacity text-[10px] uppercase font-bold\"\r\n                                        >\r\n                                            Mostrar Todas as Atividades para Agendar\r\n                                        </Button>\r\n                                    </div>\r\n                                </TableCell>\r\n                            </TableRow>\r\n                        ) : (\r\n                            rows.map((row, idx) => (\r\n                                <TableRow key={idx} className=\"group hover:bg-slate-900/60 border-white/5 transition-all h-24\">\r\n                                    <TableCell className=\"w-[240px] bg-slate-950/40 border-r border-white/5 py-4 px-4 sticky left-0 z-10 group-hover:bg-slate-900 shadow-2xl\">\r\n                                        <div className=\"flex flex-col\">\r\n                                            <span className=\"text-[11px] font-black text-slate-100 uppercase tracking-tighter group-hover:text-amber-500 transition-colors\">\r\n                                                {row.activityName}\r\n                                            </span>\r\n                                            <span className=\"text-[9px] font-bold text-slate-500 uppercase truncate max-w-[200px] leading-tight mt-1 opacity-60\">\r\n                                                {row.categoryName}\r\n                                            </span>\r\n                                        </div>\r\n                                    </TableCell>\r\n\r\n                                    {row.daySchedules.map((cell: any, dIdx: number) => (\r\n                                        <TableCell key={dIdx} className=\"p-1 border-l border-white/5 text-center relative overflow-hidden group/cell\">\r\n                                            {cell.isScheduled ? (\r\n                                                <TooltipProvider>\r\n                                                    <Tooltip delayDuration={0}>\r\n                                                        <TooltipTrigger asChild>\r\n                                                            <div\r\n                                                                className={cn(\r\n                                                                    \"h-full w-full rounded-xl flex flex-col items-center justify-center p-2 gap-1.5 transition-all shadow-lg border cursor-pointer relative\",\r\n                                                                    cell.combinedStatus === 'FINISHED' ? 'bg-emerald-500/10 border-emerald-500/30' :\r\n                                                                        cell.combinedStatus === 'IN_PROGRESS' ? 'bg-amber-500/10 border-amber-500/30 shadow-amber-500/10' :\r\n                                                                            'bg-slate-800/30 border-white/5'\r\n                                                                )}\r\n                                                                onClick={() => {\r\n                                                                    // Open daily status or edit (future: daily detail modal)\r\n                                                                    if (onEditActivity && cell.towers.length === 1) {\r\n                                                                        onEditActivity(cell.towers[0].id, row.activityId);\r\n                                                                    }\r\n                                                                }}\r\n                                                            >\r\n                                                                {/* Tower Tags */}\r\n                                                                <div className=\"flex flex-wrap gap-1 justify-center max-w-full overflow-hidden items-center\">\r\n                                                                    {cell.towers.slice(0, 3).map((t: any) => (\r\n                                                                        <span key={t.id} className=\"text-[8px] font-black bg-white/5 px-1.5 py-0.5 rounded border border-white/10 text-slate-200 uppercase tracking-tighter\">\r\n                                                                            {t.name}\r\n                                                                        </span>\r\n                                                                    ))}\r\n                                                                    {cell.towers.length > 3 && (\r\n                                                                        <span className=\"text-[8px] font-black text-amber-500\">+{cell.towers.length - 3}</span>\r\n                                                                    )}\r\n                                                                </div>\r\n\r\n                                                                <div className=\"flex items-center gap-2\">\r\n                                                                    {cell.combinedStatus === 'FINISHED' ? (\r\n                                                                        <CheckCircle2 className=\"w-3.5 h-3.5 text-emerald-500\" />\r\n                                                                    ) : (\r\n                                                                        <span className={cn(\r\n                                                                            \"text-[10px] font-black tabular-nums\",\r\n                                                                            cell.combinedStatus === 'IN_PROGRESS' ? 'text-amber-500' : 'text-slate-500'\r\n                                                                        )}>\r\n                                                                            {cell.avgProgress}%\r\n                                                                        </span>\r\n                                                                    )}\r\n                                                                </div>\r\n\r\n                                                                {/* Progress Bar Micro-Indicator */}\r\n                                                                <div className=\"w-12 h-1 bg-white/5 rounded-full overflow-hidden shrink-0\">\r\n                                                                    <div\r\n                                                                        className={cn(\r\n                                                                            \"h-full transition-all duration-700 ease-out\",\r\n                                                                            cell.combinedStatus === 'FINISHED' ? 'bg-emerald-500' : 'bg-amber-500'\r\n                                                                        )}\r\n                                                                        style={{ width: `${cell.avgProgress}%` }}\r\n                                                                    />\r\n                                                                </div>\r\n\r\n                                                                {/* Helper Buttons Container */}\r\n                                                                <div className=\"absolute top-0.5 right-0.5 flex items-center gap-0.5 opacity-0 group-hover/cell:opacity-100 transition-all z-20\">\r\n                                                                    {/* Delete Button */}\r\n                                                                    <button\r\n                                                                        className=\"p-1 rounded-full bg-black/50 hover:bg-red-500 hover:text-white border border-white/10 text-slate-400 transition-all scale-75 hover:scale-100\"\r\n                                                                        onClick={(e) => {\r\n                                                                            e.stopPropagation();\r\n                                                                            const dayDate = activeWeekDays[dIdx].date;\r\n                                                                            confirmDelete('day', dayDate, undefined, row.activityId);\r\n                                                                        }}\r\n                                                                        title=\"Remover agendamento deste dia\"\r\n                                                                    >\r\n                                                                        <Trash2 className=\"w-3 h-3\" />\r\n                                                                    </button>\r\n\r\n                                                                    {/* Add Button */}\r\n                                                                    <button\r\n                                                                        className=\"p-1 rounded-full bg-black/50 hover:bg-amber-500 hover:text-black border border-white/10 text-slate-300 transition-all scale-75 hover:scale-100\"\r\n                                                                        onClick={(e) => {\r\n                                                                            e.stopPropagation();\r\n                                                                            const dayDate = activeWeekDays[dIdx].date;\r\n                                                                            const dateStr = format(dayDate, \"yyyy-MM-dd'T'12:00:00\");\r\n                                                                            onEditActivity?.('', row.activityId, dateStr, dateStr);\r\n                                                                        }}\r\n                                                                        title=\"Adicionar mais torres\"\r\n                                                                    >\r\n                                                                        <Plus className=\"w-3 h-3\" />\r\n                                                                    </button>\r\n                                                                </div>\r\n                                                            </div>\r\n                                                        </TooltipTrigger>\r\n                                                        <TooltipContent className=\"bg-slate-950 border-white/10 p-3 shadow-3xl z-50 rounded-xl\" side=\"bottom\">\r\n                                                            <div className=\"space-y-2 min-w-[180px]\">\r\n                                                                <div className=\"flex items-center justify-between border-b border-white/10 pb-2 mb-2\">\r\n                                                                    <span className=\"text-[10px] font-black text-amber-500 uppercase tracking-widest\">{activeWeekDays[dIdx].label}</span>\r\n                                                                    <span className=\"text-[10px] font-black text-slate-500\">{cell.towers.length} Torres</span>\r\n                                                                </div>\r\n                                                                <div className=\"space-y-1.5\">\r\n                                                                    {cell.towers.map((t: any) => (\r\n                                                                        <div key={t.id} className=\"flex items-center justify-between gap-4 p-1 rounded hover:bg-white/5 transition-colors\">\r\n                                                                            <div className=\"flex items-center gap-2\">\r\n                                                                                <div className={cn(\r\n                                                                                    \"w-1.5 h-1.5 rounded-full\",\r\n                                                                                    t.status === 'FINISHED' ? 'bg-emerald-500' :\r\n                                                                                        t.status === 'IN_PROGRESS' ? 'bg-amber-500' : 'bg-slate-700'\r\n                                                                                )} />\r\n                                                                                <span className=\"text-[10px] font-black text-slate-100 uppercase\">{t.name}</span>\r\n                                                                                {t.plannedQuantity > 0 && (\r\n                                                                                    <span className=\"text-[9px] font-black text-emerald-500/80\">Q: {t.plannedQuantity}</span>\r\n                                                                                )}\r\n                                                                            </div>\r\n                                                                            <div className=\"flex items-center gap-2\">\r\n                                                                                <span className=\"text-[9px] font-black text-slate-400 font-mono\">{t.progress}%</span>\r\n                                                                                <button\r\n                                                                                    onClick={(e) => {\r\n                                                                                        e.stopPropagation();\r\n                                                                                        if (t.scheduleId) {\r\n                                                                                            const dayDate = activeWeekDays[dIdx].date;\r\n                                                                                            const dateStr = format(dayDate, \"yyyy-MM-dd\");\r\n                                                                                            deleteUnitaryMutation.mutate({ scheduleId: t.scheduleId, targetDate: dateStr });\r\n                                                                                        }\r\n                                                                                    }}\r\n                                                                                    className=\"p-1 rounded-md hover:bg-red-500/20 text-slate-500 hover:text-red-500 transition-colors\"\r\n                                                                                    title=\"Remover agendamento desta torre neste dia\"\r\n                                                                                >\r\n                                                                                    <CalendarX2 className=\"w-3 h-3\" />\r\n                                                                                </button>\r\n                                                                            </div>\r\n                                                                        </div>\r\n                                                                    ))}\r\n                                                                </div>\r\n                                                                <div className=\"pt-2 text-[8px] text-slate-600 font-bold uppercase tracking-widest text-center border-t border-white/5\">Detalhes da Execução</div>\r\n                                                            </div>\r\n                                                        </TooltipContent>\r\n                                                    </Tooltip>\r\n                                                </TooltipProvider>\r\n                                            ) : (\r\n                                                /* Add button only visible on row hover or cell hover */\r\n                                                <div className=\"h-full w-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center\">\r\n                                                    <button\r\n                                                        className=\"h-8 w-8 rounded-full bg-white/5 border border-white/5 hover:bg-amber-500 hover:text-black flex items-center justify-center transition-all scale-75 group-hover/cell:scale-100\"\r\n                                                        onClick={() => {\r\n                                                            const dayDate = activeWeekDays[dIdx].date;\r\n                                                            // Use noon to avoid timezone shift\r\n                                                            const dateStr = format(dayDate, \"yyyy-MM-dd'T'12:00:00\");\r\n                                                            onEditActivity?.('', row.activityId, dateStr, dateStr);\r\n                                                        }}\r\n                                                    >\r\n                                                        <Plus className=\"w-4 h-4\" />\r\n                                                    </button>\r\n                                                </div>\r\n\r\n\r\n                                            )}\r\n\r\n                                        </TableCell>\r\n\r\n                                    ))}\r\n                                </TableRow>\r\n                            ))\r\n                        )}\r\n                    </TableBody>\r\n                </Table>\r\n\r\n                {/* Visual Glow Ends */}\r\n                <div className=\"absolute inset-x-0 bottom-0 h-10 bg-linear-to-t from-slate-950 to-transparent pointer-events-none\"></div>\r\n            </ScrollArea>\r\n\r\n            <AlertDialog open={deleteConfirmOpen} onOpenChange={setDeleteConfirmOpen}>\r\n                <AlertDialogContent className=\"bg-slate-950 border-white/10\">\r\n                    <AlertDialogHeader>\r\n                        <AlertDialogTitle className=\"text-white flex items-center gap-2\">\r\n                            <AlertTriangle className=\"w-5 h-5 text-red-500\" />\r\n                            Confirmar Limpeza de Cronograma\r\n                        </AlertDialogTitle>\r\n                        <AlertDialogDescription className=\"text-slate-400\">\r\n                            {deleteType === 'day' && !deleteTargetActivityId && `Tem certeza que deseja remover TODOS os agendamentos do dia ${deleteTargetDate ? format(deleteTargetDate, 'dd/MM') : ''}?`}\r\n                            {deleteType === 'day' && deleteTargetActivityId && `Tem certeza que deseja remover os agendamentos desta atividade no dia ${deleteTargetDate ? format(deleteTargetDate, 'dd/MM') : ''}?`}\r\n                            {deleteType === 'week' && `Tem certeza que deseja remover TODOS os agendamentos da Semana ${activeWeekId}?`}\r\n                            {deleteType === 'all' && \"ATENÇÃO: Isso removerá TODOS os agendamentos das próximas 6 SEMANAS. Essa ação não pode ser desfeita.\"}\r\n                            {deleteType === 'project_all' && \"⚠️ PERIGO EXTREMO: Isso removerá ABSOLUTAMENTE TODAS as programações deste PROJETO, independente da data. Use apenas se tiver certeza absoluta!\"}\r\n                            <br /><br />\r\n                            <span className=\"font-bold text-red-500/80 uppercase text-xs tracking-wider\">Essa ação é irreversível.</span>\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogCancel className=\"bg-transparent border-white/10 text-slate-300 hover:bg-white/5 hover:text-white uppercase text-xs font-bold\">Cancelar</AlertDialogCancel>\r\n                        <AlertDialogAction\r\n                            onClick={() => {\r\n                                if (!deleteType) return;\r\n                                toast.info(\"Iniciando limpeza em segundo plano...\");\r\n                                clearScheduleMutation.mutate({\r\n                                    type: deleteType,\r\n                                    targetWeekId: deleteTargetWeekId ?? undefined,\r\n                                    targetDate: deleteTargetDate ?? undefined,\r\n                                    activityId: deleteTargetActivityId ?? undefined\r\n                                });\r\n                            }}\r\n                            className=\"bg-red-600 hover:bg-red-500 text-white border-0 uppercase text-xs font-black tracking-widest\"\r\n                        >\r\n                            <Trash2 className=\"w-4 h-4 mr-2\" />\r\n                            Confirmar Limpeza\r\n                        </AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\production\\components\\TeamAnalyticsDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Employee' is defined but never used.","line":7,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Team' is defined but never used.","line":8,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'selectedProjectId' is defined but never used.","line":17,"column":61,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":78},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'functionDiversityData' is assigned a value but never used.","line":59,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":32}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\r\nimport {\r\n    PieChart, Pie, Cell, ResponsiveContainer, Tooltip,\r\n    BarChart, Bar, XAxis, YAxis, CartesianGrid, Legend\r\n} from 'recharts';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { useEmployees, Employee } from '@/hooks/useEmployees';\r\nimport { useTeams, Team } from '@/hooks/useTeams';\r\nimport { getLaborClassification } from '@/utils/laborUtils';\r\nimport { Users, HardHat, TrendingUp, PieChart as PieChartIcon, BarChart3, Loader2 } from 'lucide-react';\r\n\r\ninterface TeamAnalyticsDashboardProps {\r\n    projectId: string;\r\n    selectedSiteId?: string;\r\n}\r\n\r\nexport default function TeamAnalyticsDashboard({ projectId: selectedProjectId, selectedSiteId = 'all' }: TeamAnalyticsDashboardProps) {\r\n    const { employees, isLoading: loadingEmployees } = useEmployees();\r\n    const { teams, isLoading: loadingTeams } = useTeams();\r\n\r\n    const isLoading = loadingEmployees || loadingTeams;\r\n\r\n    // Data aggregation for MOD vs MOI\r\n    const modMoiData = useMemo(() => {\r\n        if (!employees.length || !teams.length) return [];\r\n\r\n        const assignedIds = new Set([\r\n            ...teams.flatMap(t => t.members),\r\n            ...teams.map(t => t.supervisorId).filter(Boolean) as string[]\r\n        ]);\r\n\r\n        const assignedEmployees = employees.filter(e => assignedIds.has(e.id));\r\n\r\n        const counts = assignedEmployees.reduce((acc, emp) => {\r\n            const laborType = getLaborClassification(emp.functionName);\r\n            acc[laborType] = (acc[laborType] || 0) + 1;\r\n            return acc;\r\n        }, { MOD: 0, MOI: 0 } as Record<string, number>);\r\n\r\n        return [\r\n            { name: 'MOD (Direta)', value: counts.MOD, color: '#10b981' },\r\n            { name: 'MOI (Indireta)', value: counts.MOI, color: '#3b82f6' }\r\n        ];\r\n    }, [employees, teams]);\r\n\r\n    // Data aggregation for Team Sizes\r\n    const teamSizesData = useMemo(() => {\r\n        return teams\r\n            .filter(t => (selectedSiteId === 'all' || t.siteId === selectedSiteId))\r\n            .map(t => ({\r\n                name: t.name,\r\n                total: t.members.length + (t.supervisorId ? 1 : 0)\r\n            }))\r\n            .sort((a, b) => b.total - a.total)\r\n            .slice(0, 10);\r\n    }, [teams, selectedSiteId]);\r\n\r\n    // Labor Diversity (Functions)\r\n    const functionDiversityData = useMemo(() => {\r\n        const assignedIds = new Set([\r\n            ...teams.flatMap(t => t.members),\r\n            ...teams.map(t => t.supervisorId).filter(Boolean) as string[]\r\n        ]);\r\n        const assignedEmployees = employees.filter(e => assignedIds.has(e.id));\r\n\r\n        const counts = assignedEmployees.reduce((acc, emp) => {\r\n            const func = emp.functionName || 'Outros';\r\n            acc[func] = (acc[func] || 0) + 1;\r\n            return acc;\r\n        }, {} as Record<string, number>);\r\n\r\n        return Object.entries(counts)\r\n            .map(([name, value]) => ({ name, value }))\r\n            .sort((a, b) => b.value - a.value)\r\n            .slice(0, 6);\r\n    }, [employees, teams]);\r\n\r\n    const stats = useMemo(() => {\r\n        const ids = new Set([\r\n            ...teams.flatMap(t => t.members),\r\n            ...teams.map(t => t.supervisorId).filter(Boolean) as string[]\r\n        ]);\r\n        const totalAllocated = ids.size;\r\n        const totalAvailable = employees.length;\r\n        const allocationRate = totalAvailable > 0 ? (totalAllocated / totalAvailable) * 100 : 0;\r\n\r\n        return {\r\n            totalAllocated,\r\n            allocationRate,\r\n            activeFronts: teams.length\r\n        };\r\n    }, [employees, teams]);\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"flex flex-col items-center justify-center min-h-[400px] gap-4\">\r\n                <Loader2 className=\"w-10 h-10 animate-spin text-primary\" />\r\n                <p className=\"text-white animate-pulse font-bold uppercase text-[10px] tracking-widest\">Calculando Alocação...</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in duration-500\">\r\n            {/* Key Metrics Row */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                <Card className=\"bg-slate-950/40 border-white/5 backdrop-blur-md\">\r\n                    <CardContent className=\"p-6 flex items-center justify-between\">\r\n                        <div>\r\n                            <p className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em]\">EFETIVO ALOCADO</p>\r\n                            <h3 className=\"text-2xl font-black mt-1 text-white\">{stats.totalAllocated}</h3>\r\n                        </div>\r\n                        <div className=\"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center border border-primary/20\">\r\n                            <Users className=\"text-primary w-5 h-5\" />\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <Card className=\"bg-slate-950/40 border-white/5 backdrop-blur-md\">\r\n                    <CardContent className=\"p-6 flex items-center justify-between\">\r\n                        <div>\r\n                            <p className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em]\">TAXA DE ALOCAÇÃO</p>\r\n                            <h3 className=\"text-2xl font-black mt-1 text-white\">{stats.allocationRate.toFixed(1)}%</h3>\r\n                        </div>\r\n                        <div className=\"w-10 h-10 rounded-xl bg-emerald-500/10 flex items-center justify-center border border-emerald-500/20\">\r\n                            <HardHat className=\"text-emerald-500 w-5 h-5\" />\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <Card className=\"bg-slate-950/40 border-white/5 backdrop-blur-md\">\r\n                    <CardContent className=\"p-6 flex items-center justify-between\">\r\n                        <div>\r\n                            <p className=\"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em]\">FRENTES ATIVAS</p>\r\n                            <h3 className=\"text-2xl font-black mt-1 text-white\">{stats.activeFronts}</h3>\r\n                        </div>\r\n                        <div className=\"w-10 h-10 rounded-xl bg-blue-500/10 flex items-center justify-center border border-blue-500/20\">\r\n                            <TrendingUp className=\"text-blue-500 w-5 h-5\" />\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                <Card className=\"bg-slate-950/40 border-white/5 backdrop-blur-md\">\r\n                    <CardHeader className=\"pb-2 border-b border-white/5\">\r\n                        <CardTitle className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2\">\r\n                            <PieChartIcon className=\"w-4 h-4 text-primary\" />\r\n                            Distribuição MOD/MOI\r\n                        </CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent className=\"h-[300px] pt-4\">\r\n                        <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                            <PieChart>\r\n                                <Pie\r\n                                    data={modMoiData}\r\n                                    cx=\"50%\"\r\n                                    cy=\"50%\"\r\n                                    innerRadius={60}\r\n                                    outerRadius={90}\r\n                                    paddingAngle={5}\r\n                                    dataKey=\"value\"\r\n                                    stroke=\"none\"\r\n                                >\r\n                                    {modMoiData.map((entry, index) => (\r\n                                        <Cell key={`cell-${index}`} fill={entry.color} />\r\n                                    ))}\r\n                                </Pie>\r\n                                <Tooltip contentStyle={{ backgroundColor: '#0f172a', borderColor: 'rgba(255,255,255,0.1)', borderRadius: '12px', fontSize: '10px' }} />\r\n                                <Legend verticalAlign=\"bottom\" height={36} formatter={(value) => <span className=\"text-[10px] font-bold uppercase text-slate-400\">{value}</span>} />\r\n                            </PieChart>\r\n                        </ResponsiveContainer>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <Card className=\"bg-slate-950/40 border-white/5 backdrop-blur-md\">\r\n                    <CardHeader className=\"pb-2 border-b border-white/5\">\r\n                        <CardTitle className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2\">\r\n                            <BarChart3 className=\"w-4 h-4 text-primary\" />\r\n                            Efetivo por Equipe\r\n                        </CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent className=\"h-[300px] pt-4\">\r\n                        <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                            <BarChart data={teamSizesData} layout=\"vertical\">\r\n                                <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(255,255,255,0.05)\" horizontal={false} />\r\n                                <XAxis type=\"number\" hide />\r\n                                <YAxis\r\n                                    dataKey=\"name\"\r\n                                    type=\"category\"\r\n                                    stroke=\"#6b7280\"\r\n                                    fontSize={9}\r\n                                    width={100}\r\n                                    tickLine={false}\r\n                                    axisLine={false}\r\n                                />\r\n                                <Tooltip contentStyle={{ backgroundColor: '#0f172a', borderColor: 'rgba(255,255,255,0.1)', borderRadius: '12px', fontSize: '10px' }} />\r\n                                <Bar dataKey=\"total\" fill=\"#8b5cf6\" radius={[0, 4, 4, 0]} name=\"Efetivo\" />\r\n                            </BarChart>\r\n                        </ResponsiveContainer>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\production\\components\\TowerFormModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'loading' is assigned a value but never used.","line":40,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setLoading' is assigned a value but never used.","line":40,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2105,2108],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2105,2108],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":105,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3617,3620],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3617,3620],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogDescription,\r\n    DialogFooter,\r\n} from \"@/components/ui/dialog\";\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Loader2 } from \"lucide-react\";\r\nimport { orionApi } from \"@/integrations/orion/client\";\r\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { toast } from \"sonner\";\r\nimport { TowerProductionData } from \"../types\";\r\n\r\ninterface TowerFormModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    projectId: string;\r\n    tower?: TowerProductionData | null;\r\n}\r\n\r\nconst TowerFormModal = ({\r\n    isOpen,\r\n    onClose,\r\n    projectId,\r\n    tower,\r\n}: TowerFormModalProps) => {\r\n    const queryClient = useQueryClient();\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const [formData, setFormData] = useState({\r\n        objectId: \"\",\r\n        trecho: \"\",\r\n        towerType: \"Autoportante\",\r\n        tipoFundacao: \"\",\r\n        totalConcreto: \"\",\r\n        pesoArmacao: \"\",\r\n        pesoEstrutura: \"\",\r\n        tramoLancamento: \"\",\r\n        tipificacaoEstrutura: \"\",\r\n        goForward: \"\",\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (tower) {\r\n            setFormData({\r\n                objectId: tower.objectId || \"\",\r\n                trecho: tower.trecho || \"\",\r\n                towerType: tower.towerType || \"Autoportante\",\r\n                tipoFundacao: tower.tipoFundacao || \"\",\r\n                totalConcreto: tower.totalConcreto?.toString() || \"\",\r\n                pesoArmacao: tower.pesoArmacao?.toString() || \"\",\r\n                pesoEstrutura: tower.pesoEstrutura?.toString() || \"\",\r\n                tramoLancamento: tower.tramoLancamento || \"\",\r\n                tipificacaoEstrutura: tower.tipificacaoEstrutura || \"\",\r\n                goForward: (tower as any).goForward?.toString() || \"\",\r\n            });\r\n        } else {\r\n            setFormData({\r\n                objectId: \"\",\r\n                trecho: \"\",\r\n                towerType: \"Autoportante\",\r\n                tipoFundacao: \"\",\r\n                totalConcreto: \"\",\r\n                pesoArmacao: \"\",\r\n                pesoEstrutura: \"\",\r\n                tramoLancamento: \"\",\r\n                tipificacaoEstrutura: \"\",\r\n                goForward: \"\",\r\n            });\r\n        }\r\n    }, [tower, isOpen]);\r\n\r\n    const saveMutation = useMutation({\r\n        mutationFn: async () => {\r\n            const payload = {\r\n                ...formData,\r\n                projectId,\r\n                id: tower?.id,\r\n                totalConcreto: formData.totalConcreto ? parseFloat(formData.totalConcreto) : null,\r\n                pesoArmacao: formData.pesoArmacao ? parseFloat(formData.pesoArmacao) : null,\r\n                pesoEstrutura: formData.pesoEstrutura ? parseFloat(formData.pesoEstrutura) : null,\r\n                goForward: formData.goForward ? parseFloat(formData.goForward) : null,\r\n            };\r\n\r\n            const response = await orionApi.post(\"/tower_technical_data\", [payload]);\r\n            return response.data;\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"production-towers\"] });\r\n            toast.success(tower ? \"Torre atualizada com sucesso\" : \"Torre adicionada com sucesso\");\r\n            onClose();\r\n        },\r\n        onError: (error: any) => {\r\n            toast.error(\"Erro ao salvar torre: \" + (error.response?.data?.message || error.message));\r\n        },\r\n    });\r\n\r\n    const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const { name, value } = e.target;\r\n        setFormData(prev => ({ ...prev, [name]: value }));\r\n    };\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={onClose}>\r\n            <DialogContent className=\"sm:max-w-[500px]\">\r\n                <DialogHeader>\r\n                    <DialogTitle>{tower ? \"Editar Torre\" : \"Adicionar Nova Torre\"}</DialogTitle>\r\n                    <DialogDescription>\r\n                        {tower ? \"Atualize os detalhes técnicos desta torre.\" : \"Preencha as informações técnicas para cadastrar uma nova torre.\"}\r\n                    </DialogDescription>\r\n                </DialogHeader>\r\n                <div className=\"grid gap-4 py-4\">\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"objectId\">Número da Torre (ID)</Label>\r\n                            <Input\r\n                                id=\"objectId\"\r\n                                name=\"objectId\"\r\n                                value={formData.objectId}\r\n                                onChange={handleChange}\r\n                                placeholder=\"ex: 0/1\"\r\n                            />\r\n                        </div>\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"trecho\">Trecho</Label>\r\n                            <Input\r\n                                id=\"trecho\"\r\n                                name=\"trecho\"\r\n                                value={formData.trecho}\r\n                                onChange={handleChange}\r\n                                placeholder=\"ex: L1\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"towerType\">Tipo de Torre</Label>\r\n                            <Select\r\n                                value={formData.towerType}\r\n                                onValueChange={(val) => setFormData(prev => ({ ...prev, towerType: val }))}\r\n                            >\r\n                                <SelectTrigger>\r\n                                    <SelectValue placeholder=\"Selecione o tipo\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"Autoportante\">Autoportante</SelectItem>\r\n                                    <SelectItem value=\"Estaiada\">Estaiada</SelectItem>\r\n                                    <SelectItem value=\"Pórtico\">Pórtico</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"tipoFundacao\">Tipo de Fundação</Label>\r\n                            <Input\r\n                                id=\"tipoFundacao\"\r\n                                name=\"tipoFundacao\"\r\n                                value={formData.tipoFundacao}\r\n                                onChange={handleChange}\r\n                                placeholder=\"ex: Grelha\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-3 gap-4\">\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"totalConcreto\">Concreto (m³)</Label>\r\n                            <Input\r\n                                id=\"totalConcreto\"\r\n                                name=\"totalConcreto\"\r\n                                type=\"number\"\r\n                                step=\"0.01\"\r\n                                value={formData.totalConcreto}\r\n                                onChange={handleChange}\r\n                            />\r\n                        </div>\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"pesoArmacao\">Armação (ton)</Label>\r\n                            <Input\r\n                                id=\"pesoArmacao\"\r\n                                name=\"pesoArmacao\"\r\n                                type=\"number\"\r\n                                step=\"0.001\"\r\n                                value={formData.pesoArmacao}\r\n                                onChange={handleChange}\r\n                            />\r\n                        </div>\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"pesoEstrutura\">Estrutura (ton)</Label>\r\n                            <Input\r\n                                id=\"pesoEstrutura\"\r\n                                name=\"pesoEstrutura\"\r\n                                type=\"number\"\r\n                                step=\"0.001\"\r\n                                value={formData.pesoEstrutura}\r\n                                onChange={handleChange}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"tramoLancamento\">Tramo de Lançamento</Label>\r\n                            <Input\r\n                                id=\"tramoLancamento\"\r\n                                name=\"tramoLancamento\"\r\n                                value={formData.tramoLancamento}\r\n                                onChange={handleChange}\r\n                            />\r\n                        </div>\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"tipificacaoEstrutura\">Tipificação</Label>\r\n                            <Input\r\n                                id=\"tipificacaoEstrutura\"\r\n                                name=\"tipificacaoEstrutura\"\r\n                                value={formData.tipificacaoEstrutura}\r\n                                onChange={handleChange}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-1 gap-4\">\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"goForward\">Vão Vante (m)</Label>\r\n                            <Input\r\n                                id=\"goForward\"\r\n                                name=\"goForward\"\r\n                                type=\"number\"\r\n                                step=\"0.001\"\r\n                                value={formData.goForward}\r\n                                onChange={handleChange}\r\n                                placeholder=\"ex: 450\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <DialogFooter>\r\n                    <Button variant=\"outline\" onClick={onClose} disabled={saveMutation.isPending}>\r\n                        Cancelar\r\n                    </Button>\r\n                    <Button onClick={() => saveMutation.mutate()} disabled={saveMutation.isPending}>\r\n                        {saveMutation.isPending && (\r\n                            <Loader2 key=\"loader-icon\" className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                        )}\r\n                        {tower ? \"Salvar Alterações\" : \"Criar Torre\"}\r\n                    </Button>\r\n                </DialogFooter>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n};\r\n\r\nexport default TowerFormModal;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\production\\pages\\ProductionAnalyticsPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Filter' is defined but never used.","line":20,"column":65,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":71},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'toast' is defined but never used.","line":26,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4188,4191],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4188,4191],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from \"react\";\r\nimport { useQuery } from \"@tanstack/react-query\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { orionApi } from \"@/integrations/orion/client\";\r\nimport { kpiService } from \"@/services/kpiService\";\r\nimport { TowerProductionData } from \"../types\";\r\nimport ProductionDashboard from \"../components/ProductionDashboard\";\r\nimport ProductionCostDashboard from \"../components/ProductionCostDashboard\";\r\nimport SixWeekLookAhead from \"../components/SixWeekLookAhead\";\r\nimport LaborAnalyticsDashboard from \"../components/LaborAnalyticsDashboard\";\r\nimport TeamAnalyticsDashboard from \"../components/TeamAnalyticsDashboard\";\r\nimport CostConfigurationModal from \"../components/CostConfigurationModal\";\r\nimport ActivityStatusModal from \"../components/ActivityStatusModal\";\r\nimport QuickScheduleModal from \"../components/QuickScheduleModal\";\r\nimport BulkScheduleModal from \"../components/BulkScheduleModal\";\r\nimport TowerFormModal from \"../components/TowerFormModal\";\r\nimport ExcelImportModal from \"../components/ExcelImportModal\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { ArrowLeft, BarChart3, Coins, CalendarClock, Settings2, Filter, Layers, Plus, Upload, TrendingUp, Users } from \"lucide-react\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { useProjects } from \"@/hooks/useProjects\";\r\nimport { ProjectSelector } from \"@/components/shared/ProjectSelector\";\r\nimport { TowerActivityStatus } from \"../types\";\r\nimport { toast } from \"sonner\";\r\nimport { ProjectEmptyState } from \"@/components/shared/ProjectEmptyState\";\r\nimport { useUsers } from \"@/hooks/useUsers\";\r\nimport { Loader2 } from \"lucide-react\";\r\n\r\nconst ProductionAnalyticsPage = () => {\r\n    const { profile } = useAuth();\r\n    const navigate = useNavigate();\r\n    const { projects } = useProjects();\r\n    const [selectedProjectId, setSelectedProjectId] = useState<string>(profile?.projectId || 'all');\r\n    const [timeRange, setTimeRange] = useState<string>('month');\r\n    const [activeTab, setActiveTab] = useState(\"overview\");\r\n    const [isConfigOpen, setIsConfigOpen] = useState(false);\r\n    const [isTowerModalOpen, setIsTowerModalOpen] = useState(false);\r\n    const [isImportModalOpen, setIsImportModalOpen] = useState(false);\r\n    const [selectedCell, setSelectedCell] = useState<{\r\n        towerId: string;\r\n        towerName: string;\r\n        towerType: string | null;\r\n        activityId: string;\r\n        activityName: string;\r\n        status?: TowerActivityStatus;\r\n    } | null>(null);\r\n\r\n    const [selectedScheduleCell, setSelectedScheduleCell] = useState<{\r\n        towerId: string;\r\n        towerName: string;\r\n        activityId: string;\r\n        activityName: string;\r\n        plannedStart?: string;\r\n        plannedEnd?: string;\r\n    } | null>(null);\r\n\r\n    const [selectedBulkWeek, setSelectedBulkWeek] = useState<Date | null>(null);\r\n    const isGod = (profile?.role as string) === 'SUPER_ADMIN' || (profile?.role as string) === 'SUPER_ADMIN_GOD' || (profile?.role as string) === 'ADMIN' || !!profile?.isSystemAdmin;\r\n\r\n    const projectId = selectedProjectId;\r\n    const { users } = useUsers();\r\n\r\n    // --- Queries ---\r\n\r\n    const { data: towers, isLoading: loadingTowers } = useQuery({\r\n        queryKey: [\"production-towers\", projectId, profile?.companyId],\r\n        queryFn: async () => {\r\n            const companyIdParam = isGod ? 'all' : profile?.companyId;\r\n            const response = await orionApi.get(`/production/tower-status?projectId=${projectId}&companyId=${companyIdParam}`);\r\n            return response.data as TowerProductionData[];\r\n        },\r\n        enabled: !!profile?.companyId,\r\n        staleTime: 0,\r\n        refetchOnWindowFocus: true,\r\n        refetchOnMount: true\r\n    });\r\n\r\n    const { data: categories } = useQuery({\r\n        queryKey: [\"production-categories\"],\r\n        queryFn: async () => {\r\n            const response = await orionApi.get(\"/production/categories\");\r\n            return response.data as any[];\r\n        }\r\n    });\r\n\r\n    // Fetched specifically for the Financial Tab, but available globally now\r\n    const { data: unitCosts } = useQuery({\r\n        queryKey: [\"unit-costs\", projectId],\r\n        queryFn: () => kpiService.getUnitCosts(projectId),\r\n        enabled: !!projectId && projectId !== 'all'\r\n    });\r\n\r\n    const currentProjectName = projects.find(p => p.id === projectId)?.name || \"Todas as Obras\";\r\n\r\n    return (\r\n        <div className=\"h-screen w-full bg-background flex flex-col overflow-hidden font-sans\">\r\n            {/* Header */}\r\n            <header className=\"shrink-0 flex items-center justify-between px-6 py-4 border-b border-primary/20 bg-background/95 backdrop-blur-xl z-50 shadow-2xl relative\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <Button\r\n                        variant=\"ghost\"\r\n                        size=\"icon\"\r\n                        onClick={() => navigate('/producao')}\r\n                        className=\"rounded-full hover:bg-primary/10\"\r\n                    >\r\n                        <ArrowLeft className=\"h-5 w-5 text-muted-foreground\" />\r\n                    </Button>\r\n                    <div className=\"flex flex-col\">\r\n                        <h1 className=\"text-xl md:text-2xl font-black tracking-tighter bg-linear-to-r from-primary via-primary to-primary/40 bg-clip-text text-transparent uppercase italic drop-shadow-sm flex items-center gap-2\">\r\n                            <Layers className=\"h-6 w-6 text-primary\" />\r\n                            ANALYTICS DE PRODUÇÃO\r\n                        </h1>\r\n                        <p className=\"text-muted-foreground text-[10px] font-bold uppercase tracking-[0.3em] pl-1\">\r\n                            Indicadores, Custos e Metas - {currentProjectName}\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-3\">\r\n                    <Button\r\n                        variant=\"outline\"\r\n                        size=\"sm\"\r\n                        className=\"border-primary/20 hover:bg-primary/10 text-foreground font-bold h-9 px-4 rounded-lg uppercase text-[10px] tracking-wider\"\r\n                        onClick={() => setIsImportModalOpen(true)}\r\n                    >\r\n                        <Upload className=\"h-3.5 w-3.5 mr-2 text-primary\" />\r\n                        Importar\r\n                    </Button>\r\n                    <Button\r\n                        size=\"sm\"\r\n                        className=\"gap-2 shadow-lg shadow-primary/30 hover:shadow-primary/50 gradient-primary border-none text-primary-foreground font-black uppercase tracking-wider h-9 px-4 rounded-lg text-[10px]\"\r\n                        onClick={() => setIsTowerModalOpen(true)}\r\n                    >\r\n                        <Plus className=\"h-4 w-4\" />\r\n                        Nova Torre\r\n                    </Button>\r\n\r\n                    <div className=\"h-8 w-px bg-white/10 mx-1\" />\r\n\r\n                    {/* Show Config Button only if on Financial Tab or generally available? */}\r\n                    {activeTab === 'financial' && projectId !== 'all' && (\r\n                        <Button\r\n                            variant=\"outline\"\r\n                            size=\"sm\"\r\n                            className=\"border-amber-500/30 text-amber-500 hover:bg-amber-500/10 uppercase text-[10px] font-bold tracking-wider animate-in fade-in zoom-in duration-300\"\r\n                            onClick={() => setIsConfigOpen(true)}\r\n                        >\r\n                            <Settings2 className=\"h-3.5 w-3.5 mr-2\" />\r\n                            Configurar Custos\r\n                        </Button>\r\n                    )}\r\n\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <Select value={timeRange} onValueChange={setTimeRange}>\r\n                            <SelectTrigger className=\"bg-slate-900/50 border-white/10 h-9 text-[10px] font-bold uppercase tracking-wider w-[140px] rounded-lg\">\r\n                                <CalendarClock className=\"w-3.5 h-3.5 mr-2 text-primary\" />\r\n                                <SelectValue placeholder=\"Período\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent className=\"bg-slate-950 border-white/10\">\r\n                                <SelectItem value=\"week\">Semana</SelectItem>\r\n                                <SelectItem value=\"month\">Mês</SelectItem>\r\n                                <SelectItem value=\"quarter\">Trimestre</SelectItem>\r\n                                <SelectItem value=\"year\">Ano</SelectItem>\r\n                            </SelectContent>\r\n                        </Select>\r\n\r\n                        <ProjectSelector\r\n                            value={selectedProjectId}\r\n                            onValueChange={setSelectedProjectId}\r\n                            className=\"w-[200px]\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n            </header>\r\n\r\n            <main className=\"flex-1 overflow-auto p-6 bg-black/20\">\r\n                <div className=\"max-w-7xl mx-auto space-y-6\">\r\n\r\n                    <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full space-y-6\">\r\n                        <div className=\"flex items-center justify-center\">\r\n                            <TabsList className=\"bg-slate-950/60 border border-white/10 p-1 h-11 w-full max-w-2xl shadow-2xl shadow-black/50 overflow-x-auto\">\r\n                                <TabsTrigger\r\n                                    value=\"overview\"\r\n                                    className=\"flex-1 text-[10px] uppercase font-black tracking-widest data-[state=active]:bg-sky-500 data-[state=active]:text-black transition-all duration-300\"\r\n                                >\r\n                                    <BarChart3 className=\"w-3.5 h-3.5 mr-2\" />\r\n                                    Andamento Obra\r\n                                </TabsTrigger>\r\n                                <TabsTrigger\r\n                                    value=\"physics\"\r\n                                    className=\"flex-1 text-[10px] uppercase font-black tracking-widest data-[state=active]:bg-sky-500 data-[state=active]:text-black transition-all duration-300\"\r\n                                >\r\n                                    <TrendingUp className=\"w-3.5 h-3.5 mr-2\" />\r\n                                    Físico (Curva S)\r\n                                </TabsTrigger>\r\n                                <TabsTrigger\r\n                                    value=\"schedule\"\r\n                                    className=\"flex-1 text-[10px] uppercase font-black tracking-widest data-[state=active]:bg-emerald-500 data-[state=active]:text-black transition-all duration-300\"\r\n                                >\r\n                                    <CalendarClock className=\"w-3.5 h-3.5 mr-2\" />\r\n                                    Programação\r\n                                </TabsTrigger>\r\n                                <TabsTrigger\r\n                                    value=\"financial\"\r\n                                    className=\"flex-1 text-[10px] uppercase font-black tracking-widest data-[state=active]:bg-amber-500 data-[state=active]:text-black transition-all duration-300\"\r\n                                >\r\n                                    <Coins className=\"w-3.5 h-3.5 mr-2\" />\r\n                                    Financeiro\r\n                                </TabsTrigger>\r\n                                <TabsTrigger\r\n                                    value=\"teams\"\r\n                                    className=\"flex-1 text-[10px] uppercase font-black tracking-widest data-[state=active]:bg-purple-500 data-[state=active]:text-black transition-all duration-300\"\r\n                                >\r\n                                    <Users className=\"w-3.5 h-3.5 mr-2\" />\r\n                                    Análise Equipe\r\n                                </TabsTrigger>\r\n                            </TabsList>\r\n                        </div>\r\n\r\n                        {loadingTowers ? (\r\n                            <div className=\"flex flex-col items-center justify-center min-h-[400px] gap-4\">\r\n                                <Loader2 className=\"h-10 w-10 text-primary animate-spin\" />\r\n                                <p className=\"text-white animate-pulse font-bold\">Consolidando dados...</p>\r\n                            </div>\r\n                        ) : !towers || towers.length === 0 ? (\r\n                            <div className=\"flex items-center justify-center min-h-[500px]\">\r\n                                <ProjectEmptyState\r\n                                    type=\"towers\"\r\n                                    title=\"Nenhuma Torre para Analisar\"\r\n                                    description=\"Não há dados de produção disponíveis para esta obra. Comece cadastrando as torres e subtrechos na tela de planejamento.\"\r\n                                    onAction={() => navigate('/producao')}\r\n                                    actionLabel=\"Ir para Planejamento\"\r\n                                />\r\n                            </div>\r\n                        ) : (\r\n                            <>\r\n                                <TabsContent value=\"overview\" className=\"animate-in slide-in-from-left-4 fade-in duration-500 focus-visible:outline-none\">\r\n                                    <LaborAnalyticsDashboard\r\n                                        projectId={projectId}\r\n                                        projects={projects}\r\n                                        timeRange={timeRange}\r\n                                    />\r\n                                </TabsContent>\r\n\r\n                                <TabsContent value=\"physics\" className=\"animate-in slide-in-from-left-4 fade-in duration-500 focus-visible:outline-none\">\r\n                                    <ProductionDashboard\r\n                                        projectId={projectId}\r\n                                        towers={towers || []}\r\n                                        categories={categories || []}\r\n                                    />\r\n                                </TabsContent>\r\n\r\n                                <TabsContent value=\"financial\" className=\"animate-in slide-in-from-right-4 fade-in duration-500 focus-visible:outline-none\">\r\n                                    <ProductionCostDashboard\r\n                                        projectId={projectId}\r\n                                        towers={towers || []}\r\n                                        categories={categories || []}\r\n                                        unitCosts={unitCosts || []}\r\n                                    />\r\n                                </TabsContent>\r\n\r\n                                <TabsContent value=\"schedule\" className=\"animate-in zoom-in-95 fade-in duration-500 focus-visible:outline-none\">\r\n                                    <SixWeekLookAhead\r\n                                        towers={towers || []}\r\n                                        categories={categories || []}\r\n                                        projectId={projectId}\r\n                                        companyId={profile?.companyId}\r\n                                        onEditActivity={(towerId, activityId, plannedStart, plannedEnd) => {\r\n                                            const tower = towers?.find(t => t.id === towerId);\r\n                                            const activity = categories?.flatMap(c => c.activities).find(a => a.id === activityId);\r\n\r\n                                            if ((tower || !towerId) && activity) {\r\n                                                setSelectedScheduleCell({\r\n                                                    towerId: tower ? tower.id : \"\",\r\n                                                    towerName: tower ? tower.objectId : \"\",\r\n                                                    activityId: activity.id,\r\n                                                    activityName: activity.name,\r\n                                                    plannedStart,\r\n                                                    plannedEnd\r\n                                                });\r\n                                            }\r\n                                        }}\r\n                                        onWeekClick={(startDate) => setSelectedBulkWeek(startDate)}\r\n                                    />\r\n                                </TabsContent>\r\n\r\n                                <TabsContent value=\"teams\" className=\"animate-in slide-in-from-right-4 fade-in duration-500 focus-visible:outline-none\">\r\n                                    {(!towers || towers.length === 0) ? (\r\n                                        <div className=\"flex items-center justify-center min-h-[400px]\">\r\n                                            <ProjectEmptyState\r\n                                                type=\"towers\"\r\n                                                title=\"Sem Dados de Equipe\"\r\n                                                description=\"A análise de equipe requer que existam torres e atividades cadastradas para correlacionar o desempenho.\"\r\n                                                onAction={() => navigate('/producao')}\r\n                                                actionLabel=\"Ir para Produção\"\r\n                                            />\r\n                                        </div>\r\n                                    ) : (!users || users.length === 0) ? (\r\n                                        <div className=\"flex items-center justify-center min-h-[400px]\">\r\n                                            <ProjectEmptyState\r\n                                                type=\"workers\"\r\n                                                title=\"Equipes Não Configuradas\"\r\n                                                description=\"Para visualizar a análise de equipe, é necessário alocar funcionários e frentes de trabalho para esta obra.\"\r\n                                                onAction={() => navigate('/usuarios')}\r\n                                                actionLabel=\"Gerenciar Equipes\"\r\n                                            />\r\n                                        </div>\r\n                                    ) : (\r\n                                        <TeamAnalyticsDashboard\r\n                                            projectId={projectId}\r\n                                        />\r\n                                    )}\r\n                                </TabsContent>\r\n                            </>\r\n                        )}\r\n                    </Tabs>\r\n\r\n                </div>\r\n            </main >\r\n\r\n            {/* Modals */}\r\n            {\r\n                selectedCell && (\r\n                    <ActivityStatusModal\r\n                        isOpen={!!selectedCell}\r\n                        onClose={() => setSelectedCell(null)}\r\n                        elementId={selectedCell.towerId}\r\n                        towerName={selectedCell.towerName}\r\n                        towerType={selectedCell.towerType}\r\n                        activityId={selectedCell.activityId}\r\n                        activityName={selectedCell.activityName}\r\n                        currentStatus={selectedCell.status}\r\n                        projectId={projectId}\r\n                    />\r\n                )\r\n            }\r\n\r\n            {\r\n                selectedScheduleCell && (\r\n                    <QuickScheduleModal\r\n                        isOpen={!!selectedScheduleCell}\r\n                        onClose={() => setSelectedScheduleCell(null)}\r\n                        towerId={selectedScheduleCell.towerId}\r\n                        towerName={selectedScheduleCell.towerName}\r\n                        activityId={selectedScheduleCell.activityId}\r\n                        activityName={selectedScheduleCell.activityName}\r\n                        projectId={projectId}\r\n                        initialPlannedStart={selectedScheduleCell.plannedStart}\r\n                        initialPlannedEnd={selectedScheduleCell.plannedEnd}\r\n                        availableTowers={towers || []}\r\n                    />\r\n                )\r\n            }\r\n\r\n            <TowerFormModal\r\n                isOpen={isTowerModalOpen}\r\n                onClose={() => setIsTowerModalOpen(false)}\r\n                projectId={projectId!}\r\n                tower={null}\r\n            />\r\n\r\n            <ExcelImportModal\r\n                isOpen={isImportModalOpen}\r\n                onClose={() => setIsImportModalOpen(false)}\r\n                projectId={projectId!}\r\n            />\r\n\r\n            {\r\n                selectedBulkWeek && (\r\n                    <BulkScheduleModal\r\n                        isOpen={!!selectedBulkWeek}\r\n                        onClose={() => setSelectedBulkWeek(null)}\r\n                        towers={towers || []}\r\n                        categories={categories || []}\r\n                        defaultStartDate={selectedBulkWeek}\r\n                        projectId={projectId}\r\n                    />\r\n                )\r\n            }\r\n\r\n            {\r\n                projectId !== 'all' && (\r\n                    <CostConfigurationModal\r\n                        isOpen={isConfigOpen}\r\n                        onClose={() => setIsConfigOpen(false)}\r\n                        projectId={projectId}\r\n                    />\r\n                )\r\n            }\r\n        </div >\r\n    );\r\n};\r\n\r\nexport default ProductionAnalyticsPage;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\production\\pages\\ProductionPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'format' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Filter' is defined but never used.","line":17,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'DelayCostModal' is defined but never used.","line":25,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'DollarSign' is defined but never used.","line":29,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Coins' is defined but never used.","line":29,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TrendingUp' is defined but never used.","line":29,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":60}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport { useQuery } from \"@tanstack/react-query\";\r\nimport { format } from \"date-fns\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport {\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableHead,\r\n    TableHeader,\r\n    TableRow\r\n} from \"@/components/ui/table\";\r\nimport { Card } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Search, Filter, HardHat, Info, Plus, Upload, Edit2, Trash2, ArrowUpDown, ArrowUp, ArrowDown, Loader2 } from \"lucide-react\";\r\nimport { orionApi } from \"@/integrations/orion/client\";\r\nimport { TowerProductionData, ProductionCategory, TowerActivityStatus } from \"../types\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport ActivityStatusModal from \"../components/ActivityStatusModal\";\r\nimport TowerFormModal from \"../components/TowerFormModal\";\r\nimport ExcelImportModal from \"../components/ExcelImportModal\";\r\nimport DelayCostModal from \"../components/DelayCostModal\";\r\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { toast } from \"sonner\";\r\nimport { DollarSign, BarChart3, Coins, Activity, TrendingUp, LayoutGrid } from \"lucide-react\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { useWorkStages } from \"@/hooks/useWorkStages\";\r\nimport { useTimeRecords } from \"@/hooks/useTimeRecords\";\r\nimport { useSites } from \"@/hooks/useSites\";\r\nimport GAPOProgressTracker from \"@/components/gapo/GAPOProgressTracker\";\r\nimport GAPOAnalyticsPanel from \"@/components/gapo/GAPOAnalyticsPanel\";\r\nimport { ProjectSelector } from \"@/components/shared/ProjectSelector\";\r\nimport { ProjectEmptyState } from \"@/components/shared/ProjectEmptyState\";\r\nimport { useUsers } from \"@/hooks/useUsers\";\r\n\r\n// Memoized Row Component for extreme performance\r\nconst ProductionTableRow = React.memo(({\r\n    tower,\r\n    idx,\r\n    categories,\r\n    onDelete,\r\n    onEdit,\r\n    onSelectCell,\r\n    isPending\r\n}: {\r\n    tower: TowerProductionData;\r\n    idx: number;\r\n    categories: ProductionCategory[] | undefined;\r\n    onDelete: (id: string, name: string) => void;\r\n    onEdit: (tower: TowerProductionData) => void;\r\n    onSelectCell: (cell: {\r\n        towerId: string;\r\n        towerName: string;\r\n        towerType: string | null;\r\n        activityId: string;\r\n        activityName: string;\r\n        status?: TowerActivityStatus;\r\n    }) => void;\r\n    isPending: boolean;\r\n}) => {\r\n    return (\r\n        <TableRow key={tower.id} className={cn(\r\n            \"group/row transition-colors border-b border-amber-900/10\",\r\n            idx % 2 === 0 ? \"bg-white/1.5\" : \"bg-transparent\"\r\n        )}>\r\n            {/* FROZEN CELLS */}\r\n            <TableCell className=\"sticky left-0 bg-[#0a0806] group-hover/row:bg-[#1a1612] z-30 border-r border-amber-900/20 text-center p-2 transition-colors shadow-[1px_0_3px_rgba(0,0,0,0.2)] opacity-100\">\r\n                <div className=\"flex items-center justify-center gap-1\">\r\n                    <Button\r\n                        variant=\"ghost\"\r\n                        size=\"icon\"\r\n                        className=\"h-7 w-7 text-amber-600/30 hover:text-primary hover:bg-primary/10 transition-colors rounded-md\"\r\n                        onClick={() => onEdit(tower)}\r\n                    >\r\n                        <Edit2 className=\"h-3 w-3\" />\r\n                    </Button>\r\n                    <Button\r\n                        variant=\"ghost\"\r\n                        size=\"icon\"\r\n                        className=\"h-7 w-7 text-destructive/20 hover:text-destructive hover:bg-destructive/10 transition-colors rounded-md\"\r\n                        onClick={() => onDelete(tower.id, tower.objectId)}\r\n                        disabled={isPending}\r\n                    >\r\n                        <Trash2 className=\"h-3 w-3\" />\r\n                    </Button>\r\n                </div>\r\n            </TableCell>\r\n            <TableCell className=\"font-black sticky left-[80px] bg-[#0a0806] group-hover/row:bg-[#1a1612] z-30 border-r border-amber-900/20 text-center text-primary text-xs transition-colors shadow-[1px_0_3px_rgba(0,0,0,0.2)] opacity-100\">\r\n                <span className=\"font-mono tracking-tighter text-shadow-glow\">{tower.objectId}</span>\r\n            </TableCell>\r\n            <TableCell className=\"sticky left-[180px] bg-[#0a0806] group-hover/row:bg-[#1a1612] z-30 border-r border-amber-900/20 text-[10px] font-bold text-center text-amber-100/40 tracking-wider font-mono transition-colors shadow-[1px_0_3px_rgba(0,0,0,0.2)] opacity-100\">\r\n                {tower.trecho || \"-\"}\r\n            </TableCell>\r\n            <TableCell className=\"sticky left-[300px] bg-[#0a0806] group-hover/row:bg-[#1a1612] z-30 border-r border-amber-900/20 text-center transition-colors shadow-[1px_0_3px_rgba(0,0,0,0.2)] opacity-100\">\r\n                <Badge variant=\"outline\" className=\"px-2 py-0.5 text-[8px] font-black uppercase tracking-widest border-amber-900/30 text-amber-600/50\">\r\n                    {tower.towerType || \"N/A\"}\r\n                </Badge>\r\n            </TableCell>\r\n            <TableCell className=\"sticky left-[400px] bg-[#0a0806] group-hover/row:bg-[#1a1612] z-30 border-r border-amber-900/20 text-[10px] text-center font-bold text-amber-100/20 italic transition-colors shadow-[1px_0_3px_rgba(0,0,0,0.2)] opacity-100\">\r\n                {tower.goForward || \"-\"}\r\n            </TableCell>\r\n            <TableCell className=\"sticky left-[500px] bg-[#0a0806] group-hover/row:bg-[#1a1612] z-30 border-r border-amber-900/20 text-[10px] text-center font-bold text-amber-100/20 italic transition-colors shadow-[1px_0_3px_rgba(0,0,0,0.2)] opacity-100\">\r\n                {tower.totalConcreto || \"-\"}\r\n            </TableCell>\r\n            <TableCell className=\"sticky left-[600px] bg-[#0a0806] group-hover/row:bg-[#1a1612] z-30 border-r border-amber-900/20 text-[10px] text-center font-bold text-amber-100/20 italic transition-colors shadow-[2px_0_5px_rgba(0,0,0,0.3)] opacity-100\">\r\n                {tower.pesoArmacao || \"-\"}\r\n            </TableCell>\r\n            <TableCell className=\"sticky left-[700px] bg-[#0a0806] group-hover/row:bg-[#1a1612] z-30 border-r border-amber-900/20 text-[10px] text-center font-bold text-primary italic transition-colors shadow-[4px_0_15px_rgba(0,0,0,0.7)] opacity-100\">\r\n                {tower.pesoEstrutura || \"-\"}\r\n            </TableCell>\r\n\r\n            {/* SCROLLING CELLS */}\r\n            {categories?.map(cat => (\r\n                <React.Fragment key={cat.id}>\r\n                    {cat.activities.map(act => {\r\n                        const status = tower.activityStatuses.find(s => s.activityId === act.id);\r\n                        const schedule = tower.activitySchedules?.find(s => s.activityId === act.id);\r\n\r\n                        let isDelayed = false;\r\n                        if (schedule && schedule.plannedEnd) {\r\n                            const plannedEnd = new Date(schedule.plannedEnd);\r\n                            const now = new Date();\r\n\r\n                            if (status && status.status === 'FINISHED' && status.endDate) {\r\n                                // Se terminou, verifica se terminou depois do planejado\r\n                                if (new Date(status.endDate) > plannedEnd) {\r\n                                    isDelayed = true;\r\n                                }\r\n                            } else {\r\n                                // Se não terminou, verifica se já passou da data limite\r\n                                if (now > plannedEnd) {\r\n                                    isDelayed = true;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        return (\r\n                            <TableCell\r\n                                key={act.id}\r\n                                className=\"p-1 text-center border-r border-amber-900/10 cursor-pointer hover:bg-primary/20 group-hover/row:bg-primary/5 transition-all duration-300\"\r\n                                onClick={() => onSelectCell({\r\n                                    towerId: tower.id,\r\n                                    towerName: tower.objectId,\r\n                                    towerType: tower.towerType,\r\n                                    activityId: act.id,\r\n                                    activityName: act.name,\r\n                                    status: status\r\n                                })}\r\n                            >\r\n                                {status ? (\r\n                                    <div className=\"flex flex-col items-center justify-center gap-1.5 py-1.5 relative min-h-[52px]\">\r\n                                        {status.requiresApproval && (\r\n                                            <div className=\"badge-verificar animate-verificar\">VERIFICAR</div>\r\n                                        )}\r\n\r\n                                        {/* Delay Indicator */}\r\n                                        {isDelayed && (\r\n                                            <div className=\"absolute top-0 right-0 w-2 h-2 rounded-full bg-red-600 shadow-[0_0_5px_rgba(220,38,38,0.8)] z-20\" title=\"Atividade Atrasada\" />\r\n                                        )}\r\n\r\n                                        {/* Blue Progress Bar */}\r\n                                        <div\r\n                                            className={cn(\r\n                                                \"absolute bottom-0 left-0 h-0.5 transition-all duration-500 z-10\",\r\n                                                isDelayed ? \"bg-red-500/80\" : \"bg-blue-500/80\"\r\n                                            )}\r\n                                            style={{ width: `${status.progressPercent || 0}%` }}\r\n                                        />\r\n\r\n                                        <div className={cn(\r\n                                            \"w-full px-1.5 py-0.5 rounded text-[11px] font-black uppercase tracking-tight z-10 shadow-sm\",\r\n                                            status.status === 'FINISHED' ? 'status-concluido' :\r\n                                                status.status === 'IN_PROGRESS' ? 'status-andamento' : 'status-pendente',\r\n                                            isDelayed && status.status !== 'FINISHED' && \"border border-red-500/50 text-red-100\" // Highlight text if delayed and not finished\r\n                                        )}>\r\n                                            {status.status === 'FINISHED' ? 'CONCLUÍDO' :\r\n                                                status.status === 'IN_PROGRESS' ? `AND. ${status.progressPercent}%` : 'PENDENTE'}\r\n                                        </div>\r\n\r\n                                        {/* Seção Fundiária Separada */}\r\n                                        {status.landStatus && status.landStatus !== 'FREE' && (\r\n                                            <div className={cn(\r\n                                                \"w-full px-1 py-0.5 rounded-sm text-[10px] font-black uppercase tracking-tighter z-10 border\",\r\n                                                status.landStatus === 'EMBARGO' ? 'bg-red-950/40 text-red-500 border-red-500/50' :\r\n                                                    'bg-orange-950/40 text-orange-500 border-orange-500/50'\r\n                                            )}>\r\n                                                {status.landStatus === 'EMBARGO' ? 'EMBARGO' : 'IMPEDIMENTO'}\r\n                                            </div>\r\n                                        )}\r\n\r\n                                        <div className=\"flex items-center gap-1.5 z-10 mt-0.5\">\r\n                                            {status.metadata?.leadName && status.metadata.leadName !== 'none' && (\r\n                                                <span className=\"text-[8px] font-bold text-amber-500/80 uppercase tracking-tighter\">\r\n                                                    {status.metadata.leadName.split(' ')[0]}\r\n                                                </span>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"py-4 flex items-center justify-center opacity-10 relative\">\r\n                                        {/* Handle case where no status but schedule exists and is delayed (not started but late) */}\r\n                                        {isDelayed && (\r\n                                            <div className=\"absolute top-1 right-1 w-2 h-2 rounded-full bg-red-600 shadow-[0_0_5px_rgba(220,38,38,0.8)] z-20\" title=\"Não Iniciado - Atrasado\" />\r\n                                        )}\r\n                                        <div className=\"w-1 h-1 rounded-full bg-foreground\" />\r\n                                    </div>\r\n                                )}\r\n                            </TableCell>\r\n                        );\r\n                    })}\r\n                </React.Fragment>\r\n            ))}\r\n        </TableRow>\r\n    );\r\n});\r\n\r\nProductionTableRow.displayName = \"ProductionTableRow\";\r\n\r\nconst ProductionPage = () => {\r\n    const { profile } = useAuth();\r\n    const queryClient = useQueryClient();\r\n    const navigate = useNavigate();\r\n    const [activeTab, setActiveTab] = useState(\"grid\");\r\n    const [searchTerm, setSearchTerm] = useState(\"\");\r\n    const [selectedCell, setSelectedCell] = useState<{\r\n        towerId: string;\r\n        towerName: string;\r\n        towerType: string | null;\r\n        activityId: string;\r\n        activityName: string;\r\n        status?: TowerActivityStatus;\r\n    } | null>(null);\r\n\r\n    const [isTowerModalOpen, setIsTowerModalOpen] = useState(false);\r\n    const [isImportModalOpen, setIsImportModalOpen] = useState(false);\r\n    const [editingTower, setEditingTower] = useState<TowerProductionData | null>(null);\r\n    const [selectedProjectId, setSelectedProjectId] = useState<string>(profile?.projectId || 'all');\r\n    const projectId = selectedProjectId;\r\n    const [sortConfig, setSortConfig] = useState<{ key: keyof TowerProductionData; direction: \"asc\" | \"desc\" } | null>({ key: \"objectSeq\", direction: \"asc\" });\r\n\r\n    const { data: towers, isLoading: loadingTowers } = useQuery({\r\n        queryKey: [\"production-towers\", projectId, profile?.companyId],\r\n        queryFn: async () => {\r\n            const response = await orionApi.get(`/production/tower-status?projectId=${projectId}&companyId=${profile?.companyId}`);\r\n            return response.data as TowerProductionData[];\r\n        },\r\n        enabled: !!profile?.companyId\r\n    });\r\n\r\n    // Hooks for Analytics Tabs\r\n    const { sites } = useSites(projectId !== 'all' ? projectId : undefined);\r\n\r\n    // Auto-select first site when project changes, or keep current if still valid\r\n    const [localSiteId, setLocalSiteId] = useState<string | undefined>(undefined);\r\n\r\n    useEffect(() => {\r\n        if (sites.length > 0) {\r\n            if (!localSiteId || !sites.find(s => s.id === localSiteId)) {\r\n                setLocalSiteId(sites[0].id);\r\n            }\r\n        } else {\r\n            setLocalSiteId(undefined);\r\n        }\r\n    }, [sites, localSiteId]);\r\n\r\n    const selectedSiteId = localSiteId;\r\n    const { stages } = useWorkStages(selectedSiteId || 'none');\r\n    const { records } = useTimeRecords();\r\n    const { users } = useUsers();\r\n\r\n    const deleteMutation = useMutation({\r\n        mutationFn: async (id: string) => {\r\n            await orionApi.delete(`/tower_technical_data?id=${id}`);\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"production-towers\"] });\r\n            toast.success(\"Torre removida com sucesso\");\r\n        },\r\n        onError: (error: Error) => {\r\n            toast.error(\"Erro ao remover torre: \" + (error instanceof Error ? error.message : \"Erro desconhecido\"));\r\n        }\r\n    });\r\n\r\n    const { data: categories, isLoading: loadingCategories } = useQuery({\r\n        queryKey: [\"production-categories\", profile?.companyId],\r\n        queryFn: async () => {\r\n            const response = await orionApi.get(\"/production/categories\");\r\n            return response.data as ProductionCategory[];\r\n        },\r\n        enabled: !!profile?.companyId\r\n    });\r\n\r\n    const requestSort = (key: keyof TowerProductionData) => {\r\n        let direction: \"asc\" | \"desc\" = \"asc\";\r\n        if (sortConfig && sortConfig.key === key && sortConfig.direction === \"asc\") {\r\n            direction = \"desc\";\r\n        }\r\n        setSortConfig({ key, direction });\r\n    };\r\n\r\n    const sortedTowers = React.useMemo(() => {\r\n        if (!towers) return [];\r\n        const sortableItems = [...towers];\r\n        if (sortConfig !== null) {\r\n            sortableItems.sort((a, b) => {\r\n                const aValue = a[sortConfig.key];\r\n                const bValue = b[sortConfig.key];\r\n\r\n                if (aValue === null || aValue === undefined) return 1;\r\n                if (bValue === null || bValue === undefined) return -1;\r\n\r\n                if (aValue < bValue) {\r\n                    return sortConfig.direction === \"asc\" ? -1 : 1;\r\n                }\r\n                if (aValue > bValue) {\r\n                    return sortConfig.direction === \"asc\" ? 1 : -1;\r\n                }\r\n                return 0;\r\n            });\r\n        }\r\n        return sortableItems;\r\n    }, [towers, sortConfig]);\r\n\r\n    const filteredTowers = sortedTowers?.filter(tower =>\r\n        tower.objectId.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        tower.trecho?.toLowerCase().includes(searchTerm.toLowerCase())\r\n    );\r\n\r\n    const [scrollWidth, setScrollWidth] = useState(0);\r\n    const scrollContainerRef = React.useRef<HTMLDivElement>(null);\r\n    const topScrollRef = React.useRef<HTMLDivElement>(null);\r\n\r\n    React.useEffect(() => {\r\n        const updateWidth = () => {\r\n            if (scrollContainerRef.current) {\r\n                const width = scrollContainerRef.current.scrollWidth;\r\n                setScrollWidth(width);\r\n            }\r\n        };\r\n\r\n        updateWidth();\r\n        window.addEventListener('resize', updateWidth);\r\n\r\n        // Timeout robusto para garantir que o DOM renderizou\r\n        const timer = setTimeout(updateWidth, 1000);\r\n        const interval = setInterval(updateWidth, 3000);\r\n\r\n        return () => {\r\n            window.removeEventListener('resize', updateWidth);\r\n            clearTimeout(timer);\r\n            clearInterval(interval);\r\n        };\r\n    }, [filteredTowers, categories]);\r\n\r\n    const handleScroll = (e: React.UIEvent<HTMLDivElement>) => {\r\n        const target = e.target as HTMLDivElement;\r\n\r\n        if (target === scrollContainerRef.current && topScrollRef.current) {\r\n            topScrollRef.current.scrollLeft = target.scrollLeft;\r\n        } else if (target === topScrollRef.current && scrollContainerRef.current) {\r\n            scrollContainerRef.current.scrollLeft = target.scrollLeft;\r\n        }\r\n    };\r\n\r\n    const handleDeleteTower = React.useCallback((id: string, name: string) => {\r\n        if (window.confirm(`Deseja realmente excluir a torre ${name}?`)) {\r\n            deleteMutation.mutate(id);\r\n        }\r\n    }, [deleteMutation]);\r\n\r\n    const handleEditTower = React.useCallback((tower: TowerProductionData) => {\r\n        setEditingTower(tower);\r\n        setIsTowerModalOpen(true);\r\n    }, []);\r\n\r\n    const handleSelectCell = React.useCallback((cell: {\r\n        towerId: string;\r\n        towerName: string;\r\n        towerType: string | null;\r\n        activityId: string;\r\n        activityName: string;\r\n        status?: TowerActivityStatus;\r\n    }) => {\r\n        setSelectedCell(cell);\r\n    }, []);\r\n\r\n    if (loadingTowers || loadingCategories) {\r\n        return (\r\n            <div className=\"flex flex-col items-center justify-center min-h-[400px] gap-4\">\r\n                <div className=\"h-10 w-10 border-4 border-primary border-t-transparent rounded-full animate-spin\" />\r\n                <p className=\"text-white animate-pulse font-bold\">Carregando dados de produção...</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"h-screen w-full bg-background flex flex-col overflow-hidden font-sans\">\r\n            {/* App Header - Fixed */}\r\n            <header className=\"shrink-0 flex items-center justify-between px-6 py-4 border-b border-primary/20 bg-background/95 backdrop-blur-xl z-50 shadow-2xl relative\">\r\n                <div className=\"flex items-center gap-6\">\r\n                    <div className=\"flex flex-col\">\r\n                        <h1 className=\"text-2xl md:text-3xl font-black tracking-tighter bg-linear-to-r from-primary via-primary to-primary/40 bg-clip-text text-transparent uppercase italic drop-shadow-sm\">\r\n                            GESTÃO DE PRODUÇÃO\r\n                        </h1>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <div className=\"h-1 w-8 bg-primary rounded-full shadow-[0_0_10px_rgba(var(--primary),0.6)]\" />\r\n                            <p className=\"text-muted-foreground text-[10px] font-bold uppercase tracking-[0.3em]\">Controle Técnico e Planejamento</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-4\">\r\n                    <ProjectSelector\r\n                        value={selectedProjectId}\r\n                        onValueChange={setSelectedProjectId}\r\n                        className=\"w-[200px]\"\r\n                    />\r\n\r\n                    <div className=\"h-8 w-px bg-white/10 mx-1\" />\r\n\r\n                    <Card className=\"bg-primary/5 border-primary/10 transition-all hover:bg-primary/20 group glass-card relative overflow-hidden h-14 flex items-center px-5 gap-4\">\r\n                        <div className=\"p-2 rounded-full bg-primary/10 group-hover:bg-primary/20 transition-colors\">\r\n                            <HardHat className=\"h-5 w-5 text-primary\" />\r\n                        </div>\r\n                        <div className=\"flex flex-col justify-center\">\r\n                            <span className=\"text-[9px] font-black uppercase tracking-widest text-muted-foreground group-hover:text-primary/80 transition-colors\">Inventário Total</span>\r\n                            <div className=\"flex items-baseline gap-1.5\">\r\n                                <span className=\"text-xl font-black tracking-tighter italic text-foreground drop-shadow-glow\">\r\n                                    {towers?.length || 0}\r\n                                </span>\r\n                                <span className=\"text-[9px] font-bold text-muted-foreground uppercase\">Torres</span>\r\n                            </div>\r\n                        </div>\r\n                    </Card>\r\n\r\n                    <div className=\"h-8 w-px bg-white/10 mx-2\" />\r\n\r\n                    <Button\r\n                        variant=\"ghost\"\r\n                        size=\"icon\"\r\n                        className=\"h-10 w-10 text-muted-foreground hover:text-foreground hover:bg-white/5 rounded-full\"\r\n                    >\r\n                        <Info className=\"h-5 w-5\" />\r\n                    </Button>\r\n                </div>\r\n            </header>\r\n\r\n            {/* Toolbar - Fixed at Top (Locked) */}\r\n            <Tabs value={activeTab} onValueChange={setActiveTab} className=\"flex-1 flex flex-col overflow-hidden\">\r\n                <div className=\"shrink-0 z-40 bg-background/95 backdrop-blur-xl border-b border-white/5 py-4 px-6 shadow-xl space-y-3\">\r\n                    <div className=\"flex flex-col xl:flex-row xl:items-center justify-between gap-4 mb-4\">\r\n                        <TabsList className=\"glass-card p-1 flex justify-start w-fit bg-secondary/20\">\r\n                            <TabsTrigger value=\"grid\" className=\"gap-2 px-4 py-2 data-[state=active]:bg-primary data-[state=active]:text-primary-foreground\">\r\n                                <LayoutGrid className=\"w-4 h-4\" /> Grelha de Produção\r\n                            </TabsTrigger>\r\n                            <TabsTrigger value=\"progress\" className=\"gap-2 px-4 py-2 data-[state=active]:bg-primary data-[state=active]:text-primary-foreground\">\r\n                                <Activity className=\"w-4 h-4\" /> Avanço Físico\r\n                            </TabsTrigger>\r\n                            <TabsTrigger value=\"performance\" className=\"gap-2 px-4 py-2 data-[state=active]:bg-primary data-[state=active]:text-primary-foreground\">\r\n                                <BarChart3 className=\"w-4 h-4\" /> Performance (KPIs)\r\n                            </TabsTrigger>\r\n                        </TabsList>\r\n\r\n                        <div className=\"flex flex-col sm:flex-row items-center gap-3 w-full xl:w-auto\">\r\n                            {/* Site Selector for Analytics Tabs */}\r\n                            {(activeTab === 'progress' || activeTab === 'performance') && sites.length > 0 && (\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <span className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground whitespace-nowrap\">Local:</span>\r\n                                    <Select value={selectedSiteId} onValueChange={setLocalSiteId}>\r\n                                        <SelectTrigger className=\"bg-slate-900/50 border-white/10 h-9 text-[10px] font-bold uppercase tracking-wider w-[180px] rounded-lg\">\r\n                                            <SelectValue placeholder=\"Selecione o Canteiro\" />\r\n                                        </SelectTrigger>\r\n                                        <SelectContent className=\"bg-slate-950 border-white/10\">\r\n                                            {sites.map(s => (\r\n                                                <SelectItem key={s.id} value={s.id}>{s.name}</SelectItem>\r\n                                            ))}\r\n                                        </SelectContent>\r\n                                    </Select>\r\n                                </div>\r\n                            )}\r\n\r\n                            {activeTab === 'grid' && (\r\n                                <div className=\"relative w-full sm:w-80 group\">\r\n                                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-primary/50 group-focus-within:text-primary transition-colors\" />\r\n                                    <Input\r\n                                        placeholder=\"Localizar torre ou trecho...\"\r\n                                        className=\"pl-9 bg-black/40 border-white/10 focus:border-primary/50 focus:ring-1 focus:ring-primary/20 h-9 text-xs transition-all rounded-lg text-foreground placeholder:text-muted-foreground/30 font-medium\"\r\n                                        value={searchTerm}\r\n                                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                                    />\r\n                                </div>\r\n                            )}\r\n\r\n                            <div className=\"flex items-center gap-2 w-full sm:w-auto\">\r\n                                {activeTab === 'grid' && (\r\n                                    <>\r\n                                        <Button\r\n                                            variant=\"outline\"\r\n                                            size=\"sm\"\r\n                                            className=\"gap-2 border-primary/20 hover:bg-primary/10 glass text-foreground font-bold h-9 px-4 rounded-lg flex-1 sm:flex-none uppercase text-[10px] tracking-wider\"\r\n                                            onClick={() => setIsImportModalOpen(true)}\r\n                                        >\r\n                                            <Upload className=\"h-3.5 w-3.5 text-primary\" />\r\n                                            Importar\r\n                                        </Button>\r\n                                        <Button\r\n                                            size=\"sm\"\r\n                                            className=\"gap-2 shadow-lg shadow-primary/30 hover:shadow-primary/50 hover:scale-[1.02] active:scale-95 gradient-primary border-none text-primary-foreground font-black uppercase tracking-wider h-9 px-4 rounded-lg flex-1 sm:flex-none text-[10px]\"\r\n                                            onClick={() => {\r\n                                                setEditingTower(null);\r\n                                                setIsTowerModalOpen(true);\r\n                                            }}\r\n                                        >\r\n                                            <Plus className=\"h-4 w-4\" />\r\n                                            Nova Torre\r\n                                        </Button>\r\n                                    </>\r\n                                )}\r\n                                <Button\r\n                                    variant=\"outline\"\r\n                                    size=\"sm\"\r\n                                    className=\"gap-2 border-sky-500/30 hover:bg-sky-500/10 text-sky-400 font-bold h-9 px-4 rounded-lg flex-1 sm:flex-none uppercase text-[10px] tracking-wider\"\r\n                                    onClick={() => navigate('/producao/analytics')}\r\n                                >\r\n                                    <BarChart3 className=\"h-3.5 w-3.5\" />\r\n                                    Analytics & Custos\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Main Content - Full Screen Layout */}\r\n                <main className=\"flex-1 flex flex-col overflow-hidden relative bg-black/20\">\r\n                    <TabsContent value=\"grid\" className=\"h-full flex flex-col data-[state=active]:flex\">\r\n                        {loadingTowers ? (\r\n                            <div className=\"flex-1 flex items-center justify-center\">\r\n                                <Loader2 className=\"w-12 h-12 animate-spin text-primary opacity-20\" />\r\n                            </div>\r\n                        ) : !towers || towers.length === 0 ? (\r\n                            <div className=\"flex-1 flex items-center justify-center p-8 h-[60vh]\">\r\n                                <ProjectEmptyState\r\n                                    type=\"towers\"\r\n                                    title=\"Nenhuma Torre Cadastrada\"\r\n                                    description=\"Esta obra ainda não possui torres ou atividades técnicas. Você pode importar uma planilha Excel ou cadastrar manualmente.\"\r\n                                    onAction={() => setIsTowerModalOpen(true)}\r\n                                    onSecondaryAction={() => setIsImportModalOpen(true)}\r\n                                    actionLabel=\"Nova Torre\"\r\n                                    secondaryActionLabel=\"Importar Excel\"\r\n                                />\r\n                            </div>\r\n                        ) : (\r\n                            <>\r\n                                {/* KPI Dashboard Section - Collapsible or Always Visible? */}\r\n\r\n\r\n                                {/* Top Sync Scrollbar Container */}\r\n                                <div\r\n                                    ref={topScrollRef}\r\n                                    onScroll={handleScroll}\r\n                                    className=\"overflow-x-auto h-2 bg-background/80 border-b border-primary/20 shrink-0 scrollbar-thin scrollbar-thumb-primary/60 scrollbar-track-transparent z-50\"\r\n                                >\r\n                                    <div style={{ width: scrollWidth || '3000px' }} className=\"h-full\" />\r\n                                </div>\r\n\r\n                                {/* Table Area - Fills height, horizontal scroll starts from column Torre (T) visually */}\r\n                                <div\r\n                                    className=\"flex-1 overflow-auto scrollbar-thin scrollbar-thumb-amber-600/40 scrollbar-track-amber-900/5 bg-[#0a0806] select-none\"\r\n                                    ref={scrollContainerRef}\r\n                                    onScroll={handleScroll}\r\n                                >\r\n                                    <Table className=\"border-separate border-spacing-0 w-full min-w-max\">\r\n                                        <TableHeader className=\"sticky top-0 z-50 shadow-2xl\">\r\n                                            <TableRow className=\"bg-[#0a0806] hover:bg-[#0a0806] border-b border-amber-900/30\">\r\n                                                {/* FROZEN HEADERS */}\r\n                                                <TableHead className=\"w-[80px] h-14 sticky left-0 top-0 bg-[#0a0806] z-50 border-r border-amber-900/20 text-center font-black uppercase text-[10px] tracking-widest text-foreground\">\r\n                                                    MENU\r\n                                                </TableHead>\r\n                                                <TableHead\r\n                                                    className={cn(\r\n                                                        \"w-[100px] h-14 sticky left-[80px] top-0 bg-[#0a0806] z-50 border-r border-amber-900/20 cursor-pointer hover:bg-[#1a1612] transition-colors group text-center shadow-[2px_0_8px_rgba(0,0,0,0.5)] opacity-100\",\r\n                                                        sortConfig?.key === 'objectId' && \"text-primary\"\r\n                                                    )}\r\n                                                    onClick={() => requestSort('objectId')}\r\n                                                >\r\n                                                    <div className=\"flex items-center justify-center gap-1 h-full\">\r\n                                                        <span className=\"font-black uppercase text-[10px] tracking-widest group-hover:text-primary transition-colors\">ID OBRA</span>\r\n                                                        {sortConfig?.key === 'objectId' ? (\r\n                                                            sortConfig.direction === 'asc' ? <ArrowUp className=\"h-3 w-3\" /> : <ArrowDown className=\"h-3 w-3\" />\r\n                                                        ) : (\r\n                                                            <ArrowUpDown className=\"h-3 w-3 opacity-30 group-hover:opacity-100 transition-opacity\" />\r\n                                                        )}\r\n                                                    </div>\r\n                                                    <div className={cn(\r\n                                                        \"absolute bottom-0 left-0 w-full h-0.5 bg-primary transition-transform origin-left\",\r\n                                                        sortConfig?.key === 'objectId' ? \"scale-x-100\" : \"scale-x-0 group-hover:scale-x-100\"\r\n                                                    )} />\r\n                                                </TableHead>\r\n                                                <TableHead\r\n                                                    className={cn(\r\n                                                        \"w-[120px] h-14 sticky left-[180px] top-0 bg-[#0a0806] z-50 border-r border-amber-900/20 cursor-pointer hover:bg-[#1a1612] transition-colors group text-center shadow-[2px_0_8px_rgba(0,0,0,0.5)] opacity-100\",\r\n                                                        sortConfig?.key === 'trecho' && \"text-primary\"\r\n                                                    )}\r\n                                                    onClick={() => requestSort('trecho')}\r\n                                                >\r\n                                                    <div className=\"flex items-center justify-center gap-2 h-full\">\r\n                                                        <span className=\"font-black uppercase text-[10px] tracking-widest group-hover:text-primary transition-colors\">SUBTRECHO</span>\r\n                                                        {sortConfig?.key === 'trecho' ? (\r\n                                                            sortConfig.direction === 'asc' ? <ArrowUp className=\"h-3 w-3\" /> : <ArrowDown className=\"h-3 w-3\" />\r\n                                                        ) : (\r\n                                                            <ArrowUpDown className=\"h-3 w-3 opacity-30 group-hover:opacity-100 transition-opacity\" />\r\n                                                        )}\r\n                                                    </div>\r\n                                                    <div className={cn(\r\n                                                        \"absolute bottom-0 left-0 w-full h-0.5 bg-primary transition-transform origin-left\",\r\n                                                        sortConfig?.key === 'trecho' ? \"scale-x-100\" : \"scale-x-0 group-hover:scale-x-100\"\r\n                                                    )} />\r\n                                                </TableHead>\r\n                                                <TableHead\r\n                                                    className={cn(\r\n                                                        \"w-[100px] h-14 sticky left-[300px] top-0 bg-[#0a0806] z-50 border-r border-amber-900/20 cursor-pointer hover:bg-[#1a1612] transition-colors group text-center shadow-[2px_0_8px_rgba(0,0,0,0.5)] opacity-100\",\r\n                                                        sortConfig?.key === 'towerType' && \"text-primary\"\r\n                                                    )}\r\n                                                    onClick={() => requestSort('towerType')}\r\n                                                >\r\n                                                    <div className=\"flex items-center justify-center gap-1 h-full\">\r\n                                                        <span className=\"font-black uppercase text-[10px] tracking-widest group-hover:text-primary transition-colors\">ESTRUTURA</span>\r\n                                                        {sortConfig?.key === 'towerType' ? (\r\n                                                            sortConfig.direction === 'asc' ? <ArrowUp className=\"h-3 w-3\" /> : <ArrowDown className=\"h-3 w-3\" />\r\n                                                        ) : (\r\n                                                            <ArrowUpDown className=\"h-3 w-3 opacity-30 group-hover:opacity-100 transition-opacity\" />\r\n                                                        )}\r\n                                                    </div>\r\n                                                    <div className={cn(\r\n                                                        \"absolute bottom-0 left-0 w-full h-0.5 bg-primary transition-transform origin-left\",\r\n                                                        sortConfig?.key === 'towerType' ? \"scale-x-100\" : \"scale-x-0 group-hover:scale-x-100\"\r\n                                                    )} />\r\n                                                </TableHead>\r\n\r\n                                                <TableHead\r\n                                                    className={cn(\r\n                                                        \"w-[100px] h-14 sticky left-[400px] top-0 bg-[#0a0806] z-50 border-r border-amber-900/20 cursor-pointer hover:bg-[#1a1612] transition-colors group text-center shadow-[2px_0_8px_rgba(0,0,0,0.5)] opacity-100\",\r\n                                                        sortConfig?.key === 'goForward' && \"text-primary\"\r\n                                                    )}\r\n                                                    onClick={() => requestSort('goForward')}\r\n                                                >\r\n                                                    <div className=\"flex items-center justify-center gap-1 h-full\">\r\n                                                        <span className=\"font-black uppercase text-[10px] tracking-widest group-hover:text-primary transition-colors\">VÃO (M)</span>\r\n                                                        {sortConfig?.key === 'goForward' ? (\r\n                                                            sortConfig.direction === 'asc' ? <ArrowUp className=\"h-3 w-3\" /> : <ArrowDown className=\"h-3 w-3\" />\r\n                                                        ) : (\r\n                                                            <ArrowUpDown className=\"h-3 w-3 opacity-30 group-hover:opacity-100 transition-opacity\" />\r\n                                                        )}\r\n                                                    </div>\r\n                                                    <div className={cn(\r\n                                                        \"absolute bottom-0 left-0 w-full h-0.5 bg-primary transition-transform origin-left\",\r\n                                                        sortConfig?.key === 'goForward' ? \"scale-x-100\" : \"scale-x-0 group-hover:scale-x-100\"\r\n                                                    )} />\r\n                                                </TableHead>\r\n\r\n                                                <TableHead\r\n                                                    className={cn(\r\n                                                        \"w-[100px] h-14 sticky left-[500px] top-0 bg-[#0a0806] z-50 border-r border-amber-900/20 cursor-pointer hover:bg-[#1a1612] transition-colors group text-center shadow-[2px_0_8px_rgba(0,0,0,0.5)] opacity-100\",\r\n                                                        sortConfig?.key === 'totalConcreto' && \"text-primary\"\r\n                                                    )}\r\n                                                    onClick={() => requestSort('totalConcreto')}\r\n                                                >\r\n                                                    <div className=\"flex items-center justify-center gap-1 h-full\">\r\n                                                        <span className=\"font-black uppercase text-[10px] tracking-widest group-hover:text-primary transition-colors\">VOL (M³)</span>\r\n                                                        {sortConfig?.key === 'totalConcreto' ? (\r\n                                                            sortConfig.direction === 'asc' ? <ArrowUp className=\"h-3 w-3\" /> : <ArrowDown className=\"h-3 w-3\" />\r\n                                                        ) : (\r\n                                                            <ArrowUpDown className=\"h-3 w-3 opacity-30 group-hover:opacity-100 transition-opacity\" />\r\n                                                        )}\r\n                                                    </div>\r\n                                                    <div className={cn(\r\n                                                        \"absolute bottom-0 left-0 w-full h-0.5 bg-primary transition-transform origin-left\",\r\n                                                        sortConfig?.key === 'totalConcreto' ? \"scale-x-100\" : \"scale-x-0 group-hover:scale-x-100\"\r\n                                                    )} />\r\n                                                </TableHead>\r\n\r\n                                                <TableHead\r\n                                                    className={cn(\r\n                                                        \"w-[100px] h-14 sticky left-[600px] top-0 bg-[#0a0806] z-50 border-r border-amber-900/20 cursor-pointer hover:bg-[#1a1612] transition-colors group text-center shadow-[2px_0_8px_rgba(0,0,0,0.5)] opacity-100\",\r\n                                                        sortConfig?.key === 'pesoArmacao' && \"text-primary\"\r\n                                                    )}\r\n                                                    onClick={() => requestSort('pesoArmacao')}\r\n                                                >\r\n                                                    <div className=\"flex items-center justify-center gap-1 h-full\">\r\n                                                        <span className=\"font-black uppercase text-[10px] tracking-widest group-hover:text-primary transition-colors\">AÇO (KG)</span>\r\n                                                        {sortConfig?.key === 'pesoArmacao' ? (\r\n                                                            sortConfig.direction === 'asc' ? <ArrowUp className=\"h-3 w-3\" /> : <ArrowDown className=\"h-3 w-3\" />\r\n                                                        ) : (\r\n                                                            <ArrowUpDown className=\"h-3 w-3 opacity-30 group-hover:opacity-100 transition-opacity\" />\r\n                                                        )}\r\n                                                    </div>\r\n                                                    <div className={cn(\r\n                                                        \"absolute bottom-0 left-0 w-full h-0.5 bg-primary transition-transform origin-left\",\r\n                                                        sortConfig?.key === 'pesoArmacao' ? \"scale-x-100\" : \"scale-x-0 group-hover:scale-x-100\"\r\n                                                    )} />\r\n                                                </TableHead>\r\n\r\n                                                <TableHead\r\n                                                    className={cn(\r\n                                                        \"w-[100px] h-14 sticky left-[700px] top-0 bg-[#0a0806] z-50 border-r border-amber-900/20 cursor-pointer hover:bg-[#1a1612] transition-colors group text-center shadow-[4px_0_15px_rgba(0,0,0,0.7)] opacity-100\",\r\n                                                        sortConfig?.key === 'pesoEstrutura' && \"text-primary\"\r\n                                                    )}\r\n                                                    onClick={() => requestSort('pesoEstrutura')}\r\n                                                >\r\n                                                    <div className=\"flex items-center justify-center gap-1 h-full\">\r\n                                                        <span className=\"font-black uppercase text-[10px] tracking-widest group-hover:text-primary transition-colors\">TORRE (T)</span>\r\n                                                        {sortConfig?.key === 'pesoEstrutura' ? (\r\n                                                            sortConfig.direction === 'asc' ? <ArrowUp className=\"h-3 w-3\" /> : <ArrowDown className=\"h-3 w-3\" />\r\n                                                        ) : (\r\n                                                            <ArrowUpDown className=\"h-3 w-3 opacity-30 group-hover:opacity-100 transition-opacity\" />\r\n                                                        )}\r\n                                                    </div>\r\n                                                    <div className={cn(\r\n                                                        \"absolute bottom-0 left-0 w-full h-0.5 bg-primary transition-transform origin-left\",\r\n                                                        sortConfig?.key === 'pesoEstrutura' ? \"scale-x-100\" : \"scale-x-0 group-hover:scale-x-100\"\r\n                                                    )} />\r\n                                                </TableHead>\r\n\r\n                                                {/* SCROLLING HEADERS */}\r\n                                                {categories?.map(cat => (\r\n                                                    <React.Fragment key={cat.id}>\r\n                                                        {cat.activities.map(act => (\r\n                                                            <TableHead key={act.id} className=\"min-w-[160px] h-14 bg-[#0a0806] z-40 sticky top-0 text-center border-r border-amber-900/10 font-black text-[10px] uppercase tracking-widest text-[#d4af37]/80 group hover:bg-[#1a1612] transition-colors opacity-100\">\r\n                                                                <div className=\"flex flex-col items-center justify-center h-full gap-2\">\r\n                                                                    <span className=\"text-amber-600/40 text-[8px] font-bold tracking-[0.2em] leading-none\">{cat.name.toUpperCase()}</span>\r\n                                                                    <span className=\"text-foreground/90 leading-tight group-hover:text-primary transition-colors\">{act.name.toUpperCase()}</span>\r\n                                                                </div>\r\n                                                                <div className=\"absolute bottom-0 left-0 w-full h-0.5 bg-primary scale-x-0 group-hover:scale-x-100 transition-transform origin-left\" />\r\n                                                            </TableHead>\r\n                                                        ))}\r\n                                                    </React.Fragment>\r\n                                                ))}\r\n                                            </TableRow>\r\n                                        </TableHeader>\r\n\r\n                                        <TableBody>\r\n                                            {filteredTowers?.map((tower, idx) => (\r\n                                                <ProductionTableRow\r\n                                                    key={tower.id}\r\n                                                    tower={tower}\r\n                                                    idx={idx}\r\n                                                    categories={categories}\r\n                                                    onDelete={handleDeleteTower}\r\n                                                    onEdit={handleEditTower}\r\n                                                    onSelectCell={handleSelectCell}\r\n                                                    isPending={deleteMutation.isPending}\r\n                                                />\r\n                                            ))}\r\n                                        </TableBody>\r\n                                    </Table>\r\n                                </div>\r\n                            </>\r\n                        )}\r\n                    </TabsContent>\r\n\r\n                    <TabsContent value=\"progress\" className=\"h-full overflow-auto p-6\">\r\n                        {(!towers || towers.length === 0) ? (\r\n                            <div className=\"flex-1 flex items-center justify-center h-[60vh]\">\r\n                                <ProjectEmptyState\r\n                                    type=\"towers\"\r\n                                    title=\"Sem Torres para Acompanhar\"\r\n                                    description=\"Para visualizar o progresso físico, é necessário primeiro cadastrar as torres da obra.\"\r\n                                    onAction={() => setIsTowerModalOpen(true)}\r\n                                    actionLabel=\"Nova Torre\"\r\n                                />\r\n                            </div>\r\n                        ) : (!sites || sites.length === 0) ? (\r\n                            <div className=\"flex-1 flex items-center justify-center h-[60vh]\">\r\n                                <ProjectEmptyState\r\n                                    type=\"sites\"\r\n                                    title=\"Nenhum Canteiro Encontrado\"\r\n                                    description=\"Para acompanhar o avanço físico, você precisa primeiro cadastrar os canteiros e trechos desta obra.\"\r\n                                    onAction={() => navigate('/canteiros')}\r\n                                    actionLabel=\"Configurar Canteiros\"\r\n                                />\r\n                            </div>\r\n                        ) : (!stages || stages.length === 0) ? (\r\n                            <div className=\"flex-1 flex items-center justify-center h-[60vh]\">\r\n                                <ProjectEmptyState\r\n                                    type=\"generic\"\r\n                                    title=\"Etapas Não Configuradas\"\r\n                                    description=\"Não foram encontradas etapas de trabalho (Atividades) para este canteiro. Verifique as configurações de cronograma.\"\r\n                                />\r\n                            </div>\r\n                        ) : (\r\n                            <GAPOProgressTracker siteId={selectedSiteId} />\r\n                        )}\r\n                    </TabsContent>\r\n\r\n                    <TabsContent value=\"performance\" className=\"h-full overflow-auto p-6\">\r\n                        {(!towers || towers.length === 0) ? (\r\n                            <div className=\"flex-1 flex items-center justify-center h-[60vh]\">\r\n                                <ProjectEmptyState\r\n                                    type=\"towers\"\r\n                                    title=\"Sem Dados de Performance\"\r\n                                    description=\"A análise de performance requer que existam torres e atividades cadastradas na obra.\"\r\n                                    onAction={() => setIsTowerModalOpen(true)}\r\n                                    actionLabel=\"Nova Torre\"\r\n                                />\r\n                            </div>\r\n                        ) : (!users || users.length === 0) ? (\r\n                            <div className=\"flex-1 flex items-center justify-center h-[60vh]\">\r\n                                <ProjectEmptyState\r\n                                    type=\"workers\"\r\n                                    title=\"Nenhum Funcionário Alocado\"\r\n                                    description=\"Não há dados de performance pois ainda não foram cadastrados funcionários ou equipes para esta obra.\"\r\n                                    onAction={() => navigate('/usuarios')}\r\n                                    actionLabel=\"Cadastrar Equipe\"\r\n                                />\r\n                            </div>\r\n                        ) : (\r\n                            <GAPOAnalyticsPanel stages={stages} records={records} />\r\n                        )}\r\n                    </TabsContent>\r\n                </main>\r\n            </Tabs>\r\n\r\n            {\r\n                selectedCell && (\r\n                    <ActivityStatusModal\r\n                        isOpen={!!selectedCell}\r\n                        onClose={() => setSelectedCell(null)}\r\n                        elementId={selectedCell.towerId}\r\n                        towerName={selectedCell.towerName}\r\n                        towerType={selectedCell.towerType}\r\n                        activityId={selectedCell.activityId}\r\n                        activityName={selectedCell.activityName}\r\n                        currentStatus={selectedCell.status}\r\n                        projectId={projectId}\r\n                    />\r\n                )\r\n            }\r\n\r\n            <TowerFormModal\r\n                isOpen={isTowerModalOpen}\r\n                onClose={() => setIsTowerModalOpen(false)}\r\n                projectId={projectId!}\r\n                tower={editingTower}\r\n            />\r\n\r\n            <ExcelImportModal\r\n                isOpen={isImportModalOpen}\r\n                onClose={() => setIsImportModalOpen(false)}\r\n                projectId={projectId!}\r\n            />\r\n\r\n        </div >\r\n    );\r\n};\r\n\r\nexport default ProductionPage;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\modules\\production\\types\\index.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1132,1135],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1132,1135],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1159,1162],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1159,1162],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export type ActivityStatus = 'PENDING' | 'IN_PROGRESS' | 'FINISHED';\r\nexport type LandStatus = 'FREE' | 'EMBARGO' | 'IMPEDIMENT';\r\nexport type ImpedimentType = 'NONE' | 'OWNER' | 'CONTRACTOR' | 'PROJECT' | 'WORK';\r\n\r\nexport interface ProductionActivity {\r\n    id: string;\r\n    categoryId: string;\r\n    name: string;\r\n    description: string | null;\r\n    weight: number;\r\n    order: number;\r\n}\r\n\r\nexport interface ProductionCategory {\r\n    id: string;\r\n    name: string;\r\n    description: string | null;\r\n    order: number;\r\n    activities: ProductionActivity[];\r\n}\r\n\r\nexport interface ActivityAssignment {\r\n    id: string;\r\n    teamId: string | null;\r\n    userId: string | null;\r\n    team?: {\r\n        name: string;\r\n    };\r\n}\r\n\r\nexport interface TowerActivityStatus {\r\n    id: string;\r\n    elementId: string;\r\n    activityId: string;\r\n    status: ActivityStatus;\r\n    landStatus: LandStatus;\r\n    impedimentType: ImpedimentType;\r\n    startDate: string | null;\r\n    endDate: string | null;\r\n    progressPercent: number | null;\r\n    requiresApproval?: boolean;\r\n    approvalStatus?: string;\r\n    notes: string | null;\r\n    metadata: any | null;\r\n    history?: any[];\r\n    dailyProduction?: Record<string, number>;\r\n    activity: ProductionActivity;\r\n    assignments: ActivityAssignment[];\r\n}\r\n\r\nexport interface ActivitySchedule {\r\n    id: string;\r\n    elementId: string;\r\n    activityId: string;\r\n    plannedStart: string;\r\n    plannedEnd: string;\r\n    plannedQuantity: number | null;\r\n    plannedHHH: number | null;\r\n}\r\n\r\nexport interface TowerProductionData {\r\n    id: string;\r\n    elementId: string; // Unified mapping\r\n    objectId: string;\r\n    objectSeq: number;\r\n    towerType: string | null;\r\n    trecho: string | null;\r\n    tipoFundacao: string | null;\r\n    totalConcreto: number | null;\r\n    pesoArmacao: number | null;\r\n    pesoEstrutura: number | null;\r\n    tramoLancamento: string | null;\r\n    tipificacaoEstrutura: string | null;\r\n    goForward: number | null;\r\n    activityStatuses: TowerActivityStatus[];\r\n    activitySchedules: ActivitySchedule[];\r\n    overallStatus?: ActivityStatus;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\AuditLogs.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'History' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'HardHat' is defined but never used.","line":9,"column":177,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":184},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Link' is defined but never used.","line":9,"column":191,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":195},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":111,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":114,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1840,1843],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1840,1843],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2147,2150],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2147,2150],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2292,2295],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2292,2295],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2712,2715],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2712,2715],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2857,2860],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2857,2860],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3655,3658],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3655,3658],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3996,3999],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3996,3999],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4423,4426],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4423,4426],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":107,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":110,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5211,5214],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5211,5214],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAuditHistory'. Either include it or remove the dependency array.","line":109,"column":8,"nodeType":"ArrayExpression","endLine":109,"endColumn":19,"suggestions":[{"desc":"Update the dependencies array to be: [dateRange, fetchAuditHistory]","fix":{"range":[5669,5680],"text":"[dateRange, fetchAuditHistory]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":114,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5871,5874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5871,5874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6458,6461],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6458,6461],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":257,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":257,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11906,11909],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11906,11909],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":257,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":257,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11920,11923],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11920,11923],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":260,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":260,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12109,12112],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12109,12112],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":850,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":850,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[58581,58584],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[58581,58584],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":850,"column":105,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":850,"endColumn":108,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[58620,58623],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[58620,58623],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":854,"column":115,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":854,"endColumn":118,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[59116,59119],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[59116,59119],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":861,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":861,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[59711,59714],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[59711,59714],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":862,"column":119,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":862,"endColumn":122,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[59845,59848],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[59845,59848],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":872,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":872,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[60743,60746],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[60743,60746],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1002,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1002,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[70207,70210],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[70207,70210],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1002,"column":110,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1002,"endColumn":113,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[70246,70249],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[70246,70249],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1002,"column":149,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1002,"endColumn":152,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[70285,70288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[70285,70288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1002,"column":189,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1002,"endColumn":192,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[70325,70328],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[70325,70328],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":27,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo, useEffect } from 'react';\r\nimport { useAuditLogs, AuditLog } from '@/hooks/useAuditLogs';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { History, Search, Eye, User, Calendar as CalendarIcon, Database, ArrowRight, ShieldAlert, ShieldCheck, Activity, Play, CheckCircle2, XCircle, AlertTriangle, RefreshCw, HardHat, Zap, Link, Info, Copy } from 'lucide-react';\r\nimport { format } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\nimport { cn } from '@/lib/utils';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport GAPOValidationList from '@/components/gapo/GAPOValidationList';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { isProtectedSignal, can } from '@/signals/authSignals';\r\nimport { orionApi } from '@/integrations/orion/client';\r\nimport { toast } from 'sonner';\r\nimport { Calendar } from \"@/components/ui/calendar\";\r\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { DateRange } from \"react-day-picker\";\r\n\r\nexport default function AuditLogs() {\r\n    const { profile } = useAuth();\r\n    const isGod = isProtectedSignal.value || can('system.is_corporate');\r\n    const { data: logs = [], isLoading, refetch: refetchLogs } = useAuditLogs(isGod ? undefined : (profile as any)?.companyId);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [selectedLog, setSelectedLog] = useState<AuditLog | null>(null);\r\n\r\n    // Estados para Auditoria Arquitetural\r\n    const [isAuditing, setIsAuditing] = useState(false);\r\n    const [auditResults, setAuditResults] = useState<any[]>([]);\r\n    const [auditSearchTerm, setAuditSearchTerm] = useState('');\r\n    const [selectedAuditResult, setSelectedAuditResult] = useState<any | null>(null);\r\n    const [auditSortConfig, setAuditSortConfig] = useState<{ key: string, direction: 'asc' | 'desc' } | null>({ key: 'lastDetectedAt', direction: 'desc' });\r\n    const [dateRange, setDateRange] = useState<DateRange | undefined>(undefined);\r\n\r\n    // Estados para Teste de Rotas\r\n    const [isTestingRoutes, setIsTestingRoutes] = useState(false);\r\n    const [routeResults, setRouteResults] = useState<any[]>([]);\r\n    const [routeSearchTerm, setRouteSearchTerm] = useState('');\r\n    const [selectedRouteResult, setSelectedRouteResult] = useState<any | null>(null);\r\n    const [routeSortConfig, setRouteSortConfig] = useState<{ key: string, direction: 'asc' | 'desc' } | null>(null);\r\n\r\n    const handleSortAudit = (key: string) => {\r\n        let direction: 'asc' | 'desc' = 'asc';\r\n        if (auditSortConfig && auditSortConfig.key === key && auditSortConfig.direction === 'asc') {\r\n            direction = 'desc';\r\n        }\r\n        setAuditSortConfig({ key, direction });\r\n    };\r\n\r\n    const handleSortRoutes = (key: string) => {\r\n        let direction: 'asc' | 'desc' = 'asc';\r\n        if (routeSortConfig && routeSortConfig.key === key && routeSortConfig.direction === 'asc') {\r\n            direction = 'desc';\r\n        }\r\n        setRouteSortConfig({ key, direction });\r\n    };\r\n\r\n    const SortIcon = ({ config, columnKey }: { config: any, columnKey: string }) => {\r\n        if (!config || config.key !== columnKey) return <RefreshCw className=\"w-3 h-3 opacity-20\" />;\r\n        return config.direction === 'asc' ? <ArrowRight className=\"w-3 h-3 -rotate-90 text-primary\" /> : <ArrowRight className=\"w-3 h-3 rotate-90 text-primary\" />;\r\n    };\r\n\r\n    const isValidDate = (date: any) => {\r\n        if (!date) return false;\r\n        const d = new Date(date);\r\n        return !isNaN(d.getTime());\r\n    };\r\n\r\n    // Carregar histórico inicial\r\n    // Carregar histórico inicial de rotas\r\n    useEffect(() => {\r\n        const fetchRouteHistory = async () => {\r\n            try {\r\n                // Buscar histórico de rotas\r\n                const routeResp = await (orionApi.get('/testing/routes') as Promise<any>);\r\n                const routeData = routeResp.data?.data || routeResp.data || [];\r\n                setRouteResults(Array.isArray(routeData) ? routeData : []);\r\n            } catch (error) {\r\n                console.error('Erro ao carregar histórico de rotas:', error);\r\n            }\r\n        };\r\n\r\n        fetchRouteHistory();\r\n    }, []);\r\n\r\n    // Fetch Audit History with Filters\r\n    const fetchAuditHistory = async () => {\r\n        try {\r\n            const params = new URLSearchParams();\r\n            if (dateRange?.from) params.append('startDate', dateRange.from.toISOString());\r\n            if (dateRange?.to) params.append('endDate', dateRange.to.toISOString());\r\n\r\n            const auditResp = await (orionApi.get(`/audit/architectural?${params.toString()}`) as Promise<any>);\r\n            const auditData = auditResp.data?.data || auditResp.data || [];\r\n            setAuditResults(Array.isArray(auditData) ? auditData : []);\r\n        } catch (error) {\r\n            console.error('Erro ao carregar histórico de auditoria:', error);\r\n            toast.error('Falha ao atualizar filtros de auditoria.');\r\n        }\r\n    };\r\n\r\n    // Trigger fetch on date range change\r\n    useEffect(() => {\r\n        fetchAuditHistory();\r\n    }, [dateRange]);\r\n\r\n    const handleRunArchitecturalAudit = async () => {\r\n        setIsAuditing(true);\r\n        try {\r\n            const response = await (orionApi.post('/audit/architectural') as Promise<any>);\r\n            const results = response.data?.data || response.data || [];\r\n            setAuditResults(Array.isArray(results) ? results : []);\r\n            toast.success('Auditoria concluída e persistida!');\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error('Erro ao executar auditoria.');\r\n        } finally {\r\n            setIsAuditing(false);\r\n        }\r\n    };\r\n\r\n    const handleRunRouteTests = async () => {\r\n        setIsTestingRoutes(true);\r\n        try {\r\n            const response = await (orionApi.get('/testing/routes') as Promise<any>);\r\n            const results = response.data?.data || response.data || (Array.isArray(response) ? response : []);\r\n            setRouteResults(Array.isArray(results) ? results : []);\r\n            toast.success('Teste de rotas concluído!');\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error('Erro ao testar rotas.');\r\n        } finally {\r\n            setIsTestingRoutes(false);\r\n        }\r\n    };\r\n\r\n    const filteredLogs = useMemo(() => {\r\n        return logs.filter(log => {\r\n            const searchLower = searchTerm.toLowerCase();\r\n            return (\r\n                (log.table_name?.toLowerCase() || '').includes(searchLower) ||\r\n                (log.performer_name?.toLowerCase() || '').includes(searchLower) ||\r\n                (log.action?.toLowerCase() || '').includes(searchLower) ||\r\n                (log.record_id?.toLowerCase() || '').includes(searchLower)\r\n            );\r\n        });\r\n    }, [logs, searchTerm]);\r\n\r\n    const filteredAuditResults = useMemo(() => {\r\n        const filtered = auditResults.filter(res => {\r\n            const searchLower = auditSearchTerm.toLowerCase();\r\n            return (\r\n                (res.file?.toLowerCase() || '').includes(searchLower) ||\r\n                (res.violation?.toLowerCase() || '').includes(searchLower) ||\r\n                (res.message?.toLowerCase() || '').includes(searchLower) ||\r\n                (res.severity?.toLowerCase() || '').includes(searchLower)\r\n            );\r\n        });\r\n\r\n        // Grouping Logic: Summarize if improvement action (suggestion) is the same\r\n        const groupedMap = new Map();\r\n        filtered.forEach(item => {\r\n            const key = item.suggestion || item.violation;\r\n            if (!groupedMap.has(key)) {\r\n                groupedMap.set(key, { ...item, count: 1, files: [item.file] });\r\n            } else {\r\n                const existing = groupedMap.get(key);\r\n                existing.count++;\r\n                if (!existing.files.includes(item.file)) {\r\n                    existing.files.push(item.file);\r\n                }\r\n                // Update timestamp to most recent\r\n                if (new Date(item.lastDetectedAt) > new Date(existing.lastDetectedAt)) {\r\n                    existing.lastDetectedAt = item.lastDetectedAt;\r\n                }\r\n            }\r\n        });\r\n\r\n        const grouped = Array.from(groupedMap.values());\r\n\r\n        if (auditSortConfig) {\r\n            grouped.sort((a, b) => {\r\n                const aValue = a[auditSortConfig.key];\r\n                const bValue = b[auditSortConfig.key];\r\n                if (aValue < bValue) return auditSortConfig.direction === 'asc' ? -1 : 1;\r\n                if (aValue > bValue) return auditSortConfig.direction === 'asc' ? 1 : -1;\r\n                return 0;\r\n            });\r\n        }\r\n        return grouped;\r\n    }, [auditResults, auditSearchTerm, auditSortConfig]);\r\n\r\n    const filteredRouteResults = useMemo(() => {\r\n        const filtered = routeResults.filter(res => {\r\n            const searchLower = routeSearchTerm.toLowerCase();\r\n            return (\r\n                (res.route?.toLowerCase() || '').includes(searchLower) ||\r\n                (res.status?.toLowerCase() || '').includes(searchLower) ||\r\n                (res.suggestion?.toLowerCase() || '').includes(searchLower)\r\n            );\r\n        });\r\n\r\n        if (routeSortConfig) {\r\n            filtered.sort((a, b) => {\r\n                let aValue = a[routeSortConfig.key];\r\n                let bValue = b[routeSortConfig.key];\r\n\r\n                // Tratamento especial para latência numérica\r\n                if (routeSortConfig.key === 'latency') {\r\n                    aValue = parseInt(aValue) || 0;\r\n                    bValue = parseInt(bValue) || 0;\r\n                }\r\n\r\n                if (aValue < bValue) return routeSortConfig.direction === 'asc' ? -1 : 1;\r\n                if (aValue > bValue) return routeSortConfig.direction === 'asc' ? 1 : -1;\r\n                return 0;\r\n            });\r\n        }\r\n        return filtered;\r\n    }, [routeResults, routeSearchTerm, routeSortConfig]);\r\n\r\n    const getActionStyle = (action: string) => {\r\n        switch (action) {\r\n            case 'INSERT': return 'bg-green-500/10 text-green-500 border-green-500/20';\r\n            case 'UPDATE': return 'bg-amber-500/10 text-amber-500 border-amber-500/20';\r\n            case 'DELETE': return 'bg-red-500/10 text-red-500 border-red-500/20';\r\n            default: return 'bg-blue-500/10 text-blue-500 border-blue-500/20';\r\n        }\r\n    };\r\n\r\n    const getTableNameLabel = (name: string) => {\r\n        const labels: Record<string, string> = {\r\n            'users': 'Usuários (Sistema)',\r\n            'profiles': 'Perfis (Legado)',\r\n            'employees': 'Funcionários',\r\n            'teams': 'Equipes',\r\n            'projects': 'Obras',\r\n            'sites': 'Canteiros',\r\n            'permission_matrix': 'Matriz SU'\r\n        };\r\n        return labels[name] || name;\r\n    };\r\n\r\n    const getSeverityStyle = (severity?: string) => {\r\n        switch (severity) {\r\n            case 'HIGH': return 'bg-red-500 text-white shadow-red-500/50';\r\n            case 'MEDIUM': return 'bg-amber-500 text-white shadow-amber-500/50';\r\n            case 'LOW': return 'bg-blue-500 text-white shadow-blue-500/50';\r\n            default: return 'bg-slate-500 text-white';\r\n        }\r\n    };\r\n\r\n    const DiffViewer = ({ oldData, newData }: { oldData: any, newData: any }) => {\r\n        const sensitiveKeys = ['password', 'token', 'secret', 'credential', 'auth', 'senha', 'key', 'access_token'];\r\n\r\n        const formatDisplayValue = (key: string, value: any) => {\r\n            if (value === null || value === undefined) {\r\n                return (\r\n                    <Badge variant=\"outline\" className=\"text-[10px] opacity-30 border-white/10 font-mono\">\r\n                        NULL\r\n                    </Badge>\r\n                );\r\n            }\r\n\r\n            if (sensitiveKeys.some(k => key.toLowerCase().includes(k))) {\r\n                return <span className=\"text-primary font-mono tracking-widest text-xs\">••••••••</span>;\r\n            }\r\n\r\n            // ISO Date Check\r\n            if (typeof value === 'string' && value.match(/^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}/)) {\r\n                return (\r\n                    <span className=\"flex items-center gap-1.5 text-xs font-bold text-foreground\">\r\n                        <CalendarIcon className=\"w-3 h-3 text-primary/50\" />\r\n                        {format(new Date(value), \"dd/MM/yyyy HH:mm:ss\", { locale: ptBR })}\r\n                    </span>\r\n                );\r\n            }\r\n\r\n            // UUID check\r\n            if (typeof value === 'string' && value.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i)) {\r\n                return (\r\n                    <span className=\"font-mono text-[10px] bg-black/40 px-1.5 py-0.5 rounded border border-white/5 text-blue-400 group-hover:text-blue-300 transition-colors\" title={value}>\r\n                        {value.substring(0, 8)}...{value.substring(value.length - 4)}\r\n                    </span>\r\n                );\r\n            }\r\n\r\n            if (typeof value === 'boolean') {\r\n                return (\r\n                    <Badge className={cn(\"text-[9px] font-black uppercase tracking-tighter\", value ? \"bg-green-500/20 text-green-400\" : \"bg-red-500/20 text-red-400\")}>\r\n                        {value ? 'TRUE' : 'FALSE'}\r\n                    </Badge>\r\n                )\r\n            }\r\n\r\n            if (typeof value === 'object') {\r\n                return <span className=\"text-[10px] font-mono text-muted-foreground italic truncate\">JSON Object</span>;\r\n            }\r\n\r\n            return <span className=\"text-xs font-bold text-foreground truncate\">{String(value)}</span>;\r\n        };\r\n\r\n        if (!oldData && !newData) return <div className=\"p-8 text-center text-muted-foreground italic border-2 border-dashed border-white/5 rounded-2xl\">Sem dados para comparar</div>;\r\n\r\n        const allKeys = Array.from(new Set([...Object.keys(oldData || {}), ...Object.keys(newData || {})]));\r\n        const changes = allKeys.filter(key => JSON.stringify(oldData?.[key]) !== JSON.stringify(newData?.[key]));\r\n\r\n        return (\r\n            <div className=\"max-h-[60vh] overflow-y-auto pr-2 -mr-2\">\r\n                <div className={cn(\r\n                    \"grid gap-2 p-1\",\r\n                    changes.length > 4 ? \"grid-cols-1 xl:grid-cols-2\" : \"grid-cols-1\"\r\n                )}>\r\n                    {changes.length === 0 ? (\r\n                        <div className=\"p-10 text-center space-y-2 col-span-full\">\r\n                            <p className=\"text-xs text-muted-foreground uppercase tracking-widest font-black opacity-30\">Nenhuma alteração detectada nos campos</p>\r\n                        </div>\r\n                    ) : (\r\n                        changes.map(key => (\r\n                            <div key={key} className=\"group flex flex-col items-stretch gap-px rounded-lg overflow-hidden border border-white/5 bg-white/2 hover:border-primary/20 transition-all duration-300\">\r\n                                <div className=\"p-1.5 bg-black/40 border-b border-white/5 flex items-center justify-between\">\r\n                                    <span className=\"text-[8px] font-black uppercase text-primary/40 tracking-widest group-hover:text-primary transition-colors\">{key}</span>\r\n                                </div>\r\n\r\n                                <div className=\"flex-1 grid grid-cols-[1fr_auto_1fr] items-center\">\r\n                                    <div className=\"p-2 bg-red-500/5 min-h-[40px] flex items-center justify-center\">\r\n                                        {formatDisplayValue(key, oldData?.[key])}\r\n                                    </div>\r\n\r\n                                    <div className=\"flex items-center justify-center px-2 bg-black/20 text-muted-foreground group-hover:text-primary transition-colors\">\r\n                                        <ArrowRight className=\"w-3 h-3\" />\r\n                                    </div>\r\n\r\n                                    <div className=\"p-2 bg-green-500/5 min-h-[40px] flex items-center justify-center\">\r\n                                        {formatDisplayValue(key, newData?.[key])}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))\r\n                    )}\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-fade-in p-2 md:p-6\">\r\n            <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-black font-display tracking-tight text-foreground uppercase flex items-center gap-3\">\r\n                        <div className=\"p-2 rounded-xl bg-primary/10\">\r\n                            <ShieldCheck className=\"w-8 h-8 text-primary\" />\r\n                        </div>\r\n                        Central de Segurança\r\n                    </h1>\r\n                    <p className=\"text-muted-foreground mt-1 font-medium italic\">Auditoria completa e validações técnicas do sistema Orion.</p>\r\n                </div>\r\n            </div>\r\n\r\n            <Tabs defaultValue=\"audit\" className=\"w-full\">\r\n                <TabsList className=\"glass-card mb-8 p-1 flex justify-start overflow-x-auto gap-2 border-white/5\">\r\n                    <TabsTrigger value=\"audit\" className=\"gap-2 px-6 py-2\">\r\n                        <Database className=\"w-4 h-4\" /> Trilha do Sistema\r\n                    </TabsTrigger>\r\n                    <TabsTrigger value=\"validation\" className=\"gap-2 px-6 py-2\">\r\n                        <Activity className=\"w-4 h-4\" /> Sanidade de Rotas\r\n                    </TabsTrigger>\r\n                    <TabsTrigger value=\"standards\" className=\"gap-2 px-6 py-2\">\r\n                        <ShieldAlert className=\"w-4 h-4\" /> Auditoria de Padrões\r\n                    </TabsTrigger>\r\n                    <TabsTrigger value=\"gapo\" className=\"gap-2 px-6 py-2\">\r\n                        <CheckCircle2 className=\"w-4 h-4\" /> Validação GAPO\r\n                    </TabsTrigger>\r\n                </TabsList>\r\n\r\n                {/* ABA 1: TRILHA DO SISTEMA */}\r\n                <TabsContent value=\"audit\" className=\"space-y-6\">\r\n                    <div className=\"flex flex-col md:flex-row justify-between gap-4 mb-4\">\r\n                        <div className=\"relative w-full md:w-80\">\r\n                            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\r\n                            <Input\r\n                                placeholder=\"Buscar por usuário, tabela ou ação...\"\r\n                                className=\"industrial-input pl-10\"\r\n                                value={searchTerm}\r\n                                onChange={(e) => setSearchTerm(e.target.value)}\r\n                            />\r\n                        </div>\r\n                        <Button variant=\"outline\" size=\"sm\" onClick={() => refetchLogs()} className=\"gap-2\">\r\n                            <RefreshCw className={cn(\"w-4 h-4\", isLoading && \"animate-spin\")} /> Atualizar Trilha\r\n                        </Button>\r\n                    </div>\r\n\r\n                    <Card className=\"glass-card overflow-hidden\">\r\n                        <CardHeader className=\"border-b border-white/5\">\r\n                            <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                                <Database className=\"w-5 h-5 text-primary\" />\r\n                                Registros do Servidor\r\n                            </CardTitle>\r\n                            <CardDescription>Mostrando os últimos {filteredLogs.length} eventos registrados.</CardDescription>\r\n                        </CardHeader>\r\n                        <CardContent className=\"p-0\">\r\n                            <div className=\"overflow-x-auto\">\r\n                                <Table>\r\n                                    <TableHeader>\r\n                                        <TableRow className=\"hover:bg-transparent border-white/5 bg-white/2\">\r\n                                            <TableHead className=\"font-bold text-[10px] uppercase tracking-widest pl-6 w-[15%]\">Data/Hora</TableHead>\r\n                                            <TableHead className=\"font-bold text-[10px] uppercase tracking-widest w-[30%]\">Usuário / IP</TableHead>\r\n                                            <TableHead className=\"font-bold text-[10px] uppercase tracking-widest w-[30%]\">Módulo / Tabela</TableHead>\r\n                                            <TableHead className=\"font-bold text-[10px] uppercase tracking-widest w-[15%]\">Ação</TableHead>\r\n                                            <TableHead className=\"text-right pr-6 font-bold text-[10px] uppercase tracking-widest w-[10%]\">Detalhes</TableHead>\r\n                                        </TableRow>\r\n                                    </TableHeader>\r\n                                    <TableBody>\r\n                                        {isLoading ? (\r\n                                            <TableRow>\r\n                                                <TableCell colSpan={5} className=\"text-center py-20\">\r\n                                                    <div className=\"flex flex-col items-center gap-3\">\r\n                                                        <div className=\"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin\" />\r\n                                                        <span className=\"text-sm font-medium text-muted-foreground\">Consultando arquivos de auditoria...</span>\r\n                                                    </div>\r\n                                                </TableCell>\r\n                                            </TableRow>\r\n                                        ) : filteredLogs.length === 0 ? (\r\n                                            <TableRow>\r\n                                                <TableCell colSpan={5} className=\"text-center py-20 text-muted-foreground italic font-medium\">\r\n                                                    Nenhum registro encontrado para esta busca.\r\n                                                </TableCell>\r\n                                            </TableRow>\r\n                                        ) : (\r\n                                            filteredLogs.map((logItem) => (\r\n                                                <TableRow key={logItem.id} className=\"hover:bg-white/2 border-white/5 transition-colors group\">\r\n                                                    <TableCell className=\"pl-6 py-4\">\r\n                                                        <div className=\"flex flex-col\">\r\n                                                            <span className=\"font-bold text-sm text-foreground\">\r\n                                                                {isValidDate(logItem.performed_at)\r\n                                                                    ? format(new Date(logItem.performed_at), 'dd/MM/yyyy', { locale: ptBR })\r\n                                                                    : 'Data Inválida'}\r\n                                                            </span>\r\n                                                            <span className=\"text-xs text-muted-foreground\">\r\n                                                                {isValidDate(logItem.performed_at)\r\n                                                                    ? format(new Date(logItem.performed_at), 'HH:mm:ss')\r\n                                                                    : '--:--:--'}\r\n                                                            </span>\r\n                                                        </div>\r\n                                                    </TableCell>\r\n                                                    <TableCell>\r\n                                                        <div className=\"flex items-center gap-2\">\r\n                                                            <div className=\"w-8 h-8 rounded-lg gradient-primary flex items-center justify-center text-[10px] font-black text-white shrink-0\">\r\n                                                                {logItem.performer_name?.charAt(0).toUpperCase()}\r\n                                                            </div>\r\n                                                            <div className=\"flex flex-col\">\r\n                                                                <span className=\"font-medium text-sm text-foreground\">{logItem.performer_name}</span>\r\n                                                                <span className=\"text-[9px] font-mono text-muted-foreground bg-white/5 px-1 rounded w-fit\">\r\n                                                                    {logItem.ipAddress || '0.0.0.0'}\r\n                                                                </span>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </TableCell>\r\n                                                    <TableCell className=\"text-right\">\r\n                                                        <div className=\"flex flex-col items-end gap-1\">\r\n                                                            <Badge variant=\"outline\" className=\"text-[10px] font-mono bg-muted/30\">\r\n                                                                {logItem.table_name}\r\n                                                            </Badge>\r\n                                                            {logItem.route && (\r\n                                                                <span className=\"text-[9px] text-muted-foreground/50 truncate max-w-[150px]\" title={logItem.route}>\r\n                                                                    {logItem.route}\r\n                                                                </span>\r\n                                                            )}\r\n                                                        </div>\r\n                                                    </TableCell>\r\n                                                    <TableCell>\r\n                                                        <Badge className={cn(\"text-[10px] font-black uppercase tracking-widest border\", getActionStyle(logItem.action))}>\r\n                                                            {logItem.action}\r\n                                                        </Badge>\r\n                                                    </TableCell>\r\n                                                    <TableCell className=\"text-right pr-6\">\r\n                                                        <Button\r\n                                                            variant=\"ghost\"\r\n                                                            size=\"icon\"\r\n                                                            className=\"opacity-0 group-hover:opacity-100 transition-opacity rounded-lg hover:bg-primary/20 hover:text-primary\"\r\n                                                            onClick={() => setSelectedLog(logItem)}\r\n                                                        >\r\n                                                            <Eye className=\"w-4 h-4\" />\r\n                                                        </Button>\r\n                                                    </TableCell>\r\n                                                </TableRow>\r\n                                            ))\r\n                                        )}\r\n                                    </TableBody>\r\n                                </Table>\r\n                            </div>\r\n                        </CardContent>\r\n                    </Card>\r\n                </TabsContent>\r\n\r\n                {/* ABA 2: SANIDADE DE ROTAS (REAL) */}\r\n                <TabsContent value=\"validation\" className=\"space-y-6\">\r\n                    <Card className=\"glass-card\">\r\n                        <CardHeader className=\"flex flex-col md:flex-row items-start md:items-center justify-between border-b border-white/5 pb-6 gap-4\">\r\n                            <div>\r\n                                <CardTitle className=\"flex items-center gap-2\">\r\n                                    <Activity className=\"w-5 h-5 text-blue-500\" />\r\n                                    Diagnóstico de Infraestrutura\r\n                                </CardTitle>\r\n                                <CardDescription>Verificação em tempo real de acessibilidade e desempenho de rotas críticas.</CardDescription>\r\n                            </div>\r\n                            <div className=\"flex w-full md:w-auto items-center gap-3\">\r\n                                <div className=\"relative flex-1 md:w-64\">\r\n                                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\r\n                                    <Input\r\n                                        placeholder=\"Filtrar rotas ou status...\"\r\n                                        value={routeSearchTerm}\r\n                                        onChange={(e) => setRouteSearchTerm(e.target.value)}\r\n                                        className=\"pl-10 bg-black/20 border-white/10 rounded-xl\"\r\n                                    />\r\n                                </div>\r\n                                <Button onClick={handleRunRouteTests} disabled={isTestingRoutes} className=\"gap-2 shadow-glow shadow-blue-500/20 bg-blue-600 hover:bg-blue-500 text-white border-0 py-6 px-8 rounded-2xl shrink-0\">\r\n                                    {isTestingRoutes ? <RefreshCw className=\"w-4 h-4 animate-spin\" /> : <Play className=\"w-4 h-4 shadow-xl\" />}\r\n                                    Executar\r\n                                </Button>\r\n                            </div>\r\n                        </CardHeader>\r\n                        <CardContent className=\"p-0\">\r\n                            <div className=\"overflow-x-auto\">\r\n                                <Table>\r\n                                    <TableHeader>\r\n                                        <TableRow className=\"hover:bg-transparent border-white/5 bg-white/2\">\r\n                                            <TableHead className=\"font-bold text-[10px] uppercase tracking-widest pl-6 cursor-pointer hover:text-primary transition-colors\" onClick={() => handleSortRoutes('status')}>\r\n                                                <div className=\"flex items-center gap-2\">Status <SortIcon config={routeSortConfig} columnKey=\"status\" /></div>\r\n                                            </TableHead>\r\n                                            <TableHead className=\"font-bold text-[10px] uppercase tracking-widest cursor-pointer hover:text-primary transition-colors\" onClick={() => handleSortRoutes('route')}>\r\n                                                <div className=\"flex items-center gap-2\">Rota / Endpoint <SortIcon config={routeSortConfig} columnKey=\"route\" /></div>\r\n                                            </TableHead>\r\n                                            <TableHead className=\"font-bold text-[10px] uppercase tracking-widest cursor-pointer hover:text-primary transition-colors\" onClick={() => handleSortRoutes('latency')}>\r\n                                                <div className=\"flex items-center gap-2\">Latência <SortIcon config={routeSortConfig} columnKey=\"latency\" /></div>\r\n                                            </TableHead>\r\n                                            <TableHead className=\"font-bold text-[10px] uppercase tracking-widest cursor-pointer hover:text-primary transition-colors\" onClick={() => handleSortRoutes('lastCheck')}>\r\n                                                <div className=\"flex items-center gap-2\">Checagem <SortIcon config={routeSortConfig} columnKey=\"lastCheck\" /></div>\r\n                                            </TableHead>\r\n                                            <TableHead className=\"font-bold text-[10px] uppercase tracking-widest pr-6\">Sugestão / Diagnóstico</TableHead>\r\n                                        </TableRow>\r\n                                    </TableHeader>\r\n                                    <TableBody>\r\n                                        {filteredRouteResults.length === 0 ? (\r\n                                            <TableRow>\r\n                                                <TableCell colSpan={5} className=\"text-center py-20 text-muted-foreground italic font-medium border-dashed border-white/5\">\r\n                                                    {isTestingRoutes ? 'Executando testes...' : 'Nenhum resultado encontrado para esta pesquisa.'}\r\n                                                </TableCell>\r\n                                            </TableRow>\r\n                                        ) : (\r\n                                            filteredRouteResults.map((res, i) => (\r\n                                                <TableRow\r\n                                                    key={i}\r\n                                                    className=\"hover:bg-white/5 border-white/5 transition-colors group cursor-pointer\"\r\n                                                    onClick={() => setSelectedRouteResult(res)}\r\n                                                >\r\n                                                    <TableCell className=\"pl-6 py-4\">\r\n                                                        <Badge className={cn(\"rounded-lg border-0 font-black text-[10px] uppercase\",\r\n                                                            res.status === 'UP' ? \"bg-green-500/10 text-green-500\" :\r\n                                                                res.status === 'SECURE' ? \"bg-blue-500/10 text-blue-500\" :\r\n                                                                    \"bg-red-500/10 text-red-500\"\r\n                                                        )}>\r\n                                                            {res.status === 'SECURE' ? `SECURE (${res.code})` : res.status}\r\n                                                        </Badge>\r\n                                                    </TableCell>\r\n                                                    <TableCell className=\"font-mono text-xs font-bold text-foreground/80\">{res.route}</TableCell>\r\n                                                    <TableCell className=\"font-black text-sm text-foreground\">{res.latency}</TableCell>\r\n                                                    <TableCell className=\"text-[10px] text-muted-foreground font-medium\">\r\n                                                        {res.lastCheck && isValidDate(res.lastCheck) ? format(new Date(res.lastCheck), 'HH:mm:ss') : '--:--'}\r\n                                                    </TableCell>\r\n                                                    <TableCell className=\"pr-6 text-[11px] text-white/60 font-medium italic truncate max-w-[350px]\" title={res.suggestion}>\r\n                                                        {res.suggestion}\r\n                                                    </TableCell>\r\n                                                </TableRow>\r\n                                            ))\r\n                                        )}\r\n                                    </TableBody>\r\n                                </Table>\r\n                            </div>\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    {/* MODAL DE DETALHES DA ROTA */}\r\n                    <Dialog open={!!selectedRouteResult} onOpenChange={(open) => !open && setSelectedRouteResult(null)}>\r\n                        <DialogContent className=\"max-w-2xl glass-card border-blue-500/20 bg-background/95 backdrop-blur-xl\">\r\n                            <DialogHeader>\r\n                                <div className=\"flex items-center gap-4 mb-2\">\r\n                                    <div className={cn(\"p-4 rounded-2xl shadow-glow\",\r\n                                        selectedRouteResult?.status === 'UP' ? \"bg-green-500/10 text-green-500\" :\r\n                                            selectedRouteResult?.status === 'SECURE' ? \"bg-blue-500/10 text-blue-500\" :\r\n                                                \"bg-red-500/10 text-red-500\"\r\n                                    )}>\r\n                                        <Activity className=\"w-8 h-8\" />\r\n                                    </div>\r\n                                    <div>\r\n                                        <DialogTitle className=\"text-2xl font-black uppercase tracking-tight flex items-center gap-3\">\r\n                                            Diagnóstico de Rota\r\n                                            <Badge className={cn(\"rounded-lg border-0 font-black\",\r\n                                                selectedRouteResult?.status === 'UP' ? \"bg-green-500/10 text-green-500\" :\r\n                                                    selectedRouteResult?.status === 'SECURE' ? \"bg-blue-500/10 text-blue-500\" :\r\n                                                        \"bg-red-500/10 text-red-500\"\r\n                                            )}>\r\n                                                {selectedRouteResult?.status}\r\n                                            </Badge>\r\n                                        </DialogTitle>\r\n                                        <DialogDescription className=\"font-mono text-xs font-bold text-blue-400\">\r\n                                            ENDPOINT: {selectedRouteResult?.route}\r\n                                        </DialogDescription>\r\n                                    </div>\r\n                                </div>\r\n                            </DialogHeader>\r\n\r\n                            {selectedRouteResult && (\r\n                                <div className=\"space-y-6 pt-4\">\r\n                                    <div className=\"grid grid-cols-2 gap-4\">\r\n                                        <div className=\"p-6 rounded-2xl bg-black/20 border border-white/5 space-y-1\">\r\n                                            <span className=\"text-[10px] font-black uppercase text-muted-foreground\">Velocidade de Resposta</span>\r\n                                            <p className=\"text-3xl font-black text-foreground\">{selectedRouteResult.latency}</p>\r\n                                        </div>\r\n                                        <div className=\"p-6 rounded-2xl bg-black/20 border border-white/5 space-y-1\">\r\n                                            <span className=\"text-[10px] font-black uppercase text-muted-foreground\">Última Verificação</span>\r\n                                            <p className=\"text-3xl font-black text-foreground\">\r\n                                                {selectedRouteResult.lastCheck && isValidDate(selectedRouteResult.lastCheck) ? format(new Date(selectedRouteResult.lastCheck), 'HH:mm:ss') : '--:--'}\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"p-8 rounded-3xl bg-blue-500/5 border border-blue-500/20 space-y-4\">\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <Zap className=\"w-5 h-5 text-blue-400 fill-blue-400\" />\r\n                                            <span className=\"text-xs font-black text-blue-400 uppercase tracking-widest\">Análise do Sistema</span>\r\n                                        </div>\r\n                                        <p className=\"text-lg font-medium text-foreground leading-relaxed italic\">\r\n                                            \"{selectedRouteResult.suggestion}\"\r\n                                        </p>\r\n                                    </div>\r\n\r\n                                    <div className=\"p-4 rounded-xl bg-black/10 text-[10px] text-muted-foreground italic font-medium\">\r\n                                        * Este diagnóstico é gerado em tempo real através de pings sintéticos originados do servidor de aplicação.\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </DialogContent>\r\n                    </Dialog>\r\n                </TabsContent>\r\n\r\n                {/* ABA 3: AUDITORIA DE PADRÕES (DETALHADA) */}\r\n                <TabsContent value=\"standards\" className=\"space-y-6\">\r\n                    <Card className=\"glass-card border-amber-500/20 bg-amber-500/5 shadow-2xl\">\r\n                        <CardHeader className=\"flex flex-col md:flex-row items-start md:items-center justify-between border-b border-amber-500/10 pb-6 gap-4\">\r\n                            <div>\r\n                                <CardTitle className=\"flex items-center gap-3 text-amber-500 font-black text-2xl uppercase tracking-tighter\">\r\n                                    <ShieldAlert className=\"w-8 h-8 drop-shadow-glow\" />\r\n                                    AUDITORIA ATIVA\r\n                                </CardTitle>\r\n                                <CardDescription className=\"text-amber-500/60 font-bold uppercase text-[10px] tracking-widest\">\r\n                                    Análise estática de código para conformidade estrutural.\r\n                                </CardDescription>\r\n                            </div>\r\n                            <div className=\"flex w-full md:w-auto items-center gap-3\">\r\n                                {/* Date Picker */}\r\n                                <Popover>\r\n                                    <PopoverTrigger asChild>\r\n                                        <Button\r\n                                            variant={\"outline\"}\r\n                                            className={cn(\r\n                                                \"w-[240px] justify-start text-left font-normal border-amber-500/20 bg-amber-500/5 hover:bg-amber-500/10 text-amber-100\",\r\n                                                !dateRange && \"text-muted-foreground\"\r\n                                            )}\r\n                                        >\r\n                                            <CalendarIcon className=\"mr-2 h-4 w-4 text-amber-500\" />\r\n                                            {dateRange?.from ? (\r\n                                                dateRange.to ? (\r\n                                                    <>\r\n                                                        {format(dateRange.from, \"dd/MM/yy\")} -{\" \"}\r\n                                                        {format(dateRange.to, \"dd/MM/yy\")}\r\n                                                    </>\r\n                                                ) : (\r\n                                                    format(dateRange.from, \"dd/MM/yy\")\r\n                                                )\r\n                                            ) : (\r\n                                                <span>Filtrar por Data</span>\r\n                                            )}\r\n                                        </Button>\r\n                                    </PopoverTrigger>\r\n                                    <PopoverContent className=\"w-auto p-0\" align=\"end\">\r\n                                        <Calendar\r\n                                            initialFocus\r\n                                            mode=\"range\"\r\n                                            defaultMonth={dateRange?.from}\r\n                                            selected={dateRange}\r\n                                            onSelect={(range) => setDateRange(range)}\r\n                                            numberOfMonths={2}\r\n                                        />\r\n                                    </PopoverContent>\r\n                                </Popover>\r\n\r\n                                {/* Order Select */}\r\n                                <div className=\"w-[200px]\">\r\n                                    <Select\r\n                                        onValueChange={(val) => {\r\n                                            const [key, dir] = val.split('-');\r\n                                            setAuditSortConfig({ key, direction: dir as 'asc' | 'desc' });\r\n                                        }}\r\n                                        defaultValue=\"lastDetectedAt-desc\"\r\n                                    >\r\n                                        <SelectTrigger className=\"border-amber-500/20 bg-amber-500/5 text-amber-100\">\r\n                                            <SelectValue placeholder=\"Ordenação\" />\r\n                                        </SelectTrigger>\r\n                                        <SelectContent>\r\n                                            <SelectItem value=\"lastDetectedAt-desc\">Mais Recentes</SelectItem>\r\n                                            <SelectItem value=\"lastDetectedAt-asc\">Mais Antigos</SelectItem>\r\n                                            <SelectItem value=\"severity-desc\">Maior Severidade</SelectItem>\r\n                                            <SelectItem value=\"severity-asc\">Menor Severidade</SelectItem>\r\n                                            <SelectItem value=\"file-asc\">Nome do Arquivo (A-Z)</SelectItem>\r\n                                        </SelectContent>\r\n                                    </Select>\r\n                                </div>\r\n\r\n                                <div className=\"relative flex-1 md:w-64\">\r\n                                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-amber-500/50\" />\r\n                                    <Input\r\n                                        placeholder=\"Filtrar arquivos ou violações...\"\r\n                                        value={auditSearchTerm}\r\n                                        onChange={(e) => setAuditSearchTerm(e.target.value)}\r\n                                        className=\"pl-10 bg-amber-500/10 border-amber-500/20 rounded-xl text-amber-100 placeholder:text-amber-500/40\"\r\n                                    />\r\n                                </div>\r\n                                <Button onClick={handleRunArchitecturalAudit} disabled={isAuditing} variant=\"destructive\" className=\"gap-2 shadow-2xl shadow-red-600/30 font-black py-7 px-10 rounded-2xl text-lg uppercase tracking-widest scale-100 hover:scale-105 active:scale-95 transition-all shrink-0\">\r\n                                    {isAuditing ? <RefreshCw className=\"w-6 h-6 animate-spin\" /> : <Zap className=\"w-6 h-6 fill-current\" />}\r\n                                    SCAN\r\n                                </Button>\r\n                            </div>\r\n                        </CardHeader>\r\n                        <CardContent className=\"p-0 bg-black/5\">\r\n                            <div className=\"overflow-x-auto\">\r\n                                <Table>\r\n                                    <TableHeader>\r\n                                        <TableRow className=\"hover:bg-transparent border-amber-500/10 bg-amber-500/5\">\r\n                                            <TableHead className=\"font-bold text-[10px] uppercase tracking-widest pl-6 text-amber-500/70 cursor-pointer hover:text-amber-500 transition-colors\" onClick={() => handleSortAudit('status')}>\r\n                                                <div className=\"flex items-center gap-2\">Auditor <SortIcon config={auditSortConfig} columnKey=\"status\" /></div>\r\n                                            </TableHead>\r\n                                            <TableHead className=\"font-bold text-[10px] uppercase tracking-widest text-amber-500/70 cursor-pointer hover:text-amber-500 transition-colors\" onClick={() => handleSortAudit('lastDetectedAt')}>\r\n                                                <div className=\"flex items-center gap-2\">Data <SortIcon config={auditSortConfig} columnKey=\"lastDetectedAt\" /></div>\r\n                                            </TableHead>\r\n                                            <TableHead className=\"font-bold text-[10px] uppercase tracking-widest text-amber-500/70 cursor-pointer hover:text-amber-500 transition-colors\" onClick={() => handleSortAudit('severity')}>\r\n                                                <div className=\"flex items-center gap-2\">Severidade <SortIcon config={auditSortConfig} columnKey=\"severity\" /></div>\r\n                                            </TableHead>\r\n                                            <TableHead className=\"font-bold text-[10px] uppercase tracking-widest text-amber-500/70 cursor-pointer hover:text-amber-500 transition-colors\" onClick={() => handleSortAudit('file')}>\r\n                                                <div className=\"flex items-center gap-2\">Arquivos / Componente <SortIcon config={auditSortConfig} columnKey=\"file\" /></div>\r\n                                            </TableHead>\r\n                                            <TableHead className=\"font-bold text-[10px] uppercase tracking-widest text-amber-500/70 cursor-pointer hover:text-amber-500 transition-colors\" onClick={() => handleSortAudit('violation')}>\r\n                                                <div className=\"flex items-center gap-2\">Violação Sugerida <SortIcon config={auditSortConfig} columnKey=\"violation\" /></div>\r\n                                            </TableHead>\r\n                                            <TableHead className=\"font-bold text-[10px] uppercase tracking-widest pr-6 text-amber-500/70\">Opção de Melhoria</TableHead>\r\n                                        </TableRow>\r\n                                    </TableHeader>\r\n                                    <TableBody>\r\n                                        {filteredAuditResults.length === 0 ? (\r\n                                            <TableRow>\r\n                                                <TableCell colSpan={5} className=\"text-center py-24 text-amber-500/20 italic font-medium border-dashed border-amber-500/10\">\r\n                                                    {isAuditing ? 'Executando scan estrutural...' : 'Nenhum problema encontrado ou filtro sem resultados.'}\r\n                                                </TableCell>\r\n                                            </TableRow>\r\n                                        ) : (\r\n                                            filteredAuditResults.map((res, i) => (\r\n                                                <TableRow\r\n                                                    key={i}\r\n                                                    className=\"hover:bg-amber-500/5 border-amber-500/10 transition-colors group cursor-pointer\"\r\n                                                    onClick={() => setSelectedAuditResult(res)}\r\n                                                >\r\n                                                    <TableCell className=\"pl-6 py-5\">\r\n                                                        <div className={cn(\"p-2 rounded-lg shrink-0\", res.status === 'FAIL' ? \"bg-red-500/10 text-red-500\" : \"bg-amber-500/10 text-amber-500\")}>\r\n                                                            {res.status === 'FAIL' ? <XCircle className=\"w-5 h-5\" /> : <AlertTriangle className=\"w-5 h-5\" />}\r\n                                                        </div>\r\n                                                    </TableCell>\r\n                                                    <TableCell>\r\n                                                        <div className=\"flex flex-col\">\r\n                                                            <span className=\"font-bold text-xs text-foreground\">\r\n                                                                {isValidDate(res.lastDetectedAt) ? format(new Date(res.lastDetectedAt), 'dd/MM/yy', { locale: ptBR }) : '--'}\r\n                                                            </span>\r\n                                                            <span className=\"text-[10px] text-muted-foreground\">\r\n                                                                {isValidDate(res.lastDetectedAt) ? format(new Date(res.lastDetectedAt), 'HH:mm') : ''}\r\n                                                            </span>\r\n                                                        </div>\r\n                                                    </TableCell>\r\n                                                    <TableCell>\r\n                                                        <Badge className={cn(\"rounded-lg border-0 font-black text-[10px] uppercase tracking-tight shadow-md\", getSeverityStyle(res.severity))}>\r\n                                                            {res.severity || 'LOW'}\r\n                                                        </Badge>\r\n                                                    </TableCell>\r\n                                                    <TableCell>\r\n                                                        <div className=\"flex flex-col gap-0.5\">\r\n                                                            <span className=\"text-xs font-bold text-foreground truncate max-w-[200px]\" title={res.file}>\r\n                                                                {res.file}\r\n                                                            </span>\r\n                                                            {res.count > 1 && (\r\n                                                                <span className=\"text-[9px] text-muted-foreground truncate w-[200px]\">\r\n                                                                    + {res.count - 1} outros arquivos\r\n                                                                </span>\r\n                                                            )}\r\n                                                        </div>\r\n                                                    </TableCell>\r\n                                                    <TableCell>\r\n                                                        <div className=\"flex flex-col gap-1\">\r\n                                                            <span className=\"text-[10px] font-black uppercase text-amber-500/90\">{res.violation}</span>\r\n                                                            <span className=\"text-[11px] text-muted-foreground leading-tight line-clamp-1 italic max-w-[250px]\" title={res.message}>{res.message}</span>\r\n                                                        </div>\r\n                                                    </TableCell>\r\n                                                    <TableCell className=\"pr-6\">\r\n                                                        <div className=\"flex items-center gap-2 bg-cyan-500/5 border border-cyan-500/10 p-3 rounded-xl\">\r\n                                                            <Zap className=\"w-3.5 h-3.5 text-cyan-400 fill-cyan-400 shrink-0\" />\r\n                                                            <p className=\"text-[11px] font-bold text-cyan-100/90 leading-relaxed truncate max-w-[350px]\" title={res.suggestion}>\r\n                                                                {res.suggestion}\r\n                                                            </p>\r\n                                                        </div>\r\n                                                    </TableCell>\r\n                                                </TableRow>\r\n                                            ))\r\n                                        )}\r\n                                    </TableBody>\r\n                                </Table>\r\n                            </div>\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    {/* MODAL DE DETALHES DA AUDITORIA */}\r\n                    <Dialog open={!!selectedAuditResult} onOpenChange={(open) => !open && setSelectedAuditResult(null)}>\r\n                        <DialogContent className=\"max-w-4xl glass-card border-amber-500/20 bg-background/95 backdrop-blur-xl\">\r\n                            <DialogHeader>\r\n                                <div className=\"flex items-center gap-5 mb-2\">\r\n                                    <div className={cn(\"p-5 rounded-[24px] shadow-2xl shadow-amber-500/20\",\r\n                                        selectedAuditResult?.status === 'FAIL' ? \"bg-red-500/20 text-red-500 border border-red-500/30\" : \"bg-amber-500/20 text-amber-500 border border-amber-500/30\"\r\n                                    )}>\r\n                                        <ShieldAlert className=\"w-10 h-10\" />\r\n                                    </div>\r\n                                    <div className=\"flex-1\">\r\n                                        <div className=\"flex items-center justify-between w-full\">\r\n                                            <DialogTitle className=\"text-3xl font-black uppercase tracking-tighter text-amber-500 leading-none\">\r\n                                                Detalhes da Violação Estrutural\r\n                                            </DialogTitle>\r\n                                            <Badge className={cn(\"rounded-xl border-0 font-black px-4 py-2 text-xs shadow-xl\", getSeverityStyle(selectedAuditResult?.severity))}>\r\n                                                SEVERIDADE: {selectedAuditResult?.severity}\r\n                                            </Badge>\r\n                                        </div>\r\n                                        {(selectedAuditResult as any)?.files && (selectedAuditResult as any)?.files?.length > 1 ? (\r\n                                            <div className=\"mt-4 w-full\">\r\n                                                <div className=\"flex items-center justify-between mb-2\">\r\n                                                    <span className=\"font-mono text-xs font-bold text-muted-foreground uppercase tracking-widest flex items-center gap-2\">\r\n                                                        <Database className=\"w-3 h-3\" /> {(selectedAuditResult as any)?.count} ARQUIVOS AFETADOS\r\n                                                    </span>\r\n                                                    <Button\r\n                                                        variant=\"outline\"\r\n                                                        size=\"sm\"\r\n                                                        className=\"h-6 text-[10px] gap-2 hover:bg-white/10 border-white/10 bg-black/20\"\r\n                                                        onClick={() => {\r\n                                                            if ((selectedAuditResult as any)?.files) {\r\n                                                                navigator.clipboard.writeText((selectedAuditResult as any)?.files.join('\\n'));\r\n                                                                toast.success('Lista de arquivos copiada para a área de transferência!');\r\n                                                            }\r\n                                                        }}\r\n                                                    >\r\n                                                        <Copy className=\"w-3 h-3\" /> COPIAR LISTA\r\n                                                    </Button>\r\n                                                </div>\r\n                                                <div className=\"bg-black/40 rounded-xl border border-white/5 overflow-hidden shadow-inner\">\r\n                                                    <div className=\"max-h-[140px] overflow-y-auto p-2 space-y-1\">\r\n                                                        {(selectedAuditResult as any)?.files?.map((file: string, i: number) => (\r\n                                                            <div key={i} className=\"text-[10px] font-mono text-cyan-100/70 break-all py-1.5 border-b border-white/5 last:border-0 hover:bg-white/5 px-2 rounded transition-colors select-all\">\r\n                                                                {file}\r\n                                                            </div>\r\n                                                        ))}\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        ) : (\r\n                                            <DialogDescription className=\"font-mono text-xs font-bold text-muted-foreground mt-2 uppercase tracking-widest flex items-center gap-2\">\r\n                                                <Database className=\"w-3 h-3\" /> ARQUIVO: {selectedAuditResult?.file}\r\n                                            </DialogDescription>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            </DialogHeader>\r\n\r\n                            {selectedAuditResult && (\r\n                                <div className=\"space-y-8 pt-6\">\r\n                                    <div className=\"grid grid-cols-1 md:grid-cols-[1fr_2fr] gap-6\">\r\n                                        <div className=\"space-y-6\">\r\n                                            <div className=\"p-6 rounded-[24px] bg-black/40 border border-white/5 space-y-2\">\r\n                                                <span className=\"text-[10px] font-black uppercase text-amber-500 tracking-widest\">Tipo de Violação</span>\r\n                                                <p className=\"text-sm font-black text-foreground uppercase\">{selectedAuditResult.violation || 'Desconhecida'}</p>\r\n                                            </div>\r\n                                            <div className=\"p-6 rounded-[24px] bg-black/40 border border-white/5 space-y-2\">\r\n                                                <span className=\"text-[10px] font-black uppercase text-amber-500 tracking-widest\">Estado de Scan</span>\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <Activity className=\"w-4 h-4 text-green-500\" />\r\n                                                    <p className=\"text-sm font-black text-green-500 uppercase\">Monitoramento Ativo</p>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        <div className=\"p-8 rounded-[32px] bg-black/60 border-2 border-amber-500/10 shadow-inner space-y-4\">\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <Info className=\"w-5 h-5 text-amber-500\" />\r\n                                                <span className=\"text-xs font-black text-amber-500 uppercase tracking-widest\">Descrição do Problema</span>\r\n                                            </div>\r\n                                            <p className=\"text-lg font-bold text-foreground leading-relaxed\">\r\n                                                {selectedAuditResult.message}\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"p-10 rounded-[40px] bg-cyan-500/5 border-2 border-cyan-500/20 shadow-2xl relative overflow-hidden group\">\r\n                                        <div className=\"absolute top-0 right-0 p-8 opacity-10\">\r\n                                            <Zap className=\"w-32 h-32 text-cyan-400 rotate-12\" />\r\n                                        </div>\r\n                                        <div className=\"flex items-start gap-6 relative z-10\">\r\n                                            <div className=\"p-4 rounded-2xl bg-cyan-500/20 border border-cyan-500/30 text-cyan-400\">\r\n                                                <Zap className=\"w-10 h-10 fill-cyan-400\" />\r\n                                            </div>\r\n                                            <div className=\"space-y-3\">\r\n                                                <span className=\"text-xs font-black text-cyan-400 uppercase tracking-[0.2em]\">Plano de Refatoração Recomendado</span>\r\n                                                <p className=\"text-xl font-mono text-cyan-50 font-bold leading-relaxed\">\r\n                                                    {selectedAuditResult.suggestion}\r\n                                                </p>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"flex justify-end pt-2\">\r\n                                        <p className=\"text-[10px] text-muted-foreground font-black uppercase tracking-widest opacity-30\">\r\n                                            ORION ARCHITECTURAL AUDITOR V2.4 // {format(new Date(), 'yyyy')}\r\n                                        </p>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </DialogContent>\r\n                    </Dialog>\r\n                </TabsContent>\r\n\r\n                <TabsContent value=\"gapo\" className=\"space-y-6\">\r\n                    <GAPOValidationList />\r\n                </TabsContent>\r\n            </Tabs >\r\n\r\n            {/* DIALOG DE DETALHES DO LOG */}\r\n            < Dialog open={!!selectedLog\r\n            } onOpenChange={(open) => !open && setSelectedLog(null)}>\r\n                <DialogContent className=\"max-w-3xl glass-card border-primary/20 bg-background/95 backdrop-blur-xl\">\r\n                    <DialogHeader>\r\n                        <div className=\"flex items-center gap-4 mb-2\">\r\n                            <div className={cn(\"p-3 rounded-2xl shadow-glow\", getActionStyle(selectedLog?.action || ''))}>\r\n                                <Database className=\"w-6 h-6\" />\r\n                            </div>\r\n                            <div>\r\n                                <DialogTitle className=\"text-2xl font-black uppercase tracking-tight flex items-center gap-2\">\r\n                                    {selectedLog?.action === 'UPDATE' ? 'Alteração de Dados' : 'Detalhes do Evento'}\r\n                                    {selectedLog && (\r\n                                        <Badge className={getActionStyle(selectedLog.action)}>\r\n                                            {selectedLog.action}\r\n                                        </Badge>\r\n                                    )}\r\n                                </DialogTitle>\r\n                                <DialogDescription className=\"font-medium\">\r\n                                    UUID do Registro: <span className=\"font-mono text-[10px] bg-black/20 p-1 rounded\">{selectedLog?.record_id}</span>\r\n                                </DialogDescription>\r\n                            </div>\r\n                        </div>\r\n                    </DialogHeader>\r\n\r\n                    {selectedLog && (\r\n                        <div className=\"space-y-6 pt-4\">\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n                                <div className=\"space-y-1\">\r\n                                    <label className=\"text-[10px] font-black uppercase text-muted-foreground flex items-center gap-1\">\r\n                                        <CalendarIcon className=\"w-3 h-3\" /> Data e Hora\r\n                                    </label>\r\n                                    <p className=\"text-sm font-bold\">\r\n                                        {isValidDate(selectedLog.performed_at)\r\n                                            ? format(new Date(selectedLog.performed_at), \"dd/MM/yy 'às' HH:mm\", { locale: ptBR })\r\n                                            : 'N/A'}\r\n                                    </p>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-1\">\r\n                                    <label className=\"text-[10px] font-black uppercase text-muted-foreground flex items-center gap-1\">\r\n                                        <User className=\"w-3 h-3\" /> Autor da Ação\r\n                                    </label>\r\n                                    <p className=\"text-sm font-bold text-primary\">{selectedLog.performer_name}</p>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-1\">\r\n                                    <label className=\"text-[10px] font-black uppercase text-muted-foreground flex items-center gap-1\">\r\n                                        <User className=\"w-3 h-3\" /> Alvo / Afetado\r\n                                    </label>\r\n                                    <div className=\"flex flex-col\">\r\n                                        <p className=\"text-sm font-bold\">\r\n                                            {(selectedLog.new_data as any)?.name || (selectedLog.old_data as any)?.name || (selectedLog.new_data as any)?.email || (selectedLog.old_data as any)?.email || 'Registro ID'}\r\n                                        </p>\r\n                                        <span className=\"text-[9px] font-mono text-muted-foreground truncate max-w-[120px]\" title={selectedLog.record_id}>\r\n                                            {selectedLog.record_id}\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-1\">\r\n                                    <label className=\"text-[10px] font-black uppercase text-muted-foreground flex items-center gap-1\">\r\n                                        <Database className=\"w-3 h-3\" /> Tabela\r\n                                    </label>\r\n                                    <p className=\"text-sm font-bold\">{getTableNameLabel(selectedLog.table_name)}</p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                <div className=\"space-y-1\">\r\n                                    <label className=\"text-[10px] font-black uppercase text-muted-foreground flex items-center gap-1\">\r\n                                        <Activity className=\"w-3 h-3\" /> IP de Origem\r\n                                    </label>\r\n                                    <p className=\"text-sm font-mono font-bold text-muted-foreground\">{selectedLog.ipAddress || 'Não registrado'}</p>\r\n                                </div>\r\n                                <div className=\"space-y-1\">\r\n                                    <label className=\"text-[10px] font-black uppercase text-muted-foreground flex items-center gap-1\">\r\n                                        <Search className=\"w-3 h-3\" /> Sistema\r\n                                    </label>\r\n                                    <p className=\"text-[10px] text-muted-foreground leading-tight italic line-clamp-2\" title={selectedLog.userAgent}>\r\n                                        {selectedLog.userAgent || 'Desconhecido'}\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-3\">\r\n                                <label className=\"text-[10px] font-black uppercase text-muted-foreground\">Comparativo de Dados</label>\r\n                                <div className=\"p-1 rounded-xl bg-black/20 border border-white/5\">\r\n                                    <DiffViewer oldData={selectedLog.old_data} newData={selectedLog.new_data} />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </DialogContent>\r\n            </Dialog >\r\n        </div >\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\Auth.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'HardHat' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'db' is defined but never used.","line":10,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'username' is assigned a value but never used.","line":34,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setUsername' is assigned a value but never used.","line":34,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1606,1609],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1606,1609],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { HardHat, Mail, Lock, ArrowLeft, Loader2, QrCode, Smartphone, ShieldCheck, WifiOff, User } from 'lucide-react';\r\nimport { localApi as db } from '@/integrations/orion/client';\r\nimport { QRCodeSVG } from 'qrcode.react';\r\nimport { verify } from 'otplib';\r\nimport { PasswordResetRequestForm } from '@/components/auth/PasswordResetRequestForm';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\"\r\n\r\ntype AuthMode = 'login' | 'qr';\r\n\r\ninterface OfflineAccountInfo {\r\n  identifier: string;\r\n  fullName: string;\r\n  avatarUrl?: string | null;\r\n  role: string;\r\n}\r\n\r\nexport default function Auth() {\r\n  const [mode, setMode] = useState<AuthMode>('login');\r\n  const [username, setUsername] = useState('');\r\n  const [email, setEmail] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [qrToken, setQrToken] = useState('');\r\n  const [showMfaChallenge, setShowMfaChallenge] = useState(false);\r\n  const [mfaCode, setMfaCode] = useState('');\r\n  const [pendingProfile, setPendingProfile] = useState<any>(null);\r\n  const [isOffline, setIsOffline] = useState(!navigator.onLine);\r\n  const [offlineAccount, setOfflineAccount] = useState<OfflineAccountInfo | null>(null);\r\n\r\n  const { login, loginOffline, getLastOfflineAccount, setMfaVerified } = useAuth();\r\n  const navigate = useNavigate();\r\n  const { toast } = useToast();\r\n\r\n  // Check offline status and last account\r\n  useEffect(() => {\r\n    const handleOnline = () => setIsOffline(false);\r\n    const handleOffline = () => setIsOffline(true);\r\n\r\n    window.addEventListener('online', handleOnline);\r\n    window.addEventListener('offline', handleOffline);\r\n\r\n    // Check for last offline account\r\n    getLastOfflineAccount().then(account => {\r\n      if (account) {\r\n        setOfflineAccount(account);\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      window.removeEventListener('online', handleOnline);\r\n      window.removeEventListener('offline', handleOffline);\r\n    };\r\n  }, [getLastOfflineAccount]);\r\n\r\n  useEffect(() => {\r\n    if (mode === 'qr') {\r\n      const token = `ttpro_link_${Math.random().toString(36).substring(7)}_${Date.now()}`;\r\n      setQrToken(token);\r\n      // QR Login logic was removed due to db real-time dependency.\r\n      // It will be reimplemented using local API polling or WebSockets in the future.\r\n    }\r\n  }, [mode]);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      const result = await login(email, password);\r\n      if (result.success) {\r\n        if (result.mfaRequired && result.profile) {\r\n          setPendingProfile(result.profile);\r\n          setShowMfaChallenge(true);\r\n          toast({\r\n            title: 'MFA Requerido',\r\n            description: 'Insira o código do seu autenticador.',\r\n          });\r\n          return;\r\n        }\r\n\r\n        // If no MFA required, consider it verified immediately\r\n        setMfaVerified(true);\r\n        toast({\r\n          title: 'Login realizado!',\r\n          description: 'Bem-vindo ao GESTÃO VIRTUAL',\r\n        });\r\n        navigate('/dashboard');\r\n      } else {\r\n        toast({\r\n          title: 'Erro no login',\r\n          description: result.error,\r\n          variant: 'destructive',\r\n\r\n        });\r\n      }\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleOfflineLogin = async () => {\r\n    setIsLoading(true);\r\n    try {\r\n      const result = await loginOffline();\r\n      if (result.success) {\r\n        toast({\r\n          title: 'Login Offline Realizado!',\r\n          description: 'Você está acessando em modo offline.',\r\n        });\r\n        navigate('/dashboard');\r\n      } else {\r\n        toast({\r\n          title: 'Erro no login offline',\r\n          description: result.error,\r\n          variant: 'destructive',\r\n        });\r\n      }\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleVerifyMfa = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (mfaCode.length !== 6 || !pendingProfile) return;\r\n\r\n    setIsLoading(true);\r\n    try {\r\n      const isValid = await verify({\r\n        token: mfaCode,\r\n        secret: pendingProfile.mfaSecret\r\n      });\r\n\r\n      console.log('MFA Login Verification:', {\r\n        codeReceived: mfaCode,\r\n        isValid: isValid.valid,\r\n        secretUsed: pendingProfile.mfaSecret.substring(0, 4) + '...'\r\n      });\r\n\r\n      if (isValid.valid) {\r\n        setMfaVerified(true);\r\n        toast({\r\n          title: 'Segurança validada!',\r\n          description: 'Acesso concedido.',\r\n        });\r\n        navigate('/dashboard');\r\n      } else {\r\n        toast({\r\n          title: 'Código incorreto',\r\n          description: 'O código TOTP inserido é inválido ou expirou.',\r\n          variant: 'destructive'\r\n        });\r\n      }\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen dark theme-industrial gradient-hero flex items-center justify-center p-4\">\r\n      <div className=\"w-full max-w-lg animate-fade-in flex flex-col items-center\">\r\n        <div className=\"text-center mb-0 flex flex-col items-center\">\r\n          <img\r\n            src=\"/logo-orion.png\"\r\n            alt=\"Orion Logo\"\r\n            className=\"w-[450px] md:w-[500px] h-auto drop-shadow-[0_0_25px_rgba(255,255,255,0.2)] animate-in fade-in zoom-in duration-1000\"\r\n          />\r\n        </div>\r\n\r\n        <Card className=\"glass-card border-foreground/10 relative overflow-hidden w-full max-w-md -mt-6\">\r\n          {mode === 'qr' && (\r\n            <div className=\"absolute -top-24 -right-24 w-48 h-48 bg-primary/20 rounded-full blur-3xl animate-pulse\" />\r\n          )}\r\n\r\n          <CardHeader className=\"text-center\">\r\n            <CardTitle className=\"text-2xl font-bold flex items-center justify-center gap-2 text-foreground\">\r\n              {showMfaChallenge ? 'Verificação MFA' : mode === 'login' ? 'Bem-vindo' : 'Acesso Rápido'}\r\n              {(mode === 'qr' || showMfaChallenge) && (\r\n                showMfaChallenge ? <ShieldCheck className=\"w-6 h-6 text-primary\" /> : <QrCode className=\"w-6 h-6 text-primary\" />\r\n              )}\r\n            </CardTitle>\r\n            <CardDescription className=\"text-foreground/70\">\r\n              {showMfaChallenge\r\n                ? 'Insira o código de 6 dígitos do Microsoft Authenticator'\r\n                : mode === 'login' ? 'Entre com suas credenciais' : 'Use seu celular para entrar'}\r\n            </CardDescription>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {showMfaChallenge ? (\r\n              <form onSubmit={handleVerifyMfa} className=\"space-y-6\">\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"mfa-code\" className=\"text-foreground/80 font-semibold uppercase text-[10px] tracking-wider text-center block\">Código de Segurança</Label>\r\n                  <Input\r\n                    id=\"mfa-code\"\r\n                    type=\"text\"\r\n                    placeholder=\"000 000\"\r\n                    value={mfaCode}\r\n                    onChange={(e) => setMfaCode(e.target.value.replace(/\\D/g, '').slice(0, 6))}\r\n                    className=\"text-center text-3xl tracking-[0.5em] font-bold h-16 dark:industrial-input-dark\"\r\n                    required\r\n                    autoFocus\r\n                  />\r\n                </div>\r\n\r\n                <Button\r\n                  type=\"submit\"\r\n                  className=\"w-full h-11 gradient-primary text-primary-foreground font-bold shadow-glow\"\r\n                  disabled={isLoading || mfaCode.length !== 6}\r\n                >\r\n                  {isLoading ? <Loader2 className=\"w-4 h-4 animate-spin mr-2\" /> : 'Verificar e Entrar'}\r\n                </Button>\r\n\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  className=\"w-full text-xs text-muted-foreground\"\r\n                  onClick={() => {\r\n                    setShowMfaChallenge(false);\r\n                    setMfaCode('');\r\n                  }}\r\n                >\r\n                  <ArrowLeft className=\"w-3 h-3 mr-2\" /> Voltar ao login\r\n                </Button>\r\n              </form>\r\n            ) : mode === 'login' ? (\r\n              <>\r\n                {/* Offline Login Banner */}\r\n                {isOffline && offlineAccount && (\r\n                  <div className=\"mb-4 p-4 rounded-lg bg-amber-500/10 border border-amber-500/30\">\r\n                    <div className=\"flex items-center gap-2 text-amber-500 mb-2\">\r\n                      <WifiOff className=\"w-4 h-4\" />\r\n                      <span className=\"font-semibold text-sm\">Modo Offline</span>\r\n                    </div>\r\n                    <p className=\"text-xs text-foreground/70 mb-3\">\r\n                      Sem conexão com a internet. Você pode continuar como:\r\n                    </p>\r\n                    <Button\r\n                      onClick={handleOfflineLogin}\r\n                      disabled={isLoading}\r\n                      className=\"w-full bg-amber-600 hover:bg-amber-700 text-white\"\r\n                    >\r\n                      {isLoading ? (\r\n                        <Loader2 className=\"w-4 h-4 animate-spin mr-2\" />\r\n                      ) : (\r\n                        <User className=\"w-4 h-4 mr-2\" />\r\n                      )}\r\n                      Entrar como {offlineAccount.fullName}\r\n                    </Button>\r\n                    <p className=\"text-[10px] text-foreground/50 mt-2 text-center\">\r\n                      ({offlineAccount.identifier})\r\n                    </p>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Offline indicator without cached account */}\r\n                {isOffline && !offlineAccount && (\r\n                  <div className=\"mb-4 p-3 rounded-lg bg-destructive/10 border border-destructive/30\">\r\n                    <div className=\"flex items-center gap-2 text-destructive\">\r\n                      <WifiOff className=\"w-4 h-4\" />\r\n                      <span className=\"font-semibold text-sm\">Sem Conexão</span>\r\n                    </div>\r\n                    <p className=\"text-xs text-foreground/70 mt-1\">\r\n                      É necessário estar online para o primeiro login.\r\n                    </p>\r\n                  </div>\r\n                )}\r\n\r\n                <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"email\" className=\"text-foreground/80 font-semibold uppercase text-[10px] tracking-wider\">Usuário ou E-mail</Label>\r\n                    <div className=\"relative group\">\r\n                      <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-foreground/40 group-focus-within:text-primary transition-colors\" />\r\n                      <Input\r\n                        id=\"email\"\r\n                        type=\"text\"\r\n                        placeholder=\"E-mail ou Matrícula (#12345678)\"\r\n                        value={email}\r\n                        onChange={(e) => setEmail(e.target.value)}\r\n                        className=\"pl-10 dark:industrial-input-dark\"\r\n                        required\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"password\" title=\"password label\" className=\"text-foreground/80 font-semibold uppercase text-[10px] tracking-wider\">Senha de Acesso</Label>\r\n                    <div className=\"relative group\">\r\n                      <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-foreground/40 group-focus-within:text-primary transition-colors\" />\r\n                      <Input\r\n                        id=\"password\"\r\n                        type=\"password\"\r\n                        placeholder=\"••••••••\"\r\n                        value={password}\r\n                        onChange={(e) => setPassword(e.target.value)}\r\n                        className=\"pl-10  dark:industrial-input-dark\"\r\n                        required\r\n                        minLength={6}\r\n                        autoComplete=\"current-password\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  <Button\r\n                    type=\"submit\"\r\n                    className=\"w-full h-11 gradient-primary text-primary-foreground font-bold shadow-glow hover:scale-[1.02] active:scale-[0.98] transition-all duration-200\"\r\n                    disabled={isLoading}\r\n                  >\r\n                    {isLoading ? (\r\n                      <Loader2 className=\"w-4 h-4 animate-spin mr-2\" />\r\n                    ) : 'Entrar no Sistema'}\r\n                  </Button>\r\n\r\n\r\n                  <div className=\"text-center mt-2\">\r\n                    <Dialog>\r\n                      <DialogTrigger asChild>\r\n                        <Button variant=\"link\" className=\"text-xs text-muted-foreground hover:text-primary\">\r\n                          Esqueceu sua senha? Solicitar redefinição\r\n                        </Button>\r\n                      </DialogTrigger>\r\n                      <DialogContent>\r\n                        <DialogHeader>\r\n                          <DialogTitle>Solicitação de Redefinição</DialogTitle>\r\n                          <DialogDescription>\r\n                            Informe seus dados. Um administrador analisará sua solicitação.\r\n                          </DialogDescription>\r\n                        </DialogHeader>\r\n                        <PasswordResetRequestForm />\r\n                      </DialogContent>\r\n                    </Dialog>\r\n                  </div>\r\n                </form>\r\n              </>\r\n            ) : (\r\n              <div className=\"flex flex-col items-center justify-center py-4 space-y-6 animate-scale-in\">\r\n                <div className=\"p-4 bg-white rounded-3xl shadow-glow overflow-hidden\">\r\n                  <QRCodeSVG\r\n                    value={qrToken}\r\n                    size={220}\r\n                    level=\"H\"\r\n                    includeMargin={true}\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"text-center space-y-3 px-6\">\r\n                  <div className=\"flex items-center justify-center gap-2 text-primary font-semibold\">\r\n                    <Smartphone className=\"w-5 h-5\" />\r\n                    <span>Sincronizar Dispositivo</span>\r\n                  </div>\r\n                  <p className=\"text-sm text-foreground/60 leading-relaxed font-medium\">\r\n                    Escaneie para vincular seu telefone e habilitar o login biométrico e geolocalização.\r\n                  </p>\r\n                </div>\r\n\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  className=\"text-foreground/60 hover:text-foreground hover:bg-foreground/5 font-semibold\"\r\n                  onClick={() => setMode('login')}\r\n                >\r\n                  <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n                  Voltar ao login comum\r\n                </Button>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"mt-8 border-t border-foreground/5 pt-6 text-center\">\r\n              {mode === 'login' && !showMfaChallenge && (\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setMode('qr')}\r\n                  className=\"text-primary hover:text-primary/80 flex items-center justify-center gap-2 w-full font-black text-xs tracking-widest transition-colors\"\r\n                >\r\n                  <QrCode className=\"w-4 h-4\" />\r\n                  LOGIN VIA QR CODE\r\n                </button>\r\n              )}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    </div >\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\Companies.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'DialogTrigger' is defined but never used.","line":7,"column":79,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":92},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Mail' is defined but never used.","line":9,"column":88,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":92}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { useCompanies, Company } from '@/hooks/useCompanies';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { Plus, Building2, Search, Loader2, MapPin, Phone, Pencil, Trash2, ShieldCheck, Mail } from 'lucide-react';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { ConfirmationDialog } from '@/components/shared/ConfirmationDialog';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { isProtectedSignal, can } from '@/signals/authSignals';\r\nimport { Lock } from 'lucide-react';\r\n\r\nexport default function Companies() {\r\n    const { companies, isLoading, createCompany, updateCompany, deleteCompany } = useCompanies();\r\n    const { profile } = useAuth();\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [isDialogOpen, setIsDialogOpen] = useState(false);\r\n    const [editingCompany, setEditingCompany] = useState<Company | null>(null);\r\n    const [isSaving, setIsSaving] = useState(false);\r\n    const [formData, setFormData] = useState({\r\n        name: '',\r\n        taxId: '',\r\n        address: '',\r\n        phone: '',\r\n    });\r\n    const [confirmModal, setConfirmModal] = useState<{\r\n        open: boolean;\r\n        title: string;\r\n        description: string;\r\n        onConfirm: () => void | Promise<void>;\r\n        variant: 'default' | 'destructive';\r\n    }>({\r\n        open: false,\r\n        title: '',\r\n        description: '',\r\n        onConfirm: () => { },\r\n        variant: 'default'\r\n    });\r\n    const { toast } = useToast();\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!formData.name.trim()) return;\r\n\r\n        setIsSaving(true);\r\n        try {\r\n            if (editingCompany) {\r\n                const result = await updateCompany(editingCompany.id, formData);\r\n                if (result.success) {\r\n                    toast({ title: 'Empresa atualizada!' });\r\n                    resetForm();\r\n                }\r\n            } else {\r\n                const result = await createCompany(formData);\r\n                if (result.success) {\r\n                    toast({ title: 'Empresa cadastrada!' });\r\n                    resetForm();\r\n                }\r\n            }\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    const handleEdit = (company: Company) => {\r\n        setEditingCompany(company);\r\n        setFormData({\r\n            name: company.name,\r\n            taxId: company.taxId || '',\r\n            address: company.address || '',\r\n            phone: company.phone || '',\r\n        });\r\n        setIsDialogOpen(true);\r\n    };\r\n\r\n    const handleDelete = async (company: Company) => {\r\n        setConfirmModal({\r\n            open: true,\r\n            title: 'Excluir Empresa',\r\n            description: `Deseja realmente excluir a empresa \"${company.name}\"? Esta ação não pode ser desfeita.`,\r\n            variant: 'destructive',\r\n            onConfirm: async () => {\r\n                const result = await deleteCompany(company.id);\r\n                if (result.success) {\r\n                    toast({ title: 'Empresa excluída!' });\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    const resetForm = () => {\r\n        setFormData({ name: '', taxId: '', address: '', phone: '' });\r\n        setEditingCompany(null);\r\n        setIsDialogOpen(false);\r\n    };\r\n\r\n    const filteredCompanies = companies.filter(c => {\r\n        const matchesSearch = c.name.toLowerCase().includes(searchTerm.toLowerCase());\r\n        const isSA = isProtectedSignal.value;\r\n        const matchesCompany = isSA || c.id === profile?.companyId;\r\n        return matchesSearch && matchesCompany;\r\n    });\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center h-64\">\r\n                <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-fade-in\">\r\n            <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-display font-bold gradient-text\">Gestão de Empresas</h1>\r\n                    <p className=\"text-muted-foreground\">Cadastre e gerencie as empresas do grupo</p>\r\n                </div>\r\n                <Dialog open={isDialogOpen} onOpenChange={(open) => {\r\n                    setIsDialogOpen(open);\r\n                    if (!open) resetForm();\r\n                }}>\r\n                    {(isProtectedSignal.value || can('system.is_corporate') || can('companies.create')) && (\r\n                        <Button\r\n                            className=\"gradient-primary text-white shadow-glow\"\r\n                            onClick={() => {\r\n                                resetForm();\r\n                                setIsDialogOpen(true);\r\n                            }}\r\n                        >\r\n                            <Plus className=\"w-4 h-4 mr-2\" />\r\n                            Nova Empresa\r\n                        </Button>\r\n                    )}\r\n                    <DialogContent className=\"max-w-md\">\r\n                        <DialogHeader>\r\n                            <DialogTitle className=\"flex items-center gap-2 text-2xl font-bold\">\r\n                                <div className=\"w-10 h-10 rounded-lg gradient-primary flex items-center justify-center shadow-glow\">\r\n                                    <Building2 className=\"text-white w-6 h-6\" />\r\n                                </div>\r\n                                {editingCompany ? 'Editar Empresa' : 'Nova Empresa'}\r\n                            </DialogTitle>\r\n                            <DialogDescription className=\"text-muted-foreground pt-1\">\r\n                                Gerencie os dados cadastrais da empresa no grupo.\r\n                            </DialogDescription>\r\n                        </DialogHeader>\r\n\r\n                        <form onSubmit={handleSubmit} className=\"space-y-6 pt-4\">\r\n                            {/* Seção: Dados Cadastrais */}\r\n                            <div className=\"space-y-4\">\r\n                                <div className=\"flex items-center gap-2 text-primary font-semibold text-sm uppercase tracking-wider\">\r\n                                    <ShieldCheck className=\"w-4 h-4\" />\r\n                                    Dados Cadastrais\r\n                                </div>\r\n                                <Separator className=\"bg-white/10\" />\r\n\r\n                                <div className=\"space-y-2\">\r\n                                    <Label className=\"text-xs uppercase text-muted-foreground font-bold\">Nome da Empresa *</Label>\r\n                                    <Input\r\n                                        value={formData.name}\r\n                                        onChange={e => setFormData({ ...formData, name: e.target.value })}\r\n                                        className=\"industrial-input h-10\"\r\n                                        placeholder=\"Ex: Nono Engenharia\"\r\n                                        required\r\n                                    />\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    <Label className=\"text-xs uppercase text-muted-foreground font-bold\">CNPJ / Identificação</Label>\r\n                                    <Input\r\n                                        value={formData.taxId}\r\n                                        onChange={e => setFormData({ ...formData, taxId: e.target.value })}\r\n                                        className=\"industrial-input h-10\"\r\n                                        placeholder=\"00.000.000/0000-00\"\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Seção: Contato */}\r\n                            <div className=\"space-y-4 pt-2\">\r\n                                <div className=\"flex items-center gap-2 text-amber-500 font-semibold text-sm uppercase tracking-wider\">\r\n                                    <MapPin className=\"w-4 h-4\" />\r\n                                    Endereço e Contato\r\n                                </div>\r\n                                <Separator className=\"bg-white/10\" />\r\n\r\n                                <div className=\"space-y-2\">\r\n                                    <Label className=\"text-xs uppercase text-muted-foreground font-bold\">Endereço</Label>\r\n                                    <div className=\"relative\">\r\n                                        <MapPin className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground/50\" />\r\n                                        <Input\r\n                                            value={formData.address}\r\n                                            onChange={e => setFormData({ ...formData, address: e.target.value })}\r\n                                            className=\"industrial-input pl-10 h-10\"\r\n                                            placeholder=\"Logradouro, Bairro, Cidade - UF\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    <Label className=\"text-xs uppercase text-muted-foreground font-bold\">Telefone</Label>\r\n                                    <div className=\"relative\">\r\n                                        <Phone className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground/50\" />\r\n                                        <Input\r\n                                            value={formData.phone}\r\n                                            onChange={e => setFormData({ ...formData, phone: e.target.value })}\r\n                                            className=\"industrial-input pl-10 h-10\"\r\n                                            placeholder=\"(00) 0000-0000\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"pt-4 flex gap-3\">\r\n                                <Button type=\"button\" variant=\"outline\" onClick={resetForm} className=\"flex-1 h-11\">\r\n                                    Cancelar\r\n                                </Button>\r\n                                <Button type=\"submit\" className=\"flex-1 h-11 gradient-primary shadow-glow\" disabled={isSaving}>\r\n                                    {isSaving ? <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> : null}\r\n                                    {editingCompany ? 'Salvar Alterações' : 'Cadastrar Empresa'}\r\n                                </Button>\r\n                            </div>\r\n                        </form>\r\n                    </DialogContent>\r\n                </Dialog>\r\n            </div>\r\n\r\n            <div className=\"relative max-w-md\">\r\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n                <Input\r\n                    placeholder=\"Buscar empresas...\"\r\n                    value={searchTerm}\r\n                    onChange={(e) => setSearchTerm(e.target.value)}\r\n                    className=\"pl-10 industrial-input\"\r\n                />\r\n            </div>\r\n\r\n            <div className=\"grid sm:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                {filteredCompanies.map((company) => (\r\n                    <Card key={company.id} className=\"glass-card group hover:shadow-strong transition-all overflow-hidden border-l-4 border-l-primary relative\">\r\n                        <div className=\"absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                            {(() => {\r\n                                const canEdit = isProtectedSignal.value || can('companies.update') || can('companies.edit_config');\r\n                                const canDelete = isProtectedSignal.value || can('companies.delete');\r\n\r\n                                if (!canEdit && !canDelete) {\r\n                                    return (\r\n                                        <div className=\"h-8 flex items-center px-2 bg-white/5 rounded text-muted-foreground/30\" title=\"Sem permissão hierárquica\">\r\n                                            <Lock className=\"w-3.5 h-3.5 mr-1\" />\r\n                                            <span className=\"text-[10px] uppercase font-bold\">Leitura</span>\r\n                                        </div>\r\n                                    );\r\n                                }\r\n\r\n                                return (\r\n                                    <>\r\n                                        {canEdit && (\r\n                                            <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 text-muted-foreground hover:text-primary\" onClick={() => handleEdit(company)}>\r\n                                                <Pencil className=\"w-4 h-4\" />\r\n                                            </Button>\r\n                                        )}\r\n                                        {canDelete && (\r\n                                            <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 text-muted-foreground hover:text-destructive\" onClick={() => handleDelete(company)}>\r\n                                                <Trash2 className=\"w-4 h-4\" />\r\n                                            </Button>\r\n                                        )}\r\n                                    </>\r\n                                );\r\n                            })()}\r\n                        </div>\r\n\r\n                        <CardHeader className=\"pb-3\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <div className=\"p-3 rounded-2xl bg-primary/10 group-hover:bg-primary/20 transition-colors\">\r\n                                    <Building2 className=\"w-6 h-6 text-primary\" />\r\n                                </div>\r\n                                <div>\r\n                                    <CardTitle className=\"text-lg\">{company.name}</CardTitle>\r\n                                    <CardDescription>{company.taxId || 'CNPJ não informado'}</CardDescription>\r\n                                </div>\r\n                            </div>\r\n                        </CardHeader>\r\n                        <CardContent className=\"space-y-4\">\r\n                            <div className=\"space-y-2 text-sm text-muted-foreground\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <MapPin className=\"w-4 h-4\" />\r\n                                    <span className=\"truncate\">{company.address || 'Endereço não cadastrado'}</span>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <Phone className=\"w-4 h-4\" />\r\n                                    <span>{company.phone || 'Sem telefone'}</span>\r\n                                </div>\r\n                            </div>\r\n                        </CardContent>\r\n                    </Card>\r\n                ))}\r\n            </div>\r\n            {/* Confirmation Dialog */}\r\n            <ConfirmationDialog\r\n                open={confirmModal.open}\r\n                onOpenChange={(open) => setConfirmModal(prev => ({ ...prev, open }))}\r\n                title={confirmModal.title}\r\n                description={confirmModal.description}\r\n                onConfirm={confirmModal.onConfirm}\r\n                variant={confirmModal.variant}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\CustomSU.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Edit2' is defined but never used.","line":2,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CheckCircle2' is defined but never used.","line":2,"column":63,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":75},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'can' is defined but never used.","line":7,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CardTitle' is defined but never used.","line":10,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'DialogTrigger' is defined but never used.","line":36,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":92,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3386,3389],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3386,3389],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":149,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5370,5373],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5370,5373],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":192,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6894,6897],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6894,6897],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":194,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":194,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7080,7083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7080,7083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":217,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8264,8267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8264,8267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":231,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":231,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8837,8840],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8837,8840],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":243,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":243,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9351,9354],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9351,9354],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":259,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":259,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10019,10022],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10019,10022],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":13,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Plus, X, Save, Edit2, Loader2, Shield, Info, Trash2, CheckCircle2, FileText, RefreshCw } from 'lucide-react';\r\nimport { getRoleStyle, getRoleLabel, STANDARD_ROLES, STANDARD_MODULES } from '@/utils/roleUtils';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { localApi } from '@/integrations/orion/client';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { isProtectedSignal, can } from '@/signals/authSignals';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport { Checkbox } from '@/components/ui/checkbox';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { cn } from '@/lib/utils';\r\nimport {\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableHead,\r\n    TableHeader,\r\n    TableRow\r\n} from '@/components/ui/table';\r\nimport {\r\n    Tabs,\r\n    TabsContent,\r\n    TabsList,\r\n    TabsTrigger,\r\n} from \"@/components/ui/tabs\";\r\nimport SUDocumentHub from '@/components/su/SUDocumentHub';\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogDescription,\r\n    DialogFooter,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\n\r\ninterface Level {\r\n    id: string;\r\n    name: string;\r\n    rank: number;\r\n    is_system: boolean;\r\n}\r\n\r\ninterface Module {\r\n    id: string;\r\n    code: string;\r\n    name: string;\r\n    category: string;\r\n}\r\n\r\nexport default function CustomSU() {\r\n    const { profile } = useAuth();\r\n    const { toast } = useToast();\r\n    const [levels, setLevels] = useState<Level[]>([]);\r\n    const [modules, setModules] = useState<Module[]>([]);\r\n    const [matrix, setMatrix] = useState<Record<string, boolean>>({});\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [isSaving, setIsSaving] = useState(false);\r\n    const [isAddingLevel, setIsAddingLevel] = useState(false);\r\n    const [isAddingModule, setIsAddingModule] = useState(false);\r\n    const [selectedModuleIds, setSelectedModuleIds] = useState<string[]>([]);\r\n    const [isDeleting, setIsDeleting] = useState(false);\r\n\r\n    const [newLevel, setNewLevel] = useState({ name: '', rank: 0 });\r\n    const [newModule, setNewModule] = useState({ code: '', name: '', category: 'Geral' });\r\n\r\n    const currentUserLevel = levels.find(l => l.name === (profile?.role || '').toUpperCase());\r\n    const currentUserRank = currentUserLevel?.rank || 0;\r\n    const isSuperAdmin = isProtectedSignal.value;\r\n\r\n    useEffect(() => {\r\n        fetchData();\r\n    }, []);\r\n\r\n    const fetchData = async () => {\r\n        setIsLoading(true);\r\n        try {\r\n            const [lRes, mRes, mxRes] = await Promise.all([\r\n                localApi.from('permission_levels').select('*').order('rank', { ascending: false }),\r\n                localApi.from('permission_modules').select('*').order('category', { ascending: true }),\r\n                localApi.from('permission_matrix').select('*')\r\n            ]);\r\n\r\n            if (lRes.data) setLevels(lRes.data);\r\n            if (mRes.data) setModules(mRes.data);\r\n\r\n            const mxMap: Record<string, boolean> = {};\r\n            (mxRes.data as any[])?.forEach(item => {\r\n                mxMap[`${item.level_id}:${item.module_id}`] = item.is_granted || false;\r\n            });\r\n            setMatrix(mxMap);\r\n        } catch (error) {\r\n            console.error('Error fetching SU data:', error);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const togglePermission = (levelId: string, moduleId: string) => {\r\n        const key = `${levelId}:${moduleId}`;\r\n        setMatrix(prev => ({\r\n            ...prev,\r\n            [key]: !prev[key]\r\n        }));\r\n    };\r\n\r\n    const toggleRow = (moduleId: string, checked: boolean) => {\r\n        const newMatrix = { ...matrix };\r\n        levels.forEach(level => {\r\n            if (level.rank < 1000) { // Não altera SuperAdminGod\r\n                newMatrix[`${level.id}:${moduleId}`] = checked;\r\n            }\r\n        });\r\n        setMatrix(newMatrix);\r\n    };\r\n\r\n    const toggleColumn = (levelId: string, checked: boolean) => {\r\n        const newMatrix = { ...matrix };\r\n        modules.forEach(module => {\r\n            newMatrix[`${levelId}:${module.id}`] = checked;\r\n        });\r\n        setMatrix(newMatrix);\r\n    };\r\n\r\n    const syncModules = async () => {\r\n        setIsSaving(true);\r\n        try {\r\n            const existingCodes = modules.map(m => m.code);\r\n            const missingModules = STANDARD_MODULES.filter(sm => !existingCodes.includes(sm.code));\r\n\r\n            if (missingModules.length === 0) {\r\n                toast({ title: 'Tudo em dia!', description: 'Todos os módulos do sistema já estão na matriz.' });\r\n                return;\r\n            }\r\n\r\n            const { error } = await localApi.from('permission_modules').insert(missingModules);\r\n            if (error) throw error;\r\n\r\n            toast({\r\n                title: 'Sincronização concluída',\r\n                description: `${missingModules.length} novos módulos foram adicionados à matriz.`\r\n            });\r\n\r\n            fetchData();\r\n        } catch (error: any) {\r\n            toast({ title: 'Erro na sincronização', description: error.message, variant: 'destructive' });\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    const handleSaveMatrix = async () => {\r\n        if (isSaving) return;\r\n\r\n        console.log('[CustomSU] Iniciando salvamento da matriz...');\r\n        setIsSaving(true);\r\n        try {\r\n            const updates = Object.entries(matrix).map(([key, isGranted]) => {\r\n                const [level_id, module_id] = key.split(':');\r\n                return {\r\n                    level_id,\r\n                    module_id,\r\n                    is_granted: isGranted\r\n                };\r\n            });\r\n\r\n            const result = await localApi\r\n                .from('permission_matrix')\r\n                .upsert(updates);\r\n\r\n            if (result.error) throw result.error;\r\n\r\n            const responseData = Array.isArray(result.data) ? result.data[0] : result.data;\r\n            const taskId = responseData?.taskId;\r\n\r\n            if (taskId) {\r\n                toast({ title: 'Processando...', description: 'Aguarde a conclusão do salvamento em segundo plano.' });\r\n\r\n                // Polling de status\r\n                let isDone = false;\r\n                let attempts = 0;\r\n\r\n                while (!isDone && attempts < 60) {\r\n                    await new Promise(resolve => setTimeout(resolve, 2000));\r\n                    attempts++;\r\n\r\n                    try {\r\n                        const baseUrl = (localApi as any).baseUrl || '';\r\n                        const res = await fetch(`${baseUrl}/task_queue/${taskId}`, {\r\n                            headers: { 'Authorization': `Bearer ${(localApi as any).token}` }\r\n                        });\r\n                        const statusJson = await res.json();\r\n                        const status = statusJson.data?.status || statusJson.status;\r\n\r\n                        if (status === 'completed') {\r\n                            isDone = true;\r\n                            toast({ title: 'Matriz atualizada', description: 'Todas as permissões foram salvas com sucesso!' });\r\n                        } else if (status === 'failed') {\r\n                            isDone = true;\r\n                            throw new Error(statusJson.data?.error || 'Falha no processamento da tarefa');\r\n                        }\r\n                    } catch (pollErr) {\r\n                        console.error('Polling error:', pollErr);\r\n                    }\r\n                }\r\n\r\n                if (!isDone) {\r\n                    toast({ title: 'Aviso', description: 'O processamento está demorando mais que o esperado, mas continuará rodando.' });\r\n                }\r\n            } else {\r\n                toast({ title: 'Matriz atualizada', description: 'Todas as permissões foram salvas com sucesso.' });\r\n            }\r\n        } catch (error: any) {\r\n            toast({ title: 'Erro ao salvar', description: error.message, variant: 'destructive' });\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    const handleAddLevel = async () => {\r\n        try {\r\n            const { error } = await localApi.from('permission_levels').insert([newLevel]);\r\n            if (error) throw error;\r\n            toast({ title: 'Nível adicionado', description: `${newLevel.name} agora faz parte da hierarquia.` });\r\n            setIsAddingLevel(false);\r\n            fetchData();\r\n        } catch (error: any) {\r\n            toast({ title: 'Erro', description: error.message, variant: 'destructive' });\r\n        }\r\n    };\r\n\r\n    const handleAddModule = async () => {\r\n        try {\r\n            const { error } = await localApi.from('permission_modules').insert([newModule]);\r\n            if (error) throw error;\r\n            toast({ title: 'Módulo adicionado', description: `${newModule.name} disponível para configuração.` });\r\n            setIsAddingModule(false);\r\n            fetchData();\r\n        } catch (error: any) {\r\n            toast({ title: 'Erro', description: error.message, variant: 'destructive' });\r\n        }\r\n    };\r\n\r\n    const handleDeleteModules = async (ids: string[]) => {\r\n        if (!confirm(`Deseja realmente excluir ${ids.length} módulo(s)? Esta ação é irreversível.`)) return;\r\n\r\n        setIsDeleting(true);\r\n        try {\r\n            const { error } = await localApi.from('permission_modules').delete().in('id', ids);\r\n            if (error) throw error;\r\n\r\n            toast({ title: 'Módulos removidos', description: 'Os itens foram excluídos com sucesso.' });\r\n            setSelectedModuleIds([]);\r\n            fetchData();\r\n        } catch (error: any) {\r\n            toast({ title: 'Erro ao excluir', description: error.message, variant: 'destructive' });\r\n        } finally {\r\n            setIsDeleting(false);\r\n        }\r\n    };\r\n\r\n    const toggleModuleSelection = (id: string) => {\r\n        setSelectedModuleIds(prev =>\r\n            prev.includes(id) ? prev.filter(i => i !== id) : [...prev, id]\r\n        );\r\n    };\r\n\r\n    const toggleAllModules = (checked: boolean) => {\r\n        if (checked) {\r\n            setSelectedModuleIds(modules.map(m => m.id));\r\n        } else {\r\n            setSelectedModuleIds([]);\r\n        }\r\n    };\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"flex h-[60vh] items-center justify-center\">\r\n                <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-in fade-in duration-500\">\r\n            <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-bold tracking-tight flex items-center gap-3\">\r\n                        <Shield className=\"w-8 h-8 text-primary\" />\r\n                        Custom SU <Badge variant=\"secondary\" className=\"ml-2\">Matriz de Abas</Badge>\r\n                    </h1>\r\n                    <p className=\"text-muted-foreground mt-1 text-sm\">Mapeamento de permissões por Abas do Site e Níveis Hierárquicos.</p>\r\n                </div>\r\n                <div className=\"flex items-center gap-3\">\r\n                    {isSuperAdmin && (\r\n                        <>\r\n                            <Button variant=\"outline\" size=\"sm\" onClick={syncModules}>\r\n                                <RefreshCw className=\"w-4 h-4 mr-2\" /> Sincronizar Módulos\r\n                            </Button>\r\n                            <Button variant=\"outline\" size=\"sm\" onClick={() => setIsAddingLevel(true)}>\r\n                                <Plus className=\"w-4 h-4 mr-2\" /> Nível\r\n                            </Button>\r\n                            <Button variant=\"outline\" size=\"sm\" onClick={() => setIsAddingModule(true)}>\r\n                                <Plus className=\"w-4 h-4 mr-2\" /> Módulo\r\n                            </Button>\r\n                        </>\r\n                    )}\r\n                    {selectedModuleIds.length > 0 && isSuperAdmin && (\r\n                        <Button variant=\"destructive\" size=\"sm\" onClick={() => handleDeleteModules(selectedModuleIds)} disabled={isDeleting}>\r\n                            {isDeleting ? <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> : <X className=\"w-4 h-4 mr-2\" />}\r\n                            Excluir ({selectedModuleIds.length})\r\n                        </Button>\r\n                    )}\r\n                    <Button className=\"gradient-primary\" size=\"sm\" onClick={handleSaveMatrix} disabled={isSaving}>\r\n                        {isSaving ? <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> : <Save className=\"w-4 h-4 mr-2\" />}\r\n                        Salvar Matriz\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            <Tabs defaultValue=\"matrix\" className=\"w-full\">\r\n                <TabsList className=\"glass-card mb-6 p-1 border-white/5\">\r\n                    <TabsTrigger value=\"matrix\" className=\"gap-2 px-8\">\r\n                        <Save className=\"w-4 h-4\" /> Matriz de Permissões\r\n                    </TabsTrigger>\r\n                    <TabsTrigger value=\"documents\" className=\"gap-2 px-8\">\r\n                        <FileText className=\"w-4 h-4\" /> Repositório por Nível\r\n                    </TabsTrigger>\r\n                </TabsList>\r\n\r\n                <TabsContent value=\"matrix\" className=\"space-y-6\">\r\n                    <Card className=\"glass-card overflow-hidden\">\r\n                        <CardHeader className=\"bg-primary/5 border-b py-4\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <CardDescription className=\"flex items-center gap-2\">\r\n                                    <Info className=\"w-4 h-4\" /> Matriz: Abas do Site (Col 1) x Níveis (Col 2+)\r\n                                </CardDescription>\r\n                                <Trash2 className=\"w-4 h-4 text-muted-foreground/50\" />\r\n                            </div>\r\n                        </CardHeader>\r\n                        <CardContent className=\"p-0 overflow-x-auto\">\r\n                            <Table>\r\n                                <TableHeader className=\"bg-muted/30\">\r\n                                    <TableRow>\r\n                                        <TableHead className=\"w-[350px] border-r-2 border-primary/20 sticky left-0 z-20 bg-background/95 backdrop-blur-md shadow-[4px_0_10px_-5px_rgba(0,0,0,0.5)]\">\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                <Checkbox\r\n                                                    checked={selectedModuleIds.length === modules.length && modules.length > 0}\r\n                                                    onCheckedChange={(checked) => toggleAllModules(!!checked)}\r\n                                                    className=\"border-primary/40\"\r\n                                                    disabled={!isSuperAdmin}\r\n                                                />\r\n                                                <span className=\"font-black text-xs uppercase tracking-tighter\">Aba / Funcionalidade</span>\r\n                                            </div>\r\n                                        </TableHead>\r\n                                        {levels.map(level => {\r\n                                            const isGodLevel = level.rank >= 1000;\r\n                                            const allChecked = modules.length > 0 && modules.every(m => matrix[`${level.id}:${m.id}`]);\r\n\r\n                                            return (\r\n                                                <TableHead key={level.id} className=\"text-center min-w-[120px] border-r border-white/5\">\r\n                                                    <div className=\"flex flex-col items-center gap-3 py-4\">\r\n                                                        <div className={cn(\r\n                                                            \"px-3 py-1 rounded-full border text-[10px] font-black tracking-wider uppercase transition-all duration-300\",\r\n                                                            getRoleStyle(level.name)\r\n                                                        )}>\r\n                                                            {level.name.replace('_', ' ')}\r\n                                                        </div>\r\n                                                        <span className=\"text-[9px] text-primary/40 font-mono tracking-widest font-bold\">LVL {level.rank}</span>\r\n\r\n                                                        <div className=\"flex flex-col items-center gap-1 w-full pt-2 border-t border-primary/10\">\r\n                                                            <div className=\"flex items-center gap-2\">\r\n                                                                <Checkbox\r\n                                                                    checked={isGodLevel || allChecked}\r\n                                                                    onCheckedChange={(checked) => toggleColumn(level.id, !!checked)}\r\n                                                                    disabled={isGodLevel || (level.rank >= currentUserRank && !isSuperAdmin)}\r\n                                                                    className=\"w-3.5 h-3.5 border-primary/30 data-[state=checked]:bg-primary\"\r\n                                                                />\r\n                                                                <span className=\"text-[9px] font-black text-muted-foreground/60 uppercase\">Acesso</span>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </TableHead>\r\n                                            );\r\n                                        })}\r\n                                    </TableRow>\r\n                                </TableHeader>\r\n                                <TableBody>\r\n                                    {Array.from(new Set(modules.map(m => m.category))).map(category => (\r\n                                        <React.Fragment key={category}>\r\n                                            <TableRow className=\"bg-primary/10 hover:bg-primary/15 border-y-2 border-primary/20\">\r\n                                                <TableCell colSpan={levels.length + 1} className=\"py-2.5 px-6 font-black text-primary text-xs uppercase tracking-[0.2em] shadow-inner\">\r\n                                                    <div className=\"flex items-center gap-3\">\r\n                                                        <div className=\"h-1.5 w-1.5 rounded-full bg-primary animate-pulse\" />\r\n                                                        {category}\r\n                                                    </div>\r\n                                                </TableCell>\r\n                                            </TableRow>\r\n                                            {modules.filter(m => m.category === category).map(module => (\r\n                                                <TableRow key={module.id} className=\"hover:bg-white/2 transition-colors border-b border-white/5\">\r\n                                                    <TableCell className=\"border-r-2 border-primary/20 p-0 sticky left-0 z-10 bg-background/80 backdrop-blur-sm\">\r\n                                                        <div className=\"flex items-center justify-between gap-3 group/row px-4 py-3\">\r\n                                                            <div className=\"flex items-center gap-3\">\r\n                                                                <Checkbox\r\n                                                                    checked={selectedModuleIds.includes(module.id)}\r\n                                                                    onCheckedChange={() => toggleModuleSelection(module.id)}\r\n                                                                    className=\"w-4 h-4 border-primary/30\"\r\n                                                                    disabled={!isSuperAdmin}\r\n                                                                />\r\n                                                                <Checkbox\r\n                                                                    checked={levels.every(l => l.rank >= 1000 || matrix[`${l.id}:${module.id}`])}\r\n                                                                    onCheckedChange={(checked) => toggleRow(module.id, !!checked)}\r\n                                                                    className=\"w-4 h-4 border-primary/30 data-[state=checked]:bg-primary\"\r\n                                                                    disabled={!isSuperAdmin && levels.some(l => l.rank >= currentUserRank)}\r\n                                                                />\r\n                                                                <div className=\"flex flex-col\">\r\n                                                                    <span className=\"font-bold text-sm text-foreground/90 leading-none mb-1\">{module.name}</span>\r\n                                                                    <code className=\"text-[9px] text-muted-foreground/60 font-mono tracking-tight uppercase\">{module.code}</code>\r\n                                                                </div>\r\n                                                            </div>\r\n                                                            {isSuperAdmin && (\r\n                                                                <Button\r\n                                                                    variant=\"ghost\"\r\n                                                                    size=\"icon\"\r\n                                                                    className=\"h-7 w-7 opacity-0 group-hover/row:opacity-100 text-destructive hover:bg-destructive/10 transition-all scale-90 hover:scale-100\"\r\n                                                                    onClick={() => handleDeleteModules([module.id])}\r\n                                                                >\r\n                                                                    <X className=\"w-4 h-4\" />\r\n                                                                </Button>\r\n                                                            )}\r\n                                                        </div>\r\n                                                    </TableCell>\r\n                                                    {levels.map(level => {\r\n                                                        const isGranted = matrix[`${level.id}:${module.id}`] || false;\r\n                                                        const isGodLevel = level.rank >= 1000;\r\n                                                        const isLockedForUser = (level.rank >= currentUserRank && !isSuperAdmin);\r\n\r\n                                                        return (\r\n                                                            <TableCell key={level.id} className=\"text-center border-r border-white/5 p-0\">\r\n                                                                <div\r\n                                                                    className={cn(\r\n                                                                        \"flex items-center justify-center px-2 py-4 h-full transition-colors\",\r\n                                                                        (isGranted || isGodLevel) && \"bg-primary/5\",\r\n                                                                        (isGodLevel || isLockedForUser) && \"bg-primary/10\"\r\n                                                                    )}\r\n                                                                >\r\n                                                                    <Checkbox\r\n                                                                        checked={isGodLevel || isGranted}\r\n                                                                        disabled={isGodLevel || isLockedForUser}\r\n                                                                        className={cn(\r\n                                                                            \"w-5 h-5 transition-transform duration-200 hover:scale-110\",\r\n                                                                            (isGodLevel || isLockedForUser) && \"bg-primary border-primary opacity-100 ring-2 ring-primary/20\"\r\n                                                                        )}\r\n                                                                        onCheckedChange={() => togglePermission(level.id, module.id)}\r\n                                                                    />\r\n                                                                </div>\r\n                                                            </TableCell>\r\n                                                        );\r\n                                                    })}\r\n                                                </TableRow>\r\n                                            ))}\r\n                                        </React.Fragment>\r\n                                    ))}\r\n                                </TableBody>\r\n                            </Table>\r\n                        </CardContent>\r\n                    </Card>\r\n                </TabsContent>\r\n\r\n                <TabsContent value=\"documents\">\r\n                    <SUDocumentHub />\r\n                </TabsContent>\r\n            </Tabs>\r\n\r\n            {/* Add Level Dialog */}\r\n            <Dialog open={isAddingLevel} onOpenChange={setIsAddingLevel}>\r\n                <DialogContent>\r\n                    <DialogHeader>\r\n                        <DialogTitle>Novo Nível Hierárquico</DialogTitle>\r\n                        <DialogDescription>Escolha um nível padrão ou crie um personalizado.</DialogDescription>\r\n                    </DialogHeader>\r\n                    <div className=\"grid gap-4 py-4\">\r\n                        <div className=\"grid gap-2\">\r\n                            <Label>Sugestões do Sistema</Label>\r\n                            <Select onValueChange={(val) => {\r\n                                const role = STANDARD_ROLES.find(r => r.name === val);\r\n                                if (role) setNewLevel({ name: role.name, rank: role.rank });\r\n                            }}>\r\n                                <SelectTrigger className=\"industrial-input\">\r\n                                    <SelectValue placeholder=\"Escolher um cargo padrão...\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    {STANDARD_ROLES.map(r => (\r\n                                        <SelectItem key={r.name} value={r.name}>\r\n                                            <div className=\"flex items-center justify-between w-full gap-4\">\r\n                                                <span>{getRoleLabel(r.name)}</span>\r\n                                                <Badge variant=\"outline\" className=\"text-[9px] opacity-50\">Rank {r.rank}</Badge>\r\n                                            </div>\r\n                                        </SelectItem>\r\n                                    ))}\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                        <div className=\"relative py-2 rotate-0\">\r\n                            <div className=\"absolute inset-0 flex items-center\"><span className=\"w-full border-t border-white/10\" /></div>\r\n                            <div className=\"relative flex justify-center text-[10px] uppercase font-bold\"><span className=\"bg-background px-2 text-muted-foreground\">Ou Manual</span></div>\r\n                        </div>\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"level-name\">Nome do Nível</Label>\r\n                            <Input id=\"level-name\" placeholder=\"EX: GERENTE_REGIONAL\" value={newLevel.name} onChange={e => setNewLevel({ ...newLevel, name: e.target.value.toUpperCase() })} />\r\n                        </div>\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"level-rank\">Rank (Poder)</Label>\r\n                            <Input id=\"level-rank\" type=\"number\" placeholder=\"EX: 850\" value={newLevel.rank} onChange={e => setNewLevel({ ...newLevel, rank: parseInt(e.target.value) })} />\r\n                        </div>\r\n                    </div>\r\n                    <DialogFooter>\r\n                        <Button variant=\"ghost\" onClick={() => setIsAddingLevel(false)}>Cancelar</Button>\r\n                        <Button className=\"gradient-primary\" onClick={handleAddLevel}>Criar Nível</Button>\r\n                    </DialogFooter>\r\n                </DialogContent>\r\n            </Dialog>\r\n\r\n            {/* Add Module Dialog */}\r\n            <Dialog open={isAddingModule} onOpenChange={setIsAddingModule}>\r\n                <DialogContent className=\"max-w-md\">\r\n                    <DialogHeader>\r\n                        <DialogTitle>Nova Aba / Módulo</DialogTitle>\r\n                        <DialogDescription>Selecione uma funcionalidade padrão ou adicione manualmente.</DialogDescription>\r\n                    </DialogHeader>\r\n                    <div className=\"grid gap-4 py-4\">\r\n                        <div className=\"grid gap-2\">\r\n                            <Label>Funcionalidades Disponíveis</Label>\r\n                            <Select onValueChange={(val) => {\r\n                                const mod = STANDARD_MODULES.find(m => m.code === val);\r\n                                if (mod) setNewModule({ code: mod.code, name: mod.name, category: mod.category });\r\n                            }}>\r\n                                <SelectTrigger className=\"industrial-input\">\r\n                                    <SelectValue placeholder=\"Escolher funcionalidade...\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    {STANDARD_MODULES.filter(m => !modules.some(mod => mod.code === m.code)).map(m => (\r\n                                        <SelectItem key={m.code} value={m.code}>\r\n                                            <div className=\"flex flex-col\">\r\n                                                <span>{m.name}</span>\r\n                                                <span className=\"text-[10px] opacity-60\">CAT: {m.category}</span>\r\n                                            </div>\r\n                                        </SelectItem>\r\n                                    ))}\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                        <div className=\"relative py-2 rotate-0\">\r\n                            <div className=\"absolute inset-0 flex items-center\"><span className=\"w-full border-t border-white/10\" /></div>\r\n                            <div className=\"relative flex justify-center text-[10px] uppercase font-bold\"><span className=\"bg-background px-2 text-muted-foreground\">Ou Manual</span></div>\r\n                        </div>\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"module-name\">Nome Amigável</Label>\r\n                            <Input id=\"module-name\" placeholder=\"EX: Excluir Foto de Ponto\" value={newModule.name} onChange={e => setNewModule({ ...newModule, name: e.target.value })} />\r\n                        </div>\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"module-code\">Código (ID Técnico)</Label>\r\n                            <Input id=\"module-code\" placeholder=\"EX: clock.delete_photo\" value={newModule.code} onChange={e => setNewModule({ ...newModule, code: e.target.value.toLowerCase() })} />\r\n                        </div>\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"module-category\">Categoria</Label>\r\n                            <Input id=\"module-category\" placeholder=\"EX: Ponto Eletrônico\" value={newModule.category} onChange={e => setNewModule({ ...newModule, category: e.target.value })} />\r\n                        </div>\r\n                    </div>\r\n                    <DialogFooter>\r\n                        <Button variant=\"ghost\" onClick={() => setIsAddingModule(false)}>Cancelar</Button>\r\n                        <Button className=\"gradient-primary\" onClick={handleAddModule}>Criar Módulo</Button>\r\n                    </DialogFooter>\r\n                </DialogContent>\r\n            </Dialog>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\DailyReport.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ConfirmationDialog' is defined but never used.","line":16,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isConnected' is assigned a value but never used.","line":22,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'sites' is assigned a value but never used.","line":25,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":18}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useSync } from '@/contexts/SyncContext';\r\nimport { useTeams } from '@/hooks/useTeams';\r\nimport { useDailyReports } from '@/hooks/useDailyReports';\r\nimport { useSites } from '@/hooks/useSites';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useEmployees } from '@/hooks/useEmployees';\r\nimport { FileText, Send, Calendar, Clock, Loader2 } from 'lucide-react';\r\nimport { isProtectedSignal, can } from '@/signals/authSignals';\r\nimport { ConfirmationDialog } from '@/components/shared/ConfirmationDialog';\r\nimport { useSignals } from \"@preact/signals-react/runtime\";\r\n\r\nexport default function DailyReport() {\r\n    useSignals();\r\n    const { profile } = useAuth();\r\n    const { isConnected } = useSync();\r\n    const isWorker = !isProtectedSignal.value && !can('daily_reports.manage');\r\n    const workerEmployeeId = profile?.employeeId;\r\n    const { sites } = useSites(profile?.companyId);\r\n    const { teams } = useTeams(profile?.companyId);\r\n    const employeesFilter = React.useMemo(() => ({ companyId: profile?.companyId }), [profile?.companyId]);\r\n    const { employees } = useEmployees(employeesFilter);\r\n    const { createReport, getTodayReports } = useDailyReports();\r\n    const [selectedEmployee, setSelectedEmployee] = React.useState('');\r\n    const [selectedTeam, setSelectedTeam] = React.useState('');\r\n    const [activities, setActivities] = React.useState('');\r\n    const [comments, setComments] = React.useState('');\r\n    const [isSaving, setIsSaving] = React.useState(false);\r\n    const { toast } = useToast();\r\n\r\n    // Encontrar a equipe do trabalhador logado\r\n    const workerTeam = React.useMemo(() => {\r\n        if (!isWorker || !workerEmployeeId) return null;\r\n        return teams.find(t => t.members.includes(workerEmployeeId) || t.supervisorId === workerEmployeeId);\r\n    }, [teams, isWorker, workerEmployeeId]);\r\n\r\n    // Auto-selecionar os dados se for trabalhador\r\n    React.useEffect(() => {\r\n        if (isWorker && workerEmployeeId) {\r\n            setSelectedEmployee(workerEmployeeId);\r\n            if (workerTeam) setSelectedTeam(workerTeam.id);\r\n        }\r\n    }, [isWorker, workerEmployeeId, workerTeam]);\r\n\r\n    const todayReports = getTodayReports().filter(r => {\r\n        if (isWorker && workerTeam) {\r\n            return r.teamId === workerTeam.id;\r\n        }\r\n        return true;\r\n    });\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!selectedEmployee || !activities.trim()) {\r\n            toast({ title: 'Erro', description: 'Selecione o funcionário e descreva as atividades', variant: 'destructive' });\r\n            return;\r\n        }\r\n\r\n        setIsSaving(true);\r\n\r\n        try {\r\n            const result = await createReport({\r\n                teamId: (selectedTeam && selectedTeam !== 'none') ? selectedTeam : undefined,\r\n                employeeId: selectedEmployee,\r\n                companyId: profile?.companyId,\r\n                activities: activities.trim(),\r\n                observations: comments.trim() || undefined,\r\n            });\r\n\r\n            if (result.success) {\r\n                setActivities('');\r\n                setComments('');\r\n                if (!isWorker) {\r\n                    setSelectedEmployee('');\r\n                    setSelectedTeam('');\r\n                }\r\n                toast({ title: 'Relatório enviado!', description: 'O relatório diário foi salvo com sucesso.' });\r\n            }\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-fade-in\">\r\n            <div className=\"grid lg:grid-cols-2 gap-6\">\r\n                <Card className=\"glass-card\">\r\n                    <CardHeader>\r\n                        <CardTitle className=\"flex items-center gap-2\"><FileText className=\"w-5 h-5\" />Novo Relatório</CardTitle>\r\n                        <CardDescription>Registre as atividades do dia</CardDescription>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                            <div className=\"space-y-4\">\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Funcionário *</Label>\r\n                                    {isWorker ? (\r\n                                        <div className=\"industrial-input flex items-center bg-muted/50 px-3 cursor-not-allowed\">\r\n                                            <span className=\"text-foreground font-medium\">{profile?.fullName}</span>\r\n                                        </div>\r\n                                    ) : (\r\n                                        <Select value={selectedEmployee} onValueChange={setSelectedEmployee}>\r\n                                            <SelectTrigger><SelectValue placeholder=\"Selecione o funcionário\" /></SelectTrigger>\r\n                                            <SelectContent>\r\n                                                {employees.map(e => <SelectItem key={e.id} value={e.id}>{e.fullName}</SelectItem>)}\r\n                                            </SelectContent>\r\n                                        </Select>\r\n                                    )}\r\n                                </div>\r\n\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Equipe (Opcional)</Label>\r\n                                    {isWorker && workerTeam ? (\r\n                                        <div className=\"industrial-input flex items-center bg-muted/50 px-3 cursor-not-allowed\">\r\n                                            <span className=\"text-foreground font-medium\">{workerTeam.name}</span>\r\n                                        </div>\r\n                                    ) : (\r\n                                        <Select value={selectedTeam} onValueChange={setSelectedTeam}>\r\n                                            <SelectTrigger><SelectValue placeholder=\"Selecione a equipe\" /></SelectTrigger>\r\n                                            <SelectContent>\r\n                                                <SelectItem value=\"none\">Nenhuma</SelectItem>\r\n                                                {teams.map(t => <SelectItem key={t.id} value={t.id}>{t.name}</SelectItem>)}\r\n                                            </SelectContent>\r\n                                        </Select>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                            <div>\r\n                                <Label>Atividades Realizadas *</Label>\r\n                                <Textarea value={activities} onChange={e => setActivities(e.target.value)} placeholder=\"Descreva as atividades...\" rows={4} />\r\n                            </div>\r\n                            <div>\r\n                                <Label>Observações</Label>\r\n                                <Textarea value={comments} onChange={e => setComments(e.target.value)} placeholder=\"Comentários adicionais...\" rows={2} />\r\n                            </div>\r\n                            <Button\r\n                                type=\"submit\"\r\n                                className=\"w-full gradient-primary text-white\"\r\n                                disabled={isSaving || !(isProtectedSignal.value || can('daily_reports.create'))}\r\n                            >\r\n                                {isSaving ? <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> : <Send className=\"w-4 h-4 mr-2\" />}\r\n                                {!(isProtectedSignal.value || can('daily_reports.create')) ? 'Somente Leitura' : 'Enviar Relatório'}\r\n                            </Button>\r\n                        </form>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card className=\"glass-card\">\r\n                    <CardHeader>\r\n                        <CardTitle className=\"flex items-center gap-2\"><Calendar className=\"w-5 h-5\" />Relatórios de Hoje</CardTitle>\r\n                        <CardDescription>{todayReports.length} relatório(s)</CardDescription>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        {todayReports.length === 0 ? (\r\n                            <div className=\"text-center py-8 text-muted-foreground\">\r\n                                <FileText className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\r\n                                <p>Nenhum relatório hoje</p>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"space-y-3\">\r\n                                {todayReports.map(r => (\r\n                                    <div key={r.id} className=\"p-3 rounded-lg bg-muted/30 border border-white/5\">\r\n                                        <div className=\"flex items-center justify-between mb-1\">\r\n                                            <span className=\"font-bold text-sm text-foreground\">\r\n                                                {employees.find(e => e.id === r.employeeId)?.fullName || 'Colaborador'}\r\n                                            </span>\r\n                                            <span className=\"text-[10px] text-muted-foreground flex items-center gap-1\">\r\n                                                <Clock className=\"w-3 h-3\" />\r\n                                                {new Date(r.createdAt).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}\r\n                                            </span>\r\n                                        </div>\r\n                                        <div className=\"text-[10px] text-primary/70 mb-2 font-medium\">\r\n                                            {r.teamName || teams.find(t => t.id === r.teamId)?.name || 'Sem Equipe'}\r\n                                        </div>\r\n                                        <p className=\"text-sm text-muted-foreground line-clamp-3 italic\">\"{r.activities}\"</p>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\Dashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\DatabaseHub.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[602,605],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[602,605],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'accessToken' is assigned a value but never used.","line":28,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1343,1346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1343,1346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2529,2532],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2529,2532],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":120,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5711,5714],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5711,5714],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport {\r\n    Database,\r\n    Code2,\r\n    Play,\r\n    Layout,\r\n    AlertCircle\r\n} from 'lucide-react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport { ScrollArea } from '@/components/ui/scroll-area';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { toast } from 'sonner';\r\n\r\n// --- SQL Console Component ---\r\nconst SqlConsole = () => {\r\n    const [query, setQuery] = useState('SELECT * FROM \"users\" LIMIT 10;');\r\n    const [results, setResults] = useState<any[]>([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const { session } = useAuth();\r\n\r\n    const executeQuery = async () => {\r\n        setLoading(true);\r\n        setError(null);\r\n        try {\r\n            const apiUrl = import.meta.env.VITE_API_URL || 'http://localhost:3000/api/v1';\r\n            const accessToken = session?.access_token || session?.token || (session?.user?.id ? 'SESSION_COOKIE' : '');\r\n\r\n            // If using NextAuth cookies, credentials: include is needed\r\n            // If using Supabase/JWT, Authorization header is needed.\r\n            // Based on session.ts, it checks Bearer token first, then cookie.\r\n\r\n            const headers: any = { 'Content-Type': 'application/json' };\r\n            if (session?.access_token) {\r\n                headers['Authorization'] = `Bearer ${session.access_token}`;\r\n            }\r\n\r\n            const response = await fetch(`${apiUrl}/db/query`, {\r\n                method: 'POST',\r\n                headers,\r\n                // Include cookies for NextAuth session support\r\n                credentials: 'include',\r\n                body: JSON.stringify({ query })\r\n            });\r\n\r\n            // Handle non-200 responses\r\n            if (response.status === 401) {\r\n                throw new Error('Sessão expirada ou não autorizada. Faça login novamente.');\r\n            }\r\n            if (response.status === 403) {\r\n                throw new Error('Você não tem permissão de Administrador para executar queries.');\r\n            }\r\n\r\n            const res = await response.json();\r\n            if (res.success) {\r\n                setResults(Array.isArray(res.data) ? res.data : [res.data]);\r\n                toast.success('Query executada com sucesso');\r\n            } else {\r\n                setError(res.message || 'Erro ao executar query');\r\n            }\r\n        } catch (err: any) {\r\n            setError(err.message);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-full gap-4\">\r\n            <div className=\"flex-1 flex flex-col min-h-0 bg-zinc-950 rounded-xl border border-white/10 overflow-hidden\">\r\n                <div className=\"flex items-center justify-between p-3 bg-white/5 border-b border-white/5\">\r\n                    <div className=\"flex items-center gap-2 text-xs font-bold uppercase tracking-widest text-white/40\">\r\n                        <Code2 className=\"w-4 h-4\" />\r\n                        SQL Editor\r\n                    </div>\r\n                    <Button\r\n                        size=\"sm\"\r\n                        onClick={executeQuery}\r\n                        disabled={loading}\r\n                        className=\"bg-cyan-500 hover:bg-cyan-600 text-white gap-2\"\r\n                    >\r\n                        <Play className=\"w-4 h-4\" />\r\n                        Executar (F5)\r\n                    </Button>\r\n                </div>\r\n                <textarea\r\n                    value={query}\r\n                    onChange={(e) => setQuery(e.target.value)}\r\n                    className=\"flex-1 w-full p-4 bg-transparent text-cyan-50 font-mono text-sm resize-none focus:outline-none\"\r\n                    spellCheck={false}\r\n                />\r\n            </div>\r\n\r\n            <div className=\"h-1/3 flex flex-col bg-zinc-900 rounded-xl border border-white/10 overflow-hidden\">\r\n                <div className=\"flex items-center p-3 bg-white/5 border-b border-white/5 text-xs font-bold uppercase tracking-widest text-white/40 gap-2\">\r\n                    <Layout className=\"w-4 h-4\" />\r\n                    Resultados\r\n                </div>\r\n                <ScrollArea className=\"flex-1\">\r\n                    {error && (\r\n                        <div className=\"p-4 flex items-center gap-3 text-red-400 bg-red-500/10 m-4 rounded-lg border border-red-500/20\">\r\n                            <AlertCircle className=\"w-5 h-5 shrink-0\" />\r\n                            <p className=\"text-sm\">{error}</p>\r\n                        </div>\r\n                    )}\r\n                    {results.length > 0 ? (\r\n                        <div className=\"p-0\">\r\n                            <table className=\"w-full text-left text-xs border-collapse\">\r\n                                <thead className=\"sticky top-0 bg-zinc-900 border-b border-white/10\">\r\n                                    <tr>\r\n                                        {Object.keys(results[0]).map(key => (\r\n                                            <th key={key} className=\"p-3 font-bold text-white/60 border-r border-white/5 last:border-0\">{key}</th>\r\n                                        ))}\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody>\r\n                                    {results.map((row, i) => (\r\n                                        <tr key={i} className=\"border-b border-white/5 hover:bg-white/5 transition-colors\">\r\n                                            {Object.values(row).map((val: any, j) => (\r\n                                                <td key={j} className=\"p-3 text-white/80 font-mono border-r border-white/5 last:border-0 truncate max-w-[200px]\">\r\n                                                    {typeof val === 'object' ? JSON.stringify(val) : String(val)}\r\n                                                </td>\r\n                                            ))}\r\n                                        </tr>\r\n                                    ))}\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    ) : !error && (\r\n                        <div className=\"h-full flex flex-col items-center justify-center text-white/20 gap-2 py-10\">\r\n                            <Database className=\"w-12 h-12 opacity-10\" />\r\n                            <p>Nenhum dado retornado ou query pendente</p>\r\n                        </div>\r\n                    )}\r\n                </ScrollArea>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n// --- Main Page Component ---\r\nexport default function DatabaseHub() {\r\n    return (\r\n        <div className=\"p-6 h-[calc(100vh-100px)] flex flex-col gap-6 animate-in fade-in duration-500\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <div className=\"p-3 bg-cyan-500/20 rounded-2xl border border-cyan-500/30\">\r\n                        <Database className=\"w-6 h-6 text-cyan-400\" />\r\n                    </div>\r\n                    <div>\r\n                        <h1 className=\"text-2xl font-black uppercase tracking-tight text-white flex items-center gap-3\">\r\n                            Database Hub\r\n                            <span className=\"text-[10px] bg-cyan-500/10 text-cyan-400 px-2 py-1 rounded-full border border-cyan-500/20 font-mono\">v1.2</span>\r\n                        </h1>\r\n                        <p className=\"text-sm text-white/40\">Gerenciamento interativo de dados e infraestrutura PostgreSQL</p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Dashboard Content - Simplified for debugging */}\r\n            <div className=\"flex-1 flex flex-col min-h-0\">\r\n                <Tabs defaultValue=\"console\" className=\"flex-1 flex flex-col min-h-0\">\r\n                    <TabsList className=\"bg-white/5 border border-white/10 p-1 mb-6 self-start rounded-xl\">\r\n                        <TabsTrigger value=\"console\" className=\"data-[state=active]:bg-cyan-500 data-[state=active]:text-white gap-2 rounded-lg px-6\">\r\n                            <Code2 className=\"w-4 h-4\" />\r\n                            SQL Console\r\n                        </TabsTrigger>\r\n                        <TabsTrigger value=\"diagram\" className=\"data-[state=active]:bg-cyan-500 data-[state=active]:text-white gap-2 rounded-lg px-6\">\r\n                            <Layout className=\"w-4 h-4\" />\r\n                            Diagram Designer (Em breve)\r\n                        </TabsTrigger>\r\n                    </TabsList>\r\n\r\n                    <TabsContent value=\"console\" className=\"flex-1 mt-0\">\r\n                        <SqlConsole />\r\n                    </TabsContent>\r\n\r\n                    <TabsContent value=\"diagram\" className=\"flex-1 mt-0\">\r\n                        <div className=\"flex flex-col items-center justify-center h-full text-white/40\">\r\n                            <p>O Designer de Diagramas está sendo otimizado para o seu ambiente.</p>\r\n                            <p className=\"text-xs\">O SQL Console está totalmente operacional.</p>\r\n                        </div>\r\n                    </TabsContent>\r\n                </Tabs>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\Employees.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":309,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":309,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12809,12812],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12809,12812],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":355,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":355,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14755,14758],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14755,14758],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react';\r\nimport { useState, useRef, useMemo } from 'react';\r\nimport { useEmployees, Employee } from '@/hooks/useEmployees';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { monitorJob, updateJobState } from '@/signals/jobSignals';\r\nimport { useSites } from '@/hooks/useSites';\r\nimport { useProjects } from '@/hooks/useProjects';\r\nimport { useCompanies } from '@/hooks/useCompanies';\r\nimport { useJobFunctions } from '@/hooks/useJobFunctions';\r\nimport { orionApi } from '@/integrations/orion/client';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Card } from '@/components/ui/card';\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport {\r\n    Plus,\r\n    Pencil,\r\n    Trash2,\r\n    ArrowUp,\r\n    ArrowDown,\r\n    User,\r\n    Phone,\r\n    Mail,\r\n    Briefcase,\r\n    FileUp,\r\n    FileDown,\r\n    Loader2,\r\n    CheckSquare,\r\n    Square,\r\n    XCircle,\r\n    CheckCircle2,\r\n    Scan,\r\n    Fingerprint,\r\n    Hash,\r\n    Building2,\r\n    MapPin,\r\n    ShieldCheck,\r\n    AlertCircle,\r\n    CreditCard,\r\n    Lock\r\n} from 'lucide-react';\r\nimport { FaceRegistrationDialog } from '@/components/employees/FaceRegistrationDialog';\r\nimport { generateId, cn } from '@/lib/utils';\r\nimport { ConfirmationDialog } from '@/components/shared/ConfirmationDialog';\r\nimport { ProjectEmptyState } from '@/components/shared/ProjectEmptyState';\r\nimport { isCorporateRole, canManageEmployee } from '@/utils/permissionHelpers';\r\nimport { isProtectedSignal, can, show } from '@/signals/authSignals';\r\nimport { useSignals } from \"@preact/signals-react/runtime\";\r\n\r\nexport default function Employees() {\r\n    useSignals();\r\n    const { profile } = useAuth();\r\n    const isMaintenanceMode = show('showMaintenance');\r\n    const { employees, isLoading: loadingEmployees, createEmployee, updateEmployee, deleteEmployee, deleteMultipleEmployees } = useEmployees();\r\n    const { sites, isLoading: loadingSites } = useSites();\r\n    const { projects, isLoading: loadingProjects } = useProjects();\r\n    const { companies, isLoading: loadingCompanies } = useCompanies();\r\n    const { functions, isLoading: loadingFunctions } = useJobFunctions();\r\n    const { toast } = useToast();\r\n\r\n    const isLoading = loadingEmployees || loadingSites || loadingProjects || loadingFunctions || loadingCompanies;\r\n\r\n    const canCreate = isProtectedSignal.value || can('employees.create') || show('showAdminMenu');\r\n    const canUpdate = isProtectedSignal.value || can('employees.update') || show('showAdminMenu');\r\n\r\n    // Filters State\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [filterFunction, setFilterFunction] = useState('all');\r\n    const [filterStatus, setFilterStatus] = useState('all');\r\n    const [filterSite, setFilterSite] = useState('all');\r\n    const [filterProject, setFilterProject] = useState('all');\r\n    const [filterCpfOrRegistration, setFilterCpfOrRegistration] = useState(''); // Unified filter for CPF and Registration\r\n    const [filterBiometric, setFilterBiometric] = useState('all'); // 'all', 'with', 'without'\r\n    const [filterLevel, setFilterLevel] = useState('all');\r\n\r\n    // Selection State\r\n    const [selectedIds, setSelectedIds] = useState<string[]>([]);\r\n    type SortDirection = \"asc\" | \"desc\" | null;\r\n    const [sortBy, setSortBy] = useState<string | null>(null);\r\n    const [sortDir, setSortDir] = useState<SortDirection>(null);\r\n    // Form State\r\n\r\n    const [isDialogOpen, setIsDialogOpen] = useState(false);\r\n    const [editingEmployee, setEditingEmployee] = useState<Employee | null>(null);\r\n    const [isSaving, setIsSaving] = useState(false);\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n    const [formData, setFormData] = useState({\r\n        fullName: '',\r\n        email: '',\r\n        phone: '',\r\n        functionId: '',\r\n        registrationNumber: '',\r\n        cpf: '',\r\n        level: 0,\r\n        laborType: 'MOD',\r\n        password: '',\r\n        siteId: '',\r\n        companyId: '',\r\n        projectId: '',\r\n    });\r\n\r\n    // Import State\r\n    const [isImportModalOpen, setIsImportModalOpen] = useState(false);\r\n    const [importFile, setImportFile] = useState<File | null>(null);\r\n    const [importConfig, setImportConfig] = useState({ companyId: '', projectId: '', siteId: '' });\r\n    const [isEnqueuing, setIsEnqueuing] = useState(false);\r\n\r\n    const MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB\r\n\r\n    const [faceRegEmployee, setFaceRegEmployee] = useState<Employee | null>(null);\r\n    const [isFaceRegOpen, setIsFaceRegOpen] = useState(false);\r\n\r\n    // Confirmation Modal States\r\n    const [confirmModal, setConfirmModal] = useState<{\r\n        open: boolean;\r\n        title: string;\r\n        description: string;\r\n        onConfirm: () => void | Promise<void>;\r\n        variant: 'default' | 'destructive';\r\n    }>({\r\n        open: false,\r\n        title: '',\r\n        description: '',\r\n        onConfirm: () => { },\r\n        variant: 'default'\r\n    });\r\n\r\n    const sortedData = useMemo(() => {\r\n        if (!sortBy || !sortDir) return employees;\r\n\r\n        return [...employees].sort((a, b) => {\r\n            const aVal = (a[sortBy as keyof Employee] ?? '') as string | number;\r\n            const bVal = (b[sortBy as keyof Employee] ?? '') as string | number;\r\n\r\n            if (sortBy === 'siteName') {\r\n                const siteA = sites.find(s => s.id === a.siteId)?.name || '';\r\n                const siteB = sites.find(s => s.id === b.siteId)?.name || '';\r\n                return sortDir === 'asc' ? siteA.localeCompare(siteB) : siteB.localeCompare(siteA);\r\n            }\r\n\r\n            if (sortBy === 'level' || sortBy === 'professionalLevel') {\r\n                const valA = (sortBy === 'level' ? a.level : a.professionalLevel) || 0;\r\n                const valB = (sortBy === 'level' ? b.level : b.professionalLevel) || 0;\r\n                return sortDir === 'asc' ? valA - valB : valB - valA;\r\n            }\r\n\r\n            return sortDir === 'asc'\r\n                ? String(aVal).localeCompare(String(bVal))\r\n                : String(bVal).localeCompare(String(aVal));\r\n        });\r\n    }, [employees, sortBy, sortDir, sites]);\r\n\r\n    // Memoized Filtered Employees\r\n    const filteredEmployees = useMemo(() => {\r\n        return sortedData.filter(employee => {\r\n            const matchesSearch = !searchTerm ||\r\n                employee.fullName.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n                (employee.email?.toLowerCase().includes(searchTerm.toLowerCase()) ?? false);\r\n\r\n            const matchesFunction = filterFunction === 'all' || employee.functionId === filterFunction;\r\n\r\n            const matchesStatus = filterStatus === 'all' ||\r\n                (filterStatus === 'active' && employee.isActive) ||\r\n                (filterStatus === 'inactive' && !employee.isActive);\r\n\r\n            const matchesSite = filterSite === 'all' || employee.siteId === filterSite;\r\n\r\n            const matchesProject = filterProject === 'all' || (() => {\r\n                const site = sites.find(s => s.id === employee.siteId);\r\n                return site?.projectId === filterProject;\r\n            })();\r\n\r\n            const matchesCpfOrRegistration = !filterCpfOrRegistration ||\r\n                (employee.cpf?.toLowerCase().includes(filterCpfOrRegistration.toLowerCase()) ?? false) ||\r\n                employee.registrationNumber.toLowerCase().includes(filterCpfOrRegistration.toLowerCase());\r\n\r\n            const matchesBiometric = filterBiometric === 'all' ||\r\n                (filterBiometric === 'with' && employee.faceDescriptor) ||\r\n                (filterBiometric === 'without' && !employee.faceDescriptor);\r\n\r\n            const matchesLevel = filterLevel === 'all' || employee.level === Number(filterLevel);\r\n\r\n            // Regra de Limpeza: Ocultar contas de Teste/Dev baseadas em flag ou email\r\n            const isTester = (employee.email || '').toLowerCase() === 'teste@gestaovirtual.com';\r\n            if (isTester && !isMaintenanceMode) return false;\r\n\r\n            return matchesSearch && matchesFunction && matchesStatus && matchesSite && matchesProject &&\r\n                matchesCpfOrRegistration && matchesBiometric && matchesLevel;\r\n        });\r\n    }, [sortedData, searchTerm, filterFunction, filterStatus, filterSite, filterProject, filterCpfOrRegistration, filterBiometric, filterLevel, sites, isMaintenanceMode]);\r\n\r\n    const handleSelectAll = () => {\r\n        if (selectedIds.length === filteredEmployees.length) {\r\n            setSelectedIds([]);\r\n        } else {\r\n            setSelectedIds(filteredEmployees.map(e => e.id));\r\n        }\r\n    };\r\n    const handleSort = (column: string) => {\r\n        if (sortBy === column) {\r\n            setSortDir(sortDir === \"asc\" ? \"desc\" : \"asc\");\r\n        } else {\r\n            setSortBy(column);\r\n            setSortDir(\"asc\");\r\n        }\r\n    }\r\n    const toggleSelection = (id: string) => {\r\n        setSelectedIds(prev =>\r\n            prev.includes(id) ? prev.filter(i => i !== id) : [...prev, id]\r\n        );\r\n    };\r\n\r\n    const handleBulkDelete = async () => {\r\n        if (selectedIds.length === 0) return;\r\n\r\n        setConfirmModal({\r\n            open: true,\r\n            title: 'Remover Selecionados',\r\n            description: `Tem certeza que deseja remover ${selectedIds.length} funcionários selecionados? Esta ação não pode ser desfeita.`,\r\n            variant: 'destructive',\r\n            onConfirm: async () => {\r\n                const result = await deleteMultipleEmployees(selectedIds);\r\n                if (result.success) {\r\n                    toast({\r\n                        title: 'Funcionários removidos',\r\n                        description: `${selectedIds.length} funcionários foram removidos com sucesso.`,\r\n                    });\r\n                    setSelectedIds([]);\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    const sanitizeCSVValue = (value: string): string => {\r\n        // Remove leading special chars that could trigger formulas (CSV injection prevention)\r\n        return value.replace(/^[=+\\-@\\t\\r]/g, '').trim();\r\n    };\r\n\r\n    const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        setImportFile(file);\r\n\r\n        // Validate file size\r\n        if (file.size > MAX_FILE_SIZE) {\r\n            toast({\r\n                title: 'Arquivo muito grande',\r\n                description: 'O tamanho máximo permitido é 5MB.',\r\n                variant: 'destructive',\r\n            });\r\n            setImportFile(null);\r\n            if (fileInputRef.current) fileInputRef.current.value = '';\r\n            return;\r\n        }\r\n\r\n        // Validate file type\r\n        if (!file.name.toLowerCase().endsWith('.csv') && file.type !== 'text/csv') {\r\n            toast({\r\n                title: 'Formato inválido',\r\n                description: 'Apenas arquivos CSV são permitidos',\r\n                variant: 'destructive',\r\n            });\r\n            setImportFile(null);\r\n            if (fileInputRef.current) fileInputRef.current.value = '';\r\n            return;\r\n        }\r\n\r\n        // Pre-fill if user has context\r\n        setImportConfig({\r\n            companyId: profile?.companyId || '',\r\n            projectId: '',\r\n            siteId: ''\r\n        });\r\n        setIsImportModalOpen(true);\r\n        e.target.value = '';\r\n    };\r\n\r\n    const handleConfirmImport = async () => {\r\n        if (!importFile) return;\r\n\r\n        if (!importConfig.companyId || !importConfig.projectId || !importConfig.siteId) {\r\n            toast({\r\n                title: 'Dados Incompletos',\r\n                description: 'Por favor, selecione a Empresa, Obra e Canteiro de destino.',\r\n                variant: 'destructive',\r\n            });\r\n            return;\r\n        }\r\n\r\n        setIsEnqueuing(true);\r\n        const reader = new FileReader();\r\n\r\n        reader.onload = async (event) => {\r\n            const content = event.target?.result as string;\r\n            if (!content) {\r\n                setIsEnqueuing(false);\r\n                return;\r\n            }\r\n\r\n            const lines = content.split('\\n').filter(l => l.trim());\r\n            const startLine = lines[0].toLowerCase().includes('nome') ? 1 : 0;\r\n            const importData: any[] = [];\r\n\r\n            for (let i = startLine; i < lines.length; i++) {\r\n                const line = lines[i].trim();\r\n                const separator = line.includes(';') ? ';' : ',';\r\n                const parts = line.split(separator).map(s => sanitizeCSVValue(s.replace(/^[\"']|[\"']$/g, '')));\r\n                const [fullName, email, phone, funcName, password, cpf, registration] = parts;\r\n\r\n                if (!fullName) continue;\r\n\r\n                const matchedFunc = functions.find(f =>\r\n                    f.name.toLowerCase() === (funcName || '').toLowerCase()\r\n                );\r\n\r\n                importData.push({\r\n                    fullName,\r\n                    email: email || undefined,\r\n                    phone: phone || undefined,\r\n                    cpf: cpf || undefined,\r\n                    password: password || undefined,\r\n                    registrationNumber: registration || undefined,\r\n                    functionId: matchedFunc?.id,\r\n                    companyId: importConfig.companyId,\r\n                    projectId: importConfig.projectId,\r\n                    siteId: importConfig.siteId,\r\n                    laborType: 'MOD'\r\n                });\r\n            }\r\n\r\n            try {\r\n                const { data: job, error } = await orionApi.post<{ id: string }>('jobs', {\r\n                    type: 'EMPLOYEE_IMPORT',\r\n                    payload: {\r\n                        data: importData,\r\n                        requestedBy: profile?.id,\r\n                        requestedAt: new Date().toISOString()\r\n                    }\r\n                });\r\n\r\n                if (error) {\r\n                    throw new Error(error.message || 'Falha ao enfileirar importação');\r\n                }\r\n\r\n                if (!job) throw new Error('Falha ao enfileirar importação: Resposta vazia');\r\n\r\n                // Inicializar estado do job no sinal\r\n                updateJobState(job.id, job as any);\r\n\r\n                toast({\r\n                    title: 'Importação Iniciada',\r\n                    description: 'O arquivo está sendo processado em segundo plano.',\r\n                });\r\n\r\n                // Iniciar Monitoramento via Signals\r\n                monitorJob(job.id);\r\n\r\n                // Fechar modal\r\n                setIsImportModalOpen(false);\r\n                setImportFile(null);\r\n\r\n            } catch (error: unknown) {\r\n                toast({\r\n                    title: 'Erro na importação',\r\n                    description: error instanceof Error ? error.message : 'Erro desconhecido',\r\n                    variant: 'destructive'\r\n                });\r\n            } finally {\r\n                setIsEnqueuing(false);\r\n            }\r\n        };\r\n\r\n        reader.readAsText(importFile, 'UTF-8');\r\n    };\r\n\r\n    const downloadTemplate = () => {\r\n        const headers = ['Nome Completo', 'Email', 'Telefone', 'Cargo (Ex: Pedreiro)', 'Senha', 'CPF', 'Matricula'];\r\n        const examples = [\r\n            ['João da Silva', 'joao.silva@exemplo.com', '11999999999', 'Pedreiro', '123456', '12345678901', 'MAT001'],\r\n            ['Maria Oliveira', 'maria.oliveira@exemplo.com', '11888888888', 'Encarregado', '654321', '98765432109', 'MAT002']\r\n        ];\r\n\r\n        const csvContent = [\r\n            headers.join(';'),\r\n            ...examples.map(row => row.join(';'))\r\n        ].join('\\n');\r\n\r\n        // Add BOM to support special characters in Excel\r\n        const blob = new Blob([\"\\uFEFF\" + csvContent], { type: 'text/csv;charset=utf-8;' });\r\n        const link = document.createElement('a');\r\n        const url = URL.createObjectURL(blob);\r\n        link.setAttribute('href', url);\r\n        link.setAttribute('download', 'template_importacao_funcionarios.csv');\r\n        link.style.visibility = 'hidden';\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n\r\n        toast({\r\n            title: 'Template baixado',\r\n            description: 'Use este arquivo como base para importar seus funcionários.',\r\n        });\r\n    };\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!formData.fullName.trim()) return;\r\n\r\n        // Regra de Negócio: Vínculos obrigatórios para não-gestores\r\n        const selectedFunc = functions.find(f => f.id === formData.functionId);\r\n        const isManager = selectedFunc?.name?.toLowerCase().includes('gestor') ||\r\n            selectedFunc?.name?.toLowerCase().includes('gerente') ||\r\n            isCorporateRole(profile?.role);\r\n\r\n        if (!isManager) {\r\n            if (!formData.companyId || !formData.projectId || !formData.siteId) {\r\n                toast({\r\n                    title: 'Vínculos Obrigatórios',\r\n                    description: 'Funcionários de campo devem ter Empresa, Obra e Canteiro vinculados.',\r\n                    variant: 'destructive'\r\n                });\r\n                return;\r\n            }\r\n        }\r\n\r\n        setIsSaving(true);\r\n        try {\r\n            const companyId = formData.companyId || profile?.companyId || null;\r\n\r\n            const employeeData = {\r\n                fullName: formData.fullName,\r\n                email: formData.email || null,\r\n                phone: formData.phone || null,\r\n                cpf: formData.cpf || null,\r\n                functionId: formData.functionId || null,\r\n                siteId: formData.siteId || null,\r\n                companyId: companyId,\r\n                level: formData.level || 0,\r\n                laborType: formData.laborType,\r\n            };\r\n\r\n            if (editingEmployee) {\r\n                await updateEmployee(editingEmployee.id, employeeData);\r\n                toast({ title: 'Funcionário atualizado!' });\r\n            } else {\r\n                await createEmployee({\r\n                    ...employeeData,\r\n                    registrationNumber: formData.registrationNumber || generateId().slice(0, 8).toUpperCase(),\r\n                    password: formData.password || undefined,\r\n                });\r\n                toast({ title: 'Funcionário cadastrado!' });\r\n            }\r\n            resetForm();\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    const handleDelete = async (employee: Employee) => {\r\n        setConfirmModal({\r\n            open: true,\r\n            title: 'Remover Funcionário',\r\n            description: `Tem certeza que deseja remover \"${employee.fullName}\"? Esta ação não pode ser desfeita.`,\r\n            variant: 'destructive',\r\n            onConfirm: async () => {\r\n                const result = await deleteEmployee(employee.id);\r\n                if (result.success) {\r\n                    toast({ title: 'Funcionário removido' });\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    const toggleActive = async (employee: Employee) => {\r\n        await updateEmployee(employee.id, { isActive: !employee.isActive });\r\n        toast({\r\n            title: employee.isActive ? 'Funcionário desativado' : 'Funcionário ativado',\r\n        });\r\n    };\r\n\r\n    const resetForm = () => {\r\n        setFormData({\r\n            fullName: '',\r\n            email: '',\r\n            phone: '',\r\n            functionId: '',\r\n            registrationNumber: '',\r\n            cpf: '',\r\n            password: '',\r\n            siteId: '',\r\n            companyId: '',\r\n            projectId: '',\r\n            level: 0,\r\n            laborType: 'MOD'\r\n        });\r\n        setEditingEmployee(null);\r\n        setIsDialogOpen(false);\r\n    };\r\n\r\n    const getInitials = (name: string) => {\r\n        return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);\r\n    };\r\n\r\n\r\n    const handleEdit = (employee: Employee) => {\r\n        const site = sites.find(s => s.id === employee.siteId);\r\n        const project = projects.find(p => p.id === site?.projectId);\r\n\r\n        setEditingEmployee(employee);\r\n        setFormData({\r\n            fullName: employee.fullName,\r\n            email: employee.email || '',\r\n            phone: employee.phone || '',\r\n            functionId: employee.functionId || '',\r\n            registrationNumber: employee.registrationNumber,\r\n            cpf: employee.cpf || '',\r\n            password: employee.password || '',\r\n            siteId: employee.siteId || '',\r\n            companyId: employee.companyId || project?.companyId || '',\r\n            projectId: site?.projectId || '',\r\n            level: employee.level || 0,\r\n            laborType: employee.laborType || 'MOD',\r\n        });\r\n        setIsDialogOpen(true);\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n                <div className=\"flex gap-2\">\r\n                    {canUpdate && (\r\n                        <>\r\n                            <Button variant=\"outline\" onClick={() => fileInputRef.current?.click()} className=\"hidden sm:flex\">\r\n                                <FileUp className=\"w-4 h-4 mr-2\" />\r\n                                Importar CSV\r\n                            </Button>\r\n                            <Button variant=\"outline\" onClick={downloadTemplate} className=\"hidden sm:flex\">\r\n                                <FileDown className=\"w-4 h-4 mr-2\" />\r\n                                Baixar Template\r\n                            </Button>\r\n                            <input type=\"file\" ref={fileInputRef} className=\"hidden\" accept=\".csv\" onChange={handleFileUpload} />\r\n\r\n                            <Dialog open={isImportModalOpen} onOpenChange={setIsImportModalOpen}>\r\n                                <DialogContent className=\"max-w-md bg-black/95 border-white/10 backdrop-blur-xl\">\r\n                                    <DialogHeader>\r\n                                        <DialogTitle className=\"flex items-center gap-2\">\r\n                                            <FileUp className=\"w-5 h-5 text-primary\" /> Importar CSV\r\n                                        </DialogTitle>\r\n                                        <DialogDescription className=\"text-muted-foreground\">\r\n                                            Configure onde os funcionários importados serão alocados.\r\n                                        </DialogDescription>\r\n                                    </DialogHeader>\r\n\r\n                                    <div className=\"space-y-4 py-4\">\r\n                                        <div className=\"p-3 bg-muted/20 rounded-md border border-white/5\">\r\n                                            <p className=\"text-sm font-medium text-foreground pb-1\">Arquivo Selecionado:</p>\r\n                                            <p className=\"text-sm text-muted-foreground flex items-center gap-2\">\r\n                                                <FileUp className=\"w-3 h-3\" /> {importFile?.name || 'Nenhum arquivo'}\r\n                                            </p>\r\n                                        </div>\r\n\r\n                                        {isCorporateRole(profile?.role) && (\r\n                                            <div className=\"space-y-2\">\r\n                                                <Label>Empresa Destino</Label>\r\n                                                <Select\r\n                                                    value={importConfig.companyId}\r\n                                                    onValueChange={(val) => setImportConfig({ ...importConfig, companyId: val, projectId: '', siteId: '' })}\r\n                                                >\r\n                                                    <SelectTrigger className=\"industrial-input\">\r\n                                                        <SelectValue placeholder=\"Selecione a empresa...\" />\r\n                                                    </SelectTrigger>\r\n                                                    <SelectContent>\r\n                                                        {companies.map(c => (\r\n                                                            <SelectItem key={c.id} value={c.id}>{c.name}</SelectItem>\r\n                                                        ))}\r\n                                                    </SelectContent>\r\n                                                </Select>\r\n                                            </div>\r\n                                        )}\r\n\r\n                                        <div className=\"space-y-2\">\r\n                                            <Label>Obra Destino <span className=\"text-red-500\">*</span></Label>\r\n                                            <Select\r\n                                                value={importConfig.projectId}\r\n                                                onValueChange={(val) => setImportConfig({ ...importConfig, projectId: val, siteId: '' })}\r\n                                                disabled={!importConfig.companyId}\r\n                                            >\r\n                                                <SelectTrigger className=\"industrial-input\">\r\n                                                    <SelectValue placeholder=\"Selecione a obra...\" />\r\n                                                </SelectTrigger>\r\n                                                <SelectContent>\r\n                                                    {projects\r\n                                                        .filter(p => p.companyId === importConfig.companyId)\r\n                                                        .map(p => (\r\n                                                            <SelectItem key={p.id} value={p.id}>{p.name}</SelectItem>\r\n                                                        ))}\r\n                                                </SelectContent>\r\n                                            </Select>\r\n                                        </div>\r\n\r\n                                        <div className=\"space-y-2\">\r\n                                            <Label>Canteiro Destino <span className=\"text-red-500\">*</span></Label>\r\n                                            <Select\r\n                                                value={importConfig.siteId}\r\n                                                onValueChange={(val) => setImportConfig({ ...importConfig, siteId: val })}\r\n                                                disabled={!importConfig.projectId}\r\n                                            >\r\n                                                <SelectTrigger className=\"industrial-input\">\r\n                                                    <SelectValue placeholder=\"Selecione o canteiro...\" />\r\n                                                </SelectTrigger>\r\n                                                <SelectContent>\r\n                                                    {sites\r\n                                                        .filter(s => s.projectId === importConfig.projectId)\r\n                                                        .map(s => (\r\n                                                            <SelectItem key={s.id} value={s.id}>{s.name}</SelectItem>\r\n                                                        ))}\r\n                                                </SelectContent>\r\n                                            </Select>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"flex justify-end gap-3 pt-4 border-t border-white/10\">\r\n                                        <Button variant=\"ghost\" onClick={() => setIsImportModalOpen(false)}>Cancelar</Button>\r\n                                        <Button\r\n                                            className=\"gradient-primary\"\r\n                                            disabled={isEnqueuing || !importConfig.projectId || !importConfig.siteId}\r\n                                            onClick={handleConfirmImport}\r\n                                        >\r\n                                            {isEnqueuing ? (\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n                                                    <span className=\"text-xs text-primary animate-pulse\">Solicitando...</span>\r\n                                                </div>\r\n                                            ) : (\r\n                                                \"Confirmar Importação\"\r\n                                            )}\r\n                                        </Button>\r\n                                    </div>\r\n                                </DialogContent>\r\n                            </Dialog>\r\n                        </>\r\n                    )}\r\n\r\n                    {canCreate && (\r\n                        <Dialog open={isDialogOpen} onOpenChange={(open) => {\r\n                            if (!open) resetForm();\r\n                            setIsDialogOpen(open);\r\n                        }}>\r\n                            <DialogTrigger asChild>\r\n                                <Button className=\"gradient-primary text-white shadow-glow\">\r\n                                    <Plus className=\"w-4 h-4 mr-2\" />\r\n                                    Novo Funcionário\r\n                                </Button>\r\n                            </DialogTrigger>\r\n                            <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\r\n                                <DialogHeader>\r\n                                    <DialogTitle className=\"flex items-center gap-2 text-2xl font-bold\">\r\n                                        <div className=\"w-10 h-10 rounded-lg gradient-primary flex items-center justify-center shadow-glow\">\r\n                                            <User className=\"text-white w-6 h-6\" />\r\n                                        </div>\r\n                                        {editingEmployee ? 'Editar Funcionário' : 'Novo Funcionário'}\r\n                                    </DialogTitle>\r\n                                    <DialogDescription className=\"text-muted-foreground pt-1\">\r\n                                        Preencha as informações abaixo para gerenciar o colaborador no sistema.\r\n                                    </DialogDescription>\r\n                                </DialogHeader>\r\n\r\n                                <form onSubmit={handleSubmit} className=\"space-y-6 pt-4\">\r\n                                    {/* Seção: Informações Pessoais */}\r\n                                    <div className=\"space-y-4\">\r\n                                        <div className=\"flex items-center gap-2 text-primary font-bold text-xs uppercase tracking-[0.2em] mb-4\">\r\n                                            <User className=\"w-4 h-4\" />\r\n                                            Informações Pessoais\r\n                                        </div>\r\n\r\n                                        <div className=\"space-y-3\">\r\n                                            <Label className=\"text-[10px] uppercase text-muted-foreground font-black tracking-widest flex items-center gap-2\">\r\n                                                Nome Completo <span className=\"text-primary\">*</span>\r\n                                            </Label>\r\n                                            <Input\r\n                                                value={formData.fullName}\r\n                                                onChange={e => setFormData({ ...formData, fullName: e.target.value })}\r\n                                                className=\"industrial-input h-11 px-4 text-sm\"\r\n                                                placeholder=\"Nome completo do colaborador\"\r\n                                                required\r\n                                            />\r\n                                        </div>\r\n\r\n                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                            <div className=\"space-y-3\">\r\n                                                <Label className=\"text-[10px] uppercase text-muted-foreground font-black tracking-widest flex items-center gap-2\">\r\n                                                    <Mail className=\"w-3 h-3\" /> Email\r\n                                                </Label>\r\n                                                <div className=\"relative\">\r\n                                                    <Mail className=\"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground/30\" />\r\n                                                    <Input\r\n                                                        type=\"email\"\r\n                                                        value={formData.email}\r\n                                                        onChange={e => setFormData({ ...formData, email: e.target.value })}\r\n                                                        className=\"industrial-input pl-11 h-11 text-sm\"\r\n                                                        placeholder=\"email@empresa.com\"\r\n                                                    />\r\n                                                </div>\r\n                                            </div>\r\n                                            <div className=\"space-y-3\">\r\n                                                <Label className=\"text-[10px] uppercase text-muted-foreground font-black tracking-widest flex items-center gap-2\">\r\n                                                    <Phone className=\"w-3 h-3\" /> Telefone\r\n                                                </Label>\r\n                                                <div className=\"relative\">\r\n                                                    <Phone className=\"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground/30\" />\r\n                                                    <Input\r\n                                                        value={formData.phone}\r\n                                                        onChange={e => setFormData({ ...formData, phone: e.target.value })}\r\n                                                        className=\"industrial-input pl-11 h-11 text-sm\"\r\n                                                        placeholder=\"(00) 00000-0000\"\r\n                                                    />\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Seção: Cargo e Nível */}\r\n                                    <div className=\"space-y-4 pt-4\">\r\n                                        <div className=\"flex items-center gap-2 text-amber-500 font-bold text-xs uppercase tracking-[0.2em] mb-4\">\r\n                                            <Briefcase className=\"w-4 h-4\" />\r\n                                            Vínculo Profissional\r\n                                        </div>\r\n\r\n                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                            <div className=\"space-y-3\">\r\n                                                <Label className=\"text-[10px] uppercase text-muted-foreground font-black tracking-widest flex items-center gap-2\">\r\n                                                    <Briefcase className=\"w-3 h-3\" /> Função\r\n                                                </Label>\r\n                                                <Select\r\n                                                    value={formData.functionId}\r\n                                                    onValueChange={val => {\r\n                                                        const selectedFunc = functions.find(f => f.id === val);\r\n                                                        setFormData({\r\n                                                            ...formData,\r\n                                                            functionId: val,\r\n                                                            level: selectedFunc?.level || formData.level\r\n                                                        });\r\n                                                    }}\r\n                                                >\r\n                                                    <SelectTrigger className=\"industrial-input h-11 px-4 text-sm\">\r\n                                                        <SelectValue placeholder=\"Selecione a função\" />\r\n                                                    </SelectTrigger>\r\n                                                    <SelectContent className=\"glass-card border-white/10\">\r\n                                                        {functions.map(f => <SelectItem key={f.id} value={f.id}>{f.name}</SelectItem>)}\r\n                                                    </SelectContent>\r\n                                                </Select>\r\n                                            </div>\r\n                                            <div className=\"space-y-3\">\r\n                                                <Label className=\"text-[10px] uppercase text-muted-foreground font-black tracking-widest flex items-center gap-2\">\r\n                                                    <Hash className=\"w-3 h-3\" /> Nível Individual\r\n                                                </Label>\r\n                                                <Input\r\n                                                    type=\"number\"\r\n                                                    min=\"0\"\r\n                                                    max=\"100\"\r\n                                                    value={formData.level}\r\n                                                    onChange={e => {\r\n                                                        const newLevel = parseInt(e.target.value) || 0;\r\n                                                        // Trava: não permite atribuir nível maior que o seu próprio (se não for Super/Admin)\r\n                                                        setFormData({ ...formData, level: newLevel });\r\n                                                    }}\r\n                                                    className=\"industrial-input h-11 px-4 text-sm\"\r\n                                                    placeholder=\"Ex: 5\"\r\n                                                />\r\n                                            </div>\r\n                                            <div className=\"space-y-3\">\r\n                                                <Label className=\"text-[10px] uppercase text-muted-foreground font-black tracking-widest flex items-center gap-2\">\r\n                                                    <Briefcase className=\"w-3 h-3\" /> Tipo de Mão de Obra\r\n                                                </Label>\r\n                                                <Select\r\n                                                    value={formData.laborType}\r\n                                                    onValueChange={val => setFormData({ ...formData, laborType: val })}\r\n                                                >\r\n                                                    <SelectTrigger className=\"industrial-input h-11 px-4 text-sm\">\r\n                                                        <SelectValue placeholder=\"Selecione o tipo\" />\r\n                                                    </SelectTrigger>\r\n                                                    <SelectContent className=\"glass-card border-white/10\">\r\n                                                        <SelectItem value=\"MOD\">Mão de Obra Direta (MOD)</SelectItem>\r\n                                                        <SelectItem value=\"MOI\">Mão de Obra Indireta (MOI)</SelectItem>\r\n                                                    </SelectContent>\r\n                                                </Select>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        <div className=\"grid grid-cols-1 gap-4\">\r\n                                            {isCorporateRole(profile?.role) && (\r\n                                                <div className=\"space-y-3\">\r\n                                                    <Label className=\"text-[10px] uppercase text-muted-foreground font-black tracking-widest flex items-center gap-2\">\r\n                                                        <Building2 className=\"w-3 h-3\" /> Empresa Afiliada <span className=\"text-primary\">*</span>\r\n                                                    </Label>\r\n                                                    <Select\r\n                                                        value={formData.companyId}\r\n                                                        onValueChange={v => setFormData({ ...formData, companyId: v, projectId: '', siteId: '' })}\r\n                                                    >\r\n                                                        <SelectTrigger className=\"industrial-input h-11 px-4 text-sm\">\r\n                                                            <SelectValue placeholder=\"Selecione a empresa\" />\r\n                                                        </SelectTrigger>\r\n                                                        <SelectContent className=\"glass-card border-white/10\">\r\n                                                            {companies.map(c => (\r\n                                                                <SelectItem key={c.id} value={c.id}>{c.name}</SelectItem>\r\n                                                            ))}\r\n                                                        </SelectContent>\r\n                                                    </Select>\r\n                                                </div>\r\n                                            )}\r\n\r\n                                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                                <div className=\"space-y-3\">\r\n                                                    <Label className=\"text-[10px] uppercase text-muted-foreground font-black tracking-widest flex items-center gap-2\">\r\n                                                        <ShieldCheck className=\"w-3 h-3\" /> Obra Vinculada <span className=\"text-primary\">*</span>\r\n                                                    </Label>\r\n                                                    <Select\r\n                                                        value={formData.projectId}\r\n                                                        onValueChange={v => setFormData({ ...formData, projectId: v, siteId: '' })}\r\n                                                        disabled={(!formData.companyId && isCorporateRole(profile?.role))}\r\n                                                    >\r\n                                                        <SelectTrigger className=\"industrial-input h-11 px-4 text-sm\">\r\n                                                            <SelectValue placeholder=\"Selecione a obra\" />\r\n                                                        </SelectTrigger>\r\n                                                        <SelectContent className=\"glass-card border-white/10\">\r\n                                                            {projects\r\n                                                                .filter(p => !formData.companyId || p.companyId === formData.companyId)\r\n                                                                .map(p => (\r\n                                                                    <SelectItem key={p.id} value={p.id}>{p.name}</SelectItem>\r\n                                                                ))\r\n                                                            }\r\n                                                        </SelectContent>\r\n                                                    </Select>\r\n                                                </div>\r\n\r\n                                                <div className=\"space-y-3\">\r\n                                                    <Label className=\"text-[10px] uppercase text-muted-foreground font-black tracking-widest flex items-center gap-2\">\r\n                                                        <MapPin className=\"w-3 h-3\" /> Canteiro / Unidade <span className=\"text-primary\">*</span>\r\n                                                    </Label>\r\n                                                    <Select\r\n                                                        value={formData.siteId}\r\n                                                        onValueChange={v => setFormData({ ...formData, siteId: v })}\r\n                                                        disabled={!formData.projectId}\r\n                                                    >\r\n                                                        <SelectTrigger className=\"industrial-input h-11 px-4 text-sm\">\r\n                                                            <SelectValue placeholder=\"Selecione o local\" />\r\n                                                        </SelectTrigger>\r\n                                                        <SelectContent className=\"glass-card border-white/10\">\r\n                                                            {sites\r\n                                                                .filter(s => s.projectId === formData.projectId)\r\n                                                                .map(s => (\r\n                                                                    <SelectItem key={s.id} value={s.id}>{s.name}</SelectItem>\r\n                                                                ))\r\n                                                            }\r\n                                                        </SelectContent>\r\n                                                    </Select>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Seção: Acesso */}\r\n                                    <div className=\"space-y-4 pt-4\">\r\n                                        <div className=\"flex items-center gap-2 text-green-500 font-bold text-xs uppercase tracking-[0.2em] mb-4\">\r\n                                            <Scan className=\"w-4 h-4\" />\r\n                                            Acesso ao Sistema\r\n                                        </div>\r\n\r\n                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                            <div className=\"space-y-3\">\r\n                                                <Label className=\"text-[10px] uppercase text-muted-foreground font-black tracking-widest flex items-center gap-2\">\r\n                                                    <CreditCard className=\"w-3 h-3\" /> CPF <span className=\"text-primary\">*</span>\r\n                                                </Label>\r\n                                                <Input\r\n                                                    value={formData.cpf}\r\n                                                    onChange={e => setFormData({ ...formData, cpf: e.target.value.replace(/\\D/g, '').slice(0, 11) })}\r\n                                                    className=\"industrial-input h-11 px-4 text-sm\"\r\n                                                    placeholder=\"000.000.000-00\"\r\n                                                    required\r\n                                                />\r\n                                            </div>\r\n                                            <div className=\"space-y-3\">\r\n                                                <Label className=\"text-[10px] uppercase text-muted-foreground font-black tracking-widest flex items-center gap-2\">\r\n                                                    <ShieldCheck className=\"w-3 h-3\" /> Senha de Acesso\r\n                                                </Label>\r\n                                                <Input\r\n                                                    type=\"password\"\r\n                                                    value={formData.password}\r\n                                                    onChange={e => setFormData({ ...formData, password: e.target.value })}\r\n                                                    className=\"industrial-input h-11 px-4 text-sm\"\r\n                                                    placeholder=\"Clique para definir\"\r\n                                                    autoComplete=\"new-password\"\r\n                                                />\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"flex items-start gap-2 bg-white/5 p-3 rounded-lg border border-white/10\">\r\n                                            <AlertCircle className=\"w-4 h-4 text-amber-500 mt-0.5 shrink-0\" />\r\n                                            <p className=\"text-[11px] text-muted-foreground leading-relaxed\">\r\n                                                A combinação de <span className=\"text-white font-bold\">CPF</span> + <span className=\"text-white font-bold\">Senha</span> será utilizada para o login do funcionário e registro de biometria facial.\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"pt-4 pb-2\">\r\n                                        <Button type=\"submit\" className=\"w-full h-12 text-lg gradient-primary shadow-glow hover:scale-[1.01] transition-all\" disabled={isSaving}>\r\n                                            {isSaving ? <Loader2 className=\"w-5 h-5 mr-3 animate-spin\" /> : null}\r\n                                            {editingEmployee ? 'Salvar Alterações' : 'Cadastrar novo Colaborador'}\r\n                                        </Button>\r\n                                        <p className=\"text-[10px] text-center text-muted-foreground mt-3 uppercase tracking-widest opacity-50\">GESTÃO VIRTUAL - Gestão de Ativos</p>\r\n                                    </div>\r\n                                </form>\r\n                            </DialogContent>\r\n                        </Dialog>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Filters Bar */}\r\n            <div className=\"glass-card p-3 rounded-xl border-white/5\">\r\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2\">\r\n                    <Select value={filterFunction} onValueChange={setFilterFunction}>\r\n                        <SelectTrigger className=\"industrial-input h-9\">\r\n                            <SelectValue placeholder=\"📋 Todas as funções\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                            <SelectItem value=\"all\">Todas as funções</SelectItem>\r\n                            {functions.map(f => <SelectItem key={f.id} value={f.id}>{f.name}</SelectItem>)}\r\n                        </SelectContent>\r\n                    </Select>\r\n\r\n                    <Select value={filterStatus} onValueChange={setFilterStatus}>\r\n                        <SelectTrigger className=\"industrial-input h-9\">\r\n                            <SelectValue placeholder=\"✓ Todos os status\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                            <SelectItem value=\"all\">Todos os status</SelectItem>\r\n                            <SelectItem value=\"active\">Apenas Ativos</SelectItem>\r\n                            <SelectItem value=\"inactive\">Apenas Inativos</SelectItem>\r\n                        </SelectContent>\r\n                    </Select>\r\n\r\n                    <Select value={filterProject} onValueChange={(val) => {\r\n                        setFilterProject(val);\r\n                        setFilterSite('all');\r\n                    }}>\r\n                        <SelectTrigger className=\"industrial-input h-9\">\r\n                            <SelectValue placeholder=\"🏗️ Todas as obras\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                            <SelectItem value=\"all\">Todas as obras</SelectItem>\r\n                            {projects.map(p => <SelectItem key={p.id} value={p.id}>{p.name}</SelectItem>)}\r\n                        </SelectContent>\r\n                    </Select>\r\n\r\n                    <Select value={filterSite} onValueChange={(val) => {\r\n                        setFilterSite(val);\r\n                        if (val !== 'all') {\r\n                            const site = sites.find(s => s.id === val);\r\n                            if (site && site.projectId !== filterProject) {\r\n                                setFilterProject(site.projectId);\r\n                            }\r\n                        }\r\n                    }}>\r\n                        <SelectTrigger className=\"industrial-input h-9\">\r\n                            <SelectValue placeholder=\"🚧 Todos os canteiros\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                            <SelectItem value=\"all\">Todos os canteiros</SelectItem>\r\n                            {sites\r\n                                .filter(s => filterProject === 'all' || s.projectId === filterProject)\r\n                                .map(s => <SelectItem key={s.id} value={s.id}>{s.name}</SelectItem>)\r\n                            }\r\n                        </SelectContent>\r\n                    </Select>\r\n\r\n                    <Input\r\n                        placeholder=\"🔍 Nome ou email...\"\r\n                        className=\"industrial-input h-9\"\r\n                        value={searchTerm}\r\n                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                    />\r\n\r\n                    <Input\r\n                        placeholder=\"💳 CPF ou Matrícula...\"\r\n                        className=\"industrial-input h-9\"\r\n                        value={filterCpfOrRegistration}\r\n                        onChange={(e) => setFilterCpfOrRegistration(e.target.value)}\r\n                    />\r\n\r\n                    <Select value={filterBiometric} onValueChange={setFilterBiometric}>\r\n                        <SelectTrigger className=\"industrial-input h-9\">\r\n                            <SelectValue placeholder=\"🔐 Biometria\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                            <SelectItem value=\"all\">Todos</SelectItem>\r\n                            <SelectItem value=\"with\">Com Biometria</SelectItem>\r\n                            <SelectItem value=\"without\">Sem Biometria</SelectItem>\r\n                        </SelectContent>\r\n                    </Select>\r\n\r\n                    <Select value={filterLevel} onValueChange={setFilterLevel}>\r\n                        <SelectTrigger className=\"industrial-input h-9\">\r\n                            <SelectValue placeholder=\"📊 Todos os Níveis\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                            <SelectItem value=\"all\">Todos os Níveis</SelectItem>\r\n                            {[...Array(11)].map((_, i) => (\r\n                                <SelectItem key={i} value={i.toString()}>Nível {i}</SelectItem>\r\n                            ))}\r\n                        </SelectContent>\r\n                    </Select>\r\n                </div>\r\n\r\n                <div className=\"flex gap-2\">\r\n                    {selectedIds.length > 0 && (\r\n                        <Button\r\n                            variant=\"destructive\"\r\n                            onClick={handleBulkDelete}\r\n                            className=\"shadow-glow-red\"\r\n                        >\r\n                            <Trash2 className=\"w-4 h-4 mr-2\" />\r\n                            Remover ({selectedIds.length})\r\n                        </Button>\r\n                    )}\r\n                    <Button\r\n                        variant=\"ghost\"\r\n                        onClick={() => {\r\n                            setSearchTerm('');\r\n                            setFilterCpfOrRegistration('');\r\n                            setFilterBiometric('all');\r\n                            setFilterFunction('all');\r\n                            setFilterStatus('all');\r\n                            setFilterProject('all');\r\n                            setFilterSite('all');\r\n                            setFilterLevel('all');\r\n                            setSelectedIds([]);\r\n                        }}\r\n                        className=\"hover:bg-white/5\"\r\n                    >\r\n                        Limpar\r\n                    </Button>\r\n                </div >\r\n            </div>\r\n\r\n            {/* Table */}\r\n            <Card className=\"glass-card border-white/5 overflow-hidden\">\r\n                <div className=\"overflow-x-auto\">\r\n                    <Table>\r\n                        <TableHeader className=\"bg-white/5\">\r\n                            <TableRow className=\"hover:bg-transparent border-white/10\">\r\n                                <TableHead className=\"w-[50px]\">\r\n                                    <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"icon\"\r\n                                        onClick={handleSelectAll}\r\n                                        className=\"h-8 w-8\"\r\n                                    >\r\n                                        {selectedIds.length === filteredEmployees.length && filteredEmployees.length > 0 ? (\r\n                                            <CheckSquare className=\"w-5 h-5 text-primary\" />\r\n                                        ) : (\r\n                                            <Square className=\"w-5 h-5 text-muted-foreground\" />\r\n                                        )}\r\n                                    </Button>\r\n                                </TableHead>\r\n                                <TableHead onClick={() => handleSort(\"professionalLevel\")}\r\n                                    className=\"cursor-pointer select-none text-center\"\r\n                                >\r\n                                    <div className=\"font-bold text-xs uppercase tracking-wider flex items-center justify-center gap-1\">\r\n                                        Nível Prof.\r\n                                        {sortBy === \"professionalLevel\" && (\r\n                                            sortDir === \"asc\"\r\n                                                ? <ArrowUp className=\"w-4 h-4 opacity-75\" />\r\n                                                : <ArrowDown className=\"w-4 h-4 opacity-75\" />\r\n                                        )}\r\n                                    </div>\r\n                                </TableHead>\r\n                                <TableHead onClick={() => handleSort(\"level\")}\r\n                                    className=\"cursor-pointer select-none text-center\"\r\n                                >\r\n                                    <div className=\"font-bold text-xs uppercase tracking-wider flex items-center justify-center gap-1\">\r\n                                        Nível Ind.\r\n                                        {sortBy === \"level\" && (\r\n                                            sortDir === \"asc\"\r\n                                                ? <ArrowUp className=\"w-4 h-4 opacity-75\" />\r\n                                                : <ArrowDown className=\"w-4 h-4 opacity-75\" />\r\n                                        )}\r\n                                    </div>\r\n                                </TableHead>\r\n                                <TableHead\r\n                                    onClick={() => handleSort(\"fullName\")}\r\n                                    className=\"cursor-pointer select-none text-center\"\r\n                                >\r\n                                    <div className=\"font-bold text-xs uppercase tracking-wider flex items-center justify-center gap-1\">\r\n                                        Funcionário\r\n                                        {sortBy === \"fullName\" && (\r\n                                            sortDir === \"asc\"\r\n                                                ? <ArrowUp className=\"w-4 h-4 opacity-75\" />\r\n                                                : <ArrowDown className=\"w-4 h-4 opacity-75\" />\r\n                                        )}\r\n                                    </div>\r\n                                </TableHead>\r\n                                <TableHead onClick={() => handleSort(\"functionName\")}\r\n                                    className=\"cursor-pointer select-none text-center\"\r\n                                >\r\n                                    <div className=\"font-bold text-xs uppercase tracking-wider flex items-center justify-center gap-1\">\r\n                                        Função\r\n                                        {sortBy === \"functionName\" && (\r\n                                            sortDir === \"asc\"\r\n                                                ? <ArrowUp className=\"w-4 h-4 opacity-75\" />\r\n                                                : <ArrowDown className=\"w-4 h-4 opacity-75\" />\r\n                                        )}\r\n                                    </div>\r\n                                </TableHead>\r\n                                <TableHead onClick={() => handleSort(\"laborType\")}\r\n                                    className=\"cursor-pointer select-none text-center\"\r\n                                >\r\n                                    <div className=\"font-bold text-xs uppercase tracking-wider flex items-center justify-center gap-1\">\r\n                                        Mão de Obra\r\n                                        {sortBy === \"laborType\" && (\r\n                                            sortDir === \"asc\"\r\n                                                ? <ArrowUp className=\"w-4 h-4 opacity-75\" />\r\n                                                : <ArrowDown className=\"w-4 h-4 opacity-75\" />\r\n                                        )}\r\n                                    </div>\r\n                                </TableHead>\r\n\r\n                                <TableHead onClick={() => handleSort(\"email\")}\r\n                                    className=\"cursor-pointer select-none text-center\"\r\n                                >\r\n                                    <div className=\"font-bold text-xs uppercase tracking-wider flex items-center justify-center gap-1\">\r\n                                        Contato\r\n                                        {sortBy === \"email\" && (\r\n                                            sortDir === \"asc\"\r\n                                                ? <ArrowUp className=\"w-4 h-4 opacity-75\" />\r\n                                                : <ArrowDown className=\"w-4 h-4 opacity-75\" />\r\n                                        )}\r\n                                    </div>\r\n                                </TableHead>\r\n\r\n                                <TableHead onClick={() => handleSort(\"isActive\")}\r\n                                    className=\"cursor-pointer select-none text-center align-middle\">\r\n                                    <div className=\"font-bold text-xs uppercase tracking-wider flex items-center justify-center gap-1\">\r\n                                        Status\r\n                                        {sortBy === \"isActive\" && (\r\n                                            sortDir === \"asc\"\r\n                                                ? <ArrowUp className=\"w-4 h-4 opacity-75\" />\r\n                                                : <ArrowDown className=\"w-4 h-4 opacity-75\" />\r\n                                        )}\r\n                                    </div>\r\n                                </TableHead>\r\n                                <TableHead\r\n                                    onClick={() => handleSort(\"siteName\")}\r\n                                    className=\"cursor-pointer select-none text-center\"\r\n                                >\r\n                                    <div className=\"font-bold text-xs uppercase tracking-wider flex items-center justify-center gap-1\">\r\n                                        Canteiro / Obra\r\n                                        {sortBy === \"siteName\" && (\r\n                                            sortDir === \"asc\"\r\n                                                ? <ArrowUp className=\"w-4 h-4 opacity-75\" />\r\n                                                : <ArrowDown className=\"w-4 h-4 opacity-75\" />\r\n                                        )}\r\n                                    </div>\r\n                                </TableHead>\r\n                                <TableHead className=\"text-center font-bold text-xs uppercase tracking-wider\">Ações</TableHead>\r\n                            </TableRow>\r\n                        </TableHeader>\r\n\r\n                        <TableBody>\r\n                            {isLoading ? (\r\n                                Array(8).fill(0).map((_, i) => (\r\n                                    <TableRow key={`skeleton-${i}`} className=\"animate-pulse border-white/5\">\r\n                                        <TableCell><div className=\"h-5 w-5 bg-white/5 rounded mx-auto\" /></TableCell>\r\n                                        <TableCell><div className=\"h-6 w-8 bg-white/5 rounded-full mx-auto\" /></TableCell>\r\n                                        <TableCell><div className=\"h-6 w-8 bg-white/5 rounded-full mx-auto\" /></TableCell>\r\n                                        <TableCell className=\"py-4\">\r\n                                            <div className=\"flex items-center gap-3 justify-center\">\r\n                                                <div className=\"w-10 h-10 rounded-full bg-white/5\" />\r\n                                                <div className=\"space-y-2\">\r\n                                                    <div className=\"h-3 w-24 bg-white/10 rounded\" />\r\n                                                    <div className=\"h-2 w-16 bg-white/5 rounded\" />\r\n                                                </div>\r\n                                            </div>\r\n                                        </TableCell>\r\n                                        <TableCell><div className=\"h-6 w-20 bg-white/5 rounded-full mx-auto\" /></TableCell>\r\n                                        <TableCell><div className=\"h-6 w-12 bg-white/5 rounded-full mx-auto\" /></TableCell>\r\n                                        <TableCell><div className=\"h-8 w-32 bg-white/5 rounded mx-auto\" /></TableCell>\r\n                                        <TableCell><div className=\"h-5 w-16 bg-white/5 rounded-full mx-auto\" /></TableCell>\r\n                                        <TableCell><div className=\"h-4 w-24 bg-white/5 rounded mx-auto\" /></TableCell>\r\n                                        <TableCell><div className=\"h-8 w-24 bg-white/5 rounded-md mx-auto\" /></TableCell>\r\n                                    </TableRow>\r\n                                ))\r\n                            ) : filteredEmployees.length === 0 ? (\r\n\r\n                                <TableRow>\r\n                                    <TableCell colSpan={8} className=\"h-[400px]\">\r\n                                        <ProjectEmptyState\r\n                                            type=\"workers\"\r\n                                            title=\"Nenhum Colaborador Encontrado\"\r\n                                            description=\"Não há colaboradores cadastrados na sua empresa ou que atendam aos filtros selecionados.\"\r\n                                            onAction={() => setIsDialogOpen(true)}\r\n                                            actionLabel=\"Cadastrar Colaborador\"\r\n                                        />\r\n                                    </TableCell>\r\n                                </TableRow>\r\n                            ) : (\r\n                                filteredEmployees.map((employee) => (\r\n                                    <TableRow\r\n                                        key={employee.id}\r\n                                        className={cn(\r\n                                            \"group hover:bg-primary/5 transition-all duration-500 border-white/5 relative overflow-hidden\",\r\n                                            !employee.isActive && \"opacity-40 grayscale-[0.6]\"\r\n                                        )}\r\n                                    >\r\n                                        <TableCell>\r\n                                            <Button\r\n                                                variant=\"ghost\"\r\n                                                size=\"icon\"\r\n                                                onClick={() => toggleSelection(employee.id)}\r\n                                                className=\"h-8 w-8\"\r\n                                            >\r\n                                                {selectedIds.includes(employee.id) ? (\r\n                                                    <CheckSquare className=\"w-5 h-5 text-primary\" />\r\n                                                ) : (\r\n                                                    <Square className=\"w-5 h-5 text-muted-foreground\" />\r\n                                                )}\r\n                                            </Button>\r\n                                        </TableCell>\r\n                                        <TableCell>\r\n                                            <div className=\"flex justify-center\">\r\n                                                <Badge variant=\"outline\" className=\"bg-blue-500/10 text-blue-500 border-blue-500/20 font-bold\">\r\n                                                    P{employee.professionalLevel}\r\n                                                </Badge>\r\n                                            </div>\r\n                                        </TableCell>\r\n                                        <TableCell>\r\n                                            <div className=\"flex justify-center\">\r\n                                                {(() => {\r\n                                                    const level = employee.level || 0;\r\n                                                    return (\r\n                                                        <Badge variant=\"outline\" className={`\r\n                                                            ${level >= 8 ? 'bg-amber-500/20 text-amber-500 border-amber-500/20' :\r\n                                                                level >= 5 ? 'bg-primary/20 text-primary border-primary/20' :\r\n                                                                    'bg-white/5 text-muted-foreground border-white/10'}\r\n                                                            font-bold\r\n                                                        `}>\r\n                                                            I{level}\r\n                                                        </Badge>\r\n                                                    );\r\n                                                })()}\r\n                                            </div>\r\n                                        </TableCell>\r\n                                        <TableCell className=\"py-3\">\r\n                                            <div className=\"flex items-center gap-3 justify-center group-hover:translate-x-1 transition-transform duration-500\">\r\n                                                <div className=\"relative\">\r\n                                                    <Avatar className=\"w-10 h-10 border-2 border-white/5 shadow-lg group-hover:border-primary/40 transition-colors duration-500\">\r\n                                                        <AvatarImage src={employee.photoUrl || undefined} className=\"object-cover\" />\r\n                                                        <AvatarFallback className=\"bg-linear-to-br from-primary/20 to-primary/5 text-primary text-xs font-bold\">\r\n                                                            {getInitials(employee.fullName)}\r\n                                                        </AvatarFallback>\r\n                                                    </Avatar>\r\n                                                    {employee.faceDescriptor && (\r\n                                                        <div className=\"absolute -bottom-1 -right-1 bg-background rounded-full p-0.5 border border-primary/30 shadow-sm animate-pulse\">\r\n                                                            <Fingerprint className=\"w-3 h-3 text-primary\" />\r\n                                                        </div>\r\n                                                    )}\r\n                                                </div>\r\n                                                <div className=\"flex flex-col items-start gap-0.5 min-w-[120px]\">\r\n                                                    <span className=\"font-bold text-[13px] text-white/90 group-hover:text-primary transition-colors duration-300\">{employee.fullName}</span>\r\n                                                    <div className=\"flex items-center gap-2\">\r\n                                                        {employee.cpf && (\r\n                                                            <span className=\"text-[10px] text-muted-foreground/80 leading-tight\">CPF: {employee.cpf}</span>\r\n                                                        )}\r\n                                                        <span className=\"text-[10px] text-muted-foreground/60 font-mono leading-tight tracking-tighter\">MAT: {employee.registrationNumber}</span>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </TableCell>\r\n                                        <TableCell>\r\n                                            <div className=\"flex justify-center\">\r\n                                                <Badge\r\n                                                    variant=\"outline\"\r\n                                                    className={cn(\r\n                                                        \"font-medium\",\r\n                                                        employee.functionName !== 'Não definida'\r\n                                                            ? \"bg-primary/5 border-primary/20 text-primary\"\r\n                                                            : \"text-red-600\"\r\n                                                    )}\r\n                                                >\r\n                                                    {employee.functionName}\r\n                                                </Badge>\r\n                                            </div>\r\n                                        </TableCell>\r\n                                        <TableCell>\r\n                                            <div className=\"flex justify-center\">\r\n                                                <Badge variant=\"outline\" className={cn(\r\n                                                    \"text-[10px] font-bold px-2 py-0.5 border-white/10\",\r\n                                                    employee.laborType === 'MOI' ? \"bg-amber-500/10 text-amber-500\" : \"bg-blue-500/10 text-blue-500\"\r\n                                                )}>\r\n                                                    {employee.laborType || 'MOD'}\r\n                                                </Badge>\r\n                                            </div>\r\n                                        </TableCell>\r\n                                        <TableCell>\r\n                                            <div className=\"flex flex-col items-center gap-1 text-center\">\r\n                                                {employee.email && (\r\n                                                    <div className=\"flex items-center gap-1.5 text-xs text-muted-foreground\">\r\n                                                        <Mail className=\"w-3 h-3\" /> {employee.email}\r\n                                                    </div>\r\n                                                )}\r\n                                                {employee.phone && (\r\n                                                    <div className=\"flex items-center gap-1.5 text-xs text-muted-foreground\">\r\n                                                        <Phone className=\"w-3 h-3\" /> {employee.phone}\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n                                        </TableCell>\r\n                                        <TableCell>\r\n                                            <div className=\"flex justify-center\">\r\n                                                {employee.isActive ? (\r\n                                                    <div className=\"flex items-center gap-1.5 text-success text-xs font-bold\">\r\n                                                        <CheckCircle2 className=\"w-3.5 h-3.5\" /> ATIVO\r\n                                                    </div>\r\n                                                ) : (\r\n                                                    <div className=\"flex items-center gap-1.5 text-muted-foreground text-xs font-bold\">\r\n                                                        <XCircle className=\"w-3.5 h-3.5\" /> INATIVO\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n                                        </TableCell>\r\n                                        <TableCell>\r\n                                            <div className=\"flex flex-col items-center gap-0.5 text-center\">\r\n                                                {(() => {\r\n                                                    const site = sites.find(s => s.id === employee.siteId);\r\n                                                    const project = projects.find(p => p.id === site?.projectId);\r\n                                                    const company = companies.find(c => c.id === employee.companyId);\r\n\r\n                                                    if (!site && !project && !company) {\r\n                                                        return (\r\n                                                            <div className=\"flex items-center gap-1.5 text-red-500/60 bg-red-500/5 border border-red-500/10 px-2 py-1 rounded-md w-fit animate-pulse\">\r\n                                                                <AlertCircle className=\"w-3 h-3\" />\r\n                                                                <span className=\"text-[10px] font-bold uppercase tracking-tighter\">Sem Definição</span>\r\n                                                            </div>\r\n                                                        );\r\n                                                    }\r\n\r\n                                                    return (\r\n                                                        <>\r\n                                                            {site && (\r\n                                                                <span className=\"font-medium text-sm\">{site.name}</span>\r\n                                                            )}\r\n                                                            {(project || company) && (\r\n                                                                <span className=\"text-[10px] text-muted-foreground uppercase\">\r\n                                                                    {project?.name}\r\n                                                                    {project && company ? ' • ' : ''}\r\n                                                                    {company?.name}\r\n                                                                </span>\r\n                                                            )}\r\n                                                        </>\r\n                                                    );\r\n                                                })()}\r\n                                            </div>\r\n                                        </TableCell>\r\n                                        <TableCell className=\"text-center\">\r\n                                            <div className=\"flex items-center justify-center gap-1\">\r\n                                                {(() => {\r\n                                                    const canManage = profile ? canManageEmployee(profile, { level: employee.level, companyId: employee.companyId }) : false;\r\n\r\n                                                    if (!canManage) {\r\n                                                        return (\r\n                                                            <div className=\"flex items-center justify-center h-8 w-8 text-muted-foreground/30\" title=\"Sem permissão hierárquica\">\r\n                                                                <Lock className=\"w-4 h-4\" />\r\n                                                            </div>\r\n                                                        );\r\n                                                    }\r\n\r\n                                                    return (\r\n                                                        <>\r\n                                                            <Button\r\n                                                                variant=\"ghost\"\r\n                                                                size=\"icon\"\r\n                                                                onClick={() => handleEdit(employee)}\r\n                                                                className=\"h-8 w-8 hover:bg-primary/10 hover:text-primary transition-colors\"\r\n                                                            >\r\n                                                                <Pencil className=\"w-4 h-4\" />\r\n                                                            </Button>\r\n                                                            <Button\r\n                                                                variant=\"ghost\"\r\n                                                                size=\"icon\"\r\n                                                                onClick={() => {\r\n                                                                    setFaceRegEmployee(employee);\r\n                                                                    setIsFaceRegOpen(true);\r\n                                                                }}\r\n                                                                className={`h-8 w-8 ${employee.faceDescriptor ? 'text-primary' : 'text-muted-foreground'} hover:bg-primary/10 transition-colors`}\r\n                                                                title={employee.faceDescriptor ? \"Recadastrar Rosto\" : \"Cadastrar Rosto\"}\r\n                                                            >\r\n                                                                <Scan className=\"w-4 h-4\" />\r\n                                                            </Button>\r\n                                                            <Button\r\n                                                                variant=\"ghost\"\r\n                                                                size=\"icon\"\r\n                                                                onClick={() => toggleActive(employee)}\r\n                                                                className={`h-8 w-8 ${employee.isActive ? 'hover:bg-amber-500/10 hover:text-amber-500' : 'hover:bg-green-500/10 hover:text-green-500'}`}\r\n                                                                title={employee.isActive ? \"Desativar\" : \"Ativar\"}\r\n                                                            >\r\n                                                                {employee.isActive ? <XCircle className=\"w-4 h-4\" /> : <CheckCircle2 className=\"w-4 h-4\" />}\r\n                                                            </Button>\r\n                                                            <Button\r\n                                                                variant=\"ghost\"\r\n                                                                size=\"icon\"\r\n                                                                onClick={() => handleDelete(employee)}\r\n                                                                className=\"h-8 w-8 hover:bg-destructive/10 hover:text-destructive transition-colors\"\r\n                                                            >\r\n                                                                <Trash2 className=\"w-4 h-4\" />\r\n                                                            </Button>\r\n                                                        </>\r\n                                                    );\r\n                                                })()}\r\n                                            </div>\r\n                                        </TableCell>\r\n\r\n                                    </TableRow>\r\n                                ))\r\n                            )}\r\n                        </TableBody>\r\n                    </Table>\r\n                </div>\r\n            </Card >\r\n\r\n            <FaceRegistrationDialog\r\n                employee={faceRegEmployee}\r\n                open={isFaceRegOpen}\r\n                onOpenChange={setIsFaceRegOpen}\r\n            />\r\n            {/* Confirmation Dialog */}\r\n            <ConfirmationDialog\r\n                open={confirmModal.open}\r\n                onOpenChange={(open) => setConfirmModal(prev => ({ ...prev, open }))}\r\n                title={confirmModal.title}\r\n                description={confirmModal.description}\r\n                onConfirm={confirmModal.onConfirm}\r\n                variant={confirmModal.variant}\r\n            />\r\n        </div >\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\Functions.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'generateId' is defined but never used.","line":13,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'profile' is assigned a value but never used.","line":24,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1520,1523],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1520,1523],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":146,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":146,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":261,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":261,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10107,10110],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10107,10110],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useRef } from 'react';\r\nimport { useJobFunctions } from '@/hooks/useJobFunctions';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\r\nimport { Checkbox } from '@/components/ui/checkbox';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { Plus, Pencil, Trash2, Briefcase, Crown, Search, FileUp, FileDown, Loader2, TrendingUp } from 'lucide-react';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { generateId } from '@/lib/utils';\r\nimport { ConfirmationDialog } from '@/components/shared/ConfirmationDialog';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { isProtectedSignal, can } from '@/signals/authSignals';\r\nimport { useSignals } from \"@preact/signals-react/runtime\";\r\n\r\nimport { Lock } from 'lucide-react';\r\n\r\nexport default function Functions() {\r\n    useSignals();\r\n    const { functions, isLoading, createFunction, updateFunction, deleteFunction } = useJobFunctions();\r\n    const { profile } = useAuth();\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [isDialogOpen, setIsDialogOpen] = useState(false);\r\n    const [editingFunction, setEditingFunction] = useState<any | null>(null);\r\n    const [isSaving, setIsSaving] = useState(false);\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n    const [formData, setFormData] = useState({\r\n        name: '',\r\n        description: '',\r\n        canLeadTeam: false,\r\n        level: 0,\r\n    });\r\n    const [confirmModal, setConfirmModal] = useState<{\r\n        open: boolean;\r\n        title: string;\r\n        description: string;\r\n        onConfirm: () => void | Promise<void>;\r\n        variant: 'default' | 'destructive';\r\n    }>({\r\n        open: false,\r\n        title: '',\r\n        description: '',\r\n        onConfirm: () => { },\r\n        variant: 'default'\r\n    });\r\n    const { toast } = useToast();\r\n\r\n    const MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB\r\n    const MAX_ROWS = 1000;\r\n\r\n    const sanitizeCSVValue = (value: string): string => {\r\n        // Remove leading special chars that could trigger formulas (CSV injection prevention)\r\n        return value.replace(/^[=+\\-@\\t\\r]/g, '').trim();\r\n    };\r\n\r\n    const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        // Validate file size\r\n        if (file.size > MAX_FILE_SIZE) {\r\n            toast({\r\n                title: 'Arquivo muito grande',\r\n                description: 'O arquivo deve ter no máximo 5MB',\r\n                variant: 'destructive',\r\n            });\r\n            e.target.value = '';\r\n            return;\r\n        }\r\n\r\n        // Validate file type\r\n        if (!file.name.toLowerCase().endsWith('.csv') && file.type !== 'text/csv') {\r\n            toast({\r\n                title: 'Formato inválido',\r\n                description: 'Apenas arquivos CSV são permitidos',\r\n                variant: 'destructive',\r\n            });\r\n            e.target.value = '';\r\n            return;\r\n        }\r\n\r\n        const reader = new FileReader();\r\n        reader.onload = async (event) => {\r\n            const content = event.target?.result as string;\r\n            if (!content) return;\r\n\r\n            const lines = content.split('\\n').filter(l => l.trim());\r\n\r\n            // Validate row count\r\n            if (lines.length > MAX_ROWS) {\r\n                toast({\r\n                    title: 'Muitas linhas',\r\n                    description: `O arquivo pode ter no máximo ${MAX_ROWS} linhas`,\r\n                    variant: 'destructive',\r\n                });\r\n                e.target.value = '';\r\n                return;\r\n            }\r\n\r\n            let importCount = 0;\r\n            let duplicateCount = 0;\r\n            let formatErrorCount = 0;\r\n\r\n            const startLine = lines[0].toLowerCase().includes('nome') ? 1 : 0;\r\n            const existingFunctionNames = new Set(functions.map(f => f.name.toLowerCase()));\r\n            const fileFunctionNames = new Set<string>();\r\n\r\n            for (let i = startLine; i < lines.length; i++) {\r\n                const line = lines[i].trim();\r\n                if (!line) continue;\r\n\r\n                const separator = line.includes(';') ? ';' : ',';\r\n                const parts = line.split(separator).map(s => sanitizeCSVValue(s.replace(/^[\"']|[\"']$/g, '')));\r\n                const [name, description, lead, level] = parts;\r\n\r\n                if (!name || name.length < 2) {\r\n                    formatErrorCount++;\r\n                    continue;\r\n                }\r\n\r\n                const cleanName = name.trim();\r\n                const lowerName = cleanName.toLowerCase();\r\n\r\n                // Validation: Duplicate in file or database\r\n                if (fileFunctionNames.has(lowerName) || existingFunctionNames.has(lowerName)) {\r\n                    duplicateCount++;\r\n                    continue;\r\n                }\r\n\r\n                const canLeadValue = lead?.toLowerCase();\r\n                const canLeadTeam = canLeadValue === 'sim' || canLeadValue === 'true' || canLeadValue === '1' || canLeadValue === 's';\r\n                const levelValue = parseInt(level || '0') || 0;\r\n\r\n                try {\r\n                    await createFunction({\r\n                        name: cleanName,\r\n                        description: description || '',\r\n                        canLeadTeam,\r\n                        level: levelValue\r\n                    });\r\n                    importCount++;\r\n                    fileFunctionNames.add(lowerName);\r\n                } catch (error) {\r\n                    formatErrorCount++;\r\n                }\r\n            }\r\n\r\n            if (importCount > 0 || duplicateCount > 0 || formatErrorCount > 0) {\r\n                let description = `${importCount} funções importadas com sucesso.`;\r\n                if (duplicateCount > 0) description += ` ${duplicateCount} duplicadas ignoradas.`;\r\n                if (formatErrorCount > 0) description += ` ${formatErrorCount} com erros ignoradas.`;\r\n\r\n                toast({\r\n                    title: importCount > 0 ? 'Importação finalizada' : 'Falha na importação',\r\n                    description: description,\r\n                    variant: importCount > 0 ? 'default' : 'destructive'\r\n                });\r\n            }\r\n            e.target.value = '';\r\n        };\r\n\r\n        reader.onerror = () => {\r\n            toast({\r\n                title: 'Erro ao ler arquivo',\r\n                description: 'Não foi possível processar o arquivo.',\r\n                variant: 'destructive',\r\n            });\r\n            e.target.value = '';\r\n        };\r\n\r\n        reader.readAsText(file, 'UTF-8');\r\n    };\r\n\r\n    const downloadTemplate = () => {\r\n        const headers = ['Nome da Função', 'Descrição', 'Pode Liderar? (sim/nao)', 'Nível (Peso Hierárquico 0-100)'];\r\n        const examples = [\r\n            ['Encarregado', 'Líder de equipe de campo', 'sim', '6'],\r\n            ['Ajudante', 'Auxiliar em diversas tarefas', 'nao', '1']\r\n        ];\r\n\r\n        const csvContent = [\r\n            headers.join(';'),\r\n            ...examples.map(row => row.join(';'))\r\n        ].join('\\n');\r\n\r\n        const blob = new Blob([\"\\uFEFF\" + csvContent], { type: 'text/csv;charset=utf-8;' });\r\n        const link = document.createElement('a');\r\n        const url = URL.createObjectURL(blob);\r\n        link.setAttribute('href', url);\r\n        link.setAttribute('download', 'template_importacao_funcoes.csv');\r\n        link.style.visibility = 'hidden';\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n\r\n        toast({\r\n            title: 'Template baixado',\r\n            description: 'Preencha o arquivo para importar seus cargos.',\r\n        });\r\n    };\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n\r\n        if (!formData.name.trim()) {\r\n            toast({\r\n                title: 'Erro',\r\n                description: 'O nome da função é obrigatório',\r\n                variant: 'destructive',\r\n            });\r\n            return;\r\n        }\r\n\r\n        setIsSaving(true);\r\n\r\n        try {\r\n            if (editingFunction) {\r\n                const result = await updateFunction(editingFunction.id, formData);\r\n                if (result.success) {\r\n                    toast({\r\n                        title: 'Função atualizada!',\r\n                        description: `A função \"${formData.name}\" foi atualizada com sucesso.`,\r\n                    });\r\n                }\r\n            } else {\r\n                const result = await createFunction(formData);\r\n                if (result.success) {\r\n                    toast({\r\n                        title: 'Função criada!',\r\n                        description: `A função \"${formData.name}\" foi adicionada com sucesso.`,\r\n                    });\r\n                }\r\n            }\r\n            resetForm();\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    const handleDelete = async (func: { id: string; name: string }) => {\r\n        setConfirmModal({\r\n            open: true,\r\n            title: 'Excluir Função',\r\n            description: `Deseja realmente remover a função \"${func.name}\"? Esta ação não pode ser desfeita e pode afetar funcionários vinculados.`,\r\n            variant: 'destructive',\r\n            onConfirm: async () => {\r\n                const result = await deleteFunction(func.id);\r\n                if (result.success) {\r\n                    toast({\r\n                        title: 'Função removida',\r\n                        description: `A função \"${func.name}\" foi removida.`,\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    const handleEdit = (func: any) => {\r\n        setEditingFunction(func);\r\n        setFormData({\r\n            name: func.name,\r\n            description: func.description || '',\r\n            canLeadTeam: func.canLeadTeam,\r\n            level: func.level || 0,\r\n        });\r\n        setIsDialogOpen(true);\r\n    };\r\n\r\n    const resetForm = () => {\r\n        setFormData({ name: '', description: '', canLeadTeam: false, level: 0 });\r\n        setEditingFunction(null);\r\n        setIsDialogOpen(false);\r\n    };\r\n\r\n    const filteredFunctions = functions.filter(f =>\r\n        f.name.toLowerCase().includes(searchTerm.toLowerCase())\r\n    );\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center h-64\">\r\n                <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-fade-in\">\r\n            <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n                <div className=\"flex gap-2\">\r\n                    {(isProtectedSignal.value || can('functions.update')) && (\r\n                        <>\r\n                            <Button variant=\"outline\" onClick={() => fileInputRef.current?.click()}>\r\n                                <FileUp className=\"w-4 h-4 mr-2\" />\r\n                                Importar CSV\r\n                            </Button>\r\n                            <Button variant=\"outline\" onClick={downloadTemplate}>\r\n                                <FileDown className=\"w-4 h-4 mr-2\" />\r\n                                Baixar Template\r\n                            </Button>\r\n                            <input\r\n                                type=\"file\"\r\n                                ref={fileInputRef}\r\n                                className=\"hidden\"\r\n                                accept=\".csv\"\r\n                                onChange={handleFileUpload}\r\n                            />\r\n                        </>\r\n                    )}\r\n\r\n                    {(isProtectedSignal.value || can('functions.create')) && (\r\n                        <Dialog open={isDialogOpen} onOpenChange={(open) => {\r\n                            if (!open) resetForm();\r\n                            setIsDialogOpen(open);\r\n                        }}>\r\n                            <DialogTrigger asChild>\r\n                                <Button className=\"gradient-primary text-white shadow-glow\">\r\n                                    <Plus className=\"w-4 h-4 mr-2\" />\r\n                                    Nova Função\r\n                                </Button>\r\n                            </DialogTrigger>\r\n                            <DialogContent className=\"max-w-md\">\r\n                                <DialogHeader>\r\n                                    <DialogTitle className=\"flex items-center gap-2 text-2xl font-bold\">\r\n                                        <div className=\"w-10 h-10 rounded-lg gradient-primary flex items-center justify-center shadow-glow\">\r\n                                            <Briefcase className=\"text-white w-6 h-6\" />\r\n                                        </div>\r\n                                        {editingFunction ? 'Editar Função' : 'Nova Função'}\r\n                                    </DialogTitle>\r\n                                    <DialogDescription className=\"text-muted-foreground pt-1\">\r\n                                        Defina as atribuições e o nível hierárquico da função.\r\n                                    </DialogDescription>\r\n                                </DialogHeader>\r\n\r\n                                <form onSubmit={handleSubmit} className=\"space-y-6 pt-4\">\r\n                                    {/* Seção: Identificação */}\r\n                                    <div className=\"space-y-4\">\r\n                                        <div className=\"flex items-center gap-2 text-primary font-semibold text-sm uppercase tracking-wider\">\r\n                                            <Briefcase className=\"w-4 h-4\" />\r\n                                            Identificação\r\n                                        </div>\r\n                                        <Separator className=\"bg-white/10\" />\r\n\r\n                                        <div className=\"space-y-2\">\r\n                                            <Label htmlFor=\"name\" className=\"text-xs uppercase text-muted-foreground font-bold\">Nome da Função *</Label>\r\n                                            <Input\r\n                                                id=\"name\"\r\n                                                value={formData.name}\r\n                                                onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\r\n                                                placeholder=\"Ex: Engenheiro Civil\"\r\n                                                className=\"industrial-input h-10\"\r\n                                                required\r\n                                            />\r\n                                        </div>\r\n                                        <div className=\"space-y-2\">\r\n                                            <Label htmlFor=\"description\" className=\"text-xs uppercase text-muted-foreground font-bold\">Descrição</Label>\r\n                                            <Input\r\n                                                id=\"description\"\r\n                                                value={formData.description}\r\n                                                onChange={(e) => setFormData(prev => ({ ...prev, description: e.target.value }))}\r\n                                                placeholder=\"Breve descrição das responsabilidades\"\r\n                                                className=\"industrial-input h-10\"\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Seção: Configurações */}\r\n                                    <div className=\"space-y-4 pt-2\">\r\n                                        <div className=\"flex items-center gap-2 text-amber-500 font-semibold text-sm uppercase tracking-wider\">\r\n                                            <TrendingUp className=\"w-4 h-4\" />\r\n                                            Hierarquia e Liderança\r\n                                        </div>\r\n                                        <Separator className=\"bg-white/10\" />\r\n\r\n                                        <div className=\"flex items-center justify-between p-3 rounded-lg bg-white/5 border border-white/10\">\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                <Crown className=\"w-5 h-5 text-amber-500\" />\r\n                                                <div className=\"flex flex-col\">\r\n                                                    <Label htmlFor=\"canLeadTeam\" className=\"cursor-pointer font-bold text-sm\">Poder de Liderança</Label>\r\n                                                    <span className=\"text-[10px] text-muted-foreground\">Esta função pode gerenciar equipes de campo</span>\r\n                                                </div>\r\n                                            </div>\r\n                                            <Checkbox\r\n                                                id=\"canLeadTeam\"\r\n                                                checked={formData.canLeadTeam}\r\n                                                onCheckedChange={(checked) =>\r\n                                                    setFormData(prev => ({ ...prev, canLeadTeam: checked as boolean }))\r\n                                                }\r\n                                            />\r\n                                        </div>\r\n\r\n                                        <div className=\"space-y-2\">\r\n                                            <Label htmlFor=\"level\" className=\"text-xs uppercase text-muted-foreground font-bold flex items-center gap-2\">\r\n                                                Nível de Peso Hierárquico (0-100)\r\n                                            </Label>\r\n                                            <Input\r\n                                                id=\"level\"\r\n                                                type=\"number\"\r\n                                                min=\"0\"\r\n                                                max=\"100\"\r\n                                                value={formData.level}\r\n                                                onChange={(e) => setFormData(prev => ({ ...prev, level: parseInt(e.target.value) || 0 }))}\r\n                                                className=\"industrial-input h-10\"\r\n                                            />\r\n                                            <div className=\"flex items-start gap-2 bg-primary/5 p-2 rounded border border-primary/10\">\r\n                                                <TrendingUp className=\"w-3 h-3 text-primary mt-0.5\" />\r\n                                                <p className=\"text-[10px] text-muted-foreground leading-tight italic\">\r\n                                                    Define a importância da função para cálculos de produtividade e relatórios.\r\n                                                    Ex: Ajudante (1), Oficial (4), Encarregado (7), Engenheiro (10).\r\n                                                </p>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"pt-4 flex gap-3\">\r\n                                        <Button type=\"button\" variant=\"outline\" onClick={resetForm} className=\"flex-1 h-11\">\r\n                                            Cancelar\r\n                                        </Button>\r\n                                        <Button type=\"submit\" className=\"flex-1 h-11 gradient-primary shadow-glow\" disabled={isSaving}>\r\n                                            {isSaving ? <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> : null}\r\n                                            {editingFunction ? 'Salvar Alterações' : 'Criar Função'}\r\n                                        </Button>\r\n                                    </div>\r\n                                </form>\r\n                            </DialogContent>\r\n                        </Dialog>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Search */}\r\n            <div className=\"relative max-w-md\">\r\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n                <Input\r\n                    placeholder=\"Buscar funções...\"\r\n                    value={searchTerm}\r\n                    onChange={(e) => setSearchTerm(e.target.value)}\r\n                    className=\"pl-10 industrial-input\"\r\n                />\r\n            </div>\r\n\r\n            {/* Functions Grid */}\r\n            {filteredFunctions.length === 0 ? (\r\n                <Card className=\"glass-card\">\r\n                    <CardContent className=\"py-12 text-center\">\r\n                        <Briefcase className=\"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50\" />\r\n                        <h3 className=\"text-lg font-medium\">Nenhuma função encontrada</h3>\r\n                        <p className=\"text-muted-foreground mt-1\">\r\n                            {searchTerm ? 'Tente outro termo de busca' : 'Crie sua primeira função para começar'}\r\n                        </p>\r\n                    </CardContent>\r\n                </Card>\r\n            ) : (\r\n                <div className=\"grid sm:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                    {filteredFunctions.map((func) => (\r\n                        <Card key={func.id} className=\"glass-card hover:shadow-strong transition-all group\">\r\n                            <CardHeader className=\"pb-3\">\r\n                                <div className=\"flex items-start justify-between\">\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className=\"p-2 rounded-xl bg-primary/10\">\r\n                                            <Briefcase className=\"w-5 h-5 text-primary\" />\r\n                                        </div>\r\n                                        <div>\r\n                                            <CardTitle className=\"text-base flex items-center gap-2\">\r\n                                                {func.name}\r\n                                                {func.canLeadTeam && (\r\n                                                    <Crown className=\"w-4 h-4 text-yellow-500\" />\r\n                                                )}\r\n                                                <Badge variant=\"outline\" className=\"ml-auto text-[10px] bg-primary/5 border-primary/10\">\r\n                                                    Nível {func.level || 0}\r\n                                                </Badge>\r\n                                            </CardTitle>\r\n                                            {func.description && (\r\n                                                <CardDescription className=\"line-clamp-1\">\r\n                                                    {func.description}\r\n                                                </CardDescription>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </CardHeader>\r\n                            <CardContent className=\"pt-0\">\r\n                                <div className=\"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                    {(() => {\r\n                                        const canEdit = isProtectedSignal.value || can('functions.update');\r\n                                        const canDelete = isProtectedSignal.value || can('functions.delete');\r\n\r\n                                        if (!canEdit && !canDelete) {\r\n                                            return (\r\n                                                <div className=\"flex items-center justify-center w-full py-2 text-muted-foreground/30\" title=\"Sem permissão hierárquica\">\r\n                                                    <Lock className=\"w-4 h-4 mr-2\" />\r\n                                                    <span className=\"text-xs uppercase font-bold\">Somente Leitura</span>\r\n                                                </div>\r\n                                            );\r\n                                        }\r\n\r\n                                        return (\r\n                                            <>\r\n                                                {canEdit && (\r\n                                                    <Button\r\n                                                        variant=\"outline\"\r\n                                                        size=\"sm\"\r\n                                                        onClick={() => handleEdit(func)}\r\n                                                        className=\"flex-1\"\r\n                                                    >\r\n                                                        <Pencil className=\"w-4 h-4 mr-1\" />\r\n                                                        Editar\r\n                                                    </Button>\r\n                                                )}\r\n                                                {canDelete && (\r\n                                                    <Button\r\n                                                        variant=\"destructive\"\r\n                                                        size=\"sm\"\r\n                                                        onClick={() => handleDelete(func)}\r\n                                                        className=\"flex-1\"\r\n                                                    >\r\n                                                        <Trash2 className=\"w-4 h-4 mr-1\" />\r\n                                                        Remover\r\n                                                    </Button>\r\n                                                )}\r\n                                            </>\r\n                                        );\r\n                                    })()}\r\n                                </div>\r\n                            </CardContent>\r\n\r\n                        </Card>\r\n                    ))}\r\n                </div>\r\n            )}\r\n            {/* Confirmation Dialog */}\r\n            <ConfirmationDialog\r\n                open={confirmModal.open}\r\n                onOpenChange={(open) => setConfirmModal(prev => ({ ...prev, open }))}\r\n                title={confirmModal.title}\r\n                description={confirmModal.description}\r\n                onConfirm={confirmModal.onConfirm}\r\n                variant={confirmModal.variant}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\GAPO.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'BarChart3' is defined but never used.","line":9,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Activity' is defined but never used.","line":10,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TrendingUp' is defined but never used.","line":12,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Building2' is defined but never used.","line":18,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useWorkStages' is defined but never used.","line":28,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useGAPOAnalytics' is defined but never used.","line":30,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useProjects' is defined but never used.","line":31,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'GAPOProgressTracker' is defined but never used.","line":38,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'GAPOAnalyticsPanel' is defined but never used.","line":39,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'profile' is assigned a value but never used.","line":43,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'navigate' is assigned a value but never used.","line":59,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":19}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport {\r\n    LayoutDashboard,\r\n    History,\r\n    FileText,\r\n    BarChart3,\r\n    Activity,\r\n    ShieldCheck,\r\n    TrendingUp,\r\n    HardHat,\r\n    Download,\r\n    FileSpreadsheet,\r\n    Printer,\r\n    Filter as FilterIcon,\r\n    Building2\r\n} from 'lucide-react';\r\nimport { ProjectEmptyState } from '@/components/shared/ProjectEmptyState';\r\nimport { ProjectSelector } from '@/components/shared/ProjectSelector';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { Button } from '@/components/ui/button';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\n// Hooks\r\nimport { useWorkStages } from '@/hooks/useWorkStages';\r\nimport { useTimeRecords } from '@/hooks/useTimeRecords';\r\nimport { useGAPOAnalytics } from '@/hooks/useGAPOAnalytics';\r\nimport { useProjects } from '@/hooks/useProjects';\r\nimport { useSites } from '@/hooks/useSites';\r\nimport { useAuditStats } from '@/hooks/useAuditStats';\r\n\r\n// Specialized GAPO Components\r\nimport GAPOAuditDashboard from '@/components/gapo/GAPOAuditDashboard';\r\nimport GAPODocumentHub from '@/components/gapo/GAPODocumentHub';\r\nimport GAPOProgressTracker from '@/components/gapo/GAPOProgressTracker';\r\nimport GAPOAnalyticsPanel from '@/components/gapo/GAPOAnalyticsPanel';\r\nimport GAPOValidationList from '@/components/gapo/GAPOValidationList';\r\n\r\nexport default function GAPO() {\r\n    const { profile } = useAuth();\r\n    // State for Global Selector\r\n    const [selectedProjectId, setSelectedProjectId] = useState<string | null>(null);\r\n    const [selectedSiteId, setSelectedSiteId] = useState<string | null>(null);\r\n\r\n    const { sites } = useSites(selectedProjectId || undefined);\r\n\r\n    // Auto-select first site if available and none selected\r\n    useEffect(() => {\r\n        if (selectedProjectId && sites.length > 0 && !selectedSiteId) {\r\n            setSelectedSiteId(sites[0].id);\r\n        } else if (!selectedProjectId) {\r\n            setSelectedSiteId(null);\r\n        }\r\n    }, [selectedProjectId, sites, selectedSiteId]);\r\n\r\n    const navigate = useNavigate();\r\n    const { toast } = useToast();\r\n\r\n    // Stats hooks need context ideally, but for now global\r\n    const { records } = useTimeRecords();\r\n    const { pendingCount } = useAuditStats();\r\n\r\n    const handleExport = (type: string) => {\r\n        toast({\r\n            title: `Exportação ${type}`,\r\n            description: `A exportação do relatório em ${type} está sendo processada e será baixada em instantes.`,\r\n        });\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-fade-in p-2 md:p-6\">\r\n            <header className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n                <div className=\"flex flex-col md:flex-row md:items-center gap-4\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"p-2 rounded-xl bg-primary/10\">\r\n                            <ShieldCheck className=\"w-8 h-8 text-primary\" />\r\n                        </div>\r\n                        <div>\r\n                            <h1 className=\"text-3xl font-black font-display tracking-tight text-foreground uppercase\">\r\n                                Módulo GAPO\r\n                            </h1>\r\n                            <p className=\"text-muted-foreground text-xs font-medium italic\">\r\n                                Gestão, Auditoria e Performance de Obras\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex flex-col sm:flex-row gap-2 w-full md:w-auto\">\r\n                        <div className=\"w-full sm:w-[250px]\">\r\n                            <ProjectSelector\r\n                                value={selectedProjectId || ''}\r\n                                onValueChange={(val) => {\r\n                                    setSelectedProjectId(val === 'all' ? null : val);\r\n                                    setSelectedSiteId(null);\r\n                                }}\r\n                            />\r\n                        </div>\r\n                        {selectedProjectId && (\r\n                            <div className=\"w-full sm:w-[200px]\">\r\n                                <Select value={selectedSiteId || ''} onValueChange={setSelectedSiteId}>\r\n                                    <SelectTrigger className=\"bg-slate-900/50 border-white/10 h-10 text-[11px] font-bold uppercase tracking-wider rounded-xl\">\r\n                                        <SelectValue placeholder=\"Todos os Canteiros\" />\r\n                                    </SelectTrigger>\r\n                                    <SelectContent className=\"bg-slate-950 border-white/10\">\r\n                                        <SelectItem value=\"all_sites\" className=\"text-[11px] font-bold uppercase\">Todos os Canteiros</SelectItem>\r\n                                        {sites.map(s => (\r\n                                            <SelectItem key={s.id} value={s.id} className=\"text-[11px] font-bold uppercase\">{s.name}</SelectItem>\r\n                                        ))}\r\n                                    </SelectContent>\r\n                                </Select>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex flex-wrap items-center gap-2\">\r\n                    <Button\r\n                        variant=\"outline\"\r\n                        size=\"sm\"\r\n                        className=\"glass-card gap-2 text-[10px] font-black uppercase tracking-widest border-white/5 h-9\"\r\n                        onClick={() => handleExport('PDF')}\r\n                    >\r\n                        <Printer className=\"w-3.5 h-3.5 text-primary\" /> PDF\r\n                    </Button>\r\n                    <Button\r\n                        variant=\"outline\"\r\n                        size=\"sm\"\r\n                        className=\"glass-card gap-2 text-[10px] font-black uppercase tracking-widest border-white/5 h-9\"\r\n                        onClick={() => handleExport('EXCEL')}\r\n                    >\r\n                        <FileSpreadsheet className=\"w-3.5 h-3.5 text-emerald-500\" /> Excel\r\n                    </Button>\r\n                    <Button\r\n                        variant=\"outline\"\r\n                        size=\"sm\"\r\n                        className=\"glass-card gap-2 text-[10px] font-black uppercase tracking-widest border-white/5 h-9\"\r\n                    >\r\n                        <FilterIcon className=\"w-3.5 h-3.5 text-blue-500\" /> Filtros\r\n                    </Button>\r\n                    <div className=\"w-px h-6 bg-white/10 mx-1 hidden md:block\" />\r\n                    <Button\r\n                        size=\"sm\"\r\n                        className=\"gradient-primary gap-2 text-[10px] font-black uppercase tracking-widest h-9\"\r\n                    >\r\n                        <Download className=\"w-3.5 h-3.5\" /> Exportar Tudo\r\n                    </Button>\r\n                </div>\r\n            </header>\r\n\r\n            {!selectedProjectId ? (\r\n                <div className=\"flex-1 flex items-center justify-center min-h-[500px]\">\r\n                    <ProjectEmptyState\r\n                        type=\"generic\"\r\n                        title=\"GAPO: Selecione uma Obra\"\r\n                        description=\"Selecione um projeto acima para visualizar os dados de auditoria e performance.\"\r\n                    />\r\n                </div>\r\n            ) : (\r\n                <Tabs defaultValue=\"dashboard\" className=\"w-full\">\r\n                    <TabsList className=\"glass-card mb-8 p-1 flex justify-start overflow-x-auto gap-2 border-white/5\">\r\n                        <TabsTrigger value=\"dashboard\" className=\"gap-2 px-6 py-2\">\r\n                            <LayoutDashboard className=\"w-4 h-4\" /> Dashboard\r\n                        </TabsTrigger>\r\n                        <TabsTrigger value=\"audit\" className=\"gap-2 px-6 py-2\">\r\n                            <History className=\"w-4 h-4\" /> Auditoria Operacional\r\n                        </TabsTrigger>\r\n                        <TabsTrigger value=\"documents\" className=\"gap-2 px-6 py-2\">\r\n                            <FileText className=\"w-4 h-4\" /> Documentação\r\n                        </TabsTrigger>\r\n\r\n                    </TabsList>\r\n\r\n                    <TabsContent value=\"dashboard\" className=\"space-y-6\">\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n                            <Card className=\"glass-card\">\r\n                                <CardContent className=\"p-6\">\r\n                                    <div className=\"flex items-center gap-3 mb-2\">\r\n                                        <HardHat className=\"w-5 h-5 text-amber-500\" />\r\n                                        <span className=\"text-xs font-bold uppercase tracking-widest opacity-60\">Segurança (HH)</span>\r\n                                    </div>\r\n                                    <div className=\"text-4xl font-black tracking-tight\">{records.length}</div>\r\n                                    <p className=\"text-[10px] text-muted-foreground font-bold mt-1\">Total de registros de jornada</p>\r\n                                </CardContent>\r\n                            </Card>\r\n\r\n                            <Card className=\"glass-card\">\r\n                                <CardContent className=\"p-6\">\r\n                                    <div className=\"flex items-center gap-3 mb-2\">\r\n                                        <History className=\"w-5 h-5 text-primary\" />\r\n                                        <span className=\"text-xs font-bold uppercase tracking-widest opacity-60\">Auditorias Abertas</span>\r\n                                    </div>\r\n                                    <div className=\"text-4xl font-black tracking-tight\">\r\n                                        {String(pendingCount).padStart(2, '0')}\r\n                                    </div>\r\n                                    <p className=\"text-[10px] text-primary/80 font-bold mt-1\">Aguardando validação técnica</p>\r\n                                </CardContent>\r\n                            </Card>\r\n                        </div>\r\n\r\n                        <Card className=\"glass-card\">\r\n                            <CardHeader>\r\n                                <CardTitle>Visão Executiva GAPO</CardTitle>\r\n                                <CardDescription>Resumo de performance e governança para a diretoria.</CardDescription>\r\n                            </CardHeader>\r\n                            <CardContent className=\"p-6 border-t border-white/5\">\r\n                                <GAPOValidationList projectId={selectedProjectId || undefined} />\r\n                            </CardContent>\r\n                        </Card>\r\n                    </TabsContent>\r\n\r\n                    <TabsContent value=\"audit\">\r\n                        <GAPOAuditDashboard projectId={selectedProjectId || undefined} siteId={selectedSiteId || undefined} />\r\n                    </TabsContent>\r\n\r\n                    <TabsContent value=\"documents\">\r\n                        <GAPODocumentHub projectId={selectedProjectId} siteId={selectedSiteId} />\r\n                    </TabsContent>\r\n                </Tabs>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\Messages.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CardTitle' is defined but never used.","line":4,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CardDescription' is defined but never used.","line":4,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":67},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TabsContent' is defined but never used.","line":7,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Mail' is defined but never used.","line":20,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'RotateCcw' is defined but never used.","line":22,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":41}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { useMessages, SystemMessage, TicketStatus, TicketType } from '@/hooks/useMessages';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport {\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableHead,\r\n    TableHeader,\r\n    TableRow,\r\n} from '@/components/ui/table';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from '@/components/ui/dialog';\r\nimport {\r\n    Mail, Send, Inbox, Search, CheckCircle2, XCircle, Clock,\r\n    Ticket, FileText, Users, Wrench, MessageSquare, HelpCircle,\r\n    Eye, AlertCircle, Archive, RotateCcw, Reply\r\n} from 'lucide-react';\r\nimport { CreateTicketModal } from '@/components/tickets/CreateTicketModal';\r\nimport { isProtectedSignal, can } from '@/signals/authSignals';\r\n\r\n// Mapeamento de tipos para ícones e labels\r\nconst TYPE_CONFIG: Record<TicketType, { icon: React.ReactNode; label: string; color: string }> = {\r\n    'PASSWORD_RESET': { icon: <Clock className=\"w-4 h-4\" />, label: 'Senha', color: 'text-yellow-500 uppercase' },\r\n    'ADMINISTRATIVE': { icon: <FileText className=\"w-4 h-4\" />, label: 'Admin', color: 'text-blue-500 uppercase' },\r\n    'RH': { icon: <Users className=\"w-4 h-4\" />, label: 'RH', color: 'text-purple-500 uppercase' },\r\n    'OPERATIONAL': { icon: <Wrench className=\"w-4 h-4\" />, label: 'Operacional', color: 'text-orange-500 uppercase' },\r\n    'DIRECT': { icon: <MessageSquare className=\"w-4 h-4\" />, label: 'Direto', color: 'text-green-500 uppercase' },\r\n    'OTHER': { icon: <HelpCircle className=\"w-4 h-4\" />, label: 'Outro', color: 'text-gray-500 uppercase' },\r\n};\r\n\r\n// Mapeamento de status para badges\r\nconst STATUS_CONFIG: Record<TicketStatus, { label: string; variant: 'default' | 'outline'; className: string }> = {\r\n    'PENDING': { label: 'Pendente', variant: 'outline', className: 'text-yellow-500 uppercase border-yellow-500' },\r\n    'IN_ANALYSIS': { label: 'Em Análise', variant: 'outline', className: 'text-blue-500 uppercase border-blue-500' },\r\n    'AWAITING_RESPONSE': { label: 'Aguardando', variant: 'outline', className: 'text-orange-500 uppercase border-orange-500' },\r\n    'APPROVED': { label: 'Aprovado', variant: 'outline', className: 'text-green-500 uppercase border-green-500' },\r\n    'REJECTED': { label: 'Rejeitado', variant: 'outline', className: 'text-red-500 uppercase border-red-500' },\r\n    'CLOSED': { label: 'Finalizado', variant: 'outline', className: 'text-gray-500 uppercase border-gray-500' },\r\n};\r\n\r\nexport default function Messages() {\r\n    const { messages, isLoading, updateMessageStatus, approvePasswordReset, refresh } = useMessages();\r\n    const { profile, user } = useAuth();\r\n    const [search, setSearch] = useState('');\r\n    const [selectedMessage, setSelectedMessage] = useState<SystemMessage | null>(null);\r\n    const [activeTab, setActiveTab] = useState('inbox');\r\n    const [typeFilter, setTypeFilter] = useState<string>('all');\r\n    const [statusFilter, setStatusFilter] = useState<string>('all');\r\n\r\n    // Verificar se é SuperAdmin ou Role Corporativa\r\n    // Verificações via Signals\r\n    const isSuperAdmin = isProtectedSignal.value;\r\n    const isAdmin = isProtectedSignal.value || can('system.is_corporate');\r\n\r\n    // Filter messages\r\n    const filteredMessages = messages.filter(msg => {\r\n        // Filtro de busca\r\n        const matchesSearch = msg.subject.toLowerCase().includes(search.toLowerCase()) ||\r\n            msg.content.toLowerCase().includes(search.toLowerCase()) ||\r\n            (msg.senderEmail || '').toLowerCase().includes(search.toLowerCase());\r\n\r\n        // Filtro de tipo\r\n        const matchesType = typeFilter === 'all' || msg.type === typeFilter;\r\n\r\n        // Filtro de status\r\n        const matchesStatus = statusFilter === 'all' || msg.status === statusFilter;\r\n\r\n        // Lógica de Inbox: não mostrar mensagens enviadas por mim\r\n        // Roles que podem ver/aprovar PASSWORD_RESET: admin, ti_software, gestor_project, rh\r\n        const canSeePasswordReset = isAdmin || can('messages.approve_password');\r\n\r\n        const isInbox = activeTab === 'inbox' &&\r\n            msg.senderId !== profile?.id &&\r\n            msg.senderEmail !== user?.email && (\r\n                msg.recipientId === profile?.id ||\r\n                msg.recipientRole === profile?.role ||\r\n                msg.recipientRole === 'gestao' && canSeePasswordReset || // Gestão = admin, gestor_project, rh\r\n                (isAdmin && (msg.recipientRole === 'ADMIN' || msg.type === 'PASSWORD_RESET')) ||\r\n                (canSeePasswordReset && msg.type === 'PASSWORD_RESET') ||\r\n                isSuperAdmin\r\n            );\r\n\r\n        // Lógica de Enviados\r\n        const isSent = activeTab === 'sent' && (\r\n            msg.senderId === profile?.id ||\r\n            msg.senderEmail === user?.email\r\n        );\r\n\r\n        return matchesSearch && matchesType && matchesStatus && (isInbox || isSent);\r\n    });\r\n\r\n    const handleViewMessage = async (msg: SystemMessage) => {\r\n        setSelectedMessage(msg);\r\n        // Marcar como \"Em Análise\" se estiver pendente e for caixa de entrada\r\n        if (msg.status === 'PENDING' && activeTab === 'inbox') {\r\n            await updateMessageStatus(msg.id, 'IN_ANALYSIS');\r\n            refresh();\r\n        }\r\n    };\r\n\r\n    const handleStatusChange = async (newStatus: TicketStatus) => {\r\n        if (!selectedMessage) return;\r\n\r\n        // Se for aprovação de reset de senha, usar fluxo especial\r\n        if (selectedMessage.type === 'PASSWORD_RESET' && newStatus === 'APPROVED') {\r\n            const targetUserId = selectedMessage.senderId || selectedMessage.metadata?.userId;\r\n            if (targetUserId) {\r\n                await approvePasswordReset(selectedMessage.id, targetUserId);\r\n            } else {\r\n                await updateMessageStatus(selectedMessage.id, newStatus);\r\n            }\r\n        } else {\r\n            await updateMessageStatus(selectedMessage.id, newStatus);\r\n        }\r\n\r\n        refresh();\r\n        setSelectedMessage(null);\r\n    };\r\n\r\n    const getStatusBadge = (status: TicketStatus) => {\r\n        const config = STATUS_CONFIG[status] || { label: status, variant: 'outline' as const, className: '' };\r\n        return <Badge variant={config.variant} className={config.className}>{config.label}</Badge>;\r\n    };\r\n\r\n    const getTypeBadge = (type: TicketType) => {\r\n        const config = TYPE_CONFIG[type] || TYPE_CONFIG['OTHER'];\r\n        return (\r\n            <div className={`flex items-center gap-1 ${config.color}`}>\r\n                {config.icon}\r\n                <span className=\"text-xs\">{config.label}</span>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-fade-in p-4 pb-20 md:pb-4\">\r\n            <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold font-display uppercase tracking-wider flex items-center gap-2\">\r\n                        <Ticket className=\"w-6 h-6 text-primary\" />\r\n                        Central de Tickets\r\n                    </h1>\r\n                    <p className=\"text-muted-foreground\">Gerencie solicitações e comunicações formais.</p>\r\n                </div>\r\n                <CreateTicketModal onSuccess={refresh} />\r\n            </div>\r\n\r\n            <Card className=\"glass-card\">\r\n                <CardHeader className=\"pb-3\">\r\n                    <div className=\"flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\r\n                        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full md:w-auto\">\r\n                            <TabsList className=\"grid w-full grid-cols-2 md:w-auto\">\r\n                                <TabsTrigger value=\"inbox\" className=\"gap-2\"><Inbox className=\"w-4 h-4\" /> Caixa de Entrada</TabsTrigger>\r\n                                <TabsTrigger value=\"sent\" className=\"gap-2\"><Send className=\"w-4 h-4\" /> Enviados</TabsTrigger>\r\n                            </TabsList>\r\n                        </Tabs>\r\n\r\n                        <div className=\"flex flex-wrap items-center gap-2 w-full md:w-auto\">\r\n                            {/* Filtro de Tipo */}\r\n                            <Select value={typeFilter} onValueChange={setTypeFilter}>\r\n                                <SelectTrigger className=\"w-[130px] h-9\">\r\n                                    <SelectValue placeholder=\"Tipo\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"all\">Todos Tipos</SelectItem>\r\n                                    {Object.entries(TYPE_CONFIG).map(([key, config]) => (\r\n                                        <SelectItem key={key} value={key}>\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                {config.icon}\r\n                                                {config.label}\r\n                                            </div>\r\n                                        </SelectItem>\r\n                                    ))}\r\n                                </SelectContent>\r\n                            </Select>\r\n\r\n                            {/* Filtro de Status */}\r\n                            <Select value={statusFilter} onValueChange={setStatusFilter}>\r\n                                <SelectTrigger className=\"w-[130px] h-9\">\r\n                                    <SelectValue placeholder=\"Status\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"all\">Todos Status</SelectItem>\r\n                                    {Object.entries(STATUS_CONFIG).map(([key, config]) => (\r\n                                        <SelectItem key={key} value={key}>{config.label}</SelectItem>\r\n                                    ))}\r\n                                </SelectContent>\r\n                            </Select>\r\n\r\n                            {/* Busca */}\r\n                            <div className=\"relative flex-1 min-w-[200px]\">\r\n                                <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                                <Input\r\n                                    placeholder=\"Buscar...\"\r\n                                    value={search}\r\n                                    onChange={(e) => setSearch(e.target.value)}\r\n                                    className=\"pl-8 h-9 industrial-input\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </CardHeader>\r\n                <CardContent>\r\n                    <div className=\"rounded-md border border-border/50 overflow-hidden\">\r\n                        <Table>\r\n                            <TableHeader className=\"bg-muted/50\">\r\n                                <TableRow>\r\n                                    <TableHead className=\"w-[80px]\">Tipo</TableHead>\r\n                                    <TableHead className=\"w-[100px]\">Status</TableHead>\r\n                                    <TableHead>Assunto</TableHead>\r\n                                    <TableHead className=\"hidden md:table-cell\">\r\n                                        {activeTab === 'inbox' ? 'Remetente' : 'Destinatário'}\r\n                                    </TableHead>\r\n                                    <TableHead className=\"text-right w-[100px]\">Data</TableHead>\r\n                                </TableRow>\r\n                            </TableHeader>\r\n                            <TableBody>\r\n                                {isLoading ? (\r\n                                    <TableRow>\r\n                                        <TableCell colSpan={5} className=\"text-center py-8 text-muted-foreground\">\r\n                                            Carregando tickets...\r\n                                        </TableCell>\r\n                                    </TableRow>\r\n                                ) : filteredMessages.length === 0 ? (\r\n                                    <TableRow>\r\n                                        <TableCell colSpan={5} className=\"text-center py-8 text-muted-foreground\">\r\n                                            Nenhum ticket encontrado.\r\n                                        </TableCell>\r\n                                    </TableRow>\r\n                                ) : (\r\n                                    filteredMessages.map((msg) => (\r\n                                        <TableRow\r\n                                            key={msg.id}\r\n                                            className=\"cursor-pointer hover:bg-muted/50 transition-colors\"\r\n                                            onClick={() => handleViewMessage(msg)}\r\n                                        >\r\n                                            <TableCell>{getTypeBadge(msg.type)}</TableCell>\r\n                                            <TableCell>{getStatusBadge(msg.status)}</TableCell>\r\n                                            <TableCell className=\"font-medium\">\r\n                                                <div className=\"flex flex-col\">\r\n                                                    <span className=\"truncate max-w-[300px]\">{msg.subject}</span>\r\n                                                    <span className=\"text-xs text-muted-foreground md:hidden truncate max-w-[200px]\">\r\n                                                        {msg.content.substring(0, 50)}...\r\n                                                    </span>\r\n                                                </div>\r\n                                            </TableCell>\r\n                                            <TableCell className=\"hidden md:table-cell text-sm text-muted-foreground\">\r\n                                                {msg.sender?.full_name || msg.senderEmail || 'Sistema'}\r\n                                            </TableCell>\r\n                                            <TableCell className=\"text-right text-xs text-muted-foreground\">\r\n                                                {new Date(msg.createdAt).toLocaleDateString('pt-BR')}\r\n                                            </TableCell>\r\n                                        </TableRow>\r\n                                    ))\r\n                                )}\r\n                            </TableBody>\r\n                        </Table>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* Ticket Detail Dialog */}\r\n            <Dialog open={!!selectedMessage} onOpenChange={(open) => !open && setSelectedMessage(null)}>\r\n                <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\r\n                    <DialogHeader>\r\n                        <DialogTitle className=\"flex items-center gap-2\">\r\n                            {selectedMessage && getTypeBadge(selectedMessage.type)}\r\n                            <span className=\"truncate\">{selectedMessage?.subject}</span>\r\n                        </DialogTitle>\r\n                        <DialogDescription className=\"flex flex-wrap items-center gap-2 pt-2\">\r\n                            <span>De: {selectedMessage?.sender?.full_name || selectedMessage?.senderEmail || 'Anônimo'}</span>\r\n                            <span>•</span>\r\n                            <span>{selectedMessage && new Date(selectedMessage.createdAt).toLocaleString('pt-BR')}</span>\r\n                            <span>•</span>\r\n                            {selectedMessage && getStatusBadge(selectedMessage.status)}\r\n                        </DialogDescription>\r\n                    </DialogHeader>\r\n\r\n                    <div className=\"my-4 p-4 bg-muted/30 rounded-lg border border-border/50 min-h-[100px] whitespace-pre-wrap text-sm\">\r\n                        {selectedMessage?.content}\r\n                    </div>\r\n\r\n                    {selectedMessage?.metadata && Object.keys(selectedMessage.metadata).length > 0 && (\r\n                        <div className=\"mb-4 text-xs text-muted-foreground border-t pt-3\">\r\n                            <p className=\"font-semibold mb-2\">Informações Adicionais:</p>\r\n                            <div className=\"grid grid-cols-2 gap-2 bg-muted/20 p-2 rounded\">\r\n                                {Object.entries(selectedMessage.metadata).map(([key, value]) => (\r\n                                    <div key={key}>\r\n                                        <span className=\"font-medium\">{key}:</span> {String(value)}\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    <DialogFooter className=\"flex-wrap gap-2 sm:justify-between\">\r\n                        <div className=\"flex gap-2\">\r\n                            <Button variant=\"outline\" onClick={() => setSelectedMessage(null)}>\r\n                                Fechar\r\n                            </Button>\r\n                            {/* Botão Responder - Apenas para mensagens recebidas na Inbox */}\r\n                            {activeTab === 'inbox' && selectedMessage && selectedMessage.senderId && (\r\n                                <CreateTicketModal\r\n                                    replyTo={selectedMessage}\r\n                                    onSuccess={() => {\r\n                                        setSelectedMessage(null);\r\n                                        refresh();\r\n                                    }}\r\n                                    trigger={\r\n                                        <Button variant=\"secondary\" className=\"gap-2\">\r\n                                            <Reply className=\"w-4 h-4\" />\r\n                                            Responder\r\n                                        </Button>\r\n                                    }\r\n                                />\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Ações de Gestão - Admin, Gestor de Obra, RH podem aprovar PASSWORD_RESET */}\r\n                        {(() => {\r\n                            const canApprove = isAdmin || (selectedMessage?.type === 'PASSWORD_RESET' && can('messages.approve_password'));\r\n\r\n                            return canApprove && activeTab === 'inbox' && selectedMessage &&\r\n                                selectedMessage.status !== 'APPROVED' &&\r\n                                selectedMessage.status !== 'REJECTED' &&\r\n                                selectedMessage.status !== 'CLOSED' && (\r\n                                    <div className=\"flex flex-wrap gap-2\">\r\n                                        {selectedMessage.status === 'PENDING' && (\r\n                                            <Button\r\n                                                variant=\"outline\"\r\n                                                onClick={() => handleStatusChange('IN_ANALYSIS')}\r\n                                            >\r\n                                                <Eye className=\"w-4 h-4 mr-2\" />\r\n                                                Em Análise\r\n                                            </Button>\r\n                                        )}\r\n\r\n                                        <Button\r\n                                            variant=\"outline\"\r\n                                            onClick={() => handleStatusChange('AWAITING_RESPONSE')}\r\n                                        >\r\n                                            <AlertCircle className=\"w-4 h-4 mr-2\" />\r\n                                            Aguardar\r\n                                        </Button>\r\n\r\n                                        <Button\r\n                                            variant=\"destructive\"\r\n                                            onClick={() => handleStatusChange('REJECTED')}\r\n                                        >\r\n                                            <XCircle className=\"w-4 h-4 mr-2\" />\r\n                                            Rejeitar\r\n                                        </Button>\r\n\r\n                                        <Button\r\n                                            className=\"bg-green-600 hover:bg-green-700 text-white\"\r\n                                            onClick={() => handleStatusChange('APPROVED')}\r\n                                        >\r\n                                            <CheckCircle2 className=\"w-4 h-4 mr-2\" />\r\n                                            Aprovar\r\n                                        </Button>\r\n                                    </div>\r\n                                )\r\n                        })()}\r\n\r\n                        {/* Ação de Finalizar (para tickets já aprovados/rejeitados) */}\r\n                        {isAdmin && (selectedMessage?.status === 'APPROVED' || selectedMessage?.status === 'REJECTED') && (\r\n                            <Button\r\n                                variant=\"outline\"\r\n                                onClick={() => handleStatusChange('CLOSED')}\r\n                            >\r\n                                <Archive className=\"w-4 h-4 mr-2\" />\r\n                                Arquivar/Finalizar\r\n                            </Button>\r\n                        )}\r\n                    </DialogFooter>\r\n                </DialogContent>\r\n            </Dialog>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\NotFound.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\ProjectProgress.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'DeckGL' is defined but never used.","line":2,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ColumnLayer' is defined but never used.","line":4,"column":64,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":75},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Minimize2' is defined but never used.","line":15,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Plus' is defined but never used.","line":16,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Settings' is defined but never used.","line":18,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Trash2' is defined but never used.","line":19,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ChevronLeft' is defined but never used.","line":20,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ChevronRight' is defined but never used.","line":21,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'RotateCw' is defined but never used.","line":23,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Maximize' is defined but never used.","line":24,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'RotateCcw' is defined but never used.","line":25,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Settings2' is defined but never used.","line":27,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Database' is defined but never used.","line":30,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'MousePointerClick' is defined but never used.","line":33,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'LayoutDashboard' is defined but never used.","line":34,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Bug' is defined but never used.","line":35,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ChevronDown' is defined but never used.","line":36,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":16},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":127,"column":13,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":127,"endColumn":26,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[6012,6025],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6363,6366],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6363,6366],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6401,6404],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6401,6404],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":120,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":123,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6441,6444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6441,6444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":167,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":170,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6488,6491],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6488,6491],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isHeaderVisible' is assigned a value but never used.","line":225,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":225,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setIsHeaderVisible' is assigned a value but never used.","line":225,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":225,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setIsDebugMode' is assigned a value but never used.","line":234,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":234,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":235,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":235,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10126,10129],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10126,10129],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":238,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10252,10255],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10252,10255],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":288,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":288,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12111,12114],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12111,12114],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":291,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":291,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12228,12231],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12228,12231],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":307,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":307,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13020,13023],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13020,13023],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":323,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":323,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13732,13735],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13732,13735],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleFitToTowers'. Either include it or remove the dependency array.","line":342,"column":8,"nodeType":"ArrayExpression","endLine":342,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [handleFitToTowers, selectedProjectId]","fix":{"range":[14399,14418],"text":"[handleFitToTowers, selectedProjectId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":374,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":374,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15759,15762],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15759,15762],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":426,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":426,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17768,17771],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17768,17771],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleTowerRightClick' is assigned a value but never used.","line":494,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":494,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":494,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":494,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20498,20501],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20498,20501],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":526,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":526,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21565,21568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21565,21568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":538,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":538,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21941,21944],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21941,21944],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":630,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":630,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26686,26689],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26686,26689],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":631,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":631,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26813,26816],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26813,26816],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":681,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":681,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28433,28436],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28433,28436],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":682,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":682,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28472,28475],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28472,28475],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":683,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":683,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28510,28513],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28510,28513],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":739,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":739,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32114,32117],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32114,32117],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":740,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":740,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32178,32181],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32178,32181],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":939,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":939,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43595,43598],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43595,43598],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":953,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":953,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[44079,44082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[44079,44082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":958,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":958,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[44370,44373],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[44370,44373],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'info' is defined but never used.","line":984,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":984,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'event' is defined but never used.","line":984,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":984,"endColumn":42},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":994,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":994,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[46076,46079],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[46076,46079],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'d' is defined but never used.","line":1084,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":1084,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'d' is defined but never used.","line":1085,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":1085,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1132,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1132,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[52519,52522],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[52519,52522],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1167,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1167,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[54301,54304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[54301,54304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1177,"column":96,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1177,"endColumn":99,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[54923,54926],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[54923,54926],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'anchorPlates', 'handleTowerClick', 'lastClickTime', and 'spacers'. Either include them or remove the dependency array.","line":1183,"column":8,"nodeType":"ArrayExpression","endLine":1183,"endColumn":167,"suggestions":[{"desc":"Update the dependencies array to be: [viewState.zoom, towers, scale, cables, spacers, anchorPlates, debugPoints, hiddenTowers, individualAltitudes, towerElevation, lastClickTime, isDebugMode, handleTowerClick, selectedStartTower]","fix":{"range":[55103,55262],"text":"[viewState.zoom, towers, scale, cables, spacers, anchorPlates, debugPoints, hiddenTowers, individualAltitudes, towerElevation, lastClickTime, isDebugMode, handleTowerClick, selectedStartTower]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1252,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1252,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[59432,59435],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[59432,59435],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1256,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1256,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[59855,59858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[59855,59858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1423,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1423,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[71840,71843],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[71840,71843],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":58,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo, useEffect, useRef, useCallback } from 'react';\r\nimport DeckGL from '@deck.gl/react';\r\nimport { Map as ReactMap, Source, useControl, useMap } from 'react-map-gl/mapbox';\r\nimport { ScatterplotLayer, TextLayer, PathLayer, PolygonLayer, ColumnLayer } from '@deck.gl/layers';\r\nimport { ScenegraphLayer } from '@deck.gl/mesh-layers';\r\nimport { MapboxOverlay } from '@deck.gl/mapbox';\r\nimport { Slider } from \"@/components/ui/slider\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport {\r\n    Info,\r\n    Layers,\r\n    List,\r\n    Loader2,\r\n    Maximize2,\r\n    Minimize2,\r\n    Plus,\r\n    Save,\r\n    Settings,\r\n    Trash2,\r\n    ChevronLeft,\r\n    ChevronRight,\r\n    Navigation,\r\n    RotateCw,\r\n    Maximize,\r\n    RotateCcw,\r\n    Zap,\r\n    Settings2,\r\n    Boxes,\r\n    X,\r\n    Database,\r\n    RefreshCw,\r\n    Link2,\r\n    MousePointerClick,\r\n    LayoutDashboard,\r\n    Bug,\r\n    ChevronDown\r\n} from 'lucide-react';\r\nimport 'mapbox-gl/dist/mapbox-gl.css';\r\nimport { Toaster } from \"@/components/ui/toaster\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { ExcelDataUploader } from \"@/components/map/ExcelDataUploader\";\r\nimport { CatenaryCalculator } from \"@/services/catenary-calculator\";\r\nimport { ORION_SEQUENCE } from \"@/data/orion-sequence\";\r\nimport { orionApi } from \"@/integrations/orion/client\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { CableConfigModal, PhaseConfig } from \"@/components/map/CableConfigModal\";\r\nimport { TowerDetailsModals } from \"@/components/map/TowerDetailsModals\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { usePermissions } from \"@/hooks/usePermissions\";\r\n\r\n// Types & Interfaces\r\nexport interface Tower {\r\n    id: string;\r\n    name: string;\r\n    coordinates: {\r\n        lat: number;\r\n        lng: number;\r\n        altitude: number;\r\n    };\r\n    type?: string;\r\n    elementType?: string;\r\n    metadata?: Record<string, unknown>;\r\n    displaySettings?: {\r\n        groundElevation?: number;\r\n    };\r\n    isLocal?: boolean;\r\n    isHidden?: boolean;\r\n}\r\n\r\nexport interface Cable {\r\n    from: number;\r\n    to: number;\r\n    path: [number, number, number][];\r\n    color: number[];\r\n    phase: string;\r\n    width: number;\r\n}\r\n\r\nexport interface Spacer {\r\n    path: [number, number, number][];\r\n    color: number[];\r\n    thickness: number;\r\n    phaseId: string;\r\n}\r\n\r\nexport interface AnchorPlate {\r\n    polygon: [number, number, number][];\r\n}\r\n\r\n// Default Phase Configuration\r\n// Default Phase Configuration - Aligned with Standard Double-Circuit Lattice Towers\r\nexport const DEFAULT_PHASES: PhaseConfig[] = [\r\n    { id: 'OPGW_L', name: 'OPGW (Esquerda)', enabled: true, color: [203, 213, 225], tension: 1200, verticalOffset: 40, horizontalOffset: -4, relativeHeight: 100, cableCount: 1, bundleSpacing: 0.4, width: 0.1, spacerInterval: 0, spacerSize: 1.1, spacerThickness: 0.15, spacerColor: [20, 20, 20], cableType: '' },\r\n    { id: 'OPGW_R', name: 'OPGW (Direita)', enabled: true, color: [203, 213, 225], tension: 1200, verticalOffset: 40, horizontalOffset: 4, relativeHeight: 100, cableCount: 1, bundleSpacing: 0.4, width: 0.1, spacerInterval: 0, spacerSize: 1.1, spacerThickness: 0.15, spacerColor: [20, 20, 20], cableType: '' },\r\n\r\n    // Left Circuit\r\n    { id: 'A_L', name: 'Fase A (Esq Superior)', enabled: true, color: [148, 163, 184], tension: 1800, verticalOffset: 33, horizontalOffset: -6, relativeHeight: 100, cableCount: 4, bundleSpacing: 0.4, width: 0.15, spacerInterval: 30, spacerSize: 1.1, spacerThickness: 0.2, spacerColor: [20, 20, 20], cableType: '' },\r\n    { id: 'B_L', name: 'Fase B (Esq Média)', enabled: true, color: [203, 213, 225], tension: 1800, verticalOffset: 25, horizontalOffset: -6, relativeHeight: 100, cableCount: 4, bundleSpacing: 0.4, width: 0.15, spacerInterval: 30, spacerSize: 1.1, spacerThickness: 0.2, spacerColor: [20, 20, 20], cableType: '' },\r\n    { id: 'C_L', name: 'Fase C (Esq Inferior)', enabled: true, color: [71, 85, 105], tension: 1800, verticalOffset: 17, horizontalOffset: -6, relativeHeight: 100, cableCount: 4, bundleSpacing: 0.4, width: 0.15, spacerInterval: 30, spacerSize: 1.1, spacerThickness: 0.2, spacerColor: [20, 20, 20], cableType: '' },\r\n\r\n    // Right Circuit\r\n    { id: 'A_R', name: 'Fase A (Dir Superior)', enabled: true, color: [148, 163, 184], tension: 1800, verticalOffset: 33, horizontalOffset: 6, relativeHeight: 100, cableCount: 4, bundleSpacing: 0.4, width: 0.15, spacerInterval: 30, spacerSize: 1.1, spacerThickness: 0.2, spacerColor: [20, 20, 20], cableType: '' },\r\n    { id: 'B_R', name: 'Fase B (Dir Média)', enabled: true, color: [203, 213, 225], tension: 1800, verticalOffset: 25, horizontalOffset: 6, relativeHeight: 100, cableCount: 4, bundleSpacing: 0.4, width: 0.15, spacerInterval: 30, spacerSize: 1.1, spacerThickness: 0.2, spacerColor: [20, 20, 20], cableType: '' },\r\n    { id: 'C_R', name: 'Fase C (Dir Inferior)', enabled: true, color: [71, 85, 105], tension: 1800, verticalOffset: 17, horizontalOffset: 6, relativeHeight: 100, cableCount: 4, bundleSpacing: 0.4, width: 0.15, spacerInterval: 30, spacerSize: 1.1, spacerThickness: 0.2, spacerColor: [20, 20, 20], cableType: '' },\r\n\r\n    { id: 'N', name: 'Neutro / Aux', enabled: false, color: [203, 213, 225], tension: 1000, verticalOffset: 12, horizontalOffset: 0, relativeHeight: 100, cableCount: 1, bundleSpacing: 0.4, width: 0.1, spacerInterval: 0, spacerSize: 1.1, spacerThickness: 0.2, spacerColor: [20, 20, 20], cableType: '' },\r\n];\r\n\r\n// Token Access\r\nconst MAPBOX_TOKEN = import.meta.env.VITE_MAPEBOX_API_KEY;\r\n\r\n// Model URL\r\nconst TOWER_MODEL_URL = `${window.location.origin}/models/towers/scene.gltf`;\r\n\r\nconst INITIAL_VIEW_STATE = {\r\n    longitude: -51.9253, // Brazil Center-ish\r\n    latitude: -14.2350,\r\n    zoom: 4,\r\n    pitch: 45,\r\n    bearing: 0\r\n};\r\n\r\nfunction DeckGLOverlay(props: Record<string, unknown>) {\r\n    const overlay = useControl<MapboxOverlay>(\r\n        () => new MapboxOverlay(props),\r\n        {\r\n            // @ts-ignore\r\n            interleaved: true\r\n        }\r\n    );\r\n\r\n    useEffect(() => {\r\n        if (overlay) overlay.setProps(props);\r\n    }, [props, overlay]);\r\n\r\n    return null;\r\n}\r\n\r\nfunction TerrainManager() {\r\n    const { current: map } = useMap();\r\n\r\n    useEffect(() => {\r\n        if (!map) return;\r\n        const m = (map as Record<string, any>).getMap ? (map as Record<string, any>).getMap() : (map as Record<string, any>).default?.getMap ? (map as Record<string, any>).default.getMap() : null;\r\n        if (!m) return;\r\n\r\n        const applyTerrain = () => {\r\n            if (!m.getSource('mapbox-dem')) return false;\r\n            try {\r\n                m.setTerrain({ source: 'mapbox-dem', exaggeration: 1.0 });\r\n                // Force a snap after terrain is applied\r\n                setTimeout(() => {\r\n                    window.dispatchEvent(new CustomEvent('terrain-ready'));\r\n                }, 1000);\r\n                return true;\r\n            } catch (e) {\r\n                console.warn(\"Mapbox terrain application failed:\", e);\r\n                return false;\r\n            }\r\n        };\r\n\r\n        // Attempt initial apply\r\n        if (!applyTerrain()) {\r\n            // If source not ready, listen for data events\r\n            const onData = (e: { sourceId: string, isSourceLoaded: boolean }) => {\r\n                if (e.sourceId === 'mapbox-dem' && e.isSourceLoaded) {\r\n                    if (applyTerrain()) {\r\n                        m.off('sourcedata', onData);\r\n                    }\r\n                }\r\n            };\r\n            m.on('sourcedata', onData);\r\n\r\n            // Fallback: check style load too\r\n            m.on('style.load', applyTerrain);\r\n        }\r\n\r\n        return () => {\r\n            if (m.getTerrain()) {\r\n                try {\r\n                    m.setTerrain(null);\r\n                } catch (e) {\r\n                    console.warn(\"Mapbox terrain cleanup failed:\", e);\r\n                }\r\n            }\r\n        };\r\n    }, [map]);\r\n\r\n    return null;\r\n}\r\n\r\nexport default function ProjectProgress() { // OrioN 3D Map Component\r\n    const [viewState, setViewState] = useState(INITIAL_VIEW_STATE);\r\n    const viewStateRef = useRef(viewState);\r\n    const { toast: showToast } = useToast();\r\n\r\n    // Keep ref updated for event handlers without triggering re-effects\r\n    useEffect(() => {\r\n        viewStateRef.current = viewState;\r\n    }, [viewState]);\r\n\r\n    const [towers, setTowers] = useState<Tower[]>([]);\r\n    const towersRef = useRef(towers);\r\n    useEffect(() => { towersRef.current = towers; }, [towers]);\r\n\r\n    const [cables, setCables] = useState<Cable[]>([]);\r\n    const [spacers, setSpacers] = useState<Spacer[]>([]);\r\n    const [anchorPlates, setAnchorPlates] = useState<AnchorPlate[]>([]);\r\n    const [scale, setScale] = useState<number>(50);\r\n    const mapRef = useRef<Record<string, unknown> | null>(null);\r\n\r\n    // Split Menu States\r\n    const [showTowerMenu, setShowTowerMenu] = useState<boolean>(false);\r\n    const [showCableMenu, setShowCableMenu] = useState<boolean>(false);\r\n\r\n    const [hiddenTowers, setHiddenTowers] = useState<Set<number>>(new Set());\r\n    const [connections, setConnections] = useState<{ from: string, to: string }[]>([]);\r\n    const connectionsRef = useRef(connections);\r\n    useEffect(() => { connectionsRef.current = connections; }, [connections]);\r\n\r\n    // Persistence State\r\n    const [projects, setProjects] = useState<{ id: string, name: string }[]>([]);\r\n    const [selectedProjectId, setSelectedProjectId] = useState<string | null>(null);\r\n    const [isSaving, setIsSaving] = useState(false);\r\n    const [isHeaderVisible, setIsHeaderVisible] = useState(true);\r\n    const [isFullScreen, setIsFullScreen] = useState(false);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    // Manual Connection State\r\n    const [isConnectMode, setIsConnectMode] = useState(false);\r\n    const [selectedStartTower, setSelectedStartTower] = useState<number | null>(null);\r\n\r\n    // Debug Mode State\r\n    const [isDebugMode, setIsDebugMode] = useState(false);\r\n    const [debugPoints, setDebugPoints] = useState<any[]>([]);\r\n\r\n    // Tower Selection for Details\r\n    const [selectedTowerForDetails, setSelectedTowerForDetails] = useState<any | null>(null);\r\n    const [isTowerModalOpen, setIsTowerModalOpen] = useState(false);\r\n    const [isQuickInfoOpen, setIsQuickInfoOpen] = useState(false);\r\n    const [lastClickTime, setLastClickTime] = useState(0);\r\n\r\n    // Global Offsets\r\n    const [towerElevation, setTowerElevation] = useState<number>(4.0);\r\n    const [individualAltitudes, setIndividualAltitudes] = useState<Record<string, number>>({});\r\n\r\n    const { can } = usePermissions();\r\n    const canEdit = can('map.edit');\r\n    const canManage = can('map.manage');\r\n\r\n    // Phase Configuration State\r\n    const [phases, setPhases] = useState<PhaseConfig[]>(() => {\r\n        const saved = localStorage.getItem('orion-cable-config');\r\n        return saved ? JSON.parse(saved) : DEFAULT_PHASES;\r\n    });\r\n\r\n    // Fetch projects on mount\r\n    useEffect(() => {\r\n        const fetchProjects = async () => {\r\n            const { data, error } = await orionApi.from('projects').select('id, name').order('name');\r\n            if (!error && data) {\r\n                setProjects(data as { id: string, name: string }[]);\r\n            }\r\n        };\r\n        fetchProjects();\r\n    }, []);\r\n\r\n    // Load project data when selected\r\n    useEffect(() => {\r\n        if (!selectedProjectId) return;\r\n\r\n        const loadProjectData = async () => {\r\n            setIsLoading(true);\r\n            setTowers([]);\r\n            setCables([]);\r\n            setConnections([]);\r\n            setIndividualAltitudes({});\r\n            setHiddenTowers(new Set());\r\n\r\n            try {\r\n                // 1. Load Towers\r\n                const { data: towerData, error: towerError } = await orionApi\r\n                    .from('tower_technical_data')\r\n                    .select('*')\r\n                    .eq('projectId', selectedProjectId)\r\n                    .order('sequence');\r\n\r\n                let mappedTowers: any[] = [];\r\n\r\n                if (!towerError && towerData) {\r\n                    mappedTowers = towerData.map((t: any) => ({\r\n                        id: t.id,\r\n                        name: t.name || t.externalId,\r\n                        coordinates: {\r\n                            lat: Number(t.latitude),\r\n                            lng: Number(t.longitude),\r\n                            altitude: Number(t.elevation || 0)\r\n                        },\r\n                        type: t.type || t.elementType, // PREFER 'type' COLUMN\r\n                        elementType: t.elementType,\r\n                        metadata: t.metadata || {}\r\n                    }));\r\n                    setTowers(mappedTowers);\r\n\r\n                    // Restore individual altitudes from metadata if present\r\n                    const restoredAlts: Record<string, number> = {};\r\n                    towerData.forEach((t: any) => {\r\n                        if (t.displaySettings?.groundElevation) {\r\n                            restoredAlts[t.name || t.externalId] = t.displaySettings.groundElevation;\r\n                        }\r\n                    });\r\n                    setIndividualAltitudes(restoredAlts);\r\n                }\r\n\r\n                // 2. Load Global Settings\r\n                const { data: settingsData } = await orionApi\r\n                    .from('Project3dCableSettings')\r\n                    .select('settings')\r\n                    .eq('projectId', selectedProjectId)\r\n                    .maybeSingle();\r\n\r\n                if (settingsData?.settings) {\r\n                    const s = settingsData.settings as any;\r\n                    if (s.scale) setScale(s.scale);\r\n                    if (s.towerElevation) setTowerElevation(s.towerElevation);\r\n                    if (s.phases) setPhases(s.phases);\r\n                    if (s.connections) setConnections(s.connections);\r\n                }\r\n\r\n                // Trigger Auto-Zoom after data is ready\r\n                if (mappedTowers.length > 0) {\r\n                    setTimeout(() => {\r\n                        handleFitToTowers(mappedTowers);\r\n                    }, 800);\r\n                }\r\n            } finally {\r\n                setIsLoading(false);\r\n            }\r\n        };\r\n\r\n        loadProjectData();\r\n    }, [selectedProjectId]);\r\n\r\n    const handleSaveConfig = useCallback(async (isAuto = false) => {\r\n        if (!selectedProjectId) return;\r\n        setIsSaving(true);\r\n        try {\r\n            // 1. Save Global Settings & Connections\r\n            await orionApi.from('Project3dCableSettings').upsert({\r\n                projectId: selectedProjectId,\r\n                settings: {\r\n                    scale,\r\n                    towerElevation,\r\n                    phases,\r\n                    connections,\r\n                    updatedAt: new Date().toISOString()\r\n                }\r\n            });\r\n\r\n            // 2. Save Tower Data - Batch POST (Upsert)\r\n            const towersToUpdate = towers.map((t, index) => {\r\n                const groundElevation = individualAltitudes[t.name];\r\n                return {\r\n                    projectId: selectedProjectId,\r\n                    externalId: t.name,\r\n                    name: t.name,\r\n                    elementType: t.elementType || 'TOWER',\r\n                    type: t.type, // PERSIST THE SPECIFIC TYPE\r\n                    latitude: t.coordinates.lat,\r\n                    longitude: t.coordinates.lng,\r\n                    elevation: t.coordinates.altitude,\r\n                    sequence: index,\r\n                    displaySettings: {\r\n                        ...((t.metadata as Record<string, any>)?.displaySettings || t.displaySettings || {}),\r\n                        groundElevation\r\n                    } as Record<string, unknown>,\r\n                    metadata: t.metadata || {}\r\n                };\r\n            });\r\n\r\n            if (towersToUpdate.length > 0) {\r\n                const { error: towerError } = await orionApi.from('tower_technical_data').insert(towersToUpdate);\r\n                if (towerError) throw new Error(towerError.message);\r\n            }\r\n\r\n            if (!isAuto) {\r\n                showToast({ title: \"Sucesso! 💾\", description: \"Configurações da obra foram salvas.\" });\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Save error:\", error);\r\n            if (!isAuto) {\r\n                showToast({ title: \"Erro ao salvar\", description: \"Não foi possível persistir os dados.\", variant: \"destructive\" });\r\n            }\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    }, [scale, towerElevation, phases, connections, individualAltitudes, selectedProjectId, towers, showToast]);\r\n\r\n    // Auto-Save Effect\r\n    useEffect(() => {\r\n        if (!selectedProjectId || towers.length === 0) return;\r\n\r\n        const timer = setTimeout(() => {\r\n            handleSaveConfig(true);\r\n        }, 3000); // 3 seconds debounce\r\n\r\n        return () => clearTimeout(timer);\r\n    }, [scale, towerElevation, phases, connections, individualAltitudes, selectedProjectId, towers, handleSaveConfig]);\r\n\r\n\r\n    // Persist phases\r\n    useEffect(() => {\r\n        localStorage.setItem('orion-cable-config', JSON.stringify(phases));\r\n    }, [phases]);\r\n\r\n    // Toggle Handlers\r\n    const toggleTowerMenu = () => {\r\n        setShowTowerMenu(!showTowerMenu);\r\n        if (!showTowerMenu) setShowCableMenu(false); // Close other menu\r\n    };\r\n    const toggleCableMenu = () => {\r\n        setShowCableMenu(!showCableMenu);\r\n        if (!showCableMenu) setShowTowerMenu(false); // Close other menu\r\n    };\r\n\r\n    const handleTowerClick = (info: { object?: any, coordinate?: number[] }, index: number) => {\r\n        if (isDebugMode) {\r\n            console.log(\"Picking Coord Raw:\", info.coordinate);\r\n\r\n            // Try to extract 3D coordinates.\r\n            // If z is missing or exactly 0 (ground level), try to fallback to the tower's base altitude.\r\n            const [lng, lat, rawZ] = info.coordinate || [0, 0, 0];\r\n            const towerBaseAlt = info.object?.coordinates?.altitude || 0;\r\n\r\n            // Heuristic: If we clicked the tower but Z is 0 or very close to it,\r\n            // and the tower itself is higher than 0, we're likely missing the Z-picking data.\r\n            const finalZ = (rawZ > 0.01) ? rawZ : towerBaseAlt + towerElevation;\r\n\r\n            const point = {\r\n                position: [lng, lat, finalZ + 0.2], // Tiny offset to prevent clipping\r\n                id: Date.now()\r\n            };\r\n\r\n            setDebugPoints(prev => [...prev, point]);\r\n            showToast({\r\n                title: \"Ponto de Debug Adicionado\",\r\n                description: \"Posição capturada no topo da estrutura.\",\r\n                className: \"bg-red-950/80 border-red-500/50 text-red-200 backdrop-blur-md\"\r\n            });\r\n            return;\r\n        }\r\n\r\n        if (!isConnectMode) {\r\n            setSelectedTowerForDetails(info.object);\r\n            setIsQuickInfoOpen(true);\r\n            setIsTowerModalOpen(false);\r\n            console.log(\"Clicked Tower (Quick Info):\", info.object);\r\n            return;\r\n        }\r\n\r\n        if (selectedStartTower === null) {\r\n            setSelectedStartTower(index);\r\n            showToast({\r\n                title: \"Início Selecionado\",\r\n                description: `Selecione a próxima torre para conectar com ${info.object.name}.`,\r\n                className: \"bg-blue-950/50 border-blue-900 text-blue-200\"\r\n            });\r\n        } else {\r\n            if (selectedStartTower === index) {\r\n                setSelectedStartTower(null);\r\n                return;\r\n            }\r\n\r\n            const startTower = towers[selectedStartTower];\r\n            const endTower = towers[index];\r\n            const newConn = { from: startTower.name, to: endTower.name };\r\n\r\n            setConnections(prev => {\r\n                const filtered = prev.filter(c => c.from !== startTower.name);\r\n                return [...filtered, newConn];\r\n            });\r\n\r\n            showToast({\r\n                title: \"Conexão Atualizada! 🔗\",\r\n                description: `${startTower.name} ➡️ ${endTower.name}`,\r\n                className: \"bg-emerald-950/50 border-emerald-900 text-emerald-200\"\r\n            });\r\n\r\n            setSelectedStartTower(null);\r\n        }\r\n    };\r\n\r\n\r\n    const handleTowerRightClick = (info: { object?: any }) => {\r\n        if (info.object && !isDebugMode) {\r\n            setSelectedTowerForDetails(info.object);\r\n            setIsTowerModalOpen(true);\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    const toggleTowerVisibility = (index: number) => {\r\n        const newHidden = new Set(hiddenTowers);\r\n        if (newHidden.has(index)) {\r\n            newHidden.delete(index);\r\n        } else {\r\n            newHidden.add(index);\r\n        }\r\n        setHiddenTowers(newHidden);\r\n    };\r\n\r\n    const handleFitToTowers = (towersData?: Tower[]) => {\r\n        const dataToFit = towersData || towers;\r\n        if (dataToFit.length === 0) return;\r\n\r\n        console.log(\"Fitting to towers:\", dataToFit.length);\r\n        const lngs = dataToFit.map(t => t.coordinates.lng);\r\n        const lats = dataToFit.map(t => t.coordinates.lat);\r\n\r\n        const minLng = Math.min(...lngs);\r\n        const maxLng = Math.max(...lngs);\r\n        const minLat = Math.min(...lats);\r\n        const maxLat = Math.max(...lats);\r\n\r\n        const map = (mapRef.current as any)?.getMap();\r\n        if (map) {\r\n            map.fitBounds(\r\n                [[minLng, minLat], [maxLng, maxLat]],\r\n                { padding: 80, duration: 2500, essential: true }\r\n            );\r\n        }\r\n    };\r\n\r\n\r\n    const lastSnapTime = useRef<number>(0);\r\n    const handleSnapToTerrain = useCallback((silent = false) => {\r\n        const map = (mapRef.current as any)?.getMap();\r\n        if (!map) return;\r\n\r\n        // Debounce: Don't snap more than once every 3 seconds\r\n        const now = Date.now();\r\n        if (now - lastSnapTime.current < 3000) return;\r\n        lastSnapTime.current = now;\r\n\r\n        const newAlts: Record<string, number> = { ...individualAltitudes };\r\n        const bounds = map.getBounds();\r\n        let successCount = 0;\r\n        let changed = false;\r\n\r\n        towersRef.current.forEach(tower => {\r\n            // Process only towers within the current viewport bounds\r\n            if (!bounds.contains([tower.coordinates.lng, tower.coordinates.lat])) return;\r\n\r\n            const elevation = map.queryTerrainElevation([tower.coordinates.lng, tower.coordinates.lat]);\r\n            if (elevation !== null && elevation !== undefined) {\r\n                if (newAlts[tower.name] !== elevation) {\r\n                    newAlts[tower.name] = elevation;\r\n                    successCount++;\r\n                    changed = true;\r\n                }\r\n            }\r\n        });\r\n\r\n        if (changed) {\r\n            setIndividualAltitudes(newAlts);\r\n            if (!silent) {\r\n                showToast({\r\n                    title: \"Auto-Alinhamento Concluído 🛰️\",\r\n                    description: `${successCount} torres ajustadas ao relevo do terreno.`,\r\n                    className: \"bg-emerald-950/80 border-emerald-500/50 text-emerald-100 backdrop-blur-md\"\r\n                });\r\n            }\r\n        }\r\n    }, [individualAltitudes, showToast]);\r\n\r\n    const handleAutoRotateTowers = useCallback((silent = false, customTowers?: Tower[], customConnections?: { from: string, to: string }[]) => {\r\n        const activeTowers = customTowers || towersRef.current;\r\n        const activeConnections = customConnections || connectionsRef.current;\r\n\r\n        if (activeTowers.length === 0) return;\r\n\r\n        const newTowers = [...activeTowers];\r\n        let changed = false;\r\n\r\n        newTowers.forEach((tower, index) => {\r\n            // Find connected neighbors\r\n            const connectedNeighbors = activeConnections.filter(c =>\r\n                c.from.trim().toUpperCase() === tower.name.trim().toUpperCase() ||\r\n                c.to.trim().toUpperCase() === tower.name.trim().toUpperCase()\r\n            ).map(c => {\r\n                const otherName = c.from.trim().toUpperCase() === tower.name.trim().toUpperCase() ? c.to : c.from;\r\n                return activeTowers.find(t => t.name.trim().toUpperCase() === otherName.trim().toUpperCase());\r\n            }).filter(Boolean);\r\n\r\n            if (connectedNeighbors.length > 0) {\r\n                let finalRotation = 0;\r\n\r\n                if (connectedNeighbors.length === 1) {\r\n                    const n = connectedNeighbors[0] as Tower;\r\n                    const dLon = (n.coordinates.lng - tower.coordinates.lng);\r\n                    const y = Math.sin(dLon * Math.PI / 180) * Math.cos(n.coordinates.lat * Math.PI / 180);\r\n                    const x = Math.cos(tower.coordinates.lat * Math.PI / 180) * Math.sin(n.coordinates.lat * Math.PI / 180) -\r\n                        Math.sin(tower.coordinates.lat * Math.PI / 180) * Math.cos(n.coordinates.lat * Math.PI / 180) * Math.cos(dLon * Math.PI / 180);\r\n\r\n                    const bearing = Math.atan2(y, x) * (180 / Math.PI);\r\n                    // Pointing arms perpendicular to the line.\r\n                    // If model arms are at 90 degrees, setting rotation to bearing aligns them.\r\n                    finalRotation = bearing;\r\n                } else {\r\n                    // Bisector logic for towers with 2+ connections\r\n                    const bearings = connectedNeighbors.slice(0, 2).map(n => {\r\n                        const towerN = n as Tower;\r\n                        const dLon = (towerN.coordinates.lng - tower.coordinates.lng);\r\n                        const y = Math.sin(dLon * Math.PI / 180) * Math.cos(towerN.coordinates.lat * Math.PI / 180);\r\n                        const x = Math.cos(tower.coordinates.lat * Math.PI / 180) * Math.sin(towerN.coordinates.lat * Math.PI / 180) -\r\n                            Math.sin(tower.coordinates.lat * Math.PI / 180) * Math.cos(towerN.coordinates.lat * Math.PI / 180) * Math.cos(dLon * Math.PI / 180);\r\n                        return Math.atan2(y, x) * (180 / Math.PI);\r\n                    });\r\n\r\n                    let diff = bearings[1] - bearings[0];\r\n                    while (diff < -180) diff += 360;\r\n                    while (diff > 180) diff -= 360;\r\n\r\n                    // Simple angle bisector\r\n                    finalRotation = bearings[0] + diff / 2;\r\n                }\r\n\r\n                // Apply rotation to state - rounding to avoid jitter\r\n                if (Math.abs(((tower as any).rotation || 0) - finalRotation) > 0.1) {\r\n                    newTowers[index] = { ...tower, rotation: finalRotation } as any;\r\n                    changed = true;\r\n                }\r\n            }\r\n        });\r\n\r\n        if (changed) {\r\n            setTowers(newTowers);\r\n            if (!silent) {\r\n                showToast({\r\n                    title: \"Ângulos Ajustados! 📐\",\r\n                    description: \"Torres rotacionadas para alinhar as mísulas com os cabos.\",\r\n                    className: \"bg-blue-950/80 border-blue-500/50 text-blue-100 backdrop-blur-md\"\r\n                });\r\n            }\r\n        }\r\n    }, [showToast]);\r\n\r\n    // Auto-snap triggers\r\n    useEffect(() => {\r\n        const map = mapRef.current?.getMap();\r\n        if (!map) return;\r\n\r\n        const onSnap = () => {\r\n            // Use Ref to get the freshest data during the idle event\r\n            if (towersRef.current.length > 0 && viewStateRef.current.zoom >= 14) {\r\n                handleSnapToTerrain(true);\r\n                handleAutoRotateTowers(true);\r\n            }\r\n        };\r\n\r\n        map.on('idle', onSnap);\r\n        window.addEventListener('terrain-ready', onSnap);\r\n\r\n        // Initial check after a short delay\r\n        const timer = setTimeout(onSnap, 2000);\r\n\r\n        return () => {\r\n            map.off('idle', onSnap);\r\n            window.removeEventListener('terrain-ready', onSnap);\r\n            clearTimeout(timer);\r\n        };\r\n    }, [towers.length, handleSnapToTerrain, handleAutoRotateTowers, viewState.zoom]); // Re-run when tower count changes\r\n\r\n    useEffect(() => {\r\n        if (towers.length < 2 && connections.length === 0) {\r\n            setCables([]);\r\n            return;\r\n        }\r\n\r\n        const newCables: any[] = [];\r\n        const newSpacers: any[] = [];\r\n        const newPlates: any[] = [];\r\n        if (connections.length > 0) {\r\n            const towerMap = new Map(towers.map(t => [t.name.trim().toUpperCase(), t]));\r\n\r\n            connections.forEach(conn => {\r\n                const startName = conn.from.trim().toUpperCase();\r\n                const endName = conn.to.trim().toUpperCase();\r\n                const start = towerMap.get(startName);\r\n                const end = towerMap.get(endName);\r\n\r\n                if (start && end) {\r\n                    const startIndex = towers.indexOf(start);\r\n                    const endIndex = towers.indexOf(end);\r\n\r\n                    if (!hiddenTowers.has(startIndex) && !hiddenTowers.has(endIndex)) {\r\n                        const dLon = (end.coordinates.lng - start.coordinates.lng);\r\n                        const y = Math.sin(dLon * Math.PI / 180) * Math.cos(end.coordinates.lat * Math.PI / 180);\r\n                        const x = Math.cos(start.coordinates.lat * Math.PI / 180) * Math.sin(end.coordinates.lat * Math.PI / 180) -\r\n                            Math.sin(start.coordinates.lat * Math.PI / 180) * Math.cos(end.coordinates.lat * Math.PI / 180) * Math.cos(dLon * Math.PI / 180);\r\n                        const bearing = Math.atan2(y, x);\r\n                        const perpAngle = bearing + Math.PI / 2;\r\n                        const metersToLat = 1 / 111111;\r\n                        const metersToLng = 1 / (111111 * Math.cos(start.coordinates.lat * Math.PI / 180));\r\n\r\n                        phases.forEach(phase => {\r\n                            if (!phase.enabled) return;\r\n\r\n                            const count = phase.cableCount || 1;\r\n                            const spacing = (phase.bundleSpacing || 0.4) * (scale / 50);\r\n\r\n                            // Calculate central path for spacer placement\r\n                            const recedeOffset = 0.3 * (scale / 50); // Move outward by 30cm\r\n                            const hBase = phase.horizontalOffset * (scale / 50);\r\n                            const hAdjusted = hBase + (hBase > 0 ? recedeOffset : -recedeOffset);\r\n\r\n                            const hLatOffset = Math.cos(perpAngle) * hAdjusted * metersToLat;\r\n                            const hLngOffset = Math.sin(perpAngle) * hAdjusted * metersToLng;\r\n                            const startAlt = individualAltitudes[start.name] !== undefined ? individualAltitudes[start.name] : (start.coordinates.altitude || 0);\r\n                            const endAlt = individualAltitudes[end.name] !== undefined ? individualAltitudes[end.name] : (end.coordinates.altitude || 0);\r\n\r\n                            const cp1 = {\r\n                                x: start.coordinates.lng + hLngOffset,\r\n                                y: start.coordinates.lat + hLatOffset,\r\n                                z: startAlt + (phase.verticalOffset * (scale / 50)) + towerElevation\r\n                            };\r\n                            const cp2 = {\r\n                                x: end.coordinates.lng + hLngOffset,\r\n                                y: end.coordinates.lat + hLatOffset,\r\n                                z: endAlt + (phase.verticalOffset * (scale / 50)) + towerElevation\r\n                            };\r\n\r\n                            // Generate Anchor Plate (Black Square) at connection points\r\n                            // User requested \"LARGE\" box - set to 1.5m x 1.5m\r\n                            const plateSize = 2.5 * (scale / 50);\r\n\r\n                            // Generate 3D Anchor Cylinder (Round Box)\r\n                            const generateCylinder = (center: any) => {\r\n                                const cylinderFaces: any[] = [];\r\n                                const radius = plateSize / 2;\r\n                                const depth = 3.5 * (scale / 50);\r\n                                const segments = 16;\r\n\r\n                                // Unit vectors\r\n                                const uLngB = Math.sin(bearing);\r\n                                const uLatB = Math.cos(bearing);\r\n                                const uLngP = Math.sin(perpAngle);\r\n                                const uLatP = Math.cos(perpAngle);\r\n\r\n                                // Helper to generate a circle offset\r\n                                const getCirclePoint = (angle: number, dOff: number) => {\r\n                                    const h = Math.cos(angle) * radius;\r\n                                    const v = Math.sin(angle) * radius;\r\n                                    const fLat = (uLatB * dOff + uLatP * h) * metersToLat;\r\n                                    const fLng = (uLngB * dOff + uLngP * h) * metersToLng;\r\n                                    return [center.x + fLng, center.y + fLat, center.z + v];\r\n                                };\r\n\r\n                                // 1. Front and Back Caps\r\n                                const frontDisk: number[][] = [];\r\n                                const backDisk: number[][] = [];\r\n                                for (let s = 0; s < segments; s++) {\r\n                                    const angle = (s / segments) * Math.PI * 2;\r\n                                    frontDisk.push(getCirclePoint(angle, depth / 2));\r\n                                    backDisk.push(getCirclePoint(angle, -depth / 2));\r\n                                }\r\n                                cylinderFaces.push({ polygon: frontDisk });\r\n                                cylinderFaces.push({ polygon: backDisk });\r\n\r\n                                // 2. Side Panels\r\n                                for (let s = 0; s < segments; s++) {\r\n                                    const a1 = (s / segments) * Math.PI * 2;\r\n                                    const a2 = ((s + 1) / segments) * Math.PI * 2;\r\n                                    cylinderFaces.push({\r\n                                        polygon: [\r\n                                            getCirclePoint(a1, depth / 2),\r\n                                            getCirclePoint(a2, depth / 2),\r\n                                            getCirclePoint(a2, -depth / 2),\r\n                                            getCirclePoint(a1, -depth / 2)\r\n                                        ]\r\n                                    });\r\n                                }\r\n                                return cylinderFaces;\r\n                            };\r\n\r\n                            newPlates.push(...generateCylinder(cp1));\r\n                            newPlates.push(...generateCylinder(cp2));\r\n\r\n                            // Direction and unit vector for cable shortening\r\n                            const dx = end.coordinates.lng - start.coordinates.lng;\r\n                            const dy = end.coordinates.lat - start.coordinates.lat;\r\n                            const groundDist = Math.sqrt(\r\n                                Math.pow(dx * 111111 * Math.cos(start.coordinates.lat * Math.PI / 180), 2) +\r\n                                Math.pow(dy * 111111, 2)\r\n                            );\r\n\r\n                            const uLng = dx / Math.max(0.1, groundDist);\r\n                            const uLat = dy / Math.max(0.1, groundDist);\r\n                            const termOffset = 1.5; // Deep insertion into the cylinder\r\n\r\n                            const cp1_short = { x: cp1.x + (uLng * termOffset), y: cp1.y + (uLat * termOffset), z: cp1.z };\r\n                            const cp2_short = { x: cp2.x - (uLng * termOffset), y: cp2.y - (uLat * termOffset), z: cp2.z };\r\n                            const centerPath = CatenaryCalculator.generateCatenaryPoints(cp1_short, cp2_short, phase.tension, 30);\r\n\r\n                            // Spacers logic\r\n                            if (phase.spacerInterval && phase.spacerInterval > 0 && count > 1) {\r\n                                let accumulatedDist = 0;\r\n                                for (let j = 1; j < centerPath.length - 1; j++) {\r\n                                    const pPrev = centerPath[j - 1];\r\n                                    const pCurr = centerPath[j];\r\n                                    // Rough distance calculation in meters\r\n                                    const dx = (pCurr.x - pPrev.x) * 111111 * Math.cos(pCurr.y * Math.PI / 180);\r\n                                    const dy = (pCurr.y - pPrev.y) * 111111;\r\n                                    const dz = pCurr.z - pPrev.z;\r\n                                    accumulatedDist += Math.sqrt(dx * dx + dy * dy + dz * dz);\r\n\r\n                                    if (accumulatedDist >= phase.spacerInterval) {\r\n                                        const framePoints: number[][] = [];\r\n                                        const sSize = phase.spacerSize || 1.1;\r\n                                        for (let k = 0; k < count; k++) {\r\n                                            let bH = 0;\r\n                                            let bV = 0;\r\n                                            if (count === 4) {\r\n                                                bH = (k === 0 || k === 2) ? -spacing / 2 : spacing / 2;\r\n                                                bV = (k === 0 || k === 1) ? spacing / 2 : -spacing / 2;\r\n                                            } else if (count === 3) {\r\n                                                if (k === 0) { bH = 0; bV = spacing * 0.577; }\r\n                                                else if (k === 1) { bH = -spacing / 2; bV = -spacing * 0.288; }\r\n                                                else { bH = spacing / 2; bV = -spacing * 0.288; }\r\n                                            } else if (count === 2) {\r\n                                                bH = k === 0 ? -spacing / 2 : spacing / 2;\r\n                                            }\r\n\r\n                                            const kLat = Math.cos(perpAngle) * (bH * sSize) * metersToLat;\r\n                                            const kLng = Math.sin(perpAngle) * (bH * sSize) * metersToLng;\r\n                                            framePoints.push([pCurr.x + kLng, pCurr.y + kLat, pCurr.z + (bV * sSize)]);\r\n                                        }\r\n\r\n                                        // Close square/triangle loop\r\n                                        if (count > 2) framePoints.push(framePoints[0]);\r\n\r\n                                        newSpacers.push({\r\n                                            path: framePoints,\r\n                                            color: phase.spacerColor || [20, 20, 20],\r\n                                            thickness: phase.spacerThickness || 0.2,\r\n                                            phaseId: phase.id\r\n                                        });\r\n                                        accumulatedDist = 0;\r\n                                    }\r\n                                }\r\n                            }\r\n\r\n                            for (let i = 0; i < count; i++) {\r\n                                let bundleHOffset = 0;\r\n                                let bundleVOffset = 0;\r\n\r\n                                if (count === 4) {\r\n                                    bundleHOffset = (i === 0 || i === 2) ? -spacing / 2 : spacing / 2;\r\n                                    bundleVOffset = (i === 0 || i === 1) ? spacing / 2 : -spacing / 2;\r\n                                } else if (count === 3) {\r\n                                    if (i === 0) { bundleHOffset = 0; bundleVOffset = spacing * 0.577; }\r\n                                    else if (i === 1) { bundleHOffset = -spacing / 2; bundleVOffset = -spacing * 0.288; }\r\n                                    else { bundleHOffset = spacing / 2; bundleVOffset = -spacing * 0.288; }\r\n                                } else if (count === 2) {\r\n                                    bundleHOffset = i === 0 ? -spacing / 2 : spacing / 2;\r\n                                }\r\n\r\n                                const bhLat = Math.cos(perpAngle) * bundleHOffset * metersToLat;\r\n                                const bhLng = Math.sin(perpAngle) * bundleHOffset * metersToLng;\r\n\r\n                                const p1 = {\r\n                                    x: cp1.x + bhLng + (uLng * termOffset),\r\n                                    y: cp1.y + bhLat + (uLat * termOffset),\r\n                                    z: cp1.z + bundleVOffset\r\n                                };\r\n                                const p2 = {\r\n                                    x: cp2.x + bhLng - (uLng * termOffset),\r\n                                    y: cp2.y + bhLat - (uLat * termOffset),\r\n                                    z: cp2.z + bundleVOffset\r\n                                };\r\n\r\n                                const pathPoints = CatenaryCalculator.generateCatenaryPoints(p1, p2, phase.tension, 20);\r\n                                newCables.push({\r\n                                    from: start,\r\n                                    to: end,\r\n                                    path: pathPoints.map(p => [p.x, p.y, p.z]),\r\n                                    color: phase.color,\r\n                                    phase: `${phase.id}-${i}`,\r\n                                    width: phase.width || 0.15\r\n                                });\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        setCables(newCables);\r\n        setSpacers(newSpacers);\r\n        setAnchorPlates(newPlates);\r\n    }, [towers, phases, hiddenTowers, connections, towerElevation, scale, individualAltitudes]);\r\n\r\n    const handleExcelImport = (newTowers: Tower[], newConnections: { from: string, to: string }[]) => {\r\n        setTowers(newTowers);\r\n        if (newConnections.length === 0) {\r\n            setConnections(ORION_SEQUENCE);\r\n            showToast({ title: \"Sequência Padrão Aplicada\" });\r\n        } else {\r\n            setConnections(newConnections);\r\n        }\r\n\r\n        const hiddenSet = new Set<number>();\r\n        newTowers.forEach((t, i) => { if (t.isHidden) hiddenSet.add(i); });\r\n        setHiddenTowers(hiddenSet);\r\n\r\n        if (newTowers.length > 0) {\r\n            const first = newTowers[0];\r\n            setViewState({\r\n                ...viewState,\r\n                longitude: first.coordinates.lng,\r\n                latitude: first.coordinates.lat,\r\n                zoom: 15\r\n            });\r\n        }\r\n\r\n        // Auto-align angles after import using the new data directly\r\n        handleAutoRotateTowers(true, newTowers, newConnections.length === 0 ? ORION_SEQUENCE : newConnections);\r\n    };\r\n\r\n    const layers = useMemo(() => {\r\n        const currentZoom = viewState.zoom;\r\n        const visibleTowers = towers.filter((_, i) => !hiddenTowers.has(i));\r\n\r\n        if (currentZoom < 14) {\r\n            return [\r\n                new ScatterplotLayer({\r\n                    id: 'tower-dots-low-zoom',\r\n                    data: visibleTowers,\r\n                    getPosition: (d: any) => [d.coordinates.lng, d.coordinates.lat, 0],\r\n                    getFillColor: [0, 255, 170, 255],\r\n                    getRadius: 50,\r\n                    radiusUnits: 'meters',\r\n                    radiusMinPixels: 4,\r\n                })\r\n            ];\r\n        }\r\n\r\n        return [\r\n            new ScenegraphLayer({\r\n                id: 'towers-layer',\r\n                data: visibleTowers,\r\n                scenegraph: TOWER_MODEL_URL,\r\n                getPosition: (d: any) => [\r\n                    d.coordinates.lng,\r\n                    d.coordinates.lat,\r\n                    (individualAltitudes[d.name] !== undefined ? individualAltitudes[d.name] : (d.coordinates.altitude || 0)) + towerElevation\r\n                ],\r\n                getOrientation: (d: any) => [0, -(d.rotation || 0), 90],\r\n                sizeScale: scale,\r\n                getScale: [1, 1, 1],\r\n                _lighting: 'pbr',\r\n                pickable: true,\r\n                onClick: (info) => {\r\n                    const currentTime = Date.now();\r\n                    const delay = currentTime - lastClickTime;\r\n                    if (delay < 400 && info.object) {\r\n                        // Double Click Detected\r\n                        if (!isDebugMode) {\r\n                            setSelectedTowerForDetails(info.object);\r\n                            setIsTowerModalOpen(true);\r\n                            setIsQuickInfoOpen(false);\r\n                        }\r\n                        setLastClickTime(0); // Reset\r\n                    } else {\r\n                        // Single Click tracking\r\n                        setLastClickTime(currentTime);\r\n                        const originalIndex = towers.findIndex(t => t.name === info.object.name);\r\n                        if (originalIndex !== -1) {\r\n                            // First click triggers Quick Info via handleTowerClick\r\n                            handleTowerClick(info, originalIndex);\r\n                        }\r\n                    }\r\n                },\r\n                onMouseDown: (info, event) => {\r\n                    // Optional: highlight on right click down\r\n                },\r\n                onContextMenu: (info, event) => {\r\n                    if (event.srcEvent) {\r\n                        event.srcEvent.preventDefault();\r\n                    }\r\n                },\r\n                autoHighlight: true,\r\n                highlightColor: [0, 255, 0, 100],\r\n                getColor: (d: any) => (selectedStartTower !== null && towers[selectedStartTower].name === d.name) ? [0, 255, 255, 255] : [255, 255, 255]\r\n            }),\r\n            new PathLayer({\r\n                id: 'cables-layer',\r\n                data: cables,\r\n                pickable: true,\r\n                widthScale: 1,\r\n                widthUnits: 'meters', // Use meters for realistic thickness\r\n                widthMinPixels: 1.5,\r\n                getPath: d => d.path,\r\n                getColor: d => d.color,\r\n                getWidth: d => d.width || 0.15,\r\n                onClick: (info) => {\r\n                    const currentTime = Date.now();\r\n                    const delay = currentTime - lastClickTime;\r\n\r\n                    if (delay < 350 && info.object) {\r\n                        // Double Click Detected on Cable\r\n                        setShowCableMenu(true);\r\n                        setLastClickTime(0); // Reset\r\n                    } else {\r\n                        // Single Click\r\n                        setLastClickTime(currentTime);\r\n                    }\r\n                },\r\n            }),\r\n            new PathLayer({\r\n                id: 'spacers-layer',\r\n                data: spacers,\r\n                pickable: true,\r\n                widthScale: 1,\r\n                widthUnits: 'meters',\r\n                widthMinPixels: 2,\r\n                getPath: d => d.path,\r\n                getColor: d => d.color || [20, 20, 20],\r\n                getWidth: d => d.thickness || 0.2,\r\n            }),\r\n            new PolygonLayer({\r\n                id: 'anchor-plates-layer',\r\n                data: anchorPlates,\r\n                pickable: false,\r\n                stroked: false,\r\n                filled: true,\r\n                extruded: false,\r\n                wireframe: true,\r\n                getPolygon: d => d.polygon,\r\n                getFillColor: [0, 0, 0, 255], // Black Solid\r\n                getLineColor: [6, 182, 212, 255], // Cyan outline\r\n                getLineWidth: 0.2, // Slightly thicker\r\n                lineWidthUnits: 'meters'\r\n            }),\r\n            new ScatterplotLayer({\r\n                id: 'debug-points-layer',\r\n                data: debugPoints,\r\n                getPosition: (d: { position: [number, number, number] }) => d.position,\r\n                getFillColor: [255, 59, 48, 255], // More vibrant red\r\n                getLineColor: [255, 255, 255, 120], // Brighter outline\r\n                getRadius: 1.8,\r\n                radiusUnits: 'meters',\r\n                radiusMinPixels: 8,\r\n                pickable: true,\r\n                billboard: true,\r\n                stroked: true, // Enable outline\r\n                lineWidthUnits: 'meters',\r\n                getLineWidth: 0.15,\r\n                parameters: {\r\n                    depthTest: false // FORCE ALWAYS ON TOP\r\n                }\r\n            }),\r\n            new ScatterplotLayer({\r\n                id: 'ground-collision-plane',\r\n                data: towers.filter(t => individualAltitudes[t.name] !== undefined),\r\n                getPosition: (d: { coordinates: { lng: number, lat: number }, name: string }) => [d.coordinates.lng, d.coordinates.lat, individualAltitudes[d.name] || 0],\r\n                getFillColor: [255, 255, 255, 40], // Faint white\r\n                getLineColor: [255, 255, 255, 120], // Better visibility for the ring\r\n                getRadius: 16,\r\n                radiusUnits: 'meters',\r\n                stroked: true,\r\n                filled: true,\r\n                lineWidthUnits: 'meters',\r\n                getLineWidth: 0.1,\r\n            }),\r\n            new ScatterplotLayer({\r\n                id: 'tower-base-collision',\r\n                data: towers.filter(t => individualAltitudes[t.name] !== undefined),\r\n                getPosition: (d: { coordinates: { lng: number, lat: number }, name: string }) => [\r\n                    d.coordinates.lng,\r\n                    d.coordinates.lat,\r\n                    (individualAltitudes[d.name] || 0)\r\n                ],\r\n                getFillColor: (d: { name: string }) => towerElevation < -0.1 ? [255, 69, 58, 160] : [52, 199, 89, 160], // Apple Design Colors (System Red/Green)\r\n                getLineColor: (d: { name: string }) => towerElevation < -0.1 ? [255, 69, 58, 255] : [52, 199, 89, 255],\r\n                getRadius: 16,\r\n                radiusUnits: 'meters',\r\n                stroked: true,\r\n                filled: true,\r\n                lineWidthMinPixels: 2,\r\n                pickable: true,\r\n                onClick: (info) => {\r\n                    const currentTime = Date.now();\r\n                    const delay = currentTime - lastClickTime;\r\n                    if (delay < 400 && info.object) {\r\n                        setSelectedTowerForDetails(info.object);\r\n                        setIsTowerModalOpen(true);\r\n                        setIsQuickInfoOpen(false);\r\n                        setLastClickTime(0);\r\n                    } else {\r\n                        setLastClickTime(currentTime);\r\n                        const originalIndex = towers.findIndex(t => t.name === info.object.name);\r\n                        if (originalIndex !== -1) handleTowerClick(info, originalIndex);\r\n                    }\r\n                },\r\n                parameters: {\r\n                    depthTest: true\r\n                }\r\n            }),\r\n            new TextLayer({\r\n                id: 'tower-labels-top',\r\n                data: visibleTowers,\r\n                getPosition: (d: { coordinates: { lng: number, lat: number, altitude: number }, name: string }) => [\r\n                    d.coordinates.lng,\r\n                    d.coordinates.lat,\r\n                    (individualAltitudes[d.name] !== undefined ? individualAltitudes[d.name] : (d.coordinates.altitude || 0)) + towerElevation + 2\r\n                ],\r\n                getText: (d: { name: string }) => d.name,\r\n                getSize: 16,\r\n                getAngle: 0,\r\n                getTextAnchor: 'middle',\r\n                getAlignmentBaseline: 'bottom',\r\n                getColor: [255, 255, 255],\r\n                background: true,\r\n                getBackgroundColor: [0, 0, 0, 180],\r\n                billboard: true,\r\n                fontFamily: 'Inter, sans-serif',\r\n                fontWeight: 900,\r\n                outlineWidth: 1,\r\n                outlineColor: [0, 255, 170],\r\n                pickable: true,\r\n                onClick: (info: { object?: any, coordinate?: number[] }) => {\r\n                    const currentTime = Date.now();\r\n                    const delay = currentTime - lastClickTime;\r\n                    if (delay < 400 && info.object) {\r\n                        setSelectedTowerForDetails(info.object);\r\n                        setIsTowerModalOpen(true);\r\n                        setIsQuickInfoOpen(false);\r\n                        setLastClickTime(0);\r\n                    } else if (info.object) {\r\n                        setLastClickTime(currentTime);\r\n                        const originalIndex = towers.findIndex(t => t.name === info.object.name);\r\n                        if (originalIndex !== -1) handleTowerClick(info, originalIndex);\r\n                    }\r\n                }\r\n            }),\r\n            new TextLayer({\r\n                id: 'tower-labels',\r\n                data: visibleTowers,\r\n                getPosition: (d: { coordinates: { lng: number, lat: number, altitude: number }, name: string }) => [\r\n                    d.coordinates.lng,\r\n                    d.coordinates.lat,\r\n                    (individualAltitudes[d.name] !== undefined ? individualAltitudes[d.name] : (d.coordinates.altitude || 0)) + towerElevation - (48 * (scale / 50)) + 0.1\r\n                ],\r\n                getText: (d: { name: string }) => d.name,\r\n                getSize: 10,\r\n                getAngle: 0,\r\n                getTextAnchor: 'middle',\r\n                getAlignmentBaseline: 'center',\r\n                getColor: [0, 0, 0],\r\n                background: false,\r\n                billboard: false,\r\n                fontFamily: 'Inter, sans-serif',\r\n                fontWeight: 900,\r\n                outlineWidth: 0,\r\n                pickable: true,\r\n                onClick: (info: { object?: any, coordinate?: number[] }) => {\r\n                    const currentTime = Date.now();\r\n                    const delay = currentTime - lastClickTime;\r\n                    if (delay < 400 && info.object) {\r\n                        setSelectedTowerForDetails(info.object);\r\n                        setIsTowerModalOpen(true);\r\n                        setIsQuickInfoOpen(false);\r\n                        setLastClickTime(0);\r\n                    } else if (info.object) {\r\n                        setLastClickTime(currentTime);\r\n                        const originalIndex = towers.findIndex(t => t.name === (info.object as any).name);\r\n                        if (originalIndex !== -1) handleTowerClick(info, originalIndex);\r\n                    }\r\n                }\r\n            })\r\n        ];\r\n    }, [towers, cables, hiddenTowers, scale, isConnectMode, selectedStartTower, phases, debugPoints, isDebugMode, towerElevation, individualAltitudes, viewState.zoom]);\r\n\r\n    if (!MAPBOX_TOKEN) return <div className=\"flex items-center justify-center h-screen text-red-500\">Token Mapbox Faltando</div>;\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-screen w-screen overflow-hidden bg-black text-white selection:bg-cyan-500/30 font-sans fixed inset-0\">\r\n            {isLoading && (\r\n                <div className=\"fixed inset-0 z-100 bg-black/80 backdrop-blur-xl flex flex-col items-center justify-center gap-6\">\r\n                    <div className=\"relative\">\r\n                        <Loader2 className=\"w-16 h-16 text-emerald-500 animate-spin\" />\r\n                        <div className=\"absolute inset-0 blur-2xl bg-emerald-500/20 animate-pulse\"></div>\r\n                    </div>\r\n                    <div className=\"flex flex-col items-center gap-2\">\r\n                        <p className=\"text-xl font-black italic tracking-widest text-emerald-400 animate-pulse uppercase\">Sincronizando Dados</p>\r\n                        <p className=\"text-[10px] text-neutral-500 font-bold uppercase tracking-[0.4em]\">Arquitetura OrioN 3D Inspector</p>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n\r\n            {/* 2. Floating Toolbar - Tool-only & Simplified */}\r\n            <div className={cn(\r\n                \"fixed bottom-10 left-1/2 -translate-x-1/2 transition-all duration-500\",\r\n                isFullScreen ? \"z-60\" : \"z-50\"\r\n            )}>\r\n                <div className=\"bg-black/80 backdrop-blur-3xl border border-white/10 rounded-4xl shadow-2xl p-2.5 flex items-center gap-3\">\r\n                    {/* Feature Action Toggles */}\r\n                    <div className=\"flex items-center gap-2 p-1.5 bg-white/5 rounded-3xl border border-white/5\">\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            className={cn(\r\n                                \"h-11 px-6 rounded-2xl font-black text-[10px] uppercase tracking-widest transition-all gap-3\",\r\n                                showTowerMenu ? \"bg-emerald-500 text-black shadow-lg\" : \"text-neutral-400 hover:text-emerald-400\"\r\n                            )}\r\n                            onClick={toggleTowerMenu}\r\n                        >\r\n                            <List className=\"w-4 h-4\" />\r\n                            <span>Torres</span>\r\n                        </Button>\r\n\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            className={cn(\r\n                                \"h-11 px-6 rounded-2xl font-black text-[10px] uppercase tracking-widest transition-all gap-3\",\r\n                                showCableMenu ? \"bg-cyan-500 text-black shadow-lg\" : \"text-neutral-400 hover:text-cyan-400\"\r\n                            )}\r\n                            onClick={toggleCableMenu}\r\n                        >\r\n                            <Zap className=\"w-4 h-4\" />\r\n                            <span>Cabos</span>\r\n                        </Button>\r\n                    </div>\r\n\r\n                    <div className=\"w-px h-8 bg-white/10 mx-1\" />\r\n\r\n                    {/* Correction / Editing Tools */}\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                        {[\r\n                            { icon: RefreshCw, label: \"Snap\", onClick: () => handleSnapToTerrain(), color: \"text-orange-400\" },\r\n                            { icon: RefreshCw, label: \"Rotate\", onClick: () => handleAutoRotateTowers(), color: \"text-blue-400\" },\r\n                            { icon: Maximize2, label: \"Fit\", onClick: () => handleFitToTowers(), color: \"text-emerald-400\" },\r\n                            { icon: Link2, label: \"Connect\", active: isConnectMode, onClick: () => canEdit && setIsConnectMode(!isConnectMode), color: \"text-orange-500\", disabled: !canEdit },\r\n                        ].map((tool, idx) => (\r\n                            <Button\r\n                                key={idx}\r\n                                variant=\"ghost\"\r\n                                size=\"sm\"\r\n                                disabled={(tool as any).disabled}\r\n                                className={cn(\r\n                                    \"h-11 px-4 rounded-2xl font-black text-[10px] uppercase tracking-widest gap-2.5 transition-all border border-transparent\",\r\n                                    tool.active ? \"bg-white/10 border-white/10 shadow-inner\" : \"text-neutral-500 hover:bg-white/5 hover:border-white/5\",\r\n                                    (tool as any).disabled && \"opacity-20 cursor-not-allowed grayscale\"\r\n                                )}\r\n                                onClick={tool.onClick}\r\n                            >\r\n                                <tool.icon className={cn(\"w-4.5 h-4.5\", tool.color)} />\r\n                                <span className=\"hidden md:inline-block\">{tool.label}</span>\r\n                            </Button>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* 3. Floating Premium Header (Visible only when in FullScreen) */}\r\n            {isFullScreen && (\r\n                <div className=\"fixed top-6 left-1/2 -translate-x-1/2 z-60 animate-in fade-in slide-in-from-top-6 duration-700 w-[95%] max-w-6xl\">\r\n                    <div className=\"bg-black/95 backdrop-blur-3xl border border-white/10 rounded-[2.5rem] shadow-[0_0_80px_rgba(16,185,129,0.3)] p-4 flex items-center justify-between gap-8 ring-1 ring-white/10 relative overflow-hidden group\">\r\n                        {/* Animated Border Light */}\r\n                        <div className=\"absolute top-0 left-0 w-full h-px bg-linear-to-r from-transparent via-emerald-500/40 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000\" />\r\n\r\n                        <div className=\"flex items-center gap-6\">\r\n                            {/* Project Selector - Large Cockpit View */}\r\n                            <div className=\"flex items-center gap-4 pr-8 border-r border-white/10 shrink-0\">\r\n                                <Select value={selectedProjectId || \"\"} onValueChange={setSelectedProjectId}>\r\n                                    <SelectTrigger className=\"w-[100px] h-12 bg-white/5 border-white/5 rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-white/10 transition-all text-white\">\r\n                                        <SelectValue placeholder=\"SELECIONAR OPERAÇÃO\" />\r\n                                    </SelectTrigger>\r\n                                    <SelectContent className=\"bg-neutral-900 border-white/10 rounded-2xl shadow-2xl\">\r\n                                        {projects.map((p) => (\r\n                                            <SelectItem key={p.id} value={p.id} className=\"text-xs font-bold font-mono\">\r\n                                                {p.name}\r\n                                            </SelectItem>\r\n                                        ))}\r\n                                    </SelectContent>\r\n                                </Select>\r\n                            </div>\r\n\r\n                            {/* Import & Minimize Actions */}\r\n                            <div className=\"shrink-0 flex items-center gap-6\">\r\n                                {canManage ? (\r\n                                    <ExcelDataUploader onLoad={handleExcelImport} />\r\n                                ) : (\r\n                                    <div className=\"h-12 px-6 rounded-2xl border border-dashed border-white/5 text-neutral-700 flex items-center gap-2 text-[8px] font-black uppercase tracking-widest\">\r\n                                        Controle Admin Restrito\r\n                                    </div>\r\n                                )}\r\n                                <div className=\"w-px h-8 bg-white/10\" />\r\n                                <Button\r\n                                    onClick={() => setIsFullScreen(false)}\r\n                                    variant=\"ghost\"\r\n                                    size=\"sm\"\r\n                                    className=\"h-12 px-6 rounded-2xl border border-white/10 text-neutral-400 hover:text-white hover:bg-white/5 flex items-center gap-3 text-[10px] font-black uppercase tracking-widest group shadow-xl\"\r\n                                >\r\n                                    <Maximize2 className=\"w-5 h-5 text-emerald-500 group-hover:scale-110 transition-transform\" />\r\n                                    <span>FECHAR COCKPIT</span>\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Large Action Hub */}\r\n                        <div className=\"shrink-0 relative group\">\r\n                            <div className=\"absolute inset-0 bg-emerald-500/20 blur-2xl rounded-4xl opacity-0 group-hover:opacity-100 transition-opacity duration-500\" />\r\n                            <Button\r\n                                size=\"lg\"\r\n                                className={cn(\r\n                                    \"h-14 px-10 rounded-4xl font-black text-[11px] uppercase tracking-[0.4em] transition-all gap-5 shadow-2xl relative border-2 border-emerald-400/20 active:scale-95\",\r\n                                    isSaving ? \"bg-emerald-500/50 cursor-wait\" : \"bg-emerald-500 text-black hover:bg-emerald-400 shadow-emerald-500/30\",\r\n                                    !canEdit && \"opacity-20 grayscale cursor-not-allowed\"\r\n                                )}\r\n                                onClick={() => canEdit && handleSaveConfig(false)}\r\n                                disabled={!selectedProjectId || isSaving || !canEdit}\r\n                            >\r\n                                {isSaving ? <Loader2 className=\"w-5 h-5 animate-spin\" /> : <Save className=\"w-5 h-5\" />}\r\n                                <span>{isSaving ? \"PROCESSANDO\" : \"PUBLICAR PROJETO\"}</span>\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Main Area: Map Container with dynamic sizing */}\r\n            <main className={cn(\r\n                \"fixed inset-0 transition-all duration-700 ease-in-out bg-neutral-950 overflow-hidden flex flex-col\",\r\n                isFullScreen\r\n                    ? \"z-1 rounded-none border-none\"\r\n                    : \"z-0\"\r\n            )}>\r\n                {/* 1. Floating Navigation Pills (Normal Mode) */}\r\n                {!isFullScreen && (\r\n                    <div className=\"absolute top-6 left-0 right-0 z-50 px-6 flex items-center justify-between pointer-events-none\">\r\n                        {/* Left Pills Group: Dashboard & Branding */}\r\n                        <div className=\"flex items-center gap-6 pointer-events-auto\">\r\n                            <div className=\"bg-black/80 backdrop-blur-3xl border border-white/10 rounded-full pl-2 pr-6 py-2 flex items-center gap-3 shadow-2xl ring-1 ring-white/10 group hover:bg-black transition-all cursor-pointer hover:scale-105 active:scale-95\" onClick={() => window.location.href = '/dashboard'}>\r\n                                <div className=\"w-8 h-8 bg-orange-600 rounded-full flex items-center justify-center shadow-lg shadow-orange-600/40 group-hover:rotate-12 transition-transform\">\r\n                                    <Zap className=\"w-4 h-4 text-white\" />\r\n                                </div>\r\n                                <div>\r\n                                    <h1 className=\"text-[10px] font-black text-white italic uppercase tracking-widest leading-none\">ORION</h1>\r\n                                    <p className=\"text-[7px] font-bold text-orange-500/80 uppercase tracking-[0.2em] mt-0.5\">Dashboard</p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Separator / Gap */}\r\n                            <div className=\"w-px h-22 bg-white/10 mx-2 hidden md:block\" />\r\n\r\n                            {/* Project Selector Pill */}\r\n                            <div className=\"bg-black/80 backdrop-blur-3xl border border-white/10 rounded-full px-5 py-2 flex items-center gap-2 shadow-2xl pointer-events-auto hover:bg-black transition-all\">\r\n                                <Layers className=\"w-3.5 h-3.5 text-emerald-500/50\" />\r\n                                <Select value={selectedProjectId || \"\"} onValueChange={setSelectedProjectId}>\r\n                                    <SelectTrigger className=\"w-[300px] h-8 bg-transparent border-none rounded-full font-black text-[10px] uppercase tracking-widest hover:text-emerald-400\">\r\n                                        <SelectValue placeholder=\"PROJETO\" />\r\n                                    </SelectTrigger>\r\n                                    <SelectContent className=\"bg-black border-white/10 rounded-2xl shadow-2xl\">\r\n                                        {projects.map((p) => (\r\n                                            <SelectItem key={p.id} value={p.id} className=\"text-[10px] font-bold font-mono\">\r\n                                                {p.name}\r\n                                            </SelectItem>\r\n                                        ))}\r\n                                    </SelectContent>\r\n                                </Select>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Right Pill: Expand & Status */}\r\n                        <div className=\"flex items-center gap-3 pointer-events-auto\">\r\n                            <div className=\"bg-black/60 backdrop-blur-2xl border border-white/10 rounded-full p-1.5 flex items-center gap-2 shadow-2xl ring-1 ring-white/5\">\r\n                                <Button\r\n                                    onClick={() => setIsFullScreen(true)}\r\n                                    variant=\"ghost\"\r\n                                    size=\"sm\"\r\n                                    className=\"h-10 px-4 rounded-full border border-white/5 text-emerald-500 hover:text-white hover:bg-emerald-500 transition-all group font-black text-[10px] uppercase tracking-widest gap-2\"\r\n                                >\r\n                                    <Maximize2 className=\"w-4 h-4 group-hover:scale-110 transition-transform\" />\r\n                                    <span>Expandir Cockpit</span>\r\n                                </Button>\r\n                                <div className=\"w-px h-6 bg-white/10\" />\r\n                                <Button\r\n                                    size=\"sm\"\r\n                                    className={cn(\r\n                                        \"h-10 px-6 rounded-full font-black text-[10px] uppercase tracking-widest transition-all gap-2 shadow-lg\",\r\n                                        isSaving ? \"bg-emerald-500/50 cursor-wait\" : \"bg-emerald-500 text-black hover:bg-emerald-400 active:scale-95 shadow-emerald-500/10\"\r\n                                    )}\r\n                                    onClick={() => canEdit && handleSaveConfig(false)}\r\n                                    disabled={!selectedProjectId || isSaving || !canEdit}\r\n                                >\r\n                                    {isSaving ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <Save className=\"w-4 h-4\" />}\r\n                                    <span>PUBLICAR</span>\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                <div className=\"relative flex-1 group overflow-hidden\">\r\n                    <ReactMap\r\n                        ref={mapRef}\r\n                        {...viewState}\r\n                        onMove={(evt) => setViewState(evt.viewState)}\r\n                        mapboxAccessToken={MAPBOX_TOKEN}\r\n                        mapStyle=\"mapbox://styles/mapbox/satellite-v9\"\r\n                        reuseMaps\r\n                        style={{ width: '100%', height: '100%' }}\r\n                        doubleClickZoom={false}\r\n                    >\r\n                        <Source id=\"mapbox-dem\" type=\"raster-dem\" url=\"mapbox://mapbox.mapbox-terrain-dem-v1\" tileSize={512} maxzoom={14} />\r\n                        <TerrainManager />\r\n                        <DeckGLOverlay\r\n                            layers={layers}\r\n                            getTooltip={({ object }: any) => {\r\n                                if (!object) return null;\r\n                                if (object.path) {\r\n                                    return {\r\n                                        html: `<div class=\"p-4 bg-black/90 backdrop-blur-xl border border-white/10 rounded-2xl shadow-2xl\">\r\n                                            <div class=\"text-xs font-black text-cyan-400 uppercase tracking-widest mb-1 italic\">Span Conectado</div>\r\n                                            <div class=\"text-[10px] text-neutral-500 uppercase font-bold tracking-tighter\">Geometria Catenária Analítica</div>\r\n                                        </div>`\r\n                                    };\r\n                                }\r\n                                return {\r\n                                    html: `<div class=\"p-6 bg-black/95 backdrop-blur-2xl text-white rounded-[2.5rem] border border-white/10 shadow-3xl min-w-[200px]\">\r\n                                        <div class=\"flex items-center gap-3 mb-4\">\r\n                                            <div class=\"w-10 h-10 bg-emerald-500/20 rounded-2xl flex items-center justify-center border border-emerald-500/30\">\r\n                                                <Maximize2 class=\"w-5 h-5 text-emerald-400\" />\r\n                                            </div>\r\n                                            <div>\r\n                                                <h4 class=\"font-black text-white text-xl tracking-tighter leading-none\">${object.name}</h4>\r\n                                                <p class=\"text-[9px] font-black text-emerald-500/60 uppercase tracking-widest mt-1\">Structure Node</p>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div class=\"space-y-3 pt-4 border-t border-white/5\">\r\n                                            <div class=\"flex justify-between items-center bg-white/5 p-3 rounded-2xl border border-white/5\">\r\n                                                <span class=\"text-[9px] uppercase font-black text-neutral-500 tracking-widest\">Altitude Geóide</span>\r\n                                                <span class=\"text-xs font-mono font-black text-emerald-400\">${object.coordinates.altitude?.toFixed(2)}m</span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>`\r\n                                };\r\n                            }}\r\n                        />\r\n                    </ReactMap>\r\n                </div>\r\n\r\n                {/* Minimal Overlay Info (Shifted up to accommodate Bottom Toolbar) */}\r\n                <div className=\"absolute bottom-16 left-10 flex gap-12 text-left pointer-events-none\">\r\n                    <div className=\"animate-in fade-in slide-in-from-bottom-4 duration-1000\">\r\n                        <p className=\"text-[10px] font-black uppercase text-neutral-500 tracking-widest mb-1\">Torres</p>\r\n                        <h3 className=\"text-4xl font-black text-white italic tracking-tighter leading-none\">{towers.length}<span className=\"text-emerald-500 text-lg not-italic ml-1\">UNITS</span></h3>\r\n                    </div>\r\n                    <div className=\"animate-in fade-in slide-in-from-bottom-4 duration-1000 delay-200\">\r\n                        <p className=\"text-[10px] font-black uppercase text-neutral-500 tracking-widest mb-1\">Caboos</p>\r\n                        <h3 className=\"text-4xl font-black text-white italic tracking-tighter leading-none\">{Number(cables.length).toLocaleString('pt-BR', {\r\n                            minimumFractionDigits: 1,\r\n                            maximumFractionDigits: 1,\r\n                        })}<span className=\"text-cyan-500 text-lg not-italic ml-1\">KM-LT</span></h3>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Drawer Overlay for Mobile/Professional Side Menu */}\r\n                {showTowerMenu && (\r\n                    <div className=\"fixed top-24 bottom-6 right-6 w-full max-w-[340px] z-40 animate-in slide-in-from-right-10 duration-500\">\r\n                        <div className=\"h-full bg-neutral-950/80 backdrop-blur-3xl border border-white/10 rounded-3xl shadow-4xl flex flex-col overflow-hidden ring-1 ring-white/20\">\r\n                            <div className=\"p-6 border-b border-white/10 flex items-center justify-between bg-white/2\">\r\n                                <div>\r\n                                    <h2 className=\"text-xl font-black text-white italic uppercase tracking-tighter\">Estruturas</h2>\r\n                                    <p className=\"text-[8px] text-neutral-500 font-bold uppercase tracking-[0.3em] mt-1\">Base de Dados Técnica</p>\r\n                                </div>\r\n                                <Button variant=\"ghost\" size=\"icon\" onClick={() => setShowTowerMenu(false)} className=\"w-8 h-8 rounded-xl hover:bg-white/5 text-neutral-500 hover:text-white transition-colors\">\r\n                                    <Maximize2 className=\"w-4 h-4 rotate-45\" />\r\n                                </Button>\r\n                            </div>\r\n\r\n                            <div className=\"p-6 space-y-8 border-b border-white/5\">\r\n                                <div className=\"space-y-3\">\r\n                                    <div className=\"flex justify-between items-center text-[9px] text-neutral-400 uppercase font-black tracking-widest pl-1\">\r\n                                        <span>Escala Global</span>\r\n                                        <span className=\"text-emerald-500 text-xs italic font-mono\">{(scale / 50).toFixed(1)}x</span>\r\n                                    </div>\r\n                                    <Slider\r\n                                        value={[scale]}\r\n                                        min={10}\r\n                                        max={150}\r\n                                        step={1}\r\n                                        onValueChange={(val) => canEdit && setScale(val[0])}\r\n                                        disabled={!canEdit}\r\n                                    />\r\n                                </div>\r\n                                <div className=\"space-y-3\">\r\n                                    <div className=\"flex justify-between items-center text-[9px] text-neutral-400 uppercase font-black tracking-widest pl-1\">\r\n                                        <span>Elevação</span>\r\n                                        <span className=\"text-cyan-500 text-xs italic font-mono\">{towerElevation.toFixed(1)}m</span>\r\n                                    </div>\r\n                                    <Slider\r\n                                        value={[towerElevation]}\r\n                                        min={-20}\r\n                                        max={50}\r\n                                        step={0.5}\r\n                                        onValueChange={(val) => canEdit && setTowerElevation(val[0])}\r\n                                        disabled={!canEdit}\r\n                                    />\r\n                                </div>\r\n                                <div className=\"flex gap-3\">\r\n                                    <Button variant=\"outline\" className=\"flex-1 h-10 rounded-xl border-white/5 bg-white/5 text-[9px] font-black uppercase tracking-widest hover:bg-emerald-500 hover:text-black transition-all\" onClick={() => setHiddenTowers(new Set())}>Exibir Tudo</Button>\r\n                                    <Button variant=\"outline\" className=\"flex-1 h-10 rounded-xl border-white/5 bg-white/5 text-[9px] font-black uppercase tracking-widest hover:bg-red-500 hover:text-white transition-all\" onClick={() => setHiddenTowers(new Set(towers.map((_, i) => i)))}>Ocultar Tudo</Button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"flex-1 overflow-y-auto p-3 space-y-2 scrollbar-none\">\r\n                                {towers.map((t, i) => (\r\n                                    <div\r\n                                        key={i}\r\n                                        className={cn(\r\n                                            \"group p-3 rounded-2xl border transition-all duration-300 flex items-center gap-3 relative overflow-hidden\",\r\n                                            hiddenTowers.has(i)\r\n                                                ? \"bg-transparent border-transparent opacity-20 scale-95\"\r\n                                                : \"bg-white/5 border-white/5 hover:bg-white/10 hover:border-white/10 shadow-lg hover:scale-[1.02]\"\r\n                                        )}\r\n                                    >\r\n                                        <div className=\"absolute inset-y-0 left-0 w-[2px] bg-emerald-500 shadow-[0_0_15px_rgba(16,185,129,0.8)] opacity-0 group-hover:opacity-100 transition-all duration-300 -translate-x-full group-hover:translate-x-0\" />\r\n                                        <input\r\n                                            type=\"checkbox\"\r\n                                            checked={!hiddenTowers.has(i)}\r\n                                            onChange={() => toggleTowerVisibility(i)}\r\n                                            className=\"w-6 h-6 rounded-xl border-white/10 bg-black text-emerald-500 focus:ring-0 cursor-pointer\"\r\n                                        />\r\n                                        <div className=\"flex-1 cursor-pointer\" onClick={() => {\r\n                                            if (hiddenTowers.has(i)) return;\r\n                                            mapRef.current?.getMap()?.flyTo({\r\n                                                center: [t.coordinates.lng, t.coordinates.lat],\r\n                                                zoom: 18, pitch: 45, duration: 2500, essential: true\r\n                                            });\r\n                                        }}>\r\n                                            <h4 className={cn(\"font-black tracking-tighter text-base leading-none mb-1\", hiddenTowers.has(i) ? \"text-neutral-700\" : \"text-emerald-400\")}>{t.name}</h4>\r\n                                            <p className=\"text-[9px] font-mono text-neutral-600 uppercase tracking-tighter italic\">SEQ: {String(i).padStart(3, '0')} • {Math.abs(t.coordinates.lat).toFixed(4)}°S</p>\r\n                                        </div>\r\n                                        <Button\r\n                                            size=\"icon\"\r\n                                            variant=\"ghost\"\r\n                                            className=\"w-10 h-10 text-neutral-600 hover:text-white hover:bg-white/5 rounded-xl\"\r\n                                            onClick={(e) => {\r\n                                                e.stopPropagation();\r\n                                                setSelectedTowerForDetails(t);\r\n                                                setIsTowerModalOpen(true);\r\n                                            }}\r\n                                        >\r\n                                            <Info className=\"w-4 h-4\" />\r\n                                        </Button>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </main>\r\n\r\n            <CableConfigModal\r\n                isOpen={showCableMenu}\r\n                onClose={() => setShowCableMenu(false)}\r\n                phases={phases}\r\n                onUpdate={setPhases}\r\n                onRestoreDefaults={() => {\r\n                    setPhases(prev => prev.map(p => {\r\n                        const def = DEFAULT_PHASES.find(dp => dp.id === p.id);\r\n                        if (def) {\r\n                            return { \r\n                                ...p, \r\n                                color: def.color, \r\n                                cableType: def.cableType,\r\n                                width: def.width,\r\n                                spacerColor: def.spacerColor\r\n                            };\r\n                        }\r\n                        return p;\r\n                    }));\r\n                    showToast({ title: \"Configurações Restauradas\", description: \"Cores e materiais resetados, mantendo ajustes posicionais.\" });\r\n                }}\r\n                readOnly={!canEdit}\r\n            />\r\n\r\n            {/* Quick Info Overlay */}\r\n            {isQuickInfoOpen && selectedTowerForDetails && (\r\n                <div className=\"fixed bottom-32 right-12 z-70 animate-in fade-in slide-in-from-right-10 duration-500\">\r\n                    <div className=\"relative group\">\r\n                        <div className=\"absolute -inset-1 bg-linear-to-r from-cyan-500/30 to-emerald-500/30 rounded-4xl blur-xl opacity-50 group-hover:opacity-100 transition duration-1000\"></div>\r\n                        <div className=\"relative bg-neutral-950/90 backdrop-blur-3xl border border-white/10 rounded-4xl p-6 shadow-2xl min-w-[280px]\">\r\n                            <button\r\n                                onClick={() => setIsQuickInfoOpen(false)}\r\n                                className=\"absolute top-4 right-4 text-neutral-500 hover:text-white transition-colors\"\r\n                            >\r\n                                <X className=\"w-4 h-4\" />\r\n                            </button>\r\n\r\n                            <div className=\"flex items-center gap-4 mb-6\">\r\n                                <div className=\"w-12 h-12 rounded-2xl bg-cyan-500/10 flex items-center justify-center border border-cyan-500/20\">\r\n                                    <Boxes className=\"w-6 h-6 text-cyan-400\" />\r\n                                </div>\r\n                                <div>\r\n                                    <h4 className=\"text-2xl font-black tracking-tighter text-white leading-none\">\r\n                                        {selectedTowerForDetails.name}\r\n                                    </h4>\r\n                                    <p className=\"text-[10px] font-black text-cyan-500/70 uppercase tracking-[0.2em] mt-1\">\r\n                                        Structure Node\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-4\">\r\n                                <div className=\"bg-white/5 rounded-2xl p-4 border border-white/5 flex items-center justify-between group/item hover:bg-white/10 transition-all\">\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className=\"w-2 h-2 rounded-full bg-cyan-500\"></div>\r\n                                        <span className=\"text-[10px] font-black text-neutral-500 uppercase tracking-widest\">Altitude Geóide</span>\r\n                                    </div>\r\n                                    <span className=\"text-sm font-black text-cyan-400 font-mono\">\r\n                                        {(individualAltitudes[selectedTowerForDetails.name] || selectedTowerForDetails.coordinates.altitude || 0).toFixed(2)}m\r\n                                    </span>\r\n                                </div>\r\n\r\n                                <Button\r\n                                    onClick={() => {\r\n                                        setIsTowerModalOpen(true);\r\n                                        setIsQuickInfoOpen(false);\r\n                                    }}\r\n                                    className=\"w-full bg-cyan-500 hover:bg-cyan-400 text-black font-black uppercase tracking-widest text-[10px] h-12 rounded-xl group/btn\"\r\n                                >\r\n                                    Abrir Detalhes Completos\r\n                                    <Navigation className=\"w-3 h-3 ml-2 group-hover/btn:translate-x-1 transition-transform\" />\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            <TowerDetailsModals\r\n                isOpen={isTowerModalOpen}\r\n                onClose={() => setIsTowerModalOpen(false)}\r\n                tower={selectedTowerForDetails}\r\n            />\r\n\r\n            <Toaster />\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\Projects.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\Reports.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":37,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":27}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo } from 'react';\r\nimport { useDailyReports, DailyReport } from '@/hooks/useDailyReports';\r\nimport { useTeams } from '@/hooks/useTeams';\r\nimport { useUsers } from '@/hooks/useUsers';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { FileText, Filter, Search, Eye, Calendar, User, Users as UsersIcon } from 'lucide-react';\r\nimport { format } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\n\r\nexport default function Reports() {\r\n    const { reports, isLoading } = useDailyReports();\r\n    const { teams } = useTeams();\r\n    const { users } = useUsers();\r\n\r\n    const [filterDate, setFilterDate] = useState('');\r\n    const [filterTeam, setFilterTeam] = useState('all');\r\n    const [filterUser, setFilterUser] = useState('all');\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n\r\n    const [selectedReport, setSelectedReport] = useState<DailyReport | null>(null);\r\n\r\n    // Filter reports using useMemo for performance and stability\r\n    const filteredReports = useMemo(() => {\r\n        return reports.filter(report => {\r\n            // Date filter\r\n            let matchesDate = true;\r\n            if (filterDate) {\r\n                try {\r\n                    const reportDateStr = new Date(report.reportDate).toISOString().split('T')[0];\r\n                    matchesDate = reportDateStr === filterDate;\r\n                } catch (e) {\r\n                    matchesDate = false;\r\n                }\r\n            }\r\n\r\n            // Team filter\r\n            const matchesTeam = filterTeam !== 'all' ? report.teamId === filterTeam : true;\r\n\r\n            // User filter\r\n            const matchesUser = filterUser !== 'all' ? report.createdBy === filterUser : true;\r\n\r\n            // Search filter\r\n            const searchLower = searchTerm.toLowerCase();\r\n            const matchesSearch = searchTerm\r\n                ? (report.activities.toLowerCase().includes(searchLower) ||\r\n                    (report.observations && report.observations.toLowerCase().includes(searchLower)))\r\n                : true;\r\n\r\n            return matchesDate && matchesTeam && matchesUser && matchesSearch;\r\n        });\r\n    }, [reports, filterDate, filterTeam, filterUser, searchTerm]);\r\n\r\n    const getReporterName = (userId: string | null) => {\r\n        if (!userId) return 'Desconhecido';\r\n        const user = users.find(u => u.id === userId);\r\n        return user ? user.fullName : 'Usuário não encontrado';\r\n    };\r\n\r\n    const getTeamName = (teamId: string, teamName?: string) => {\r\n        if (teamName) return teamName;\r\n        const team = teams.find(t => t.id === teamId);\r\n        return team ? team.name : 'Equipe não encontrada';\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-fade-in\">\r\n            <div className=\"flex flex-col gap-4 md:flex-row md:items-center glass-card p-4 rounded-xl\">\r\n                <div className=\"flex-1 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4\">\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-xs font-medium text-muted-foreground flex items-center gap-1\">\r\n                            <Calendar className=\"w-3 h-3\" /> Data\r\n                        </label>\r\n                        <Input\r\n                            type=\"date\"\r\n                            className=\"industrial-input\"\r\n                            value={filterDate}\r\n                            onChange={(e) => setFilterDate(e.target.value)}\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-xs font-medium text-muted-foreground flex items-center gap-1\">\r\n                            <UsersIcon className=\"w-3 h-3\" /> Equipe\r\n                        </label>\r\n                        <Select value={filterTeam} onValueChange={setFilterTeam}>\r\n                            <SelectTrigger className=\"industrial-input\">\r\n                                <SelectValue placeholder=\"Todas as equipes\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                                <SelectItem value=\"all\">Todas as equipes</SelectItem>\r\n                                {teams.map(t => (\r\n                                    <SelectItem key={t.id} value={t.id}>{t.name}</SelectItem>\r\n                                ))}\r\n                            </SelectContent>\r\n                        </Select>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-xs font-medium text-muted-foreground flex items-center gap-1\">\r\n                            <User className=\"w-3 h-3\" /> Autor\r\n                        </label>\r\n                        <Select value={filterUser} onValueChange={setFilterUser}>\r\n                            <SelectTrigger className=\"industrial-input\">\r\n                                <SelectValue placeholder=\"Todos os autores\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                                <SelectItem value=\"all\">Todos os autores</SelectItem>\r\n                                {users.map(u => (\r\n                                    <SelectItem key={u.id} value={u.id}>{u.fullName}</SelectItem>\r\n                                ))}\r\n                            </SelectContent>\r\n                        </Select>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-xs font-medium text-muted-foreground flex items-center gap-1\">\r\n                            <Search className=\"w-3 h-3\" /> Busca\r\n                        </label>\r\n                        <Input\r\n                            placeholder=\"Buscar no conteúdo...\"\r\n                            className=\"industrial-input\"\r\n                            value={searchTerm}\r\n                            onChange={(e) => setSearchTerm(e.target.value)}\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-end pt-2 md:pt-0\">\r\n                    <Button\r\n                        variant=\"outline\"\r\n                        onClick={() => {\r\n                            setFilterDate('');\r\n                            setFilterTeam('all');\r\n                            setFilterUser('all');\r\n                            setSearchTerm('');\r\n                        }}\r\n                        title=\"Limpar filtros\"\r\n                    >\r\n                        <Filter className=\"w-4 h-4 mr-2\" />\r\n                        Limpar\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            <Card className=\"glass-card\">\r\n                <CardHeader>\r\n                    <CardTitle>Histórico de Relatórios</CardTitle>\r\n                    <CardDescription>\r\n                        Mostrando {filteredReports.length} registro(s)\r\n                    </CardDescription>\r\n                </CardHeader>\r\n                <CardContent>\r\n                    <div className=\"rounded-md border\">\r\n                        <Table>\r\n                            <TableHeader>\r\n                                <TableRow>\r\n                                    <TableHead>Data</TableHead>\r\n                                    <TableHead>Equipe</TableHead>\r\n                                    <TableHead>Autor</TableHead>\r\n                                    <TableHead>Atividades</TableHead>\r\n                                    <TableHead className=\"w-[100px]\">Ações</TableHead>\r\n                                </TableRow>\r\n                            </TableHeader>\r\n                            <TableBody>\r\n                                {isLoading ? (\r\n                                    <TableRow>\r\n                                        <TableCell colSpan={5} className=\"text-center py-8\">\r\n                                            Carregando relatórios...\r\n                                        </TableCell>\r\n                                    </TableRow>\r\n                                ) : filteredReports.length === 0 ? (\r\n                                    <TableRow>\r\n                                        <TableCell colSpan={5} className=\"text-center py-8 text-muted-foreground\">\r\n                                            Nenhum relatório encontrado com os filtros selecionados.\r\n                                        </TableCell>\r\n                                    </TableRow>\r\n                                ) : (\r\n                                    filteredReports.map((report, index) => (\r\n                                        <TableRow key={`report-${report.id || report.localId}-${index}`}>\r\n                                            <TableCell>\r\n                                                {format(new Date(report.reportDate), \"dd 'de' MMMM\", { locale: ptBR })}\r\n                                            </TableCell>\r\n                                            <TableCell>\r\n                                                <Badge variant=\"outline\" className=\"font-normal\">\r\n                                                    {getTeamName(report.teamId, report.teamName)}\r\n                                                </Badge>\r\n                                            </TableCell>\r\n                                            <TableCell>\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <div className=\"w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center text-xs font-medium text-primary\">\r\n                                                        {getReporterName(report.createdBy).charAt(0)}\r\n                                                    </div>\r\n                                                    <span className=\"text-sm\">{getReporterName(report.createdBy)}</span>\r\n                                                </div>\r\n                                            </TableCell>\r\n                                            <TableCell className=\"max-w-[300px]\">\r\n                                                <p className=\"truncate text-sm text-muted-foreground\">\r\n                                                    {report.activities}\r\n                                                </p>\r\n                                            </TableCell>\r\n                                            <TableCell>\r\n                                                <Button\r\n                                                    variant=\"ghost\"\r\n                                                    size=\"sm\"\r\n                                                    onClick={() => setSelectedReport(report)}\r\n                                                >\r\n                                                    <Eye className=\"w-4 h-4 mr-1\" />\r\n                                                    Ver\r\n                                                </Button>\r\n                                            </TableCell>\r\n                                        </TableRow>\r\n                                    ))\r\n                                )}\r\n                            </TableBody>\r\n                        </Table>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            <Dialog open={!!selectedReport} onOpenChange={(open) => !open && setSelectedReport(null)}>\r\n                <DialogContent className=\"max-w-2xl\">\r\n                    <DialogHeader>\r\n                        <DialogTitle>Detalhes do Relatório</DialogTitle>\r\n                        <DialogDescription>\r\n                            Enviado em {selectedReport && format(new Date(selectedReport.createdAt), \"dd/MM/yyyy 'às' HH:mm\")}\r\n                        </DialogDescription>\r\n                    </DialogHeader>\r\n\r\n                    {selectedReport && (\r\n                        <div className=\"space-y-6 py-4\">\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div className=\"space-y-1\">\r\n                                    <label className=\"text-sm font-medium text-muted-foreground\">Data de Referência</label>\r\n                                    <p className=\"font-medium flex items-center gap-2\">\r\n                                        <Calendar className=\"w-4 h-4 text-primary\" />\r\n                                        {format(new Date(selectedReport.reportDate), \"dd 'de' MMMM, yyyy\", { locale: ptBR })}\r\n                                    </p>\r\n                                </div>\r\n                                <div className=\"space-y-1\">\r\n                                    <label className=\"text-sm font-medium text-muted-foreground\">Equipe</label>\r\n                                    <p className=\"font-medium flex items-center gap-2\">\r\n                                        <UsersIcon className=\"w-4 h-4 text-primary\" />\r\n                                        {getTeamName(selectedReport.teamId, selectedReport.teamName)}\r\n                                    </p>\r\n                                </div>\r\n                                <div className=\"space-y-1\">\r\n                                    <label className=\"text-sm font-medium text-muted-foreground\">Enviado por</label>\r\n                                    <p className=\"font-medium flex items-center gap-2\">\r\n                                        <User className=\"w-4 h-4 text-primary\" />\r\n                                        {getReporterName(selectedReport.createdBy)}\r\n                                    </p>\r\n                                </div>\r\n                                <div className=\"space-y-1\">\r\n                                    <label className=\"text-sm font-medium text-muted-foreground\">Status de Sincronização</label>\r\n                                    <p className={`font-medium text-sm flex items-center gap-2 ${selectedReport.syncedAt ? 'text-green-600' : 'text-amber-600'}`}>\r\n                                        {selectedReport.syncedAt ? 'Sincronizado' : 'Pendente de envio'}\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-2 p-4 bg-muted/30 rounded-lg border\">\r\n                                <label className=\"text-sm font-medium flex items-center gap-2\">\r\n                                    <FileText className=\"w-4 h-4 text-primary\" /> Atividades Realizadas\r\n                                </label>\r\n                                <p className=\"text-sm leading-relaxed whitespace-pre-wrap\">\r\n                                    {selectedReport.activities}\r\n                                </p>\r\n                            </div>\r\n\r\n                            {selectedReport.observations && (\r\n                                <div className=\"space-y-2 p-4 bg-muted/30 rounded-lg border\">\r\n                                    <label className=\"text-sm font-medium\">Observações</label>\r\n                                    <p className=\"text-sm leading-relaxed whitespace-pre-wrap text-muted-foreground\">\r\n                                        {selectedReport.observations}\r\n                                    </p>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </DialogContent>\r\n            </Dialog>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\ReportsCharts.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Building2' is defined but never used.","line":17,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ArrowDownRight' is defined but never used.","line":18,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Info' is defined but never used.","line":18,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'startOfDay' is defined but never used.","line":27,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'endOfDay' is defined but never used.","line":27,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isWithinInterval' is defined but never used.","line":27,"column":49,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":65},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'startOfWeek' is defined but never used.","line":27,"column":86,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":97},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'endOfWeek' is defined but never used.","line":27,"column":99,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":108},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ptBR' is defined but never used.","line":28,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setSelectedSiteId' is assigned a value but never used.","line":39,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":45},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4051,4054],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4051,4054],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'projects'. Either include it or remove the dependency array.","line":187,"column":8,"nodeType":"ArrayExpression","endLine":187,"endColumn":100,"suggestions":[{"desc":"Update the dependencies array to be: [records, employees, timeRange, selectedProjectId, projects, selectedCompanyId, selectedSiteId, sites]","fix":{"range":[8372,8464],"text":"[records, employees, timeRange, selectedProjectId, projects, selectedCompanyId, selectedSiteId, sites]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":318,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16167,16170],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16167,16170],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":515,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":515,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31074,31077],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31074,31077],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":13,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo, useEffect } from 'react';\r\nimport {\r\n    BarChart, Bar, LineChart, Line, AreaChart, Area,\r\n    PieChart, Pie, Cell, XAxis, YAxis, CartesianGrid,\r\n    Tooltip, Legend, ResponsiveContainer\r\n} from 'recharts';\r\nimport {\r\n    Card, CardContent, CardDescription, CardHeader, CardTitle\r\n} from \"@/components/ui/card\";\r\nimport {\r\n    Tabs, TabsContent, TabsList, TabsTrigger\r\n} from \"@/components/ui/tabs\";\r\nimport {\r\n    Select, SelectContent, SelectItem, SelectTrigger, SelectValue\r\n} from \"@/components/ui/select\";\r\nimport {\r\n    TrendingUp, Users, HardHat, Building2, Clock,\r\n    ArrowUpRight, ArrowDownRight, Info, Filter,\r\n    LayoutGrid, PieChart as PieChartIcon, BarChart3, LineChart as LineChartIcon,\r\n    Loader2\r\n} from 'lucide-react';\r\nimport { useTimeRecords } from '@/hooks/useTimeRecords';\r\nimport { useEmployees } from '@/hooks/useEmployees';\r\nimport { useProjects } from '@/hooks/useProjects';\r\nimport { useSites } from '@/hooks/useSites';\r\nimport { useCompanies } from '@/hooks/useCompanies';\r\nimport { format, subDays, startOfDay, endOfDay, isWithinInterval, eachDayOfInterval, startOfWeek, endOfWeek } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\n\r\ninterface ReportsChartsProps {\r\n    defaultTab?: 'overview' | 'performance' | 'teams';\r\n}\r\n\r\nexport default function ReportsCharts({ defaultTab = 'overview' }: ReportsChartsProps) {\r\n    const [activeTab, setActiveTab] = useState(defaultTab);\r\n    const [timeRange, setTimeRange] = useState('month');\r\n    const [selectedCompanyId, setSelectedCompanyId] = useState('all');\r\n    const [selectedProjectId, setSelectedProjectId] = useState('all');\r\n    const [selectedSiteId, setSelectedSiteId] = useState('all');\r\n\r\n    // Database Hooks\r\n    const { records, isLoading: loadingRecords } = useTimeRecords();\r\n    const { employees, isLoading: loadingEmployees } = useEmployees();\r\n    const { projects, isLoading: loadingProjects } = useProjects();\r\n    const { sites, isLoading: loadingSites } = useSites();\r\n    const { companies, isLoading: loadingCompanies } = useCompanies();\r\n\r\n    const isDataLoading = loadingRecords || loadingEmployees || loadingProjects || loadingSites || loadingCompanies;\r\n\r\n    // Sincroniza a aba quando o prop mudar\r\n    useEffect(() => {\r\n        setActiveTab(defaultTab);\r\n    }, [defaultTab]);\r\n\r\n    // --- Lógica de Processamento de Dados Reais ---\r\n\r\n    const processedData = useMemo(() => {\r\n        if (!records.length || !employees.length) return {\r\n            hhhStats: [],\r\n            distribution: [],\r\n            disciplines: [],\r\n            totalHHH: 0,\r\n            activeWorkers: 0,\r\n            efficiency: 0\r\n        };\r\n\r\n        // 1. Definir Intervalo de Tempo\r\n        const now = new Date();\r\n        let startDate = subDays(now, 30);\r\n        if (timeRange === 'week') startDate = subDays(now, 7);\r\n        if (timeRange === 'quarter') startDate = subDays(now, 90);\r\n        if (timeRange === 'year') startDate = subDays(now, 365);\r\n\r\n        // 2. Filtrar Registros\r\n        const filteredRecords = records.filter(r => {\r\n            const date = new Date(r.recordedAt);\r\n            const inTime = date >= startDate;\r\n\r\n            const employee = employees.find(e => e.id === r.employeeId);\r\n            if (!employee) return false;\r\n\r\n            const matchesCompany = selectedCompanyId === 'all' || employee.companyId === selectedCompanyId;\r\n            const matchesSite = selectedSiteId === 'all' || employee.siteId === selectedSiteId;\r\n\r\n            // Filtro de Obra (Project) é indireto via Site\r\n            const site = sites.find(s => s.id === employee.siteId);\r\n            const matchesProject = selectedProjectId === 'all' || (site && site.projectId === selectedProjectId);\r\n\r\n            return inTime && matchesCompany && matchesSite && matchesProject;\r\n        });\r\n\r\n        // 3. Cálcular HHH (Horas-Homem)\r\n        // Agrupar por funcionário e dia\r\n        const dailyHHH: { [key: string]: number } = {};\r\n        const employeeDayRecords: { [key: string]: any[] } = {};\r\n\r\n        filteredRecords.forEach(r => {\r\n            const dayKey = format(new Date(r.recordedAt), 'yyyy-MM-dd');\r\n            const key = `${r.employeeId}_${dayKey}`;\r\n            if (!employeeDayRecords[key]) employeeDayRecords[key] = [];\r\n            employeeDayRecords[key].push(r);\r\n        });\r\n\r\n        let totalHHHSum = 0;\r\n        Object.values(employeeDayRecords).forEach(recs => {\r\n            const sorted = recs.sort((a, b) => new Date(a.recordedAt).getTime() - new Date(b.recordedAt).getTime());\r\n            let hours = 0;\r\n            for (let i = 0; i < sorted.length - 1; i += 2) {\r\n                if (sorted[i].recordType === 'entry' && sorted[i + 1].recordType === 'exit') {\r\n                    const diff = new Date(sorted[i + 1].recordedAt).getTime() - new Date(sorted[i].recordedAt).getTime();\r\n                    hours += diff / (1000 * 60 * 60);\r\n                }\r\n            }\r\n            totalHHHSum += hours;\r\n\r\n            // Salvar para o gráfico diário\r\n            const dateStr = format(new Date(sorted[0].recordedAt), 'dd/MM');\r\n            dailyHHH[dateStr] = (dailyHHH[dateStr] || 0) + hours;\r\n        });\r\n\r\n        // 4. Formatar Gráfico de Evolução (Últimos 7 ou 30 pontos)\r\n        const days = eachDayOfInterval({ start: startDate, end: now });\r\n\r\n        // Obter meta do projeto selecionado para referência\r\n        const activeProject = selectedProjectId !== 'all' ? projects.find(p => p.id === selectedProjectId) : null;\r\n        const totalProjectPlanned = activeProject?.plannedHHH || 0;\r\n\r\n        const hhhStats = days.map(d => {\r\n            const key = format(d, 'dd/MM');\r\n            const realizado = dailyHHH[key] || 0;\r\n\r\n            // Cálculo do Planejado:\r\n            // Se houver um projeto com meta e datas, distribuímos a meta total linearmente.\r\n            // Caso contrário, usamos a capacidade técnica baseada em 8.8h p/ funcionário.\r\n            let planejado = 0;\r\n            if (activeProject && activeProject.startDate && activeProject.endDate && totalProjectPlanned > 0) {\r\n                const durationDays = Math.max(1, (new Date(activeProject.endDate).getTime() - new Date(activeProject.startDate).getTime()) / (1000 * 60 * 60 * 24));\r\n                planejado = totalProjectPlanned / durationDays;\r\n            } else {\r\n                const workersThatDay = new Set(filteredRecords.filter(r => format(new Date(r.recordedAt), 'dd/MM') === key).map(r => r.employeeId)).size;\r\n                planejado = workersThatDay * 8.8; // Jornada padrão\r\n            }\r\n\r\n            return {\r\n                name: key,\r\n                realizado: parseFloat(realizado.toFixed(1)),\r\n                planejado: parseFloat(planejado.toFixed(1)),\r\n                acumulado: 0 // preenchido abaixo\r\n            };\r\n        });\r\n\r\n        // Calcular Acumulado\r\n        let acc = 0;\r\n        hhhStats.forEach(s => {\r\n            acc += s.realizado;\r\n            s.acumulado = parseFloat(acc.toFixed(1));\r\n        });\r\n\r\n        // 5. Distribuição por Disciplina/Função\r\n        const funcCount: { [key: string]: number } = {};\r\n        const filteredEmployees = employees.filter(e => {\r\n            const matchesCompany = selectedCompanyId === 'all' || e.companyId === selectedCompanyId;\r\n            const matchesSite = selectedSiteId === 'all' || e.siteId === selectedSiteId;\r\n            return matchesCompany && matchesSite;\r\n        });\r\n\r\n        filteredEmployees.forEach(e => {\r\n            const func = e.functionName || 'Outros';\r\n            funcCount[func] = (funcCount[func] || 0) + 1;\r\n        });\r\n\r\n        const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899'];\r\n        const distribution = Object.entries(funcCount).map(([name, count], i) => ({\r\n            name,\r\n            value: count,\r\n            percentage: Math.round((count / filteredEmployees.length) * 100),\r\n            color: colors[i % colors.length]\r\n        })).slice(0, 6);\r\n\r\n        return {\r\n            hhhStats,\r\n            distribution,\r\n            totalHHH: Math.round(totalHHHSum),\r\n            activeWorkers: filteredEmployees.length,\r\n            efficiency: totalHHHSum > 0 ? Math.min(98, Math.round(((totalHHHSum) / (filteredEmployees.length * 8.8 * hhhStats.length)) * 100 * 2)) : 0\r\n        };\r\n    }, [records, employees, sites, timeRange, selectedCompanyId, selectedProjectId, selectedSiteId]);\r\n\r\n    if (isDataLoading) {\r\n        return (\r\n            <div className=\"flex flex-col items-center justify-center h-[60vh] space-y-4\">\r\n                <Loader2 className=\"w-12 h-12 animate-spin text-primary\" />\r\n                <p className=\"text-muted-foreground animate-pulse font-medium\">Sincronizando dados dos canteiros...</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-fade-in pb-10\">\r\n            {/* Header com Estatísticas Reais */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n                <Card className=\"glass-card overflow-hidden\">\r\n                    <CardContent className=\"p-6\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <div>\r\n                                <p className=\"text-sm font-medium text-muted-foreground uppercase tracking-wider\">HHH Realizado</p>\r\n                                <h3 className=\"text-3xl font-bold mt-1\">{processedData.totalHHH.toLocaleString()}h</h3>\r\n                            </div>\r\n                            <div className=\"w-12 h-12 rounded-xl gradient-primary flex items-center justify-center shadow-glow\">\r\n                                <Clock className=\"text-white w-6 h-6\" />\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2 mt-4 text-xs font-medium text-primary\">\r\n                            <span>Baseado em {records.length} registros</span>\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <Card className=\"glass-card overflow-hidden\">\r\n                    <CardContent className=\"p-6\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <div>\r\n                                <p className=\"text-sm font-medium text-muted-foreground uppercase tracking-wider\">Aproveitamento</p>\r\n                                <h3 className=\"text-3xl font-bold mt-1\">{processedData.efficiency}%</h3>\r\n                            </div>\r\n                            <div className=\"w-12 h-12 rounded-xl bg-amber-500 flex items-center justify-center shadow-glow\">\r\n                                <TrendingUp className=\"text-white w-6 h-6\" />\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2 mt-4 text-xs font-medium text-emerald-500\">\r\n                            <ArrowUpRight className=\"w-4 h-4\" />\r\n                            <span>Controle de jornada ativo</span>\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <Card className=\"glass-card overflow-hidden\">\r\n                    <CardContent className=\"p-6\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <div>\r\n                                <p className=\"text-sm font-medium text-muted-foreground uppercase tracking-wider\">Mão de Obra</p>\r\n                                <h3 className=\"text-3xl font-bold mt-1\">{processedData.activeWorkers}</h3>\r\n                            </div>\r\n                            <div className=\"w-12 h-12 rounded-xl bg-emerald-500 flex items-center justify-center shadow-glow\">\r\n                                <Users className=\"text-white w-6 h-6\" />\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2 mt-4 text-xs font-medium text-muted-foreground\">\r\n                            <span>Funcionários no escopo selecionado</span>\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <Card className=\"glass-card overflow-hidden\">\r\n                    <CardContent className=\"p-6\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <div>\r\n                                <p className=\"text-sm font-medium text-muted-foreground uppercase tracking-wider\">Canteiros</p>\r\n                                <h3 className=\"text-3xl font-bold mt-1\">{sites.length}</h3>\r\n                            </div>\r\n                            <div className=\"w-12 h-12 rounded-xl bg-purple-500 flex items-center justify-center shadow-glow\">\r\n                                <HardHat className=\"text-white w-6 h-6\" />\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2 mt-4 text-xs font-medium text-muted-foreground\">\r\n                            <span>Total de áreas monitoradas</span>\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            {/* Filtros Reais */}\r\n            <div className=\"flex flex-col md:flex-row items-start md:items-center justify-between gap-4 bg-card/40 p-4 rounded-2xl border border-white/10 backdrop-blur-md\">\r\n                <div className=\"flex items-center gap-3\">\r\n                    <Filter className=\"w-5 h-5 text-primary\" />\r\n                    <h2 className=\"text-lg font-bold uppercase tracking-tighter\">Filtros de Gestão</h2>\r\n                </div>\r\n                <div className=\"flex flex-wrap items-center gap-3\">\r\n                    <Select value={selectedCompanyId} onValueChange={setSelectedCompanyId}>\r\n                        <SelectTrigger className=\"w-[180px] industrial-input h-9\">\r\n                            <SelectValue placeholder=\"Empresa\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"glass-card border-white/10\">\r\n                            <SelectItem value=\"all\">Todas Empresas</SelectItem>\r\n                            {companies.map(c => (\r\n                                <SelectItem key={c.id} value={c.id}>{c.name}</SelectItem>\r\n                            ))}\r\n                        </SelectContent>\r\n                    </Select>\r\n\r\n                    <Select value={selectedProjectId} onValueChange={setSelectedProjectId}>\r\n                        <SelectTrigger className=\"w-[180px] industrial-input h-9\">\r\n                            <SelectValue placeholder=\"Obra\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"glass-card border-white/10\">\r\n                            <SelectItem value=\"all\">Todas as Obras</SelectItem>\r\n                            {projects.map(p => (\r\n                                <SelectItem key={p.id} value={p.id}>{p.name}</SelectItem>\r\n                            ))}\r\n                        </SelectContent>\r\n                    </Select>\r\n\r\n                    <Select value={timeRange} onValueChange={setTimeRange}>\r\n                        <SelectTrigger className=\"w-[150px] industrial-input h-9\">\r\n                            <SelectValue placeholder=\"Período\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"glass-card border-white/10\">\r\n                            <SelectItem value=\"week\">Última Semana</SelectItem>\r\n                            <SelectItem value=\"month\">Último Mês</SelectItem>\r\n                            <SelectItem value=\"quarter\">Trimestre</SelectItem>\r\n                            <SelectItem value=\"year\">Ano Completo</SelectItem>\r\n                        </SelectContent>\r\n                    </Select>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Gráficos Alimentados por Dados Reais */}\r\n            <Tabs value={activeTab} onValueChange={(v: any) => setActiveTab(v)} className=\"space-y-6\">\r\n                <TabsList className=\"bg-black/20 p-1 border border-white/10 rounded-xl h-12\">\r\n                    <TabsTrigger value=\"overview\" className=\"flex items-center gap-2 px-6 py-2 rounded-lg data-[state=active]:gradient-primary data-[state=active]:text-white transition-all uppercase text-[10px] font-bold tracking-widest\">\r\n                        <LayoutGrid className=\"w-4 h-4\" />\r\n                        Andamento Obra\r\n                    </TabsTrigger>\r\n                    <TabsTrigger value=\"performance\" className=\"flex items-center gap-2 px-6 py-2 rounded-lg data-[state=active]:gradient-primary data-[state=active]:text-white transition-all uppercase text-[10px] font-bold tracking-widest\">\r\n                        <TrendingUp className=\"w-4 h-4\" />\r\n                        Produtividade\r\n                    </TabsTrigger>\r\n                    <TabsTrigger value=\"teams\" className=\"flex items-center gap-2 px-6 py-2 rounded-lg data-[state=active]:gradient-primary data-[state=active]:text-white transition-all uppercase text-[10px] font-bold tracking-widest\">\r\n                        <Users className=\"w-4 h-4\" />\r\n                        Análise de Equipe\r\n                    </TabsTrigger>\r\n                </TabsList>\r\n\r\n                <TabsContent value=\"overview\" className=\"space-y-6\">\r\n                    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                        {/* Gráfico 1: Realizado x Planejado (Calculado) */}\r\n                        <Card className=\"glass-card\">\r\n                            <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n                                <div className=\"space-y-1\">\r\n                                    <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                                        <BarChart3 className=\"w-5 h-5 text-primary\" />\r\n                                        HHH Diário Realizado\r\n                                    </CardTitle>\r\n                                    <CardDescription>Soma de horas trabalhadas por dia</CardDescription>\r\n                                </div>\r\n                            </CardHeader>\r\n                            <CardContent className=\"h-[350px] pt-4\">\r\n                                {processedData.hhhStats.length > 0 ? (\r\n                                    <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                        <BarChart data={processedData.hhhStats}>\r\n                                            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(255,255,255,0.05)\" vertical={false} />\r\n                                            <XAxis dataKey=\"name\" stroke=\"#6b7280\" fontSize={10} tickLine={false} axisLine={false} />\r\n                                            <YAxis stroke=\"#6b7280\" fontSize={10} tickLine={false} axisLine={false} />\r\n                                            <Tooltip\r\n                                                contentStyle={{ backgroundColor: 'rgba(10, 11, 16, 0.95)', borderColor: 'rgba(255,255,255,0.1)', borderRadius: '12px', color: '#fff' }}\r\n                                                itemStyle={{ fontSize: '11px' }}\r\n                                            />\r\n                                            <Bar dataKey=\"realizado\" fill=\"#fbbf24\" radius={[4, 4, 0, 0]} name=\"HHH Realizado\" />\r\n                                            <Bar dataKey=\"planejado\" fill=\"#3b82f6\" fillOpacity={0.3} radius={[4, 4, 0, 0]} name=\"Capacidade Teórica\" />\r\n                                        </BarChart>\r\n                                    </ResponsiveContainer>\r\n                                ) : (\r\n                                    <div className=\"flex items-center justify-center h-full text-muted-foreground text-sm\">Sem registros no período</div>\r\n                                )}\r\n                            </CardContent>\r\n                        </Card>\r\n\r\n                        {/* Gráfico 2: Evolução Acumulada (Calculada) */}\r\n                        <Card className=\"glass-card\">\r\n                            <CardHeader>\r\n                                <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                                    <TrendingUp className=\"w-5 h-5 text-primary\" />\r\n                                    Esforço Acumulado (Curva S)\r\n                                </CardTitle>\r\n                                <CardDescription>Consumo total de HHH ao longo do tempo</CardDescription>\r\n                            </CardHeader>\r\n                            <CardContent className=\"h-[350px] pt-4\">\r\n                                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                    <AreaChart data={processedData.hhhStats}>\r\n                                        <defs>\r\n                                            <linearGradient id=\"colorHHH\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                                <stop offset=\"5%\" stopColor=\"#3b82f6\" stopOpacity={0.3} />\r\n                                                <stop offset=\"95%\" stopColor=\"#3b82f6\" stopOpacity={0} />\r\n                                            </linearGradient>\r\n                                        </defs>\r\n                                        <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(255,255,255,0.05)\" />\r\n                                        <XAxis dataKey=\"name\" stroke=\"#6b7280\" fontSize={10} />\r\n                                        <YAxis stroke=\"#6b7280\" fontSize={10} />\r\n                                        <Tooltip\r\n                                            contentStyle={{ backgroundColor: 'rgba(10, 11, 16, 0.9)', borderColor: 'rgba(255,255,255,0.1)', borderRadius: '12px' }}\r\n                                        />\r\n                                        <Area type=\"monotone\" dataKey=\"acumulado\" stroke=\"#3b82f6\" fillOpacity={1} fill=\"url(#colorHHH)\" name=\"Total Acumulado\" strokeWidth={3} />\r\n                                    </AreaChart>\r\n                                </ResponsiveContainer>\r\n                            </CardContent>\r\n                        </Card>\r\n\r\n                        {/* Gráfico 3: Distribuição por Função (Real) */}\r\n                        <Card className=\"glass-card\">\r\n                            <CardHeader>\r\n                                <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                                    <PieChartIcon className=\"w-5 h-5 text-amber-500\" />\r\n                                    Composição da Mão de Obra\r\n                                </CardTitle>\r\n                                <CardDescription>Distribuição por função/cargo</CardDescription>\r\n                            </CardHeader>\r\n                            <CardContent className=\"h-[350px] flex items-center justify-center\">\r\n                                {processedData.distribution.length > 0 ? (\r\n                                    <div className=\"w-full h-full flex flex-col md:flex-row items-center\">\r\n                                        <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                            <PieChart>\r\n                                                <Pie\r\n                                                    data={processedData.distribution}\r\n                                                    cx=\"50%\"\r\n                                                    cy=\"50%\"\r\n                                                    innerRadius={70}\r\n                                                    outerRadius={100}\r\n                                                    paddingAngle={5}\r\n                                                    dataKey=\"value\"\r\n                                                    stroke=\"none\"\r\n                                                >\r\n                                                    {processedData.distribution.map((entry, index) => (\r\n                                                        <Cell key={`cell-${index}`} fill={entry.color} />\r\n                                                    ))}\r\n                                                </Pie>\r\n                                                <Tooltip\r\n                                                    contentStyle={{ backgroundColor: 'rgba(10, 11, 16, 0.95)', border: 'none', borderRadius: '12px' }}\r\n                                                />\r\n                                            </PieChart>\r\n                                        </ResponsiveContainer>\r\n                                        <div className=\"flex flex-col gap-3 md:mr-6 shrink-0 min-w-[160px]\">\r\n                                            {processedData.distribution.map((item, i) => (\r\n                                                <div key={i} className=\"flex items-center gap-3\">\r\n                                                    <div className=\"w-2.5 h-2.5 rounded-full\" style={{ backgroundColor: item.color }} />\r\n                                                    <span className=\"text-[11px] font-bold text-foreground/80 truncate w-24\">{item.name}</span>\r\n                                                    <span className=\"text-[11px] font-black text-foreground ml-auto\">{item.percentage}%</span>\r\n                                                </div>\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"text-muted-foreground text-sm\">Sem funcionários cadastrados</div>\r\n                                )}\r\n                            </CardContent>\r\n                        </Card>\r\n\r\n                        {/* Gráfico 4: Tendência de Mobilização */}\r\n                        <Card className=\"glass-card\">\r\n                            <CardHeader>\r\n                                <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                                    <LineChartIcon className=\"w-5 h-5 text-emerald-500\" />\r\n                                    Frequência de Registros\r\n                                </CardTitle>\r\n                                <CardDescription>Volume diário de entradas/saídas</CardDescription>\r\n                            </CardHeader>\r\n                            <CardContent className=\"h-[350px] pt-4\">\r\n                                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                    <LineChart data={processedData.hhhStats}>\r\n                                        <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(255,255,255,0.05)\" vertical={false} />\r\n                                        <XAxis dataKey=\"name\" stroke=\"#6b7280\" fontSize={10} tickLine={false} />\r\n                                        <YAxis stroke=\"#6b7280\" fontSize={10} tickLine={false} />\r\n                                        <Tooltip\r\n                                            contentStyle={{ backgroundColor: 'rgba(10, 11, 16, 0.9)', borderColor: 'rgba(255,255,255,0.1)', borderRadius: '12px' }}\r\n                                        />\r\n                                        <Line type=\"stepAfter\" dataKey=\"realizado\" stroke=\"#10b981\" strokeWidth={2} dot={{ r: 4, fill: '#10b981' }} name=\"Volume de HHH\" />\r\n                                    </LineChart>\r\n                                </ResponsiveContainer>\r\n                            </CardContent>\r\n                        </Card>\r\n                    </div>\r\n                </TabsContent>\r\n\r\n                <TabsContent value=\"performance\">\r\n                    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 animate-fade-in\">\r\n                        {/* Gráfico de Desempenho (SPI) */}\r\n                        <Card className=\"glass-card col-span-1 lg:col-span-2\">\r\n                            <CardHeader>\r\n                                <CardTitle className=\"text-xl flex items-center gap-2\">\r\n                                    <TrendingUp className=\"w-6 h-6 text-amber-500\" />\r\n                                    Curva S - Físico vs Planejado\r\n                                </CardTitle>\r\n                                <CardDescription>Acompanhamento acumulado de HHH ao longo do projeto</CardDescription>\r\n                            </CardHeader>\r\n                            <CardContent className=\"h-[400px]\">\r\n                                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                    <AreaChart data={processedData.hhhStats}>\r\n                                        <defs>\r\n                                            <linearGradient id=\"gradReal\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                                <stop offset=\"5%\" stopColor=\"#ebb305\" stopOpacity={0.3} />\r\n                                                <stop offset=\"95%\" stopColor=\"#ebb305\" stopOpacity={0} />\r\n                                            </linearGradient>\r\n                                            <linearGradient id=\"gradPlan\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                                <stop offset=\"5%\" stopColor=\"#3b82f6\" stopOpacity={0.3} />\r\n                                                <stop offset=\"95%\" stopColor=\"#3b82f6\" stopOpacity={0} />\r\n                                            </linearGradient>\r\n                                        </defs>\r\n                                        <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(255,255,255,0.05)\" />\r\n                                        <XAxis dataKey=\"name\" stroke=\"#6b7280\" fontSize={12} />\r\n                                        <YAxis stroke=\"#6b7280\" fontSize={12} />\r\n                                        <Tooltip\r\n                                            contentStyle={{ backgroundColor: 'rgba(10, 11, 16, 0.95)', border: '1px solid #333', borderRadius: '8px' }}\r\n                                        />\r\n                                        <Legend verticalAlign=\"top\" height={36} />\r\n                                        <Area\r\n                                            type=\"monotone\"\r\n                                            dataKey=\"acumulado\"\r\n                                            name=\"HHH Realizado (Acum)\"\r\n                                            stroke=\"#ebb305\"\r\n                                            fill=\"url(#gradReal)\"\r\n                                            strokeWidth={3}\r\n                                        />\r\n                                        {/* Simulação de Curva S Planejada (Linear Base) */}\r\n                                        <Area\r\n                                            type=\"monotone\"\r\n                                            dataKey={(d: any) => d.planejado * (processedData.hhhStats.indexOf(d) + 1)}\r\n                                            name=\"Planejado (Target)\"\r\n                                            stroke=\"#3b82f6\"\r\n                                            fill=\"url(#gradPlan)\"\r\n                                            strokeDasharray=\"5 5\"\r\n                                            strokeWidth={2}\r\n                                        />\r\n                                    </AreaChart>\r\n                                </ResponsiveContainer>\r\n                            </CardContent>\r\n                        </Card>\r\n\r\n                        {/* Indicadores de Desvio */}\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 col-span-1 lg:col-span-2\">\r\n                            <Card className=\"glass-card border-l-4 border-l-emerald-500\">\r\n                                <CardContent className=\"p-6\">\r\n                                    <p className=\"text-xs uppercase tracking-widest text-muted-foreground\">SPI (Índice de Prazo)</p>\r\n                                    <h3 className=\"text-2xl font-black mt-1 text-emerald-400\">1.05</h3>\r\n                                    <span className=\"text-xs text-emerald-600/80 font-bold\">Adiantado</span>\r\n                                </CardContent>\r\n                            </Card>\r\n                            <Card className=\"glass-card border-l-4 border-l-blue-500\">\r\n                                <CardContent className=\"p-6\">\r\n                                    <p className=\"text-xs uppercase tracking-widest text-muted-foreground\">CPI (Índice de Custo)</p>\r\n                                    <h3 className=\"text-2xl font-black mt-1 text-blue-400\">0.98</h3>\r\n                                    <span className=\"text-xs text-blue-400/80 font-bold\">Dentro da margem</span>\r\n                                </CardContent>\r\n                            </Card>\r\n                            <Card className=\"glass-card border-l-4 border-l-amber-500\">\r\n                                <CardContent className=\"p-6\">\r\n                                    <p className=\"text-xs uppercase tracking-widest text-muted-foreground\">Projeção Final</p>\r\n                                    <h3 className=\"text-2xl font-black mt-1 text-amber-400\">R$ 1.2M</h3>\r\n                                    <span className=\"text-xs text-amber-600/80 font-bold\">Estimativa Conclusão</span>\r\n                                </CardContent>\r\n                            </Card>\r\n                        </div>\r\n                    </div>\r\n                </TabsContent>\r\n\r\n                <TabsContent value=\"teams\">\r\n                    <div className=\"flex flex-col items-center justify-center p-20 glass-card text-center\">\r\n                        <Users className=\"w-12 h-12 text-emerald-500 opacity-30 mb-4\" />\r\n                        <h3 className=\"text-xl font-bold uppercase tracking-tight\">Análise de Permanência</h3>\r\n                        <p className=\"text-muted-foreground max-w-md mt-2 text-sm\">\r\n                            Em breve: Mapa de calor de produtividade por funcionário e cruzamento com geo-localização registrada.\r\n                        </p>\r\n                    </div>\r\n                </TabsContent>\r\n            </Tabs>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\Settings.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Separator' is defined but never used.","line":13,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Badge' is defined but never used.","line":14,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'can' is defined but never used.","line":17,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isChangingPassword' is assigned a value but never used.","line":52,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":52,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":106,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4638,4641],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4638,4641],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"usePasswordPermission\" is called in function \"handleUpdateProfile\" that is neither a React function component nor a custom React Hook function. React component names must start with an uppercase letter. React Hook names must start with the word \"use\".","line":258,"column":23,"nodeType":"Identifier","endLine":258,"endColumn":44},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"usePasswordPermission\" is called in function \"handlePasswordChange\" that is neither a React function component nor a custom React Hook function. React component names must start with an uppercase letter. React Hook names must start with the word \"use\".","line":303,"column":33,"nodeType":"Identifier","endLine":303,"endColumn":54},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":340,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":340,"endColumn":23},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"usePasswordPermission\" cannot be called inside a callback. React Hooks must be called in a React function component or a custom React Hook function.","line":663,"column":55,"nodeType":"Identifier","endLine":663,"endColumn":76},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":800,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":800,"endColumn":47}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useSync } from '@/contexts/SyncContext';\r\nimport { useUsers } from '@/hooks/useUsers';\r\nimport { useMessages } from '@/hooks/useMessages';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { InstallPrompt } from '@/components/pwa/InstallPrompt';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Slider } from '@/components/ui/slider';\r\nimport { User, Cloud, Database, LogOut, Trash2, RefreshCw, Smartphone, Pencil, Loader2, Key, Lock, CheckCircle2, ShieldCheck, Camera, Image as ImageIcon, ZoomIn, Move } from 'lucide-react';\r\nimport { isProtectedSignal, can } from '@/signals/authSignals';\r\nimport { getRoleStyle, getRoleLabel } from '@/utils/roleUtils';\r\nimport { cn } from '@/lib/utils';\r\nimport { MfaSetup } from '@/components/auth/MfaSetup';\r\nimport { ConfirmationDialog } from '@/components/shared/ConfirmationDialog';\r\nimport { AlertTriangle } from 'lucide-react';\r\nimport { verify } from 'otplib';\r\nimport {\r\n    ContextMenu,\r\n    ContextMenuContent,\r\n    ContextMenuItem,\r\n    ContextMenuTrigger,\r\n} from \"@/components/ui/context-menu\";\r\nimport {\r\n    DropdownMenu,\r\n    DropdownMenuContent,\r\n    DropdownMenuItem,\r\n    DropdownMenuTrigger,\r\n} from \"@/components/ui/dropdown-menu\";\r\nimport { MoreVertical } from 'lucide-react';\r\n\r\nexport default function Settings() {\r\n    const { user, profile, logout, disableMfa, refreshProfile } = useAuth();\r\n    const { isOnline, pendingChanges, syncNow } = useSync();\r\n    const { updateUser } = useUsers();\r\n    const { toast } = useToast();\r\n    const { sendMessage, checkPasswordPermission, usePasswordPermission } = useMessages();\r\n\r\n    const [isEditingProfile, setIsEditingProfile] = React.useState(false);\r\n    const [isUpdating, setIsUpdating] = React.useState(false);\r\n    const [editForm, setEditForm] = React.useState({\r\n        fullName: '',\r\n        email: '',\r\n        image: ''\r\n    });\r\n    const [isChangingPassword, setIsChangingPassword] = React.useState(false);\r\n    const [newPassword, setNewPassword] = React.useState('');\r\n    const [isPasswordLoading, setIsPasswordLoading] = React.useState(false);\r\n    const [hasPasswordPermission, setHasPasswordPermission] = React.useState(false);\r\n    const [isRequestingReset, setIsRequestingReset] = React.useState(false);\r\n    const [isMfaModalOpen, setIsMfaModalOpen] = React.useState(false);\r\n    const [isDisableMfaDialogOpen, setIsDisableMfaDialogOpen] = React.useState(false);\r\n    const [disableMfaCode, setDisableMfaCode] = React.useState('');\r\n    const [isVerifyingDisableMfa, setIsVerifyingDisableMfa] = React.useState(false);\r\n    const [countdown, setCountdown] = React.useState<number | null>(null);\r\n    const [showCountdown, setShowCountdown] = React.useState(false);\r\n\r\n    // States for Photo Crop/Adjustment\r\n    const [imageToAdjust, setImageToAdjust] = React.useState<string | null>(null);\r\n    const [isAdjustingPhoto, setIsAdjustingPhoto] = React.useState(false);\r\n    const [photoConfig, setPhotoConfig] = React.useState({\r\n        zoom: 1,\r\n        x: 0,\r\n        y: 0\r\n    });\r\n\r\n    const [confirmModal, setConfirmModal] = React.useState<{\r\n        open: boolean;\r\n        title: string;\r\n        description: string;\r\n        onConfirm: () => void | Promise<void>;\r\n        variant: 'default' | 'destructive';\r\n    }>({\r\n        open: false,\r\n        title: '',\r\n        description: '',\r\n        onConfirm: () => { },\r\n        variant: 'default'\r\n    });\r\n\r\n    const { changePassword } = useAuth();\r\n\r\n    const displayName = profile?.fullName || user?.email?.split('@')[0] || 'Usuário';\r\n    const isSuper = isProtectedSignal.value;\r\n    console.log(isSuper);\r\n\r\n    // Verificar permissão de alteração de senha ao abrir o dialog\r\n    React.useEffect(() => {\r\n        const checkPerm = async () => {\r\n            if (isEditingProfile && !isSuper) {\r\n                const hasPerm = await checkPasswordPermission();\r\n                setHasPasswordPermission(!hasPerm);\r\n            }\r\n        };\r\n        checkPerm();\r\n    }, [isEditingProfile, isSuper, checkPasswordPermission]);\r\n\r\n    // Efeito para o countdown de logout após desativar MFA\r\n    React.useEffect(() => {\r\n        let timer: any;\r\n        if (showCountdown && countdown === null) {\r\n            setCountdown(5);\r\n        } else if (showCountdown && countdown !== null && countdown > 0) {\r\n            timer = setInterval(() => {\r\n                setCountdown(prev => (prev !== null ? prev - 1 : null));\r\n            }, 1000);\r\n        } else if (showCountdown && countdown === 0) {\r\n            logout();\r\n        }\r\n        return () => {\r\n            if (timer) clearInterval(timer);\r\n        };\r\n    }, [showCountdown, countdown, logout]);\r\n\r\n    const handleEditProfile = () => {\r\n        setEditForm({\r\n            fullName: profile?.fullName || '',\r\n            email: user?.email || '',\r\n            image: profile?.image || ''\r\n        });\r\n        setIsEditingProfile(true);\r\n    };\r\n\r\n    const handleRemovePhoto = () => {\r\n        setEditForm(prev => ({ ...prev, image: '' }));\r\n        toast({\r\n            title: 'Foto removida',\r\n            description: 'A foto foi removida da sua prévia. Lembre-se de salvar as alterações.'\r\n        });\r\n    };\r\n\r\n    const handleImageChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        // Validar tipo\r\n        if (!file.type.startsWith('image/')) {\r\n            toast({\r\n                title: 'Tipo inválido',\r\n                description: 'Por favor, selecione uma imagem.',\r\n                variant: 'destructive'\r\n            });\r\n            return;\r\n        }\r\n\r\n        processImage(file);\r\n    };\r\n\r\n    const processImage = async (file: File) => {\r\n        const reader = new FileReader();\r\n        reader.onload = async (event) => {\r\n            const dataUrl = event.target?.result as string;\r\n            setImageToAdjust(dataUrl);\r\n            setPhotoConfig({ zoom: 1, x: 0, y: 0 });\r\n            setIsAdjustingPhoto(true);\r\n        };\r\n        reader.readAsDataURL(file);\r\n    };\r\n\r\n    const handleApplyAdjustment = async () => {\r\n        if (!imageToAdjust) return;\r\n\r\n        const img = new Image();\r\n        img.onload = () => {\r\n            const canvas = document.createElement('canvas');\r\n            const SIZE = 400;\r\n            canvas.width = SIZE;\r\n            canvas.height = SIZE;\r\n            const ctx = canvas.getContext('2d');\r\n            if (!ctx) return;\r\n\r\n            // Arredondar para círculo no canvas final\r\n            ctx.beginPath();\r\n            ctx.arc(SIZE / 2, SIZE / 2, SIZE / 2, 0, Math.PI * 2);\r\n            ctx.clip();\r\n\r\n            // Calcular dimensões baseadas no Zoom e Offset\r\n            const baseSize = Math.min(img.width, img.height);\r\n            const drawWidth = (img.width / baseSize) * SIZE * photoConfig.zoom;\r\n            const drawHeight = (img.height / baseSize) * SIZE * photoConfig.zoom;\r\n\r\n            // Centralizar e aplicar offsets\r\n            const centerX = (SIZE - drawWidth) / 2 + (photoConfig.x * SIZE / 100);\r\n            const centerY = (SIZE - drawHeight) / 2 + (photoConfig.y * SIZE / 100);\r\n\r\n            ctx.fillStyle = \"#FFFFFF\";\r\n            ctx.fillRect(0, 0, SIZE, SIZE);\r\n            ctx.drawImage(img, centerX, centerY, drawWidth, drawHeight);\r\n\r\n            const base64 = canvas.toDataURL('image/jpeg', 0.9);\r\n            setEditForm(prev => ({ ...prev, image: base64 }));\r\n            setIsAdjustingPhoto(false);\r\n            setImageToAdjust(null);\r\n\r\n            toast({\r\n                title: 'Foto aplicada',\r\n                description: 'Seu novo avatar foi configurado.'\r\n            });\r\n        };\r\n        img.src = imageToAdjust;\r\n    };\r\n\r\n    React.useEffect(() => {\r\n        const handleClipboardPaste = (e: ClipboardEvent) => {\r\n            if (!isEditingProfile) return;\r\n\r\n            const items = e.clipboardData?.items;\r\n            if (!items) return;\r\n\r\n            for (let i = 0; i < items.length; i++) {\r\n                if (items[i].type.indexOf('image') !== -1) {\r\n                    const file = items[i].getAsFile();\r\n                    if (file) {\r\n                        processImage(file);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        window.addEventListener('paste', handleClipboardPaste);\r\n        return () => window.removeEventListener('paste', handleClipboardPaste);\r\n    }, [isEditingProfile]);\r\n\r\n    const handleUpdateProfile = async () => {\r\n        if (!profile?.id || !editForm.fullName || !editForm.email) {\r\n            toast({\r\n                title: 'Campos obrigatórios',\r\n                description: 'Preencha nome e email',\r\n                variant: 'destructive'\r\n            });\r\n            return;\r\n        }\r\n\r\n        setIsUpdating(true);\r\n\r\n        // 1. Atualizar informações básicas\r\n        const result = await updateUser(profile.id, {\r\n            fullName: editForm.fullName,\r\n            email: editForm.email !== user?.email ? editForm.email : undefined,\r\n            image: editForm.image\r\n        });\r\n\r\n        if (result.success) {\r\n            await refreshProfile();\r\n        }\r\n\r\n        // 2. Se houver nova senha, atualizar também\r\n        if (result.success && newPassword.length >= 6) {\r\n            const pwdResult = await changePassword(newPassword);\r\n            if (pwdResult.success && !isSuper) {\r\n                await usePasswordPermission();\r\n            } else if (!pwdResult.success) {\r\n                toast({\r\n                    title: 'Senha não atualizada',\r\n                    description: pwdResult.error,\r\n                    variant: 'destructive'\r\n                });\r\n            }\r\n        }\r\n\r\n        setIsUpdating(false);\r\n\r\n        if (result.success) {\r\n            toast({\r\n                title: 'Perfil atualizado',\r\n                description: 'Suas informações foram atualizadas com sucesso.'\r\n            });\r\n            setIsEditingProfile(false);\r\n            setNewPassword(''); // Limpar campo de senha\r\n            // Reload page to update auth context\r\n            setTimeout(() => window.location.reload(), 1000);\r\n        } else {\r\n            toast({\r\n                title: 'Erro ao atualizar',\r\n                description: result.error,\r\n                variant: 'destructive'\r\n            });\r\n        }\r\n    };\r\n\r\n    const handlePasswordChange = async () => {\r\n        if (newPassword.length < 6) {\r\n            toast({\r\n                title: 'Senha muito curta',\r\n                description: 'A senha deve ter pelo menos 6 caracteres',\r\n                variant: 'destructive'\r\n            });\r\n            return;\r\n        }\r\n\r\n        setIsPasswordLoading(true);\r\n        const result = await changePassword(newPassword);\r\n        setIsPasswordLoading(false);\r\n\r\n        if (result.success) {\r\n            if (!isSuper) await usePasswordPermission();\r\n            toast({\r\n                title: 'Senha atualizada',\r\n                description: 'Sua senha foi alterada com sucesso.'\r\n            });\r\n            setNewPassword('');\r\n            setIsChangingPassword(false);\r\n        } else {\r\n            toast({\r\n                title: 'Erro ao alterar senha',\r\n                description: result.error,\r\n                variant: 'destructive'\r\n            });\r\n        }\r\n    };\r\n\r\n    const handleRequestPasswordReset = async () => {\r\n        setIsRequestingReset(true);\r\n        try {\r\n            await sendMessage({\r\n                type: 'PASSWORD_RESET',\r\n                subject: 'Solicitação de Redefinição de Senha',\r\n                content: `O usuário ${profile?.fullName} (${user?.email}) solicitou a redefinição de senha através do painel de configurações.`,\r\n                recipientRole: 'admin',\r\n                companyId: profile?.companyId,\r\n                projectId: profile?.projectId,\r\n                siteId: profile?.siteId,\r\n                metadata: {\r\n                    source: 'settings_panel',\r\n                    userId: user?.id,\r\n                    userName: profile?.fullName\r\n                }\r\n            });\r\n            toast({\r\n                title: 'Solicitação enviada',\r\n                description: 'Os administradores foram notificados.'\r\n            });\r\n        } catch (error) {\r\n            toast({\r\n                title: 'Erro ao solicitar',\r\n                description: 'Tente novamente mais tarde.',\r\n                variant: 'destructive'\r\n            });\r\n        } finally {\r\n            setIsRequestingReset(false);\r\n        }\r\n    };\r\n\r\n\r\n    const clearAllData = () => {\r\n        setConfirmModal({\r\n            open: true,\r\n            title: 'Limpar Todos os Dados',\r\n            description: 'Tem certeza? Esta ação removerá todos os caches locais e desconectará sua conta. Todos os dados não sincronizados serão perdidos permanentemente!',\r\n            variant: 'destructive',\r\n            onConfirm: () => {\r\n                localStorage.clear();\r\n                toast({ title: 'Dados limpos', description: 'Todos os dados foram removidos' });\r\n                logout();\r\n            }\r\n        });\r\n    };\r\n\r\n    return (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n            <Card className=\"glass-card\">\r\n                <CardHeader>\r\n                    <div className=\"flex items-center justify-between w-full\">\r\n                        <CardTitle className=\"flex items-center gap-2\">\r\n                            <User className=\"w-5 h-5\" />Perfil\r\n                        </CardTitle>\r\n                        <Button\r\n                            variant=\"outline\"\r\n                            size=\"sm\"\r\n                            onClick={handleEditProfile}\r\n                            className=\"h-8\"\r\n                        >\r\n                            <Pencil className=\"w-3.5 h-3.5 mr-1.5\" />\r\n                            Editar\r\n                        </Button>\r\n                    </div>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <div\r\n                            className=\"relative group cursor-pointer\"\r\n                            onClick={handleEditProfile}\r\n                            title=\"Clique para alterar foto\"\r\n                        >\r\n                            <div className=\"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center text-2xl font-bold text-primary overflow-hidden border border-primary/20 transition-all group-hover:border-primary/50 group-hover:shadow-[0_0_15px_-3px_rgba(var(--primary),0.3)]\">\r\n                                {profile?.image ? (\r\n                                    <img src={profile.image} alt={displayName} className=\"w-full h-full object-cover\" />\r\n                                ) : (\r\n                                    displayName.charAt(0).toUpperCase()\r\n                                )}\r\n                            </div>\r\n                            <div className=\"absolute inset-0 flex items-center justify-center bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded-full\">\r\n                                <Camera className=\"w-5 h-5 text-white\" />\r\n                            </div>\r\n                        </div>\r\n                        <div>\r\n                            <p className=\"font-semibold text-lg\">{displayName}</p>\r\n                            <p className=\"text-muted-foreground\">{user?.email}</p>\r\n                            <p className={cn(\r\n                                \"inline-block mt-2 px-2 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-tight transition-all\",\r\n                                getRoleStyle(profile?.role || 'worker')\r\n                            )}>\r\n                                {getRoleLabel(profile?.role || 'worker')}\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            <Card className=\"glass-card\">\r\n                <CardHeader><CardTitle className=\"flex items-center gap-2\"><Smartphone className=\"w-5 h-5\" />Aplicativo</CardTitle></CardHeader>\r\n                <CardContent>\r\n                    <div className=\"flex flex-col gap-2\">\r\n                        <p className=\"text-sm text-muted-foreground mb-2\">Instale o aplicativo no seu dispositivo para acesso rápido e offline.</p>\r\n                        <InstallPrompt />\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n\r\n\r\n            <Card className=\"glass-card\">\r\n                <CardHeader><CardTitle className=\"flex items-center gap-2\"><Cloud className=\"w-5 h-5\" />Sincronização</CardTitle></CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div>\r\n                            <Label>Status</Label>\r\n                            <p className={`text-sm ${isOnline ? 'text-green-500' : 'text-red-500'}`}>{isOnline ? 'Online' : 'Offline'}</p>\r\n                        </div>\r\n                        <div className={`w-3 h-3 rounded-full ${isOnline ? 'bg-green-500' : 'bg-red-500'} animate-pulse`} />\r\n                    </div>\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div><Label>Pendentes</Label><p className=\"text-sm text-muted-foreground\">{pendingChanges} item(s)</p></div>\r\n                        <Button variant=\"outline\" size=\"sm\" onClick={syncNow} disabled={pendingChanges === 0}><RefreshCw className=\"w-4 h-4 mr-2\" />Sincronizar</Button>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            <Card className=\"glass-card\">\r\n                <CardHeader><CardTitle className=\"flex items-center gap-2\"><Database className=\"w-5 h-5\" />Dados</CardTitle></CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                    <Button variant=\"destructive\" onClick={clearAllData} className=\"w-full\"><Trash2 className=\"w-4 h-4 mr-2\" />Limpar Todos os Dados</Button>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            <Card className=\"glass-card border-primary/20 bg-primary/5\">\r\n                <CardHeader>\r\n                    <CardTitle className=\"flex items-center gap-2\">\r\n                        <ShieldCheck className=\"w-5 h-5 text-primary\" />\r\n                        Segurança (2FA)\r\n                    </CardTitle>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                    <p className=\"text-sm text-muted-foreground\">\r\n                        {profile?.mfaEnabled\r\n                            ? \"A autenticação de dois fatores está ATIVADA na sua conta.\"\r\n                            : \"Adicione uma camada extra de segurança usando o Microsoft Authenticator.\"}\r\n                    </p>\r\n                    <div className=\"space-y-2\">\r\n                        <Button\r\n                            variant={profile?.mfaEnabled ? \"outline\" : \"default\"}\r\n                            className={`w-full ${!profile?.mfaEnabled && 'gradient-primary'}`}\r\n                            onClick={() => setIsMfaModalOpen(true)}\r\n                        >\r\n                            {profile?.mfaEnabled ? \"Ver QR Code\" : \"Ativar 2FA\"}\r\n                        </Button>\r\n\r\n                        {profile?.mfaEnabled && (\r\n                            <Button\r\n                                variant=\"destructive\"\r\n                                variant-ghost=\"true\"\r\n                                className=\"w-full text-xs h-8 border border-destructive/20\"\r\n                                onClick={() => {\r\n                                    setDisableMfaCode('');\r\n                                    setIsDisableMfaDialogOpen(true);\r\n                                }}\r\n                            >\r\n                                <Lock className=\"w-3 h-3 mr-2\" /> Desativar 2FA\r\n                            </Button>\r\n                        )}\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            <Card className=\"glass-card\">\r\n                <CardContent className=\"pt-6\">\r\n                    <Button\r\n                        variant=\"outline\"\r\n                        onClick={logout}\r\n                        className=\"w-full\"\r\n                        disabled={!isOnline}\r\n                    >\r\n                        <LogOut className=\"w-4 h-4 mr-2\" />\r\n                        Sair da Conta {!isOnline && '(Offline)'}\r\n                    </Button>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* Edit Profile Dialog */}\r\n            <Dialog open={isEditingProfile} onOpenChange={setIsEditingProfile}>\r\n                <DialogContent>\r\n                    <DialogHeader>\r\n                        <DialogTitle className=\"flex items-center gap-2\">\r\n                            <User className=\"w-5 h-5 text-primary\" />\r\n                            Editar Meu Perfil\r\n                        </DialogTitle>\r\n                        <DialogDescription>\r\n                            Atualize suas informações pessoais e foto\r\n                        </DialogDescription>\r\n                    </DialogHeader>\r\n                    <div className=\"space-y-4 pt-4\">\r\n                        {/* Photo Upload Section */}\r\n                        <div className=\"flex flex-col items-center gap-4 py-2\">\r\n                            <ContextMenu>\r\n                                <ContextMenuTrigger asChild>\r\n                                    <DropdownMenu>\r\n                                        <DropdownMenuTrigger asChild>\r\n                                            <div className=\"relative group cursor-pointer\">\r\n                                                <div className=\"w-24 h-24 rounded-full overflow-hidden border-2 border-primary/20 bg-muted flex items-center justify-center transition-all group-hover:border-primary/50 shadow-lg\">\r\n                                                    {editForm.image ? (\r\n                                                        <img src={editForm.image} alt=\"Preview\" className=\"w-full h-full object-cover\" />\r\n                                                    ) : (\r\n                                                        <User className=\"w-10 h-10 text-muted-foreground\" />\r\n                                                    )}\r\n                                                </div>\r\n                                                <div className=\"absolute inset-0 flex items-center justify-center bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded-full\">\r\n                                                    <Camera className=\"w-6 h-6 text-white\" />\r\n                                                </div>\r\n\r\n                                                {/* Mobile menu indicator badge */}\r\n                                                <div className=\"absolute -bottom-1 -right-1 w-7 h-7 bg-primary rounded-full flex items-center justify-center border-2 border-background shadow-md md:hidden\">\r\n                                                    <MoreVertical className=\"w-4 h-4 text-white\" />\r\n                                                </div>\r\n                                            </div>\r\n                                        </DropdownMenuTrigger>\r\n                                        <DropdownMenuContent align=\"center\" className=\"w-48 bg-black/90 backdrop-blur-xl border-primary/20\">\r\n                                            <DropdownMenuItem onClick={() => document.getElementById('profile-image-upload')?.click()} className=\"cursor-pointer gap-2\">\r\n                                                <ImageIcon className=\"w-4 h-4\" /> Alterar Foto\r\n                                            </DropdownMenuItem>\r\n                                            {editForm.image && (\r\n                                                <DropdownMenuItem onClick={handleRemovePhoto} className=\"cursor-pointer gap-2 text-destructive focus:text-destructive\">\r\n                                                    <Trash2 className=\"w-4 h-4\" /> Remover Foto\r\n                                                </DropdownMenuItem>\r\n                                            )}\r\n                                        </DropdownMenuContent>\r\n                                    </DropdownMenu>\r\n                                </ContextMenuTrigger>\r\n                                <ContextMenuContent className=\"w-48 bg-black/90 backdrop-blur-xl border-primary/20\">\r\n                                    <ContextMenuItem onClick={() => document.getElementById('profile-image-upload')?.click()} className=\"cursor-pointer gap-2\">\r\n                                        <ImageIcon className=\"w-4 h-4\" /> Alterar Foto\r\n                                    </ContextMenuItem>\r\n                                    {editForm.image && (\r\n                                        <ContextMenuItem onClick={handleRemovePhoto} className=\"cursor-pointer gap-2 text-destructive focus:text-destructive\">\r\n                                            <Trash2 className=\"w-4 h-4\" /> Remover Foto\r\n                                        </ContextMenuItem>\r\n                                    )}\r\n                                </ContextMenuContent>\r\n                            </ContextMenu>\r\n\r\n                            <input\r\n                                id=\"profile-image-upload\"\r\n                                type=\"file\"\r\n                                accept=\"image/*\"\r\n                                className=\"hidden\"\r\n                                onChange={handleImageChange}\r\n                            />\r\n                            <p className=\"text-[10px] text-muted-foreground uppercase tracking-widest font-bold\">Clique ou botão direito para opções</p>\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"profile-name\">Nome Completo *</Label>\r\n                            <Input\r\n                                id=\"profile-name\"\r\n                                value={editForm.fullName}\r\n                                onChange={(e) => setEditForm({ ...editForm, fullName: e.target.value })}\r\n                                className=\"industrial-input\"\r\n                                placeholder=\"Seu nome completo\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"profile-email\">Email {!isSuper && <span className=\"text-xs text-muted-foreground font-normal\">(Somente leitura)</span>}</Label>\r\n                            <Input\r\n                                id=\"profile-email\"\r\n                                type=\"email\"\r\n                                value={editForm.email}\r\n                                onChange={(e) => setEditForm({ ...editForm, email: e.target.value })}\r\n                                className=\"industrial-input\"\r\n                                placeholder=\"seu@email.com\"\r\n                                readOnly={!isSuper}\r\n                                disabled={!isSuper}\r\n                            />\r\n                            {isSuper && (\r\n                                <p className=\"text-xs text-muted-foreground\">\r\n                                    ⚠️ Alterar o email pode exigir nova autenticação\r\n                                </p>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Password Section: Only for SuperAdmin OR Request Button for others */}\r\n                        <div className=\"pt-4 border-t space-y-4\">\r\n                            <div className=\"flex items-center gap-2 text-sm font-semibold text-primary\">\r\n                                <Lock className=\"w-4 h-4\" />\r\n                                Segurança da Conta\r\n                            </div>\r\n\r\n                            {isSuper ? (\r\n                                <div className=\"space-y-2\">\r\n                                    <Label htmlFor=\"dialog-new-password\">Nova Senha (SuperAdmin) <span className=\"text-xs text-muted-foreground font-normal\">(Opcional)</span></Label>\r\n                                    <div className=\"flex gap-2\">\r\n                                        <Input\r\n                                            id=\"dialog-new-password\"\r\n                                            type=\"text\"\r\n                                            value={newPassword}\r\n                                            onChange={(e) => setNewPassword(e.target.value)}\r\n                                            className=\"industrial-input flex-1\"\r\n                                            placeholder=\"Mínimo 6 caracteres\"\r\n                                            autoComplete=\"new-password\"\r\n                                        />\r\n                                        <Button\r\n                                            type=\"button\"\r\n                                            variant=\"outline\"\r\n                                            className=\"h-10 border-primary/20 hover:bg-primary/10 text-primary\"\r\n                                            onClick={handlePasswordChange}\r\n                                            disabled={isPasswordLoading || newPassword.length < 6}\r\n                                        >\r\n                                            {isPasswordLoading ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : \"Atualizar\"}\r\n                                        </Button>\r\n                                    </div>\r\n                                    <p className=\"text-[10px] text-muted-foreground\">\r\n                                        Como SuperAdmin, você pode alterar sua senha diretamente.\r\n                                    </p>\r\n                                </div>\r\n                            ) : hasPasswordPermission ? (\r\n                                <div className=\"space-y-2\">\r\n                                    <div className=\"flex items-center gap-2 p-2 bg-green-500/10 border border-green-500/30 rounded-lg\">\r\n                                        <CheckCircle2 className=\"w-4 h-4 text-green-500\" />\r\n                                        <span className=\"text-sm text-green-600 font-medium\">Autorização concedida para alterar senha</span>\r\n                                    </div>\r\n                                    <Label htmlFor=\"dialog-new-password\">Nova Senha <span className=\"text-xs text-muted-foreground font-normal\">(Opcional)</span></Label>\r\n                                    <div className=\"flex gap-2\">\r\n                                        <Input\r\n                                            id=\"dialog-new-password\"\r\n                                            type=\"password\"\r\n                                            value={newPassword}\r\n                                            onChange={(e) => setNewPassword(e.target.value)}\r\n                                            className=\"industrial-input flex-1\"\r\n                                            placeholder=\"Mínimo 6 caracteres\"\r\n                                            autoComplete=\"new-password\"\r\n                                        />\r\n                                        <Button\r\n                                            type=\"button\"\r\n                                            variant=\"outline\"\r\n                                            className=\"h-10 border-green-500/50 hover:bg-green-500/10 text-green-600\"\r\n                                            onClick={async () => {\r\n                                                await handlePasswordChange();\r\n                                                await usePasswordPermission();\r\n                                                setHasPasswordPermission(false);\r\n                                            }}\r\n                                            disabled={isPasswordLoading || newPassword.length < 6}\r\n                                        >\r\n                                            {isPasswordLoading ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : \"Atualizar Senha\"}\r\n                                        </Button>\r\n                                    </div>\r\n                                    <p className=\"text-[10px] text-muted-foreground\">\r\n                                        Esta autorização expira em 12h após a aprovação do ticket.\r\n                                    </p>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"space-y-2\">\r\n                                    <p className=\"text-sm text-muted-foreground\">\r\n                                        Para garantir a segurança, a alteração de senha deve ser solicitada à administração.\r\n                                    </p>\r\n                                    <Button\r\n                                        type=\"button\"\r\n                                        variant=\"secondary\"\r\n                                        className=\"w-full border border-primary/20\"\r\n                                        onClick={handleRequestPasswordReset}\r\n                                        disabled={isRequestingReset}\r\n                                    >\r\n                                        {isRequestingReset ? <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> : <Key className=\"w-4 h-4 mr-2\" />}\r\n                                        Solicitar Redefinição de Senha\r\n                                    </Button>\r\n                                    <p className=\"text-[10px] text-muted-foreground text-center\">\r\n                                        Um ticket será aberto para a equipe administrativa.\r\n                                    </p>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-end gap-3 pt-4 border-t\">\r\n                        <Button variant=\"ghost\" onClick={() => setIsEditingProfile(false)}>\r\n                            Cancelar\r\n                        </Button>\r\n                        <Button\r\n                            className=\"gradient-primary\"\r\n                            onClick={handleUpdateProfile}\r\n                            disabled={isUpdating || !editForm.fullName || !editForm.email}\r\n                        >\r\n                            {isUpdating && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\r\n                            Salvar Alterações\r\n                        </Button>\r\n                    </div>\r\n                </DialogContent>\r\n            </Dialog>\r\n            {/* MFA Setup Dialog */}\r\n            <Dialog open={isMfaModalOpen} onOpenChange={setIsMfaModalOpen}>\r\n                <DialogContent className=\"sm:max-w-md\">\r\n                    <DialogHeader>\r\n                        <DialogTitle>Configurar Autenticação em Duas Etapas</DialogTitle>\r\n                    </DialogHeader>\r\n                    <MfaSetup onComplete={() => {\r\n                        setTimeout(() => window.location.reload(), 2000);\r\n                    }} />\r\n                </DialogContent>\r\n            </Dialog>\r\n            {/* Confirmation Dialog */}\r\n            <ConfirmationDialog\r\n                open={confirmModal.open}\r\n                onOpenChange={(open) => setConfirmModal(prev => ({ ...prev, open }))}\r\n                title={confirmModal.title}\r\n                description={confirmModal.description}\r\n                onConfirm={confirmModal.onConfirm}\r\n                variant={confirmModal.variant}\r\n            />\r\n\r\n            {/* Dialog para desativar MFA com verificação de código */}\r\n            <Dialog open={isDisableMfaDialogOpen} onOpenChange={setIsDisableMfaDialogOpen}>\r\n                <DialogContent className=\"sm:max-w-md\">\r\n                    <DialogHeader>\r\n                        <DialogTitle className=\"flex items-center gap-2 text-destructive\">\r\n                            <AlertTriangle className=\"w-5 h-5\" />\r\n                            Desativar Autenticação 2FA\r\n                        </DialogTitle>\r\n                        <DialogDescription>\r\n                            Para confirmar a desativação, insira o código do seu aplicativo autenticador.\r\n                        </DialogDescription>\r\n                    </DialogHeader>\r\n                    <div className=\"space-y-4 py-4\">\r\n                        <div className=\"p-3 bg-destructive/10 border border-destructive/20 rounded-lg\">\r\n                            <p className=\"text-sm text-destructive font-medium\">\r\n                                ⚠️ Atenção: Desativar o 2FA deixará sua conta menos protegida.\r\n                            </p>\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"disable-mfa-code\">Código do Autenticador (6 dígitos)</Label>\r\n                            <Input\r\n                                id=\"disable-mfa-code\"\r\n                                type=\"text\"\r\n                                inputMode=\"numeric\"\r\n                                maxLength={6}\r\n                                value={disableMfaCode}\r\n                                onChange={(e) => setDisableMfaCode(e.target.value.replace(/\\D/g, ''))}\r\n                                className=\"industrial-input text-center text-2xl tracking-widest font-mono\"\r\n                                placeholder=\"000000\"\r\n                                autoComplete=\"one-time-code\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex justify-end gap-3\">\r\n                        <Button\r\n                            variant=\"outline\"\r\n                            onClick={() => setIsDisableMfaDialogOpen(false)}\r\n                        >\r\n                            Cancelar\r\n                        </Button>\r\n                        <Button\r\n                            variant=\"destructive\"\r\n                            disabled={disableMfaCode.length !== 6 || isVerifyingDisableMfa}\r\n                            onClick={async () => {\r\n                                if (disableMfaCode.length !== 6 || !profile?.mfaSecret) return;\r\n\r\n                                setIsVerifyingDisableMfa(true);\r\n                                try {\r\n                                    const isValid = await verify({\r\n                                        token: disableMfaCode,\r\n                                        secret: profile.mfaSecret\r\n                                    });\r\n\r\n                                    if (isValid.valid) {\r\n                                        const res = await disableMfa();\r\n                                        if (res.success) {\r\n                                            console.log('MFA Disabled successfully, starting cooldown...');\r\n                                            setIsDisableMfaDialogOpen(false);\r\n                                            setShowCountdown(true);\r\n                                            setCountdown(5);\r\n                                        } else {\r\n                                            toast({ title: 'Erro ao desativar', description: res.error, variant: 'destructive' });\r\n                                        }\r\n                                    } else {\r\n                                        toast({ title: 'Código inválido', description: 'O código inserido está incorreto ou expirou.', variant: 'destructive' });\r\n                                    }\r\n                                } catch (error) {\r\n                                    toast({ title: 'Erro de verificação', description: 'Não foi possível verificar o código.', variant: 'destructive' });\r\n                                } finally {\r\n                                    setIsVerifyingDisableMfa(false);\r\n                                    setDisableMfaCode('');\r\n                                }\r\n                            }}\r\n                        >\r\n                            {isVerifyingDisableMfa ? <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> : <Lock className=\"w-4 h-4 mr-2\" />}\r\n                            Confirmar Desativação\r\n                        </Button>\r\n                    </div>\r\n                </DialogContent>\r\n            </Dialog>\r\n\r\n            {/* Modal de Logout Compulsório pós-MFA Disable */}\r\n            <Dialog\r\n                open={showCountdown}\r\n                onOpenChange={() => { }}\r\n            >\r\n                <DialogContent\r\n                    className=\"sm:max-w-md border-primary/50 shadow-glow bg-black/90 backdrop-blur-xl z-9999\"\r\n                    onPointerDownOutside={(e) => e.preventDefault()}\r\n                    onEscapeKeyDown={(e) => e.preventDefault()}\r\n                    onInteractOutside={(e) => e.preventDefault()}\r\n                >\r\n                    <DialogHeader className=\"space-y-4\">\r\n                        <div className=\"mx-auto w-16 h-16 rounded-full bg-primary/20 flex items-center justify-center border border-primary/30 animate-pulse\">\r\n                            <ShieldCheck className=\"w-8 h-8 text-primary\" />\r\n                        </div>\r\n                        <DialogTitle className=\"text-center text-xl font-bold\">Segurança Atualizada</DialogTitle>\r\n                        <DialogDescription className=\"text-center text-white/70\">\r\n                            A segurança de dois fatores foi removida com sucesso. Por motivos de segurança, sua sessão será encerrada em:\r\n                        </DialogDescription>\r\n                    </DialogHeader>\r\n\r\n                    <div className=\"flex flex-col items-center justify-center py-6\">\r\n                        <div className=\"text-6xl font-black text-primary tabular-nums drop-shadow-[0_0_15px_rgba(var(--primary),0.5)]\">\r\n                            {countdown !== null ? countdown : 5}\r\n                        </div>\r\n                        <p className=\"mt-2 text-xs uppercase tracking-[0.2em] font-bold text-muted-foreground\">segundos</p>\r\n                    </div>\r\n\r\n                    <div className=\"p-4 rounded-xl bg-orange-500/10 border border-orange-500/20\">\r\n                        <p className=\"text-xs text-center text-orange-400 font-medium\">\r\n                            Aguarde o redirecionamento automático para a tela de login.\r\n                        </p>\r\n                    </div>\r\n                </DialogContent>\r\n            </Dialog>\r\n\r\n            {/* Photo Adjustment Dialog */}\r\n            <Dialog open={isAdjustingPhoto} onOpenChange={setIsAdjustingPhoto}>\r\n                <DialogContent className=\"sm:max-w-md border-primary/20 bg-black/90 backdrop-blur-xl\">\r\n                    <DialogHeader>\r\n                        <DialogTitle className=\"flex items-center gap-2\">\r\n                            <ZoomIn className=\"w-5 h-5 text-primary\" />\r\n                            Ajustar Enquadramento\r\n                        </DialogTitle>\r\n                        <DialogDescription>\r\n                            Regule o zoom e a posição da sua foto de perfil\r\n                        </DialogDescription>\r\n                    </DialogHeader>\r\n\r\n                    <div className=\"py-6 space-y-8\">\r\n                        {/* Viewport de Crop */}\r\n                        <div className=\"photo-adjust-viewport checkerboard-bg\" style={{ borderColor: '#fbbf24' }}>\r\n                            <div className=\"image-stage\">\r\n                                {imageToAdjust && (\r\n                                    <img\r\n                                        src={imageToAdjust}\r\n                                        alt=\"Ajuste\"\r\n                                        className=\"max-w-none pointer-events-none select-none transition-transform duration-75\"\r\n                                        style={{\r\n                                            width: '100%',\r\n                                            height: 'auto',\r\n                                            transform: `scale(${photoConfig.zoom}) translate(${photoConfig.x}%, ${photoConfig.y}%)`\r\n                                        }}\r\n                                    />\r\n                                )}\r\n                            </div>\r\n                            <div className=\"photo-adjust-mask\" />\r\n                        </div>\r\n\r\n                        {/* Controles de Ajuste */}\r\n                        <div className=\"space-y-6 px-4\">\r\n                            <div className=\"space-y-3\">\r\n                                <div className=\"flex items-center justify-between text-xs font-bold uppercase tracking-widest text-muted-foreground\">\r\n                                    <span className=\"flex items-center gap-1.5\"><ZoomIn className=\"w-3 h-3\" /> Zoom</span>\r\n                                    <span>{Math.round(photoConfig.zoom * 100)}%</span>\r\n                                </div>\r\n                                <Slider\r\n                                    value={[photoConfig.zoom]}\r\n                                    min={1}\r\n                                    max={4}\r\n                                    step={0.01}\r\n                                    onValueChange={([val]) => setPhotoConfig(prev => ({ ...prev, zoom: val }))}\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-6\">\r\n                                <div className=\"space-y-3\">\r\n                                    <div className=\"flex items-center justify-between text-[10px] font-bold uppercase text-muted-foreground\">\r\n                                        <span className=\"flex items-center gap-1.5\"><Move className=\"w-3 h-3\" /> Horiz.</span>\r\n                                    </div>\r\n                                    <Slider\r\n                                        value={[photoConfig.x]}\r\n                                        min={-50}\r\n                                        max={50}\r\n                                        step={1}\r\n                                        onValueChange={([val]) => setPhotoConfig(prev => ({ ...prev, x: val }))}\r\n                                    />\r\n                                </div>\r\n                                <div className=\"space-y-3\">\r\n                                    <div className=\"flex items-center justify-between text-[10px] font-bold uppercase text-muted-foreground\">\r\n                                        <span className=\"flex items-center gap-1.5\"><Move className=\"w-3 h-3 rotate-90\" /> Vert.</span>\r\n                                    </div>\r\n                                    <Slider\r\n                                        value={[photoConfig.y]}\r\n                                        min={-50}\r\n                                        max={50}\r\n                                        step={1}\r\n                                        onValueChange={([val]) => setPhotoConfig(prev => ({ ...prev, y: val }))}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-end gap-3 pt-4 border-t border-primary/10\">\r\n                        <Button variant=\"ghost\" onClick={() => setIsAdjustingPhoto(false)}>\r\n                            Cancelar\r\n                        </Button>\r\n                        <Button className=\"gradient-primary\" onClick={handleApplyAdjustment}>\r\n                            Aplicar Foto\r\n                        </Button>\r\n                    </div>\r\n                </DialogContent>\r\n            </Dialog>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\Sites.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CardDescription' is defined but never used.","line":10,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Info' is defined but never used.","line":15,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Building2' is defined but never used.","line":15,"column":127,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":136},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isCorporateRole' is defined but never used.","line":18,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":25},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'getProjectName'. Either include it or remove the dependency array.","line":156,"column":8,"nodeType":"ArrayExpression","endLine":156,"endColumn":56,"suggestions":[{"desc":"Update the dependencies array to be: [sites, selectedProjectId, searchTerm, getProjectName]","fix":{"range":[6356,6404],"text":"[sites, selectedProjectId, searchTerm, getProjectName]"}}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useSites, Site } from '@/hooks/useSites';\r\nimport { useProjects } from '@/hooks/useProjects';\r\nimport { useUsers } from '@/hooks/useUsers';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { Plus, Truck, Search, Loader2, Info, HardHat, Pencil, Trash2, UserCircle, Briefcase, LayoutGrid, MapPin, Clock, Lock, Building2 } from 'lucide-react';\r\nimport { ProjectEmptyState } from '@/components/shared/ProjectEmptyState';\r\nimport { ProjectSelector } from '@/components/shared/ProjectSelector';\r\nimport { isCorporateRole } from '@/utils/permissionHelpers';\r\nimport { isProtectedSignal, can } from '@/signals/authSignals';\r\nimport { ConfirmationDialog } from '@/components/shared/ConfirmationDialog';\r\nimport { useSignals } from \"@preact/signals-react/runtime\";\r\n\r\nexport default function Sites() {\r\n    useSignals();\r\n    const navigate = useNavigate();\r\n    const { profile } = useAuth();\r\n    const { sites, isLoading: sitesLoading, createSite, updateSite, deleteSite } = useSites();\r\n    const { projects, isLoading: projectsLoading } = useProjects();\r\n    const userFilters = React.useMemo(() => ({\r\n        companyId: profile?.companyId || undefined\r\n    }), [profile?.companyId]);\r\n    const { users, isLoading: usersLoading } = useUsers(userFilters);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [isDialogOpen, setIsDialogOpen] = useState(false);\r\n    const [editingSite, setEditingSite] = useState<Site | null>(null);\r\n    const [isSaving, setIsSaving] = useState(false);\r\n    const [formData, setFormData] = useState({\r\n        name: '',\r\n        projectId: '',\r\n        locationDetails: '',\r\n        plannedHHH: 0,\r\n    });\r\n    const [confirmModal, setConfirmModal] = useState<{\r\n        open: boolean;\r\n        title: string;\r\n        description: string;\r\n        onConfirm: () => void | Promise<void>;\r\n        variant: 'default' | 'destructive';\r\n    }>({\r\n        open: false,\r\n        title: '',\r\n        description: '',\r\n        onConfirm: () => { },\r\n        variant: 'default'\r\n    });\r\n    const [selectedProjectId, setSelectedProjectId] = useState<string>('all');\r\n    const { toast } = useToast();\r\n\r\n    // Check if user can manage sites (create, edit, delete)\r\n    const canCreateSites = isProtectedSignal.value || can('sites.create');\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!formData.name.trim() || !formData.projectId) {\r\n            toast({ title: 'Aviso', description: 'Nome e Obra são obrigatórios', variant: 'destructive' });\r\n            return;\r\n        }\r\n\r\n        setIsSaving(true);\r\n        try {\r\n            const dataToSave = {\r\n                ...formData,\r\n                plannedHHH: Number(formData.plannedHHH)\r\n            };\r\n\r\n            if (editingSite) {\r\n                const result = await updateSite(editingSite.id, dataToSave);\r\n                if (result.success) {\r\n                    toast({ title: 'Canteiro atualizado!' });\r\n                    resetForm();\r\n                }\r\n            } else {\r\n                const result = await createSite(dataToSave);\r\n                if (result.success) {\r\n                    toast({ title: 'Canteiro cadastrado!' });\r\n                    resetForm();\r\n                }\r\n            }\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    const handleEdit = (site: Site) => {\r\n        setEditingSite(site);\r\n        setFormData({\r\n            name: site.name,\r\n            projectId: site.projectId,\r\n            locationDetails: site.locationDetails || '',\r\n            plannedHHH: site.plannedHHH || 0,\r\n        });\r\n        setIsDialogOpen(true);\r\n    };\r\n\r\n    const handleDelete = async (site: Site) => {\r\n        setConfirmModal({\r\n            open: true,\r\n            title: 'Excluir Canteiro',\r\n            description: `Deseja realmente excluir o canteiro \"${site.name}\"? Esta ação não pode ser desfeita e removerá todos os registros associados.`,\r\n            variant: 'destructive',\r\n            onConfirm: async () => {\r\n                const result = await deleteSite(site.id);\r\n                if (result.success) {\r\n                    toast({ title: 'Canteiro excluído!' });\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    const resetForm = () => {\r\n        setFormData({ name: '', projectId: '', locationDetails: '', plannedHHH: 0 });\r\n        setEditingSite(null);\r\n        setIsDialogOpen(false);\r\n    };\r\n\r\n    const getProjectName = (id: string) => projects.find(p => p.id === id)?.name || 'Obra desconhecida';\r\n\r\n    const getProjectManagers = (projectId: string) => {\r\n        return users.filter(u => u.role === 'GESTOR_PROJECT' && u.projectId === projectId);\r\n    };\r\n\r\n    const getSiteManagers = (siteId: string) => {\r\n        return users.filter(u => u.role === 'GESTOR_CANTEIRO' && u.siteId === siteId);\r\n    };\r\n\r\n    // Group sites by project\r\n    const groupedSites = useMemo(() => {\r\n        let filtered = sites.filter(s =>\r\n            s.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            getProjectName(s.projectId).toLowerCase().includes(searchTerm.toLowerCase())\r\n        );\r\n\r\n        // Filter by selected Project from Selector\r\n        if (selectedProjectId && selectedProjectId !== 'all') {\r\n            filtered = filtered.filter(s => s.projectId === selectedProjectId);\r\n        }\r\n\r\n        const groups: Record<string, Site[]> = {};\r\n        filtered.forEach(site => {\r\n            if (!groups[site.projectId]) {\r\n                groups[site.projectId] = [];\r\n            }\r\n            groups[site.projectId].push(site);\r\n        });\r\n        return groups;\r\n    }, [sites, searchTerm, projects, selectedProjectId]);\r\n\r\n    if (sitesLoading || projectsLoading || usersLoading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center h-64\">\r\n                <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-fade-in\">\r\n            <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-display font-bold gradient-text\">Gestão de Canteiros</h1>\r\n                    <p className=\"text-muted-foreground\">Gerencie as frentes de trabalho organizadas por obra</p>\r\n                </div>\r\n                <div className=\"flex items-center gap-4\">\r\n                    <div className=\"w-[250px]\">\r\n                        <ProjectSelector\r\n                            value={selectedProjectId || ''}\r\n                            onValueChange={setSelectedProjectId}\r\n                            showAll={true}\r\n                        />\r\n                    </div>\r\n                </div>\r\n                {canCreateSites && (\r\n                    <Dialog open={isDialogOpen} onOpenChange={(open) => {\r\n                        setIsDialogOpen(open);\r\n                        if (!open) resetForm();\r\n                    }}>\r\n                        <DialogTrigger asChild>\r\n                            <Button className=\"gradient-primary text-white shadow-glow\">\r\n                                <Plus className=\"w-4 h-4 mr-2\" />\r\n                                Novo Canteiro\r\n                            </Button>\r\n                        </DialogTrigger>\r\n                        <DialogContent className=\"max-w-md\">\r\n                            <DialogHeader>\r\n                                <DialogTitle className=\"flex items-center gap-2 text-2xl font-bold\">\r\n                                    <div className=\"w-10 h-10 rounded-lg gradient-primary flex items-center justify-center shadow-glow\">\r\n                                        <Truck className=\"text-white w-6 h-6\" />\r\n                                    </div>\r\n                                    {editingSite ? 'Editar Canteiro' : 'Novo Canteiro'}\r\n                                </DialogTitle>\r\n                                <DialogDescription className=\"text-muted-foreground pt-1\">\r\n                                    Configure as áreas de trabalho vinculadas às obras.\r\n                                </DialogDescription>\r\n                            </DialogHeader>\r\n\r\n                            <form onSubmit={handleSubmit} className=\"space-y-6 pt-4\">\r\n                                {/* Seção: Vínculo */}\r\n                                <div className=\"space-y-4\">\r\n                                    <div className=\"flex items-center gap-2 text-primary font-semibold text-sm uppercase tracking-wider\">\r\n                                        <HardHat className=\"w-4 h-4\" />\r\n                                        Vínculo\r\n                                    </div>\r\n                                    <Separator className=\"bg-white/10\" />\r\n\r\n                                    <div className=\"space-y-2\">\r\n                                        <Label className=\"text-xs uppercase text-muted-foreground font-bold\">Obra Correspondente *</Label>\r\n                                        <Select value={formData.projectId} onValueChange={val => setFormData({ ...formData, projectId: val })}>\r\n                                            <SelectTrigger className=\"industrial-input h-10\">\r\n                                                <SelectValue placeholder=\"Selecione a obra\" />\r\n                                            </SelectTrigger>\r\n                                            <SelectContent className=\"glass-card border-white/10\">\r\n                                                {projects.map(p => (\r\n                                                    <SelectItem key={p.id} value={p.id}>{p.name}</SelectItem>\r\n                                                ))}\r\n                                            </SelectContent>\r\n                                        </Select>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Seção: Identificação */}\r\n                                <div className=\"space-y-4 pt-2\">\r\n                                    <div className=\"flex items-center gap-2 text-orange-500 font-semibold text-sm uppercase tracking-wider\">\r\n                                        <LayoutGrid className=\"w-4 h-4\" />\r\n                                        Identificação do Canteiro\r\n                                    </div>\r\n                                    <Separator className=\"bg-white/10\" />\r\n\r\n                                    <div className=\"space-y-2\">\r\n                                        <Label className=\"text-xs uppercase text-muted-foreground font-bold\">Nome do Canteiro *</Label>\r\n                                        <div className=\"relative\">\r\n                                            <Input\r\n                                                value={formData.name}\r\n                                                onChange={e => setFormData({ ...formData, name: e.target.value })}\r\n                                                className=\"industrial-input h-10 pr-10\"\r\n                                                required\r\n                                                placeholder=\"Ex: Canteiro Sul, Torre A...\"\r\n                                                disabled={editingSite && !(isProtectedSignal.value || can('sites.rename'))}\r\n                                            />\r\n                                            {editingSite && !(isProtectedSignal.value || can('sites.rename')) && (\r\n                                                <Lock className=\"absolute right-3 top-2.5 w-4 h-4 text-orange-500/50\" />\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"grid grid-cols-2 gap-4\">\r\n                                        <div className=\"space-y-2\">\r\n                                            <Label className=\"text-xs uppercase text-muted-foreground font-bold italic\">HHH Planejado</Label>\r\n                                            <Input\r\n                                                type=\"number\"\r\n                                                value={formData.plannedHHH}\r\n                                                onChange={e => setFormData({ ...formData, plannedHHH: Number(e.target.value) })}\r\n                                                className=\"industrial-input h-10\"\r\n                                                placeholder=\"Total Horas\"\r\n                                            />\r\n                                        </div>\r\n                                        <div className=\"space-y-2\">\r\n                                            <Label className=\"text-xs uppercase text-muted-foreground font-bold\">Localização</Label>\r\n                                            <Input\r\n                                                value={formData.locationDetails}\r\n                                                onChange={e => setFormData({ ...formData, locationDetails: e.target.value })}\r\n                                                className=\"industrial-input h-10\"\r\n                                                placeholder=\"Ex: Térreo\"\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"pt-4 flex gap-3\">\r\n                                    <Button type=\"button\" variant=\"outline\" onClick={resetForm} className=\"flex-1 h-11 border-white/10\">\r\n                                        Cancelar\r\n                                    </Button>\r\n                                    <Button type=\"submit\" className=\"flex-1 h-11 gradient-primary shadow-glow\" disabled={isSaving}>\r\n                                        {isSaving ? <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> : null}\r\n                                        {editingSite ? 'Salvar Alterações' : 'Cadastrar Canteiro'}\r\n                                    </Button>\r\n                                </div>\r\n                            </form>\r\n                        </DialogContent>\r\n                    </Dialog>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"relative max-w-md\">\r\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n                <Input\r\n                    placeholder=\"Buscar por canteiro ou obra...\"\r\n                    value={searchTerm}\r\n                    onChange={(e) => setSearchTerm(e.target.value)}\r\n                    className=\"pl-10 industrial-input\"\r\n                />\r\n            </div>\r\n\r\n            <div className=\"space-y-10\">\r\n                {(!projects || projects.length === 0) ? (\r\n                    <div className=\"flex-1 flex items-center justify-center min-h-[400px]\">\r\n                        <ProjectEmptyState\r\n                            type=\"generic\"\r\n                            title=\"Nenhuma Obra Atribuída\"\r\n                            description=\"Sua empresa ainda não possui obras cadastradas. Cadastre ou vincule uma obra para gerenciar seus canteiros.\"\r\n                            onAction={() => navigate('/obras')}\r\n                            actionLabel=\"Gerenciar Obras\"\r\n                        />\r\n                    </div>\r\n                ) : (Object.keys(groupedSites).length === 0) ? (\r\n                    <div className=\"flex-1 flex items-center justify-center min-h-[400px]\">\r\n                        <ProjectEmptyState\r\n                            type=\"sites\"\r\n                            title={selectedProjectId && selectedProjectId !== 'all' ? \"Nenhum Canteiro nesta Obra\" : \"Nenhum Canteiro Encontrado\"}\r\n                            description={selectedProjectId && selectedProjectId !== 'all'\r\n                                ? \"Esta obra ainda não possui canteiros cadastrados.\"\r\n                                : \"Ainda não foram criados canteiros para as suas obras. Inicie as operações criando o primeiro canteiro.\"}\r\n                            onAction={() => setIsDialogOpen(true)}\r\n                            actionLabel=\"Criar Primeiro Canteiro\"\r\n                        />\r\n                    </div>\r\n                ) : (\r\n                    Object.entries(groupedSites).map(([projectId, projectSites]) => {\r\n                        const projectName = getProjectName(projectId);\r\n                        return (\r\n                            <div key={projectId} className=\"space-y-4\">\r\n                                <div className=\"flex items-center gap-4 px-2\">\r\n                                    <div className=\"flex items-center gap-2 group cursor-default\">\r\n                                        <div className=\"w-8 h-8 rounded-lg gradient-primary flex items-center justify-center shadow-glow-sm\">\r\n                                            <HardHat className=\"w-4 h-4 text-white\" />\r\n                                        </div>\r\n                                        <h2 className=\"text-xl font-bold tracking-tight text-foreground/90 group-hover:text-primary transition-colors italic\">\r\n                                            {projectName}\r\n                                        </h2>\r\n                                    </div>\r\n                                    <div className=\"flex-1 h-px bg-linear-to-r from-primary/30 to-transparent\" />\r\n                                    <span className=\"text-[10px] font-black uppercase tracking-[0.2em] text-muted-foreground/40 bg-muted/10 px-2 py-0.5 rounded\">\r\n                                        {projectSites.length} {projectSites.length === 1 ? 'Canteiro' : 'Canteiros'}\r\n                                    </span>\r\n                                </div>\r\n\r\n                                <div className=\"grid sm:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                                    {projectSites.map((site) => {\r\n                                        const projectManagers = getProjectManagers(site.projectId);\r\n                                        const siteManagers = getSiteManagers(site.id);\r\n\r\n                                        return (\r\n                                            <Card key={site.id} className=\"group relative overflow-hidden glass-card border-white/5 hover:border-primary/20 transition-all duration-300\">\r\n                                                <div className=\"absolute top-4 right-4 z-20 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                                    {(() => {\r\n                                                        const canEdit = isProtectedSignal.value || can('sites.rename') || can('sites.update');\r\n                                                        const canDel = isProtectedSignal.value || can('sites.delete');\r\n\r\n                                                        if (!canEdit && !canDel) {\r\n                                                            return (\r\n                                                                <div className=\"h-8 flex items-center px-2 backdrop-blur-sm bg-black/20 rounded text-white/30\" title=\"Sem permissão hierárquica\">\r\n                                                                    <Lock className=\"w-3.5 h-3.5 mr-1\" />\r\n                                                                    <span className=\"text-[10px] uppercase font-bold\">Leitura</span>\r\n                                                                </div>\r\n                                                            );\r\n                                                        }\r\n\r\n                                                        return (\r\n                                                            <>\r\n                                                                {canEdit && (\r\n                                                                    <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 text-muted-foreground hover:text-primary backdrop-blur-sm bg-black/20\" onClick={() => handleEdit(site)}>\r\n                                                                        <Pencil className=\"w-4 h-4\" />\r\n                                                                    </Button>\r\n                                                                )}\r\n                                                                {canDel && (\r\n                                                                    <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 text-muted-foreground hover:text-destructive backdrop-blur-sm bg-black/20\" onClick={() => handleDelete(site)}>\r\n                                                                        <Trash2 className=\"w-4 h-4\" />\r\n                                                                    </Button>\r\n                                                                )}\r\n                                                            </>\r\n                                                        );\r\n                                                    })()}\r\n                                                </div>\r\n\r\n                                                <CardHeader className=\"pb-3 px-6 pt-6\">\r\n                                                    <div className=\"flex items-center gap-3\">\r\n                                                        <div className=\"p-3 rounded-2xl bg-primary/10 group-hover:bg-primary/20 transition-colors\">\r\n                                                            <Truck className=\"w-6 h-6 text-primary\" />\r\n                                                        </div>\r\n                                                        <div>\r\n                                                            <CardTitle className=\"text-lg\">{site.name}</CardTitle>\r\n                                                            <div className=\"flex items-center gap-1 text-[10px] uppercase font-bold text-muted-foreground tracking-wider\">\r\n                                                                <LayoutGrid className=\"w-3 h-3\" />\r\n                                                                Unidade de Trabalho\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </CardHeader>\r\n                                                <CardContent className=\"space-y-5 px-6 pb-6\">\r\n                                                    <div className=\"grid grid-cols-2 gap-4 pb-4 border-b border-white/5\">\r\n                                                        <div className=\"space-y-1\">\r\n                                                            <p className=\"text-[10px] uppercase font-black text-muted-foreground/60 italic\">Meta HHH</p>\r\n                                                            <p className=\"text-sm font-black flex items-center gap-1.5 text-primary\">\r\n                                                                <Clock className=\"w-3.5 h-3.5\" />\r\n                                                                {site.plannedHHH?.toLocaleString() || '0'}h\r\n                                                            </p>\r\n                                                        </div>\r\n                                                        <div className=\"space-y-1 text-right\">\r\n                                                            <p className=\"text-[10px] uppercase font-black text-muted-foreground/60 italic\">Status</p>\r\n                                                            <span className=\"text-[10px] font-bold bg-emerald-500/10 text-emerald-500 px-2 py-0.5 rounded-full border border-emerald-500/20\">Ativo</span>\r\n                                                        </div>\r\n                                                    </div>\r\n\r\n                                                    <div className=\"space-y-3 text-sm text-muted-foreground\">\r\n                                                        <div className=\"flex items-center gap-2\">\r\n                                                            <MapPin className=\"w-4 h-4 text-primary/40\" />\r\n                                                            <span className=\"truncate italic\">{site.locationDetails || 'Nenhum detalhe adicional'}</span>\r\n                                                        </div>\r\n\r\n                                                        <div className=\"pt-3 mt-2 border-t border-white/5 space-y-3\">\r\n                                                            <div className=\"flex flex-col gap-1.5\">\r\n                                                                <span className=\"text-[10px] uppercase font-black tracking-widest text-white/30\">Gestor da Obra</span>\r\n                                                                <div className=\"flex items-center gap-2 px-2 py-1.5 rounded-lg bg-blue-500/5 border border-blue-500/10\">\r\n                                                                    <UserCircle className=\"w-4 h-4 text-blue-400\" />\r\n                                                                    <span className=\"text-xs font-semibold text-foreground/90\">\r\n                                                                        {projectManagers.length > 0 ? projectManagers.map(m => m.fullName).join(', ') : 'Não atribuído'}\r\n                                                                    </span>\r\n                                                                </div>\r\n                                                            </div>\r\n\r\n                                                            <div className=\"flex flex-col gap-1.5\">\r\n                                                                <span className=\"text-[10px] uppercase font-black tracking-widest text-white/30\">Gestor do Canteiro</span>\r\n                                                                <div className=\"flex items-center gap-2 px-2 py-1.5 rounded-lg bg-orange-500/5 border border-orange-500/10\">\r\n                                                                    <Briefcase className=\"w-4 h-4 text-orange-400\" />\r\n                                                                    <span className=\"text-xs font-semibold text-foreground/90\">\r\n                                                                        {siteManagers.length > 0 ? siteManagers.map(m => m.fullName).join(', ') : 'Não atribuído'}\r\n                                                                    </span>\r\n                                                                </div>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </CardContent>\r\n                                            </Card>\r\n                                        );\r\n                                    })}\r\n                                </div>\r\n                            </div>\r\n                        );\r\n                    })\r\n                )}\r\n            </div>\r\n            {/* Confirmation Dialog */}\r\n            <ConfirmationDialog\r\n                open={confirmModal.open}\r\n                onOpenChange={(open) => setConfirmModal(prev => ({ ...prev, open }))}\r\n                title={confirmModal.title}\r\n                description={confirmModal.description}\r\n                onConfirm={confirmModal.onConfirm}\r\n                variant={confirmModal.variant}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\TeamComposition.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'defaultDropAnimationSideEffects' is defined but never used.","line":13,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'MouseSensor' is defined but never used.","line":15,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TouchSensor' is defined but never used.","line":16,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'pointerWithin' is defined but never used.","line":17,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'rectIntersection' is defined but never used.","line":18,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'closestCenter' is defined but never used.","line":19,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'arrayMove' is defined but never used.","line":22,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Card' is defined but never used.","line":35,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CardContent' is defined but never used.","line":35,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CardHeader' is defined but never used.","line":35,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CardTitle' is defined but never used.","line":35,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CardDescription' is defined but never used.","line":35,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":67},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Briefcase' is defined but never used.","line":50,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":50,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Filter' is defined but never used.","line":52,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":52,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ChevronRight' is defined but never used.","line":55,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":55,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ShieldCheck' is defined but never used.","line":57,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":57,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Building2' is defined but never used.","line":58,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":58,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'MapPin' is defined but never used.","line":59,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isDirectLabor' is defined but never used.","line":67,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":67,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":158,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6357,6360],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6357,6360],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'onSetLeader' is defined but never used.","line":190,"column":92,"nodeType":null,"messageId":"unusedVar","endLine":190,"endColumn":103},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isIncomplete' is assigned a value but never used.","line":214,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":214,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":237,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":237,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9042,9045],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9042,9045],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":241,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":241,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9314,9317],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9314,9317],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'loadingFunctions' is assigned a value but never used.","line":354,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":354,"endColumn":51},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'activeId' is assigned a value but never used.","line":361,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":361,"endColumn":20},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useMemo has an unnecessary dependency: 'employees'. Either exclude it or remove the dependency array.","line":468,"column":8,"nodeType":"ArrayExpression","endLine":468,"endColumn":85,"suggestions":[{"desc":"Update the dependencies array to be: [teams, selectedSiteId, selectedProjectId, sites, laborTypeFilter]","fix":{"range":[20086,20163],"text":"[teams, selectedSiteId, selectedProjectId, sites, laborTypeFilter]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleDragOver' is assigned a value but never used.","line":476,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":476,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'event' is defined but never used.","line":476,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":476,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":550,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":550,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23597,23600],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23597,23600],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":29,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react';\r\nimport {\r\n    DndContext,\r\n    DragOverlay,\r\n    closestCorners,\r\n    KeyboardSensor,\r\n    PointerSensor,\r\n    useSensor,\r\n    useSensors,\r\n    DragStartEvent,\r\n    DragOverEvent,\r\n    DragEndEvent,\r\n    defaultDropAnimationSideEffects,\r\n    useDroppable,\r\n    MouseSensor,\r\n    TouchSensor,\r\n    pointerWithin,\r\n    rectIntersection,\r\n    closestCenter\r\n} from '@dnd-kit/core';\r\nimport {\r\n    arrayMove,\r\n    SortableContext,\r\n    sortableKeyboardCoordinates,\r\n    verticalListSortingStrategy,\r\n    useSortable\r\n} from '@dnd-kit/sortable';\r\nimport { CSS } from '@dnd-kit/utilities';\r\nimport { useTeams, Team } from '@/hooks/useTeams';\r\nimport { useEmployees, Employee } from '@/hooks/useEmployees';\r\nimport { useSites } from '@/hooks/useSites';\r\nimport { useProjects } from '@/hooks/useProjects';\r\nimport { useJobFunctions } from '@/hooks/useJobFunctions';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Avatar, AvatarFallback } from '@/components/ui/avatar';\r\nimport { ScrollArea } from '@/components/ui/scroll-area';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\r\nimport { Label } from '@/components/ui/label';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport {\r\n    Users,\r\n    Search,\r\n    HardHat,\r\n    Truck,\r\n    Briefcase,\r\n    Loader2,\r\n    Filter,\r\n    UserPlus,\r\n    ArrowRightLeft,\r\n    ChevronRight,\r\n    GripVertical,\r\n    ShieldCheck,\r\n    Building2,\r\n    MapPin,\r\n    Pencil,\r\n    Trash2,\r\n    Settings,\r\n    Crown,\r\n    UserX\r\n} from 'lucide-react';\r\nimport { cn } from '@/lib/utils';\r\nimport { isDirectLabor, getLaborClassification } from '@/utils/laborUtils';\r\nimport CompositionStatsPanel from '@/components/composition/CompositionStatsPanel';\r\n\r\n// --- Components ---\r\n\r\ninterface DraggableEmployeeProps {\r\n    employee: Employee;\r\n    isOverlay?: boolean;\r\n}\r\n\r\n// Versão puramente visual do card (usada no overlay e dentro do wrapper draggable)\r\nfunction EmployeeCardStatic({ employee, isOverlay, style }: DraggableEmployeeProps & { style?: React.CSSProperties }) {\r\n    return (\r\n        <div\r\n            style={style}\r\n            className={cn(\r\n                \"group relative flex items-center gap-4 p-4 rounded-xl border border-white/5 bg-white/5 hover:bg-white/10 hover:border-primary/30 transition-all cursor-grab active:cursor-grabbing mb-3 min-h-[80px]\",\r\n                isOverlay && \"border-primary/50 bg-primary/10 shadow-glow transition-none scale-105 z-50\",\r\n                !isOverlay && style?.visibility === 'hidden' && \"transition-none pointer-events-none\"\r\n            )}\r\n        >\r\n            <div className=\"flex flex-col items-center gap-1 opacity-10 group-hover:opacity-40 transition-opacity\">\r\n                <GripVertical className=\"w-4 h-4\" />\r\n            </div>\r\n            <Avatar className=\"h-12 w-12 border-2 border-white/10 shrink-0 shadow-lg\">\r\n                <AvatarFallback className=\"bg-primary/20 text-primary text-sm font-black\">\r\n                    {employee.fullName.charAt(0).toUpperCase()}\r\n                </AvatarFallback>\r\n            </Avatar>\r\n            <div className=\"flex-1 min-w-0\">\r\n                <div className=\"flex items-center gap-2 mb-0.5\">\r\n                    <p className=\"text-sm font-black truncate text-foreground group-hover:text-primary transition-colors\">\r\n                        {employee.fullName}\r\n                    </p>\r\n                    {employee.canLeadTeam && (\r\n                        <Crown className=\"w-4 h-4 text-amber-500 fill-amber-500/20 shrink-0\" />\r\n                    )}\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                    <p className=\"text-[10px] uppercase font-bold tracking-widest text-muted-foreground/50\">\r\n                        {employee.functionName || 'Colaborador'}\r\n                    </p>\r\n                    <div className=\"w-1 h-1 rounded-full bg-white/10\" />\r\n                    <p className=\"text-[9px] font-bold text-white/40 uppercase\">\r\n                        Protocolo Orion\r\n                    </p>\r\n                </div>\r\n            </div>\r\n            {/* Badges de Nível - Maiores e mais estilizadas */}\r\n            <div className=\"flex flex-col items-end gap-1 shrink-0\">\r\n                {employee.level > 0 && (\r\n                    <span className=\"text-[10px] font-black px-2 py-0.5 rounded-md bg-blue-500/10 text-blue-400 border border-blue-500/20 shadow-sm shadow-blue-500/5 uppercase\">\r\n                        NI {employee.level}\r\n                    </span>\r\n                )}\r\n                {employee.professionalLevel > 0 && (\r\n                    <span className=\"text-[10px] font-black px-2 py-0.5 rounded-md bg-purple-500/10 text-purple-400 border border-purple-500/20 shadow-sm shadow-purple-500/5 uppercase\">\r\n                        NP {employee.professionalLevel}\r\n                    </span>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n// Wrapper que adiciona as capacidades de Drag & Drop\r\nfunction EmployeeCard({ employee }: DraggableEmployeeProps) {\r\n    const {\r\n        attributes,\r\n        listeners,\r\n        setNodeRef,\r\n        transform,\r\n        transition,\r\n        isDragging\r\n    } = useSortable({\r\n        id: employee.id,\r\n        data: {\r\n            type: 'Employee',\r\n            employee,\r\n        },\r\n    });\r\n\r\n    // Estado para detectar o clique inicial (antes mesmo do drag começar)\r\n    const [isPressed, setIsPressed] = React.useState(false);\r\n\r\n    const style: React.CSSProperties = {\r\n        transition: isDragging ? 'none' : transition,\r\n        transform: CSS.Transform.toString(transform),\r\n        // Mantém o card original levemente visível (fantasma) para preencher o espaço\r\n        opacity: isDragging ? 0.4 : 1,\r\n        // Garante que o card de origem não intercepte eventos de mouse durante o drag\r\n        pointerEvents: (isDragging ? 'none' : 'auto') as any,\r\n    };\r\n\r\n    return (\r\n        <div\r\n            ref={setNodeRef}\r\n            style={style}\r\n            {...attributes}\r\n            {...listeners}\r\n            onPointerDown={() => setIsPressed(true)}\r\n            onPointerUp={() => setIsPressed(false)}\r\n            onPointerCancel={() => setIsPressed(false)}\r\n            className={cn(\r\n                \"touch-none transition-transform duration-200\",\r\n                isPressed && !isDragging && \"scale-[0.98] ring-1 ring-primary/30 rounded-xl\"\r\n            )}\r\n        >\r\n            <EmployeeCardStatic employee={employee} />\r\n        </div>\r\n    );\r\n}\r\n\r\ninterface TeamColumnProps {\r\n    team: Team;\r\n    members: Employee[];\r\n    supervisorEmployee?: Employee;\r\n    onEdit: (team: Team) => void;\r\n    onDelete: (id: string) => void;\r\n    onClearMembers: (teamId: string) => void;\r\n    onSetLeader: (teamId: string, employeeId: string) => void;\r\n}\r\n\r\nfunction TeamColumn({ team, members, supervisorEmployee, onEdit, onDelete, onClearMembers, onSetLeader }: TeamColumnProps) {\r\n    const {\r\n        setNodeRef,\r\n        isOver\r\n    } = useDroppable({\r\n        id: team.id,\r\n        data: {\r\n            type: 'Team',\r\n            team,\r\n        },\r\n    });\r\n\r\n    // Drop zone específica para o líder\r\n    const {\r\n        setNodeRef: setLeaderRef,\r\n        isOver: isOverLeader\r\n    } = useDroppable({\r\n        id: `leader-${team.id}`,\r\n        data: {\r\n            type: 'LeaderSlot',\r\n            teamId: team.id,\r\n        },\r\n    });\r\n\r\n    const isIncomplete = !team.supervisorId;\r\n    const isHealthy = members.length >= 5 && team.supervisorId;\r\n\r\n    return (\r\n        <div\r\n            ref={setNodeRef}\r\n            className={cn(\r\n                \"flex flex-col w-96 rounded-2xl border transition-all duration-300\",\r\n                isOver ? \"bg-primary/5 border-primary shadow-glow-sm ring-1 ring-primary/20\" : \"bg-black/20 border-white/5\"\r\n            )}\r\n        >\r\n            {/* Column Header */}\r\n            <div className=\"p-4 border-b border-white/5 relative group/header\">\r\n                <div className=\"flex items-center justify-between mb-2\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <Badge className={cn(\r\n                            \"bg-primary/10 text-primary border-primary/20\",\r\n                            !isHealthy && \"bg-orange-500/10 text-orange-500 border-orange-500/20\"\r\n                        )}>\r\n                            Equipe\r\n                        </Badge>\r\n                        <Badge variant=\"outline\" className={cn(\r\n                            \"text-[10px] font-black uppercase\",\r\n                            (team as any).laborType === 'MOI'\r\n                                ? \"bg-blue-500/10 text-blue-400 border-blue-500/20\"\r\n                                : \"bg-emerald-500/10 text-emerald-400 border-emerald-500/20\"\r\n                        )}>\r\n                            {(team as any).laborType || 'MOD'}\r\n                        </Badge>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1.5 translate-x-1 group-hover/header:translate-x-0 transition-transform\">\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            size=\"icon\"\r\n                            className=\"h-7 w-7 opacity-0 group-hover/header:opacity-100 transition-opacity hover:bg-white/10\"\r\n                            onClick={() => onEdit(team)}\r\n                        >\r\n                            <Pencil className=\"w-3.5 h-3.5\" />\r\n                        </Button>\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            size=\"icon\"\r\n                            className=\"h-7 w-7 opacity-0 group-hover/header:opacity-100 transition-opacity hover:bg-destructive/20 hover:text-destructive\"\r\n                            onClick={() => onDelete(team.id)}\r\n                        >\r\n                            <Trash2 className=\"w-3.5 h-3.5\" />\r\n                        </Button>\r\n                        {members.length > 0 && (\r\n                            <Button\r\n                                variant=\"ghost\"\r\n                                size=\"icon\"\r\n                                className=\"h-7 w-7 opacity-0 group-hover/header:opacity-100 transition-opacity hover:bg-orange-500/20 hover:text-orange-500\"\r\n                                onClick={() => onClearMembers(team.id)}\r\n                                title=\"Remover todos os membros\"\r\n                            >\r\n                                <UserX className=\"w-3.5 h-3.5\" />\r\n                            </Button>\r\n                        )}\r\n                        <div className=\"flex items-center gap-1.5 ml-1\">\r\n                            <Users className=\"w-3.5 h-3.5 text-muted-foreground\" />\r\n                            <span className=\"text-xs font-bold text-muted-foreground\">{members.length}</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <h3 className=\"text-lg font-bold truncate\">{team.name}</h3>\r\n\r\n                {/* Supervisor Slot as Card - Droppable */}\r\n                <div className=\"mt-4\">\r\n                    <p className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground/50 mb-2 ml-1\">Líder da Equipe</p>\r\n                    <div\r\n                        ref={setLeaderRef}\r\n                        className={cn(\r\n                            \"rounded-xl transition-all\",\r\n                            isOverLeader && \"ring-2 ring-emerald-500 ring-offset-2 ring-offset-background\"\r\n                        )}\r\n                    >\r\n                        {supervisorEmployee ? (\r\n                            <div className=\"border-l-4 border-emerald-500 rounded-lg pl-1\">\r\n                                <EmployeeCard employee={supervisorEmployee} />\r\n                            </div>\r\n                        ) : (\r\n                            <div className={cn(\r\n                                \"flex items-center gap-2 px-3 py-3 rounded-xl border border-dashed text-xs font-bold transition-all\",\r\n                                isOverLeader\r\n                                    ? \"border-emerald-500/50 bg-emerald-500/10 text-emerald-500\"\r\n                                    : \"border-orange-500/30 bg-orange-500/5 text-orange-500/60\"\r\n                            )}>\r\n                                <Crown className=\"w-4 h-4\" />\r\n                                {isOverLeader ? \"Solte para definir como líder\" : \"Arraste um líder aqui\"}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Members List - só exibe área expandida se tiver membros */}\r\n            {members.length > 0 ? (\r\n                <ScrollArea className=\"flex-1 p-3 max-h-[50vh]\">\r\n                    <SortableContext\r\n                        id={team.id}\r\n                        items={members.map(m => m.id)}\r\n                        strategy={verticalListSortingStrategy}\r\n                    >\r\n                        <div>\r\n                            {members.map(emp => (\r\n                                <EmployeeCard key={emp.id} employee={emp} />\r\n                            ))}\r\n                        </div>\r\n                    </SortableContext>\r\n                </ScrollArea>\r\n            ) : (\r\n                <div className=\"p-3\">\r\n                    <SortableContext\r\n                        id={team.id}\r\n                        items={[]}\r\n                        strategy={verticalListSortingStrategy}\r\n                    >\r\n                        <div className=\"py-4 text-center text-xs text-muted-foreground/40 border border-dashed border-white/5 rounded-xl\">\r\n                            Arraste membros para cá\r\n                        </div>\r\n                    </SortableContext>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nimport { useSignals } from \"@preact/signals-react/runtime\";\r\n\r\n// --- Components ---\r\n// ... (omitting intermediate components for brevity)\r\n\r\n// --- Main Page ---\r\n\r\nexport default function TeamComposition() {\r\n    useSignals();\r\n    const { teams, moveMember, createTeam, updateTeam, deleteTeam, isLoading: loadingTeams } = useTeams();\r\n    const { employees, isLoading: loadingEmployees } = useEmployees();\r\n    const { projects, isLoading: loadingProjects } = useProjects();\r\n    const { sites, isLoading: loadingSites } = useSites();\r\n    const { functions, isLoading: loadingFunctions } = useJobFunctions();\r\n    const { profile } = useAuth();\r\n    const { toast } = useToast();\r\n\r\n    const [selectedProjectId, setSelectedProjectId] = React.useState<string>('all');\r\n    const [selectedSiteId, setSelectedSiteId] = React.useState<string>('all');\r\n    const [laborTypeFilter, setLaborTypeFilter] = React.useState<'all' | 'MOD' | 'MOI'>('all');\r\n    const [activeId, setActiveId] = React.useState<string | null>(null);\r\n    const [activeEmployee, setActiveEmployee] = React.useState<Employee | null>(null);\r\n    const [searchTerm, setSearchTerm] = React.useState('');\r\n    const [isStatsOpen, setIsStatsOpen] = React.useState(false);\r\n\r\n    const scrollContainerRef = React.useRef<HTMLDivElement>(null);\r\n\r\n    // Efeito para permitir scroll horizontal com a rodinha do mouse\r\n    React.useEffect(() => {\r\n        const el = scrollContainerRef.current;\r\n        if (el) {\r\n            const onWheel = (e: WheelEvent) => {\r\n                if (e.deltaY === 0) return;\r\n                e.preventDefault();\r\n                el.scrollTo({\r\n                    left: el.scrollLeft + e.deltaY,\r\n                    behavior: 'auto'\r\n                });\r\n            };\r\n            el.addEventListener('wheel', onWheel, { passive: false });\r\n            return () => el.removeEventListener('wheel', onWheel);\r\n        }\r\n    }, []);\r\n\r\n    const { setNodeRef: setPoolRef } = useDroppable({\r\n        id: 'talent-pool',\r\n    });\r\n\r\n    // Team Creation State\r\n    const [isCreateDialogOpen, setIsCreateDialogOpen] = React.useState(false);\r\n    const [newTeamName, setNewTeamName] = React.useState('');\r\n    const [selectedFunctionId, setSelectedFunctionId] = React.useState<string>('all');\r\n    const [newTeamSupervisorId, setNewTeamSupervisorId] = React.useState<string>('none');\r\n    const [isCreating, setIsCreating] = React.useState(false);\r\n\r\n    // Team Editing State\r\n    const [editingTeam, setEditingTeam] = React.useState<Team | null>(null);\r\n    const [editTeamName, setEditTeamName] = React.useState('');\r\n    const [editTeamSupervisorId, setEditTeamSupervisorId] = React.useState<string>('none');\r\n    const [isUpdating, setIsUpdating] = React.useState(false);\r\n\r\n    const sensors = useSensors(\r\n        useSensor(PointerSensor, {\r\n            activationConstraint: {\r\n                delay: 250,\r\n                tolerance: 5,\r\n            },\r\n        }),\r\n        useSensor(KeyboardSensor, {\r\n            coordinateGetter: sortableKeyboardCoordinates,\r\n        })\r\n    );\r\n\r\n    // Filter talent pool (only employees with current Site/Project)\r\n    const talentPool = React.useMemo(() => {\r\n        // IDs de quem já está em alguma equipe (como membro ou como líder)\r\n        const assignedIds = new Set([\r\n            ...teams.flatMap(t => t.members),\r\n            ...teams.map(t => t.supervisorId).filter(Boolean) as string[]\r\n        ]);\r\n\r\n        return employees\r\n            .filter(emp =>\r\n                !assignedIds.has(emp.id) &&\r\n                (selectedSiteId === 'all' || emp.siteId === selectedSiteId) &&\r\n                (selectedProjectId === 'all' || sites.find(s => s.id === emp.siteId)?.projectId === selectedProjectId) &&\r\n                (!searchTerm || emp.fullName.toLowerCase().includes(searchTerm.toLowerCase())) &&\r\n                (laborTypeFilter === 'all' || getLaborClassification(emp.functionName) === laborTypeFilter)\r\n            )\r\n            // Ordenar por nível hierárquico (maior primeiro)\r\n            .sort((a, b) => {\r\n                // Primeiro por Nível Individual\r\n                if (b.level !== a.level) return b.level - a.level;\r\n                // Depois por Nível Profissional\r\n                return b.professionalLevel - a.professionalLevel;\r\n            });\r\n    }, [employees, teams, selectedSiteId, selectedProjectId, searchTerm, sites, laborTypeFilter]);\r\n\r\n    const siteTeams = React.useMemo(() => {\r\n        const usedEmployeeIds = new Set<string>();\r\n\r\n        return teams\r\n            .filter(t => (selectedSiteId === 'all' || t.siteId === selectedSiteId))\r\n            .filter(t => (selectedProjectId === 'all' || sites.find(s => s.id === t.siteId)?.projectId === selectedProjectId))\r\n            .filter(t => (laborTypeFilter === 'all' || t.laborType === laborTypeFilter))\r\n            .sort((a, b) => (a.displayOrder || 0) - (b.displayOrder || 0))\r\n            .map(team => {\r\n                // Marcar o supervisor como usado\r\n                if (team.supervisorId) {\r\n                    usedEmployeeIds.add(team.supervisorId);\r\n                }\r\n\r\n                // Filtrar membros para não incluir duplicatas, nem o próprio supervisor\r\n                const uniqueMembers = team.members.filter(memberId => {\r\n                    if (usedEmployeeIds.has(memberId)) {\r\n                        return false;\r\n                    }\r\n\r\n                    usedEmployeeIds.add(memberId);\r\n                    return true;\r\n                });\r\n\r\n                return {\r\n                    ...team,\r\n                    members: uniqueMembers\r\n                };\r\n            });\r\n    }, [teams, selectedSiteId, selectedProjectId, sites, laborTypeFilter, employees]);\r\n\r\n    const handleDragStart = (event: DragStartEvent) => {\r\n        setActiveId(event.active.id as string);\r\n        const emp = employees.find(e => e.id === event.active.id);\r\n        if (emp) setActiveEmployee(emp);\r\n    };\r\n\r\n    const handleDragOver = (event: DragOverEvent) => {\r\n        // Logic for over would be here if we did dynamic list reordering between containers\r\n    };\r\n\r\n    const handleDragEnd = async (event: DragEndEvent) => {\r\n        const { active, over } = event;\r\n        setActiveId(null);\r\n        setActiveEmployee(null);\r\n\r\n        if (!over) return;\r\n\r\n        const employeeId = active.id as string;\r\n        const employeeData = active.data.current?.employee as Employee;\r\n        const overId = over.id as string;\r\n\r\n        // Determinar se o destino é uma equipe válida\r\n        // Pode ser o ID da equipe ou o ID de qualquer membro/líder nela\r\n        const targetTeam = teams.find(t =>\r\n            t.id === overId ||\r\n            t.members.includes(overId) ||\r\n            t.supervisorId === overId\r\n        );\r\n\r\n        const sourceTeam = teams.find(t => t.members.includes(employeeId) || t.supervisorId === employeeId);\r\n        const isLeader = sourceTeam?.supervisorId === employeeId;\r\n\r\n        // --- CORREÇÃO BUG: Se soltar na mesma equipe de origem, não faz nada ---\r\n        if (targetTeam?.id === sourceTeam?.id && !overId.startsWith('leader-') && overId !== 'talent-pool') {\r\n            return;\r\n        }\r\n\r\n        // Detecta se soltou no pool ou sobre qualquer card que já esteja no pool\r\n        const isOverPool = overId === 'talent-pool' ||\r\n            overId === 'talent-pool-scroll' ||\r\n            talentPool.some(e => e.id === overId);\r\n\r\n        // Verificar se está soltando no slot de líder\r\n        const isOverLeaderSlot = overId.startsWith('leader-');\r\n        if (isOverLeaderSlot) {\r\n            const teamId = overId.replace('leader-', '');\r\n            await handleSetLeader(teamId, employeeId);\r\n            return;\r\n        }\r\n\r\n        // Ação: Mover para Equipe\r\n        if (targetTeam && sourceTeam?.id !== targetTeam.id) {\r\n            // VALIDAR HOMOGENEIDADE NA UI\r\n            const teamLaborType = targetTeam.laborType || 'MOD';\r\n            const employeeLaborType = getLaborClassification(employeeData?.functionName);\r\n\r\n            if (teamLaborType !== employeeLaborType) {\r\n                toast({\r\n                    title: \"Incompatibilidade\",\r\n                    description: `Não é possível adicionar um colaborador ${employeeLaborType} a uma equipe ${teamLaborType}`,\r\n                    variant: \"destructive\"\r\n                });\r\n                return;\r\n            }\r\n\r\n            const success = await moveMember(employeeId, sourceTeam?.id || null, targetTeam.id);\r\n            if (success && employeeData) {\r\n                toast({\r\n                    title: \"Escala Atualizada\",\r\n                    description: `${employeeData.fullName} foi movido para ${targetTeam.name}`,\r\n                    className: \"bg-emerald-500/10 border-emerald-500/20 text-emerald-500\"\r\n                });\r\n            }\r\n        }\r\n        // Ação: Retornar para Disponíveis\r\n        else if (isOverPool) {\r\n            if (isLeader) {\r\n                // É um líder sendo removido\r\n                const success = await updateTeam(sourceTeam!.id, {\r\n                    name: sourceTeam!.name,\r\n                    supervisorId: 'none' as any, // Remove líder\r\n                    members: sourceTeam!.members\r\n                });\r\n                if (success) {\r\n                    toast({\r\n                        title: \"Liderança Removida\",\r\n                        description: `${employeeData?.fullName} voltou para disponíveis`,\r\n                        className: \"bg-orange-500/10 border-orange-500/20 text-orange-500\"\r\n                    });\r\n                }\r\n            } else if (sourceTeam) {\r\n                // É um membro normal sendo removido\r\n                const success = await moveMember(employeeId, sourceTeam.id, null);\r\n                if (success && employeeData) {\r\n                    toast({\r\n                        title: \"Removido da Equipe\",\r\n                        description: `${employeeData.fullName} voltou para a lista de disponíveis`,\r\n                        className: \"bg-orange-500/10 border-orange-500/20 text-orange-500\"\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        // Se soltou em uma equipe mas não veio de nenhuma ou veio de outra\r\n        else if (targetTeam) {\r\n            // VALIDAR HOMOGENEIDADE NA UI\r\n            const teamLaborType = targetTeam.laborType || 'MOD';\r\n            const employeeLaborType = getLaborClassification(employeeData?.functionName);\r\n\r\n            if (teamLaborType !== employeeLaborType) {\r\n                toast({\r\n                    title: \"Incompatibilidade\",\r\n                    description: `Não é possível adicionar um colaborador ${employeeLaborType} a uma equipe ${teamLaborType}`,\r\n                    variant: \"destructive\"\r\n                });\r\n                return;\r\n            }\r\n\r\n            const success = await moveMember(employeeId, sourceTeam?.id || null, targetTeam.id);\r\n            if (success && employeeData) {\r\n                toast({\r\n                    title: \"Escala Atualizada\",\r\n                    description: `${employeeData.fullName} foi movido para ${targetTeam.name}`,\r\n                    className: \"bg-emerald-500/10 border-emerald-500/20 text-emerald-500\"\r\n                });\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleClearTeamMembers = async (teamId: string) => {\r\n        const team = teams.find(t => t.id === teamId);\r\n        if (!team || team.members.length === 0) return;\r\n\r\n        const memberCount = team.members.length;\r\n        const teamName = team.name;\r\n        const memberIds = [...team.members];\r\n\r\n        if (!confirm(`Tem certeza que deseja remover todos os ${memberCount} membros da equipe \"${teamName}\"?`)) {\r\n            return;\r\n        }\r\n\r\n        // Feedback imediato\r\n        toast({\r\n            title: \"Processando...\",\r\n            description: `Removendo ${memberCount} membros de ${teamName}`\r\n        });\r\n\r\n        // Dispara todas as remoções em paralelo (fila assíncrona)\r\n        await Promise.all(\r\n            memberIds.map(memberId => moveMember(memberId, teamId, null))\r\n        );\r\n\r\n        // Toast de confirmação final\r\n        toast({\r\n            title: \"Equipe Limpa!\",\r\n            description: `${memberCount} membros foram removidos de ${teamName}`,\r\n            className: \"bg-emerald-500/10 border-emerald-500/20 text-emerald-500\"\r\n        });\r\n    };\r\n\r\n    const handleSetLeader = async (teamId: string, employeeId: string) => {\r\n        const team = teams.find(t => t.id === teamId);\r\n        const employee = employees.find(e => e.id === employeeId);\r\n        if (!team || !employee) return;\r\n\r\n        // Remover o funcionário de qualquer equipe onde ele esteja como membro\r\n        const currentTeam = teams.find(t => t.members.includes(employeeId));\r\n        if (currentTeam) {\r\n            await moveMember(employeeId, currentTeam.id, null);\r\n        }\r\n\r\n        // Definir como supervisor da equipe\r\n        // VALIDAR HOMOGENEIDADE PARA LÍDER\r\n        const teamLaborType = team.laborType || 'MOD';\r\n        const employeeLaborType = getLaborClassification(employee.functionName);\r\n\r\n        if (teamLaborType !== employeeLaborType) {\r\n            toast({\r\n                title: \"Incompatibilidade de Líder\",\r\n                description: `O líder é ${employeeLaborType}, mas a equipe é ${teamLaborType}`,\r\n                variant: \"destructive\"\r\n            });\r\n            return;\r\n        }\r\n\r\n        await updateTeam(teamId, {\r\n            name: team.name,\r\n            supervisorId: employeeId,\r\n            members: team.members,\r\n            siteId: team.siteId || undefined,\r\n            companyId: team.companyId || undefined\r\n        });\r\n\r\n        toast({\r\n            title: \"Líder Definido!\",\r\n            description: `${employee.fullName} agora lidera a equipe ${team.name}`,\r\n            className: \"bg-emerald-500/10 border-emerald-500/20 text-emerald-500\"\r\n        });\r\n    };\r\n\r\n    const handleCreateTeam = async () => {\r\n        if (!newTeamName.trim()) {\r\n            toast({ title: \"Nome obrigatório\", description: \"Dê um nome para a equipe\", variant: \"destructive\" });\r\n            return;\r\n        }\r\n\r\n        if (selectedSiteId === 'all') {\r\n            toast({ title: \"Selecione um canteiro\", description: \"É necessário filtrar um canteiro antes de criar a equipe\", variant: \"destructive\" });\r\n            return;\r\n        }\r\n\r\n        setIsCreating(true);\r\n        try {\r\n            const result = await createTeam({\r\n                name: newTeamName,\r\n                supervisorId: newTeamSupervisorId === 'none' ? undefined : newTeamSupervisorId,\r\n                siteId: selectedSiteId,\r\n                companyId: profile?.companyId || undefined,\r\n                members: [],\r\n                laborType: laborTypeFilter === 'all' ? 'MOD' : laborTypeFilter // Usa o filtro atual como padrão\r\n            });\r\n\r\n            if (result.success) {\r\n                toast({ title: \"Equipe criada!\", description: \"Agora você pode arrastar membros para ela.\" });\r\n                setNewTeamName('');\r\n                setSelectedFunctionId('all');\r\n                setNewTeamSupervisorId('none');\r\n                setIsCreateDialogOpen(false);\r\n            }\r\n        } finally {\r\n            setIsCreating(false);\r\n        }\r\n    };\r\n\r\n    const handleUpdateTeam = async () => {\r\n        if (!editingTeam || !editTeamName.trim()) return;\r\n\r\n        setIsUpdating(true);\r\n        try {\r\n            const result = await updateTeam(editingTeam.id, {\r\n                name: editTeamName,\r\n                supervisorId: editTeamSupervisorId === 'none' ? undefined : editTeamSupervisorId,\r\n                members: editingTeam.members,\r\n                siteId: editingTeam.siteId || undefined,\r\n                companyId: editingTeam.companyId || undefined,\r\n                laborType: editingTeam.laborType || 'MOD'\r\n            });\r\n\r\n            if (result.success) {\r\n                toast({ title: \"Equipe atualizada!\" });\r\n                setEditingTeam(null);\r\n            }\r\n        } finally {\r\n            setIsUpdating(false);\r\n        }\r\n    };\r\n\r\n    const handleDeleteTeam = async (id: string) => {\r\n        if (confirm(\"Tem certeza que deseja excluir esta equipe? Os membros voltarão para a lista de disponíveis.\")) {\r\n            await deleteTeam(id);\r\n            toast({ title: \"Equipe excluída\" });\r\n        }\r\n    };\r\n\r\n    if (loadingTeams || loadingEmployees || loadingProjects || loadingSites) {\r\n        return (\r\n            <div className=\"flex items-center justify-center h-screen\">\r\n                <Loader2 className=\"w-10 h-10 animate-spin text-primary\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"h-[calc(100vh-8rem)] flex flex-col gap-6 animate-fade-in overflow-hidden\">\r\n            {/* Header com Filtro */}\r\n            <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n                <div className=\"flex flex-col gap-1\">\r\n                    <h1 className=\"text-3xl font-display font-bold gradient-text leading-tight\">Composition Builder</h1>\r\n                    <div className=\"flex items-center gap-3 text-muted-foreground\">\r\n                        <div className=\"flex items-center gap-1.5 px-2 py-0.5 rounded-full bg-white/5 border border-white/5 text-[10px] font-bold uppercase tracking-wider\">\r\n                            <ArrowRightLeft className=\"w-3 h-3 text-primary\" />\r\n                            Arrastar p/ Gerenciar\r\n                        </div>\r\n                        <span className=\"text-xs\">Organize sua mão de obra visualmente</span>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex flex-wrap items-center gap-3\">\r\n                    {/* Seletor de Obra */}\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <HardHat className=\"w-4 h-4 text-primary\" />\r\n                        <Select value={selectedProjectId} onValueChange={(val) => {\r\n                            setSelectedProjectId(val);\r\n                            setSelectedSiteId('all');\r\n                        }}>\r\n                            <SelectTrigger className=\"w-64 industrial-input h-10\">\r\n                                <SelectValue placeholder=\"Todas as Obras\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                                <SelectItem value=\"all\">Todas as Obras</SelectItem>\r\n                                {projects.map(p => (\r\n                                    <SelectItem key={p.id} value={p.id}>{p.name}</SelectItem>\r\n                                ))}\r\n                            </SelectContent>\r\n                        </Select>\r\n                    </div>\r\n\r\n                    {/* Seletor de Canteiro */}\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <Truck className=\"w-4 h-4 text-orange-500\" />\r\n                        <Select value={selectedSiteId} onValueChange={(val) => {\r\n                            setSelectedSiteId(val);\r\n                            if (val !== 'all') {\r\n                                const site = sites.find(s => s.id === val);\r\n                                if (site && site.projectId !== selectedProjectId) {\r\n                                    setSelectedProjectId(site.projectId);\r\n                                }\r\n                            }\r\n                        }}>\r\n                            <SelectTrigger className=\"w-64 industrial-input h-10\">\r\n                                <SelectValue placeholder=\"Todos os Canteiros\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                                <SelectItem value=\"all\">Todos os Canteiros</SelectItem>\r\n                                {sites.filter(s => selectedProjectId === 'all' || s.projectId === selectedProjectId).map(s => (\r\n                                    <SelectItem key={s.id} value={s.id}>{s.name}</SelectItem>\r\n                                ))}\r\n                            </SelectContent>\r\n                        </Select>\r\n                    </div>\r\n\r\n                    <div className=\"w-px h-6 bg-white/10 mx-1\" />\r\n\r\n                    <div className=\"relative w-72\">\r\n                        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\r\n                        <Input\r\n                            placeholder=\"Buscar colaborador...\"\r\n                            className=\"pl-10 industrial-input h-10\"\r\n                            value={searchTerm}\r\n                            onChange={e => setSearchTerm(e.target.value)}\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"w-px h-6 bg-white/10 mx-1\" />\r\n\r\n                    <Button\r\n                        onClick={() => setIsStatsOpen(true)}\r\n                        className=\"gradient-primary hover:shadow-glow font-bold h-10 px-4\"\r\n                    >\r\n                        <Settings className=\"w-4 h-4 mr-2\" />\r\n                        Estatísticas\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Filtro de MOD/MOI Superior */}\r\n            <div className=\"flex items-center gap-2 p-1 bg-black/20 border border-white/5 rounded-xl w-fit self-center md:self-start\">\r\n                <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    onClick={() => setLaborTypeFilter('all')}\r\n                    className={cn(\r\n                        \"text-[10px] font-black uppercase px-4 h-8 transition-all rounded-lg\",\r\n                        laborTypeFilter === 'all' ? \"bg-primary text-black\" : \"text-muted-foreground hover:text-foreground\"\r\n                    )}\r\n                >\r\n                    Todos\r\n                </Button>\r\n                <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    onClick={() => setLaborTypeFilter('MOD')}\r\n                    className={cn(\r\n                        \"text-[10px] font-black uppercase px-4 h-8 transition-all rounded-lg\",\r\n                        laborTypeFilter === 'MOD' ? \"bg-emerald-500 text-black shadow-glow-sm\" : \"text-muted-foreground hover:text-emerald-500\"\r\n                    )}\r\n                >\r\n                    Mão de Obra Direta (MOD)\r\n                </Button>\r\n                <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    onClick={() => setLaborTypeFilter('MOI')}\r\n                    className={cn(\r\n                        \"text-[10px] font-black uppercase px-4 h-8 transition-all rounded-lg\",\r\n                        laborTypeFilter === 'MOI' ? \"bg-blue-500 text-black shadow-glow-sm\" : \"text-muted-foreground hover:text-blue-500\"\r\n                    )}\r\n                >\r\n                    Mão de Obra Indireta (MOI)\r\n                </Button>\r\n            </div>\r\n\r\n            <DndContext\r\n                sensors={sensors}\r\n                collisionDetection={closestCorners} // Mais intuitivo para grid/listas horizontais\r\n                onDragStart={handleDragStart}\r\n                onDragEnd={handleDragEnd}\r\n            >\r\n                <div className=\"flex-1 flex gap-6 overflow-hidden\">\r\n                    {/* Sidebar: Talent Pool */}\r\n                    <div className=\"w-96 flex flex-col rounded-2xl border border-white/5 bg-black/40 overflow-hidden drop-shadow-strong\">\r\n                        <div className=\"p-5 border-b border-white/5 bg-linear-to-b from-white/5 to-transparent\">\r\n                            <div className=\"flex items-center justify-between mb-3\">\r\n                                <h3 className=\"font-bold flex items-center gap-2\">\r\n                                    <UserPlus className=\"w-5 h-5 text-primary\" />\r\n                                    Disponíveis\r\n                                </h3>\r\n                                <Badge variant=\"outline\" className=\"bg-primary/5 text-primary border-primary/20\">\r\n                                    {talentPool.length}\r\n                                </Badge>\r\n                            </div>\r\n                            <p className=\"text-xs text-muted-foreground\">Colaboradores sem equipe definida para este canteiro.</p>\r\n                        </div>\r\n\r\n                        <ScrollArea className=\"flex-1 p-4\" id=\"talent-pool-scroll\">\r\n                            <div ref={setPoolRef} id=\"talent-pool\" className=\"min-h-full pb-20\">\r\n                                <SortableContext\r\n                                    id=\"talent-pool\"\r\n                                    items={talentPool.map(m => m.id)}\r\n                                    strategy={verticalListSortingStrategy}\r\n                                >\r\n                                    {talentPool.length === 0 ? (\r\n                                        <div className=\"flex flex-col items-center justify-center py-10 opacity-30 text-center\">\r\n                                            <Users className=\"w-10 h-10 mb-2\" />\r\n                                            <p className=\"text-xs\">Nenhum disponível</p>\r\n                                        </div>\r\n                                    ) : (\r\n                                        talentPool.map(emp => (\r\n                                            <EmployeeCard key={emp.id} employee={emp} />\r\n                                        ))\r\n                                    )}\r\n                                </SortableContext>\r\n                            </div>\r\n                        </ScrollArea>\r\n                    </div>\r\n\r\n                    {/* Main Area: Teams Horizontal Scroller */}\r\n                    <div\r\n                        ref={scrollContainerRef}\r\n                        className=\"flex-1 overflow-x-auto pb-4 custom-scrollbar select-none\"\r\n                    >\r\n                        <div className=\"flex gap-6 h-full items-start\">\r\n                            {siteTeams.map(team => (\r\n                                <TeamColumn\r\n                                    key={team.id}\r\n                                    team={team}\r\n                                    members={employees\r\n                                        .filter(e => team.members.includes(e.id))\r\n                                        .sort((a, b) => {\r\n                                            if (b.level !== a.level) return b.level - a.level;\r\n                                            return b.professionalLevel - a.professionalLevel;\r\n                                        })\r\n                                    }\r\n                                    supervisorEmployee={employees.find(e => e.id === team.supervisorId)}\r\n                                    onEdit={(t) => {\r\n                                        setEditingTeam(t);\r\n                                        setEditTeamName(t.name);\r\n                                        setEditTeamSupervisorId(t.supervisorId || 'none');\r\n                                    }}\r\n                                    onDelete={handleDeleteTeam}\r\n                                    onClearMembers={handleClearTeamMembers}\r\n                                    onSetLeader={handleSetLeader}\r\n                                />\r\n                            ))}\r\n\r\n                            {/* Botão de Criação com Dialog */}\r\n                            <Dialog open={isCreateDialogOpen} onOpenChange={setIsCreateDialogOpen}>\r\n                                <DialogTrigger asChild>\r\n                                    <Button variant=\"outline\" className=\"w-80 h-32 border-dashed border-white/10 hover:border-primary/50 hover:bg-primary/5 rounded-2xl mt-0 group\">\r\n                                        <div className=\"flex flex-col items-center gap-2\">\r\n                                            <div className=\"w-10 h-10 rounded-full bg-white/5 flex items-center justify-center group-hover:bg-primary/20 transition-colors\">\r\n                                                <Users className=\"w-5 h-5 text-muted-foreground group-hover:text-primary\" />\r\n                                            </div>\r\n                                            <span className=\"text-sm font-bold opacity-40 group-hover:opacity-100 transition-all\">Criar Nova Equipe</span>\r\n                                        </div>\r\n                                    </Button>\r\n                                </DialogTrigger>\r\n                                <DialogContent className=\"glass-card border-white/10 text-foreground\">\r\n                                    <DialogHeader>\r\n                                        <DialogTitle className=\"text-2xl font-display font-bold\">Nova Equipe</DialogTitle>\r\n                                        <DialogDescription className=\"text-muted-foreground\">\r\n                                            Defina o nome e o líder para a nova frente de serviço.\r\n                                        </DialogDescription>\r\n                                    </DialogHeader>\r\n                                    <div className=\"space-y-6 py-4\">\r\n                                        <div className=\"space-y-2\">\r\n                                            <Label htmlFor=\"name\" className=\"text-xs font-bold uppercase tracking-widest opacity-60\">Nome da Equipe</Label>\r\n                                            <Input\r\n                                                id=\"name\"\r\n                                                placeholder=\"Ex: Equipe de Alvenaria L1\"\r\n                                                className=\"industrial-input h-12\"\r\n                                                value={newTeamName}\r\n                                                onChange={e => setNewTeamName(e.target.value)}\r\n                                            />\r\n                                        </div>\r\n\r\n                                        <div className=\"space-y-2\">\r\n                                            <Label htmlFor=\"function\" className=\"text-xs font-bold uppercase tracking-widest opacity-60\">Filtrar por Cargo</Label>\r\n                                            <Select value={selectedFunctionId} onValueChange={(val) => {\r\n                                                setSelectedFunctionId(val);\r\n                                                setNewTeamSupervisorId('none');\r\n                                            }}>\r\n                                                <SelectTrigger className=\"industrial-input h-12\">\r\n                                                    <SelectValue placeholder=\"Todos os cargos\" />\r\n                                                </SelectTrigger>\r\n                                                <SelectContent className=\"glass-card\">\r\n                                                    <SelectItem value=\"all\">Todos os cargos</SelectItem>\r\n                                                    <SelectItem value=\"leaders\">Líderes Qualificados (Com Coroa)</SelectItem>\r\n                                                    {functions.map(f => (\r\n                                                        <SelectItem key={f.id} value={f.id}>{f.name}</SelectItem>\r\n                                                    ))}\r\n                                                </SelectContent>\r\n                                            </Select>\r\n                                        </div>\r\n\r\n                                        <div className=\"space-y-2\">\r\n                                            <Label htmlFor=\"supervisor\" className=\"text-xs font-bold uppercase tracking-widest opacity-60\">Líder / Supervisor</Label>\r\n                                            <Select value={newTeamSupervisorId} onValueChange={setNewTeamSupervisorId}>\r\n                                                <SelectTrigger className=\"industrial-input h-12\">\r\n                                                    <SelectValue placeholder=\"Selecione um líder\" />\r\n                                                </SelectTrigger>\r\n                                                <SelectContent>\r\n                                                    <SelectItem value=\"none\">Sem Supervisor (Definir depois)</SelectItem>\r\n                                                    {employees\r\n                                                        .filter(e => e.isActive && (\r\n                                                            selectedFunctionId === 'all' ||\r\n                                                            (selectedFunctionId === 'leaders' ? e.canLeadTeam : e.functionId === selectedFunctionId)\r\n                                                        ))\r\n                                                        .map(emp => (\r\n                                                            <SelectItem key={emp.id} value={emp.id}>\r\n                                                                <div className=\"flex items-center gap-2\">\r\n                                                                    {emp.fullName}\r\n                                                                    {emp.canLeadTeam && <Crown className=\"w-3 h-3 text-amber-500 fill-amber-500/20\" />}\r\n                                                                </div>\r\n                                                            </SelectItem>\r\n                                                        ))}\r\n                                                </SelectContent>\r\n                                            </Select>\r\n                                        </div>      </div>\r\n                                    <DialogFooter>\r\n                                        <Button\r\n                                            className=\"w-full h-12 font-bold gradient-primary hover:shadow-glow transition-all\"\r\n                                            onClick={handleCreateTeam}\r\n                                            disabled={isCreating}\r\n                                        >\r\n                                            {isCreating ? <Loader2 className=\"w-4 h-4 animate-spin mr-2\" /> : <Users className=\"w-4 h-4 mr-2\" />}\r\n                                            Confirmar Criação\r\n                                        </Button>\r\n                                    </DialogFooter>\r\n                                </DialogContent>\r\n                            </Dialog>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Drag Overlay - Refinado para ser mais premium */}\r\n                <DragOverlay\r\n                    adjustScale={true}\r\n                    style={{ cursor: 'grabbing' }}\r\n                >\r\n                    {activeEmployee ? (\r\n                        <div className=\"z-50 w-[384px] shadow-2xl opacity-90\">\r\n                            <EmployeeCardStatic employee={activeEmployee} isOverlay />\r\n                        </div>\r\n                    ) : null}\r\n                </DragOverlay>\r\n\r\n                {/* Edit Team Dialog */}\r\n                <Dialog open={!!editingTeam} onOpenChange={(open) => !open && setEditingTeam(null)}>\r\n                    <DialogContent className=\"glass-card border-white/10 text-foreground\">\r\n                        <DialogHeader>\r\n                            <DialogTitle className=\"text-2xl font-display font-bold\">Editar Equipe</DialogTitle>\r\n                        </DialogHeader>\r\n                        <div className=\"space-y-6 py-4\">\r\n                            <div className=\"space-y-2\">\r\n                                <Label className=\"text-xs font-bold uppercase tracking-widest opacity-60\">Nome da Equipe</Label>\r\n                                <Input\r\n                                    className=\"industrial-input h-12\"\r\n                                    value={editTeamName}\r\n                                    onChange={e => setEditTeamName(e.target.value)}\r\n                                />\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <Label className=\"text-xs font-bold uppercase tracking-widest opacity-60\">Líder / Supervisor</Label>\r\n                                <Select value={editTeamSupervisorId} onValueChange={setEditTeamSupervisorId}>\r\n                                    <SelectTrigger className=\"industrial-input h-12\">\r\n                                        <SelectValue />\r\n                                    </SelectTrigger>\r\n                                    <SelectContent>\r\n                                        <SelectItem value=\"none\">Sem Supervisor</SelectItem>\r\n                                        {employees.filter(e => e.isActive).map(emp => (\r\n                                            <SelectItem key={emp.id} value={emp.id}>\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    {emp.fullName}\r\n                                                    {emp.canLeadTeam && <Crown className=\"w-3 h-3 text-amber-500 fill-amber-500/20\" />}\r\n                                                </div>\r\n                                            </SelectItem>\r\n                                        ))}\r\n                                    </SelectContent>\r\n                                </Select>\r\n                            </div>\r\n                        </div>\r\n                        <DialogFooter>\r\n                            <Button\r\n                                className=\"w-full h-12 font-bold gradient-primary\"\r\n                                onClick={handleUpdateTeam}\r\n                                disabled={isUpdating}\r\n                            >\r\n                                {isUpdating && <Loader2 className=\"w-4 h-4 animate-spin mr-2\" />}\r\n                                Salvar Alterações\r\n                            </Button>\r\n                        </DialogFooter>\r\n                    </DialogContent>\r\n                </Dialog>\r\n                {/* Panel de Estatísticas Avançadas */}\r\n                <CompositionStatsPanel\r\n                    isOpen={isStatsOpen}\r\n                    onClose={() => setIsStatsOpen(false)}\r\n                    employees={employees}\r\n                    teams={teams}\r\n                    selectedSiteId={selectedSiteId}\r\n                    selectedProjectId={selectedProjectId}\r\n                    sites={sites}\r\n                    projects={projects}\r\n                />\r\n            </DndContext>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\TeamCompositionTable.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CardDescription' is defined but never used.","line":7,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":44}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react';\r\nimport { useTeams } from '@/hooks/useTeams';\r\nimport { useEmployees } from '@/hooks/useEmployees';\r\nimport { useSites } from '@/hooks/useSites';\r\nimport { useProjects } from '@/hooks/useProjects';\r\nimport { useCompanies } from '@/hooks/useCompanies';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\r\nimport {\r\n    Loader2,\r\n    Target,\r\n    FileSpreadsheet,\r\n    Printer,\r\n    CheckCircle2,\r\n    XCircle\r\n} from 'lucide-react';\r\n\r\nimport { useSignals } from \"@preact/signals-react/runtime\";\r\n\r\nexport default function TeamCompositionTable() {\r\n    useSignals();\r\n    const { teams, isLoading: loadingTeams } = useTeams();\r\n    const { employees, isLoading: loadingEmployees } = useEmployees();\r\n    const { sites } = useSites();\r\n    const { projects } = useProjects();\r\n    const { companies } = useCompanies();\r\n\r\n    const [selectedCompany, setSelectedCompany] = React.useState<string>('all');\r\n    const [selectedProject, setSelectedProject] = React.useState<string>('all');\r\n    const [selectedSite, setSelectedSite] = React.useState<string>('all');\r\n\r\n    const isLoading = loadingTeams || loadingEmployees;\r\n\r\n    // Filter employees based on selections\r\n    const filteredEmployees = React.useMemo(() => {\r\n        return employees.filter(emp => {\r\n            // Only filter by selected filters, don't exclude employees without company\r\n            if (selectedCompany !== 'all' && emp.companyId !== selectedCompany) return false;\r\n            if (selectedSite !== 'all' && emp.siteId !== selectedSite) return false;\r\n\r\n            if (selectedProject !== 'all') {\r\n                const site = sites.find(s => s.id === emp.siteId);\r\n                if (site?.projectId !== selectedProject) return false;\r\n            }\r\n\r\n            // Show all employees (active and inactive)\r\n            return true;\r\n        }).sort((a, b) => a.registrationNumber.localeCompare(b.registrationNumber));\r\n    }, [employees, selectedCompany, selectedProject, selectedSite, sites]);\r\n\r\n    const handlePrint = () => {\r\n        window.print();\r\n    };\r\n\r\n    const handleExportExcel = () => {\r\n        // Prepare data\r\n        const data = filteredEmployees.map(emp => {\r\n            const team = teams.find(t => t.members?.includes(emp.id));\r\n            const site = sites.find(s => s.id === emp.siteId);\r\n            const project = projects.find(p => p.id === site?.projectId);\r\n            const company = companies.find(c => c.id === emp.companyId);\r\n\r\n            return {\r\n                'Nº Registro': emp.registrationNumber,\r\n                'Nome Completo': emp.fullName,\r\n                'Função': emp.functionName || 'Não definida',\r\n                'Equipe': team?.name || '-',\r\n                'Canteiro': site?.name || '-',\r\n                'Obra': project?.name || '-',\r\n                'Empresa': company?.name || '-',\r\n                'Status': emp.isActive ? 'ATIVO' : 'INATIVO'\r\n            };\r\n        });\r\n\r\n        // Create HTML table for Excel\r\n        const tableHTML = `\r\n            <html xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:x=\"urn:schemas-microsoft-com:office:excel\">\r\n            <head>\r\n                <meta charset=\"utf-8\">\r\n                <style>\r\n                    table { border-collapse: collapse; width: 100%; }\r\n                    th { \r\n                        background-color: #3b82f6; \r\n                        color: white; \r\n                        font-weight: bold; \r\n                        padding: 12px; \r\n                        text-align: center;\r\n                        border: 1px solid #ddd;\r\n                    }\r\n                    td { \r\n                        padding: 10px; \r\n                        border: 1px solid #ddd; \r\n                        text-align: center;\r\n                    }\r\n                    tr:nth-child(even) { background-color: #f9fafb; }\r\n                    tr:hover { background-color: #e5e7eb; }\r\n                    .status-active { color: #10b981; font-weight: bold; }\r\n                    .status-inactive { color: #ef4444; font-weight: bold; }\r\n                </style>\r\n            </head>\r\n            <body>\r\n                <h1 style=\"color: #1f2937; margin-bottom: 20px;\">Composição de Equipes - Relatório Detalhado</h1>\r\n                <p style=\"color: #6b7280; margin-bottom: 20px;\">\r\n                    Data de Geração: ${new Date().toLocaleDateString('pt-BR')} às ${new Date().toLocaleTimeString('pt-BR')}<br>\r\n                    Total de Colaboradores: ${data.length}\r\n                </p>\r\n                <table>\r\n                    <thead>\r\n                        <tr>\r\n                            <th>Nº Registro</th>\r\n                            <th>Nome Completo</th>\r\n                            <th>Função</th>\r\n                            <th>Equipe</th>\r\n                            <th>Canteiro</th>\r\n                            <th>Obra</th>\r\n                            <th>Empresa</th>\r\n                            <th>Status</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        ${data.map(row => `\r\n                            <tr>\r\n                                <td>${row['Nº Registro']}</td>\r\n                                <td style=\"text-align: left;\">${row['Nome Completo']}</td>\r\n                                <td>${row['Função']}</td>\r\n                                <td>${row['Equipe']}</td>\r\n                                <td>${row['Canteiro']}</td>\r\n                                <td>${row['Obra']}</td>\r\n                                <td>${row['Empresa']}</td>\r\n                                <td class=\"${row['Status'] === 'ATIVO' ? 'status-active' : 'status-inactive'}\">${row['Status']}</td>\r\n                            </tr>\r\n                        `).join('')}\r\n                    </tbody>\r\n                </table>\r\n                <br>\r\n                <p style=\"color: #6b7280; font-size: 12px; margin-top: 30px;\">\r\n                    <strong>Filtros Aplicados:</strong><br>\r\n                    Empresa: ${selectedCompany === 'all' ? 'Todas' : companies.find(c => c.id === selectedCompany)?.name || 'N/A'}<br>\r\n                    Obra: ${selectedProject === 'all' ? 'Todas' : projects.find(p => p.id === selectedProject)?.name || 'N/A'}<br>\r\n                    Canteiro: ${selectedSite === 'all' ? 'Todos' : sites.find(s => s.id === selectedSite)?.name || 'N/A'}\r\n                </p>\r\n            </body>\r\n            </html>\r\n        `;\r\n\r\n        // Create blob and download\r\n        const blob = new Blob([tableHTML], { type: 'application/vnd.ms-excel' });\r\n        const link = document.createElement('a');\r\n        link.href = URL.createObjectURL(blob);\r\n\r\n        const filterSuffix = selectedCompany !== 'all' || selectedProject !== 'all' || selectedSite !== 'all' ? '_filtrado' : '';\r\n        link.download = `Composicao_Equipes_${new Date().toISOString().split('T')[0]}${filterSuffix}.xls`;\r\n        link.click();\r\n    };\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center h-64\">\r\n                <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-fade-in\">\r\n            {/* Header */}\r\n            <div className=\"flex flex-col gap-4 md:flex-row md:items-center md:justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary via-purple-500 to-pink-500 bg-clip-text text-transparent\">\r\n                        Composição de Equipes - Tabela Detalhada\r\n                    </h1>\r\n                    <p className=\"text-muted-foreground mt-1\">\r\n                        Visualização completa de todos os colaboradores com suas atribuições\r\n                    </p>\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    <Button onClick={handleExportExcel} variant=\"outline\" className=\"gap-2\">\r\n                        <FileSpreadsheet className=\"w-4 h-4\" />\r\n                        Exportar Excel\r\n                    </Button>\r\n                    <Button onClick={handlePrint} variant=\"outline\" className=\"gap-2\">\r\n                        <Printer className=\"w-4 h-4\" />\r\n                        Imprimir\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Filters */}\r\n            <Card className=\"glass-card border-white/5\">\r\n                <CardHeader>\r\n                    <CardTitle className=\"flex items-center gap-2 text-lg\">\r\n                        <Target className=\"w-5 h-5 text-primary\" />\r\n                        Filtros de Análise\r\n                    </CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-xs font-medium text-muted-foreground uppercase tracking-wider\">\r\n                                Empresa\r\n                            </label>\r\n                            <Select value={selectedCompany} onValueChange={(val) => {\r\n                                setSelectedCompany(val);\r\n                                setSelectedProject('all');\r\n                                setSelectedSite('all');\r\n                            }}>\r\n                                <SelectTrigger className=\"industrial-input\">\r\n                                    <SelectValue />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"all\">Todas as empresas</SelectItem>\r\n                                    {companies.map(c => (\r\n                                        <SelectItem key={c.id} value={c.id}>{c.name}</SelectItem>\r\n                                    ))}\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-xs font-medium text-muted-foreground uppercase tracking-wider\">\r\n                                Obra\r\n                            </label>\r\n                            <Select value={selectedProject} onValueChange={(val) => {\r\n                                setSelectedProject(val);\r\n                                setSelectedSite('all');\r\n                            }}>\r\n                                <SelectTrigger className=\"industrial-input\">\r\n                                    <SelectValue />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"all\">Todas as obras</SelectItem>\r\n                                    {projects\r\n                                        .filter(p => selectedCompany === 'all' || p.companyId === selectedCompany)\r\n                                        .map(p => (\r\n                                            <SelectItem key={p.id} value={p.id}>{p.name}</SelectItem>\r\n                                        ))}\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-xs font-medium text-muted-foreground uppercase tracking-wider\">\r\n                                Canteiro\r\n                            </label>\r\n                            <Select value={selectedSite} onValueChange={setSelectedSite}>\r\n                                <SelectTrigger className=\"industrial-input\">\r\n                                    <SelectValue />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"all\">Todos os canteiros</SelectItem>\r\n                                    {sites\r\n                                        .filter(s => {\r\n                                            if (selectedCompany !== 'all' && s.companyId !== selectedCompany) return false;\r\n                                            if (selectedProject !== 'all' && s.projectId !== selectedProject) return false;\r\n                                            return true;\r\n                                        })\r\n                                        .map(s => (\r\n                                            <SelectItem key={s.id} value={s.id}>{s.name}</SelectItem>\r\n                                        ))}\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* Summary */}\r\n            <Card className=\"glass-card border-white/5\">\r\n                <CardContent className=\"pt-6\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div>\r\n                            <p className=\"text-sm font-medium text-muted-foreground\">Total de Registros</p>\r\n                            <p className=\"text-2xl font-bold text-primary mt-1\">{filteredEmployees.length} colaboradores</p>\r\n                        </div>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* Table */}\r\n            <Card className=\"glass-card border-white/5\">\r\n                <CardContent className=\"p-0\">\r\n                    <div className=\"overflow-x-auto\">\r\n                        <Table>\r\n                            <TableHeader className=\"bg-white/5\">\r\n                                <TableRow className=\"hover:bg-transparent border-white/10\">\r\n                                    <TableHead className=\"text-center font-bold text-xs uppercase tracking-wider\">Nº</TableHead>\r\n                                    <TableHead className=\"text-center font-bold text-xs uppercase tracking-wider\">Nome Completo</TableHead>\r\n                                    <TableHead className=\"text-center font-bold text-xs uppercase tracking-wider\">Função</TableHead>\r\n                                    <TableHead className=\"text-center font-bold text-xs uppercase tracking-wider\">Equipe</TableHead>\r\n                                    <TableHead className=\"text-center font-bold text-xs uppercase tracking-wider\">Canteiro</TableHead>\r\n                                    <TableHead className=\"text-center font-bold text-xs uppercase tracking-wider\">Obra</TableHead>\r\n                                    <TableHead className=\"text-center font-bold text-xs uppercase tracking-wider\">Empresa</TableHead>\r\n                                    <TableHead className=\"text-center font-bold text-xs uppercase tracking-wider\">Status</TableHead>\r\n                                </TableRow>\r\n                            </TableHeader>\r\n                            <TableBody>\r\n                                {filteredEmployees.length === 0 ? (\r\n                                    <TableRow>\r\n                                        <TableCell colSpan={8} className=\"h-40 text-center text-muted-foreground\">\r\n                                            Nenhum colaborador encontrado com os filtros selecionados.\r\n                                        </TableCell>\r\n                                    </TableRow>\r\n                                ) : (\r\n                                    filteredEmployees.map((employee, index) => {\r\n                                        const team = teams.find(t => t.members?.includes(employee.id));\r\n                                        const site = sites.find(s => s.id === employee.siteId);\r\n                                        const project = projects.find(p => p.id === site?.projectId);\r\n                                        const company = companies.find(c => c.id === employee.companyId);\r\n\r\n                                        return (\r\n                                            <TableRow\r\n                                                key={employee.id}\r\n                                                className={`hover:bg-white/5 transition-colors border-white/5 ${index % 2 === 0 ? 'bg-white/[0.02]' : ''}`}\r\n                                            >\r\n                                                <TableCell className=\"text-center\">\r\n                                                    <span className=\"font-mono text-xs text-muted-foreground\">\r\n                                                        {employee.registrationNumber}\r\n                                                    </span>\r\n                                                </TableCell>\r\n                                                <TableCell className=\"text-center\">\r\n                                                    <span className=\"font-medium text-sm\">{employee.fullName}</span>\r\n                                                </TableCell>\r\n                                                <TableCell className=\"text-center\">\r\n                                                    <Badge variant=\"outline\" className=\"font-medium bg-primary/5 border-primary/20 text-primary\">\r\n                                                        {employee.functionName || 'Não definida'}\r\n                                                    </Badge>\r\n                                                </TableCell>\r\n                                                <TableCell className=\"text-center\">\r\n                                                    <span className=\"text-sm text-muted-foreground\">\r\n                                                        {team?.name || '-'}\r\n                                                    </span>\r\n                                                </TableCell>\r\n                                                <TableCell className=\"text-center\">\r\n                                                    <span className=\"text-sm\">\r\n                                                        {site?.name || '-'}\r\n                                                    </span>\r\n                                                </TableCell>\r\n                                                <TableCell className=\"text-center\">\r\n                                                    <span className=\"text-sm text-muted-foreground\">\r\n                                                        {project?.name || '-'}\r\n                                                    </span>\r\n                                                </TableCell>\r\n                                                <TableCell className=\"text-center\">\r\n                                                    <span className=\"text-sm text-muted-foreground\">\r\n                                                        {company?.name || '-'}\r\n                                                    </span>\r\n                                                </TableCell>\r\n                                                <TableCell className=\"text-center\">\r\n                                                    {employee.isActive ? (\r\n                                                        <div className=\"flex items-center justify-center gap-1.5 text-success text-xs font-bold\">\r\n                                                            <CheckCircle2 className=\"w-3.5 h-3.5\" /> ATIVO\r\n                                                        </div>\r\n                                                    ) : (\r\n                                                        <div className=\"flex items-center justify-center gap-1.5 text-muted-foreground text-xs font-bold\">\r\n                                                            <XCircle className=\"w-3.5 h-3.5\" /> INATIVO\r\n                                                        </div>\r\n                                                    )}\r\n                                                </TableCell>\r\n                                            </TableRow>\r\n                                        );\r\n                                    })\r\n                                )}\r\n                            </TableBody>\r\n                        </Table>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            <style>{`\r\n                @media print {\r\n                    body * {\r\n                        visibility: hidden;\r\n                    }\r\n                    .print-area, .print-area * {\r\n                        visibility: visible;\r\n                    }\r\n                    .print-area {\r\n                        position: absolute;\r\n                        left: 0;\r\n                        top: 0;\r\n                        width: 100%;\r\n                    }\r\n                }\r\n            `}</style>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\Teams.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'User' is defined but never used.","line":18,"column":105,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":109},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'currentUserProfile' is assigned a value but never used.","line":31,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'navigate' is assigned a value but never used.","line":32,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2634,2637],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2634,2637],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":176,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7399,7402],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7399,7402],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react';\r\nimport { useTeams } from '@/hooks/useTeams';\r\nimport { useEmployees } from '@/hooks/useEmployees';\r\nimport { useSites } from '@/hooks/useSites';\r\nimport { useCompanies } from '@/hooks/useCompanies';\r\nimport { useProjects } from '@/hooks/useProjects';\r\nimport { useJobFunctions } from '@/hooks/useJobFunctions';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogDescription } from '@/components/ui/dialog';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Checkbox } from '@/components/ui/checkbox';\r\nimport { ScrollArea } from '@/components/ui/scroll-area';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { Plus, Pencil, Trash2, Users, Search, Crown, AlertCircle, Loader2, Lock, Check, ChevronsUpDown, User } from 'lucide-react';\r\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\r\nimport { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList } from '@/components/ui/command';\r\nimport { cn } from '@/lib/utils';\r\nimport { ConfirmationDialog } from '@/components/shared/ConfirmationDialog';\r\nimport { isProtectedSignal, can } from '@/signals/authSignals';\r\nimport { useSignals } from \"@preact/signals-react/runtime\";\r\nimport { ProjectSelector } from '@/components/shared/ProjectSelector';\r\nimport { ProjectEmptyState } from '@/components/shared/ProjectEmptyState';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nexport default function Teams() {\r\n    useSignals();\r\n    const { profile: currentUserProfile } = useAuth();\r\n    const navigate = useNavigate();\r\n    const { teams, isLoading, createTeam, updateTeam, deleteTeam } = useTeams();\r\n    const { employees } = useEmployees();\r\n    const { sites } = useSites();\r\n    const { projects } = useProjects();\r\n    const { companies } = useCompanies();\r\n    const { functions } = useJobFunctions();\r\n    const [searchTerm, setSearchTerm] = React.useState('');\r\n    const [filterCompany, setFilterCompany] = React.useState('all');\r\n    const [filterProject, setFilterProject] = React.useState('all');\r\n    const [filterSite, setFilterSite] = React.useState('all');\r\n    const [isDialogOpen, setIsDialogOpen] = React.useState(false);\r\n    const [editingTeam, setEditingTeam] = React.useState<any>(null);\r\n    const [isSaving, setIsSaving] = React.useState(false);\r\n    const [formData, setFormData] = React.useState({\r\n        name: '',\r\n        supervisorId: '',\r\n        members: [] as string[],\r\n        siteId: '',\r\n        companyId: '',\r\n        projectId: ''\r\n    });\r\n    const [memberSearchTerm, setMemberSearchTerm] = React.useState('');\r\n    const [supervisorSearchOpen, setSupervisorSearchOpen] = React.useState(false);\r\n    const [confirmModal, setConfirmModal] = React.useState<{\r\n        open: boolean;\r\n        title: string;\r\n        description: string;\r\n        onConfirm: () => void | Promise<void>;\r\n        variant: 'default' | 'destructive';\r\n    }>({\r\n        open: false,\r\n        title: '',\r\n        description: '',\r\n        onConfirm: () => { },\r\n        variant: 'default'\r\n    });\r\n    const { toast } = useToast();\r\n\r\n    const activeEmployees = employees.filter(e => e.isActive);\r\n\r\n    // Get employees already in other teams\r\n    const getEmployeesInOtherTeams = () => {\r\n        const employeesInTeams = new Set<string>();\r\n        teams.forEach(team => {\r\n            if (team.id !== editingTeam?.id) { // Exclude current team when editing\r\n                team.members?.forEach(memberId => employeesInTeams.add(memberId));\r\n            }\r\n        });\r\n        return employeesInTeams;\r\n    };\r\n\r\n    // Get supervisors already leading other teams\r\n    const getSupervisorsInOtherTeams = () => {\r\n        const supervisorsInTeams = new Set<string>();\r\n        teams.forEach(team => {\r\n            if (team.id !== editingTeam?.id && team.supervisorId) {\r\n                supervisorsInTeams.add(team.supervisorId);\r\n            }\r\n        });\r\n        return supervisorsInTeams;\r\n    };\r\n\r\n    // Filter employees by selected site\r\n    const availableEmployees = React.useMemo(() => {\r\n        if (!formData.siteId) return [];\r\n\r\n        const selectedSite = sites.find(s => s.id === formData.siteId);\r\n        if (!selectedSite) return activeEmployees;\r\n\r\n        // Filter employees from the same site and company\r\n        return activeEmployees.filter(emp => {\r\n            return emp.siteId === formData.siteId || emp.companyId === selectedSite.companyId;\r\n        });\r\n    }, [activeEmployees, formData.siteId, sites]);\r\n\r\n    // Filter employees who can lead teams (have a function with canLeadTeam = true)\r\n    const availableSupervisors = React.useMemo(() => {\r\n        return availableEmployees.filter(emp => {\r\n            if (!emp.functionId) return false;\r\n            const empFunction = functions.find(f => f.id === emp.functionId);\r\n            return empFunction?.canLeadTeam === true;\r\n        });\r\n    }, [availableEmployees, functions]);\r\n\r\n    const getEmployeeName = (id: string) => employees.find(e => e.id === id)?.fullName || 'Desconhecido';\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n\r\n        if (!formData.name.trim()) {\r\n            toast({ title: 'Erro', description: 'O nome da equipe é obrigatório', variant: 'destructive' });\r\n            return;\r\n        }\r\n\r\n        setIsSaving(true);\r\n\r\n        try {\r\n            const selectedSite = sites.find(s => s.id === formData.siteId);\r\n            const companyId = formData.companyId || selectedSite?.companyId || companies[0]?.id;\r\n\r\n            if (editingTeam) {\r\n                const result = await updateTeam(editingTeam.id, {\r\n                    name: formData.name,\r\n                    supervisorId: formData.supervisorId || undefined,\r\n                    members: formData.members,\r\n                    siteId: formData.siteId || undefined,\r\n                    companyId: companyId\r\n                });\r\n                if (result.success) {\r\n                    toast({ title: 'Equipe atualizada!' });\r\n                }\r\n            } else {\r\n                const result = await createTeam({\r\n                    name: formData.name,\r\n                    supervisorId: formData.supervisorId || undefined,\r\n                    members: formData.members,\r\n                    siteId: formData.siteId || undefined,\r\n                    companyId: companyId\r\n                });\r\n                if (result.success) {\r\n                    toast({ title: 'Equipe criada!' });\r\n                }\r\n            }\r\n            resetForm();\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    const resetForm = () => {\r\n        setFormData({\r\n            name: '',\r\n            supervisorId: '',\r\n            members: [],\r\n            siteId: '',\r\n            companyId: '',\r\n            projectId: ''\r\n        });\r\n        setEditingTeam(null);\r\n        setMemberSearchTerm('');\r\n        setIsDialogOpen(false);\r\n    };\r\n\r\n    const handleDelete = async (team: any) => {\r\n        setConfirmModal({\r\n            open: true,\r\n            title: 'Excluir Equipe',\r\n            description: `Deseja realmente excluir a equipe \"${team.name}\"? Esta ação removerá a organização da equipe mas não excluirá os funcionários.`,\r\n            variant: 'destructive',\r\n            onConfirm: async () => {\r\n                const result = await deleteTeam(team.id);\r\n                if (result.success) {\r\n                    toast({ title: 'Equipe excluída' });\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    const toggleMember = (id: string) => {\r\n        const employeesInOtherTeams = getEmployeesInOtherTeams();\r\n\r\n        // Check if employee is already in another team\r\n        if (!formData.members.includes(id) && employeesInOtherTeams.has(id)) {\r\n            toast({\r\n                title: 'Funcionário já está em outra equipe',\r\n                description: 'Um funcionário não pode estar em múltiplas equipes simultaneamente.',\r\n                variant: 'destructive'\r\n            });\r\n            return;\r\n        }\r\n\r\n        // Ensure leader cannot be removed from members\r\n        if (id === formData.supervisorId && formData.members.includes(id)) {\r\n            toast({\r\n                title: 'O líder deve ser membro da equipe',\r\n                description: 'Para remover este funcionário dos membros, você deve primeiro alterar o supervisor da equipe.',\r\n                variant: 'destructive'\r\n            });\r\n            return;\r\n        }\r\n\r\n        setFormData(p => ({\r\n            ...p,\r\n            members: p.members.includes(id)\r\n                ? p.members.filter(m => m !== id)\r\n                : [...p.members, id]\r\n        }));\r\n    };\r\n\r\n    const filteredTeams = teams.filter(t => {\r\n        const matchesSearch = t.name.toLowerCase().includes(searchTerm.toLowerCase());\r\n        const matchesCompany = filterCompany === 'all' || t.companyId === filterCompany;\r\n\r\n        // Find project through site if not explicitly labeled (assume schema support or resolve manually)\r\n        const site = sites.find(s => s.id === t.siteId);\r\n        const matchesProject = filterProject === 'all' || site?.projectId === filterProject;\r\n        const matchesSite = filterSite === 'all' || t.siteId === filterSite;\r\n\r\n        return matchesSearch && matchesCompany && matchesProject && matchesSite;\r\n    });\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center h-64\">\r\n                <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-fade-in\">\r\n            <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n                <Dialog open={isDialogOpen} onOpenChange={(open) => {\r\n                    if (!open) resetForm();\r\n                    setIsDialogOpen(open);\r\n                }}>\r\n                    {(isProtectedSignal.value || can('teams.create')) && (\r\n                        <DialogTrigger asChild>\r\n                            <Button className=\"gradient-primary text-white shadow-glow\">\r\n                                <Plus className=\"w-4 h-4 mr-2\" />\r\n                                Nova Equipe\r\n                            </Button>\r\n                        </DialogTrigger>\r\n                    )}\r\n                    <DialogContent className=\"max-w-md\">\r\n                        <DialogHeader>\r\n                            <DialogTitle>{editingTeam ? 'Editar' : 'Nova'} Equipe</DialogTitle>\r\n                            <DialogDescription>Preencha os dados da equipe de trabalho</DialogDescription>\r\n                        </DialogHeader>\r\n\r\n                        {activeEmployees.length === 0 ? (\r\n                            <div className=\"p-6 text-center space-y-3 bg-muted/20 rounded-lg\">\r\n                                <AlertCircle className=\"w-10 h-10 text-warning mx-auto\" />\r\n                                <p className=\"text-sm font-medium\">Nenhum funcionário ativo</p>\r\n                                <p className=\"text-xs text-muted-foreground\">Cadastre e ative funcionários antes de montar uma equipe.</p>\r\n                                <Button variant=\"outline\" size=\"sm\" onClick={() => window.location.href = '/employees'}>Ir para Funcionários</Button>\r\n                            </div>\r\n                        ) : (\r\n                            <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Nome da Equipe *</Label>\r\n                                    <Input\r\n                                        placeholder=\"Ex: Equipe de Alvenaria\"\r\n                                        value={formData.name}\r\n                                        onChange={e => setFormData(p => ({ ...p, name: e.target.value }))}\r\n                                        className=\"industrial-input\"\r\n                                    />\r\n                                </div>\r\n\r\n                                {can('system.is_corporate') && (\r\n                                    <div className=\"space-y-2\">\r\n                                        <Label>Empresa Afiliada *</Label>\r\n                                        <Select\r\n                                            value={formData.companyId}\r\n                                            onValueChange={v => setFormData(p => ({ ...p, companyId: v, projectId: '', siteId: '', supervisorId: '', members: [] }))}\r\n                                        >\r\n                                            <SelectTrigger className=\"industrial-input\">\r\n                                                <SelectValue placeholder=\"Selecione a empresa\" />\r\n                                            </SelectTrigger>\r\n                                            <SelectContent>\r\n                                                {companies.map(c => (\r\n                                                    <SelectItem key={c.id} value={c.id}>{c.name}</SelectItem>\r\n                                                ))}\r\n                                            </SelectContent>\r\n                                        </Select>\r\n                                    </div>\r\n                                )}\r\n\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Obra Vinculada *</Label>\r\n                                    <Select\r\n                                        value={formData.projectId}\r\n                                        onValueChange={v => setFormData(p => ({ ...p, projectId: v, siteId: '', supervisorId: '', members: [] }))}\r\n                                        disabled={(!formData.companyId && can('system.is_corporate'))}\r\n                                    >\r\n                                        <SelectTrigger className=\"industrial-input\">\r\n                                            <SelectValue placeholder=\"Selecione a obra\" />\r\n                                        </SelectTrigger>\r\n                                        <SelectContent>\r\n                                            {projects\r\n                                                .filter(p => !formData.companyId || p.companyId === formData.companyId)\r\n                                                .map(p => (\r\n                                                    <SelectItem key={p.id} value={p.id}>{p.name}</SelectItem>\r\n                                                ))\r\n                                            }\r\n                                        </SelectContent>\r\n                                    </Select>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Canteiro / Unidade *</Label>\r\n                                    <Select\r\n                                        value={formData.siteId}\r\n                                        onValueChange={v => setFormData(p => ({ ...p, siteId: v, supervisorId: '', members: [] }))}\r\n                                        disabled={!formData.projectId}\r\n                                    >\r\n                                        <SelectTrigger className=\"industrial-input\">\r\n                                            <SelectValue placeholder=\"Selecione o local\" />\r\n                                        </SelectTrigger>\r\n                                        <SelectContent>\r\n                                            {sites\r\n                                                .filter(s => s.projectId === formData.projectId)\r\n                                                .map(s => (\r\n                                                    <SelectItem key={s.id} value={s.id}>{s.name}</SelectItem>\r\n                                                ))\r\n                                            }\r\n                                        </SelectContent>\r\n                                    </Select>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Supervisor (Líder)</Label>\r\n                                    {!formData.siteId && (\r\n                                        <div className=\"flex items-center gap-2 p-2 bg-amber-500/10 border border-amber-500/20 rounded-md text-xs text-amber-600\">\r\n                                            <AlertCircle className=\"w-4 h-4\" />\r\n                                            <span>Selecione um canteiro primeiro</span>\r\n                                        </div>\r\n                                    )}\r\n                                    {formData.siteId && availableSupervisors.length === 0 && (\r\n                                        <div className=\"flex items-center gap-2 p-2 bg-red-500/10 border border-red-500/20 rounded-md text-xs text-red-600\">\r\n                                            <AlertCircle className=\"w-4 h-4\" />\r\n                                            <span>Nenhum funcionário com função de liderança disponível neste canteiro</span>\r\n                                        </div>\r\n                                    )}\r\n                                    <Popover open={supervisorSearchOpen} onOpenChange={setSupervisorSearchOpen}>\r\n                                        <PopoverTrigger asChild>\r\n                                            <Button\r\n                                                variant=\"outline\"\r\n                                                role=\"combobox\"\r\n                                                aria-expanded={supervisorSearchOpen}\r\n                                                className=\"w-full justify-between industrial-input h-10 font-normal\"\r\n                                                disabled={!formData.siteId}\r\n                                            >\r\n                                                {formData.supervisorId ? (\r\n                                                    <div className=\"flex items-center gap-2\">\r\n                                                        <Crown className=\"w-3.5 h-3.5 text-yellow-500\" />\r\n                                                        <span>{getEmployeeName(formData.supervisorId)}</span>\r\n                                                    </div>\r\n                                                ) : (\r\n                                                    <span className=\"text-muted-foreground\">Selecione um líder...</span>\r\n                                                )}\r\n                                                <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\r\n                                            </Button>\r\n                                        </PopoverTrigger>\r\n                                        <PopoverContent className=\"w-[400px] p-0 border-slate-800\" align=\"start\">\r\n                                            <Command className=\"bg-slate-900 text-slate-200\">\r\n                                                <CommandInput placeholder=\"Procurar líder...\" className=\"h-9\" />\r\n                                                <CommandList>\r\n                                                    <CommandEmpty>Nenhum líder encontrado.</CommandEmpty>\r\n                                                    <CommandGroup heading=\"Lideranças Disponíveis\">\r\n                                                        {availableSupervisors.map((e) => {\r\n                                                            const supervisorsInOtherTeams = getSupervisorsInOtherTeams();\r\n                                                            const isLeadingOtherTeam = supervisorsInOtherTeams.has(e.id);\r\n                                                            return (\r\n                                                                <CommandItem\r\n                                                                    key={e.id}\r\n                                                                    value={e.fullName}\r\n                                                                    onSelect={() => {\r\n                                                                        const supervisorsInOtherTeams = getSupervisorsInOtherTeams();\r\n                                                                        if (supervisorsInOtherTeams.has(e.id)) {\r\n                                                                            toast({\r\n                                                                                title: 'Líder já está em outra equipe',\r\n                                                                                description: 'Este funcionário já é líder de outra equipe.',\r\n                                                                                variant: 'destructive'\r\n                                                                            });\r\n                                                                            return;\r\n                                                                        }\r\n                                                                        setFormData(p => {\r\n                                                                            const newMembers = [...p.members];\r\n                                                                            if (!newMembers.includes(e.id)) {\r\n                                                                                newMembers.push(e.id);\r\n                                                                            }\r\n                                                                            return { ...p, supervisorId: e.id, members: newMembers };\r\n                                                                        });\r\n                                                                        setSupervisorSearchOpen(false);\r\n                                                                    }}\r\n                                                                    className=\"flex items-center justify-between p-2 cursor-pointer hover:bg-slate-800\"\r\n                                                                >\r\n                                                                    <div className=\"flex items-center gap-2\">\r\n                                                                        <Crown className=\"w-3.5 h-3.5 text-yellow-500\" />\r\n                                                                        <span>{e.fullName}</span>\r\n                                                                        <span className=\"text-[10px] text-muted-foreground uppercase\">{e.functionName}</span>\r\n                                                                    </div>\r\n                                                                    <div className=\"flex items-center gap-2\">\r\n                                                                        {isLeadingOtherTeam && (\r\n                                                                            <span className=\"text-[9px] bg-amber-500/10 text-amber-500 px-2 py-0.5 rounded-full border border-amber-500/20\">\r\n                                                                                Líder de outra equipe\r\n                                                                            </span>\r\n                                                                        )}\r\n                                                                        <Check\r\n                                                                            className={cn(\r\n                                                                                \"h-4 w-4 text-primary\",\r\n                                                                                formData.supervisorId === e.id ? \"opacity-100\" : \"opacity-0\"\r\n                                                                            )}\r\n                                                                        />\r\n                                                                    </div>\r\n                                                                </CommandItem>\r\n                                                            );\r\n                                                        })}\r\n                                                    </CommandGroup>\r\n                                                </CommandList>\r\n                                            </Command>\r\n                                        </PopoverContent>\r\n                                    </Popover>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Membros da Equipe ({formData.members.length})</Label>\r\n                                    {!formData.siteId && (\r\n                                        <div className=\"flex items-center gap-2 p-2 bg-amber-500/10 border border-amber-500/20 rounded-md text-xs text-amber-600\">\r\n                                            <AlertCircle className=\"w-4 h-4\" />\r\n                                            <span>Selecione um canteiro primeiro para ver os funcionários disponíveis</span>\r\n                                        </div>\r\n                                    )}\r\n                                    <div className=\"relative mb-2\">\r\n                                        <Search className=\"absolute left-2 top-1/2 -translate-y-1/2 h-3 w-3 text-muted-foreground\" />\r\n                                        <Input\r\n                                            placeholder=\"Procurar membro...\"\r\n                                            value={memberSearchTerm}\r\n                                            onChange={e => setMemberSearchTerm(e.target.value)}\r\n                                            className=\"pl-7 h-8 text-[11px] industrial-input\"\r\n                                        />\r\n                                    </div>\r\n                                    <ScrollArea className=\"h-48 border rounded-lg p-3 bg-muted/10\">\r\n                                        <div className=\"space-y-1\">\r\n                                            {availableEmployees\r\n                                                .filter(e => e.fullName.toLowerCase().includes(memberSearchTerm.toLowerCase()))\r\n                                                .map(e => {\r\n                                                    const employeesInOtherTeams = getEmployeesInOtherTeams();\r\n                                                    const isInOtherTeam = employeesInOtherTeams.has(e.id);\r\n                                                    const isDisabled = isInOtherTeam && !formData.members.includes(e.id);\r\n\r\n                                                    return (\r\n                                                        <div\r\n                                                            key={e.id}\r\n                                                            className={`flex items-center gap-3 p-2 rounded-md transition-colors ${isDisabled\r\n                                                                ? 'opacity-50 cursor-not-allowed bg-muted/20'\r\n                                                                : 'hover:bg-muted/50'\r\n                                                                }`}\r\n                                                        >\r\n                                                            <Checkbox\r\n                                                                id={`emp-check-${e.id}`}\r\n                                                                checked={formData.members.includes(e.id)}\r\n                                                                onCheckedChange={() => toggleMember(e.id)}\r\n                                                                disabled={isDisabled}\r\n                                                            />\r\n                                                            <label\r\n                                                                htmlFor={`emp-check-${e.id}`}\r\n                                                                className=\"text-sm flex-1 cursor-pointer select-none py-1 flex items-center justify-between\"\r\n                                                            >\r\n                                                                <span>{e.fullName}</span>\r\n                                                                {isInOtherTeam && !formData.members.includes(e.id) && (\r\n                                                                    <span className=\"text-[10px] bg-amber-500/20 text-amber-600 px-2 py-0.5 rounded-full font-medium\">\r\n                                                                        Em outra equipe\r\n                                                                    </span>\r\n                                                                )}\r\n                                                            </label>\r\n                                                        </div>\r\n                                                    );\r\n                                                })}\r\n                                        </div>\r\n                                    </ScrollArea>\r\n                                </div>\r\n\r\n                                <div className=\"flex gap-2 pt-2\">\r\n                                    <Button type=\"button\" variant=\"outline\" onClick={resetForm} className=\"flex-1\">Cancelar</Button>\r\n                                    <Button type=\"submit\" className=\"flex-1 gradient-primary text-white\" disabled={isSaving}>\r\n                                        {isSaving && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\r\n                                        {editingTeam ? 'Salvar Alterações' : 'Criar Equipe'}\r\n                                    </Button>\r\n                                </div>\r\n                            </form>\r\n                        )}\r\n                    </DialogContent>\r\n                </Dialog>\r\n            </div>\r\n\r\n            {/* Barra de Filtros */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 items-end bg-slate-900/40 p-4 rounded-xl border border-white/5\">\r\n                <div className=\"space-y-2\">\r\n                    <Label className=\"text-[10px] uppercase text-muted-foreground font-black tracking-widest px-1\">Empresa</Label>\r\n                    <Select value={filterCompany} onValueChange={v => {\r\n                        setFilterCompany(v);\r\n                        if (v === 'all') {\r\n                            setFilterProject('all');\r\n                            setFilterSite('all');\r\n                        }\r\n                    }}>\r\n                        <SelectTrigger className=\"industrial-input h-10\">\r\n                            <SelectValue placeholder=\"Todas Empresas\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"glass-card\">\r\n                            <SelectItem value=\"all\">Todas Empresas</SelectItem>\r\n                            {companies.map(c => <SelectItem key={c.id} value={c.id}>{c.name}</SelectItem>)}\r\n                        </SelectContent>\r\n                    </Select>\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                    <Label className=\"text-[10px] uppercase text-muted-foreground font-black tracking-widest px-1\">Obra / Projeto</Label>\r\n                    <ProjectSelector\r\n                        value={filterProject}\r\n                        onValueChange={(v) => {\r\n                            setFilterProject(v);\r\n                            setFilterSite('all'); // Reset site when project changes\r\n\r\n                            if (v !== 'all') {\r\n                                // Auto-select company based on project\r\n                                const project = projects.find(p => p.id === v);\r\n                                if (project && project.companyId !== filterCompany) {\r\n                                    setFilterCompany(project.companyId);\r\n                                }\r\n                            }\r\n                        }}\r\n                        showAll={true}\r\n                        placeholder=\"Todas Obras\"\r\n                    />\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                    <Label className=\"text-[10px] uppercase text-muted-foreground font-black tracking-widest px-1\">Canteiro / Unidade</Label>\r\n                    <Select value={filterSite} onValueChange={v => {\r\n                        setFilterSite(v);\r\n                        if (v !== 'all') {\r\n                            // Auto-select project and company\r\n                            const site = sites.find(s => s.id === v);\r\n                            if (site) {\r\n                                if (site.projectId !== filterProject) {\r\n                                    setFilterProject(site.projectId);\r\n                                    // Cascade to company\r\n                                    const project = projects.find(p => p.id === site.projectId);\r\n                                    if (project && project.companyId !== filterCompany) {\r\n                                        setFilterCompany(project.companyId);\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }} disabled={filterProject === 'all'}>\r\n                        <SelectTrigger className=\"industrial-input h-10\">\r\n                            <SelectValue placeholder=\"Todos Canteiros\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"glass-card\">\r\n                            <SelectItem value=\"all\">Todos Canteiros</SelectItem>\r\n                            {sites\r\n                                .filter(s => filterProject === 'all' || s.projectId === filterProject)\r\n                                .map(s => <SelectItem key={s.id} value={s.id}>{s.name}</SelectItem>)\r\n                            }\r\n                        </SelectContent>\r\n                    </Select>\r\n                </div>\r\n\r\n                <div className=\"relative\">\r\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n                    <Input\r\n                        placeholder=\"Buscar equipes...\"\r\n                        value={searchTerm}\r\n                        onChange={e => setSearchTerm(e.target.value)}\r\n                        className=\"pl-10 industrial-input h-10\"\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            {filteredTeams.length === 0 ? (\r\n                <div className=\"flex-1 flex items-center justify-center min-h-[400px]\">\r\n                    <ProjectEmptyState\r\n                        type=\"workers\"\r\n                        title=\"Nenhuma Equipe Encontrada\"\r\n                        description=\"Você ainda não possui equipes estruturadas para suas obras atuais. Organize seus colaboradores em frentes de trabalho.\"\r\n                        onAction={() => setIsDialogOpen(true)}\r\n                        actionLabel=\"Criar Primeira Equipe\"\r\n                        hideAction={!(isProtectedSignal.value || can('teams.create'))}\r\n                    />\r\n                </div>\r\n            ) : (\r\n                <div className=\"grid sm:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                    {filteredTeams.map(team => (\r\n                        <Card key={team.id} className=\"glass-card hover:shadow-strong transition-all group\">\r\n                            <CardHeader className=\"pb-3\">\r\n                                <CardTitle className=\"flex items-center gap-2 text-lg\">\r\n                                    <Users className=\"w-5 h-5 text-primary\" />\r\n                                    {team.name}\r\n                                </CardTitle>\r\n                                {team.supervisorName && (\r\n                                    <CardDescription className=\"flex items-center gap-1.5 mt-1 font-medium text-foreground/80\">\r\n                                        <Crown className=\"w-3.5 h-3.5 text-yellow-500\" />\r\n                                        {team.supervisorName}\r\n                                    </CardDescription>\r\n                                )}\r\n                            </CardHeader>\r\n                            <CardContent>\r\n                                <p className=\"text-sm text-muted-foreground mb-4\">\r\n                                    {team.members.length} {team.members.length === 1 ? 'membro cadastrado' : 'membros cadastrados'}\r\n                                </p>\r\n                                <div className=\"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                    {(() => {\r\n                                        const canEdit = isProtectedSignal.value || can('teams.update');\r\n                                        const canDelete = isProtectedSignal.value || can('teams.delete');\r\n                                        const hiearchyMatch = isProtectedSignal.value || can('teams.manage'); // Simplified for capabilities\r\n\r\n                                        if (!canEdit && !canDelete) {\r\n                                            return (\r\n                                                <div className=\"flex items-center justify-center w-full py-2 text-muted-foreground/30\" title=\"Sem permissão no módulo Custom SU\">\r\n                                                    <Lock className=\"w-4 h-4 mr-2\" />\r\n                                                    <span className=\"text-xs uppercase font-bold\">Leitura</span>\r\n                                                </div>\r\n                                            );\r\n                                        }\r\n\r\n                                        if (!hiearchyMatch) {\r\n                                            return (\r\n                                                <div className=\"flex items-center justify-center w-full py-2 text-muted-foreground/30\" title=\"Sem permissão hierárquica\">\r\n                                                    <Lock className=\"w-4 h-4 mr-2\" />\r\n                                                    <span className=\"text-xs uppercase font-bold\">Bloqueado</span>\r\n                                                </div>\r\n                                            );\r\n                                        }\r\n\r\n                                        return (\r\n                                            <>\r\n                                                {canEdit && (\r\n                                                    <Button\r\n                                                        variant=\"outline\"\r\n                                                        size=\"sm\"\r\n                                                        className=\"flex-1\"\r\n                                                        onClick={() => {\r\n                                                            const site = sites.find(s => s.id === team.siteId);\r\n                                                            setEditingTeam(team);\r\n                                                            setFormData({\r\n                                                                name: team.name,\r\n                                                                supervisorId: team.supervisorId || '',\r\n                                                                members: team.members,\r\n                                                                siteId: team.siteId || '',\r\n                                                                companyId: team.companyId || site?.companyId || '',\r\n                                                                projectId: site?.projectId || ''\r\n                                                            });\r\n                                                            setIsDialogOpen(true);\r\n                                                        }}\r\n                                                    >\r\n                                                        <Pencil className=\"w-4 h-4 mr-1\" />\r\n                                                        Editar\r\n                                                    </Button>\r\n                                                )}\r\n                                                {canDelete && (\r\n                                                    <Button\r\n                                                        variant=\"destructive\"\r\n                                                        size=\"sm\"\r\n                                                        className=\"flex-1\"\r\n                                                        onClick={() => handleDelete(team)}\r\n                                                    >\r\n                                                        <Trash2 className=\"w-4 h-4 mr-1\" />\r\n                                                        Excluir\r\n                                                    </Button>\r\n                                                )}\r\n                                            </>\r\n                                        );\r\n                                    })()}\r\n                                </div>\r\n\r\n                            </CardContent>\r\n                        </Card>\r\n                    ))}\r\n                </div>\r\n            )}\r\n            {/* Confirmation Dialog */}\r\n            <ConfirmationDialog\r\n                open={confirmModal.open}\r\n                onOpenChange={(open) => setConfirmModal(prev => ({ ...prev, open }))}\r\n                title={confirmModal.title}\r\n                description={confirmModal.description}\r\n                onConfirm={confirmModal.onConfirm}\r\n                variant={confirmModal.variant}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\TimeClock.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Card' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CardContent' is defined but never used.","line":8,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CardHeader' is defined but never used.","line":8,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CardTitle' is defined but never used.","line":8,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Select' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'SelectContent' is defined but never used.","line":9,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'SelectItem' is defined but never used.","line":9,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'SelectTrigger' is defined but never used.","line":9,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":58},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'SelectValue' is defined but never used.","line":9,"column":60,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":71},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Camera' is defined but never used.","line":14,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AlertOctagon' is defined but never used.","line":14,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":66},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Upload' is defined but never used.","line":14,"column":68,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":74},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Loader2' is defined but never used.","line":14,"column":76,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":83},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'RefreshCw' is defined but never used.","line":14,"column":85,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":94},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Fingerprint' is defined but never used.","line":14,"column":96,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":107},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Map' is defined but never used.","line":14,"column":126,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":129},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AlertTriangle' is defined but never used.","line":14,"column":154,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":167},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'startOfDay' is defined but never used.","line":17,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":49},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isCorporateRole' is defined but never used.","line":31,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'user' is assigned a value but never used.","line":41,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'teams' is assigned a value but never used.","line":44,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setSelectedTeam' is assigned a value but never used.","line":47,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isCapturing' is assigned a value but never used.","line":51,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'cameraError' is assigned a value but never used.","line":53,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":53,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'cameras' is assigned a value but never used.","line":55,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":55,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3397,3400],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3397,3400],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3469,3472],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3469,3472],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has missing dependencies: 'activeEmployees', 'countdown', and 'handleAutoCapture'. Either include them or remove the dependency array.","line":215,"column":8,"nodeType":"ArrayExpression","endLine":215,"endColumn":81,"suggestions":[{"desc":"Update the dependencies array to be: [view, selectedEmployee, isSaving, photoData, stabilityRef, isManualMode, countdown, activeEmployees, handleAutoCapture]","fix":{"range":[10529,10602],"text":"[view, selectedEmployee, isSaving, photoData, stabilityRef, isManualMode, countdown, activeEmployees, handleAutoCapture]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":325,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":325,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14661,14664],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14661,14664],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":326,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":326,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14805,14808],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14805,14808],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'emp' is assigned a value but never used.","line":380,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":380,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'result' is assigned a value but never used.","line":429,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":429,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":448,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":448,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":463,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":463,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20454,20457],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20454,20457],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":33,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useTeams } from '@/hooks/useTeams';\r\nimport { useEmployees } from '@/hooks/useEmployees';\r\nimport { useTimeRecords } from '@/hooks/useTimeRecords';\r\nimport { cn } from '@/lib/utils';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Input } from '@/components/ui/input';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Camera, Clock, CheckCircle2, LogIn, LogOut, AlertOctagon, Upload, Loader2, RefreshCw, Fingerprint, MapPin, History, Map, ChevronRight, X, User, AlertTriangle, ScanFace, Search, Check } from 'lucide-react';\r\nimport { faceRecognitionService } from '@/services/faceRecognitionService';\r\nimport { storageService } from '@/services/storageService';\r\nimport { format, differenceInSeconds, startOfDay, isToday } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\nimport { FaceRegistrationDialog } from '@/components/employees/FaceRegistrationDialog';\r\nimport { compressImage } from '@/utils/imageCompression';\r\nimport {\r\n    AlertDialog,\r\n    AlertDialogAction,\r\n    AlertDialogCancel,\r\n    AlertDialogContent,\r\n    AlertDialogDescription,\r\n    AlertDialogFooter,\r\n    AlertDialogHeader,\r\n    AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport { isFieldWorker, isCorporateRole } from '@/utils/permissionHelpers';\r\n\r\nconst formatCPF = (cpf: string | null) => {\r\n    if (!cpf) return '---';\r\n    const clean = cpf.replace(/\\D/g, '');\r\n    if (clean.length !== 11) return clean;\r\n    return clean.replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/, \"$1.$2.$3-$4\");\r\n};\r\n\r\nexport default function TimeClock() {\r\n    const { user, profile } = useAuth();\r\n    const isWorker = isFieldWorker(profile?.role);\r\n    const workerEmployeeId = profile?.employeeId;\r\n    const { teams } = useTeams();\r\n    const { employees } = useEmployees();\r\n    const { createRecord } = useTimeRecords();\r\n    const [selectedTeam, setSelectedTeam] = React.useState('');\r\n    const [selectedEmployee, setSelectedEmployee] = React.useState('');\r\n    const [recordType, setRecordType] = React.useState<'entry' | 'exit'>('entry');\r\n    const [photoData, setPhotoData] = React.useState<string | null>(null);\r\n    const [isCapturing, setIsCapturing] = React.useState(false);\r\n    const [isSaving, setIsSaving] = React.useState(false);\r\n    const [cameraError, setCameraError] = React.useState<string | null>(null);\r\n    const [currentTime, setCurrentTime] = React.useState(new Date());\r\n    const [cameras, setCameras] = React.useState<MediaDeviceInfo[]>([]);\r\n    const [selectedCameraId, setSelectedCameraId] = React.useState<string>('');\r\n    const [stream, setStream] = React.useState<MediaStream | null>(null);\r\n    const [faceMatchDistance, setFaceMatchDistance] = React.useState<number | null>(null);\r\n    const [view, setView] = React.useState<'home' | 'capturing' | 'permissions'>('home');\r\n    const [activeTab, setActiveTab] = React.useState<'ponto' | 'checkin' | 'historico'>('ponto');\r\n    const [stabilityRef, setStabilityRef] = React.useState(0);\r\n    const [lastLoc, setLastLoc] = React.useState<any>(null);\r\n    const [dailyRecords, setDailyRecords] = React.useState<any[]>([]);\r\n    const [countdown, setCountdown] = React.useState(30);\r\n    const [isManualMode, setIsManualMode] = React.useState(false);\r\n    const [manualCpf, setManualCpf] = React.useState('');\r\n\r\n    // Estados para validação de biometria e localização\r\n    const [showBiometryModal, setShowBiometryModal] = React.useState(false);\r\n    const [showFaceRegistration, setShowFaceRegistration] = React.useState(false);\r\n    const [pendingRecordType, setPendingRecordType] = React.useState<'entry' | 'exit'>('entry');\r\n    const [showLocationWarning, setShowLocationWarning] = React.useState(false);\r\n    const [employeeSearch, setEmployeeSearch] = React.useState('');\r\n    const [showEmployeeDropdown, setShowEmployeeDropdown] = React.useState(false);\r\n\r\n    // Auto-switch to manual mode when countdown hits 0\r\n    React.useEffect(() => {\r\n        if (countdown === 0 && view === 'capturing' && !isManualMode) {\r\n            setIsManualMode(true);\r\n        }\r\n    }, [countdown, view, isManualMode]);\r\n\r\n    const { records: allRecords } = useTimeRecords();\r\n    const videoRef = React.useRef<HTMLVideoElement>(null);\r\n    const canvasRef = React.useRef<HTMLCanvasElement>(null);\r\n    const lastDetectionTimeRef = React.useRef<number>(0);\r\n    const { toast } = useToast();\r\n\r\n    const activeEmployees = employees.filter(e => e.isActive);\r\n\r\n    // Listar câmeras disponíveis\r\n    React.useEffect(() => {\r\n        const getCameras = async () => {\r\n            try {\r\n                // Solicita permissão e para IMEDIATAMENTE para liberar a câmera\r\n                const initialStream = await navigator.mediaDevices.getUserMedia({ video: true });\r\n                initialStream.getTracks().forEach(track => track.stop());\r\n\r\n                const devices = await navigator.mediaDevices.enumerateDevices();\r\n                const videoDevices = devices.filter(device => device.kind === 'videoinput');\r\n                setCameras(videoDevices);\r\n                if (videoDevices.length > 0) {\r\n                    setSelectedCameraId(videoDevices[0].deviceId);\r\n                }\r\n            } catch (err) {\r\n                console.error('Erro ao listar câmeras:', err);\r\n                setCameraError(\"Permissão de câmera negada ou dispositivo não encontrado.\");\r\n            }\r\n        };\r\n        getCameras();\r\n    }, []);\r\n\r\n    React.useEffect(() => {\r\n        const interval = setInterval(() => setCurrentTime(new Date()), 1000);\r\n\r\n        // Carrega localização do storage\r\n        storageService.getItem('last_known_location').then(setLastLoc);\r\n\r\n        return () => clearInterval(interval);\r\n    }, []);\r\n\r\n    // Pré-buscar localização assim que a tela de captura abrir\r\n    React.useEffect(() => {\r\n        if (view === 'capturing' && !isManualMode) {\r\n            const fetchLoc = async () => {\r\n                try {\r\n                    const pos = await new Promise<GeolocationPosition>((resolve, reject) =>\r\n                        navigator.geolocation.getCurrentPosition(resolve, reject, {\r\n                            enableHighAccuracy: true,\r\n                            timeout: 10000,\r\n                            maximumAge: 30000\r\n                        })\r\n                    );\r\n                    const coords = { lat: pos.coords.latitude, lng: pos.coords.longitude };\r\n                    setLastLoc(coords);\r\n                    await storageService.setItem('last_known_location', coords);\r\n                } catch (err) {\r\n                    console.warn('Falha no pre-fetch de localização:', err);\r\n                }\r\n            };\r\n            fetchLoc();\r\n        }\r\n    }, [view, isManualMode]);\r\n\r\n    // Filter today's records and calculate worked hours\r\n    const workedData = React.useMemo(() => {\r\n        const todayRecs = allRecords\r\n            .filter(r => isToday(new Date(r.recordedAt)) && r.employeeId === (isWorker ? workerEmployeeId : selectedEmployee))\r\n            .sort((a, b) => new Date(a.recordedAt).getTime() - new Date(b.recordedAt).getTime());\r\n\r\n        setDailyRecords(todayRecs);\r\n\r\n        let totalSeconds = 0;\r\n        for (let i = 0; i < todayRecs.length; i += 2) {\r\n            if (todayRecs[i] && todayRecs[i + 1]) {\r\n                totalSeconds += differenceInSeconds(new Date(todayRecs[i + 1].recordedAt), new Date(todayRecs[i].recordedAt));\r\n            } else if (todayRecs[i] && todayRecs[i].recordType === 'entry') {\r\n                // Se só tem entrada e é hoje, soma até o agora\r\n                totalSeconds += differenceInSeconds(new Date(), new Date(todayRecs[i].recordedAt));\r\n            }\r\n        }\r\n\r\n        const h = Math.floor(totalSeconds / 3600);\r\n        const m = Math.floor((totalSeconds % 3600) / 60);\r\n        return { h, m, recs: todayRecs };\r\n    }, [allRecords, isWorker, workerEmployeeId, selectedEmployee]);\r\n\r\n    // Face detection loop for auto-capture\r\n    React.useEffect(() => {\r\n        let frameId: number;\r\n\r\n        const detectFace = async () => {\r\n            const now = Date.now();\r\n\r\n            // Throttle para evitar excesso de processamento e tornar menos \"nervoso\"\r\n            if (view === 'capturing' && videoRef.current && videoRef.current.readyState === 4 && !isSaving && !photoData && !isManualMode && countdown > 0) {\r\n                if (now - lastDetectionTimeRef.current >= 250) {\r\n                    lastDetectionTimeRef.current = now;\r\n                    try {\r\n                        const emp = activeEmployees.find(e => e.id === selectedEmployee);\r\n                        if (emp?.faceDescriptor) {\r\n                            const descriptor = await faceRecognitionService.getDescriptor(videoRef.current);\r\n                            if (descriptor) {\r\n                                const savedDescriptor = new Float32Array(emp.faceDescriptor);\r\n                                const distance = faceRecognitionService.compareFaces(descriptor, savedDescriptor);\r\n                                setFaceMatchDistance(distance);\r\n\r\n                                if (distance < 0.45) {\r\n                                    const nextStability = stabilityRef + 1;\r\n                                    setStabilityRef(nextStability);\r\n                                    if (nextStability >= 5) {\r\n                                        handleAutoCapture();\r\n                                    }\r\n                                } else {\r\n                                    setStabilityRef(0);\r\n                                }\r\n                            } else {\r\n                                setFaceMatchDistance(null);\r\n                                setStabilityRef(0);\r\n                            }\r\n                        }\r\n                    } catch (e) {\r\n                        console.error(\"Auto-detect error\", e);\r\n                    }\r\n                }\r\n            }\r\n            frameId = requestAnimationFrame(detectFace);\r\n        };\r\n\r\n        if (view === 'capturing') {\r\n            detectFace();\r\n        }\r\n\r\n        return () => cancelAnimationFrame(frameId);\r\n    }, [view, selectedEmployee, isSaving, photoData, stabilityRef, isManualMode]);\r\n\r\n    // Countdown Effect\r\n    React.useEffect(() => {\r\n        let timer: number;\r\n        if (view === 'capturing' && countdown > 0 && !isManualMode && !photoData && !isSaving) {\r\n            timer = window.setInterval(() => {\r\n                setCountdown(prev => prev - 1);\r\n            }, 1000);\r\n        }\r\n        return () => clearInterval(timer);\r\n    }, [view, countdown, isManualMode, photoData, isSaving]);\r\n\r\n\r\n    const handleAutoCapture = async () => {\r\n        if (!videoRef.current) return;\r\n\r\n        // Capture frame in original resolution\r\n        const canvas = document.createElement('canvas');\r\n        canvas.width = videoRef.current.videoWidth;\r\n        canvas.height = videoRef.current.videoHeight;\r\n        const ctx = canvas.getContext('2d');\r\n        if (ctx) {\r\n            ctx.drawImage(videoRef.current, 0, 0, canvas.width, canvas.height);\r\n        }\r\n        const originalData = canvas.toDataURL('image/jpeg', 0.95);\r\n\r\n        // Compress to reduce file size (800px, 80% quality = ~70% smaller)\r\n        const { dataUrl: compressedData, sizeKB } = await compressImage(originalData, 'light');\r\n        console.log(`[TimeClock] Foto comprimida: ${sizeKB}KB`);\r\n\r\n        setPhotoData(compressedData);\r\n\r\n        // Trigger save with compressed image\r\n        await handleRecord(compressedData);\r\n    };\r\n\r\n    // Auto-select employee if user is a worker\r\n    React.useEffect(() => {\r\n        if (isWorker && workerEmployeeId) {\r\n            setSelectedEmployee(workerEmployeeId);\r\n        }\r\n    }, [isWorker, workerEmployeeId]);\r\n\r\n    // Efeito para anexar o stream ao elemento video\r\n    React.useEffect(() => {\r\n        if (view === 'capturing' && stream && videoRef.current) {\r\n            videoRef.current.srcObject = stream;\r\n        }\r\n    }, [view, stream]);\r\n\r\n    const startCamera = async (deviceId?: string) => {\r\n        const id = deviceId || selectedCameraId;\r\n        setCameraError(null);\r\n\r\n        // Para o stream anterior se existir\r\n        if (stream) {\r\n            stream.getTracks().forEach(track => track.stop());\r\n        }\r\n\r\n        try {\r\n            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\r\n                throw new Error('Câmera não suportada ou conexão insegura (precisa de HTTPS).');\r\n            }\r\n\r\n            // Ativa o estado de captura antes para renderizar o elemento <video>\r\n            setIsCapturing(true);\r\n\r\n            const constraints = {\r\n                video: {\r\n                    deviceId: id ? { exact: id } : undefined,\r\n                    width: { ideal: 1920 },\r\n                    height: { ideal: 1080 },\r\n                    facingMode: id ? undefined : 'user',\r\n                    frameRate: { ideal: 30, max: 60 }\r\n                }\r\n            };\r\n\r\n            const newStream = await navigator.mediaDevices.getUserMedia(constraints);\r\n            setStream(newStream);\r\n\r\n            // O useEffect acima cuidará de anexar o stream ao videoRef\r\n        } catch (err) {\r\n            console.error(\"Erro ao iniciar câmera:\", err);\r\n            const errorMsg = err instanceof Error ? err.message : 'Não foi possível acessar a câmera';\r\n            setCameraError(errorMsg);\r\n            setIsCapturing(false);\r\n            toast({\r\n                title: 'Erro de Câmera',\r\n                description: 'Verifique as permissões ou use o upload de foto.',\r\n                variant: 'destructive'\r\n            });\r\n        }\r\n    };\r\n\r\n    const stopCamera = React.useCallback(() => {\r\n        if (stream) {\r\n            stream.getTracks().forEach(track => track.stop());\r\n            setStream(null);\r\n        }\r\n        setIsCapturing(false);\r\n    }, [stream]);\r\n\r\n    /**\r\n     * Função que valida biometria e localização antes de iniciar o registro de ponto\r\n     */\r\n    const handleTimeClockClick = async (type: 'entry' | 'exit') => {\r\n        setPendingRecordType(type);\r\n\r\n        // 1. Verificar permissões de câmera e localização\r\n        const hasCam = await navigator.permissions?.query({ name: 'camera' as any }).then(q => q.state === 'granted').catch(() => false);\r\n        const hasLoc = await navigator.permissions?.query({ name: 'geolocation' as any }).then(q => q.state === 'granted').catch(() => false);\r\n\r\n        if (!hasCam || !hasLoc) {\r\n            window.dispatchEvent(new CustomEvent('open-permissions-modal'));\r\n            toast({ title: 'Permissões Necessárias', description: 'Por favor, conceda acesso à câmera e localização para continuar.', variant: 'destructive' });\r\n            return;\r\n        }\r\n\r\n        // 2. Verificar se localização está ativa\r\n        if (!lastLoc) {\r\n            setShowLocationWarning(true);\r\n            return;\r\n        }\r\n\r\n        // 3. Verificar se funcionário tem biometria facial cadastrada\r\n        const emp = activeEmployees.find(e => e.id === selectedEmployee);\r\n        if (!emp) {\r\n            toast({ title: 'Erro', description: 'Selecione um funcionário primeiro.', variant: 'destructive' });\r\n            return;\r\n        }\r\n\r\n        if (!emp.faceDescriptor || emp.faceDescriptor.length === 0) {\r\n            // Mostrar modal perguntando se quer cadastrar biometria\r\n            setShowBiometryModal(true);\r\n            return;\r\n        }\r\n\r\n        // 4. Tudo OK - iniciar captura\r\n        proceedWithCapture(type);\r\n    };\r\n\r\n    /**\r\n     * Continua o fluxo de captura após validações\r\n     */\r\n    const proceedWithCapture = (type: 'entry' | 'exit') => {\r\n        setRecordType(type);\r\n        setCountdown(30);\r\n        setIsManualMode(false);\r\n        setManualCpf('');\r\n        setView('capturing');\r\n        startCamera();\r\n    };\r\n\r\n    const handleRecord = async (forcedPhoto?: string) => {\r\n        const finalPhoto = forcedPhoto || photoData;\r\n\r\n        if (!selectedEmployee || !finalPhoto) {\r\n            toast({ title: 'Erro', description: 'Dados incompletos para o registro.', variant: 'destructive' });\r\n            return;\r\n        }\r\n\r\n        setIsSaving(true);\r\n\r\n        try {\r\n            const emp = activeEmployees.find(e => e.id === selectedEmployee);\r\n\r\n            // Buscar geolocalização com maior robustez e persistência\r\n            let latitude: number | null = null;\r\n            let longitude: number | null = null;\r\n\r\n            const getPos = (options: PositionOptions) =>\r\n                new Promise<GeolocationPosition>((resolve, reject) =>\r\n                    navigator.geolocation.getCurrentPosition(resolve, reject, options)\r\n                );\r\n\r\n            try {\r\n                // Tenta alta precisão (15s timeout)\r\n                const position = await getPos({\r\n                    enableHighAccuracy: true,\r\n                    timeout: 15000,\r\n                    maximumAge: 0\r\n                });\r\n                latitude = position.coords.latitude;\r\n                longitude = position.coords.longitude;\r\n            } catch (err) {\r\n                console.warn('Alta precisão falhou no save, tentando modo rápido...', err);\r\n                try {\r\n                    // Fallback imediato para precisão normal (mais 10s timeout)\r\n                    const position = await getPos({\r\n                        enableHighAccuracy: false,\r\n                        timeout: 10000,\r\n                        maximumAge: 250000 // Aceita cache de 5 min\r\n                    });\r\n                    latitude = position.coords.latitude;\r\n                    longitude = position.coords.longitude;\r\n                } catch (fallbackErr) {\r\n                    console.error('GPS falhou completamente:', fallbackErr);\r\n                    // Tentar recuperar a ÚLTIMA localização salva no dispositivo\r\n                    const lastKnown = await storageService.getItem<{ lat: number, lng: number }>('last_known_location');\r\n                    if (lastKnown) {\r\n                        latitude = lastKnown.lat;\r\n                        longitude = lastKnown.lng;\r\n                        console.info('Usando última localização conhecida salva.');\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Se conseguimos uma localização válida, salvamos como \"última conhecida\" para o futuro\r\n            if (latitude !== null && longitude !== null) {\r\n                await storageService.setItem('last_known_location', { lat: latitude, lng: longitude });\r\n                setLastLoc({ lat: latitude, lng: longitude });\r\n            }\r\n\r\n            const result = await createRecord({\r\n                employeeId: selectedEmployee,\r\n                teamId: selectedTeam || undefined,\r\n                companyId: profile?.companyId,\r\n                recordType,\r\n                photoUrl: finalPhoto,\r\n                latitude: latitude ?? undefined,\r\n                longitude: longitude ?? undefined,\r\n            });\r\n\r\n            setStabilityRef(0);\r\n            setFaceMatchDistance(null);\r\n\r\n            // Aguarda 3 segundos para que o usuário veja a confirmação de sucesso\r\n            await new Promise(resolve => setTimeout(resolve, 3000));\r\n\r\n            setPhotoData(null);\r\n            stopCamera();\r\n            setView('home');\r\n        } catch (e) {\r\n            toast({ title: 'Erro no servidor', description: 'Não foi possível salvar o registro.', variant: 'destructive' });\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    // Render Sub-views\r\n    const renderHome = () => (\r\n        <div className=\"flex flex-col h-full max-w-md mx-auto animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n            {/* Header / Tabs */}\r\n            <div className=\"flex bg-muted/40 p-1 rounded-2xl mb-8 border border-border/50\">\r\n                {['ponto', 'checkin', 'historico'].map((tab) => (\r\n                    <button\r\n                        key={tab}\r\n                        onClick={() => setActiveTab(tab as any)}\r\n                        className={`flex-1 py-3 text-xs font-bold uppercase tracking-widest rounded-xl transition-all ${activeTab === tab ? 'bg-primary text-white shadow-lg' : 'text-muted-foreground hover:text-foreground'\r\n                            }`}\r\n                    >\r\n                        {tab === 'checkin' ? 'Check-in' : tab}\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Content Area */}\r\n            <div className=\"flex-1 space-y-8 pb-10\">\r\n                {activeTab === 'ponto' && (\r\n                    <>\r\n                        <div className=\"text-center space-y-2\">\r\n                            <h2 className=\"text-5xl font-black tracking-tighter text-foreground tabular-nums\">\r\n                                {format(currentTime, 'HH:mm:ss')}\r\n                            </h2>\r\n                            <p className=\"text-muted-foreground font-bold uppercase tracking-widest text-xs\">\r\n                                {format(currentTime, \"EEEE, dd 'de' MMMM\", { locale: ptBR })}\r\n                            </p>\r\n                        </div>\r\n\r\n                        {/* Worked Hours Display */}\r\n                        <div className=\"glass-card p-6 rounded-[2.5rem] bg-linear-to-br from-primary/10 to-transparent border-primary/10 shadow-glow-sm\">\r\n                            <div className=\"flex items-center justify-between mb-4\">\r\n                                <div className=\"p-3 rounded-2xl bg-primary/20 text-primary\">\r\n                                    <Clock className=\"w-6 h-6\" />\r\n                                </div>\r\n                                <Badge variant=\"outline\" className=\"border-primary/20 text-primary font-bold\">HOJE</Badge>\r\n                            </div>\r\n                            <div className=\"space-y-1\">\r\n                                <p className=\"text-sm font-bold text-muted-foreground uppercase tracking-widest\">Horas trabalhadas hoje</p>\r\n                                <p className=\"text-3xl font-black tracking-tight\">{workedData.h}h {workedData.m}m</p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Employee Selection (if admin) */}\r\n                        {!isWorker && (\r\n                            <div className=\"space-y-3\">\r\n                                <Label className=\"text-[10px] font-black uppercase tracking-widest ml-1 text-muted-foreground\">Colaborador</Label>\r\n                                <div className=\"relative\">\r\n                                    {!selectedEmployee && (\r\n                                        <div className=\"relative\">\r\n                                            <div className=\"relative\">\r\n                                                <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\r\n                                                <Input\r\n                                                    type=\"text\"\r\n                                                    placeholder=\"Digite o nome, CPF ou matrícula...\"\r\n                                                    value={employeeSearch}\r\n                                                    onChange={(e) => {\r\n                                                        setEmployeeSearch(e.target.value);\r\n                                                        setShowEmployeeDropdown(true);\r\n                                                    }}\r\n                                                    onFocus={() => setShowEmployeeDropdown(true)}\r\n                                                    className=\"h-14 rounded-2xl industrial-input bg-card shadow-sm pl-12 pr-4\"\r\n                                                />\r\n                                                {employeeSearch && (\r\n                                                    <button\r\n                                                        onClick={() => {\r\n                                                            setEmployeeSearch('');\r\n                                                        }}\r\n                                                        className=\"absolute right-4 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground\"\r\n                                                    >\r\n                                                        <X className=\"h-5 w-5\" />\r\n                                                    </button>\r\n                                                )}\r\n                                            </div>\r\n\r\n                                            {/* Dropdown com resultados filtrados */}\r\n                                            {showEmployeeDropdown && employeeSearch && (\r\n                                                <div className=\"absolute z-50 w-full mt-2 bg-card border border-border rounded-2xl shadow-xl max-h-60 overflow-y-auto\">\r\n                                                    {activeEmployees\r\n                                                        .filter(e => {\r\n                                                            const searchTerm = employeeSearch.toLowerCase().trim();\r\n                                                            const searchDigits = searchTerm.replace(/\\D/g, '');\r\n\r\n                                                            const matchesName = e.fullName.toLowerCase().includes(searchTerm);\r\n                                                            const matchesMat = e.registrationNumber.toLowerCase().includes(searchTerm);\r\n                                                            const matchesCpf = searchDigits !== '' && e.cpf?.replace(/\\D/g, '').includes(searchDigits);\r\n\r\n                                                            return matchesName || matchesMat || matchesCpf;\r\n                                                        })\r\n                                                        .slice(0, 10)\r\n                                                        .map(e => (\r\n                                                            <button\r\n                                                                key={e.id}\r\n                                                                onClick={() => {\r\n                                                                    setSelectedEmployee(e.id);\r\n                                                                    setEmployeeSearch(e.fullName);\r\n                                                                    setShowEmployeeDropdown(false);\r\n                                                                }}\r\n                                                                className={cn(\r\n                                                                    \"w-full px-4 py-3 text-left hover:bg-primary/10 flex items-center justify-between transition-colors\",\r\n                                                                    selectedEmployee === e.id && \"bg-primary/20\"\r\n                                                                )}\r\n                                                            >\r\n                                                                <div className=\"flex flex-col gap-0.5\">\r\n                                                                    <p className=\"font-bold text-sm leading-tight text-foreground\">{e.fullName}</p>\r\n                                                                    <div className=\"flex items-center gap-2\">\r\n                                                                        <span className=\"text-[10px] text-muted-foreground font-medium uppercase tracking-wider bg-muted/30 px-1.5 py-0.5 rounded\">CPF: {formatCPF(e.cpf)}</span>\r\n                                                                        <span className=\"text-[10px] text-muted-foreground font-medium uppercase tracking-wider bg-muted/30 px-1.5 py-0.5 rounded\">Mat: #{e.registrationNumber}</span>\r\n                                                                    </div>\r\n                                                                </div>\r\n                                                                {selectedEmployee === e.id && (\r\n                                                                    <Check className=\"h-5 w-5 text-primary\" />\r\n                                                                )}\r\n                                                            </button>\r\n                                                        ))\r\n                                                    }\r\n                                                    {activeEmployees.filter(e => {\r\n                                                        const searchTerm = employeeSearch.toLowerCase().trim();\r\n                                                        const searchDigits = searchTerm.replace(/\\D/g, '');\r\n                                                        return e.fullName.toLowerCase().includes(searchTerm) ||\r\n                                                            e.registrationNumber.toLowerCase().includes(searchTerm) ||\r\n                                                            (searchDigits !== '' && e.cpf?.replace(/\\D/g, '').includes(searchDigits));\r\n                                                    }).length === 0 && (\r\n                                                            <div className=\"px-4 py-6 text-center text-muted-foreground\">\r\n                                                                <User className=\"h-8 w-8 mx-auto mb-2 opacity-30\" />\r\n                                                                <p className=\"text-sm\">Nenhum colaborador encontrado</p>\r\n                                                            </div>\r\n                                                        )}\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n\r\n                                {/* Mostrar colaborador selecionado */}\r\n                                {selectedEmployee && !showEmployeeDropdown && (\r\n                                    <div\r\n                                        onClick={() => {\r\n                                            setSelectedEmployee('');\r\n                                            setEmployeeSearch('');\r\n                                            setShowEmployeeDropdown(true);\r\n                                        }}\r\n                                        className=\"flex items-center gap-3 p-4 rounded-2xl bg-primary/10 border border-primary/20 cursor-pointer hover:bg-primary/15 transition-all active:scale-[0.98] group relative overflow-hidden\"\r\n                                    >\r\n                                        <div className=\"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center shrink-0\">\r\n                                            <User className=\"h-6 w-6 text-primary\" />\r\n                                        </div>\r\n                                        <div className=\"flex-1\">\r\n                                            <p className=\"font-bold text-base leading-tight\">{activeEmployees.find(e => e.id === selectedEmployee)?.fullName}</p>\r\n                                            <div className=\"flex items-center gap-3 mt-1\">\r\n                                                <span className=\"text-xs text-muted-foreground font-medium uppercase tracking-wider\">CPF: {formatCPF(activeEmployees.find(e => e.id === selectedEmployee)?.cpf || null)}</span>\r\n                                                <span className=\"text-xs text-muted-foreground font-medium uppercase tracking-wider\">Mat: #{activeEmployees.find(e => e.id === selectedEmployee)?.registrationNumber}</span>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"flex items-center justify-center w-10 h-10 rounded-full bg-muted/20 group-hover:bg-cyan-500/10 transition-all duration-300\">\r\n                                            <Check className=\"h-6 w-6 text-emerald-500 group-hover:hidden drop-shadow-[0_0_8px_rgba(16,185,129,0.5)]\" />\r\n                                            <Search className=\"h-6 w-6 text-cyan-400 hidden group-hover:block animate-in zoom-in-50 duration-200 drop-shadow-[0_0_8px_rgba(34,211,238,0.5)]\" />\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Main Action Button */}\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"flex gap-4\">\r\n                                <Button\r\n                                    onClick={() => handleTimeClockClick('entry')}\r\n                                    className=\"h-24 flex-1 rounded-4xl flex-col gap-2 font-black text-lg bg-success text-white hover:bg-success/90 shadow-glow transition-transform active:scale-95\"\r\n                                >\r\n                                    <LogIn className=\"w-8 h-8\" />\r\n                                    ENTRADA\r\n                                </Button>\r\n                                <Button\r\n                                    onClick={() => handleTimeClockClick('exit')}\r\n                                    className=\"h-24 flex-1 rounded-4xl flex-col gap-2 font-black text-lg bg-destructive text-white hover:bg-destructive/90 shadow-glow transition-transform active:scale-95\"\r\n                                >\r\n                                    <LogOut className=\"w-8 h-8\" />\r\n                                    SAÍDA\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Location Info */}\r\n                        <div className=\"flex items-start gap-3 p-5 rounded-4xl bg-muted/30 border border-white/5\">\r\n                            <MapPin className=\"w-5 h-5 text-primary mt-0.5\" />\r\n                            <div className=\"space-y-1\">\r\n                                <p className=\"text-[10px] font-black text-muted-foreground uppercase tracking-widest\">Sua Localização</p>\r\n                                <p className=\"text-sm font-bold text-foreground leading-snug\">\r\n                                    {lastLoc ? `${lastLoc.lat.toFixed(4)}, ${lastLoc.lng.toFixed(4)} (Capturado)` : 'Buscando sinal de satélite...'}\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </>\r\n                )}\r\n\r\n                {activeTab === 'historico' && (\r\n                    <div className=\"space-y-4 animate-in fade-in slide-in-from-bottom-2\">\r\n                        <div className=\"flex items-center justify-between mb-4\">\r\n                            <h3 className=\"font-black uppercase tracking-widest text-xs ml-1\">Registros de Hoje</h3>\r\n                            <Button variant=\"ghost\" size=\"sm\" className=\"text-xs h-8\">Ver todos</Button>\r\n                        </div>\r\n                        {dailyRecords.length === 0 ? (\r\n                            <div className=\"text-center py-12 opacity-30\">\r\n                                <History className=\"w-12 h-12 mx-auto mb-2\" />\r\n                                <p className=\"text-sm font-bold\">Nenhum registro ainda hoje</p>\r\n                            </div>\r\n                        ) : (\r\n                            dailyRecords.map((r, i) => (\r\n                                <div key={i} className=\"flex items-center gap-4 p-4 glass-card rounded-2xl border-white/5\">\r\n                                    <div className={`p-3 rounded-xl ${r.recordType === 'entry' ? 'bg-success/10 text-success' : 'bg-destructive/10 text-destructive'}`}>\r\n                                        {r.recordType === 'entry' ? <LogIn className=\"w-5 h-5\" /> : <LogOut className=\"w-5 h-5\" />}\r\n                                    </div>\r\n                                    <div className=\"flex-1\">\r\n                                        <p className=\"font-bold text-sm tracking-tight\">{r.recordType === 'entry' ? 'Entrada' : 'Saída'}</p>\r\n                                        <p className=\"text-[10px] text-muted-foreground font-black uppercase\">{format(new Date(r.recordedAt), 'HH:mm:ss')}</p>\r\n                                    </div>\r\n                                    <ChevronRight className=\"w-4 h-4 text-muted-foreground opacity-30\" />\r\n                                </div>\r\n                            ))\r\n                        )}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    const renderCapturing = () => (\r\n        <div className=\"fixed inset-0 z-50 bg-black animate-in fade-in duration-300 flex items-center justify-center p-0 lg:p-12 overflow-hidden\">\r\n            {/* Main Module Container - Restricted aspect ratio on desktop */}\r\n            <div className=\"relative w-full h-full max-w-lg aspect-9/16 bg-background overflow-hidden shadow-2xl transition-transform duration-700\">\r\n                {/* Video Feed */}\r\n                <video\r\n                    ref={videoRef}\r\n                    autoPlay\r\n                    playsInline\r\n                    muted\r\n                    className=\"absolute inset-0 w-full h-full object-cover scale-x-[-1]\"\r\n                />\r\n\r\n                {/* Scanline Effect */}\r\n                {!isSaving && !photoData && (\r\n                    <div className=\"absolute inset-x-0 h-20 w-full bg-linear-to-b from-transparent via-primary/20 to-transparent animate-scan-slow opacity-50 z-10 pointer-events-none\" />\r\n                )}\r\n\r\n                {/* UI Overlay - Contained within video aspect ratio */}\r\n                <div className=\"absolute inset-0 z-20 flex flex-col pointer-events-none\">\r\n                    {/* Header: Status messages stuck to top with soft background - Full Width */}\r\n                    <div className=\"w-full flex flex-col items-center\">\r\n                        <div className=\"w-full bg-background/60 backdrop-blur-md py-6 border-b border-border/50 text-center space-y-1 pointer-events-none animate-in slide-in-from-top duration-500\">\r\n                            {(!isManualMode || isSaving) && countdown > 0 && (\r\n                                <>\r\n                                    <p className=\"text-foreground text-3xl font-black tracking-tighter animate-pulse drop-shadow-sm\">\r\n                                        {isSaving ? 'REGISTRANDO...' : 'AGUARDE...'}\r\n                                    </p>\r\n                                    <p className=\"text-foreground/80 text-[11px] font-black uppercase tracking-[0.2em] leading-none\">\r\n                                        {isSaving ? 'Sua foto foi capturada' : 'estamos reconhecendo seu rosto'}\r\n                                    </p>\r\n                                </>\r\n                            )}\r\n\r\n                            {!isSaving && !photoData && !isManualMode && countdown > 0 && (\r\n                                <p className=\"text-foreground text-[44px] font-black mt-2 drop-shadow-sm\">\r\n                                    {countdown}s\r\n                                </p>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Close button - adjusted to be below or side of status */}\r\n                        <div className=\"absolute top-6 right-6\">\r\n                            <button\r\n                                onClick={() => { stopCamera(); setView('home'); }}\r\n                                className=\"w-14 h-14 rounded-full bg-background/60 backdrop-blur-xl flex items-center justify-center pointer-events-auto border border-border/50 text-foreground hover:bg-background/80 transition-colors shadow-lg\"\r\n                            >\r\n                                <X className=\"w-7 h-7 stroke-3\" />\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Espaçador para compensar o conteúdo do topo */}\r\n                    <div className=\"h-20\" />\r\n\r\n                    {/* Middle: Face Frame */}\r\n                    <div className=\"flex-1 flex flex-col items-center justify-center px-8 relative\">\r\n                        {!isManualMode && countdown > 0 && (\r\n                            <div className=\"relative w-full aspect-square border-2 rounded-[3rem] transition-colors duration-500\"\r\n                                style={{ borderColor: faceMatchDistance === null ? 'rgba(255,255,255,0.2)' : faceMatchDistance < 0.5 ? 'var(--success)' : 'var(--destructive)' }}>\r\n\r\n                                {/* Corner accents */}\r\n                                <div className=\"absolute -top-1 -left-1 w-12 h-12 border-t-8 border-l-8 rounded-tl-[3rem] border-inherit\" />\r\n                                <div className=\"absolute -top-1 -right-1 w-12 h-12 border-t-8 border-r-8 rounded-tr-[3rem] border-inherit\" />\r\n                                <div className=\"absolute -bottom-1 -left-1 w-12 h-12 border-b-8 border-l-8 rounded-bl-[3rem] border-inherit\" />\r\n                                <div className=\"absolute -bottom-1 -right-1 w-12 h-12 border-b-8 border-r-8 rounded-br-[3rem] border-inherit\" />\r\n\r\n                                {/* Progress indicator removed from here to be moved to footer */}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Footer: Manual Action / Expiration Message */}\r\n                    <div className=\"p-8 pb-12 pointer-events-auto mt-auto\">\r\n                        {/* Progress indicator (centered at the bottom) */}\r\n                        {!isManualMode && faceMatchDistance !== null && faceMatchDistance < 0.5 && !isSaving && !photoData && (\r\n                            <div className=\"flex justify-center mb-12 animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n                                <div className=\"px-6 py-2.5 rounded-full bg-success text-success-foreground font-black text-[10px] tracking-[0.2em] shadow-lg flex items-center gap-2.5 whitespace-nowrap border border-white/10\">\r\n                                    <div className=\"w-2 h-2 rounded-full bg-current animate-ping\" />\r\n                                    RECONHECIDO {Math.min(100, Math.round((stabilityRef / 5) * 100))}%\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Location Status Indicator */}\r\n                        <div className=\"absolute top-6 right-6 z-20 flex flex-col gap-2\">\r\n                            <div className={cn(\r\n                                \"px-3 py-1.5 rounded-full backdrop-blur-md border flex items-center gap-2 transition-all duration-300\",\r\n                                lastLoc\r\n                                    ? \"bg-success/20 border-success/30 text-success\"\r\n                                    : \"bg-muted/50 border-border text-muted-foreground\"\r\n                            )}>\r\n                                <MapPin className={cn(\"w-3.5 h-3.5\", !lastLoc && \"animate-pulse\")} />\r\n                                <span className=\"text-[10px] font-bold tracking-wider uppercase\">\r\n                                    {lastLoc ? 'Localização OK' : 'Buscando GPS...'}\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {isManualMode && !isSaving && !photoData && (\r\n                            <div className=\"w-full space-y-6 animate-in fade-in slide-in-from-bottom-8 duration-700\">\r\n                                <div className=\"space-y-4 text-center\">\r\n                                    <Label className=\"block text-[11px] font-black uppercase tracking-[0.4em] text-foreground opacity-90\">\r\n                                        Digite seu CPF\r\n                                    </Label>\r\n                                    <div className=\"relative\">\r\n                                        <Input\r\n                                            type=\"text\"\r\n                                            value={manualCpf}\r\n                                            onChange={(e) => {\r\n                                                const val = e.target.value.replace(/\\D/g, '').slice(0, 11);\r\n                                                setManualCpf(val);\r\n                                            }}\r\n                                            className=\"h-20 rounded-[2.5rem] bg-background/60 border-border text-foreground text-center text-4xl font-black tracking-[0.2em] backdrop-blur-xl focus:ring-primary/50 shadow-inner\"\r\n                                            placeholder=\"000.000.000-00\"\r\n                                            autoFocus\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-6\">\r\n                                    <Button\r\n                                        onClick={async () => {\r\n                                            const emp = activeEmployees.find(e => e.id === selectedEmployee);\r\n                                            if (!emp) return;\r\n\r\n                                            // Compara o CPF digitado (apenas números) com o CPF do funcionário (limpo)\r\n                                            if (manualCpf === emp.cpf?.replace(/\\D/g, '')) {\r\n                                                await handleAutoCapture();\r\n                                            } else {\r\n                                                toast({\r\n                                                    title: 'CPF Incorreto',\r\n                                                    description: 'O CPF digitado não corresponde ao colaborador selecionado.',\r\n                                                    variant: 'destructive'\r\n                                                });\r\n                                            }\r\n                                        }}\r\n                                        disabled={manualCpf.length < 11}\r\n                                        className=\"w-full h-24 rounded-[3rem] bg-primary hover:opacity-90 text-primary-foreground font-black uppercase tracking-widest text-2xl shadow-glow active:scale-95 border-none transition-all\"\r\n                                    >\r\n                                        Bater ponto com CPF\r\n                                    </Button>\r\n\r\n                                    {countdown === 0 && (\r\n                                        <p className=\"text-muted-foreground text-[10px] uppercase font-black tracking-[0.3em] text-center\">\r\n                                            Tempo de reconhecimento facial esgotado\r\n                                        </p>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Flash/Result Layers (Highest Z) */}\r\n            {isSaving && (\r\n                <div className=\"absolute inset-0 bg-white animate-flash z-40\" />\r\n            )}\r\n\r\n            {photoData && (\r\n                <div className=\"absolute inset-0 z-50 flex flex-col items-center justify-center bg-background/80 backdrop-blur-md animate-in fade-in duration-500\">\r\n                    <div className=\"bg-success p-8 rounded-full shadow-glow animate-scale-in mb-6\">\r\n                        <CheckCircle2 className=\"w-16 h-16 text-success-foreground\" />\r\n                    </div>\r\n                    <div className=\"text-center space-y-2 animate-in slide-in-from-bottom-4 delay-200 duration-500\">\r\n                        <p className=\"text-foreground text-3xl font-black tracking-tighter\">SUCESSO!</p>\r\n                        <p className=\"text-muted-foreground font-bold uppercase tracking-widest text-[10px]\">Ponto registrado com êxito</p>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-transparent\">\r\n            {view === 'home' && renderHome()}\r\n            {view === 'capturing' && renderCapturing()}\r\n\r\n            {/* Hidden Canvas for processing */}\r\n            <canvas ref={canvasRef} className=\"hidden\" />\r\n\r\n            {/* Modal: Biometria não cadastrada */}\r\n            <AlertDialog open={showBiometryModal} onOpenChange={setShowBiometryModal}>\r\n                <AlertDialogContent className=\"max-w-md\">\r\n                    <AlertDialogHeader>\r\n                        <div className=\"mx-auto mb-4 w-16 h-16 rounded-full bg-amber-500/10 flex items-center justify-center\">\r\n                            <ScanFace className=\"w-8 h-8 text-amber-500\" />\r\n                        </div>\r\n                        <AlertDialogTitle className=\"text-center text-xl\">\r\n                            Biometria Facial Não Cadastrada\r\n                        </AlertDialogTitle>\r\n                        <AlertDialogDescription className=\"text-center\">\r\n                            Para registrar o ponto, é necessário ter a biometria facial cadastrada.\r\n                            Deseja cadastrar sua biometria agora?\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <AlertDialogFooter className=\"flex-col sm:flex-row gap-2\">\r\n                        <AlertDialogCancel\r\n                            className=\"flex-1\"\r\n                            onClick={() => {\r\n                                setShowBiometryModal(false);\r\n                                toast({\r\n                                    title: 'Registro Bloqueado',\r\n                                    description: 'É necessário cadastrar a biometria facial para registrar ponto.',\r\n                                    variant: 'destructive'\r\n                                });\r\n                            }}\r\n                        >\r\n                            Não, cancelar\r\n                        </AlertDialogCancel>\r\n                        <AlertDialogAction\r\n                            className=\"flex-1 bg-primary\"\r\n                            onClick={() => {\r\n                                setShowBiometryModal(false);\r\n                                setShowFaceRegistration(true);\r\n                            }}\r\n                        >\r\n                            Sim, cadastrar agora\r\n                        </AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n\r\n            {/* Modal: Localização não ativa */}\r\n            <AlertDialog open={showLocationWarning} onOpenChange={setShowLocationWarning}>\r\n                <AlertDialogContent className=\"max-w-md\">\r\n                    <AlertDialogHeader>\r\n                        <div className=\"mx-auto mb-4 w-16 h-16 rounded-full bg-destructive/10 flex items-center justify-center\">\r\n                            <MapPin className=\"w-8 h-8 text-destructive\" />\r\n                        </div>\r\n                        <AlertDialogTitle className=\"text-center text-xl\">\r\n                            Localização Não Disponível\r\n                        </AlertDialogTitle>\r\n                        <AlertDialogDescription className=\"text-center\">\r\n                            Aguarde a localização GPS ser capturada antes de registrar o ponto.\r\n                            Verifique se o GPS está ativado no seu dispositivo.\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogAction\r\n                            className=\"w-full\"\r\n                            onClick={() => setShowLocationWarning(false)}\r\n                        >\r\n                            Entendido\r\n                        </AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n\r\n            {/* Dialog: Cadastro de Biometria Facial */}\r\n            <FaceRegistrationDialog\r\n                employee={activeEmployees.find(e => e.id === selectedEmployee) || null}\r\n                open={showFaceRegistration}\r\n                onOpenChange={(open) => {\r\n                    setShowFaceRegistration(open);\r\n                    // Após fechar o cadastro, verificar se a biometria foi cadastrada\r\n                    if (!open) {\r\n                        const emp = activeEmployees.find(e => e.id === selectedEmployee);\r\n                        if (emp?.faceDescriptor && emp.faceDescriptor.length > 0) {\r\n                            // Biometria cadastrada com sucesso, continuar para registro\r\n                            toast({\r\n                                title: 'Biometria Cadastrada!',\r\n                                description: 'Agora você pode registrar o ponto.'\r\n                            });\r\n                            proceedWithCapture(pendingRecordType);\r\n                        }\r\n                    }\r\n                }}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\TimeRecords.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Eye' is defined but never used.","line":24,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isConnected' is assigned a value but never used.","line":37,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":24},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'employeeMap'. Either include it or remove the dependency array.","line":116,"column":8,"nodeType":"ArrayExpression","endLine":116,"endColumn":118,"suggestions":[{"desc":"Update the dependencies array to be: [records, isWorker, workerEmployeeId, filterDate, filterEmployee, searchTerm, employeeMap, optimisticDeletedIds]","fix":{"range":[5161,5271],"text":"[records, isWorker, workerEmployeeId, filterDate, filterEmployee, searchTerm, employeeMap, optimisticDeletedIds]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":245,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":245,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9800,9803],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9800,9803],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":290,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":290,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11762,11765],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11762,11765],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo } from 'react';\r\nimport { useTimeRecords, TimeRecord } from '@/hooks/useTimeRecords';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useSync } from \"@/contexts/SyncContext\";\r\nimport { useEmployees } from '@/hooks/useEmployees';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport {\r\n    AlertDialog,\r\n    AlertDialogAction,\r\n    AlertDialogCancel,\r\n    AlertDialogContent,\r\n    AlertDialogDescription,\r\n    AlertDialogFooter,\r\n    AlertDialogHeader,\r\n    AlertDialogTitle\r\n} from '@/components/ui/alert-dialog';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Calendar, User, Search, Eye, Clock, Filter, ImageIcon, MapPin, Plus, Pencil, Trash2, CameraOff } from 'lucide-react';\r\nimport { format } from 'date-fns';\r\nimport { ptBR } from 'date-fns/locale';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { isProtectedSignal, can } from '@/signals/authSignals';\r\n\r\nimport { useSignals } from \"@preact/signals-react/runtime\";\r\n\r\nexport default function TimeRecords() {\r\n    useSignals();\r\n    const { records, isLoading, createRecord, updateRecord, bulkUpdateRecords, bulkDeleteRecords, deleteRecord, refresh } = useTimeRecords();\r\n    const { employees } = useEmployees();\r\n    const { profile } = useAuth();\r\n    const { isConnected } = useSync();\r\n    const { toast } = useToast();\r\n\r\n    const isAdmin = isProtectedSignal.value || can('time_records.manage');\r\n    const isWorker = !isAdmin && !!profile?.employeeId;\r\n    const workerEmployeeId = profile?.employeeId;\r\n\r\n    const [filterDate, setFilterDate] = useState('');\r\n    const [filterEmployee, setFilterEmployee] = useState('all');\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [selectedRecord, setSelectedRecord] = useState<TimeRecord | null>(null);\r\n    const [isManualModalOpen, setIsManualModalOpen] = useState(false);\r\n    const [isEditModalOpen, setIsEditModalOpen] = useState(false);\r\n    const [editingRecord, setEditingRecord] = useState<TimeRecord | null>(null);\r\n    const [selectedIds, setSelectedIds] = useState<string[]>([]);\r\n    const [isBulkLoading, setIsBulkLoading] = useState(false);\r\n    const [optimisticPhotoHiddenIds, setOptimisticPhotoHiddenIds] = useState<string[]>([]);\r\n    const [optimisticDeletedIds, setOptimisticDeletedIds] = useState<string[]>([]);\r\n\r\n    const [confirmDialog, setConfirmDialog] = useState<{\r\n        open: boolean;\r\n        title: string;\r\n        description: string;\r\n        onConfirm: () => void;\r\n        variant?: 'default' | 'destructive';\r\n    }>({\r\n        open: false,\r\n        title: '',\r\n        description: '',\r\n        onConfirm: () => { },\r\n        variant: 'default'\r\n    });\r\n\r\n    // Form state for manual/edit\r\n    const [formData, setFormData] = useState({\r\n        employeeId: '',\r\n        recordType: 'entry' as 'entry' | 'exit',\r\n        recordedAt: format(new Date(), \"yyyy-MM-dd'T'HH:mm\")\r\n    });\r\n\r\n    const employeeMap = useMemo(() => {\r\n        const map = new Map();\r\n        employees.forEach(e => map.set(e.id, e));\r\n        return map;\r\n    }, [employees]);\r\n\r\n    // Filter records\r\n    const filteredRecords = useMemo(() => {\r\n        return records.filter(record => {\r\n            // Se for worker, só mostra o dele\r\n            if (isWorker && workerEmployeeId) {\r\n                if (record.employeeId !== workerEmployeeId) return false;\r\n            }\r\n\r\n            // Date filter\r\n            let matchesDate = true;\r\n            if (filterDate) {\r\n                const recordDateStr = new Date(record.recordedAt).toISOString().split('T')[0];\r\n                matchesDate = recordDateStr === filterDate;\r\n            }\r\n\r\n            // Employee filter (desabilitado para worker)\r\n            const matchesEmployee = (isWorker || filterEmployee === 'all') ? true : record.employeeId === filterEmployee;\r\n\r\n            // Search filter (by employee name if not already filtered)\r\n            const searchLower = searchTerm.toLowerCase();\r\n            const emp = employeeMap.get(record.employeeId);\r\n            const employeeName = record.employeeName || emp?.fullName || '';\r\n            const registrationNumber = emp?.registrationNumber || '';\r\n            const cpf = emp?.cpf || '';\r\n\r\n            const matchesSearch = searchTerm\r\n                ? employeeName.toLowerCase().includes(searchLower) ||\r\n                registrationNumber.toLowerCase().includes(searchLower) ||\r\n                cpf.toLowerCase().includes(searchLower)\r\n                : true;\r\n\r\n            return matchesDate && matchesEmployee && matchesSearch && !optimisticDeletedIds.includes(record.id);\r\n        });\r\n    }, [records, filterDate, filterEmployee, searchTerm, employees, isWorker, workerEmployeeId, optimisticDeletedIds]);\r\n\r\n    const resetFilters = () => {\r\n        setFilterDate('');\r\n        setFilterEmployee('all');\r\n        setSearchTerm('');\r\n    };\r\n\r\n    const handleOpenManualModal = () => {\r\n        setFormData({\r\n            employeeId: '',\r\n            recordType: 'entry',\r\n            recordedAt: format(new Date(), \"yyyy-MM-dd'T'HH:mm\")\r\n        });\r\n        setIsManualModalOpen(true);\r\n    };\r\n\r\n    const handleOpenEditModal = (record: TimeRecord) => {\r\n        setEditingRecord(record);\r\n        setFormData({\r\n            employeeId: record.employeeId,\r\n            recordType: record.recordType,\r\n            recordedAt: format(new Date(record.recordedAt), \"yyyy-MM-dd'T'HH:mm\")\r\n        });\r\n        setIsEditModalOpen(true);\r\n    };\r\n\r\n    const handleSaveManual = async () => {\r\n        if (!formData.employeeId) {\r\n            toast({ title: 'Erro', description: 'Selecione um funcionário', variant: 'destructive' });\r\n            return;\r\n        }\r\n\r\n        const result = await createRecord({\r\n            employeeId: formData.employeeId,\r\n            recordType: formData.recordType,\r\n            recordedAt: new Date(formData.recordedAt)\r\n        });\r\n\r\n        if (result.success) {\r\n            toast({ title: 'Sucesso', description: 'Ponto registrado manualmente' });\r\n            setIsManualModalOpen(false);\r\n            refresh();\r\n        }\r\n    };\r\n\r\n    const handleUpdateRecord = async () => {\r\n        if (!editingRecord) return;\r\n\r\n        const result = await updateRecord(editingRecord.id, {\r\n            employeeId: formData.employeeId,\r\n            recordType: formData.recordType,\r\n            recordedAt: new Date(formData.recordedAt)\r\n        });\r\n\r\n        if (result.success) {\r\n            toast({ title: 'Sucesso', description: 'Registro atualizado' });\r\n            setIsEditModalOpen(false);\r\n            refresh();\r\n        }\r\n    };\r\n\r\n    const handleDeleteRecord = (id: string) => {\r\n        setConfirmDialog({\r\n            open: true,\r\n            title: 'Excluir Registro',\r\n            description: 'Tem certeza que deseja excluir este registro de ponto? Esta ação não pode ser desfeita.',\r\n            variant: 'destructive',\r\n            onConfirm: async () => {\r\n                const result = await deleteRecord(id);\r\n                if (result.success) {\r\n                    toast({ title: 'Sucesso', description: 'Registro excluído' });\r\n                    refresh();\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    const handleRemovePhoto = () => {\r\n        if (!editingRecord) return;\r\n        setConfirmDialog({\r\n            open: true,\r\n            title: 'Remover Foto',\r\n            description: 'Deseja remover a foto deste registro permanentemente?',\r\n            variant: 'destructive',\r\n            onConfirm: async () => {\r\n                const result = await updateRecord(editingRecord.id, {\r\n                    photoUrl: null\r\n                });\r\n                if (result.success) {\r\n                    toast({ title: 'Sucesso', description: 'Foto removida' });\r\n                    setEditingRecord(prev => prev ? { ...prev, photoUrl: null } : null);\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    const toggleSelectAll = () => {\r\n        if (selectedIds.length === filteredRecords.length) {\r\n            setSelectedIds([]);\r\n        } else {\r\n            setSelectedIds(filteredRecords.map(r => r.id));\r\n        }\r\n    };\r\n\r\n    const toggleSelect = (id: string) => {\r\n        setSelectedIds(prev =>\r\n            prev.includes(id) ? prev.filter(i => i !== id) : [...prev, id]\r\n        );\r\n    };\r\n\r\n    const handleBulkDelete = () => {\r\n        setConfirmDialog({\r\n            open: true,\r\n            title: 'Excluir Selecionados',\r\n            description: `Tem certeza que deseja excluir ${selectedIds.length} registros permanentemente? Esta ação será processada em segundo plano.`,\r\n            variant: 'destructive',\r\n            onConfirm: () => {\r\n                const idsToDelete = [...selectedIds];\r\n                // Passo 1: Ocultar imediatamente no UI (Otimista)\r\n                setOptimisticDeletedIds(prev => [...prev, ...idsToDelete]);\r\n                setSelectedIds([]);\r\n\r\n                toast({\r\n                    title: 'Iniciando Exclusão',\r\n                    description: `${idsToDelete.length} registros estão sendo removidos em segundo plano.`\r\n                });\r\n\r\n                // Passo 2: Rodar o processo Async em background\r\n                bulkDeleteRecords(idsToDelete).then((res: any) => {\r\n                    setOptimisticDeletedIds(prev => prev.filter(id => !idsToDelete.includes(id)));\r\n                    if (res.success) {\r\n                        toast({ title: 'Sucesso', description: 'Registros excluídos permanentemente.' });\r\n                        refresh();\r\n                    } else {\r\n                        toast({ title: 'Erro', description: 'Houve um problema ao excluir alguns registros.', variant: 'destructive' });\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    };\r\n\r\n\r\n\r\n    const handleBulkClearPhotos = () => {\r\n        const recordsWithPhoto = records.filter(r => selectedIds.includes(r.id) && r.photoUrl);\r\n\r\n        if (recordsWithPhoto.length === 0) {\r\n            toast({\r\n                title: 'Nenhuma foto encontrada',\r\n                description: 'Os registros selecionados já não possuem fotos para remover.',\r\n                variant: 'destructive'\r\n            });\r\n            return;\r\n        }\r\n\r\n        const idsToClear = recordsWithPhoto.map(r => r.id);\r\n\r\n        setConfirmDialog({\r\n            open: true,\r\n            title: 'Remover Fotos em Massa',\r\n            description: `Deseja remover as fotos de ${idsToClear.length} registros? (Dos ${selectedIds.length} selecionados, ${selectedIds.length - idsToClear.length} não possuem fotos e serão ignorados).`,\r\n            variant: 'destructive',\r\n            onConfirm: () => {\r\n                // Passo 1: Ocultar imediatamente no UI (Otimista)\r\n                setOptimisticPhotoHiddenIds(prev => [...prev, ...idsToClear]);\r\n                setSelectedIds([]);\r\n\r\n                toast({\r\n                    title: 'Iniciando Remoção',\r\n                    description: `As fotos de ${idsToClear.length} registros estão sendo removidas.`\r\n                });\r\n\r\n                // Passo 2: Rodar o processo Async em background\r\n                bulkUpdateRecords(idsToClear, { photoUrl: null }).then((res: any) => {\r\n                    setOptimisticPhotoHiddenIds(prev => prev.filter(id => !idsToClear.includes(id)));\r\n                    if (res.success) {\r\n                        toast({ title: 'Sucesso', description: 'Fotos removidas permanentemente.' });\r\n                        refresh();\r\n                    } else {\r\n                        toast({ title: 'Erro', description: 'Houve um problema ao remover algumas fotos.', variant: 'destructive' });\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    };\r\n\r\n    const handleBulkClearLocation = () => {\r\n        const recordsWithLocation = records.filter(r => selectedIds.includes(r.id) && (r.latitude || r.longitude));\r\n\r\n        if (recordsWithLocation.length === 0) {\r\n            toast({\r\n                title: 'Sem localização',\r\n                description: 'Os registros selecionados já não possuem dados de localização.',\r\n                variant: 'destructive'\r\n            });\r\n            return;\r\n        }\r\n\r\n        const idsToClear = recordsWithLocation.map(r => r.id);\r\n\r\n        setConfirmDialog({\r\n            open: true,\r\n            title: 'Remover Localização',\r\n            description: `Deseja remover a localização de ${idsToClear.length} registros? (Dos ${selectedIds.length} selecionados, ${selectedIds.length - idsToClear.length} não possuem coordenadas e serão ignorados).`,\r\n            variant: 'destructive',\r\n            onConfirm: async () => {\r\n                setIsBulkLoading(true);\r\n                const res = await bulkUpdateRecords(idsToClear, { latitude: null, longitude: null });\r\n                if (res.success) {\r\n                    toast({ title: 'Ação Concluída', description: `Localização removida de ${idsToClear.length} registros.` });\r\n                }\r\n                setSelectedIds([]);\r\n                setIsBulkLoading(false);\r\n                refresh();\r\n            }\r\n        });\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 animate-fade-in pb-10\">\r\n            {/* Ações em Massa (Aparece apenas quando há seleção) */}\r\n            {isAdmin && selectedIds.length > 0 && (\r\n                <div className=\"bg-amber-500/10 border border-amber-500/20 rounded-2xl p-4 flex flex-wrap items-center justify-between gap-4 animate-in slide-in-from-top-2 duration-300 shadow-lg\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"bg-amber-500 text-black font-bold px-3 py-1 rounded-full text-[10px] uppercase tracking-tighter\">\r\n                            {selectedIds.length} selecionados\r\n                        </div>\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            onClick={() => setSelectedIds([])}\r\n                            className=\"text-amber-500 hover:text-amber-400 font-bold text-xs h-8 px-2\"\r\n                        >\r\n                            Limpar Seleção\r\n                        </Button>\r\n                    </div>\r\n                    <div className=\"flex flex-wrap items-center gap-2\">\r\n                        <Button\r\n                            variant=\"outline\"\r\n                            size=\"sm\"\r\n                            onClick={handleBulkClearPhotos}\r\n                            className=\"border-amber-500/30 text-amber-500 hover:bg-amber-500 hover:text-black gap-2 h-9\"\r\n                            disabled={isBulkLoading}\r\n                        >\r\n                            <CameraOff className=\"w-4 h-4\" />\r\n                            Limpar Fotos\r\n                        </Button>\r\n                        <Button\r\n                            variant=\"outline\"\r\n                            size=\"sm\"\r\n                            onClick={handleBulkClearLocation}\r\n                            className=\"border-amber-500/30 text-amber-500 hover:bg-amber-500 hover:text-black gap-2 h-9\"\r\n                            disabled={isBulkLoading}\r\n                        >\r\n                            <MapPin className=\"w-4 h-4\" />\r\n                            Limpar Localização\r\n                        </Button>\r\n                        <Button\r\n                            variant=\"destructive\"\r\n                            size=\"sm\"\r\n                            onClick={handleBulkDelete}\r\n                            className=\"gap-2 h-9 font-bold\"\r\n                            disabled={isBulkLoading}\r\n                        >\r\n                            <Trash2 className=\"w-4 h-4\" />\r\n                            Excluir Selecionados\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Filtros */}\r\n            <div className=\"flex flex-col gap-4 md:flex-row md:items-end glass-card p-5 rounded-2xl border-white/5 shadow-strong\">\r\n                <div className=\"flex-1 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4\">\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-xs font-semibold text-muted-foreground flex items-center gap-1 uppercase tracking-wider\">\r\n                            <Calendar className=\"w-3 h-3\" /> Data\r\n                        </label>\r\n                        <Input\r\n                            type=\"date\"\r\n                            className=\"industrial-input h-11\"\r\n                            value={filterDate}\r\n                            onChange={(e) => setFilterDate(e.target.value)}\r\n                        />\r\n                    </div>\r\n\r\n                    {!isWorker && (\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-xs font-semibold text-muted-foreground flex items-center gap-1 uppercase tracking-wider\">\r\n                                <User className=\"w-3 h-3\" /> Funcionário\r\n                            </label>\r\n                            <Select value={filterEmployee} onValueChange={setFilterEmployee}>\r\n                                <SelectTrigger className=\"industrial-input h-11\">\r\n                                    <SelectValue placeholder=\"Todos os funcionários\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"all\">Todos os funcionários</SelectItem>\r\n                                    {employees.map(e => (\r\n                                        <SelectItem key={e.id} value={e.id}>{e.fullName}</SelectItem>\r\n                                    ))}\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-xs font-semibold text-muted-foreground flex items-center gap-1 uppercase tracking-wider\">\r\n                            <Search className=\"w-3 h-3\" /> Busca Rápida\r\n                        </label>\r\n                        <Input\r\n                            placeholder=\"Nome do funcionário...\"\r\n                            className=\"industrial-input h-11\"\r\n                            value={searchTerm}\r\n                            onChange={(e) => setSearchTerm(e.target.value)}\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"flex items-end\">\r\n                        <Button\r\n                            variant=\"outline\"\r\n                            onClick={resetFilters}\r\n                            className=\"w-full h-11 border-white/10 hover:bg-white/5 transition-colors\"\r\n                        >\r\n                            <Filter className=\"w-4 h-4 mr-2\" />\r\n                            Limpar Filtros\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Tabela de Resultados */}\r\n            <Card className=\"glass-card border-white/5 shadow-strong overflow-hidden\">\r\n                <CardHeader className=\"pb-3 px-6\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div>\r\n                            <CardTitle className=\"text-xl\">Registros Encontrados</CardTitle>\r\n                            <CardDescription>Total de {filteredRecords.length} ponto(s)</CardDescription>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            {isAdmin && (\r\n                                <Button\r\n                                    onClick={handleOpenManualModal}\r\n                                    className=\"gradient-primary shadow-glow font-bold gap-2 h-10 px-4\"\r\n                                    title=\"Adicionar Manual\"\r\n                                >\r\n                                    <Plus className=\"w-4 h-4\" />\r\n                                    Adicionar Manual\r\n                                </Button>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </CardHeader>\r\n                <CardContent className=\"p-0\">\r\n                    <div className=\"overflow-x-auto\">\r\n                        <Table>\r\n                            <TableHeader className=\"bg-muted/30\">\r\n                                <TableRow className=\"hover:bg-transparent border-white/5\">\r\n                                    {isAdmin && (\r\n                                        <TableHead className=\"w-[50px] px-6\">\r\n                                            <input\r\n                                                type=\"checkbox\"\r\n                                                className=\"rounded border-white/20 bg-black/20\"\r\n                                                checked={selectedIds.length === filteredRecords.length && filteredRecords.length > 0}\r\n                                                onChange={toggleSelectAll}\r\n                                            />\r\n                                        </TableHead>\r\n                                    )}\r\n                                    <TableHead className={isAdmin ? \"px-2 font-bold py-4\" : \"px-6 font-bold py-4\"}>Data/Hora</TableHead>\r\n                                    <TableHead className=\"font-bold py-4\">Matrícula</TableHead>\r\n                                    <TableHead className=\"font-bold py-4\">Funcionário</TableHead>\r\n                                    <TableHead className=\"font-bold py-4\">CPF</TableHead>\r\n                                    <TableHead className=\"font-bold py-4\">Tipo</TableHead>\r\n                                    <TableHead className=\"font-bold py-4\">Localização</TableHead>\r\n                                    <TableHead className=\"font-bold py-4\">Status</TableHead>\r\n                                    <TableHead className=\"px-6 font-bold py-4 text-right\">Ações</TableHead>\r\n                                </TableRow>\r\n                            </TableHeader>\r\n                            <TableBody>\r\n                                {isLoading ? (\r\n                                    <TableRow>\r\n                                        <TableCell colSpan={isAdmin ? 9 : 8} className=\"h-48 text-center\">\r\n                                            <div className=\"flex flex-col items-center gap-3\">\r\n                                                <div className=\"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin\" />\r\n                                                <p className=\"text-muted-foreground animate-pulse\">Carregando registros...</p>\r\n                                            </div>\r\n                                        </TableCell>\r\n                                    </TableRow>\r\n                                ) : filteredRecords.length === 0 ? (\r\n                                    <TableRow>\r\n                                        <TableCell colSpan={isAdmin ? 9 : 8} className=\"h-48 text-center text-muted-foreground\">\r\n                                            <div className=\"flex flex-col items-center gap-2 opacity-50\">\r\n                                                <Clock className=\"w-12 h-12 mb-2\" />\r\n                                                <p className=\"text-lg font-medium\">Nenhum registro encontrado</p>\r\n                                                <p className=\"text-sm\">Tente ajustar os filtros acima</p>\r\n                                            </div>\r\n                                        </TableCell>\r\n                                    </TableRow>\r\n                                ) : (\r\n                                    filteredRecords.map((record) => {\r\n                                        const recordDate = new Date(record.recordedAt);\r\n                                        const emp = employeeMap.get(record.employeeId);\r\n                                        const empName = record.employeeName || emp?.fullName || 'Desconhecido';\r\n\r\n                                        return (\r\n                                            <TableRow key={record.id} className={`hover:bg-white/5 border-white/5 transition-colors ${selectedIds.includes(record.id) ? 'bg-primary/5' : ''}`}>\r\n                                                {isAdmin && (\r\n                                                    <TableCell className=\"px-6 py-4\">\r\n                                                        <input\r\n                                                            type=\"checkbox\"\r\n                                                            className=\"rounded border-white/20 bg-black/20\"\r\n                                                            checked={selectedIds.includes(record.id)}\r\n                                                            onChange={() => toggleSelect(record.id)}\r\n                                                        />\r\n                                                    </TableCell>\r\n                                                )}\r\n                                                <TableCell className={isAdmin ? \"px-2 py-4\" : \"px-6 py-4\"}>\r\n                                                    <div className=\"flex flex-col\">\r\n                                                        <span className=\"font-semibold text-foreground\">\r\n                                                            {format(recordDate, \"dd 'de' MMM\", { locale: ptBR })}\r\n                                                        </span>\r\n                                                        <span className=\"text-xs text-muted-foreground flex items-center gap-1\">\r\n                                                            <Clock className=\"w-3 h-3\" />\r\n                                                            {format(recordDate, \"HH:mm:ss\")}\r\n                                                        </span>\r\n                                                    </div>\r\n                                                </TableCell>\r\n                                                <TableCell className=\"py-4 font-bold text-foreground\">\r\n                                                    {emp?.registrationNumber || '---'}\r\n                                                </TableCell>\r\n                                                <TableCell className=\"py-4 font-bold text-foreground\">\r\n                                                    {empName}\r\n                                                </TableCell>\r\n                                                <TableCell className=\"py-4 font-medium text-muted-foreground text-xs\">\r\n                                                    {emp?.cpf || '---'}\r\n                                                </TableCell>\r\n                                                <TableCell className=\"py-4\">\r\n                                                    <Badge\r\n                                                        variant={record.recordType === 'entry' ? 'default' : 'destructive'}\r\n                                                        className={`font-bold px-3 py-1 ${record.recordType === 'entry' ? 'bg-success/20 text-success border-success/30 hover:bg-success/30' : 'bg-destructive/20 text-error border-destructive/30 hover:bg-destructive/30'}`}\r\n                                                    >\r\n                                                        {record.recordType === 'entry' ? 'ENTRADA' : 'SAÍDA'}\r\n                                                    </Badge>\r\n                                                </TableCell>\r\n                                                <TableCell className=\"py-4\">\r\n                                                    {record.latitude && record.longitude ? (\r\n                                                        <a\r\n                                                            href={`https://www.google.com/maps?q=${record.latitude},${record.longitude}`}\r\n                                                            target=\"_blank\"\r\n                                                            rel=\"noopener noreferrer\"\r\n                                                            className=\"text-xs text-primary hover:underline flex items-center gap-1\"\r\n                                                        >\r\n                                                            <MapPin className=\"w-3 h-3\" />\r\n                                                            Ver no Mapa\r\n                                                        </a>\r\n                                                    ) : (\r\n                                                        <span className=\"text-xs text-muted-foreground\">Não disponível</span>\r\n                                                    )}\r\n                                                </TableCell>\r\n                                                <TableCell className=\"py-4\">\r\n                                                    {record.syncedAt ? (\r\n                                                        <Badge variant=\"outline\" className=\"text-[10px] text-success border-success/30 bg-success/5\">\r\n                                                            ONLINE\r\n                                                        </Badge>\r\n                                                    ) : (\r\n                                                        <Badge variant=\"outline\" className=\"text-[10px] text-amber-500 border-amber-500/30 bg-amber-500/5\">\r\n                                                            OFFLINE\r\n                                                        </Badge>\r\n                                                    )}\r\n                                                </TableCell>\r\n                                                <TableCell className=\"px-6 py-4\">\r\n                                                    <div className=\"flex items-center justify-end gap-2\">\r\n                                                        {(record.photoUrl && !optimisticPhotoHiddenIds.includes(record.id)) ? (\r\n                                                            <Button\r\n                                                                variant=\"ghost\"\r\n                                                                size=\"sm\"\r\n                                                                className=\"h-8 w-8 p-0 hover:bg-primary/20 transition-all\"\r\n                                                                onClick={() => setSelectedRecord(record)}\r\n                                                                title=\"Ver Foto\"\r\n                                                            >\r\n                                                                <ImageIcon className=\"w-4 h-4\" />\r\n                                                            </Button>\r\n                                                        ) : (\r\n                                                            <span className=\"text-[10px] text-muted-foreground italic\">\r\n                                                                {optimisticPhotoHiddenIds.includes(record.id) ? 'Removendo...' : 'Sem foto'}\r\n                                                            </span>\r\n                                                        )}\r\n\r\n                                                        {isAdmin && (\r\n                                                            <>\r\n                                                                <Button\r\n                                                                    variant=\"ghost\"\r\n                                                                    size=\"sm\"\r\n                                                                    className=\"h-8 w-8 p-0 hover:bg-amber-500/20 text-amber-500 transition-all\"\r\n                                                                    onClick={() => handleOpenEditModal(record)}\r\n                                                                    title=\"Editar Registro\"\r\n                                                                >\r\n                                                                    <Pencil className=\"w-4 h-4\" />\r\n                                                                </Button>\r\n                                                                <Button\r\n                                                                    variant=\"ghost\"\r\n                                                                    size=\"sm\"\r\n                                                                    className=\"h-8 w-8 p-0 hover:bg-destructive/20 text-destructive transition-all\"\r\n                                                                    onClick={() => handleDeleteRecord(record.id)}\r\n                                                                    title=\"Excluir Registro\"\r\n                                                                >\r\n                                                                    <Trash2 className=\"w-4 h-4\" />\r\n                                                                </Button>\r\n                                                            </>\r\n                                                        )}\r\n                                                    </div>\r\n                                                </TableCell>\r\n                                            </TableRow>\r\n                                        );\r\n                                    })\r\n                                )}\r\n                            </TableBody>\r\n                        </Table>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* Modal de Registro Manual */}\r\n            <Dialog open={isManualModalOpen} onOpenChange={setIsManualModalOpen}>\r\n                <DialogContent className=\"max-w-md glass-card border-white/10\">\r\n                    <DialogHeader>\r\n                        <DialogTitle className=\"flex items-center gap-2\">\r\n                            <Plus className=\"w-5 h-5 text-primary\" />\r\n                            Novo Ponto Manual\r\n                        </DialogTitle>\r\n                    </DialogHeader>\r\n                    <div className=\"space-y-4 py-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <Label>Funcionário</Label>\r\n                            <Select\r\n                                value={formData.employeeId}\r\n                                onValueChange={(val) => setFormData(prev => ({ ...prev, employeeId: val }))}\r\n                            >\r\n                                <SelectTrigger>\r\n                                    <SelectValue placeholder=\"Selecione o funcionário\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    {employees.map(e => (\r\n                                        <SelectItem key={e.id} value={e.id}>{e.fullName} ({e.registrationNumber})</SelectItem>\r\n                                    ))}\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <Label>Tipo de Registro</Label>\r\n                            <Select\r\n                                value={formData.recordType}\r\n                                onValueChange={(val: 'entry' | 'exit') => setFormData(prev => ({ ...prev, recordType: val }))}\r\n                            >\r\n                                <SelectTrigger>\r\n                                    <SelectValue />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"entry\">ENTRADA</SelectItem>\r\n                                    <SelectItem value=\"exit\">SAÍDA</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <Label>Data e Hora</Label>\r\n                            <Input\r\n                                type=\"datetime-local\"\r\n                                value={formData.recordedAt}\r\n                                onChange={(e) => setFormData(prev => ({ ...prev, recordedAt: e.target.value }))}\r\n                            />\r\n                        </div>\r\n                        <Button onClick={handleSaveManual} className=\"w-full gradient-primary font-bold h-12\">\r\n                            Salvar Registro\r\n                        </Button>\r\n                    </div>\r\n                </DialogContent>\r\n            </Dialog>\r\n\r\n            {/* Modal de Edição */}\r\n            <Dialog open={isEditModalOpen} onOpenChange={setIsEditModalOpen}>\r\n                <DialogContent className=\"max-w-md glass-card border-white/10\">\r\n                    <DialogHeader>\r\n                        <DialogTitle className=\"flex items-center gap-2\">\r\n                            <Pencil className=\"w-5 h-5 text-amber-500\" />\r\n                            Editar Registro de Ponto\r\n                        </DialogTitle>\r\n                    </DialogHeader>\r\n                    <div className=\"space-y-4 py-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <Label>Funcionário</Label>\r\n                            <Input value={employeeMap.get(formData.employeeId)?.fullName || ''} disabled className=\"opacity-70\" />\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <Label>Tipo de Registro</Label>\r\n                            <Select\r\n                                value={formData.recordType}\r\n                                onValueChange={(val: 'entry' | 'exit') => setFormData(prev => ({ ...prev, recordType: val }))}\r\n                            >\r\n                                <SelectTrigger>\r\n                                    <SelectValue />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"entry\">ENTRADA</SelectItem>\r\n                                    <SelectItem value=\"exit\">SAÍDA</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <Label>Data e Hora</Label>\r\n                            <Input\r\n                                type=\"datetime-local\"\r\n                                value={formData.recordedAt}\r\n                                onChange={(e) => setFormData(prev => ({ ...prev, recordedAt: e.target.value }))}\r\n                            />\r\n                        </div>\r\n\r\n                        {editingRecord?.photoUrl && (\r\n                            <div className=\"space-y-2\">\r\n                                <Label>Foto do Registro</Label>\r\n                                <div className=\"relative aspect-video rounded-xl overflow-hidden border border-white/10 bg-black/20\">\r\n                                    <img src={editingRecord.photoUrl} alt=\"Ponto\" className=\"w-full h-full object-contain\" />\r\n                                    <Button\r\n                                        variant=\"destructive\"\r\n                                        size=\"sm\"\r\n                                        className=\"absolute top-2 right-2 h-8 px-2 text-[10px] font-bold\"\r\n                                        onClick={handleRemovePhoto}\r\n                                    >\r\n                                        <CameraOff className=\"w-3 h-3 mr-1\" />\r\n                                        REMOVER FOTO\r\n                                    </Button>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        <Button onClick={handleUpdateRecord} className=\"w-full bg-amber-500 hover:bg-amber-600 text-black font-bold h-12 shadow-glow\">\r\n                            Atualizar Alterações\r\n                        </Button>\r\n                    </div>\r\n                </DialogContent>\r\n            </Dialog>\r\n\r\n            {/* Modal de Foto */}\r\n            <Dialog open={!!selectedRecord} onOpenChange={(open) => !open && setSelectedRecord(null)}>\r\n                <DialogContent className=\"max-w-md bg-card border-white/10 p-0 overflow-hidden glass-card shadow-strong max-h-[90vh] flex flex-col\">\r\n                    <DialogHeader className=\"p-4 border-b border-white/5 bg-muted/30 shrink-0\">\r\n                        <DialogTitle className=\"flex items-center gap-2\">\r\n                            <ImageIcon className=\"w-5 h-5 text-primary\" />\r\n                            Foto do Registro\r\n                        </DialogTitle>\r\n                        <DialogDescription className=\"sr-only\">\r\n                            Visualização detalhada da foto capturada no momento do registro de ponto.\r\n                        </DialogDescription>\r\n                    </DialogHeader>\r\n\r\n                    <div className=\"flex flex-col overflow-y-auto\">\r\n                        {/* Foto */}\r\n                        <div className=\"w-full bg-black relative flex items-center justify-center shrink-0\">\r\n                            {selectedRecord?.photoUrl && (\r\n                                <img\r\n                                    src={selectedRecord.photoUrl}\r\n                                    alt=\"Registro de Ponto\"\r\n                                    className=\"w-full h-auto max-h-[50vh] object-contain\"\r\n                                />\r\n                            )}\r\n                            <div className=\"absolute inset-0 pointer-events-none border-4 border-white/10 rounded-[inherit]\" />\r\n                        </div>\r\n\r\n                        {/* Informações do Funcionário (abaixo da foto) */}\r\n                        <div className=\"p-5 bg-linear-to-b from-card to-muted/30 space-y-4\">\r\n                            {/* Badge Entrada/Saída + Nome */}\r\n                            <div className=\"flex items-start justify-between gap-3\">\r\n                                <div className=\"space-y-1 flex-1\">\r\n                                    <Badge\r\n                                        className={`font-black text-[10px] px-2 py-0.5 tracking-widest ${selectedRecord?.recordType === 'entry'\r\n                                            ? 'bg-success text-white'\r\n                                            : 'bg-destructive text-white'\r\n                                            }`}\r\n                                    >\r\n                                        {selectedRecord?.recordType === 'entry' ? 'ENTRADA' : 'SAÍDA'}\r\n                                    </Badge>\r\n                                    <p className=\"text-xl font-black tracking-tight text-foreground\">\r\n                                        {selectedRecord?.employeeName || employees.find(e => e.id === selectedRecord?.employeeId)?.fullName}\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Matrícula e CPF */}\r\n                            <div className=\"flex flex-wrap gap-x-6 gap-y-2 p-3 rounded-xl bg-muted/50 border border-white/5\">\r\n                                <div className=\"space-y-0.5\">\r\n                                    <span className=\"text-[10px] font-bold text-muted-foreground uppercase tracking-widest\">Matrícula</span>\r\n                                    <p className=\"text-sm font-black text-foreground\">\r\n                                        {employees.find(e => e.id === selectedRecord?.employeeId)?.registrationNumber || '---'}\r\n                                    </p>\r\n                                </div>\r\n                                <div className=\"space-y-0.5\">\r\n                                    <span className=\"text-[10px] font-bold text-muted-foreground uppercase tracking-widest\">CPF</span>\r\n                                    <p className=\"text-sm font-black text-foreground\">\r\n                                        {employees.find(e => e.id === selectedRecord?.employeeId)?.cpf || '---'}\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Data e Hora */}\r\n                            <div className=\"space-y-1\">\r\n                                <h3 className=\"text-4xl font-black tracking-tighter text-foreground\">\r\n                                    {selectedRecord && format(new Date(selectedRecord.recordedAt), \"HH:mm:ss\")}\r\n                                </h3>\r\n                                <p className=\"text-sm font-bold text-muted-foreground capitalize tracking-wide\">\r\n                                    {selectedRecord && format(new Date(selectedRecord.recordedAt), \"EEEE, dd 'de' MMMM\", { locale: ptBR })}\r\n                                </p>\r\n                            </div>\r\n\r\n                            {/* Localização GPS */}\r\n                            {selectedRecord?.latitude && selectedRecord?.longitude && (\r\n                                <a\r\n                                    href={`https://www.google.com/maps?q=${selectedRecord.latitude},${selectedRecord.longitude}`}\r\n                                    target=\"_blank\"\r\n                                    rel=\"noopener noreferrer\"\r\n                                    className=\"flex items-center gap-2 text-xs text-primary hover:text-primary/80 px-3 py-2 rounded-xl bg-primary/10 border border-primary/20 hover:bg-primary/20 transition-all cursor-pointer group\"\r\n                                >\r\n                                    <MapPin className=\"w-4 h-4 group-hover:animate-bounce\" />\r\n                                    <span className=\"font-bold\">Localização registrada via GPS</span>\r\n                                    <span className=\"text-[10px] opacity-70 ml-auto\">Clique para ver no mapa →</span>\r\n                                </a>\r\n                            )}\r\n\r\n                            {/* Botão Fechar */}\r\n                            <Button\r\n                                className=\"w-full font-bold h-12 text-base shadow-glow gradient-primary\"\r\n                                onClick={() => setSelectedRecord(null)}\r\n                            >\r\n                                Fechar Visualização\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                </DialogContent>\r\n            </Dialog>\r\n            {/* Alerta de Confirmação Moderno */}\r\n            <AlertDialog open={confirmDialog.open} onOpenChange={(open) => setConfirmDialog(prev => ({ ...prev, open }))}>\r\n                <AlertDialogContent className=\"glass-card border-white/10\">\r\n                    <AlertDialogHeader>\r\n                        <AlertDialogTitle>{confirmDialog.title}</AlertDialogTitle>\r\n                        <AlertDialogDescription>\r\n                            {confirmDialog.description}\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogCancel className=\"bg-white/5 border-white/10 hover:bg-white/10 text-white\">Cancelar</AlertDialogCancel>\r\n                        <AlertDialogAction\r\n                            onClick={confirmDialog.onConfirm}\r\n                            className={confirmDialog.variant === 'destructive' ? 'bg-destructive hover:bg-destructive/90 text-white' : 'gradient-primary text-white'}\r\n                        >\r\n                            Confirmar\r\n                        </AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\Users.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\Viewer3D.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useToast' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Video' is defined but never used.","line":9,"column":79,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":84},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ZoomIn' is defined but never used.","line":9,"column":97,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":103},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ProjectionMode' is defined but never used.","line":10,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":52},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'current' is defined but never used.","line":35,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setAnchors' is assigned a value but never used.","line":69,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":69,"endColumn":21},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has a missing dependency: 'context'. Either include it or remove the dependency array.","line":131,"column":8,"nodeType":"ArrayExpression","endLine":131,"endColumn":63,"suggestions":[{"desc":"Update the dependencies array to be: [context, context.companyId, context.projectId, context.towerId]","fix":{"range":[6256,6311],"text":"[context, context.companyId, context.projectId, context.towerId]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'handleKeyDown' is assigned a value but never used.","line":133,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":133,"endColumn":24}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react'\r\nimport { Scene } from '@/components/scene/Scene'\r\nimport { AnchorPanel } from '@/components/scene/AnchorPanel'\r\nimport { Button } from '@/components/ui/button'\r\nimport { getAnchors, loadTemplateAnchors, STANDARD_PROJECT_ID } from '@/services/anchorService'\r\nimport { useToast } from '@/hooks/use-toast'\r\nimport { useAnchorStore } from '@/store/anchorStore'\r\nimport { useNavigate, useSearchParams } from 'react-router-dom'\r\nimport { ArrowLeft, Box, LayoutGrid, ArrowUp, ArrowDown, MoveRight, MoveLeft, Video, BoxSelect, ZoomIn, Target, MousePointer2 } from 'lucide-react'\r\nimport { useCameraStore, CameraView, ProjectionMode } from '@/store/useCameraStore'\r\nimport { cn } from '@/lib/utils'\r\n\r\nexport default function Viewer3D() {\r\n    const navigate = useNavigate()\r\n    const [searchParams] = useSearchParams()\r\n\r\n    // Extract context from URL or from LocalStorage (if missing)\r\n    const urlCId = searchParams.get('companyId')\r\n    const urlPId = searchParams.get('projectId')\r\n    const urlTId = searchParams.get('towerId')\r\n\r\n    const [context, setContext] = React.useState({\r\n        companyId: urlCId ?? 'default-company',\r\n        projectId: urlPId ?? 'default-project',\r\n        towerId: urlTId ?? 'default-tower'\r\n    })\r\n\r\n    // Init: Check Storage if URL is empty\r\n    React.useEffect(() => {\r\n        if (!urlCId || !urlPId) {\r\n            const saved = localStorage.getItem('3d_lab_context')\r\n            if (saved) {\r\n                try {\r\n                    const parsed = JSON.parse(saved)\r\n                    setContext(current => ({\r\n                        companyId: urlCId || parsed.companyId || 'default-company',\r\n                        projectId: urlPId || parsed.projectId || 'default-project',\r\n                        towerId: urlTId || parsed.towerId || 'default-tower'\r\n                    }))\r\n                } catch (e) {\r\n                    console.error(\"Failed to parse saved context\", e)\r\n                }\r\n            }\r\n        }\r\n    }, [urlCId, urlPId, urlTId])\r\n\r\n    // Save to Storage when we have a valid context (not defaults)\r\n    React.useEffect(() => {\r\n        if (context.companyId && context.companyId !== 'default-company' &&\r\n            context.projectId && context.projectId !== 'default-project' &&\r\n            context.towerId && context.towerId !== 'default-tower') {\r\n\r\n            localStorage.setItem('3d_lab_context', JSON.stringify({\r\n                companyId: context.companyId,\r\n                projectId: context.projectId,\r\n                towerId: context.towerId\r\n            }))\r\n        }\r\n    }, [context])\r\n\r\n    const view = useCameraStore(state => state.view)\r\n    const setView = useCameraStore(state => state.setView)\r\n    const projection = useCameraStore(state => state.projection)\r\n    const setProjection = useCameraStore(state => state.setProjection)\r\n    const zoomToCursor = useCameraStore(state => state.zoomToCursor)\r\n    const toggleZoomMode = useCameraStore(state => state.toggleZoomMode)\r\n    const cameraPosition = useCameraStore(state => state.cameraPosition)\r\n    const setCameraPosition = useCameraStore(state => state.setCameraPosition)\r\n    const setAnchors = useAnchorStore(state => state.setAnchors)\r\n    const [localCoords, setLocalCoords] = React.useState(cameraPosition)\r\n    const [isEditingCoords, setIsEditingCoords] = React.useState(false)\r\n\r\n    // Sync store -> local when not editing\r\n    React.useEffect(() => {\r\n        if (!isEditingCoords) {\r\n            setLocalCoords(cameraPosition)\r\n        }\r\n    }, [cameraPosition, isEditingCoords])\r\n\r\n    const handleCoordChange = (axis: 'x' | 'y' | 'z', value: string) => {\r\n        setLocalCoords(prev => ({ ...prev, [axis]: parseFloat(value) || 0 }))\r\n    }\r\n\r\n    const commitCoordChange = () => {\r\n        setCameraPosition(localCoords)\r\n        setIsEditingCoords(false)\r\n    }\r\n\r\n    // Load anchors on mount\r\n    React.useEffect(() => {\r\n        const loadAnchors = async () => {\r\n            if (context.companyId && context.projectId && context.towerId) {\r\n                try {\r\n                    // 1. Try to load specific anchors for this project\r\n                    const result = await getAnchors(context)\r\n\r\n                    // Always load sequencing metadata if available\r\n                    useAnchorStore.getState().setTechnicalKm(result.technicalKm)\r\n                    useAnchorStore.getState().setTechnicalIndex(result.technicalIndex)\r\n                    useAnchorStore.getState().setCircuitId(result.circuitId)\r\n\r\n                    if (result.anchors && result.anchors.length > 0) {\r\n                        useAnchorStore.getState().setAnchors(result.anchors)\r\n                    }\r\n                    // 2. If no anchors found and we are NOT editing the template itself, try loading the standard template\r\n                    else if (context.projectId !== STANDARD_PROJECT_ID) {\r\n                        try {\r\n                            const templateAnchors = await loadTemplateAnchors(context.towerId)\r\n                            if (templateAnchors && templateAnchors.length > 0) {\r\n                                // Regenerate IDs for new project instances\r\n                                const newAnchors = templateAnchors.map(a => ({\r\n                                    ...a,\r\n                                    id: `auto-instance-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n                                    companyId: context.companyId,\r\n                                    projectId: context.projectId\r\n                                }))\r\n                                useAnchorStore.getState().setAnchors(newAnchors)\r\n                                // Optional: Notify user\r\n                                // toast({ title: \"Template Padrão\", description: \"Carregado automaticamente.\" })\r\n                            }\r\n                        } catch (tmplErr) {\r\n                            console.log(\"No template found or error loading template\", tmplErr)\r\n                        }\r\n                    }\r\n                } catch (err) {\r\n                    console.error(\"Failed to load anchors\", err)\r\n                }\r\n            }\r\n        }\r\n        loadAnchors()\r\n    }, [context.companyId, context.projectId, context.towerId])\r\n\r\n    const handleKeyDown = (e: React.KeyboardEvent) => {\r\n        if (e.key === 'Enter') {\r\n            commitCoordChange()\r\n                ; (e.currentTarget as HTMLInputElement).blur()\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"relative w-screen h-screen overflow-hidden bg-zinc-950 font-sans\">\r\n            {/* Background Grid Pattern */}\r\n            <div className=\"absolute inset-0 bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-size-[24px_24px] pointer-events-none\" />\r\n\r\n            {/* Header UI */}\r\n            <div className=\"absolute top-6 left-6 z-10 flex items-center gap-6\">\r\n                <Button\r\n                    variant=\"ghost\"\r\n                    onClick={() => navigate(-1)}\r\n                    className=\"bg-white/5 hover:bg-white/10 backdrop-blur-md border border-white/10 rounded-2xl h-12 w-12 p-0 text-white/60 hover:text-white\"\r\n                >\r\n                    <ArrowLeft className=\"w-5 h-5\" />\r\n                </Button>\r\n                <div>\r\n                    <div className=\"flex items-center gap-2 mb-1\">\r\n                        <div className=\"p-1 bg-cyan-500/20 rounded-md\">\r\n                            <Box className=\"w-3.5 h-3.5 text-cyan-400\" />\r\n                        </div>\r\n                        <h1 className=\"text-xl font-black uppercase tracking-tighter text-white\">3D Anchor Lab</h1>\r\n                    </div>\r\n                    <p className=\"text-[10px] font-black uppercase tracking-[0.3em] text-white/30 leading-none\">Configuração Técnica de Pontos de Fixação</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Camera Controls Toolbar */}\r\n            <div className=\"absolute top-6 left-1/2 -translate-x-1/2 z-10 flex flex-col items-center gap-3\">\r\n                <div className=\"flex items-center gap-1 bg-black/40 backdrop-blur-xl border border-white/10 p-1.5 rounded-2xl shadow-2xl\">\r\n                    {[\r\n                        { id: 'perspective', label: '3D', icon: LayoutGrid },\r\n                        { id: 'top', label: 'Topo', icon: ArrowUp },\r\n                        { id: 'front', label: 'Frente', icon: ArrowDown },\r\n                        { id: 'right', label: 'Direita', icon: MoveRight },\r\n                        { id: 'left', label: 'Esquerda', icon: MoveLeft },\r\n                    ].map((cam) => (\r\n                        <Button\r\n                            key={cam.id}\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            onClick={() => setView(cam.id as CameraView)}\r\n                            className={cn(\r\n                                \"flex items-center gap-2 h-9 px-4 rounded-xl transition-all duration-300\",\r\n                                \"text-[10px] font-black uppercase tracking-widest\",\r\n                                view === cam.id\r\n                                    ? \"bg-primary text-white shadow-[0_0_15px_rgba(var(--primary),0.5)]\"\r\n                                    : \"text-white/40 hover:text-white hover:bg-white/5\"\r\n                            )}\r\n                        >\r\n                            <cam.icon className=\"w-3.5 h-3.5\" />\r\n                            <span className=\"hidden sm:inline\">{cam.label}</span>\r\n                        </Button>\r\n                    ))}\r\n                </div>\r\n\r\n                {/* Secondary Controls (Projection & Zoom Mode) */}\r\n                <div className=\"flex items-center gap-2 bg-black/20 backdrop-blur-lg border border-white/5 p-1 rounded-xl shadow-lg\">\r\n                    <Button\r\n                        variant=\"ghost\"\r\n                        size=\"sm\"\r\n                        onClick={() => setProjection(projection === 'perspective' ? 'orthographic' : 'perspective')}\r\n                        className={cn(\r\n                            \"h-8 px-3 rounded-lg text-[9px] font-black uppercase tracking-wider gap-2\",\r\n                            projection === 'orthographic' ? \"text-primary bg-primary/10\" : \"text-white/40 hover:text-white\"\r\n                        )}\r\n                        title={projection === 'perspective' ? \"Mudar para Projeção Ortográfica\" : \"Mudar para Projeção Perspectiva\"}\r\n                    >\r\n                        <BoxSelect className=\"w-3 h-3\" />\r\n                        {projection === 'perspective' ? 'Perspectiva' : 'Ortográfica'}\r\n                    </Button>\r\n\r\n                    <div className=\"w-px h-4 bg-white/5\" />\r\n\r\n                    <Button\r\n                        variant=\"ghost\"\r\n                        size=\"sm\"\r\n                        onClick={() => toggleZoomMode()}\r\n                        className={cn(\r\n                            \"h-8 px-3 rounded-lg text-[9px] font-black uppercase tracking-wider gap-2\",\r\n                            zoomToCursor ? \"text-primary bg-primary/10\" : \"text-white/40 hover:text-white\"\r\n                        )}\r\n                        title={zoomToCursor ? \"Zoom foca no Mouse\" : \"Zoom foca no Centro\"}\r\n                    >\r\n                        {zoomToCursor ? <MousePointer2 className=\"w-3 h-3\" /> : <Target className=\"w-3 h-3\" />}\r\n                        {zoomToCursor ? 'Zoom Mouse' : 'Zoom Centro'}\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Camera Coordinates Panel */}\r\n            <div className=\"absolute top-6 left-[calc(50%+240px)] z-10 hidden md:flex items-center gap-1.5 bg-black/40 backdrop-blur-xl border border-white/10 p-1.5 rounded-2xl shadow-2xl h-[44px]\">\r\n                {(['x', 'y', 'z'] as const).map(axis => (\r\n                    <div key={axis} className={cn(\r\n                        \"flex items-center bg-black/20 rounded-lg px-2 h-full border border-white/5 transition-colors group\",\r\n                        axis === 'x' && \"focus-within:border-red-500/50\",\r\n                        axis === 'y' && \"focus-within:border-green-500/50\",\r\n                        axis === 'z' && \"focus-within:border-blue-500/50\"\r\n                    )}>\r\n                        <span className={cn(\r\n                            \"text-[10px] font-black mr-1.5 uppercase\",\r\n                            axis === 'x' && \"text-red-500\",\r\n                            axis === 'y' && \"text-green-500\",\r\n                            axis === 'z' && \"text-blue-500\"\r\n                        )}>{axis}</span>\r\n                        <input\r\n                            type=\"number\"\r\n                            step=\"0.5\"\r\n                            value={localCoords ? localCoords[axis].toFixed(2) : '0.00'}\r\n                            onFocus={() => setIsEditingCoords(true)}\r\n                            onBlur={commitCoordChange}\r\n                            onChange={(e) => handleCoordChange(axis, e.target.value)}\r\n                            onKeyDown={(e) => {\r\n                                if (e.key === 'Enter') {\r\n                                    commitCoordChange();\r\n                                    (e.currentTarget as HTMLInputElement).blur()\r\n                                }\r\n                            }}\r\n                            className=\"bg-transparent border-none text-xs font-bold text-white w-12 text-center focus:outline-none\"\r\n                        />\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Main 3D Canvas */}\r\n            <Scene />\r\n\r\n            {/* Stats UI (Optional) */}\r\n            <div className=\"absolute bottom-6 left-6 flex items-center gap-4 bg-black/40 backdrop-blur-md px-4 py-3 rounded-2xl border border-white/10 pointer-events-none\">\r\n                <div className=\"flex flex-col\">\r\n                    <span className=\"text-[8px] font-black text-white/40 uppercase tracking-widest\">Modelo Ativo</span>\r\n                    <span className=\"text-xs font-black text-white\">TOWER_SCENE_001.GLTF</span>\r\n                </div>\r\n                <div className=\"w-px h-6 bg-white/10 mx-2\" />\r\n                <div className=\"flex flex-col\">\r\n                    <span className=\"text-[8px] font-black text-white/40 uppercase tracking-widest\">Status</span>\r\n                    <span className=\"text-xs font-black text-green-400 flex items-center gap-1.5\">\r\n                        <span className=\"w-1.5 h-1.5 rounded-full bg-green-400 animate-pulse\" />\r\n                        RENDERIZANDO\r\n                    </span>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Anchor List Panel */}\r\n            <AnchorPanel context={context} />\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\pages\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\anchor-debug-service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TowerPhysics' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[304,307],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[304,307],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[386,389],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[386,389],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[428,431],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[428,431],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[473,476],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[473,476],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[879,882],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[879,882],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'getTerrainElevation' is assigned a value but never used.","line":30,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1328,1331],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1328,1331],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2410,2413],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2410,2413],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":69,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2465,2468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2465,2468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2977,2980],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2977,2980],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ScatterplotLayer } from '@deck.gl/layers';\r\nimport { TowerPhysics } from './tower-physics';\r\nimport { TowerAnchorService } from './tower-anchor-service';\r\nimport { CableSettings, ModelTransform } from '../components/map/cable-config-modal';\r\n\r\nexport interface AnchorDebugOptions {\r\n    towers: any[];\r\n    cableSettings: CableSettings;\r\n    placemarkOverrides: Record<string, any>;\r\n    projectAnchors: Record<string, any[]>;\r\n    templateAnchors: Record<string, any[]>;\r\n    localModelUrl: string;\r\n    getEffectiveTransform: (individual: ModelTransform | undefined, url: string) => ModelTransform | undefined;\r\n    terrainRevision?: number;\r\n    getTerrainElevation?: (lng: number, lat: number) => number;\r\n    onAnchorClick?: (towerId: string, anchorConfigId: string) => void;\r\n}\r\n\r\nexport const AnchorDebugService = {\r\n    getLayers: (options: AnchorDebugOptions): any[] => {\r\n        const {\r\n            towers,\r\n            cableSettings,\r\n            placemarkOverrides,\r\n            projectAnchors,\r\n            templateAnchors,\r\n            localModelUrl,\r\n            getEffectiveTransform,\r\n            terrainRevision,\r\n            getTerrainElevation,\r\n            onAnchorClick\r\n        } = options;\r\n\r\n        const enabledAnchors = cableSettings.anchors.filter(a => a.enabled);\r\n        const points: any[] = [];\r\n\r\n        towers.forEach((t) => {\r\n            if (t.isHidden) return;\r\n\r\n            enabledAnchors.forEach((config) => {\r\n                const anchor = TowerAnchorService.getAnchor({\r\n                    tower: t,\r\n                    config,\r\n                    role: 'vante',\r\n                    placemarkOverrides,\r\n                    cableSettings,\r\n                    projectAnchors,\r\n                    templateAnchors,\r\n                    localModelUrl,\r\n                    getEffectiveTransform\r\n                });\r\n\r\n                points.push({\r\n                    position: [anchor.x, anchor.y, anchor.z],\r\n                    color: hexToRgb(config.color),\r\n                    id: `debug-${t.id}-${config.id}`,\r\n                    towerId: t.id,\r\n                    anchorId: config.id,\r\n                    towerName: t.name\r\n                });\r\n            });\r\n        });\r\n\r\n        return [\r\n            new ScatterplotLayer({\r\n                id: 'anchor-debug-layer',\r\n                data: points,\r\n                getPosition: (d: any) => d.position,\r\n                getFillColor: (d: any) => [d.color[0], d.color[1], d.color[2], 255] as [number, number, number, number],\r\n                getRadius: 0.6,\r\n                radiusUnits: 'meters',\r\n                stroked: true,\r\n                getLineColor: [255, 255, 255, 255],\r\n                getLineWidth: 0.1,\r\n                lineWidthUnits: 'meters',\r\n                pickable: true,\r\n                updateTriggers: {\r\n                    getPosition: [points.length, terrainRevision]\r\n                },\r\n                onClick: (info: any) => {\r\n                    if (info.object && onAnchorClick) {\r\n                        onAnchorClick(info.object.towerId, info.object.anchorId);\r\n                    }\r\n                    return true;\r\n                }\r\n            })\r\n        ];\r\n    }\r\n};\r\n\r\nfunction hexToRgb(hex: string): [number, number, number] {\r\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n    return result ? [\r\n        parseInt(result[1], 16),\r\n        parseInt(result[2], 16),\r\n        parseInt(result[3], 16)\r\n    ] : [255, 0, 0];\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\anchorService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'towerId' is defined but never used.","line":17,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":50},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2611,2614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2611,2614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Anchor } from '../types/anchor'\r\n\r\nconst API_URL = import.meta.env.VITE_API_URL || 'http://localhost:3000/api/v1'\r\n\r\nexport const STANDARD_COMPANY_ID = '00000000-0000-0000-0000-000000000000'\r\nexport const STANDARD_PROJECT_ID = '00000000-0000-0000-0000-000000000000'\r\nexport const STANDARD_TOWER_ID = 'default-tower'\r\n\r\nexport function serializeAnchors(anchors: Anchor[]) {\r\n    return anchors.map(a => ({\r\n        ...a,\r\n        position: Array.isArray(a.position) ? a.position : [a.position.x, a.position.y, a.position.z],\r\n        normal: a.normal ? (Array.isArray(a.normal) ? a.normal : [a.normal.x, a.normal.y, a.normal.z]) : null\r\n    }))\r\n}\r\n\r\nexport async function loadTemplateAnchors(towerId?: string): Promise<Anchor[]> {\r\n    // We ignore the specific towerId for now and load the global default for this model\r\n    const result = await getAnchors({\r\n        companyId: STANDARD_COMPANY_ID,\r\n        projectId: STANDARD_PROJECT_ID,\r\n        towerId: STANDARD_TOWER_ID\r\n    })\r\n    return result.anchors;\r\n}\r\n\r\nexport async function saveAsTemplate(towerId: string, anchors: Anchor[]) {\r\n    // Save to the global default ID\r\n    return saveAnchors({\r\n        companyId: STANDARD_COMPANY_ID,\r\n        projectId: STANDARD_PROJECT_ID,\r\n        towerId: STANDARD_TOWER_ID\r\n    }, anchors)\r\n}\r\n\r\n\r\nexport async function saveAnchors(\r\n    context: { companyId: string, projectId: string, towerId: string },\r\n    anchors: Anchor[],\r\n    metadata?: { technicalKm?: number, technicalIndex?: number, circuitId?: string }\r\n) {\r\n    const serialized = serializeAnchors(anchors)\r\n\r\n    const response = await fetch(`${API_URL}/anchors`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n            ...context,\r\n            anchors: serialized,\r\n            ...metadata\r\n        })\r\n    })\r\n\r\n    if (!response.ok) throw new Error('Failed to save anchors')\r\n    return response.json()\r\n}\r\n\r\nexport async function getAnchors(\r\n    context: { companyId: string, projectId: string, towerId: string }\r\n): Promise<{ anchors: Anchor[], technicalKm: number, technicalIndex: number, circuitId: string }> {\r\n    const query = new URLSearchParams(context).toString()\r\n    const response = await fetch(`${API_URL}/anchors?${query}`)\r\n    if (!response.ok) throw new Error('Failed to fetch anchors')\r\n\r\n    const data = await response.json()\r\n\r\n    // Result can be the raw anchors array (legacy) or an object with metadata\r\n    const rawAnchors = Array.isArray(data) ? data : (data.anchors || [])\r\n\r\n    const anchors: Anchor[] = rawAnchors.map((a: any) => ({\r\n        id: a.id,\r\n        name: a.name || a.meshName,\r\n        type: a.type || 'cable_attach',\r\n        meshName: a.meshName,\r\n        position: a.position,\r\n        normal: a.normal,\r\n        faceIndex: a.faceIndex,\r\n        createdAt: a.createdAt || new Date().toISOString()\r\n    }))\r\n\r\n    return {\r\n        anchors,\r\n        technicalKm: data.technicalKm || 0,\r\n        technicalIndex: data.technicalIndex || 0,\r\n        circuitId: data.circuitId || 'C1'\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\api\\BaseApiService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":125,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3950,3953],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3950,3953],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":174,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5677,5680],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5677,5680],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":206,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":206,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6886,6889],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6886,6889],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":265,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":265,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8899,8902],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8899,8902],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":269,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":269,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9012,9015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9012,9015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Base API Service\r\n * \r\n * Classe base para todos os services de API.\r\n * Fornece métodos CRUD genéricos com validação Zod.\r\n */\r\n\r\nimport { z, ZodSchema } from 'zod';\r\nimport { orionApi } from '@/integrations/orion/client';\r\n\r\nexport interface ApiResponse<T> {\r\n    data: T | null;\r\n    error: { message: string; code?: string } | null;\r\n    count?: number;\r\n}\r\n\r\nexport interface ServiceResult<T> {\r\n    success: boolean;\r\n    data?: T;\r\n    error?: string;\r\n    validationErrors?: Record<string, string>;\r\n}\r\n\r\nexport interface PaginationOptions {\r\n    page?: number;\r\n    limit?: number;\r\n    orderBy?: string;\r\n    orderDirection?: 'asc' | 'desc';\r\n}\r\n\r\nexport interface FilterOptions {\r\n    [key: string]: unknown;\r\n}\r\n\r\n/**\r\n * BaseApiService\r\n * \r\n * Classe abstrata que fornece operações CRUD genéricas.\r\n * Todos os services específicos devem estender esta classe.\r\n */\r\nexport abstract class BaseApiService<\r\n    TEntity,\r\n    TCreate,\r\n    TUpdate = Partial<TCreate>\r\n> {\r\n    protected abstract tableName: string;\r\n    protected abstract createSchema: ZodSchema<TCreate>;\r\n    protected abstract updateSchema: ZodSchema<TUpdate>;\r\n\r\n    /**\r\n     * Valida dados usando schema Zod\r\n     */\r\n    protected validate<T>(schema: ZodSchema<T>, data: unknown): ServiceResult<T> {\r\n        try {\r\n            const validated = schema.parse(data);\r\n            return { success: true, data: validated };\r\n        } catch (error) {\r\n            if (error instanceof z.ZodError) {\r\n                const validationErrors: Record<string, string> = {};\r\n                error.errors.forEach(err => {\r\n                    const path = err.path.join('.');\r\n                    validationErrors[path] = err.message;\r\n                });\r\n                return {\r\n                    success: false,\r\n                    error: 'Erro de validação',\r\n                    validationErrors\r\n                };\r\n            }\r\n            return { success: false, error: 'Erro desconhecido na validação' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Mapeia campos do frontend para o formato do backend (snake_case)\r\n     */\r\n    protected toSnakeCase(data: Record<string, unknown>): Record<string, unknown> {\r\n        const result: Record<string, unknown> = {};\r\n        for (const [key, value] of Object.entries(data)) {\r\n            // Converter camelCase para snake_case\r\n            const snakeKey = key.replace(/[A-Z]/g, letter => `_${letter.toLowerCase()}`);\r\n            result[snakeKey] = value;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Mapeia campos do backend (snake_case) para o frontend (camelCase)\r\n     */\r\n    protected toCamelCase(data: Record<string, unknown>): Record<string, unknown> {\r\n        const result: Record<string, unknown> = {};\r\n        for (const [key, value] of Object.entries(data)) {\r\n            // Converter snake_case para camelCase\r\n            const camelKey = key.replace(/_([a-z])/g, (_, letter) => letter.toUpperCase());\r\n            result[camelKey] = value;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Lista todas as entidades\r\n     */\r\n    async getAll(options?: PaginationOptions & FilterOptions): Promise<ServiceResult<TEntity[]>> {\r\n        try {\r\n            let query = orionApi.from<TEntity>(this.tableName).select('*');\r\n\r\n            // Aplicar ordenação\r\n            if (options?.orderBy) {\r\n                query = query.order(options.orderBy, { ascending: options.orderDirection !== 'desc' });\r\n            }\r\n\r\n            // Aplicar limite\r\n            if (options?.limit) {\r\n                query = query.limit(options.limit);\r\n            }\r\n\r\n            const { data, error } = await query;\r\n\r\n            if (error) {\r\n                return { success: false, error: error.message };\r\n            }\r\n\r\n            // Mapear campos para camelCase\r\n            const mapped = (data || []).map(item =>\r\n                this.toCamelCase(item as Record<string, any>) as TEntity\r\n            );\r\n\r\n            return { success: true, data: mapped };\r\n        } catch (error) {\r\n            console.error(`[${this.tableName}Service] getAll error:`, error);\r\n            return { success: false, error: (error as Error).message || 'Erro ao buscar dados' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Busca uma entidade por ID\r\n     */\r\n    async getById(id: string): Promise<ServiceResult<TEntity>> {\r\n        try {\r\n            const { data, error } = await orionApi\r\n                .from<TEntity>(this.tableName)\r\n                .select('*')\r\n                .eq('id', id)\r\n                .single();\r\n\r\n            if (error) {\r\n                return { success: false, error: error.message };\r\n            }\r\n\r\n            if (!data) {\r\n                return { success: false, error: 'Registro não encontrado' };\r\n            }\r\n\r\n            const mapped = this.toCamelCase(data as Record<string, unknown>) as unknown as TEntity;\r\n            return { success: true, data: mapped };\r\n        } catch (error) {\r\n            console.error(`[${this.tableName}Service] getById error:`, error);\r\n            return { success: false, error: (error as Error).message || 'Erro ao buscar registro' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Cria uma nova entidade\r\n     */\r\n    async create(data: TCreate): Promise<ServiceResult<TEntity>> {\r\n        // Validar dados\r\n        const validation = this.validate(this.createSchema, data);\r\n        if (!validation.success) {\r\n            return validation as ServiceResult<TEntity>;\r\n        }\r\n\r\n        try {\r\n            // Converter para snake_case antes de enviar\r\n            const snakeCaseData = this.toSnakeCase(validation.data as Record<string, any>);\r\n\r\n            const { data: created, error } = await orionApi\r\n                .from<TEntity>(this.tableName)\r\n                .insert(snakeCaseData)\r\n                .select('*')\r\n                .single();\r\n\r\n            if (error) {\r\n                return { success: false, error: error.message };\r\n            }\r\n\r\n            const mapped = this.toCamelCase(created as Record<string, unknown>) as unknown as TEntity;\r\n            return { success: true, data: mapped };\r\n        } catch (error) {\r\n            console.error(`[${this.tableName}Service] create error:`, error);\r\n            return { success: false, error: (error as Error).message || 'Erro ao criar registro' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Atualiza uma entidade existente\r\n     */\r\n    async update(id: string, data: TUpdate): Promise<ServiceResult<TEntity>> {\r\n        // Validar dados\r\n        const validation = this.validate(this.updateSchema, data);\r\n        if (!validation.success) {\r\n            return validation as ServiceResult<TEntity>;\r\n        }\r\n\r\n        try {\r\n            // Converter para snake_case antes de enviar\r\n            const snakeCaseData = this.toSnakeCase(validation.data as Record<string, any>);\r\n\r\n            const { data: updated, error } = await orionApi\r\n                .from<TEntity>(this.tableName)\r\n                .update(snakeCaseData)\r\n                .eq('id', id)\r\n                .select('*')\r\n                .single();\r\n\r\n            if (error) {\r\n                return { success: false, error: error.message };\r\n            }\r\n\r\n            const mapped = this.toCamelCase(updated as Record<string, unknown>) as unknown as TEntity;\r\n            return { success: true, data: mapped };\r\n        } catch (error) {\r\n            console.error(`[${this.tableName}Service] update error:`, error);\r\n            return { success: false, error: error.message || 'Erro ao atualizar registro' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Remove uma entidade\r\n     */\r\n    async delete(id: string): Promise<ServiceResult<void>> {\r\n        try {\r\n            const { error } = await orionApi\r\n                .from(this.tableName)\r\n                .delete()\r\n                .eq('id', id);\r\n\r\n            if (error) {\r\n                return { success: false, error: error.message };\r\n            }\r\n\r\n            return { success: true };\r\n        } catch (error) {\r\n            console.error(`[${this.tableName}Service] delete error:`, error);\r\n            return { success: false, error: error.message || 'Erro ao excluir registro' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Busca por campo específico\r\n     */\r\n    async findBy(field: string, value: unknown): Promise<ServiceResult<TEntity[]>> {\r\n        try {\r\n            const snakeField = field.replace(/[A-Z]/g, letter => `_${letter.toLowerCase()}`);\r\n\r\n            const { data, error } = await orionApi\r\n                .from<TEntity>(this.tableName)\r\n                .select('*')\r\n                .eq(snakeField, value);\r\n\r\n            if (error) {\r\n                return { success: false, error: error.message };\r\n            }\r\n\r\n            const mapped = (data || []).map(item =>\r\n                this.toCamelCase(item as Record<string, any>) as TEntity\r\n            );\r\n\r\n            return { success: true, data: mapped };\r\n        } catch (error: any) {\r\n            console.error(`[${this.tableName}Service] findBy error:`, error);\r\n            return { success: false, error: error.message || 'Erro ao buscar registros' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Busca o primeiro registro que corresponde ao critério\r\n     */\r\n    async findOneBy(field: string, value: unknown): Promise<ServiceResult<TEntity | null>> {\r\n        try {\r\n            const snakeField = field.replace(/[A-Z]/g, letter => `_${letter.toLowerCase()}`);\r\n\r\n            const { data, error } = await orionApi\r\n                .from<TEntity>(this.tableName)\r\n                .select('*')\r\n                .eq(snakeField, value)\r\n                .maybeSingle();\r\n\r\n            if (error) {\r\n                return { success: false, error: error.message };\r\n            }\r\n\r\n            if (!data) {\r\n                return { success: true, data: null };\r\n            }\r\n\r\n            const mapped = this.toCamelCase(data as Record<string, unknown>) as unknown as TEntity;\r\n            return { success: true, data: mapped };\r\n        } catch (error) {\r\n            console.error(`[${this.tableName}Service] findOneBy error:`, error);\r\n            return { success: false, error: error.message || 'Erro ao buscar registro' };\r\n        }\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\api\\auth\\AuthService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2832,2835],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2832,2835],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3213,3216],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3213,3216],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":134,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4638,4641],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4638,4641],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":164,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5695,5698],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5695,5698],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":192,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6599,6602],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6599,6602],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":214,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7338,7341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7338,7341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Auth Service\r\n * \r\n * Service centralizado para operações de autenticação.\r\n */\r\n\r\nimport { orionApi } from '@/integrations/orion/client';\r\nimport { ServiceResult } from '../BaseApiService';\r\nimport { UserLoginSchema, type UserLogin } from '@/models/schemas';\r\nimport { z } from 'zod';\r\n\r\nexport interface AuthSession {\r\n    accessToken: string;\r\n    refreshToken?: string;\r\n    expiresIn: number;\r\n    user: AuthUser;\r\n}\r\n\r\nexport interface AuthUser {\r\n    id: string;\r\n    email: string;\r\n    name: string | null;\r\n    role: string;\r\n    image: string | null;\r\n}\r\n\r\nclass AuthService {\r\n    /**\r\n     * Valida dados com Zod\r\n     */\r\n    private validate<T>(schema: z.ZodSchema<T>, data: unknown): ServiceResult<T> {\r\n        try {\r\n            const validated = schema.parse(data);\r\n            return { success: true, data: validated };\r\n        } catch (error) {\r\n            if (error instanceof z.ZodError) {\r\n                const validationErrors: Record<string, string> = {};\r\n                error.errors.forEach(err => {\r\n                    const path = err.path.join('.');\r\n                    validationErrors[path] = err.message;\r\n                });\r\n                return { success: false, error: 'Erro de validação', validationErrors };\r\n            }\r\n            return { success: false, error: 'Erro desconhecido na validação' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Login com email e senha\r\n     */\r\n    async login(credentials: UserLogin): Promise<ServiceResult<AuthSession>> {\r\n        const validation = this.validate(UserLoginSchema, credentials);\r\n        if (!validation.success) {\r\n            return validation as ServiceResult<AuthSession>;\r\n        }\r\n\r\n        try {\r\n            const { data, error } = await orionApi.auth.signInWithPassword({\r\n                email: credentials.email,\r\n                password: credentials.password\r\n            });\r\n\r\n            if (error || !data.user || !data.session) {\r\n                return {\r\n                    success: false,\r\n                    error: error?.message || 'Credenciais inválidas'\r\n                };\r\n            }\r\n\r\n            const session: AuthSession = {\r\n                accessToken: data.session.access_token,\r\n                refreshToken: data.session.refresh_token,\r\n                expiresIn: data.session.expires_in || 3600,\r\n                user: {\r\n                    id: data.user.id,\r\n                    email: data.user.email,\r\n                    name: data.user.name || data.user.user_metadata?.name || null,\r\n                    role: data.user.role || data.user.user_metadata?.role || 'USER',\r\n                    image: data.user.image || data.user.user_metadata?.avatar_url || null\r\n                }\r\n            };\r\n\r\n            return { success: true, data: session };\r\n        } catch (error: any) {\r\n            console.error('[AuthService] login error:', error);\r\n            return { success: false, error: error.message || 'Erro no login' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Logout\r\n     */\r\n    async logout(): Promise<ServiceResult<void>> {\r\n        try {\r\n            await orionApi.auth.signOut();\r\n            return { success: true };\r\n        } catch (error: any) {\r\n            console.error('[AuthService] logout error:', error);\r\n            return { success: false, error: error.message || 'Erro no logout' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Obtém sessão atual\r\n     */\r\n    async getSession(): Promise<ServiceResult<AuthSession | null>> {\r\n        try {\r\n            const { data, error } = await orionApi.auth.getSession();\r\n\r\n            if (error) {\r\n                return { success: false, error: error.message };\r\n            }\r\n\r\n            if (!data.session) {\r\n                return { success: true, data: null };\r\n            }\r\n\r\n            const { data: userData } = await orionApi.auth.getUser();\r\n\r\n            const session: AuthSession = {\r\n                accessToken: data.session.access_token,\r\n                refreshToken: data.session.refresh_token,\r\n                expiresIn: data.session.expires_in || 3600,\r\n                user: {\r\n                    id: userData.user?.id || '',\r\n                    email: userData.user?.email || '',\r\n                    name: userData.user?.name || userData.user?.user_metadata?.name || null,\r\n                    role: userData.user?.role || userData.user?.user_metadata?.role || 'USER',\r\n                    image: userData.user?.image || userData.user?.user_metadata?.avatar_url || null\r\n                }\r\n            };\r\n\r\n            return { success: true, data: session };\r\n        } catch (error: any) {\r\n            console.error('[AuthService] getSession error:', error);\r\n            return { success: false, error: error.message || 'Erro ao buscar sessão' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Obtém usuário atual\r\n     */\r\n    async getCurrentUser(): Promise<ServiceResult<AuthUser | null>> {\r\n        try {\r\n            const { data, error } = await orionApi.auth.getUser();\r\n\r\n            if (error) {\r\n                return { success: false, error: error.message };\r\n            }\r\n\r\n            if (!data.user) {\r\n                return { success: true, data: null };\r\n            }\r\n\r\n            const user: AuthUser = {\r\n                id: data.user.id,\r\n                email: data.user.email,\r\n                name: data.user.name || data.user.user_metadata?.name || null,\r\n                role: data.user.role || data.user.user_metadata?.role || 'USER',\r\n                image: data.user.image || data.user.user_metadata?.avatar_url || null\r\n            };\r\n\r\n            return { success: true, data: user };\r\n        } catch (error: any) {\r\n            console.error('[AuthService] getCurrentUser error:', error);\r\n            return { success: false, error: error.message || 'Erro ao buscar usuário' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Verifica se está autenticado\r\n     */\r\n    async isAuthenticated(): Promise<boolean> {\r\n        const result = await this.getSession();\r\n        return result.success && result.data !== null;\r\n    }\r\n\r\n    /**\r\n     * Solicita reset de senha\r\n     */\r\n    async requestPasswordReset(email: string): Promise<ServiceResult<void>> {\r\n        try {\r\n            const { error } = await orionApi.auth.resetPasswordForEmail(email, {\r\n                redirectTo: `${window.location.origin}/auth/reset-password`\r\n            });\r\n\r\n            if (error) {\r\n                return { success: false, error: error.message };\r\n            }\r\n\r\n            return { success: true };\r\n        } catch (error: any) {\r\n            console.error('[AuthService] requestPasswordReset error:', error);\r\n            return { success: false, error: error.message || 'Erro ao solicitar reset' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Atualiza senha\r\n     */\r\n    async updatePassword(newPassword: string): Promise<ServiceResult<void>> {\r\n        if (newPassword.length < 6) {\r\n            return { success: false, error: 'Senha deve ter pelo menos 6 caracteres' };\r\n        }\r\n\r\n        try {\r\n            const { error } = await orionApi.auth.updateUser({ password: newPassword });\r\n\r\n            if (error) {\r\n                return { success: false, error: error.message };\r\n            }\r\n\r\n            return { success: true };\r\n        } catch (error: any) {\r\n            console.error('[AuthService] updatePassword error:', error);\r\n            return { success: false, error: error.message || 'Erro ao atualizar senha' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Registra listener de mudança de estado\r\n     */\r\n    onAuthStateChange(callback: (event: string, session: AuthSession | null) => void): { unsubscribe: () => void } {\r\n        const { data } = orionApi.auth.onAuthStateChange((event, session) => {\r\n            if (session) {\r\n                const authSession: AuthSession = {\r\n                    accessToken: session.access_token,\r\n                    refreshToken: session.refresh_token,\r\n                    expiresIn: session.expires_in || 3600,\r\n                    user: {\r\n                        id: session.user?.id || '',\r\n                        email: session.user?.email || '',\r\n                        name: session.user?.name || session.user?.user_metadata?.name || null,\r\n                        role: session.user?.role || session.user?.user_metadata?.role || 'USER',\r\n                        image: session.user?.image || session.user?.user_metadata?.avatar_url || null\r\n                    }\r\n                };\r\n                callback(event, authSession);\r\n            } else {\r\n                callback(event, null);\r\n            }\r\n        });\r\n\r\n        return {\r\n            unsubscribe: () => data.subscription.unsubscribe()\r\n        };\r\n    }\r\n}\r\n\r\n// Singleton instance\r\nexport const authService = new AuthService();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\api\\auth\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\api\\core\\CompanyService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CompanySchema' is defined but never used.","line":9,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":18}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Company Service\r\n * \r\n * Service para operações de empresa com validação Zod e integração com ORION API.\r\n */\r\n\r\nimport { BaseApiService } from '../BaseApiService';\r\nimport {\r\n    CompanySchema,\r\n    CreateCompanySchema,\r\n    UpdateCompanySchema,\r\n    type Company,\r\n    type CreateCompany,\r\n    type UpdateCompany\r\n} from '@/models/schemas';\r\n\r\nexport interface CompanyEntity extends Company {\r\n    id: string;\r\n    createdAt: Date;\r\n    updatedAt: Date;\r\n}\r\n\r\nclass CompanyService extends BaseApiService<CompanyEntity, CreateCompany, UpdateCompany> {\r\n    protected tableName = 'companies';\r\n    protected createSchema = CreateCompanySchema;\r\n    protected updateSchema = UpdateCompanySchema;\r\n\r\n    /**\r\n     * Busca empresa por CNPJ\r\n     */\r\n    async getByCnpj(cnpj: string) {\r\n        return this.findOneBy('cnpj', cnpj);\r\n    }\r\n\r\n    /**\r\n     * Busca empresa por Tax ID\r\n     */\r\n    async getByTaxId(taxId: string) {\r\n        return this.findOneBy('taxId', taxId);\r\n    }\r\n}\r\n\r\n// Singleton instance\r\nexport const companyService = new CompanyService();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\api\\core\\JobFunctionService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'JobFunctionSchema' is defined but never used.","line":9,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":22}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * JobFunction Service\r\n * \r\n * Service para operações de funções/cargos com validação Zod e integração com ORION API.\r\n */\r\n\r\nimport { BaseApiService, ServiceResult } from '../BaseApiService';\r\nimport {\r\n    JobFunctionSchema,\r\n    CreateJobFunctionSchema,\r\n    UpdateJobFunctionSchema,\r\n    type JobFunction,\r\n    type CreateJobFunction,\r\n    type UpdateJobFunction\r\n} from '@/models/schemas';\r\n\r\nexport interface JobFunctionEntity extends JobFunction {\r\n    id: string;\r\n    createdAt: Date;\r\n    updatedAt: Date;\r\n}\r\n\r\nclass JobFunctionService extends BaseApiService<JobFunctionEntity, CreateJobFunction, UpdateJobFunction> {\r\n    protected tableName = 'job_functions';\r\n    protected createSchema = CreateJobFunctionSchema;\r\n    protected updateSchema = UpdateJobFunctionSchema;\r\n\r\n    /**\r\n     * Busca funções que podem liderar equipe\r\n     */\r\n    async getLeaderRoles(): Promise<ServiceResult<JobFunctionEntity[]>> {\r\n        return this.findBy('canLeadTeam', true);\r\n    }\r\n\r\n    /**\r\n     * Busca por nome\r\n     */\r\n    async getByName(name: string) {\r\n        return this.findOneBy('name', name);\r\n    }\r\n}\r\n\r\n// Singleton instance\r\nexport const jobFunctionService = new JobFunctionService();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\api\\core\\UserService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'UserBaseSchema' is defined but never used.","line":10,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1831,1834],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1831,1834],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":100,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3115,3118],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3115,3118],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":113,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3519,3522],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3519,3522],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":138,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4279,4282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4279,4282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":163,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5087,5090],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5087,5090],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":183,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5774,5777],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5774,5777],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * User Service\r\n * \r\n * Service para operações de usuário com validação Zod e integração com ORION API.\r\n */\r\n\r\nimport { BaseApiService, ServiceResult } from '../BaseApiService';\r\nimport { orionApi } from '@/integrations/orion/client';\r\nimport {\r\n    UserBaseSchema,\r\n    CreateUserSchema,\r\n    UpdateUserSchema,\r\n    UserLoginSchema,\r\n    type UserBase,\r\n    type CreateUser,\r\n    type UpdateUser,\r\n    type UserLogin\r\n} from '@/models/schemas';\r\n\r\nexport interface UserEntity extends UserBase {\r\n    id: string;\r\n    createdAt: Date;\r\n    updatedAt: Date;\r\n}\r\n\r\nclass UserService extends BaseApiService<UserEntity, CreateUser, UpdateUser> {\r\n    protected tableName = 'users';\r\n    protected createSchema = CreateUserSchema;\r\n    protected updateSchema = UpdateUserSchema;\r\n\r\n    /**\r\n     * Login de usuário\r\n     */\r\n    async login(credentials: UserLogin): Promise<ServiceResult<{ user: UserEntity; token: string }>> {\r\n        const validation = this.validate(UserLoginSchema, credentials);\r\n        if (!validation.success) {\r\n            return validation as ServiceResult<{ user: UserEntity; token: string }>;\r\n        }\r\n\r\n        try {\r\n            const { data, error } = await orionApi.auth.signInWithPassword({\r\n                email: credentials.email,\r\n                password: credentials.password\r\n            });\r\n\r\n            if (error || !data.user || !data.session) {\r\n                return {\r\n                    success: false,\r\n                    error: error?.message || 'Credenciais inválidas'\r\n                };\r\n            }\r\n\r\n            return {\r\n                success: true,\r\n                data: {\r\n                    user: this.toCamelCase(data.user) as UserEntity,\r\n                    token: data.session.access_token\r\n                }\r\n            };\r\n        } catch (error: any) {\r\n            console.error('[UserService] login error:', error);\r\n            return { success: false, error: error.message || 'Erro no login' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Registro de novo usuário\r\n     */\r\n    async register(data: CreateUser): Promise<ServiceResult<UserEntity>> {\r\n        const validation = this.validate(CreateUserSchema, data);\r\n        if (!validation.success) {\r\n            return validation as ServiceResult<UserEntity>;\r\n        }\r\n\r\n        try {\r\n            const { data: result, error } = await orionApi.auth.signUp({\r\n                email: data.email,\r\n                password: data.password,\r\n                options: {\r\n                    data: {\r\n                        name: data.name,\r\n                        phone: data.phone,\r\n                        cpf: data.cpf\r\n                    }\r\n                }\r\n            });\r\n\r\n            if (error) {\r\n                return { success: false, error: error.message };\r\n            }\r\n\r\n            if (!result.user) {\r\n                return { success: false, error: 'Erro ao criar usuário' };\r\n            }\r\n\r\n            return {\r\n                success: true,\r\n                data: this.toCamelCase(result.user) as UserEntity\r\n            };\r\n        } catch (error: any) {\r\n            console.error('[UserService] register error:', error);\r\n            return { success: false, error: error.message || 'Erro no registro' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Logout do usuário atual\r\n     */\r\n    async logout(): Promise<ServiceResult<void>> {\r\n        try {\r\n            await orionApi.auth.signOut();\r\n            return { success: true };\r\n        } catch (error: any) {\r\n            console.error('[UserService] logout error:', error);\r\n            return { success: false, error: error.message || 'Erro no logout' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Obtém o usuário atual logado\r\n     */\r\n    async getCurrentUser(): Promise<ServiceResult<UserEntity | null>> {\r\n        try {\r\n            const { data, error } = await orionApi.auth.getUser();\r\n\r\n            if (error) {\r\n                return { success: false, error: error.message };\r\n            }\r\n\r\n            if (!data.user) {\r\n                return { success: true, data: null };\r\n            }\r\n\r\n            return {\r\n                success: true,\r\n                data: this.toCamelCase(data.user) as UserEntity\r\n            };\r\n        } catch (error: any) {\r\n            console.error('[UserService] getCurrentUser error:', error);\r\n            return { success: false, error: error.message || 'Erro ao buscar usuário' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Atualiza a senha do usuário\r\n     */\r\n    async updatePassword(userId: string, newPassword: string): Promise<ServiceResult<void>> {\r\n        if (newPassword.length < 6) {\r\n            return {\r\n                success: false,\r\n                error: 'Senha deve ter pelo menos 6 caracteres'\r\n            };\r\n        }\r\n\r\n        try {\r\n            const { error } = await orionApi.auth.updateUser({ password: newPassword });\r\n\r\n            if (error) {\r\n                return { success: false, error: error.message };\r\n            }\r\n\r\n            return { success: true };\r\n        } catch (error: any) {\r\n            console.error('[UserService] updatePassword error:', error);\r\n            return { success: false, error: error.message || 'Erro ao atualizar senha' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Solicita reset de senha\r\n     */\r\n    async requestPasswordReset(email: string): Promise<ServiceResult<void>> {\r\n        try {\r\n            const { error } = await orionApi.auth.resetPasswordForEmail(email, {\r\n                redirectTo: `${window.location.origin}/auth/reset-password`\r\n            });\r\n\r\n            if (error) {\r\n                return { success: false, error: error.message };\r\n            }\r\n\r\n            return { success: true };\r\n        } catch (error: any) {\r\n            console.error('[UserService] requestPasswordReset error:', error);\r\n            return { success: false, error: error.message || 'Erro ao solicitar reset de senha' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Busca usuários por empresa\r\n     */\r\n    async getByCompany(companyId: string): Promise<ServiceResult<UserEntity[]>> {\r\n        return this.findBy('companyId', companyId);\r\n    }\r\n\r\n    /**\r\n     * Busca usuários por projeto\r\n     */\r\n    async getByProject(projectId: string): Promise<ServiceResult<UserEntity[]>> {\r\n        return this.findBy('projectId', projectId);\r\n    }\r\n\r\n    /**\r\n     * Busca usuários por canteiro\r\n     */\r\n    async getBySite(siteId: string): Promise<ServiceResult<UserEntity[]>> {\r\n        return this.findBy('siteId', siteId);\r\n    }\r\n\r\n    /**\r\n     * Busca usuário por email\r\n     */\r\n    async getByEmail(email: string): Promise<ServiceResult<UserEntity | null>> {\r\n        return this.findOneBy('email', email);\r\n    }\r\n\r\n    /**\r\n     * Busca usuário por CPF\r\n     */\r\n    async getByCpf(cpf: string): Promise<ServiceResult<UserEntity | null>> {\r\n        return this.findOneBy('cpf', cpf);\r\n    }\r\n\r\n    /**\r\n     * Bloqueia/desbloqueia usuário\r\n     */\r\n    async toggleBlock(userId: string, isBlocked: boolean): Promise<ServiceResult<UserEntity>> {\r\n        return this.update(userId, { status: isBlocked ? 'BLOCKED' : 'ACTIVE' } as UpdateUser);\r\n    }\r\n}\r\n\r\n// Singleton instance\r\nexport const userService = new UserService();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\api\\core\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\api\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\api\\monitoring\\AuditLogService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1814,1817],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1814,1817],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1934,1937],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1934,1937],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2498,2501],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2498,2501],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3005,3008],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3005,3008],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":104,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3268,3271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3268,3271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3528,3531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3528,3531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":118,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3750,3753],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3750,3753],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":125,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3971,3974],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3971,3974],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * AuditLog Service\r\n * \r\n * Service para operações de log de auditoria com validação Zod e integração com ORION API.\r\n */\r\n\r\nimport { BaseApiService, ServiceResult } from '../BaseApiService';\r\nimport { orionApi } from '@/integrations/orion/client';\r\nimport {\r\n    AuditLogSchema,\r\n    type AuditLog\r\n} from '@/models/schemas';\r\n\r\nexport interface AuditLogEntity extends AuditLog {\r\n    id: string;\r\n    createdAt: Date;\r\n}\r\n\r\n// Schema para criar log (sem id e createdAt)\r\nconst CreateAuditLogSchema = AuditLogSchema.omit({ id: true, createdAt: true });\r\ntype CreateAuditLog = Omit<AuditLog, 'id' | 'createdAt'>;\r\n\r\nclass AuditLogService extends BaseApiService<AuditLogEntity, CreateAuditLog, Partial<CreateAuditLog>> {\r\n    protected tableName = 'audit_logs';\r\n    protected createSchema = CreateAuditLogSchema;\r\n    protected updateSchema = CreateAuditLogSchema.partial();\r\n\r\n    /**\r\n     * Busca logs por usuário\r\n     */\r\n    async getByUser(userId: string): Promise<ServiceResult<AuditLogEntity[]>> {\r\n        return this.findBy('userId', userId);\r\n    }\r\n\r\n    /**\r\n     * Busca logs por entidade\r\n     */\r\n    async getByEntity(entity: string, entityId?: string): Promise<ServiceResult<AuditLogEntity[]>> {\r\n        try {\r\n            let query = orionApi\r\n                .from<AuditLogEntity>(this.tableName)\r\n                .select('*')\r\n                .eq('entity', entity);\r\n\r\n            if (entityId) {\r\n                query = query.eq('entity_id', entityId);\r\n            }\r\n\r\n            const { data, error } = await query.order('created_at', { ascending: false });\r\n\r\n            if (error) {\r\n                return { success: false, error: error.message };\r\n            }\r\n\r\n            const mapped = (data || []).map(item =>\r\n                this.toCamelCase(item as Record<string, any>) as AuditLogEntity\r\n            );\r\n\r\n            return { success: true, data: mapped };\r\n        } catch (error: any) {\r\n            console.error('[AuditLogService] getByEntity error:', error);\r\n            return { success: false, error: error.message || 'Erro ao buscar logs' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Busca logs por ação\r\n     */\r\n    async getByAction(action: string): Promise<ServiceResult<AuditLogEntity[]>> {\r\n        return this.findBy('action', action);\r\n    }\r\n\r\n    /**\r\n     * Registra ação de auditoria\r\n     */\r\n    async log(\r\n        userId: string,\r\n        action: string,\r\n        entity: string,\r\n        entityId: string,\r\n        details?: any\r\n    ): Promise<ServiceResult<AuditLogEntity>> {\r\n        return this.create({\r\n            userId,\r\n            action,\r\n            entity,\r\n            entityId,\r\n            details,\r\n            ipAddress: null, // Será preenchido pelo backend se necessário\r\n            userAgent: typeof navigator !== 'undefined' ? navigator.userAgent : null\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Registra ação de criação\r\n     */\r\n    async logCreate(userId: string, entity: string, entityId: string, details?: any): Promise<ServiceResult<AuditLogEntity>> {\r\n        return this.log(userId, 'CREATE', entity, entityId, details);\r\n    }\r\n\r\n    /**\r\n     * Registra ação de atualização\r\n     */\r\n    async logUpdate(userId: string, entity: string, entityId: string, details?: any): Promise<ServiceResult<AuditLogEntity>> {\r\n        return this.log(userId, 'UPDATE', entity, entityId, details);\r\n    }\r\n\r\n    /**\r\n     * Registra ação de exclusão\r\n     */\r\n    async logDelete(userId: string, entity: string, entityId: string, details?: any): Promise<ServiceResult<AuditLogEntity>> {\r\n        return this.log(userId, 'DELETE', entity, entityId, details);\r\n    }\r\n\r\n    /**\r\n     * Registra ação de login\r\n     */\r\n    async logLogin(userId: string, details?: any): Promise<ServiceResult<AuditLogEntity>> {\r\n        return this.log(userId, 'LOGIN', 'User', userId, details);\r\n    }\r\n\r\n    /**\r\n     * Registra ação de logout\r\n     */\r\n    async logLogout(userId: string, details?: any): Promise<ServiceResult<AuditLogEntity>> {\r\n        return this.log(userId, 'LOGOUT', 'User', userId, details);\r\n    }\r\n}\r\n\r\n// Singleton instance\r\nexport const auditLogService = new AuditLogService();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\api\\monitoring\\SystemMessageService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1725,1728],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1725,1728],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1850,1853],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1850,1853],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2889,2892],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2889,2892],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * SystemMessage Service\r\n * \r\n * Service para operações de mensagens do sistema com validação Zod e integração com ORION API.\r\n */\r\n\r\nimport { BaseApiService, ServiceResult } from '../BaseApiService';\r\nimport { orionApi } from '@/integrations/orion/client';\r\nimport {\r\n    SystemMessageSchema,\r\n    CreateSystemMessageSchema,\r\n    type SystemMessage,\r\n    type CreateSystemMessage\r\n} from '@/models/schemas';\r\n\r\nexport interface SystemMessageEntity extends SystemMessage {\r\n    id: string;\r\n    createdAt: Date;\r\n}\r\n\r\nclass SystemMessageService extends BaseApiService<SystemMessageEntity, CreateSystemMessage, Partial<SystemMessage>> {\r\n    protected tableName = 'system_messages';\r\n    protected createSchema = CreateSystemMessageSchema;\r\n    protected updateSchema = SystemMessageSchema.partial();\r\n\r\n    /**\r\n     * Busca mensagens por destinatário\r\n     */\r\n    async getByRecipient(recipientId: string): Promise<ServiceResult<SystemMessageEntity[]>> {\r\n        return this.findBy('recipientId', recipientId);\r\n    }\r\n\r\n    /**\r\n     * Busca mensagens não lidas por destinatário\r\n     */\r\n    async getUnreadByRecipient(recipientId: string): Promise<ServiceResult<SystemMessageEntity[]>> {\r\n        try {\r\n            const { data, error } = await orionApi\r\n                .from<SystemMessageEntity>(this.tableName)\r\n                .select('*')\r\n                .eq('recipient_id', recipientId)\r\n                .eq('read', false)\r\n                .order('created_at', { ascending: false });\r\n\r\n            if (error) {\r\n                return { success: false, error: error.message };\r\n            }\r\n\r\n            const mapped = (data || []).map(item =>\r\n                this.toCamelCase(item as Record<string, any>) as SystemMessageEntity\r\n            );\r\n\r\n            return { success: true, data: mapped };\r\n        } catch (error: any) {\r\n            console.error('[SystemMessageService] getUnreadByRecipient error:', error);\r\n            return { success: false, error: error.message || 'Erro ao buscar mensagens' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Marca mensagem como lida\r\n     */\r\n    async markAsRead(messageId: string): Promise<ServiceResult<SystemMessageEntity>> {\r\n        return this.update(messageId, { read: true });\r\n    }\r\n\r\n    /**\r\n     * Marca todas as mensagens do usuário como lidas\r\n     */\r\n    async markAllAsRead(recipientId: string): Promise<ServiceResult<void>> {\r\n        try {\r\n            const unreadResult = await this.getUnreadByRecipient(recipientId);\r\n            if (!unreadResult.success) {\r\n                return { success: false, error: unreadResult.error };\r\n            }\r\n\r\n            // Atualizar cada mensagem individualmente\r\n            for (const message of unreadResult.data || []) {\r\n                await this.markAsRead(message.id);\r\n            }\r\n\r\n            return { success: true };\r\n        } catch (error: any) {\r\n            console.error('[SystemMessageService] markAllAsRead error:', error);\r\n            return { success: false, error: error.message || 'Erro ao marcar mensagens' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Conta mensagens não lidas\r\n     */\r\n    async countUnread(recipientId: string): Promise<ServiceResult<number>> {\r\n        const result = await this.getUnreadByRecipient(recipientId);\r\n        if (!result.success) {\r\n            return { success: false, error: result.error };\r\n        }\r\n        return { success: true, data: result.data?.length || 0 };\r\n    }\r\n\r\n    /**\r\n     * Envia mensagem para usuário\r\n     */\r\n    async sendMessage(\r\n        recipientId: string,\r\n        title: string,\r\n        content: string,\r\n        type: 'info' | 'warning' | 'alert' | 'success' = 'info'\r\n    ): Promise<ServiceResult<SystemMessageEntity>> {\r\n        return this.create({\r\n            recipientId,\r\n            title,\r\n            content,\r\n            type\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Envia alerta/notificação\r\n     */\r\n    async sendAlert(recipientId: string, title: string, content: string): Promise<ServiceResult<SystemMessageEntity>> {\r\n        return this.sendMessage(recipientId, title, content, 'alert');\r\n    }\r\n}\r\n\r\n// Singleton instance\r\nexport const systemMessageService = new SystemMessageService();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\api\\monitoring\\TimeRecordService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TimeRecordSchema' is defined but never used.","line":10,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2099,2102],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2099,2102],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2221,2224],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2221,2224],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":120,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4041,4044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4041,4044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":122,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4146,4149],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4146,4149],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * TimeRecord Service\r\n * \r\n * Service para operações de registro de ponto com validação Zod e integração com ORION API.\r\n */\r\n\r\nimport { BaseApiService, ServiceResult } from '../BaseApiService';\r\nimport { orionApi } from '@/integrations/orion/client';\r\nimport {\r\n    TimeRecordSchema,\r\n    CreateTimeRecordSchema,\r\n    type TimeRecord,\r\n    type CreateTimeRecord\r\n} from '@/models/schemas';\r\n\r\nexport interface TimeRecordEntity extends TimeRecord {\r\n    id: string;\r\n    createdAt: Date;\r\n    // Campos adicionais para exibição\r\n    userName?: string;\r\n    userPhoto?: string;\r\n}\r\n\r\nclass TimeRecordService extends BaseApiService<TimeRecordEntity, CreateTimeRecord, Partial<CreateTimeRecord>> {\r\n    protected tableName = 'time_records';\r\n    protected createSchema = CreateTimeRecordSchema;\r\n    protected updateSchema = CreateTimeRecordSchema.partial();\r\n\r\n    /**\r\n     * Busca registros por usuário\r\n     */\r\n    async getByUser(userId: string): Promise<ServiceResult<TimeRecordEntity[]>> {\r\n        return this.findBy('userId', userId);\r\n    }\r\n\r\n    /**\r\n     * Busca registros de hoje por usuário\r\n     */\r\n    async getTodayByUser(userId: string): Promise<ServiceResult<TimeRecordEntity[]>> {\r\n        try {\r\n            const today = new Date();\r\n            today.setHours(0, 0, 0, 0);\r\n            const tomorrow = new Date(today);\r\n            tomorrow.setDate(tomorrow.getDate() + 1);\r\n\r\n            const { data, error } = await orionApi\r\n                .from<TimeRecordEntity>(this.tableName)\r\n                .select('*')\r\n                .eq('user_id', userId);\r\n\r\n            if (error) {\r\n                return { success: false, error: error.message };\r\n            }\r\n\r\n            // Filtrar por data no frontend (backend pode não suportar gte/lte)\r\n            const filtered = (data || []).filter(record => {\r\n                const recordDate = new Date(record.timestamp);\r\n                return recordDate >= today && recordDate < tomorrow;\r\n            });\r\n\r\n            const mapped = filtered.map(item =>\r\n                this.toCamelCase(item as Record<string, any>) as TimeRecordEntity\r\n            );\r\n\r\n            return { success: true, data: mapped };\r\n        } catch (error: any) {\r\n            console.error('[TimeRecordService] getTodayByUser error:', error);\r\n            return { success: false, error: error.message || 'Erro ao buscar registros' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Registra entrada\r\n     */\r\n    async registerEntry(userId: string, location?: { latitude: number; longitude: number }, photoUrl?: string): Promise<ServiceResult<TimeRecordEntity>> {\r\n        return this.create({\r\n            userId,\r\n            type: 'entry',\r\n            timestamp: new Date(),\r\n            latitude: location?.latitude,\r\n            longitude: location?.longitude,\r\n            photoUrl\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Registra saída\r\n     */\r\n    async registerExit(userId: string, location?: { latitude: number; longitude: number }, photoUrl?: string): Promise<ServiceResult<TimeRecordEntity>> {\r\n        return this.create({\r\n            userId,\r\n            type: 'exit',\r\n            timestamp: new Date(),\r\n            latitude: location?.latitude,\r\n            longitude: location?.longitude,\r\n            photoUrl\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Busca último registro do usuário\r\n     */\r\n    async getLastRecord(userId: string): Promise<ServiceResult<TimeRecordEntity | null>> {\r\n        try {\r\n            const { data, error } = await orionApi\r\n                .from<TimeRecordEntity>(this.tableName)\r\n                .select('*')\r\n                .eq('user_id', userId)\r\n                .order('timestamp', { ascending: false })\r\n                .limit(1);\r\n\r\n            if (error) {\r\n                return { success: false, error: error.message };\r\n            }\r\n\r\n            if (!data || data.length === 0) {\r\n                return { success: true, data: null };\r\n            }\r\n\r\n            const mapped = this.toCamelCase(data[0] as Record<string, any>) as TimeRecordEntity;\r\n            return { success: true, data: mapped };\r\n        } catch (error: any) {\r\n            console.error('[TimeRecordService] getLastRecord error:', error);\r\n            return { success: false, error: error.message || 'Erro ao buscar último registro' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Verifica se usuário já registrou entrada hoje\r\n     */\r\n    async hasEntryToday(userId: string): Promise<ServiceResult<boolean>> {\r\n        const result = await this.getTodayByUser(userId);\r\n        if (!result.success) {\r\n            return { success: false, error: result.error };\r\n        }\r\n\r\n        const hasEntry = (result.data || []).some(record =>\r\n            record.type.toLowerCase() === 'entry'\r\n        );\r\n\r\n        return { success: true, data: hasEntry };\r\n    }\r\n\r\n    /**\r\n     * Verifica se usuário já registrou saída hoje\r\n     */\r\n    async hasExitToday(userId: string): Promise<ServiceResult<boolean>> {\r\n        const result = await this.getTodayByUser(userId);\r\n        if (!result.success) {\r\n            return { success: false, error: result.error };\r\n        }\r\n\r\n        const hasExit = (result.data || []).some(record =>\r\n            record.type.toLowerCase() === 'exit'\r\n        );\r\n\r\n        return { success: true, data: hasExit };\r\n    }\r\n}\r\n\r\n// Singleton instance\r\nexport const timeRecordService = new TimeRecordService();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\api\\monitoring\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\api\\project\\DailyReportService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'DailyReportSchema' is defined but never used.","line":9,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":22}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * DailyReport Service\r\n * \r\n * Service para operações de relatório diário com validação Zod e integração com ORION API.\r\n */\r\n\r\nimport { BaseApiService, ServiceResult } from '../BaseApiService';\r\nimport {\r\n    DailyReportSchema,\r\n    CreateDailyReportSchema,\r\n    type DailyReport,\r\n    type CreateDailyReport\r\n} from '@/models/schemas';\r\n\r\nexport interface DailyReportEntity extends DailyReport {\r\n    id: string;\r\n    createdAt: Date;\r\n}\r\n\r\nclass DailyReportService extends BaseApiService<DailyReportEntity, CreateDailyReport, Partial<CreateDailyReport>> {\r\n    protected tableName = 'daily_reports';\r\n    protected createSchema = CreateDailyReportSchema;\r\n    protected updateSchema = CreateDailyReportSchema.partial();\r\n\r\n    /**\r\n     * Busca relatórios por equipe\r\n     */\r\n    async getByTeam(teamId: string): Promise<ServiceResult<DailyReportEntity[]>> {\r\n        return this.findBy('teamId', teamId);\r\n    }\r\n\r\n    /**\r\n     * Busca relatórios por projeto\r\n     */\r\n    async getByProject(projectId: string): Promise<ServiceResult<DailyReportEntity[]>> {\r\n        return this.findBy('projectId', projectId);\r\n    }\r\n\r\n    /**\r\n     * Busca relatórios por criador\r\n     */\r\n    async getByCreator(createdById: string): Promise<ServiceResult<DailyReportEntity[]>> {\r\n        return this.findBy('createdById', createdById);\r\n    }\r\n\r\n    /**\r\n     * Busca relatórios de hoje\r\n     */\r\n    async getToday(): Promise<ServiceResult<DailyReportEntity[]>> {\r\n        const today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n        return this.findBy('date', today.toISOString().split('T')[0]);\r\n    }\r\n\r\n    /**\r\n     * Busca relatórios por data\r\n     */\r\n    async getByDate(date: Date): Promise<ServiceResult<DailyReportEntity[]>> {\r\n        return this.findBy('date', date.toISOString().split('T')[0]);\r\n    }\r\n}\r\n\r\n// Singleton instance\r\nexport const dailyReportService = new DailyReportService();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\api\\project\\ProjectService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ProjectSchema' is defined but never used.","line":9,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":18}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Project Service\r\n * \r\n * Service para operações de projeto com validação Zod e integração com ORION API.\r\n */\r\n\r\nimport { BaseApiService, ServiceResult } from '../BaseApiService';\r\nimport {\r\n    ProjectSchema,\r\n    CreateProjectSchema,\r\n    UpdateProjectSchema,\r\n    type Project,\r\n    type CreateProject,\r\n    type UpdateProject\r\n} from '@/models/schemas';\r\n\r\nexport interface ProjectEntity extends Project {\r\n    id: string;\r\n    createdAt: Date;\r\n    updatedAt: Date;\r\n}\r\n\r\nclass ProjectService extends BaseApiService<ProjectEntity, CreateProject, UpdateProject> {\r\n    protected tableName = 'projects';\r\n    protected createSchema = CreateProjectSchema;\r\n    protected updateSchema = UpdateProjectSchema;\r\n\r\n    /**\r\n     * Busca projetos por empresa\r\n     */\r\n    async getByCompany(companyId: string): Promise<ServiceResult<ProjectEntity[]>> {\r\n        return this.findBy('companyId', companyId);\r\n    }\r\n\r\n    /**\r\n     * Busca projetos ativos\r\n     */\r\n    async getActive(): Promise<ServiceResult<ProjectEntity[]>> {\r\n        return this.findBy('status', 'IN_PROGRESS');\r\n    }\r\n\r\n    /**\r\n     * Busca projetos por status\r\n     */\r\n    async getByStatus(status: string): Promise<ServiceResult<ProjectEntity[]>> {\r\n        return this.findBy('status', status);\r\n    }\r\n}\r\n\r\n// Singleton instance\r\nexport const projectService = new ProjectService();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\api\\project\\SiteService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'SiteSchema' is defined but never used.","line":9,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Site Service\r\n * \r\n * Service para operações de canteiro com validação Zod e integração com ORION API.\r\n */\r\n\r\nimport { BaseApiService, ServiceResult } from '../BaseApiService';\r\nimport {\r\n    SiteSchema,\r\n    CreateSiteSchema,\r\n    UpdateSiteSchema,\r\n    type Site,\r\n    type CreateSite,\r\n    type UpdateSite\r\n} from '@/models/schemas';\r\n\r\nexport interface SiteEntity extends Site {\r\n    id: string;\r\n    createdAt: Date;\r\n    updatedAt: Date;\r\n}\r\n\r\nclass SiteService extends BaseApiService<SiteEntity, CreateSite, UpdateSite> {\r\n    protected tableName = 'sites';\r\n    protected createSchema = CreateSiteSchema;\r\n    protected updateSchema = UpdateSiteSchema;\r\n\r\n    /**\r\n     * Busca canteiros por projeto\r\n     */\r\n    async getByProject(projectId: string): Promise<ServiceResult<SiteEntity[]>> {\r\n        return this.findBy('projectId', projectId);\r\n    }\r\n}\r\n\r\n// Singleton instance\r\nexport const siteService = new SiteService();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\api\\project\\TeamService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TeamSchema' is defined but never used.","line":10,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2213,2216],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2213,2216],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2504,2507],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2504,2507],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":88,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2565,2568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2565,2568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3274,3277],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3274,3277],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":131,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4005,4008],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4005,4008],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":135,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4121,4124],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4121,4124],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Team Service\r\n * \r\n * Service para operações de equipe com validação Zod e integração com ORION API.\r\n */\r\n\r\nimport { BaseApiService, ServiceResult } from '../BaseApiService';\r\nimport { orionApi } from '@/integrations/orion/client';\r\nimport {\r\n    TeamSchema,\r\n    CreateTeamSchema,\r\n    UpdateTeamSchema,\r\n    TeamMemberSchema,\r\n    type Team,\r\n    type CreateTeam,\r\n    type UpdateTeam,\r\n    type TeamMember\r\n} from '@/models/schemas';\r\n\r\nexport interface TeamEntity extends Team {\r\n    id: string;\r\n    createdAt: Date;\r\n    updatedAt: Date;\r\n    members?: TeamMember[];\r\n}\r\n\r\nclass TeamService extends BaseApiService<TeamEntity, CreateTeam, UpdateTeam> {\r\n    protected tableName = 'teams';\r\n    protected createSchema = CreateTeamSchema;\r\n    protected updateSchema = UpdateTeamSchema;\r\n\r\n    /**\r\n     * Busca equipes por supervisor\r\n     */\r\n    async getBySupervisor(supervisorId: string): Promise<ServiceResult<TeamEntity[]>> {\r\n        return this.findBy('supervisorId', supervisorId);\r\n    }\r\n\r\n    /**\r\n     * Busca equipes por projeto\r\n     */\r\n    async getByProject(projectId: string): Promise<ServiceResult<TeamEntity[]>> {\r\n        return this.findBy('projectId', projectId);\r\n    }\r\n\r\n    /**\r\n     * Busca equipes por canteiro\r\n     */\r\n    async getBySite(siteId: string): Promise<ServiceResult<TeamEntity[]>> {\r\n        return this.findBy('siteId', siteId);\r\n    }\r\n\r\n    /**\r\n     * Busca equipes ativas\r\n     */\r\n    async getActive(): Promise<ServiceResult<TeamEntity[]>> {\r\n        return this.findBy('active', true);\r\n    }\r\n\r\n    /**\r\n     * Adiciona membro à equipe\r\n     */\r\n    async addMember(teamId: string, userId: string, role?: string): Promise<ServiceResult<TeamMember>> {\r\n        try {\r\n            const validation = this.validate(TeamMemberSchema, { teamId, userId, role });\r\n            if (!validation.success) {\r\n                return validation as ServiceResult<TeamMember>;\r\n            }\r\n\r\n            const { data, error } = await orionApi\r\n                .from<TeamMember>('team_members')\r\n                .insert({\r\n                    team_id: teamId,\r\n                    user_id: userId,\r\n                    role: role || null\r\n                } as any)\r\n                .select('*')\r\n                .single();\r\n\r\n            if (error) {\r\n                return { success: false, error: error.message };\r\n            }\r\n\r\n            return {\r\n                success: true,\r\n                data: this.toCamelCase(data as Record<string, any>) as TeamMember\r\n            };\r\n        } catch (error: any) {\r\n            console.error('[TeamService] addMember error:', error);\r\n            return { success: false, error: error.message || 'Erro ao adicionar membro' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Remove membro da equipe\r\n     */\r\n    async removeMember(teamId: string, userId: string): Promise<ServiceResult<void>> {\r\n        try {\r\n            const { error } = await orionApi\r\n                .from('team_members')\r\n                .delete()\r\n                .eq('team_id', teamId)\r\n                .eq('user_id', userId);\r\n\r\n            if (error) {\r\n                return { success: false, error: error.message };\r\n            }\r\n\r\n            return { success: true };\r\n        } catch (error: any) {\r\n            console.error('[TeamService] removeMember error:', error);\r\n            return { success: false, error: error.message || 'Erro ao remover membro' };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Busca membros de uma equipe\r\n     */\r\n    async getMembers(teamId: string): Promise<ServiceResult<TeamMember[]>> {\r\n        try {\r\n            const { data, error } = await orionApi\r\n                .from<TeamMember>('team_members')\r\n                .select('*')\r\n                .eq('team_id', teamId);\r\n\r\n            if (error) {\r\n                return { success: false, error: error.message };\r\n            }\r\n\r\n            const mapped = (data || []).map(item =>\r\n                this.toCamelCase(item as Record<string, any>) as TeamMember\r\n            );\r\n\r\n            return { success: true, data: mapped };\r\n        } catch (error: any) {\r\n            console.error('[TeamService] getMembers error:', error);\r\n            return { success: false, error: error.message || 'Erro ao buscar membros' };\r\n        }\r\n    }\r\n}\r\n\r\n// Singleton instance\r\nexport const teamService = new TeamService();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\api\\project\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\cable-layer.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TowerPhysics' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CableAnchorConfig' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[716,719],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[716,719],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[742,745],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[742,745],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[824,827],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[824,827],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[866,869],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[866,869],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[911,914],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[911,914],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1036,1039],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1036,1039],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1072,1075],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1072,1075],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":63,"column":42,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":63,"endColumn":43,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2188,2189],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2188,2188],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3989,3992],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3989,3992],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":105,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4441,4444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4441,4444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":117,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5196,5199],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5196,5199],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":160,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7628,7631],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7628,7631],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":163,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7710,7713],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7710,7713],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":163,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7734,7737],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7734,7737],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":179,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8619,8622],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8619,8622],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":219,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":219,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10706,10709],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10706,10709],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":219,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":219,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10732,10735],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10732,10735],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":229,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11332,11335],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11332,11335],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":20,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { CatenaryCalculator } from './catenary-calculator';\r\nimport { TowerPhysics } from './tower-physics';\r\nimport { CableAnchorConfig, CableSettings, ModelTransform } from '../components/map/cable-config-modal';\r\nimport { TowerAnchorService } from './tower-anchor-service';\r\n\r\nexport interface CablePath {\r\n    path: [number, number, number][];\r\n    color: string;\r\n    width: number;\r\n    id: string;\r\n    isTerminalAtTarget?: boolean;\r\n    sourceIsDerivation?: boolean;\r\n    towerStartId: string;\r\n    towerEndId: string;\r\n    towerStartName?: string;\r\n    towerEndName?: string;\r\n    projectId?: string;\r\n    sourceType: 'manual' | 'auto_generated';\r\n}\r\n\r\nexport interface CableGeneratorOptions {\r\n    towers: any[];\r\n    projectSpans: any[];\r\n    cableSettings: CableSettings;\r\n    placemarkOverrides: Record<string, any>;\r\n    projectAnchors: Record<string, any[]>;\r\n    templateAnchors: Record<string, any[]>;\r\n    hiddenSpans: Set<string>;\r\n    hiddenPlacemarkIds: Set<string>;\r\n    projectId?: string;\r\n    getNumericId: (p: any) => number;\r\n    getLocKey: (t: any) => string;\r\n    localModelUrl: string;\r\n    getEffectiveTransform: (individual: ModelTransform | undefined, url: string) => ModelTransform | undefined;\r\n    disableAutoGeneration?: boolean;\r\n}\r\n\r\nexport const CableLayerService = {\r\n    generateCables: (options: CableGeneratorOptions): CablePath[] => {\r\n        const {\r\n            towers,\r\n            projectSpans,\r\n            cableSettings,\r\n            placemarkOverrides,\r\n            hiddenSpans,\r\n            hiddenPlacemarkIds,\r\n            projectId,\r\n            getNumericId,\r\n            getLocKey,\r\n            localModelUrl,\r\n            getEffectiveTransform,\r\n            projectAnchors,\r\n            templateAnchors\r\n        } = options;\r\n\r\n        const paths: CablePath[] = [];\r\n        const processedSpanIdsFromManual = new Set<string>();\r\n        const enabledAnchors = cableSettings.anchors.filter(a => a.enabled);\r\n\r\n        const normalizeName = (name: string) => (name || '').trim().toUpperCase();\r\n        const getSiteCore = (name: string) => {\r\n            const n = normalizeName(name);\r\n            const match = n.match(/^(\\d+[\\/-]\\d+)/);\r\n            return match ? match[1] : n;\r\n        };\r\n\r\n        // 1. Process Manual Spans (Priority)\r\n        if (projectSpans && projectSpans.length > 0) {\r\n            projectSpans.forEach((span) => {\r\n                let src = towers.find(p => p.id === span.tower_start_id);\r\n                if (!src) src = towers.find(p => getSiteCore(p.name) === getSiteCore(span.tower_start_id));\r\n\r\n                let tgt = towers.find(p => p.id === span.tower_end_id);\r\n                if (!tgt) tgt = towers.find(p => getSiteCore(p.name) === getSiteCore(span.tower_end_id));\r\n\r\n                if (src && tgt) {\r\n                    const n1 = normalizeName(src.name);\r\n                    const n2 = normalizeName(tgt.name);\r\n                    const spanKeyAB = `${n1}:::${n2}`;\r\n                    const spanKeyBA = `${n2}:::${n1}`;\r\n                    const tProjId = span.project_id || projectId || 'default';\r\n\r\n                    // Ocultação Baseada em Nomes (KMZ/Virtual) ou ID (Persistente)\r\n                    if (hiddenSpans.has(spanKeyAB) || hiddenSpans.has(spanKeyBA) ||\r\n                        (tProjId && (\r\n                            hiddenPlacemarkIds.has(`${tProjId}:::${spanKeyAB}`) ||\r\n                            hiddenPlacemarkIds.has(`${tProjId}:::${spanKeyBA}`) ||\r\n                            hiddenPlacemarkIds.has(`${tProjId}:::${span.id}`)\r\n                        ))) {\r\n                        return;\r\n                    }\r\n\r\n                    const logicalPairKey = [n1, n2].sort().join(':::');\r\n                    processedSpanIdsFromManual.add(logicalPairKey);\r\n\r\n                    enabledAnchors.forEach((config) => {\r\n                        // Data-Driven Filtering (Professional V1):\r\n                        const spanConductors = (span as any)._conductors;\r\n\r\n                        if (spanConductors && Array.isArray(spanConductors)) {\r\n                            // Normalize phase helper\r\n                            const normalizePhase = (p: string) => (p || '').toUpperCase().replace(/FASE|PHASE|\\s/g, '');\r\n                            const anchorP = normalizePhase(config.phase || config.label);\r\n\r\n                            const hasPhysicalConductor = spanConductors.some((c: any) => {\r\n                                const condP = normalizePhase(c.phase);\r\n                                const phaseMatch = condP === anchorP || (config.phase && condP === normalizePhase(config.phase));\r\n                                const circuitMatch = !c.circuitId || !config.circuitId || c.circuitId.toUpperCase() === config.circuitId.toUpperCase();\r\n                                return phaseMatch && circuitMatch;\r\n                            });\r\n\r\n                            if (!hasPhysicalConductor) {\r\n                                return;\r\n                            }\r\n                        } else {\r\n                            // Fallback Logic (Legacy Spans):\r\n                            const towerCircuits = (src as any).allCircuits || (src.circuitId ? [src.circuitId] : []);\r\n                            if (config.circuitId && towerCircuits.length > 0) {\r\n                                const hasMatch = towerCircuits.some((c: string) => c.toUpperCase() === config.circuitId?.toUpperCase());\r\n                                if (!hasMatch) return;\r\n                            }\r\n                        }\r\n\r\n                        try {\r\n                            const startPoint = TowerAnchorService.getAnchor({\r\n                                tower: src!, config, role: 'vante',\r\n                                placemarkOverrides, cableSettings, projectAnchors, templateAnchors,\r\n                                localModelUrl, getEffectiveTransform\r\n                            });\r\n                            const endPoint = TowerAnchorService.getAnchor({\r\n                                tower: tgt!, config, role: 're',\r\n                                placemarkOverrides, cableSettings, projectAnchors, templateAnchors,\r\n                                localModelUrl, getEffectiveTransform\r\n                            });\r\n                            const points = CatenaryCalculator.generateCatenaryPoints(startPoint, endPoint, cableSettings.tension, 60);\r\n\r\n                            paths.push({\r\n                                path: points.map(p => [p.x, p.y, p.z]),\r\n                                color: config.color,\r\n                                width: config.width,\r\n                                id: `manual-${span.id}-${config.id}`,\r\n                                towerStartId: src!.id,\r\n                                towerEndId: tgt!.id,\r\n                                towerStartName: src!.name,\r\n                                towerEndName: tgt!.name,\r\n                                projectId: span.project_id || projectId,\r\n                                sourceType: 'manual'\r\n                            });\r\n                        } catch (err) {\r\n                            console.error(`❌ Erro ao gerar âncora para vão manual ${span.id}:`, err);\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n        // 2. Linear Graph Auto-Generation (KMZ Style)\r\n        if (projectSpans.length === 0 && !options.disableAutoGeneration) {\r\n            const autoProcessedPairs = new Set<string>();\r\n            const towersByProj = new Map<string, any[]>();\r\n\r\n            towers.forEach(t => {\r\n                const pid = (t as any).projectId || (t as any).document_id || 'default';\r\n                if (!towersByProj.has(pid)) towersByProj.set(pid, []);\r\n                towersByProj.get(pid)?.push(t);\r\n            });\r\n\r\n            const getDistMeters = (lat1: number, lon1: number, lat2: number, lon2: number) => {\r\n                const R = 6371e3;\r\n                const phi1 = lat1 * Math.PI / 180;\r\n                const phi2 = lat2 * Math.PI / 180;\r\n                const dPhi = (lat2 - lat1) * Math.PI / 180;\r\n                const dLambda = (lon2 - lon1) * Math.PI / 180;\r\n                const a = Math.sin(dPhi / 2) * Math.sin(dPhi / 2) + Math.cos(phi1) * Math.cos(phi2) * Math.sin(dLambda / 2) * Math.sin(dLambda / 2);\r\n                return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n            };\r\n\r\n            towersByProj.forEach((projectTowers, pid) => {\r\n                const siteMap = new Map<string, any[]>();\r\n                projectTowers.forEach(t => {\r\n                    const key = getLocKey(t);\r\n                    if (!siteMap.has(key)) siteMap.set(key, []);\r\n                    siteMap.get(key)?.push(t);\r\n                });\r\n\r\n                const sortedSites = Array.from(siteMap.values())\r\n                    .map(tws => {\r\n                        const numericIds = tws.map(t => getNumericId(t)).filter(n => n !== undefined && !isNaN(n));\r\n                        const minSeq = numericIds.length > 0 ? Math.min(...numericIds) : 0;\r\n                        return { towers: tws, minSeq };\r\n                    })\r\n                    .sort((a, b) => a.minSeq - b.minSeq);\r\n\r\n                for (let i = 0; i < sortedSites.length - 1; i++) {\r\n                    const siteA = sortedSites[i];\r\n                    const siteB = sortedSites[i + 1];\r\n\r\n                    const dist = getDistMeters(\r\n                        siteA.towers[0].coordinates.lat, siteA.towers[0].coordinates.lng,\r\n                        siteB.towers[0].coordinates.lat, siteB.towers[0].coordinates.lng\r\n                    );\r\n                    if (dist > 2500) continue;\r\n\r\n                    const srcSiblings = [...siteA.towers].sort((a, b) => (a.name || '').localeCompare(b.name || ''));\r\n                    const tgtSiblings = [...siteB.towers].sort((a, b) => (a.name || '').localeCompare(b.name || ''));\r\n                    const linkCount = Math.min(srcSiblings.length, tgtSiblings.length);\r\n\r\n                    for (let k = 0; k < linkCount; k++) {\r\n                        const src = srcSiblings[k];\r\n                        const tgt = tgtSiblings[k];\r\n\r\n                        const n1 = normalizeName(src.name);\r\n                        const n2 = normalizeName(tgt.name);\r\n                        const logicalPairKey = [n1, n2].sort().join(':::');\r\n\r\n                        if (autoProcessedPairs.has(logicalPairKey)) continue;\r\n                        if (processedSpanIdsFromManual.has(logicalPairKey)) continue;\r\n\r\n                        const tProjId = (src as any).projectId || (src as any).document_id || pid;\r\n                        const spanKeyAB = `${n1}:::${n2}`;\r\n                        const spanKeyBA = `${n2}:::${n1}`;\r\n                        if (hiddenSpans.has(spanKeyAB) || hiddenSpans.has(spanKeyBA) ||\r\n                            hiddenPlacemarkIds.has(`${tProjId}:::${spanKeyAB}`) ||\r\n                            hiddenPlacemarkIds.has(`${tProjId}:::${spanKeyBA}`)) continue;\r\n\r\n                        autoProcessedPairs.add(logicalPairKey);\r\n\r\n                        enabledAnchors.forEach((config) => {\r\n                            const towerCircuits = (src as any).allCircuits || (src.circuitId ? [src.circuitId] : []);\r\n                            if (config.circuitId && towerCircuits.length > 0) {\r\n                                const hasMatch = towerCircuits.some((c: string) => c.toUpperCase() === config.circuitId?.toUpperCase());\r\n                                if (!hasMatch) return;\r\n                            }\r\n\r\n                            try {\r\n                                const startAnchor = TowerAnchorService.getAnchor({\r\n                                    tower: src, config, role: 'vante',\r\n                                    placemarkOverrides, cableSettings, projectAnchors, templateAnchors,\r\n                                    localModelUrl, getEffectiveTransform\r\n                                });\r\n                                const endAnchor = TowerAnchorService.getAnchor({\r\n                                    tower: tgt, config, role: 're',\r\n                                    placemarkOverrides, cableSettings, projectAnchors, templateAnchors,\r\n                                    localModelUrl, getEffectiveTransform\r\n                                });\r\n                                const points = CatenaryCalculator.generateCatenaryPoints(startAnchor, endAnchor, cableSettings.tension, 60);\r\n\r\n                                paths.push({\r\n                                    path: points.map(p => [p.x, p.y, p.z]),\r\n                                    color: config.color,\r\n                                    width: config.width,\r\n                                    id: `auto-${logicalPairKey}-${config.id}`,\r\n                                    towerStartId: src.id,\r\n                                    towerEndId: tgt.id,\r\n                                    towerStartName: src.name,\r\n                                    towerEndName: tgt.name,\r\n                                    projectId: tProjId,\r\n                                    sourceType: 'auto_generated'\r\n                                });\r\n                            } catch (err) {\r\n                                console.error(`❌ Error generating auto cable for ${logicalPairKey}:`, err);\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        console.log(`✅ [CableLayerService] Total CablePaths generated: ${paths.length}`);\r\n        return paths;\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\cacheService.ts","messages":[{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":152,"column":37,"nodeType":"BlockStatement","messageId":"unexpected","endLine":153,"endColumn":14,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4495,4509],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db, CacheMetadata, CACHE_TTL, CacheableEntity } from './db';\r\n\r\n/**\r\n * CacheService - Serviço de cache estruturado com TTL\r\n * \r\n * Gerencia cache de dados por entidade com:\r\n * - TTL (Time to Live) configurável por entidade\r\n * - Verificação automática de expiração\r\n * - Metadados de cache persistentes\r\n * - Invalidação por versão\r\n */\r\nclass CacheService {\r\n    private cacheVersion = 1;\r\n\r\n    /**\r\n     * Gera a chave de cache para uma entidade\r\n     */\r\n    private getCacheKey(entity: CacheableEntity): string {\r\n        return `cache:${entity}`;\r\n    }\r\n\r\n    /**\r\n     * Salva dados no cache com TTL\r\n     */\r\n    async set<T>(entity: CacheableEntity, data: T[], customTtl?: number): Promise<void> {\r\n        const key = this.getCacheKey(entity);\r\n        const now = Date.now();\r\n        const ttl = customTtl ?? CACHE_TTL[entity];\r\n\r\n        try {\r\n            // Salvar dados no storage\r\n            await db.storage.put({\r\n                key,\r\n                value: data,\r\n                updatedAt: now\r\n            });\r\n\r\n            // Salvar metadados do cache\r\n            const metadata: CacheMetadata = {\r\n                key,\r\n                tableName: entity,\r\n                createdAt: now,\r\n                expiresAt: now + ttl,\r\n                recordCount: Array.isArray(data) ? data.length : 1,\r\n                version: this.cacheVersion\r\n            };\r\n\r\n            await db.cacheKeys.put(metadata);\r\n\r\n        } catch (error) {\r\n            console.error(`[CacheService] Error caching ${entity}:`, error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Recupera dados do cache se não expirado\r\n     */\r\n    async get<T>(entity: CacheableEntity): Promise<T[] | null> {\r\n        const key = this.getCacheKey(entity);\r\n\r\n        try {\r\n            const metadata = await db.cacheKeys.get(key);\r\n\r\n            // Verificar se cache existe e não expirou\r\n            if (!metadata) {\r\n                return null;\r\n            }\r\n\r\n            if (Date.now() > metadata.expiresAt) {\r\n                await this.invalidate(entity);\r\n                return null;\r\n            }\r\n\r\n            // Verificar versão do cache\r\n            if (metadata.version !== this.cacheVersion) {\r\n                await this.invalidate(entity);\r\n                return null;\r\n            }\r\n\r\n            const cached = await db.storage.get(key);\r\n            if (!cached) {\r\n                return null;\r\n            }\r\n\r\n            return cached.value as T[];\r\n        } catch (error) {\r\n            console.error(`[CacheService] Error reading cache for ${entity}:`, error);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Verifica se o cache é válido (existe e não expirou)\r\n     */\r\n    async isValid(entity: CacheableEntity): Promise<boolean> {\r\n        const key = this.getCacheKey(entity);\r\n\r\n        try {\r\n            const metadata = await db.cacheKeys.get(key);\r\n\r\n            if (!metadata) return false;\r\n            if (Date.now() > metadata.expiresAt) return false;\r\n            if (metadata.version !== this.cacheVersion) return false;\r\n\r\n            return true;\r\n        } catch {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Retorna metadados do cache de uma entidade\r\n     */\r\n    async getMetadata(entity: CacheableEntity): Promise<CacheMetadata | null> {\r\n        const key = this.getCacheKey(entity);\r\n        try {\r\n            const metadata = await db.cacheKeys.get(key);\r\n            return metadata ?? null;\r\n        } catch {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Invalida o cache de uma ou mais entidades\r\n     */\r\n    async invalidate(...entities: CacheableEntity[]): Promise<void> {\r\n        try {\r\n            for (const entity of entities) {\r\n                const key = this.getCacheKey(entity);\r\n                await db.storage.delete(key);\r\n                await db.cacheKeys.delete(key);\r\n            }\r\n        } catch (error) {\r\n            console.error('[CacheService] Error invalidating cache:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Invalida todos os caches expirados\r\n     */\r\n    async cleanExpired(): Promise<number> {\r\n        try {\r\n            const now = Date.now();\r\n            const expired = await db.cacheKeys.where('expiresAt').below(now).toArray();\r\n\r\n            for (const meta of expired) {\r\n                await db.storage.delete(meta.key);\r\n                await db.cacheKeys.delete(meta.key);\r\n            }\r\n\r\n            if (expired.length > 0) {\r\n            }\r\n\r\n            return expired.length;\r\n        } catch (error) {\r\n            console.error('[CacheService] Error cleaning expired caches:', error);\r\n            return 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Lista todos os caches ativos com status\r\n     */\r\n    async getStatus(): Promise<{\r\n        entity: string;\r\n        recordCount: number;\r\n        expiresIn: number;\r\n        isExpired: boolean;\r\n    }[]> {\r\n        try {\r\n            const allMeta = await db.cacheKeys.toArray();\r\n            const now = Date.now();\r\n\r\n            return allMeta.map(meta => ({\r\n                entity: meta.tableName,\r\n                recordCount: meta.recordCount,\r\n                expiresIn: Math.max(0, meta.expiresAt - now),\r\n                isExpired: now > meta.expiresAt\r\n            }));\r\n        } catch {\r\n            return [];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Limpa todo o cache\r\n     */\r\n    async clearAll(): Promise<void> {\r\n        try {\r\n            const allMeta = await db.cacheKeys.toArray();\r\n            for (const meta of allMeta) {\r\n                await db.storage.delete(meta.key);\r\n            }\r\n            await db.cacheKeys.clear();\r\n        } catch (error) {\r\n            console.error('[CacheService] Error clearing all caches:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Incrementa a versão do cache para forçar refresh geral\r\n     */\r\n    incrementVersion(): void {\r\n        this.cacheVersion++;\r\n    }\r\n\r\n    /**\r\n     * Retorna tempo restante do cache em formato legível\r\n     */\r\n    async getTimeToLive(entity: CacheableEntity): Promise<string> {\r\n        const metadata = await this.getMetadata(entity);\r\n        if (!metadata) return 'Cache não existe';\r\n\r\n        const remaining = metadata.expiresAt - Date.now();\r\n        if (remaining <= 0) return 'Expirado';\r\n\r\n        const hours = Math.floor(remaining / (60 * 60 * 1000));\r\n        const minutes = Math.floor((remaining % (60 * 60 * 1000)) / (60 * 1000));\r\n\r\n        if (hours > 0) return `${hours}h ${minutes}m`;\r\n        return `${minutes}m`;\r\n    }\r\n}\r\n\r\nexport const cacheService = new CacheService();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\catenary-calculator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\db.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[107,110],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[107,110],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[267,270],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[267,270],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Dexie, { type Table } from 'dexie';\r\n\r\nexport interface StorageItem {\r\n    key: string;\r\n    value: any;\r\n    updatedAt: number;\r\n}\r\n\r\nexport interface SyncItem {\r\n    id?: number;\r\n    operation: 'insert' | 'update' | 'delete';\r\n    table: string;\r\n    data: any;\r\n    itemId?: string;\r\n    timestamp: number;\r\n}\r\n\r\n// Nova interface para metadados de cache\r\nexport interface CacheMetadata {\r\n    key: string;           // Chave única do cache (ex: 'cache:employees')\r\n    tableName: string;     // Nome da tabela/entidade\r\n    createdAt: number;     // Timestamp de criação\r\n    expiresAt: number;     // Timestamp de expiração (TTL)\r\n    recordCount: number;   // Quantidade de registros cacheados\r\n    version: number;       // Versão do cache para invalidação\r\n}\r\n\r\n// TTL padrão por tipo de entidade (em milissegundos)\r\nexport const CACHE_TTL = {\r\n    employees: 24 * 60 * 60 * 1000,      // 24 horas\r\n    teams: 24 * 60 * 60 * 1000,          // 24 horas\r\n    jobFunctions: 7 * 24 * 60 * 60 * 1000, // 7 dias\r\n    sites: 24 * 60 * 60 * 1000,          // 24 horas\r\n    projects: 24 * 60 * 60 * 1000,       // 24 horas\r\n    companies: 7 * 24 * 60 * 60 * 1000,  // 7 dias\r\n    timeRecords: 6 * 60 * 60 * 1000,     // 6 horas\r\n    dailyReports: 6 * 60 * 60 * 1000,    // 6 horas\r\n    messages: 1 * 60 * 60 * 1000,        // 1 hora\r\n    constructionDocuments: 24 * 60 * 60 * 1000, // 24 horas\r\n    mapElements: 24 * 60 * 60 * 1000,           // 24 horas\r\n    towerTechnicalData: 7 * 24 * 60 * 60 * 1000 // 7 dias\r\n} as const;\r\n\r\nexport type CacheableEntity = keyof typeof CACHE_TTL;\r\n\r\nexport class TeamTrackDB extends Dexie {\r\n    storage!: Table<StorageItem>;\r\n    syncQueue!: Table<SyncItem>;\r\n    cacheKeys!: Table<CacheMetadata>;\r\n\r\n    constructor() {\r\n        super('TeamTrackDB');\r\n\r\n        // Versão 1: storage e syncQueue originais\r\n        this.version(1).stores({\r\n            storage: 'key',\r\n            syncQueue: '++id, table, operation, timestamp'\r\n        });\r\n\r\n        // Versão 2: Adiciona tabela cacheKeys para metadados\r\n        this.version(2).stores({\r\n            storage: 'key',\r\n            syncQueue: '++id, table, operation, timestamp',\r\n            cacheKeys: 'key, tableName, expiresAt'\r\n        });\r\n    }\r\n}\r\n\r\nexport const db = new TeamTrackDB();\r\n\r\n// Garantir que o banco esteja aberto\r\ndb.open().catch((err) => {\r\n    console.error('Failed to open IndexedDB:', err);\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\faceRecognitionService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\kpiService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[947,950],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[947,950],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { orionApi } from \"@/integrations/orion/client\";\r\n// import { ProjectMonthlyTarget } from \"@/types\"; // Type definition handled locally\r\n\r\nexport interface KPIProjectTargets {\r\n    id: string;\r\n    projectId: string;\r\n    targetMonth: string;\r\n    plannedHours: number;\r\n    plannedProgressPercentage: number;\r\n}\r\n\r\nexport const kpiService = {\r\n    getMonthlyTargets: async (projectId: string) => {\r\n        const response = await orionApi.get(`/project_monthly_targets?project_id=${projectId}`);\r\n        return response.data as KPIProjectTargets[];\r\n    },\r\n\r\n    saveMonthlyTarget: async (target: Omit<KPIProjectTargets, 'id'>) => {\r\n        const response = await orionApi.post('/project_monthly_targets', target);\r\n        return response.data;\r\n    },\r\n\r\n    getUnitCosts: async (projectId: string) => {\r\n        const response = await orionApi.get(`/production/costs/config?projectId=${projectId}`);\r\n        return response.data as any[]; // ActivityUnitCost[]\r\n    },\r\n\r\n    saveUnitCosts: async (projectId: string, costs: { activityId: string, unitPrice: number, measureUnit: string }[]) => {\r\n        const response = await orionApi.post('/production/costs/config', { projectId, costs });\r\n        return response.data;\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\storageService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[900,903],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[900,903],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1265,1268],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1265,1268],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db } from './db';\r\n\r\n// Local storage service with IndexedDB (Dexie) support\r\nclass StorageService {\r\n  async setItem<T>(key: string, value: T): Promise<void> {\r\n    try {\r\n      await db.storage.put({\r\n        key,\r\n        value,\r\n        updatedAt: Date.now()\r\n      });\r\n    } catch (error) {\r\n      console.error('Error saving to IndexedDB:', error);\r\n    }\r\n  }\r\n\r\n  async getItem<T>(key: string): Promise<T | null> {\r\n    try {\r\n      const item = await db.storage.get(key);\r\n      if (!item) return null;\r\n      return item.value as T;\r\n    } catch (error) {\r\n      console.error('Error reading from IndexedDB:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  async removeItem(key: string): Promise<void> {\r\n    try {\r\n      await db.storage.delete(key);\r\n    } catch (error) {\r\n      console.error('Error removing from IndexedDB:', error);\r\n    }\r\n  }\r\n\r\n  async addToSyncQueue(item: any): Promise<void> {\r\n    try {\r\n      await db.syncQueue.add({\r\n        operation: item.operation || 'insert',\r\n        table: item.table,\r\n        data: item.data,\r\n        itemId: item.id,\r\n        timestamp: Date.now()\r\n      });\r\n    } catch (error) {\r\n      console.error('Error adding to sync queue:', error);\r\n    }\r\n  }\r\n\r\n  async getSyncQueue(): Promise<any[]> {\r\n    try {\r\n      return await db.syncQueue.toArray();\r\n    } catch (error) {\r\n      console.error('Error reading sync queue:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  async removeFromSyncQueue(id: number): Promise<void> {\r\n    try {\r\n      await db.syncQueue.delete(id);\r\n    } catch (error) {\r\n      console.error('Error removing from sync queue:', error);\r\n    }\r\n  }\r\n\r\n  async clearSyncQueue(): Promise<void> {\r\n    try {\r\n      await db.syncQueue.clear();\r\n    } catch (error) {\r\n      console.error('Error clearing sync queue:', error);\r\n    }\r\n  }\r\n\r\n  async clearAll(): Promise<void> {\r\n    try {\r\n      await Promise.all([\r\n        db.storage.clear(),\r\n        db.syncQueue.clear()\r\n      ]);\r\n    } catch (error) {\r\n      console.error('Error clearing all local data:', error);\r\n    }\r\n  }\r\n}\r\n\r\nexport const storageService = new StorageService();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\tower-anchor-service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[207,210],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[207,210],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[311,314],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[311,314],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[388,391],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[388,391],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[433,436],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[433,436],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'avgLat' is assigned a value but never used.","line":31,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1133,1136],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1133,1136],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1159,1162],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1159,1162],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1183,1186],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1183,1186],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":117,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":120,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1221,1224],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1221,1224],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2335,2338],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2335,2338],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2367,2370],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2367,2370],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2389,2392],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2389,2392],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'effectiveAnchorZ' is assigned a value but never used.","line":70,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":70,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3560,3563],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3560,3563],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":101,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4542,4545],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4542,4545],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4691,4694],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4691,4694],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4840,4843],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4840,4843],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":109,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5147,5150],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5147,5150],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6127,6130],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6127,6130],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":19,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { TowerPhysics } from './tower-physics';\r\nimport { CableAnchorConfig, CableSettings, ModelTransform } from '../components/map/cable-config-modal';\r\n\r\nexport interface TowerAnchorOptions {\r\n    tower: any;\r\n    config: CableAnchorConfig;\r\n    role: 'vante' | 're';\r\n    placemarkOverrides: Record<string, any>;\r\n    cableSettings: CableSettings;\r\n    projectAnchors: Record<string, any[]>;\r\n    templateAnchors: Record<string, any[]>;\r\n    localModelUrl: string;\r\n    getEffectiveTransform: (individual: ModelTransform | undefined, url: string) => ModelTransform | undefined;\r\n}\r\n\r\nexport const TowerAnchorService = {\r\n    getAnchor: (options: TowerAnchorOptions): { x: number, y: number, z: number } => {\r\n        const {\r\n            tower,\r\n            config,\r\n            role,\r\n            placemarkOverrides,\r\n            cableSettings,\r\n            projectAnchors,\r\n            templateAnchors,\r\n            localModelUrl,\r\n            getEffectiveTransform\r\n        } = options;\r\n\r\n        const t = tower;\r\n        const avgLat = t.coordinates.lat;\r\n\r\n        // Get individual overrides\r\n        const docId = (t as any).document_id || (t as any).projectId || (t as any).project_id || (t.extendedData as any)?.document_id;\r\n        const compositeId = `${docId}:::${t.id}`;\r\n        const override = placemarkOverrides[compositeId];\r\n\r\n        // Get effective model URL\r\n        const towerModelUrl = override?.customModelUrl || cableSettings?.customModelUrl || localModelUrl;\r\n        const transform = getEffectiveTransform(override?.customModelTransform, towerModelUrl);\r\n\r\n        // Calculate effective tower height and scaling\r\n        const baseHeight = override?.height ?? t.towerHeight ?? 30;\r\n        const scaleZ = (transform?.scale?.[2] ?? 1) * (transform?.baseHeight ?? 1);\r\n\r\n        const isParaRaio = config.id.toLowerCase().includes('para') || config.id.toLowerCase().includes('opgw');\r\n        const technicalFixHeight = isParaRaio ? (t.fix_pararaio || t.fixParaRaio) : (t.fix_conductor || t.fixConductor);\r\n\r\n        const visibleHeight = baseHeight * scaleZ;\r\n        let effectiveAnchorZ = config.vRatio * visibleHeight;\r\n\r\n        if (technicalFixHeight && Number(technicalFixHeight) > 0) {\r\n            effectiveAnchorZ = Number(technicalFixHeight);\r\n        }\r\n\r\n        const baseRot = (t as any).calculatedHeading || (t as any).heading || (t as any).rotation || 0;\r\n        const pitch = transform?.rotation?.[0] ?? 0;\r\n        const roll = transform?.rotation?.[1] ?? 0;\r\n        const rotZ = transform?.rotation?.[2] ?? 0;\r\n\r\n        const towerPos = { lng: t.coordinates.lng, lat: t.coordinates.lat };\r\n\r\n        const isPortico = towerModelUrl === 'procedural-portico' ||\r\n            towerModelUrl.includes('PORTICO') ||\r\n            /TRIO|PORTICO/i.test(t.name || '');\r\n\r\n        let finalH = config.h;\r\n\r\n        if (isPortico) {\r\n            effectiveAnchorZ = visibleHeight;\r\n            if (isParaRaio) {\r\n                finalH = config.h < 0 ? -8.2 : 8.2;\r\n            } else {\r\n                finalH = config.h * 1.4;\r\n            }\r\n        }\r\n\r\n        const offZ = transform?.offset?.[2] ?? 0;\r\n\r\n        // 3D ANCHOR LINKAGE: Prioritize exact 3D points\r\n        const projectList = projectAnchors[t.id] || [];\r\n        const templateList = templateAnchors[t.towerId] || templateAnchors['default'] || [];\r\n        const towerAnchors = [...projectList, ...templateList];\r\n\r\n        // Calculate Base Centroid to match TowerScenegraphService shift\r\n        const baseAnchors = towerAnchors.filter((a: any) => {\r\n            const name = (a.name || '').toUpperCase();\r\n            return name.includes('BASE') || name.includes('FIXAÇÃO') || name.includes('FIXACAO') || name.includes('PE') || name.includes('PÉ');\r\n        });\r\n\r\n        // SCALING FACTOR:\r\n        // If the model is unit-sized (scale 1 means 1 meter), but visualization scales it to `visibleHeight`,\r\n        // then anchors (which are relative to unit model) must also be scaled by `visibleHeight`.\r\n        // However, if the anchors are already in meters relative to an unscaled model, we might just need `scaleZ`.\r\n        // Given user feedback \"minúsculos\", we assume anchors are Unit/Normalized and need full scaling.\r\n        // TowerScenegraph uses `scale = d.towerHeight`. Here `visibleHeight` is roughly `d.towerHeight`.\r\n        const scaleFactor = visibleHeight;\r\n\r\n        let avgX = 0, avgY = 0, avgZ = 0;\r\n        if (baseAnchors.length > 0) {\r\n            avgX = baseAnchors.reduce((acc: number, a: any) => acc + ((a.position.x ?? a.position[0] ?? 0) * scaleFactor), 0) / baseAnchors.length;\r\n            avgY = baseAnchors.reduce((acc: number, a: any) => acc + ((a.position.y ?? a.position[1] ?? 0) * scaleFactor), 0) / baseAnchors.length;\r\n            avgZ = baseAnchors.reduce((acc: number, a: any) => acc + ((a.position.z ?? a.position[2] ?? 0) * scaleFactor), 0) / baseAnchors.length;\r\n        }\r\n\r\n        if (towerAnchors.length > 0) {\r\n            const findMatch = (targetRole: string) => {\r\n                const search = targetRole.toUpperCase();\r\n                return towerAnchors.find((a: any) => {\r\n                    const anchorName = (a.name || a.label || '').toUpperCase();\r\n                    if (config.manualAnchorName) {\r\n                        return anchorName === config.manualAnchorName.toUpperCase() && anchorName.includes(search);\r\n                    }\r\n\r\n                    const phaseMatch = anchorName.includes(config.id.toUpperCase()) ||\r\n                        anchorName.includes(config.label.toUpperCase()) ||\r\n                        (config.phase && anchorName.includes(config.phase.toUpperCase()));\r\n\r\n                    const circuitMatch = !config.circuitId || anchorName.includes(config.circuitId.toUpperCase());\r\n\r\n                    return phaseMatch && anchorName.includes(search) && circuitMatch;\r\n                });\r\n            };\r\n\r\n            let anchor = findMatch(role);\r\n            if (!anchor && role === 're') anchor = findMatch('VANTE');\r\n\r\n            if (!anchor) {\r\n                anchor = towerAnchors.find((a: any) =>\r\n                    (a.name || a.label || '').toUpperCase() === config.id.toUpperCase() ||\r\n                    (a.name || a.label || '').toUpperCase() === config.label.toUpperCase() ||\r\n                    (config.phase && (a.name || a.label || '').toUpperCase() === config.phase.toUpperCase())\r\n                );\r\n            }\r\n\r\n            if (anchor) {\r\n                // Apply Scaling to the anchor point itself before shift\r\n                const rawX = (anchor.position.x ?? anchor.position[0] ?? 0) * scaleFactor;\r\n                const rawY = (anchor.position.y ?? anchor.position[1] ?? 0) * scaleFactor;\r\n                const rawZ = (anchor.position.z ?? anchor.position[2] ?? 0) * scaleFactor;\r\n\r\n                // Apply the opposite shift logic: Model was shifted by [-avgX, -avgY, -avgZ].\r\n                const ax = rawX - avgX;\r\n                const ay = rawY - avgY;\r\n                const az = rawZ - avgZ;\r\n\r\n                // Now using lOffset (ay), pitch and roll\r\n                const anchorPos = TowerPhysics.calculateAnchorPosition(\r\n                    towerPos, baseRot, ax, 0, 0, baseHeight,\r\n                    cableSettings.towerVerticalOffset, t.elevation || 0, rotZ,\r\n                    ay, pitch, roll\r\n                );\r\n\r\n                // Manual Global Offset from UI Adjustment (Meters)\r\n                const individualOffset = transform?.anchorOverrides?.[config.id];\r\n                const phaseOffset = config.phase ? transform?.phaseOverrides?.[config.phase] : null;\r\n\r\n                const manualDx = individualOffset?.x ?? phaseOffset?.x ?? transform?.anchorGlobalOffset?.x ?? 0;\r\n                const manualDy = individualOffset?.y ?? phaseOffset?.y ?? transform?.anchorGlobalOffset?.y ?? 0;\r\n                const manualDz = individualOffset?.z ?? phaseOffset?.z ?? transform?.anchorGlobalOffset?.z ?? 0;\r\n\r\n                // Convert meters to lat/lng degrees for the final position shift\r\n                // Approximation: 1 deg lat ~ 111km, 1 deg lng ~ 111km * cos(lat)\r\n                const mToDegLat = 1 / 111320;\r\n                const mToDegLng = 1 / (111320 * Math.cos(towerPos.lat * Math.PI / 180));\r\n\r\n                // manualDx/manualDy should follow tower rotation to be intuitive (X = transversal, Y = longitudinal)\r\n                const radY = (baseRot) * (Math.PI / 180);\r\n                const manualDxRot = (manualDx * Math.cos(radY)) + (manualDy * Math.sin(radY));\r\n                const manualDyRot = (manualDy * Math.cos(radY)) - (manualDx * Math.sin(radY));\r\n\r\n                return {\r\n                    x: anchorPos.lng + (manualDxRot * mToDegLng),\r\n                    y: anchorPos.lat + (manualDyRot * mToDegLat),\r\n                    z: anchorPos.alt + az + offZ + manualDz\r\n                };\r\n            }\r\n        }\r\n\r\n        // Fallback to central physics\r\n        const anchorPos = TowerPhysics.calculateAnchorPosition(\r\n            towerPos, baseRot, finalH, config.vRatio, config.vOffset || 0, baseHeight,\r\n            cableSettings.towerVerticalOffset, t.elevation || 0, rotZ,\r\n            0, pitch, roll\r\n        );\r\n\r\n        // Manual Global Offset from UI Adjustment (Meters)\r\n        const individualOffset = transform?.anchorOverrides?.[config.id];\r\n        const phaseOffset = config.phase ? transform?.phaseOverrides?.[config.phase] : null;\r\n\r\n        const manualDx = individualOffset?.x ?? phaseOffset?.x ?? transform?.anchorGlobalOffset?.x ?? 0;\r\n        const manualDy = individualOffset?.y ?? phaseOffset?.y ?? transform?.anchorGlobalOffset?.y ?? 0;\r\n        const manualDz = individualOffset?.z ?? phaseOffset?.z ?? transform?.anchorGlobalOffset?.z ?? 0;\r\n\r\n        const mToDegLat = 1 / 111320;\r\n        const mToDegLng = 1 / (111320 * Math.cos(towerPos.lat * Math.PI / 180));\r\n\r\n        // Relative rotation for manual offsets\r\n        const radY_fb = (baseRot) * (Math.PI / 180);\r\n        const manualDxRot_fb = (manualDx * Math.cos(radY_fb)) + (manualDy * Math.sin(radY_fb));\r\n        const manualDyRot_fb = (manualDy * Math.cos(radY_fb)) - (manualDx * Math.sin(radY_fb));\r\n\r\n        return {\r\n            x: anchorPos.lng + (manualDxRot_fb * mToDegLng),\r\n            y: anchorPos.lat + (manualDyRot_fb * mToDegLat),\r\n            z: anchorPos.alt + offZ + manualDz\r\n        };\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\tower-import-logic.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[731,734],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[731,734],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1080,1083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1080,1083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1751,1754],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1751,1754],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1960,1963],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1960,1963],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as XLSX from 'xlsx';\r\nimport { utmToLatLon, getZoneFromState } from '../utils/convert-utm';\r\n\r\nexport interface CreateTowerDto {\r\n    code: number;\r\n    tower_number: string;\r\n    type: string;\r\n    coordinates: {\r\n        lat: number;\r\n        lng: number;\r\n        altitude: number;\r\n    };\r\n    distance?: number;\r\n    height?: number;\r\n    weight?: number;\r\n    work_id: string;\r\n}\r\n\r\nexport const TowerImportLogic = {\r\n    parseTowerFile: async (file: File, workState: string, workId: string): Promise<CreateTowerDto[]> => {\r\n        const defaultZone = getZoneFromState(workState);\r\n\r\n        return new Promise((resolve, reject) => {\r\n            const reader = new FileReader();\r\n\r\n            reader.onload = (e: any) => {\r\n                try {\r\n                    const data = new Uint8Array(e.target.result);\r\n                    const workbook = XLSX.read(data, { type: 'array' });\r\n                    const firstSheetName = workbook.SheetNames[0];\r\n                    const worksheet = workbook.Sheets[firstSheetName];\r\n\r\n                    const rows: any[][] = XLSX.utils.sheet_to_json(worksheet, { header: 1 });\r\n\r\n                    if (rows.length < 2) {\r\n                        throw new Error('O arquivo parece estar vazio ou sem cabeçalho.');\r\n                    }\r\n\r\n                    const rawHeaders = rows[0] as string[];\r\n                    const headers = rawHeaders.map(h =>\r\n                        h ? h.toString().toLowerCase().trim().replace(/[^a-z0-9]/g, '_') : ''\r\n                    );\r\n\r\n                    const projectRows = rows.slice(1);\r\n                    const towers: CreateTowerDto[] = [];\r\n\r\n                    projectRows.forEach((row) => {\r\n                        const rowMap: any = {};\r\n                        headers.forEach((h, index) => {\r\n                            if (h) rowMap[h] = row[index];\r\n                        });\r\n\r\n                        const parseNumber = (val: any): number => {\r\n                            if (typeof val === 'number') return val;\r\n                            if (!val) return 0;\r\n                            const str = String(val).replace(',', '.');\r\n                            return parseFloat(str) || 0;\r\n                        };\r\n\r\n                        const code = rowMap['code'] || rowMap['codigo'] || rowMap['torre_id'];\r\n                        const towerNum = rowMap['tower'] || rowMap['tower_number'] || rowMap['tower_numb'] || rowMap['torre'] || rowMap['numero'];\r\n                        const type = rowMap['type'] || rowMap['tipo'];\r\n                        const height = parseNumber(rowMap['height'] || rowMap['altura']);\r\n                        const weight = parseNumber(rowMap['weight'] || rowMap['peso']);\r\n                        const distance = parseNumber(rowMap['distance'] || rowMap['distancia'] || rowMap['vao']);\r\n\r\n                        const inputLat = parseNumber(rowMap['lat'] || rowMap['latitude']);\r\n                        const inputLng = parseNumber(rowMap['lng'] || rowMap['longitude'] || rowMap['long']);\r\n\r\n                        let finalLat = 0;\r\n                        let finalLng = 0;\r\n                        const altitude = parseNumber(rowMap['altitude'] || rowMap['alt']);\r\n\r\n                        const isExplicitUtm = (rowMap['utm_easting'] || rowMap['easting'] || rowMap['x']) && (rowMap['utm_northing'] || rowMap['northing'] || rowMap['y']);\r\n\r\n                        if (isExplicitUtm) {\r\n                            const easting = parseNumber(rowMap['utm_easting'] || rowMap['easting'] || rowMap['x']);\r\n                            const northing = parseNumber(rowMap['utm_northing'] || rowMap['northing'] || rowMap['y']);\r\n                            const zone = rowMap['utm_zone'] || rowMap['zone'] || rowMap['zona'] || defaultZone;\r\n                            const band = rowMap['utm_band'] || rowMap['band'] || 'K';\r\n\r\n                            const conversion = utmToLatLon(easting, northing, zone, band);\r\n                            finalLat = conversion.lat;\r\n                            finalLng = conversion.lng;\r\n                        } else {\r\n                            const lookLikeUtm = Math.abs(inputLat) > 180 || Math.abs(inputLng) > 180;\r\n\r\n                            if (lookLikeUtm) {\r\n                                let easting = 0;\r\n                                let northing = 0;\r\n\r\n                                if (Math.abs(inputLat) > Math.abs(inputLng)) {\r\n                                    northing = inputLat;\r\n                                    easting = inputLng;\r\n                                } else {\r\n                                    northing = inputLng;\r\n                                    easting = inputLat;\r\n                                }\r\n\r\n                                const zone = rowMap['utm_zone'] || rowMap['zone'] || rowMap['zona'] || defaultZone;\r\n                                const band = rowMap['utm_band'] || rowMap['band'] || 'K';\r\n\r\n                                const conversion = utmToLatLon(easting, northing, zone, band);\r\n                                finalLat = conversion.lat;\r\n                                finalLng = conversion.lng;\r\n                            } else {\r\n                                finalLat = inputLat;\r\n                                finalLng = inputLng;\r\n                            }\r\n                        }\r\n\r\n                        if (code && towerNum) {\r\n                            towers.push({\r\n                                code: Number(code),\r\n                                tower_number: String(towerNum),\r\n                                type: type ? String(type) : '',\r\n                                coordinates: {\r\n                                    lat: finalLat,\r\n                                    lng: finalLng,\r\n                                    altitude: altitude\r\n                                },\r\n                                distance: distance,\r\n                                height: height,\r\n                                weight: weight,\r\n                                work_id: workId\r\n                            });\r\n                        }\r\n                    });\r\n\r\n                    if (towers.length === 0) {\r\n                        throw new Error('Nenhuma torre válida encontrada.');\r\n                    }\r\n\r\n                    resolve(towers);\r\n                } catch (error) {\r\n                    reject(error);\r\n                }\r\n            };\r\n\r\n            reader.onerror = (error) => reject(error);\r\n            reader.readAsArrayBuffer(file);\r\n        });\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\tower-layer.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[744,747],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[744,747],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[791,794],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[791,794],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[860,863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[860,863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1667,1670],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1667,1670],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":88,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3513,3516],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3513,3516],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ModelTransform } from '../components/map/cable-config-modal';\r\n\r\nexport interface Tower3DFeature {\r\n    type: 'Feature';\r\n    properties: {\r\n        id: string;\r\n        name: string;\r\n        model: string;\r\n        elevation: number;\r\n        heading: number;\r\n        towerHeight: number;\r\n        color: string;\r\n        scaleX: number;\r\n        scaleY: number;\r\n        scaleZ: number;\r\n        rotX: number;\r\n        rotY: number;\r\n        rotZ: number;\r\n        offX: number;\r\n        offY: number;\r\n        offZ: number;\r\n        elevationOffset: number;\r\n    };\r\n    geometry: {\r\n        type: 'Point';\r\n        coordinates: [number, number, number];\r\n    };\r\n}\r\n\r\nexport interface TowerLayerOptions {\r\n    towersWithTerrain: any[];\r\n    placemarkOverrides: Record<string, any>;\r\n    towerAlignments: Map<string, number>;\r\n    cableSettings: any;\r\n    localModelUrl: string;\r\n    getModelId: (url: string) => string;\r\n    getEffectiveTransform: (individual: ModelTransform | undefined, url: string) => ModelTransform | undefined;\r\n    getModelConfig: (url: string) => ModelTransform | undefined;\r\n}\r\n\r\nexport const TowerLayerService = {\r\n    generateTowerGeoJSON: (options: TowerLayerOptions): { type: 'FeatureCollection', features: Tower3DFeature[] } => {\r\n        const {\r\n            towersWithTerrain,\r\n            placemarkOverrides,\r\n            towerAlignments,\r\n            cableSettings,\r\n            localModelUrl,\r\n            getModelId,\r\n            getEffectiveTransform,\r\n            getModelConfig\r\n        } = options;\r\n\r\n        const features = towersWithTerrain.filter(p => p.isLocal).map(p => {\r\n            const docId = (p as any).document_id || '';\r\n            const compositeId = `${docId}:::${p.id}`;\r\n            const override = placemarkOverrides[compositeId];\r\n            const towerHeight = override?.height ?? p.towerHeight ?? 30;\r\n\r\n            const defaultModelForPattern = localModelUrl;\r\n            const effectiveModelUrl = override?.customModelUrl || cableSettings?.customModelUrl || defaultModelForPattern;\r\n            const effectiveModelId = getModelId(effectiveModelUrl);\r\n\r\n            const individualTransform = override?.customModelTransform;\r\n            const modelCfg = getEffectiveTransform(individualTransform, effectiveModelUrl) || getModelConfig(effectiveModelUrl);\r\n\r\n            return {\r\n                type: 'Feature',\r\n                properties: {\r\n                    id: p.id,\r\n                    name: p.name,\r\n                    model: effectiveModelId,\r\n                    elevation: p.elevation,\r\n                    heading: override?.angle !== undefined\r\n                        ? override.angle\r\n                        : (towerAlignments.get(p.id) ?? p.calculatedHeading ?? 0),\r\n                    towerHeight: towerHeight,\r\n                    color: override?.color || '',\r\n                    scaleX: (modelCfg?.scale[0] ?? 1) * (modelCfg?.baseHeight ?? 1),\r\n                    scaleY: (modelCfg?.scale[1] ?? 1) * (modelCfg?.baseHeight ?? 1),\r\n                    scaleZ: (modelCfg?.scale[2] ?? 1) * (modelCfg?.baseHeight ?? 1),\r\n                    rotX: modelCfg?.rotation[0] ?? 0,\r\n                    rotY: modelCfg?.rotation[1] ?? 0,\r\n                    rotZ: modelCfg?.rotation[2] ?? 0,\r\n                    offX: modelCfg?.offset[0] ?? 0,\r\n                    offY: modelCfg?.offset[1] ?? 0,\r\n                    offZ: modelCfg?.offset[2] ?? 0,\r\n                    elevationOffset: p.elevation - ((p as any).terrainElevation || 0)\r\n                },\r\n                geometry: {\r\n                    type: 'Point',\r\n                    coordinates: [p.coordinates.lng, p.coordinates.lat, 0]\r\n                }\r\n            } as Tower3DFeature;\r\n        });\r\n\r\n        return {\r\n            type: 'FeatureCollection',\r\n            features\r\n        };\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\tower-physics.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[547,550],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[547,550],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[708,711],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[708,711],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1897,1900],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1897,1900],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1919,1922],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1919,1922],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tower Physics Service\r\n * Provides centralized geometric and physical calculations for towers and anchors.\r\n */\r\n\r\nexport interface Point2D {\r\n    lng: number;\r\n    lat: number;\r\n}\r\n\r\nexport interface Point3D extends Point2D {\r\n    alt: number;\r\n}\r\n\r\nexport const TowerPhysics = {\r\n    /**\r\n     * Calculates the bearing for a tower in a sequence.\r\n     * Returns angle in degrees CW from North (Mapbox style).\r\n     * Methods: 'bisector' (default), 'tangential' (forward only)\r\n     */\r\n    calculateTowerBearing: (index: number, towers: any[], method: 'bisector' | 'tangential' = 'bisector'): number => {\r\n        const d = towers[index];\r\n        if (!d) return 0;\r\n\r\n        const getCoord = (t: any): Point2D => {\r\n            if (t.coordinates) return t.coordinates;\r\n            return { lat: t.lat, lng: t.lng };\r\n        };\r\n\r\n        const prev = towers[index - 1];\r\n        const next = towers[index + 1];\r\n\r\n        if (prev && next) {\r\n            const pCoord = getCoord(prev);\r\n            const dCoord = getCoord(d);\r\n            const nCoord = getCoord(next);\r\n\r\n            const b1 = TowerPhysics.calculateBearing(pCoord, dCoord);\r\n            const b2 = TowerPhysics.calculateBearing(dCoord, nCoord);\r\n\r\n            if (method === 'tangential') return b1;\r\n\r\n            // Average bearing (bisector)\r\n            let diff = b2 - b1;\r\n            while (diff < -180) diff += 360;\r\n            while (diff > 180) diff -= 360;\r\n            return (b1 + diff / 2 + 360) % 360;\r\n        } else if (prev) {\r\n            const pCoord = getCoord(prev);\r\n            const dCoord = getCoord(d);\r\n            return TowerPhysics.calculateBearing(pCoord, dCoord);\r\n        } else if (next) {\r\n            const dCoord = getCoord(d);\r\n            const nCoord = getCoord(next);\r\n            return TowerPhysics.calculateBearing(dCoord, nCoord);\r\n        }\r\n\r\n        return (d as any).heading || (d as any).rotation || 0;\r\n    },\r\n\r\n    /**\r\n     * Calculates the bearing (heading) from point 1 to point 2 in degrees.\r\n     * @returns Bearing in degrees [0, 360]\r\n     */\r\n    calculateBearing: (start: Point2D, end: Point2D): number => {\r\n        const phi1 = start.lat * Math.PI / 180;\r\n        const phi2 = end.lat * Math.PI / 180;\r\n        const deltaLambda = (end.lng - start.lng) * Math.PI / 180;\r\n\r\n        const y = Math.sin(deltaLambda) * Math.cos(phi2);\r\n        const x = Math.cos(phi1) * Math.sin(phi2) -\r\n            Math.sin(phi1) * Math.cos(phi2) * Math.cos(deltaLambda);\r\n\r\n        const theta = Math.atan2(y, x);\r\n        return (theta * 180 / Math.PI + 360) % 360;\r\n    },\r\n\r\n    /**\r\n     * Calculates the 3D position of an anchor point relative to the tower center and rotation.\r\n     * @param towerPos - Base coordinates of the tower\r\n     * @param bearingDegrees - The calculated bearing/heading of the line at this tower\r\n     * @param hOffset - Horizontal distance from center (X in GLB - positive for right)\r\n     * @param vRatio - Vertical ratio relative to tower height (0 to 1)\r\n     * @param vOffset - Constant vertical offset (meters)\r\n     * @param towerHeight - Visible height of the tower\r\n     * @param towerVerticalOffset - Global offset for ground clamping\r\n     * @param terrainAlt - Actual terrain altitude at this point\r\n     * @param yawOffset - Optional yaw adjustment from the model transform (rotZ)\r\n     * @param lOffset - Longitudinal distance (Y in GLB - positive for forward)\r\n     * @param pitch - Pitch rotation in degrees (rotX)\r\n     * @param roll - Roll rotation in degrees (rotY)\r\n     */\r\n    calculateAnchorPosition: (\r\n        towerPos: Point2D,\r\n        bearingDegrees: number,\r\n        hOffset: number,\r\n        vRatio: number,\r\n        vOffset: number,\r\n        towerHeight: number,\r\n        towerVerticalOffset: number,\r\n        terrainAlt: number,\r\n        yawOffset: number = 0,\r\n        lOffset: number = 0,\r\n        pitch: number = 0,\r\n        roll: number = 0\r\n    ): Point3D => {\r\n        const avgLat = towerPos.lat;\r\n        const mToDegLat = 1 / 111320;\r\n        const mToDegLng = 1 / (111320 * Math.cos(avgLat * Math.PI / 180));\r\n\r\n        // Start with local relative coordinates from tower base\r\n        let rX = hOffset;\r\n        let rY = lOffset;\r\n        let rZ = (vRatio * towerHeight) + vOffset;\r\n\r\n        // 1. Apply Pitch (Rotation around X axis)\r\n        if (pitch !== 0) {\r\n            const radP = pitch * (Math.PI / 180);\r\n            const ny = rY * Math.cos(radP) - rZ * Math.sin(radP);\r\n            const nz = rY * Math.sin(radP) + rZ * Math.cos(radP);\r\n            rY = ny;\r\n            rZ = nz;\r\n        }\r\n\r\n        // 2. Apply Roll (Rotation around Y axis)\r\n        if (roll !== 0) {\r\n            const radR = roll * (Math.PI / 180);\r\n            const nx = rX * Math.cos(radR) + rZ * Math.sin(radR);\r\n            const nz = -rX * Math.sin(radR) + rZ * Math.cos(radR);\r\n            rX = nx;\r\n            rZ = nz;\r\n        }\r\n\r\n        // 3. Apply Yaw (Rotation around Z axis)\r\n        // Heading is Clockwise from North.\r\n        // Mapbox model with +90 offset means GLB Y is North at Heading 0.\r\n        const totalYaw = (bearingDegrees + yawOffset) % 360;\r\n        const radY = totalYaw * (Math.PI / 180);\r\n\r\n        // Rotation Matrix for Clockwise Heading (East = X, North = Y)\r\n        const dx_meters = (rX * Math.cos(radY)) + (rY * Math.sin(radY));\r\n        const dy_meters = (rY * Math.cos(radY)) - (rX * Math.sin(radY));\r\n\r\n        const effectiveZ = terrainAlt + rZ + towerVerticalOffset;\r\n\r\n        return {\r\n            lng: towerPos.lng + (dx_meters * mToDegLng),\r\n            lat: towerPos.lat + (dy_meters * mToDegLat),\r\n            alt: effectiveZ\r\n        };\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\services\\tower-scenegraph-service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[527,530],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[527,530],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[573,576],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[573,576],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[704,707],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[704,707],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[779,782],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[779,782],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1156,1159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1156,1159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1851,1854],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1851,1854],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2057,2060],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2057,2060],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2303,2306],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2303,2306],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2325,2328],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2325,2328],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2632,2635],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2632,2635],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2694,2697],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2694,2697],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2855,2858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2855,2858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2888,2891],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2888,2891],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3138,3141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3138,3141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3177,3180],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3177,3180],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3668,3671],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3668,3671],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'globalOffset' is assigned a value but never used.","line":94,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":94,"endColumn":43},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5211,5214],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5211,5214],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":126,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6688,6691],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6688,6691],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":151,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7711,7714],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7711,7714],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":20,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ScenegraphLayer } from '@deck.gl/mesh-layers';\r\nimport { ScatterplotLayer, GeoJsonLayer } from '@deck.gl/layers';\r\nimport { TowerPhysics } from './tower-physics';\r\nimport { CableSettings } from '../components/map/cable-config-modal';\r\n\r\nexport interface TowerScenegraphOptions {\r\n    towerVerticalOffset: number;\r\n    terrainRevision?: number;\r\n    getTerrainElevation?: (lng: number, lat: number) => number;\r\n    cableSettings?: CableSettings | null;\r\n    localModelUrl?: string;\r\n    projectAnchors?: Record<string, any[]>;\r\n    templateAnchors?: Record<string, any[]>;\r\n}\r\n\r\nconst DEFAULT_MODEL_URL = '/standard-tower.glb';\r\n\r\nexport const TowerScenegraphService = {\r\n    getLayers: (towers: any[], options: TowerScenegraphOptions, alignments?: Map<string, number>): any[] => {\r\n        if (!options || towers.length === 0) return [];\r\n\r\n        const visibleTowers = towers.filter(t => !t.isHidden && !t.is_hidden);\r\n\r\n        // Debug layer to visualize tower positions at ground level\r\n        const debugLayer = new ScatterplotLayer({\r\n            id: 'tower-base-indicator',\r\n            data: visibleTowers,\r\n            getPosition: (d: any) => {\r\n                const globalOffset = options.cableSettings?.towerVerticalOffset || 0;\r\n                return [d.coordinates.lng, d.coordinates.lat, (d.elevation || 0) + globalOffset];\r\n            },\r\n            getRadius: 2,\r\n            radiusUnits: 'meters',\r\n            getFillColor: [255, 0, 0, 180], // Red semi-transparent\r\n            pickable: true,\r\n            updateTriggers: {\r\n                getPosition: [visibleTowers.length, options.terrainRevision]\r\n            }\r\n        });\r\n\r\n        const settings = options.cableSettings;\r\n        const modelUrl = settings?.customModelUrl || options.localModelUrl || DEFAULT_MODEL_URL;\r\n\r\n        const towerBasePolygons: any[] = [];\r\n\r\n        const towerLayer = new ScenegraphLayer({\r\n            id: 'tower-scenegraph-layer',\r\n            data: visibleTowers,\r\n            scenegraph: modelUrl,\r\n            getPosition: (d: any) => {\r\n                const globalOffset = options.cableSettings?.towerVerticalOffset || 0;\r\n                return [d.coordinates.lng, d.coordinates.lat, (d.elevation || 0) + globalOffset];\r\n            },\r\n            getOrientation: ((d: any, { index, data }: any): [number, number, number] => {\r\n                const manualBearing = alignments?.get(d.id);\r\n                const bearing = manualBearing !== undefined ? manualBearing : TowerPhysics.calculateTowerBearing(index, data, options.cableSettings?.alignmentMethod);\r\n                const manualRot = (d as any).rotation || 0;\r\n                const deflection = (d as any).deflection || 0;\r\n                const yaw = (360 - bearing - deflection - manualRot + 90) % 360;\r\n                return [0, yaw, 90];\r\n            }) as any,\r\n            getScale: ((d: any): [number, number, number] => {\r\n                const targetH = d.towerHeight || 30;\r\n                const intrinsicH = 1.0;\r\n                const scale = targetH / intrinsicH;\r\n                return [scale, scale, scale];\r\n            }) as any,\r\n            getTranslation: ((d: any): [number, number, number] => {\r\n                // Z-Sync 2.0: Detect Base Anchors for automatic grounding\r\n                // Concatenate project and template anchors to ensure we see everything\r\n                const projectList = options.projectAnchors?.[d.id] || [];\r\n                const templateList = options.templateAnchors?.[d.towerId] || [];\r\n                const allAnchors = [...projectList, ...templateList];\r\n\r\n                const towerAnchors = allAnchors.filter((a: any) => {\r\n                    const name = (a.name || '').toUpperCase();\r\n                    return name.includes('BASE') || name.includes('FIXAÇÃO') || name.includes('FIXACAO') || name.includes('PE') || name.includes('PÉ');\r\n                });\r\n\r\n                if (towerAnchors.length > 0) {\r\n                    // Apply Scaling: Anchors are usually normalized/unit vectors in the GLB space.\r\n                    // We must scale them by the tower height to get meters.\r\n                    const scale = d.towerHeight || 30; // Matches getScale logic\r\n\r\n                    // Calculate centroid of the base anchors (SCALED)\r\n                    const avgX = towerAnchors.reduce((acc, a) => acc + ((a.position.x ?? a.position[0] ?? 0) * scale), 0) / towerAnchors.length;\r\n                    const avgY = towerAnchors.reduce((acc, a) => acc + ((a.position.y ?? a.position[1] ?? 0) * scale), 0) / towerAnchors.length;\r\n                    const avgZ = towerAnchors.reduce((acc, a) => acc + ((a.position.z ?? a.position[2] ?? 0) * scale), 0) / towerAnchors.length;\r\n\r\n                    // Add to debug polygons\r\n                    if (towerAnchors.length >= 3) {\r\n                        const bearing = alignments?.get(d.id) || 0;\r\n                        const pos = { lng: d.coordinates.lng, lat: d.coordinates.lat };\r\n                        const globalOffset = options.cableSettings?.towerVerticalOffset || 0;\r\n                        const groundedOffset = -avgZ;\r\n\r\n                        const coords = towerAnchors.map((a: any) => {\r\n                            // Scale individual points for polygon\r\n                            const ax = (a.position.x ?? 0) * scale;\r\n                            const ay = (a.position.y ?? 0) * scale;\r\n                            const az = (a.position.z ?? 0) * scale;\r\n\r\n                            const p = TowerPhysics.calculateAnchorPosition(\r\n                                pos, bearing, ax, 0, 0, (d.towerHeight || 30),\r\n                                groundedOffset,\r\n                                (d.elevation || 0), 0,\r\n                                ay, 0, 0\r\n                            );\r\n                            return [p.lng, p.lat, p.alt + az];\r\n                        });\r\n                        // Close polygon\r\n                        coords.push(coords[0]);\r\n                        towerBasePolygons.push({\r\n                            type: 'Feature',\r\n                            geometry: { type: 'Polygon', coordinates: [coords] }\r\n                        });\r\n                    }\r\n\r\n                    // Snap the centroid of the base anchors to the map pin (d.coordinates + d.elevation)\r\n                    // We remove the local average offset (avgX, avgY, avgZ) and the global lift.\r\n                    const globalOffset = options.cableSettings?.towerVerticalOffset || 0;\r\n                    return [-avgX, -avgY, -avgZ - globalOffset];\r\n                }\r\n\r\n                return [0, 0, 0];\r\n            }) as any,\r\n            pickable: true,\r\n            sizeScale: 1,\r\n            updateTriggers: {\r\n                getPosition: [visibleTowers.length, options.towerVerticalOffset, options.terrainRevision, modelUrl],\r\n                getOrientation: [visibleTowers.length, modelUrl],\r\n                getScale: [visibleTowers.length, modelUrl],\r\n                getTranslation: [visibleTowers.length, options.projectAnchors, options.templateAnchors]\r\n            }\r\n        });\r\n\r\n        const basePolygonLayer = new GeoJsonLayer({\r\n            id: 'tower-base-polygon-layer',\r\n            data: { type: 'FeatureCollection', features: towerBasePolygons },\r\n            getFillColor: [255, 0, 0, 150],\r\n            getLineColor: [255, 0, 0, 255],\r\n            getLineWidth: 2,\r\n            lineWidthUnits: 'pixels',\r\n            stroked: true,\r\n            filled: true,\r\n            updateTriggers: {\r\n                data: [towerBasePolygons.length, options.terrainRevision]\r\n            }\r\n        });\r\n\r\n        const layers: any[] = [debugLayer, basePolygonLayer];\r\n\r\n        // Only add ScenegraphLayer if the model is NOT procedural\r\n        if (!modelUrl.startsWith('procedural-')) {\r\n            layers.unshift(towerLayer);\r\n        }\r\n\r\n        return layers;\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\signals\\auditSignals.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'computed' is defined but never used.","line":1,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[308,311],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[308,311],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[328,331],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[328,331],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { signal, computed } from '@preact/signals-react';\r\nimport { orionApi } from '@/integrations/orion/client';\r\n\r\nexport interface AuditLog {\r\n    id: string;\r\n    table_name: string;\r\n    record_id: string;\r\n    action: 'INSERT' | 'UPDATE' | 'DELETE' | string;\r\n    performed_by: string;\r\n    old_data: any;\r\n    new_data: any;\r\n    performed_at: string;\r\n    company_id: string;\r\n    performer_name?: string;\r\n    ipAddress?: string;\r\n    userAgent?: string;\r\n    route?: string;\r\n}\r\n\r\nexport const auditLogs = signal<AuditLog[]>([]);\r\nexport const isLoadingAudit = signal<boolean>(false);\r\nexport const auditFilters = signal({\r\n    entity: '',\r\n    action: '',\r\n    dateFrom: '',\r\n    dateTo: '',\r\n});\r\n\r\nexport const fetchAuditLogs = async () => {\r\n    isLoadingAudit.value = true;\r\n    try {\r\n        const { data } = await orionApi.get<AuditLog[]>('audit_logs');\r\n        if (data) auditLogs.value = data;\r\n    } catch (err) {\r\n        console.error('[AuditSignals] Error:', err);\r\n    } finally {\r\n        isLoadingAudit.value = false;\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\signals\\authSignals.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\signals\\employeeSignals.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[647,650],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[647,650],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1965,1968],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1965,1968],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { signal, computed } from '@preact/signals-react';\r\nimport { orionApi } from '@/integrations/orion/client';\r\n\r\nexport interface Employee {\r\n    id: string;\r\n    fullName: string;\r\n    registrationNumber: string;\r\n    functionId: string | null;\r\n    functionName?: string;\r\n    role: string;\r\n    phone: string | null;\r\n    email: string | null;\r\n    cpf: string | null;\r\n    photoUrl: string | null;\r\n    isActive: boolean;\r\n    siteId: string | null;\r\n    companyId: string | null;\r\n    projectId: string | null;\r\n    level: number;\r\n    laborType: string;\r\n    professionalLevel: number;\r\n    canLeadTeam?: boolean;\r\n    faceDescriptor?: any;\r\n    createdAt: string | Date;\r\n}\r\n\r\n// Signals\r\nexport const employees = signal<Employee[]>([]);\r\nexport const isLoadingEmployees = signal<boolean>(false);\r\nexport const employeeFilters = signal<{\r\n    companyId: string;\r\n    projectId: string;\r\n    siteId: string;\r\n    searchTerm: string;\r\n}>({\r\n    companyId: '',\r\n    projectId: '',\r\n    siteId: '',\r\n    searchTerm: '',\r\n});\r\n\r\n// Computed\r\nexport const filteredEmployees = computed(() => {\r\n    const list = employees.value;\r\n    const { companyId, projectId, siteId, searchTerm } = employeeFilters.value;\r\n\r\n    return list.filter(e => {\r\n        const matchesCompany = !companyId || e.companyId === companyId;\r\n        const matchesProject = !projectId || e.projectId === projectId;\r\n        const matchesSite = !siteId || e.siteId === siteId;\r\n        const matchesSearch = !searchTerm ||\r\n            e.fullName.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            e.email?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            e.registrationNumber.includes(searchTerm);\r\n\r\n        return matchesCompany && matchesProject && matchesSite && matchesSearch;\r\n    });\r\n});\r\n\r\n// Actions\r\nexport const fetchEmployees = async () => {\r\n    isLoadingEmployees.value = true;\r\n    try {\r\n        const { data, error } = await orionApi.get<any[]>('users?role=WORKER');\r\n        if (error) throw error;\r\n\r\n        if (data) {\r\n            const mapped: Employee[] = data.map(e => ({\r\n                id: e.id,\r\n                fullName: e.name || 'Sem nome',\r\n                registrationNumber: e.registrationNumber || '',\r\n                functionId: e.functionId,\r\n                functionName: e.jobFunction?.name || 'Não definida',\r\n                role: e.role || 'WORKER',\r\n                phone: e.phone || null,\r\n                email: e.email || null,\r\n                cpf: e.cpf || null,\r\n                photoUrl: e.image || null,\r\n                isActive: e.status === 'ACTIVE',\r\n                siteId: e.siteId || null,\r\n                companyId: e.companyId || null,\r\n                projectId: e.projectId || null,\r\n                level: e.hierarchyLevel || 0,\r\n                laborType: e.laborType || 'MOD',\r\n                professionalLevel: e.jobFunction?.hierarchyLevel || 0,\r\n                canLeadTeam: !!e.jobFunction?.canLeadTeam,\r\n                faceDescriptor: e.face_descriptor,\r\n                createdAt: e.createdAt,\r\n            }));\r\n            employees.value = mapped;\r\n        }\r\n    } catch (err) {\r\n        console.error('[EmployeeSignals] Error fetching:', err);\r\n    } finally {\r\n        isLoadingEmployees.value = false;\r\n    }\r\n};\r\n\r\nexport const updateEmployeeFilters = (updates: Partial<typeof employeeFilters.value>) => {\r\n    employeeFilters.value = { ...employeeFilters.value, ...updates };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\signals\\globalDataSignals.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\signals\\jobSignals.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[340,343],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[340,343],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'results' is assigned a value but never used.","line":63,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":63,"endColumn":30}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { signal } from \"@preact/signals-react\";\r\nimport { toast } from \"@/hooks/use-toast\";\r\nimport { orionApi } from \"@/integrations/orion/client\";\r\n\r\nexport interface JobState {\r\n    id: string;\r\n    type: string;\r\n    status: 'pending' | 'processing' | 'completed' | 'failed';\r\n    progress?: number;\r\n    error?: string;\r\n    payload?: any;\r\n    updatedAt: string;\r\n}\r\n\r\n// Sinais Globais\r\nexport const activeJobs = signal<Record<string, JobState>>({});\r\nexport const isAnyJobProcessing = signal(false);\r\n\r\n/**\r\n * Adiciona ou atualiza um job no estado global\r\n */\r\nexport const updateJobState = (jobId: string, state: Partial<JobState>) => {\r\n    const currentJobs = { ...activeJobs.value };\r\n    if (!currentJobs[jobId] && !state.type) return; // Não cria se não tiver os dados básicos\r\n\r\n    currentJobs[jobId] = {\r\n        ...(currentJobs[jobId] || {}),\r\n        ...state,\r\n        id: jobId,\r\n    } as JobState;\r\n\r\n    activeJobs.value = currentJobs;\r\n    isAnyJobProcessing.value = Object.values(currentJobs).some(j => j.status === 'processing' || j.status === 'pending');\r\n};\r\n\r\n/**\r\n * Remove um job do estado global\r\n */\r\nexport const removeJob = (jobId: string) => {\r\n    const currentJobs = { ...activeJobs.value };\r\n    delete currentJobs[jobId];\r\n    activeJobs.value = currentJobs;\r\n    isAnyJobProcessing.value = Object.values(currentJobs).some(j => j.status === 'processing' || j.status === 'pending');\r\n};\r\n\r\n/**\r\n * Monitora um job específico via polling e atualiza os sinais\r\n */\r\nexport const monitorJob = async (jobId: string) => {\r\n    const checkStatus = async () => {\r\n        try {\r\n            const { data: job, error } = await orionApi.get<JobState>(`jobs?id=${jobId}`);\r\n\r\n            if (error) {\r\n                console.error('[Signals] Error fetching job status:', error);\r\n                return false;\r\n            }\r\n\r\n            if (!job) return false;\r\n            updateJobState(jobId, job);\r\n\r\n            if (job.status === 'completed') {\r\n                const results = job.payload?.results;\r\n                toast({\r\n                    title: 'Processamento concluído',\r\n                    description: `Tarefa ${job.type} finalizada com sucesso.`,\r\n                });\r\n\r\n                // Remove do monitor após 5 segundos\r\n                setTimeout(() => removeJob(jobId), 5000);\r\n                return true;\r\n            }\r\n\r\n            if (job.status === 'failed') {\r\n                toast({\r\n                    title: 'Falha no processamento',\r\n                    description: job.error || 'Ocorreu um erro na tarefa.',\r\n                    variant: 'destructive',\r\n                });\r\n\r\n                // Mantém um pouco mais para o usuário ver o erro\r\n                setTimeout(() => removeJob(jobId), 10000);\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        } catch (error) {\r\n            console.error('Job monitoring error:', error);\r\n            return false;\r\n        }\r\n    };\r\n\r\n    // Executa a primeira checagem imediatamente\r\n    const finished = await checkStatus();\r\n    if (finished) return;\r\n\r\n    // Inicia o polling\r\n    const interval = setInterval(async () => {\r\n        const isDone = await checkStatus();\r\n        if (isDone) clearInterval(interval);\r\n    }, 3000);\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\signals\\teamSignals.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\signals\\timeSignals.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\store\\anchorStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\store\\useCameraStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\test\\setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\types\\anchor.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[272,275],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[272,275],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Vector3 } from 'three'\r\n\r\nexport interface Anchor {\r\n    id: string\r\n    name?: string\r\n    position: Vector3\r\n    normal?: Vector3\r\n    faceIndex?: number\r\n    meshName?: string\r\n    type?: 'calibration_base' | 'cable_attach' | 'accessory_mount'\r\n    metadata?: any\r\n    createdAt: string\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\types\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\types\\kmz.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\types\\map.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\utils\\convert-utm.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\utils\\imageCompression.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\utils\\inputValidators.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\utils\\laborUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\utils\\permissionHelpers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\utils\\roleUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\utils\\storageCleanup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\src\\vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\tailwind.config.ts","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":142,"column":13,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":142,"endColumn":43}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Config } from \"tailwindcss\";\r\n\r\nexport default {\r\n  darkMode: [\"class\"],\r\n  content: [\"./pages/**/*.{ts,tsx}\", \"./components/**/*.{ts,tsx}\", \"./app/**/*.{ts,tsx}\", \"./src/**/*.{ts,tsx}\"],\r\n  prefix: \"\",\r\n  theme: {\r\n  \tcontainer: {\r\n  \t\tcenter: true,\r\n  \t\tpadding: '1rem',\r\n  \t\tscreens: {\r\n  \t\t\t'2xl': '1400px'\r\n  \t\t}\r\n  \t},\r\n  \textend: {\r\n  \t\tcolors: {\r\n  \t\t\tborder: 'hsl(var(--border))',\r\n  \t\t\tinput: 'hsl(var(--input))',\r\n  \t\t\tring: 'hsl(var(--ring))',\r\n  \t\t\tbackground: 'hsl(var(--background))',\r\n  \t\t\tforeground: 'hsl(var(--foreground))',\r\n  \t\t\tprimary: {\r\n  \t\t\t\tDEFAULT: 'hsl(var(--primary))',\r\n  \t\t\t\tforeground: 'hsl(var(--primary-foreground))'\r\n  \t\t\t},\r\n  \t\t\tsecondary: {\r\n  \t\t\t\tDEFAULT: 'hsl(var(--secondary))',\r\n  \t\t\t\tforeground: 'hsl(var(--secondary-foreground))'\r\n  \t\t\t},\r\n  \t\t\tdestructive: {\r\n  \t\t\t\tDEFAULT: 'hsl(var(--destructive))',\r\n  \t\t\t\tforeground: 'hsl(var(--destructive-foreground))'\r\n  \t\t\t},\r\n  \t\t\tsuccess: {\r\n  \t\t\t\tDEFAULT: 'hsl(var(--success))',\r\n  \t\t\t\tforeground: 'hsl(var(--success-foreground))'\r\n  \t\t\t},\r\n  \t\t\tmuted: {\r\n  \t\t\t\tDEFAULT: 'hsl(var(--muted))',\r\n  \t\t\t\tforeground: 'hsl(var(--muted-foreground))'\r\n  \t\t\t},\r\n  \t\t\taccent: {\r\n  \t\t\t\tDEFAULT: 'hsl(var(--accent))',\r\n  \t\t\t\tforeground: 'hsl(var(--accent-foreground))'\r\n  \t\t\t},\r\n  \t\t\tpopover: {\r\n  \t\t\t\tDEFAULT: 'hsl(var(--popover))',\r\n  \t\t\t\tforeground: 'hsl(var(--popover-foreground))'\r\n  \t\t\t},\r\n  \t\t\tcard: {\r\n  \t\t\t\tDEFAULT: 'hsl(var(--card))',\r\n  \t\t\t\tforeground: 'hsl(var(--card-foreground))'\r\n  \t\t\t},\r\n  \t\t\tsidebar: {\r\n  \t\t\t\tDEFAULT: 'hsl(var(--sidebar-background))',\r\n  \t\t\t\tforeground: 'hsl(var(--sidebar-foreground))',\r\n  \t\t\t\tprimary: 'hsl(var(--sidebar-primary))',\r\n  \t\t\t\t'primary-foreground': 'hsl(var(--sidebar-primary-foreground))',\r\n  \t\t\t\taccent: 'hsl(var(--sidebar-accent))',\r\n  \t\t\t\t'accent-foreground': 'hsl(var(--sidebar-accent-foreground))',\r\n  \t\t\t\tborder: 'hsl(var(--sidebar-border))',\r\n  \t\t\t\tring: 'hsl(var(--sidebar-ring))'\r\n  \t\t\t}\r\n  \t\t},\r\n  \t\tborderRadius: {\r\n  \t\t\tlg: 'var(--radius)',\r\n  \t\t\tmd: 'calc(var(--radius) - 2px)',\r\n  \t\t\tsm: 'calc(var(--radius) - 4px)'\r\n  \t\t},\r\n  \t\tfontFamily: {\r\n  \t\t\tsans: [\r\n  \t\t\t\t'Space Grotesk',\r\n  \t\t\t\t'ui-sans-serif',\r\n  \t\t\t\t'system-ui',\r\n  \t\t\t\t'-apple-system',\r\n  \t\t\t\t'BlinkMacSystemFont',\r\n  \t\t\t\t'Segoe UI',\r\n  \t\t\t\t'Roboto',\r\n  \t\t\t\t'Helvetica Neue',\r\n  \t\t\t\t'Arial',\r\n  \t\t\t\t'Noto Sans',\r\n  \t\t\t\t'sans-serif'\r\n  \t\t\t],\r\n  \t\t\tdisplay: [\r\n  \t\t\t\t'Space Grotesk',\r\n  \t\t\t\t'sans-serif'\r\n  \t\t\t],\r\n  \t\t\tserif: [\r\n  \t\t\t\t'Lora',\r\n  \t\t\t\t'ui-serif',\r\n  \t\t\t\t'Georgia',\r\n  \t\t\t\t'Cambria',\r\n  \t\t\t\t'Times New Roman',\r\n  \t\t\t\t'Times',\r\n  \t\t\t\t'serif'\r\n  \t\t\t],\r\n  \t\t\tmono: [\r\n  \t\t\t\t'Space Mono',\r\n  \t\t\t\t'ui-monospace',\r\n  \t\t\t\t'SFMono-Regular',\r\n  \t\t\t\t'Menlo',\r\n  \t\t\t\t'Monaco',\r\n  \t\t\t\t'Consolas',\r\n  \t\t\t\t'Liberation Mono',\r\n  \t\t\t\t'Courier New',\r\n  \t\t\t\t'monospace'\r\n  \t\t\t]\r\n  \t\t},\r\n  \t\tkeyframes: {\r\n  \t\t\t'accordion-down': {\r\n  \t\t\t\tfrom: {\r\n  \t\t\t\t\theight: '0'\r\n  \t\t\t\t},\r\n  \t\t\t\tto: {\r\n  \t\t\t\t\theight: 'var(--radix-accordion-content-height)'\r\n  \t\t\t\t}\r\n  \t\t\t},\r\n  \t\t\t'accordion-up': {\r\n  \t\t\t\tfrom: {\r\n  \t\t\t\t\theight: 'var(--radix-accordion-content-height)'\r\n  \t\t\t\t},\r\n  \t\t\t\tto: {\r\n  \t\t\t\t\theight: '0'\r\n  \t\t\t\t}\r\n  \t\t\t}\r\n  \t\t},\r\n  \t\tanimation: {\r\n  \t\t\t'accordion-down': 'accordion-down 0.2s ease-out',\r\n  \t\t\t'accordion-up': 'accordion-up 0.2s ease-out'\r\n  \t\t},\r\n  \t\tboxShadow: {\r\n  \t\t\t'2xs': 'var(--shadow-2xs)',\r\n  \t\t\txs: 'var(--shadow-xs)',\r\n  \t\t\tsm: 'var(--shadow-sm)',\r\n  \t\t\tmd: 'var(--shadow-md)',\r\n  \t\t\tlg: 'var(--shadow-lg)',\r\n  \t\t\txl: 'var(--shadow-xl)',\r\n  \t\t\t'2xl': 'var(--shadow-2xl)'\r\n  \t\t}\r\n  \t}\r\n  },\r\n  plugins: [require(\"tailwindcss-animate\")],\r\n} satisfies Config;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Juliano Freitas\\Documents\\GitHub\\Team-OrioN\\OrioN-Front-End-System\\vitest.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]