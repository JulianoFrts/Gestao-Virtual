import{f as ue,V as fe,a2 as Z,a9 as be,r as S,t as H,N as ye,aa as ve,u as je,i as _e,d as we,c as Ne,b as Ie,g as Se,j as e,s as T,B as U,ab as Ee,F as Ce,p as A,S as J,G as K,H as Q,I as Y,J as z,$ as me,L as xe,Y as Te,Z as ke,_ as Re}from"./index-D951x4H-.js";import{u as Oe}from"./useDailyReports-BR6lQ8Fm.js";import{u as Ae}from"./useSites-Dum3dnEP.js";import{T as Pe}from"./textarea-Db2vMs5u.js";import{C as De,b as Me,c as Le,d as Fe,a as Ve}from"./card-BTHGlYFz.js";import{C as qe,a as $e,b as ze,c as Ge,d as Ue,e as He}from"./command-DzEVDCzR.js";import{u as Be}from"./useWorkStages-DXnml1Pf.js";import{u as We}from"./useTowerProduction-DGhO_ax3.js";import{I as Je}from"./info-MbzHf59N.js";import{S as Ke}from"./send-B06f1M-Q.js";import{C as Qe}from"./chevrons-up-down-BNQt7ayD.js";import"./search-BoEw84GM.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]],Ze=ue("PanelLeftClose",Ye);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m14 9 3 3-3 3",key:"8010ee"}]],ea=ue("PanelLeftOpen",Xe),X={employeeId:"",subPointType:"GERAL",subPoint:"",subPointEnd:"",isMultiSelection:!1,teamIds:[],selectedSpanIds:[],selectedActivities:[],activities:"",observations:"",siteId:"",step:1,updatedAt:Date.now()},G=fe(X),C=u=>{G.value={...G.value,...u,updatedAt:Date.now()}},aa=()=>{G.value=X,Z.removeItem("daily-report-draft")},ra=async()=>{const u=await Z.getItem("daily-report-draft");u&&(G.value=u)};be(()=>{const u=G.value;u.updatedAt!==X.updatedAt&&Z.setItem("daily-report-draft",u)});function ta(u,o){const[P,O]=S.useState([]),[D,k]=S.useState(!1),[B,W]=S.useState(null),L=async()=>{if(!u&&!o){O([]);return}k(!0);try{let g=[],p=H.from("segments").select("*, conductors(*)").order("created_at",{ascending:!1});u&&u!=="all"&&(p=p.eq("project_id",u));const{data:c,error:v}=await p;!v&&c&&c.length>0&&(g=[...c.map(r=>{var x,q,w,h,I;const _=r.conductors||[],m=_.length,R=((x=_[0])==null?void 0:x.color)||"#0ea5e9",f=((q=_[0])==null?void 0:q.voltageKv)||0;return{id:r.id,project_id:r.projectId||r.project_id,tower_start_id:r.fromTowerId||r.from_tower_id||r.towerStartId||r.tower_start_id,tower_end_id:r.toTowerId||r.to_tower_id||r.towerEndId||r.tower_end_id,span_name:`${r.fromTowerId} - ${r.toTowerId}`,span_length:Number(r.length)||0,height_start:30,height_end:30,elevation_start:0,elevation_end:0,sag:Number((w=_[0])==null?void 0:w.sag)||0,tension:Number((h=_[0])==null?void 0:h.tension)||0,weight_per_meter:0,catenary_constant:0,arc_length:0,cable_color:R,cable_phases:m>0?m:3,cable_spacing:.5,voltage_kv:Number(f),cable_type:((I=_[0])==null?void 0:I.cableType)||"Segment",geometry:null,sourceTable:"segments",_conductors:_}})]);let j=H.from("span_technical_data").select("*");u&&u!=="all"&&(j=j.eq("project_id",u));const{data:E,error:ee}=await j;!ee&&E&&E.length>0&&E.map(r=>({id:r.id,project_id:r.project_id||r.projectId,tower_start_id:r.tower_start_id||r.towerStartId,tower_end_id:r.tower_end_id||r.towerEndId,span_name:r.span_name||r.spanName,span_length:r.span_length||r.spanLength,height_start:r.height_start||r.heightStart,height_end:r.height_end||r.heightEnd,elevation_start:r.elevation_start||r.elevationStart,elevation_end:r.elevation_end||r.elevationEnd,sag:r.sag,tension:r.tension,weight_per_meter:r.weight_per_meter||r.weightPerMeter,catenary_constant:r.catenary_constant||r.catenaryConstant,arc_length:r.arc_length||r.arcLength,cable_color:r.cable_color||r.cableColor,cable_phases:r.cable_phases||r.cablePhases,cable_spacing:r.cable_spacing||r.cableSpacing,voltage_kv:r.voltage_kv||r.voltageKv,cable_type:r.cable_type||r.cableType,geometry:r.geometry||r.geometryData,sourceTable:"span_technical_data"})).forEach(r=>{g.some(m=>m.tower_start_id===r.tower_start_id&&m.tower_end_id===r.tower_end_id)||g.push(r)});let F=H.from("tower_technical_data").select("*").order("object_seq",{ascending:!0});u&&u!=="all"&&(F=F.eq("project_id",u));const{data:V,error:ae}=await F;if(V&&V.length>0){const b=new Map;V.forEach(r=>{var m;const _=r.project_id||r.projectId||"default";b.has(_)||b.set(_,[]),(m=b.get(_))==null||m.push(r)}),b.forEach((r,_)=>{const m=r.sort((R,f)=>(R.object_seq||0)-(f.object_seq||0));for(let R=0;R<m.length-1;R++){const f=m[R],x=m[R+1],q=Number(f.distance||f.go_forward||0),w=Math.max(Number(f.weight||1200),1e3),h=f.object_id||f.objectId||f.name,I=x.object_id||x.objectId||x.name;x&&h&&I&&(g.some($=>$.tower_start_id===h&&$.tower_end_id===I||$.tower_start_id===f.id&&$.tower_end_id===x.id)||g.push({id:`synth-${_}-${f.id}-${x.id}`,project_id:_,tower_start_id:h,tower_end_id:I,span_name:`${h} - ${I}`,span_length:q||0,height_start:Number(f.object_height||f.objectHeight||30),height_end:Number(x.object_height||x.objectHeight||30),elevation_start:Number(f.object_elevation||f.objectElevation||0),elevation_end:Number(x.object_elevation||x.objectElevation||0),sag:0,tension:w,weight_per_meter:1.5,catenary_constant:1e3,arc_length:0,cable_color:"#0ea5e9",cable_phases:3,cable_spacing:.5,voltage_kv:138,cable_type:"Synthesized",geometry:null,sourceTable:"synthesized"}))}})}console.log(`✅ [useSpanTechnicalData] Final spans: ${g.length}`),O(g)}catch(g){console.error("Error fetching span technical data:",g),W(g)}finally{k(!1)}};return S.useEffect(()=>{L()},[u,o]),{spans:P,loading:D,error:B,refetchSpans:L}}function ga(){var oe,de,le,ce;ye();const u=ve.value,{profile:o}=je(),P=!_e.value&&!we("daily_reports.manage"),O=o==null?void 0:o.employeeId,{teams:D}=Ne(o==null?void 0:o.companyId),{sites:k}=Ae(void 0,o==null?void 0:o.companyId),{createReport:B,getTodayReports:W}=Oe(),L=G.value,{employeeId:g,subPointType:p,subPoint:c,subPointEnd:v,isMultiSelection:j,teamIds:E,selectedSpanIds:ee,activities:F,observations:V,step:ae,selectedActivities:b}=L,r=S.useMemo(()=>({companyId:o==null?void 0:o.companyId}),[o==null?void 0:o.companyId]),{employees:_}=Ie(r),m=S.useMemo(()=>!P||!O?null:D.find(a=>a.members.includes(O)||a.supervisorId===O),[D,P,O]),[R,f]=S.useState(!1),[x,q]=S.useState([]),w=S.useMemo(()=>{if(L.siteId)return L.siteId;if(m!=null&&m.siteId)return m.siteId;if(E.length>0){const a=D.find(d=>d.id===E[0]);if(a!=null&&a.siteId)return a.siteId}if(g){const a=D.find(d=>d.members.includes(g)||d.supervisorId===g);if(a!=null&&a.siteId)return a.siteId}return null},[m,E,D,g,L.siteId]),{spans:h}=ta(((oe=k.find(a=>a.id===w))==null?void 0:oe.projectId)||void 0),{stages:I,isLoading:re}=Be(w||void 0,((de=k.find(a=>a.id===w))==null?void 0:de.projectId)||void 0),{towersByStage:$,loadProductionData:te}=We();S.useEffect(()=>{var a;if(I.length>0&&w&&(o!=null&&o.companyId)){const d=(a=k.find(t=>t.id===w))==null?void 0:a.projectId;d&&te(I,d,w,o.companyId)}},[I,w,o==null?void 0:o.companyId,te,k]);const{toast:se}=Se(),ne=S.useMemo(()=>{if(p!=="VAO")return{towers:0,km:"0.00"};let a=[];if(j&&c&&v){const i=h.findIndex(l=>l.id===c),N=h.findIndex(l=>l.id===v);if(i!==-1&&N!==-1){const l=Math.min(i,N),s=Math.max(i,N);a=h.slice(l,s+1)}}else if(c){const i=h.find(N=>N.id===c);i&&(a=[i])}if(a.length===0)return{towers:0,km:"0.00"};const d=new Set;a.forEach(i=>{i.tower_start_id&&d.add(i.tower_start_id),i.tower_end_id&&d.add(i.tower_end_id)});const t=a.reduce((i,N)=>i+(Number(N.span_length)||0),0);return{towers:d.size,km:(t/1e3).toFixed(2)}},[p,c,v,j,h]);S.useEffect(()=>{ra()},[]),S.useEffect(()=>{(async()=>{const d=w;if(!d)return;const t=k.find(i=>i.id===d);if(t!=null&&t.projectId)try{const{data:i,error:N}=await H.from("tower_technical_data").select("*").eq("projectId",t.projectId).eq("type","TOWER").order("sequence",{ascending:!0});if(!N&&i){const l=i.map(s=>({id:s.id,externalId:s.externalId||s.objectId,name:s.name||s.externalId||s.objectId,sequence:s.sequence||s.object_seq}));q(l)}}catch(i){console.error("Error fetching towers:",i)}})()},[k,w]),S.useEffect(()=>{P&&O&&!g&&C({employeeId:O,teamIds:m?[m.id]:[]})},[P,O,m,g]),W().filter(a=>P&&m?a.teamId===m.id:!0);const he=async a=>{if(a.preventDefault(),!g||!F.trim()){se({title:"Erro",description:"Selecione o funcionário e descreva as atividades",variant:"destructive"});return}f(!0);try{let d=c,t=[];if(p==="VAO"&&c){let l=[];if(j&&v){const s=h.findIndex(y=>y.id===c),n=h.findIndex(y=>y.id===v);if(s!==-1&&n!==-1){const y=Math.min(s,n),M=Math.max(s,n);l=h.slice(y,M+1)}}else{const s=h.find(n=>n.id===c);s&&(l=[s])}l.length>0&&(d=j&&v?`${l[0].span_name} a ${l[l.length-1].span_name}`:l[0].span_name,t=Array.from(new Set(l.flatMap(s=>[s.tower_start_id,s.tower_end_id]))))}if(j&&p==="TORRE"&&c&&v){const l=x.findIndex(n=>{var y,M;return n.id===c||((y=n.externalId)==null?void 0:y.toUpperCase())===c.toUpperCase()||((M=n.name)==null?void 0:M.toUpperCase())===c.toUpperCase()}),s=x.findIndex(n=>{var y,M;return n.id===v||((y=n.externalId)==null?void 0:y.toUpperCase())===v.toUpperCase()||((M=n.name)==null?void 0:M.toUpperCase())===v.toUpperCase()});if(l!==-1&&s!==-1){const n=Math.min(l,s),y=Math.max(l,s);t=x.slice(n,y+1).map(pe=>pe.externalId||pe.name),d=`${x[n].name} a ${x[y].name}`}}const i=b.map(l=>{var s;return(s=I.find(n=>n.id===l.stageId))==null?void 0:s.name}).filter(Boolean).join(", ");(await B({teamIds:E,subPoint:d||void 0,subPointType:p,employeeId:g,companyId:o==null?void 0:o.companyId,activities:i||F.trim()||"Atividades da Grelha selecionadas",selectedActivities:b,observations:V.trim()||void 0,metadata:{expandedTowers:t.length>0?t:void 0,isMultiSelection:j,selectedActivities:b}})).success&&(aa(),se({title:"Relatório enviado!",description:t.length>0?`${t.length} torres incluídas no relatório.`:"O relatório diário foi salvo com sucesso."}))}finally{f(!1)}},ge=()=>p==="TORRE"?x.map(a=>({id:a.externalId||a.name,label:a.name||a.externalId})):p==="VAO"||p==="TRECHO"?h.map(a=>({id:a.id,label:a.span_name})):[],ie=({value:a,onChange:d,placeholder:t})=>{var s;const[i,N]=S.useState(!1),l=ge();return e.jsxs(Te,{open:i,onOpenChange:N,children:[e.jsx(ke,{asChild:!0,children:e.jsxs(U,{variant:"outline",role:"combobox","aria-expanded":i,className:"w-full justify-between bg-primary/10 border-primary/20 hover:bg-primary/20 hover:border-primary/30 text-foreground h-11 rounded-xl",disabled:p==="GERAL",children:[a?(s=l.find(n=>n.id===a))==null?void 0:s.label:t,e.jsx(Qe,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(Re,{className:"w-[300px] p-0 glass-card border-primary/20",children:e.jsxs(qe,{className:"bg-transparent text-foreground",children:[e.jsx($e,{placeholder:"Buscar localização...",className:"h-9 border-none focus:ring-0 text-foreground"}),e.jsxs(ze,{children:[e.jsx(Ge,{className:"text-muted-foreground py-4 text-center text-xs",children:"Nenhum local encontrado."}),e.jsx(Ue,{children:l.map(n=>e.jsxs(He,{value:n.label,onSelect:()=>{d(n.id),N(!1)},className:"hover:bg-primary/20 cursor-pointer text-foreground data-[selected=true]:bg-primary/20",children:[e.jsx(me,{className:T("mr-2 h-4 w-4 text-primary",a===n.id?"opacity-100":"opacity-0")}),n.label]},n.id))})]})]})})]})};return e.jsx("div",{className:"space-y-6 animate-fade-in pb-10",children:e.jsx("div",{className:"flex flex-col lg:grid lg:grid-cols-12 gap-8",children:e.jsx("div",{className:"lg:col-span-12",children:e.jsxs(De,{className:T("glass-card transition-all duration-500 border-none shadow-2xl relative overflow-hidden","bg-primary/5 ring-1 ring-primary/20"),children:[e.jsx("div",{className:T("absolute top-0 left-0 right-0 h-1.5 bg-primary shadow-[0_0_15px_rgba(var(--primary),0.3)]")}),e.jsx(Me,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(Le,{className:"flex items-center gap-3 text-2xl font-bold tracking-tight",children:[e.jsx(U,{variant:"ghost",size:"icon",onClick:Ee,className:"h-8 w-8 text-primary hover:bg-primary/10 rounded-lg transition-colors hidden lg:flex",title:u?"Ocultar Menu":"Expandir Menu",children:u?e.jsx(Ze,{className:"w-5 h-5"}):e.jsx(ea,{className:"w-5 h-5"})}),e.jsx(Ce,{className:"w-6 h-6 text-primary"}),"Novo Relatório"]}),e.jsx(Fe,{className:"text-muted-foreground/60 mt-1 pl-11",children:"Preencha os dados de identificação e as atividades realizadas abaixo"})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("div",{className:"flex gap-1.5",children:e.jsx("div",{className:"w-24 h-1.5 rounded-full bg-primary shadow-[0_0_10px_rgba(var(--primary),0.5)] transition-all duration-500"})}),e.jsx("span",{className:"text-[10px] uppercase font-bold tracking-[0.2em] text-muted-foreground/40",children:"Formulário Unificado"})]})]})}),e.jsx(Ve,{children:e.jsxs("form",{onSubmit:he,className:"space-y-8",children:[e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(A,{className:"text-primary/80 font-bold uppercase text-[10px] tracking-widest pl-1",children:"Funcionário *"}),P?e.jsx("div",{className:"industrial-input flex items-center bg-primary/10 border-primary/20 px-5 py-4 rounded-xl cursor-not-allowed",children:e.jsx("span",{className:"text-white font-semibold",children:o==null?void 0:o.fullName})}):e.jsxs(J,{value:g,onValueChange:a=>C({employeeId:a}),children:[e.jsx(K,{className:"bg-primary/10 border-primary/20 focus:ring-primary/40 rounded-xl py-7 text-foreground hover:bg-primary/20 transition-all",children:e.jsx(Q,{placeholder:"Selecione o funcionário responsável"})}),e.jsx(Y,{className:"glass-card border-primary/20",children:_.map(a=>e.jsx(z,{value:a.id,className:"hover:bg-primary/20 cursor-pointer",children:a.fullName},a.id))})]})]}),e.jsx("div",{className:"p-6 rounded-2xl bg-primary/3 border border-primary/10 space-y-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(A,{className:"text-primary/80 font-bold uppercase text-[10px] tracking-widest pl-1",children:"Canteiro / Projeto *"}),e.jsxs(J,{value:w||"",onValueChange:a=>C({siteId:a}),children:[e.jsx(K,{className:"bg-primary/5 border-primary/20 rounded-2xl h-12 focus:ring-primary/40",children:e.jsx(Q,{placeholder:"Selecione o projeto/canteiro..."})}),e.jsx(Y,{className:"rounded-2xl border-primary/10",children:k.map(a=>e.jsx(z,{value:a.id,className:"rounded-xl focus:bg-primary/10",children:a.name},a.id))})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(A,{className:"text-primary/80 font-bold uppercase text-[10px] tracking-widest pl-1",children:"Informações de Localização"}),w&&e.jsxs("span",{className:"text-[9px] text-primary/40 font-mono tracking-tighter pl-1",children:["PROJETO:"," ",((ce=(le=k.find(a=>a.id===w))==null?void 0:le.name)==null?void 0:ce.toUpperCase())||"NÃO IDENTIFICADO"]})]}),(p==="TORRE"||p==="VAO")&&e.jsxs("label",{className:"flex items-center gap-3 text-[10px] font-bold text-primary/60 cursor-pointer hover:text-primary transition-all uppercase tracking-widest bg-primary/10 px-3 py-1.5 rounded-full border border-primary/10",children:[e.jsx("input",{type:"checkbox",className:"w-3.5 h-3.5 rounded border-primary/30 bg-primary/20 text-primary focus:ring-primary/40",checked:j,onChange:a=>C({isMultiSelection:a.target.checked,subPointEnd:""})}),p==="TORRE"?"Seleção Múltipla":"Multi-Vão"]})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsxs("div",{className:T("space-y-3",j?"col-span-12 md:col-span-4":"col-span-12 md:col-span-5"),children:[e.jsx(A,{className:"text-[10px] text-primary/50 uppercase font-bold tracking-wider",children:"Tipo de Elemento"}),e.jsxs(J,{value:p,onValueChange:a=>C({subPointType:a,isMultiSelection:a==="TORRE"?j:!1}),children:[e.jsx(K,{className:"bg-primary/10 border-primary/20 focus:ring-primary/40 rounded-xl h-11 text-foreground",children:e.jsx(Q,{})}),e.jsxs(Y,{className:"glass-card border-primary/20",children:[e.jsx(z,{value:"GERAL",children:"Geral (Sem Local)"}),e.jsx(z,{value:"TORRE",children:"Torre"}),e.jsx(z,{value:"VAO",children:"Vão"}),e.jsx(z,{value:"TRECHO",children:"Trecho"})]})]})]}),e.jsxs("div",{className:T("space-y-3",j?"col-span-12 md:col-span-4":"col-span-12 md:col-span-7"),children:[e.jsx(A,{className:"text-[10px] text-primary/50 uppercase font-bold tracking-wider",children:j?p==="TORRE"?"DA TORRE:":"DO VÃO:":"Identificação"}),e.jsx(ie,{value:c,onChange:a=>C({subPoint:a}),placeholder:p==="GERAL"?"OPCIONAL":"BUSCAR..."})]}),j&&e.jsxs("div",{className:"col-span-12 md:col-span-4 space-y-3 animate-in zoom-in-95 duration-200 relative",children:[e.jsx(A,{className:"text-[10px] text-primary/50 uppercase font-bold tracking-wider",children:"Até a Torre:"}),e.jsx(ie,{value:v,onChange:a=>C({subPointEnd:a}),placeholder:p==="TORRE"?"FIM...":"VÃO FIM..."}),c&&v&&e.jsx("div",{className:"absolute -bottom-7 right-0 animate-fade-in translate-y-1",children:(()=>{if(p==="TORRE"&&x.length>0){const a=x.findIndex(t=>(t.externalId||t.name)===c),d=x.findIndex(t=>(t.externalId||t.name)===v);if(a!==-1&&d!==-1){const t=Math.abs(d-a)+1;return e.jsxs("span",{className:"text-[9px] font-bold text-primary bg-primary/20 px-3 py-1 rounded-full border border-primary/20 flex items-center gap-1.5 shadow-lg shadow-primary/10",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-primary animate-pulse"}),t," torres no intervalo"]})}}else if(p==="VAO"&&h.length>0){const a=h.findIndex(t=>t.id===c),d=h.findIndex(t=>t.id===v);if(a!==-1&&d!==-1){const t=Math.abs(d-a)+1;return e.jsxs("span",{className:"text-[9px] font-bold text-primary bg-primary/20 px-3 py-1 rounded-full border border-primary/20 flex items-center gap-1.5 shadow-lg shadow-primary/10",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-primary animate-pulse"}),t," vãos no intervalo"]})}}return null})()})]})]}),(p==="VAO"&&c||p==="VAO"&&j&&c&&v)&&e.jsxs("div",{className:"flex items-center gap-4 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-primary/10 px-4 py-2 rounded-xl border border-primary/20",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary animate-pulse"}),e.jsxs("span",{className:"text-xs font-bold text-primary",children:[ne.towers," Torres"]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-green-500/10 px-4 py-2 rounded-xl border border-green-500/20",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),e.jsxs("span",{className:"text-xs font-bold text-green-500",children:[ne.km," km"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(A,{className:"text-primary/80 font-bold uppercase text-[10px] tracking-widest pl-1",children:"Equipes Envolvidas *"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 p-4 border border-primary/10 rounded-2xl bg-primary/2 max-h-48 overflow-y-auto custom-scrollbar",children:D.map(a=>e.jsxs("label",{className:T("flex items-center gap-3 text-xs cursor-pointer p-3 rounded-xl transition-all border border-transparent",E.includes(a.id)?"bg-primary/15 text-primary border-primary/30 shadow-lg shadow-primary/10":"text-muted-foreground/60 hover:bg-primary/10 hover:border-primary/10"),children:[e.jsx("div",{className:T("w-5 h-5 rounded-md flex items-center justify-center transition-all",E.includes(a.id)?"bg-primary":"bg-primary/10 border border-primary/20"),children:E.includes(a.id)&&e.jsx(me,{className:"w-3.5 h-3.5 text-white"})}),e.jsx("input",{type:"checkbox",checked:E.includes(a.id),className:"hidden",onChange:d=>{d.target.checked?C({teamIds:[...E,a.id]}):C({teamIds:E.filter(t=>t!==a.id)})}}),e.jsx("span",{className:"font-bold truncate max-w-[120px]",children:a.name})]},a.id))})]}),e.jsxs("div",{className:"space-y-10 pt-10 border-t border-white/5",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(A,{className:"text-primary/80 font-bold uppercase text-[10px] tracking-widest pl-1",children:"Grelha de Produção (Atividades Executadas)"}),e.jsxs("span",{className:"text-[10px] font-bold text-primary/40 uppercase tracking-widest bg-primary/5 px-3 py-1 rounded-full border border-primary/10",children:[b.length," SELECIONADAS"]})]}),e.jsx("div",{className:"space-y-3 max-h-[600px] overflow-y-auto pr-2 custom-scrollbar p-1",children:re?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-3 border-2 border-dashed border-primary/10 rounded-3xl bg-primary/2",children:[e.jsx(xe,{className:"w-8 h-8 text-primary animate-spin"}),e.jsx("p",{className:"text-xs font-bold text-primary/40 uppercase tracking-widest",children:"Carregando Grelha..."})]}):I.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-3 border-2 border-dashed border-primary/10 rounded-3xl bg-primary/2",children:[e.jsx(Je,{className:"w-8 h-8 text-primary/30"}),e.jsx("p",{className:"text-xs font-bold text-primary/40 uppercase tracking-widest",children:"Nenhuma etapa configurada"})]}):I.filter(a=>!a.parentId).map(a=>{var d;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"px-4 py-3 rounded-2xl bg-primary/5 border border-primary/10 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-lg bg-primary/10 flex items-center justify-center text-[10px] font-bold text-primary",children:a.displayOrder+1}),e.jsx("span",{className:"text-xs font-black text-foreground uppercase tracking-tight",children:a.name})]}),e.jsx("div",{className:"h-1.5 w-24 bg-primary/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary shadow-[0_0_8px_rgba(var(--primary),0.4)] transition-all duration-1000",style:{width:`${((d=a.progress)==null?void 0:d.actualPercentage)||0}%`}})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 pl-4",children:I.filter(t=>t.parentId===a.id).map(t=>{var l;const i=b.find(s=>s.stageId===t.id),N=(l=$[t.id])==null?void 0:l.some(s=>p==="TORRE"?s.id===c||s.objectId===c||s.elementId===c:!1);return e.jsxs("div",{className:T("flex flex-col gap-3 p-5 rounded-4xl border transition-all duration-300 relative overflow-hidden group/item shadow-sm",i?i.status==="FINISHED"?"bg-green-500/5 border-green-500/30 ring-1 ring-green-500/10":"bg-amber-500/5 border-amber-500/30 ring-1 ring-amber-500/10":"bg-white/2 border-white/5 hover:border-primary/30 hover:bg-white/4"),children:[N&&e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-primary/5 -mr-12 -mt-12 rounded-full blur-2xl"}),e.jsxs("div",{className:"flex items-start justify-between relative z-10",children:[e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:T("text-xs font-black uppercase tracking-tight truncate",i?i.status==="FINISHED"?"text-green-500":"text-amber-500":"text-foreground/90"),children:t.name}),N&&e.jsxs("div",{className:"flex items-center gap-1 bg-primary/10 px-1.5 py-0.5 rounded-full border border-primary/20",children:[e.jsx("div",{className:"w-1 h-1 rounded-full bg-primary animate-pulse"}),e.jsx("span",{className:"text-[7px] font-black text-primary uppercase",children:"Execução"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"flex gap-0.5",children:[1,2,3,4,5].map(s=>{var n;return e.jsx("div",{className:T("w-2.5 h-1 rounded-full",(((n=t.progress)==null?void 0:n.actualPercentage)||0)>=s*20?"bg-primary shadow-[0_0_5px_rgba(var(--primary),0.4)]":"bg-white/10")},s)})}),e.jsxs("span",{className:"text-[9px] text-muted-foreground/40 font-bold uppercase tracking-widest leading-none",children:["Peso: ",t.weight,"%"]})]})]}),i&&e.jsx("div",{className:T("px-3 py-1 rounded-xl text-[9px] font-black uppercase tracking-widest border shadow-lg transition-transform animate-in zoom-in-90",i.status==="FINISHED"?"bg-green-500 text-white border-green-400 shadow-green-500/20":"bg-amber-500 text-white border-amber-400 shadow-amber-500/20"),children:i.status==="FINISHED"?"CONCLUÍDO":"EM ANDAMENTO"})]}),e.jsxs("div",{className:"flex gap-3 relative z-10",children:[e.jsx(U,{type:"button",variant:"ghost",size:"sm",className:T("flex-1 h-9 text-[10px] font-black uppercase rounded-xl border transition-all duration-300",(i==null?void 0:i.status)==="IN_PROGRESS"?"bg-amber-500/20 text-amber-500 border-amber-500/40 shadow-[0_8px_20px_rgba(245,158,11,0.15)] scale-[1.02]":"bg-white/5 border-white/5 hover:bg-amber-500/10 hover:text-amber-500 hover:border-amber-500/20"),onClick:()=>{const s=b.find(n=>n.stageId===t.id);if((s==null?void 0:s.status)==="IN_PROGRESS")C({selectedActivities:b.filter(n=>n.stageId!==t.id)});else{const n=b.filter(y=>y.stageId!==t.id);C({selectedActivities:[...n,{stageId:t.id,status:"IN_PROGRESS"}]})}},children:"Andamento"}),e.jsx(U,{type:"button",variant:"ghost",size:"sm",className:T("flex-1 h-9 text-[10px] font-black uppercase rounded-xl border transition-all duration-300",(i==null?void 0:i.status)==="FINISHED"?"bg-green-500/20 text-green-500 border-green-500/40 shadow-[0_8px_20px_rgba(34,197,94,0.15)] scale-[1.02]":"bg-white/5 border-white/5 hover:bg-green-500/10 hover:text-green-500 hover:border-green-500/20"),onClick:()=>{const s=b.find(n=>n.stageId===t.id);if((s==null?void 0:s.status)==="FINISHED")C({selectedActivities:b.filter(n=>n.stageId!==t.id)});else{const n=b.filter(y=>y.stageId!==t.id);C({selectedActivities:[...n,{stageId:t.id,status:"FINISHED"}]})}},children:"Concluído"})]})]},t.id)})})]},a.id)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(A,{className:"text-primary/80 font-bold uppercase text-[10px] tracking-widest pl-1",children:"Observações adicionais (Notas de Campo)"}),e.jsx(Pe,{value:V,onChange:a=>C({observations:a.target.value}),placeholder:"Algum problema, imprevisto ou nota técnica importante de ser registrada?",rows:4,className:"bg-white/2 border-white/10 focus:ring-primary/40 rounded-3xl resize-none p-6 text-foreground placeholder:text-muted-foreground/30 text-sm shadow-inner"})]}),e.jsxs(U,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground rounded-4xl py-10 group shadow-[0_20px_50px_rgba(var(--primary),0.4)] border-0 text-xl font-black transition-all hover:scale-[1.01] active:scale-[0.98]",disabled:R,children:[R?e.jsx(xe,{className:"w-8 h-8 mr-3 animate-spin"}):e.jsx(Ke,{className:"w-8 h-8 mr-3 transition-transform group-hover:-translate-y-1 group-hover:translate-x-1"}),"REGISTRAR E ENVIAR RELATÓRIO"]})]})]})})]})})})})}export{ga as default};
