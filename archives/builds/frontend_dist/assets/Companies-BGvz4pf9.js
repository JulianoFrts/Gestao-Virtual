import{N as G,u as q,r as i,g as H,i as u,aA as J,j as e,D as _,d as o,B as d,k as U,l as Z,m as $,M as I,o as K,O as Q,p as h,a3 as N,L as V}from"./index-D951x4H-.js";import{u as W}from"./useCompanies-kjFTA6Qu.js";import{I as c}from"./input-dNnkIPn6.js";import{C as X,b as Y,c as ee,d as se,a as ae}from"./card-BTHGlYFz.js";import{S as L}from"./separator-B22JG5bU.js";import{C as te}from"./ConfirmationDialog-96fSVVNc.js";import{L as re}from"./LoadingScreen-SEZW07K4.js";import{P as ie}from"./plus-DmkF01H_.js";import{P}from"./phone-7k8cuzfD.js";import{S as ne}from"./search-BoEw84GM.js";import{L as le}from"./lock-BtTOdZOV.js";import{P as oe}from"./pencil-DX9IZKx2.js";import{T as de}from"./trash-2-DD2QlM38.js";import"./alert-dialog-qR-bbYaw.js";import"./triangle-alert-BPKdZxxI.js";function Ee(){G();const{companies:v,isLoading:C,createCompany:k,updateCompany:O,deleteCompany:T}=W(),{profile:f}=q(),[g,A]=i.useState(""),[M,m]=i.useState(!1),[p,w]=i.useState(null),[y,b]=i.useState(!1),[a,r]=i.useState({name:"",taxId:"",address:"",phone:""}),[n,E]=i.useState({open:!1,title:"",description:"",onConfirm:()=>{},variant:"default"}),{toast:j}=H(),B=async s=>{if(s.preventDefault(),!!a.name.trim()){b(!0);try{p?(await O(p.id,a)).success&&(j({title:"Empresa atualizada!"}),l()):(await k(a)).success&&(j({title:"Empresa cadastrada!"}),l())}finally{b(!1)}}},F=s=>{w(s),r({name:s.name,taxId:s.taxId||"",address:s.address||"",phone:s.phone||""}),m(!0)},R=async s=>{E({open:!0,title:"Excluir Empresa",description:`Deseja realmente excluir a empresa "${s.name}"? Esta ação não pode ser desfeita.`,variant:"destructive",onConfirm:async()=>{(await T(s.id)).success&&j({title:"Empresa excluída!"})}})},l=()=>{r({name:"",taxId:"",address:"",phone:""}),w(null),m(!1)},S=f==null?void 0:f.companyId,D=u.value,z=J.useMemo(()=>v.filter(s=>{const t=s.name.toLowerCase().includes(g.toLowerCase()),x=D||s.id===S;return t&&x}),[v,g,D,S]);return C?e.jsx(re,{isLoading:!0,title:"GESTÃO DE EMPRESAS",message:"SINCRONIZANDO DADOS",details:[{label:"Empresas",isLoading:C}]}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold gradient-text",children:"Gestão de Empresas"}),e.jsx("p",{className:"text-muted-foreground",children:"Cadastre e gerencie as empresas do grupo"})]}),e.jsxs(_,{open:M,onOpenChange:s=>{m(s),s||l()},children:[(u.value||o("system.is_corporate")||o("companies.create"))&&e.jsxs(d,{className:"gradient-primary text-white shadow-glow",onClick:()=>{l(),m(!0)},children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Nova Empresa"]}),e.jsxs(U,{className:"max-w-md",children:[e.jsxs(Z,{children:[e.jsxs($,{className:"flex items-center gap-2 text-2xl font-bold",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg gradient-primary flex items-center justify-center shadow-glow",children:e.jsx(I,{className:"text-white w-6 h-6"})}),p?"Editar Empresa":"Nova Empresa"]}),e.jsx(K,{className:"text-muted-foreground pt-1",children:"Gerencie os dados cadastrais da empresa no grupo."})]}),e.jsxs("form",{onSubmit:B,className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-semibold text-sm uppercase tracking-wider",children:[e.jsx(Q,{className:"w-4 h-4"}),"Dados Cadastrais"]}),e.jsx(L,{className:"bg-white/10"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{className:"text-xs uppercase text-muted-foreground font-bold",children:"Nome da Empresa *"}),e.jsx(c,{value:a.name,onChange:s=>r({...a,name:s.target.value}),className:"industrial-input h-10",placeholder:"Ex: Nono Engenharia",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{className:"text-xs uppercase text-muted-foreground font-bold",children:"CNPJ / Identificação"}),e.jsx(c,{value:a.taxId,onChange:s=>r({...a,taxId:s.target.value}),className:"industrial-input h-10",placeholder:"00.000.000/0000-00"})]})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-500 font-semibold text-sm uppercase tracking-wider",children:[e.jsx(N,{className:"w-4 h-4"}),"Endereço e Contato"]}),e.jsx(L,{className:"bg-white/10"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{className:"text-xs uppercase text-muted-foreground font-bold",children:"Endereço"}),e.jsxs("div",{className:"relative",children:[e.jsx(N,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground/50"}),e.jsx(c,{value:a.address,onChange:s=>r({...a,address:s.target.value}),className:"industrial-input pl-10 h-10",placeholder:"Logradouro, Bairro, Cidade - UF"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{className:"text-xs uppercase text-muted-foreground font-bold",children:"Telefone"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground/50"}),e.jsx(c,{value:a.phone,onChange:s=>r({...a,phone:s.target.value}),className:"industrial-input pl-10 h-10",placeholder:"(00) 0000-0000"})]})]})]}),e.jsxs("div",{className:"pt-4 flex gap-3",children:[e.jsx(d,{type:"button",variant:"outline",onClick:l,className:"flex-1 h-11",children:"Cancelar"}),e.jsxs(d,{type:"submit",className:"flex-1 h-11 gradient-primary shadow-glow",disabled:y,children:[y?e.jsx(V,{className:"w-4 h-4 mr-2 animate-spin"}):null,p?"Salvar Alterações":"Cadastrar Empresa"]})]})]})]})]})]}),e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(c,{placeholder:"Buscar empresas...",value:g,onChange:s=>A(s.target.value),className:"pl-10 industrial-input"})]}),e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-6",children:z.map(s=>e.jsxs(X,{className:"glass-card group hover:shadow-strong transition-all overflow-hidden border-l-4 border-l-primary relative",children:[e.jsx("div",{className:"absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:(()=>{const t=u.value||o("companies.update")||o("companies.edit_config"),x=u.value||o("companies.delete");return!t&&!x?e.jsxs("div",{className:"h-8 flex items-center px-2 bg-white/5 rounded text-muted-foreground/30",title:"Sem permissão hierárquica",children:[e.jsx(le,{className:"w-3.5 h-3.5 mr-1"}),e.jsx("span",{className:"text-[10px] uppercase font-bold",children:"Leitura"})]}):e.jsxs(e.Fragment,{children:[t&&e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-primary",onClick:()=>F(s),children:e.jsx(oe,{className:"w-4 h-4"})}),x&&e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>R(s),children:e.jsx(de,{className:"w-4 h-4"})})]})})()}),e.jsx(Y,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-2xl bg-primary/10 group-hover:bg-primary/20 transition-colors",children:e.jsx(I,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx(ee,{className:"text-lg",children:s.name}),e.jsx(se,{children:s.taxId||"CNPJ não informado"})]})]})}),e.jsx(ae,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate",children:s.address||"Endereço não cadastrado"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{children:s.phone||"Sem telefone"})]})]})})]},s.id))}),e.jsx(te,{open:n.open,onOpenChange:s=>E(t=>({...t,open:s})),title:n.title,description:n.description,onConfirm:n.onConfirm,variant:n.variant})]})}export{Ee as default};
