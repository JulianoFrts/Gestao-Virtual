import{f as ge,aA as W,b4 as Ve,r as A,j as e,p as Z,S as ot,G as ct,H as dt,I as mt,J as le,B,ac as pt,s as Q,al as ia,am as la,an as oa,bH as ca,b9 as gt,ao as We,aQ as da,aN as ma,aO as pa,e as at,aP as xa,a$ as ee,t as ae,b as Qe,L as ve,C as ua,U as xt,aw as ut,aK as ha,bG as ht,bA as _t,c as fa,D as Kt,k as qt,l as ba,m as $t,o as Gt,Y as Ee,Z as Oe,_ as Me,$ as ke,K as st,aS as Bt,A as ga,u as Ut,a as va,w as ja,ae as ya,bu as Na,a0 as wa,bI as ka}from"./index-D951x4H-.js";import{C as Se,a as qe,u as he}from"./CartesianGrid-HrqNXgEf.js";import{e as Sa,a as Aa,C as $e,P as Ia,b as Ca,k as Da}from"./CostConfigurationModal-C9OI4zOa.js";import{C as J,b as oe,c as ce,a as X}from"./card-BTHGlYFz.js";import{I as Ge}from"./input-dNnkIPn6.js";import{Z as Ea}from"./zoom-in-C25xHsbW.js";import{i as je,C as Oa,v as Ma,f as Fe,p as rt,d as fe,L as ye,g as pe,n as Ta,S as Ra,A as Pa,w as La,a as vt,b as Fa,x as xe,y as Ha,c as za,u as _a,G as Ka,z as He,o as qa,r as ft,F as $a,H as Te,I as jt,e as Ga,h as Ba,R as de,j as Qt,X as Ae,Y as Ie,T as me,J as Vt,k as nt,B as it}from"./AreaChart-D9h5uedO.js";import{s as Ua,m as yt,e as Nt,a as wt,b as Wt,c as Qa,d as Jt,i as kt,f as Xt,g as Re}from"./subDays-HHYU8WMe.js";import{t as Je,f as K,s as Va}from"./format-CP1OFCPJ.js";import{p as ie}from"./pt-BR-B9S-fQgu.js";import{S as ze}from"./scroll-area-C9sC2RNd.js";import{T as Wa,a as Ja,b as Xe,c as St,d as Xa,e as Ze}from"./table-UwE0Vej1.js";import{A as Za,a as Ya,b as es,c as ts,d as as,e as ss,f as rs,g as ns}from"./alert-dialog-qR-bbYaw.js";import{P as _e}from"./plus-DmkF01H_.js";import{E as is}from"./ellipsis-CNuBxG9Z.js";import{T as Pe}from"./trash-2-DD2QlM38.js";import{T as At}from"./triangle-alert-BPKdZxxI.js";import{u as ls}from"./useTimeRecords-RqrN7uRd.js";import{u as Zt}from"./useSites-Dum3dnEP.js";import{u as os}from"./useCompanies-kjFTA6Qu.js";import{T as Be}from"./trending-up-BwuTo0m4.js";import{B as Yt}from"./BarChart-DjRXQRXs.js";import{a as cs,b as ds}from"./PolarAngleAxis-DQC9sugx.js";import{L as ms}from"./LineChart-DAkisegE.js";import{L as ps}from"./Line-DWxI2lOG.js";import{A as xs,T as us,E as hs}from"./ExcelImportModal-CNRE8bkL.js";import{C as It}from"./calendar-MfduwZdl.js";import{C as Ct,a as Dt,b as Et,c as Ot,d as Mt,e as Ye}from"./command-DzEVDCzR.js";import{C as Tt}from"./chevrons-up-down-BNQt7ayD.js";import{C as Rt}from"./calendar-B3GVMfO3.js";import{C as fs}from"./checkbox-B9hZgst_.js";import{L as bs}from"./layout-grid-4na9_LkO.js";import{S as gs}from"./search-BoEw84GM.js";import{A as ea}from"./arrow-left-CQFd9_U_.js";import{i as et}from"./isSameDay-BB6-IGfB.js";import{T as vs,a as js,b as Ne,c as we}from"./tabs-D3Kawp4S.js";import{P as tt}from"./ProjectEmptyState-CRpC4Dgy.js";import{U as ys}from"./upload-D2Q7C-3S.js";import{S as Ns}from"./settings-2-CrLI_2YT.js";import"./circle-alert-BlgUQYiE.js";import"./save-BcLL5Pf6.js";import"./textarea-Db2vMs5u.js";import"./xlsx-BBWTpfDg.js";import"./info-MbzHf59N.js";import"./download-L1tB_Hhn.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],ks=ge("ArrowUpRight",ws);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]],As=ge("Building",Ss);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.3V14",key:"akvzfd"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]],Pt=ge("CalendarClock",Is);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m17 22 5-5",key:"1k6ppv"}],["path",{d:"m17 17 5 5",key:"p7ous7"}]],Lt=ge("CalendarX2",Cs);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]],Es=ge("ChartLine",Ds);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Ms=ge("ZoomOut",Os);function Ts(s,r){const i=Je(s.start),t=Je(s.end);let a=+i>+t;const d=a?+i:+t,f=a?t:i;f.setHours(0,0,0,0);let y=1;const v=[];for(;+f<=d;)v.push(Je(f)),f.setDate(f.getDate()+y),f.setHours(0,0,0,0);return a?v.reverse():v}var Ke;function be(s){"@babel/helpers - typeof";return be=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},be(s)}function ue(){return ue=Object.assign?Object.assign.bind():function(s){for(var r=1;r<arguments.length;r++){var i=arguments[r];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(s[t]=i[t])}return s},ue.apply(this,arguments)}function Ft(s,r){var i=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);r&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(s,a).enumerable})),i.push.apply(i,t)}return i}function q(s){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Ft(Object(i),!0).forEach(function(t){te(s,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(i)):Ft(Object(i)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(i,t))})}return s}function Rs(s,r){if(!(s instanceof r))throw new TypeError("Cannot call a class as a function")}function Ht(s,r){for(var i=0;i<r.length;i++){var t=r[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(s,aa(t.key),t)}}function Ps(s,r,i){return r&&Ht(s.prototype,r),i&&Ht(s,i),Object.defineProperty(s,"prototype",{writable:!1}),s}function Ls(s,r,i){return r=Ue(r),Fs(s,ta()?Reflect.construct(r,i||[],Ue(s).constructor):r.apply(s,i))}function Fs(s,r){if(r&&(be(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Hs(s)}function Hs(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function ta(){try{var s=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ta=function(){return!!s})()}function Ue(s){return Ue=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},Ue(s)}function zs(s,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(r&&r.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),r&&lt(s,r)}function lt(s,r){return lt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,a){return t.__proto__=a,t},lt(s,r)}function te(s,r,i){return r=aa(r),r in s?Object.defineProperty(s,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):s[r]=i,s}function aa(s){var r=_s(s,"string");return be(r)=="symbol"?r:r+""}function _s(s,r){if(be(s)!="object"||!s)return s;var i=s[Symbol.toPrimitive];if(i!==void 0){var t=i.call(s,r);if(be(t)!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}var re=(function(s){function r(i){var t;return Rs(this,r),t=Ls(this,r,[i]),te(t,"pieRef",null),te(t,"sectorRefs",[]),te(t,"id",_a("recharts-pie-")),te(t,"handleAnimationEnd",function(){var a=t.props.onAnimationEnd;t.setState({isAnimationFinished:!0}),je(a)&&a()}),te(t,"handleAnimationStart",function(){var a=t.props.onAnimationStart;t.setState({isAnimationFinished:!1}),je(a)&&a()}),t.state={isAnimationFinished:!i.isAnimationActive,prevIsAnimationActive:i.isAnimationActive,prevAnimationId:i.animationId,sectorToFocus:0},t}return zs(r,s),Ps(r,[{key:"isActiveIndex",value:function(t){var a=this.props.activeIndex;return Array.isArray(a)?a.indexOf(t)!==-1:t===a}},{key:"hasActiveIndex",value:function(){var t=this.props.activeIndex;return Array.isArray(t)?t.length!==0:t||t===0}},{key:"renderLabels",value:function(t){var a=this.props.isAnimationActive;if(a&&!this.state.isAnimationFinished)return null;var d=this.props,f=d.label,y=d.labelLine,v=d.dataKey,p=d.valueKey,b=Fe(this.props,!1),N=Fe(f,!1),k=Fe(y,!1),x=f&&f.offsetRadius||20,w=t.map(function(j,m){var E=(j.startAngle+j.endAngle)/2,T=rt(j.cx,j.cy,j.outerRadius+x,E),R=q(q(q(q({},b),j),{},{stroke:"none"},N),{},{index:m,textAnchor:r.getTextAnchor(T.x,j.cx)},T),F=q(q(q(q({},b),j),{},{fill:"none",stroke:j.fill},k),{},{index:m,points:[rt(j.cx,j.cy,j.outerRadius,E),T]}),D=v;return fe(v)&&fe(p)?D="value":fe(v)&&(D=p),W.createElement(ye,{key:"label-".concat(j.startAngle,"-").concat(j.endAngle,"-").concat(j.midAngle,"-").concat(m)},y&&r.renderLabelLineItem(y,F,"line"),r.renderLabelItem(f,R,pe(j,D)))});return W.createElement(ye,{className:"recharts-pie-labels"},w)}},{key:"renderSectorsStatically",value:function(t){var a=this,d=this.props,f=d.activeShape,y=d.blendStroke,v=d.inactiveShape;return t.map(function(p,b){if((p==null?void 0:p.startAngle)===0&&(p==null?void 0:p.endAngle)===0&&t.length!==1)return null;var N=a.isActiveIndex(b),k=v&&a.hasActiveIndex()?v:null,x=N?f:k,w=q(q({},p),{},{stroke:y?p.fill:p.stroke,tabIndex:-1});return W.createElement(ye,ue({ref:function(m){m&&!a.sectorRefs.includes(m)&&a.sectorRefs.push(m)},tabIndex:-1,className:"recharts-pie-sector"},Ta(a.props,p,b),{key:"sector-".concat(p==null?void 0:p.startAngle,"-").concat(p==null?void 0:p.endAngle,"-").concat(p.midAngle,"-").concat(b)}),W.createElement(Ra,ue({option:x,isActive:N,shapeType:"sector"},w)))})}},{key:"renderSectorsWithAnimation",value:function(){var t=this,a=this.props,d=a.sectors,f=a.isAnimationActive,y=a.animationBegin,v=a.animationDuration,p=a.animationEasing,b=a.animationId,N=this.state,k=N.prevSectors,x=N.prevIsAnimationActive;return W.createElement(Pa,{begin:y,duration:v,isActive:f,easing:p,from:{t:0},to:{t:1},key:"pie-".concat(b,"-").concat(x),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(w){var j=w.t,m=[],E=d&&d[0],T=E.startAngle;return d.forEach(function(R,F){var D=k&&k[F],O=F>0?La(R,"paddingAngle",0):0;if(D){var H=vt(D.endAngle-D.startAngle,R.endAngle-R.startAngle),u=q(q({},R),{},{startAngle:T+O,endAngle:T+H(j)+O});m.push(u),T=u.endAngle}else{var P=R.endAngle,L=R.startAngle,_=vt(0,P-L),C=_(j),n=q(q({},R),{},{startAngle:T+O,endAngle:T+C+O});m.push(n),T=n.endAngle}}),W.createElement(ye,null,t.renderSectorsStatically(m))})}},{key:"attachKeyboardHandlers",value:function(t){var a=this;t.onkeydown=function(d){if(!d.altKey)switch(d.key){case"ArrowLeft":{var f=++a.state.sectorToFocus%a.sectorRefs.length;a.sectorRefs[f].focus(),a.setState({sectorToFocus:f});break}case"ArrowRight":{var y=--a.state.sectorToFocus<0?a.sectorRefs.length-1:a.state.sectorToFocus%a.sectorRefs.length;a.sectorRefs[y].focus(),a.setState({sectorToFocus:y});break}case"Escape":{a.sectorRefs[a.state.sectorToFocus].blur(),a.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var t=this.props,a=t.sectors,d=t.isAnimationActive,f=this.state.prevSectors;return d&&a&&a.length&&(!f||!Fa(f,a))?this.renderSectorsWithAnimation():this.renderSectorsStatically(a)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var t=this,a=this.props,d=a.hide,f=a.sectors,y=a.className,v=a.label,p=a.cx,b=a.cy,N=a.innerRadius,k=a.outerRadius,x=a.isAnimationActive,w=this.state.isAnimationFinished;if(d||!f||!f.length||!xe(p)||!xe(b)||!xe(N)||!xe(k))return null;var j=Ve("recharts-pie",y);return W.createElement(ye,{tabIndex:this.props.rootTabIndex,className:j,ref:function(E){t.pieRef=E}},this.renderSectors(),v&&this.renderLabels(f),Ha.renderCallByParent(this.props,null,!1),(!x||w)&&za.renderCallByParent(this.props,f,!1))}}],[{key:"getDerivedStateFromProps",value:function(t,a){return a.prevIsAnimationActive!==t.isAnimationActive?{prevIsAnimationActive:t.isAnimationActive,prevAnimationId:t.animationId,curSectors:t.sectors,prevSectors:[],isAnimationFinished:!0}:t.isAnimationActive&&t.animationId!==a.prevAnimationId?{prevAnimationId:t.animationId,curSectors:t.sectors,prevSectors:a.curSectors,isAnimationFinished:!0}:t.sectors!==a.curSectors?{curSectors:t.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(t,a){return t>a?"start":t<a?"end":"middle"}},{key:"renderLabelLineItem",value:function(t,a,d){if(W.isValidElement(t))return W.cloneElement(t,a);if(je(t))return t(a);var f=Ve("recharts-pie-label-line",typeof t!="boolean"?t.className:"");return W.createElement(Oa,ue({},a,{key:d,type:"linear",className:f}))}},{key:"renderLabelItem",value:function(t,a,d){if(W.isValidElement(t))return W.cloneElement(t,a);var f=d;if(je(t)&&(f=t(a),W.isValidElement(f)))return f;var y=Ve("recharts-pie-label-text",typeof t!="boolean"&&!je(t)?t.className:"");return W.createElement(Ma,ue({},a,{alignmentBaseline:"middle",className:y}),f)}}])})(A.PureComponent);Ke=re;te(re,"displayName","Pie");te(re,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!Ka.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});te(re,"parseDeltaAngle",function(s,r){var i=He(r-s),t=Math.min(Math.abs(r-s),360);return i*t});te(re,"getRealPieData",function(s){var r=s.data,i=s.children,t=Fe(s,!1),a=qa(i,ft);return r&&r.length?r.map(function(d,f){return q(q(q({payload:d},t),d),a&&a[f]&&a[f].props)}):a&&a.length?a.map(function(d){return q(q({},t),d.props)}):[]});te(re,"parseCoordinateOfPie",function(s,r){var i=r.top,t=r.left,a=r.width,d=r.height,f=$a(a,d),y=t+Te(s.cx,a,a/2),v=i+Te(s.cy,d,d/2),p=Te(s.innerRadius,f,0),b=Te(s.outerRadius,f,f*.8),N=s.maxRadius||Math.sqrt(a*a+d*d)/2;return{cx:y,cy:v,innerRadius:p,outerRadius:b,maxRadius:N}});te(re,"getComposedData",function(s){var r=s.item,i=s.offset,t=r.type.defaultProps!==void 0?q(q({},r.type.defaultProps),r.props):r.props,a=Ke.getRealPieData(t);if(!a||!a.length)return null;var d=t.cornerRadius,f=t.startAngle,y=t.endAngle,v=t.paddingAngle,p=t.dataKey,b=t.nameKey,N=t.valueKey,k=t.tooltipType,x=Math.abs(t.minAngle),w=Ke.parseCoordinateOfPie(t,i),j=Ke.parseDeltaAngle(f,y),m=Math.abs(j),E=p;fe(p)&&fe(N)?(jt(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),E="value"):fe(p)&&(jt(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),E=N);var T=a.filter(function(u){return pe(u,E,0)!==0}).length,R=(m>=360?T:T-1)*v,F=m-T*x-R,D=a.reduce(function(u,P){var L=pe(P,E,0);return u+(xe(L)?L:0)},0),O;if(D>0){var H;O=a.map(function(u,P){var L=pe(u,E,0),_=pe(u,b,P),C=(xe(L)?L:0)/D,n;P?n=H.endAngle+He(j)*v*(L!==0?1:0):n=f;var c=n+He(j)*((L!==0?x:0)+C*F),o=(n+c)/2,g=(w.innerRadius+w.outerRadius)/2,l=[{name:_,value:L,payload:u,dataKey:E,type:k}],S=rt(w.cx,w.cy,g,o);return H=q(q(q({percent:C,cornerRadius:d,name:_,tooltipPayload:l,midAngle:o,middleRadius:g,tooltipPosition:S},u),w),{},{value:pe(u,E),startAngle:n,endAngle:c,payload:u,paddingAngle:He(j)*v}),H})}return q(q({},w),{},{sectors:O,data:a})});var sa=Ga({chartName:"PieChart",GraphicalChild:re,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:cs},{axisType:"radiusAxis",AxisComp:ds}],formatAxisMap:Ba,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const Ks=({projectId:s,towers:r,categories:i})=>{var j;const[t,a]=A.useState("all"),[d,f]=A.useState("monthly"),[y,v]=A.useState(""),[p,b]=A.useState(""),N=A.useMemo(()=>{if(!r||r.length===0)return[];const m=[];if(r.forEach(O=>{(t!=="all"?[t]:(i==null?void 0:i.flatMap(u=>u.activities.map(P=>P.id)))||[]).forEach(u=>{var _,C;const P=(_=O.activitySchedules)==null?void 0:_.find(n=>n.activityId===u),L=(C=O.activityStatuses)==null?void 0:C.find(n=>n.activityId===u);if(P||L){const n=[];L!=null&&L.history&&Array.isArray(L.history)?L.history.forEach(c=>{(c.changedAt||c.timestamp)&&n.push({date:new Date(c.changedAt||c.timestamp),percent:c.progressPercent||c.progress||0})}):(L==null?void 0:L.status)==="FINISHED"&&L.endDate&&n.push({date:new Date(L.endDate),percent:100}),m.push({plannedEnd:P!=null&&P.plannedEnd?new Date(P.plannedEnd):void 0,history:n,weight:1})}})}),m.length===0)return[];const E=[...m.map(O=>O.plannedEnd),...m.flatMap(O=>O.history.map(H=>H.date))].filter(O=>!!O);if(E.length===0)return[];const T=y?new Date(y):Ua(yt(E)),R=p?new Date(p):Nt(wt(E));let F;d==="weekly"?F=Sa({start:T,end:Wt(R,1)},{weekStartsOn:1}):F=Aa({start:T,end:Qa(R,1)});const D=m.length;return F.map(O=>{const H=d==="weekly"?Jt(O,{weekStartsOn:1}):Nt(O),u=m.reduce((_,C)=>_+(C.plannedEnd&&kt(C.plannedEnd,H)?1:0),0),P=m.reduce((_,C)=>{const n=C.history.filter(o=>kt(o.date,H));if(n.length===0)return _;const c=Math.max(...n.map(o=>o.percent));return _+c/100},0);return{period:d==="weekly"?`S${K(O,"ww",{locale:ie})} - ${K(O,"dd/MM",{locale:ie})}`:K(O,"MMM/yy",{locale:ie}),date:O.toISOString(),planned:u/D*100,actual:P/D*100,qtyPlanned:Math.round(u),qtyActual:Math.round(P),total:D}})},[r,t,i,d,y,p]),k=A.useMemo(()=>{if(N.length===0)return{actual:0,planned:0};const m=new Date,E=N.find(T=>{const R=new Date(T.date);return R.getMonth()===m.getMonth()&&R.getFullYear()===m.getFullYear()})||N[N.length-1];return{actual:E.actual,planned:E.planned}},[N]),x=A.useMemo(()=>i?i.flatMap(m=>m.activities.map(E=>({id:E.id,name:`${m.name} - ${E.name}`}))):[],[i]),w=A.useMemo(()=>{if(!r)return{start:"",end:""};const m=[];return r.forEach(E=>{var T;(T=E.activitySchedules)==null||T.forEach(R=>{R.plannedStart&&m.push(new Date(R.plannedStart)),R.plannedEnd&&m.push(new Date(R.plannedEnd))})}),m.length===0?{start:"",end:""}:{start:K(yt(m),"yyyy-MM-dd"),end:K(wt(m),"yyyy-MM-dd")}},[r]);return e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-top-4 duration-500",children:[e.jsxs("div",{className:"flex flex-col gap-4 bg-slate-950/40 p-4 rounded-xl border border-white/5",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-end sm:items-center",children:[e.jsxs("div",{className:"w-full sm:w-[300px] space-y-1.5",children:[e.jsx(Z,{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-widest",children:"Filtrar por Atividade"}),e.jsxs(ot,{value:t,onValueChange:a,children:[e.jsx(ct,{className:"bg-black/40 border-white/10 text-xs h-9",children:e.jsx(dt,{placeholder:"Selecione..."})}),e.jsxs(mt,{className:"max-h-[300px]",children:[e.jsx(le,{value:"all",children:"VISÃO GERAL (TODAS)"}),x.map(m=>e.jsx(le,{value:m.id,children:m.name},m.id))]})]})]}),e.jsxs("div",{className:"flex gap-4 ml-auto",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-widest text-right",children:"Real"}),e.jsxs("span",{className:"text-xl font-bold text-sky-500 font-mono text-right",children:[k.actual.toFixed(1),"%"]})]}),e.jsx("div",{className:"h-10 w-px bg-white/10"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-widest text-right",children:"Planejado"}),e.jsxs("span",{className:"text-xl font-bold text-amber-500 font-mono text-right",children:[k.planned.toFixed(1),"%"]})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-end border-t border-white/5 pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4 text-amber-500"}),e.jsx(Z,{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-widest whitespace-nowrap",children:"Período do Projeto"})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Z,{className:"text-[9px] text-slate-500 uppercase",children:"Início"}),e.jsx(Ge,{type:"date",className:"h-8 text-xs bg-black/40 border-slate-700 w-36",value:y||w.start,onChange:m=>v(m.target.value)})]}),e.jsx("span",{className:"text-slate-500 mt-4",children:"→"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Z,{className:"text-[9px] text-slate-500 uppercase",children:"Fim"}),e.jsx(Ge,{type:"date",className:"h-8 text-xs bg-black/40 border-slate-700 w-36",value:p||w.end,onChange:m=>b(m.target.value)})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsx(Z,{className:"text-[10px] uppercase font-bold text-muted-foreground tracking-widest",children:"Granularidade"}),e.jsxs("div",{className:"flex bg-black/40 rounded-lg p-0.5 border border-slate-700",children:[e.jsxs(B,{variant:"ghost",size:"sm",className:`h-7 px-3 text-xs rounded-md ${d==="weekly"?"bg-amber-500/20 text-amber-500":"text-slate-400"}`,onClick:()=>f("weekly"),children:[e.jsx(Ea,{className:"h-3 w-3 mr-1"}),"Semanal"]}),e.jsxs(B,{variant:"ghost",size:"sm",className:`h-7 px-3 text-xs rounded-md ${d==="monthly"?"bg-amber-500/20 text-amber-500":"text-slate-400"}`,onClick:()=>f("monthly"),children:[e.jsx(Ms,{className:"h-3 w-3 mr-1"}),"Mensal"]})]})]})]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-1",children:e.jsxs(J,{className:"bg-slate-950/50 border-amber-900/20 backdrop-blur-sm",children:[e.jsx(oe,{className:"pb-2 border-b border-white/5",children:e.jsxs(ce,{className:"text-sm font-medium text-slate-400 uppercase tracking-wider flex items-center gap-2",children:["Curva S - ",t==="all"?"Físico Geral":(j=x.find(m=>m.id===t))==null?void 0:j.name,e.jsxs("span",{className:"text-[10px] text-slate-600 font-normal",children:["(",d==="weekly"?"Semanal":"Mensal",")"]})]})}),e.jsx(X,{className:"h-[350px] pt-4",children:N.length>0?e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Qt,{data:N,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"gradActual",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#0ea5e9",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#0ea5e9",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"gradPlanned",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#f59e0b",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#f59e0b",stopOpacity:0})]})]}),e.jsx(Se,{strokeDasharray:"3 3",stroke:"#333",vertical:!1}),e.jsx(Ae,{dataKey:"period",stroke:"#666",fontSize:10,tickLine:!1,axisLine:!1,dy:10,interval:d==="weekly"?1:0,angle:d==="weekly"?-45:0,textAnchor:d==="weekly"?"end":"middle",height:d==="weekly"?60:30}),e.jsx(Ie,{stroke:"#666",fontSize:10,tickLine:!1,axisLine:!1,unit:"%",domain:[0,100]}),e.jsx(me,{contentStyle:{backgroundColor:"#0f172a",borderColor:"#334155",color:"#f1f5f9",fontSize:"12px"},labelStyle:{color:"#94a3b8",marginBottom:"4px"},formatter:(m,E)=>[typeof m=="number"?`${m.toFixed(2)}%`:m,E==="planned"?"Planejado":"Realizado"]}),e.jsx(Vt,{wrapperStyle:{paddingTop:"20px"}}),e.jsx(nt,{type:"monotone",dataKey:"planned",name:"planned",stroke:"#f59e0b",strokeWidth:2,fill:"url(#gradPlanned)",activeDot:{r:4,fill:"#f59e0b"}}),e.jsx(nt,{type:"monotone",dataKey:"actual",name:"actual",stroke:"#0ea5e9",strokeWidth:2,fill:"url(#gradActual)",activeDot:{r:4,fill:"#0ea5e9"}})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground gap-2",children:[e.jsx("p",{className:"text-sm",children:"Sem dados suficientes para gerar a curva."}),e.jsx("p",{className:"text-xs opacity-50",children:"Certifique-se de preencher as datas de planejamento e atualizar os status."})]})})]})})]})},zt=s=>{const r=s.substring(0,10),[i,t,a]=r.split("-").map(Number);return new Date(i,t-1,a,12,0,0,0)};function qs({towers:s,categories:r,startDate:i,onEditActivity:t,onWeekClick:a,projectId:d,companyId:f}){const[y,v]=A.useState(1),[p,b]=A.useState(!1),[N,k]=A.useState(!1),[x,w]=A.useState(null),[j,m]=A.useState(null),[E,T]=A.useState(null),[R,F]=A.useState(null),D=pt(),O=A.useMemo(()=>{const o=i?new Date(i):new Date,g=Va(o,{weekStartsOn:1});return Array.from({length:6}).map((l,S)=>{const h=Wt(g,S),I=Jt(h,{weekStartsOn:1});return{id:S+1,label:`Semana ${S+1}`,dateRange:`${K(h,"dd/MM")} - ${K(I,"dd/MM")}`,start:h,end:I}})},[i]),H=qe({mutationFn:async o=>{var $,Y;const{type:g,targetWeekId:l,targetDate:S,activityId:h}=o||{};if(!g)throw new Error("Parâmetros inválidos para limpeza (type is missing)");let I,M;if(g==="day"&&S)I=new Date(S),I.setHours(0,0,0,0),M=new Date(S),M.setHours(23,59,59,999);else if(g==="week"&&l){const U=O.find(Ce=>Ce.id===l);if(!U)throw new Error("Semana não encontrada");I=U.start,M=U.end}else if(g==="all")I=O[0].start,M=O[O.length-1].end;else if(g==="project_all"){ee.info("Enviando solicitação de limpeza TOTAL do projeto...");const U=await ae.delete("/production/schedule",{scope:"project_all",projectId:d||"all",companyId:f||""});if(U.error)throw new Error(U.error.message);return(($=U.data)==null?void 0:$.count)||0}else throw new Error("Invalid delete parameters");const z=K(I,"yyyy-MM-dd"),G=K(M,"yyyy-MM-dd");ee.info("Enviando solicitação de limpeza em massa...");const V=await ae.delete("/production/schedule",{scope:"batch",projectId:d||"all",companyId:f||"",startDate:z,endDate:G,activityId:h});if(V.error)throw new Error(V.error.message);return((Y=V.data)==null?void 0:Y.count)||0},onSuccess:o=>{const g=typeof o=="object"?o.count:o,l=typeof o=="object"?o.skipped:0;l>0?ee.success(`${g} agendamentos removidos. ${l} foram preservados por já terem execução.`):ee.success(`${g} agendamentos removidos com sucesso!`),D.invalidateQueries({queryKey:["production-towers"]}),D.invalidateQueries({queryKey:["production-schedule"]}),D.invalidateQueries({queryKey:["production-status"]}),k(!1),w(null),m(null),F(null)}}),u=qe({mutationFn:async o=>{const g=await ae.delete("/production/schedule",{scheduleId:o.scheduleId,targetDate:o.targetDate});if(g.error)throw new Error(g.error.message);return g.data},onSuccess:()=>{ee.success("Agendamento atualizado!"),D.invalidateQueries({queryKey:["production-towers"]}),D.invalidateQueries({queryKey:["production-schedule"]})},onError:o=>{ee.error(`Erro ao remover: ${o.message}`)}}),P=(o,g,l,S)=>{w(o),g&&m(g),F(S||null),l?T(l):o==="week"&&T(y),k(!0)},L=A.useMemo(()=>{if(!s)return{activeWeekDays:[],rows:[],dailyTotals:[]};const o=O.find(I=>I.id===y)||O[0],g=Array.from({length:7}).map((I,M)=>{const z=Xt(o.start,M);return{date:z,label:K(z,"EEEE",{locale:ie}),shortLabel:K(z,"EEE",{locale:ie}).toUpperCase(),dayNum:K(z,"dd/MM")}}),l=new Map;s.forEach(I=>{var M;(M=I.activitySchedules)==null||M.forEach(z=>{var Ce,bt;if(!z.plannedStart)return;const G=zt(z.plannedStart),V=z.plannedEnd?zt(z.plannedEnd):G,$=z.activityId;if(!l.has($)){const se=r==null?void 0:r.flatMap(ne=>ne.activities).find(ne=>ne.id===$),De=((Ce=r==null?void 0:r.find(ne=>ne.id===(se==null?void 0:se.categoryId)))==null?void 0:Ce.name)||"Outros";l.set($,{activityId:$,activityName:(se==null?void 0:se.name)||"Desconhecida",categoryName:De,days:g.map(ne=>({isScheduled:!1,towers:[]}))})}const Y=l.get($),U=(bt=I.activityStatuses)==null?void 0:bt.find(se=>se.activityId===$);g.forEach((se,De)=>{const ne=K(se.date,"yyyy-MM-dd"),ra=K(G,"yyyy-MM-dd"),na=K(V,"yyyy-MM-dd");ne>=ra&&ne<=na&&(Y.days[De].isScheduled=!0,Y.days[De].towers.push({id:I.id,scheduleId:z.id,name:I.objectId,status:(U==null?void 0:U.status)||"PENDING",progress:(U==null?void 0:U.progressPercent)||0,plannedQuantity:z.plannedQuantity||0}))})})}),p&&r&&r.forEach(I=>{I.activities.forEach(M=>{l.has(M.id)||l.set(M.id,{activityId:M.id,activityName:M.name,categoryName:I.name,days:g.map(()=>({isScheduled:!1,towers:[]}))})})});const S=Array.from(l.values()).filter(I=>p||I.days.some(M=>M.isScheduled)).map(I=>({...I,daySchedules:I.days.map(M=>{if(!M.isScheduled)return{isScheduled:!1};const z=M.towers.filter(Y=>Y.status==="FINISHED").length,G=M.towers.filter(Y=>Y.status==="IN_PROGRESS").length,V=M.towers.reduce((Y,U)=>Y+Number(U.progress||0),0);let $="PENDING";return z===M.towers.length?$="FINISHED":(G>0||z>0)&&($="IN_PROGRESS"),{isScheduled:!0,towers:M.towers,combinedStatus:$,avgProgress:M.towers.length>0?Math.round(V/M.towers.length):0}})}));S.sort((I,M)=>I.categoryName.localeCompare(M.categoryName)||I.activityName.localeCompare(M.activityName));const h=g.map((I,M)=>{let z=0,G=0;return S.forEach(V=>{const $=V.daySchedules[M];$.isScheduled&&(z+=$.towers.length,G+=$.towers.reduce((Y,U)=>Y+(U.plannedQuantity||0),0))}),{towerCount:z,totalQuantity:G}});return{activeWeekDays:g,rows:S,dailyTotals:h}},[s,r,y,O,p]),{activeWeekDays:_,rows:C,dailyTotals:n}=L,c=O.find(o=>o.id===y);return e.jsxs("div",{className:"space-y-4 animate-in fade-in slide-in-from-bottom-2 duration-700",children:[e.jsx("div",{className:"grid grid-cols-6 gap-2 bg-slate-900/40 p-2 rounded-xl border border-white/5 backdrop-blur-md",children:O.map(o=>e.jsxs("button",{onClick:()=>v(o.id),className:Q("flex flex-col items-center justify-center p-3 rounded-lg border transition-all relative overflow-hidden group",y===o.id?"bg-amber-500/10 border-amber-500/50 shadow-glow-sm":"bg-white/5 border-white/5 hover:bg-white/10 hover:border-white/20"),children:[y===o.id&&e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-amber-500 shadow-glow"}),e.jsxs("span",{className:Q("text-[10px] font-black uppercase tracking-widest transition-colors",y===o.id?"text-amber-500":"text-slate-500 group-hover:text-slate-300"),children:["S",o.id]}),e.jsx("span",{className:Q("text-[9px] font-bold font-mono transition-colors",y===o.id?"text-white":"text-slate-600 group-hover:text-slate-400"),children:o.dateRange})]},o.id))}),e.jsxs("div",{className:"flex items-center justify-between bg-black/40 p-3 rounded-xl border border-white/5 backdrop-blur-md h-16",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 border-r border-white/5 pr-4",children:[e.jsx("div",{className:"p-2 bg-emerald-500/10 rounded-lg",children:e.jsx($e,{className:"w-4 h-4 text-emerald-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[10px] font-black text-white uppercase tracking-widest leading-none",children:"Visão Diária Detalhada"}),e.jsxs("p",{className:"text-[9px] text-slate-500 font-bold uppercase tracking-wider mt-1.5",children:[c==null?void 0:c.label," — ",c==null?void 0:c.dateRange]})]})]}),e.jsxs(B,{size:"sm",variant:"link",className:"text-[9px] font-black uppercase text-amber-500 hover:text-amber-400 gap-2 h-auto p-0",onClick:()=>c&&(a==null?void 0:a(c.start)),children:[e.jsx(_e,{className:"w-3 h-3"}),"Programar p/ Lote nesta semana"]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx(B,{variant:p?"secondary":"ghost",size:"sm",onClick:()=>b(!p),className:"text-[10px] uppercase font-black tracking-widest h-8",children:p?"Ocultar Vazios":"Ver Tudo"}),e.jsxs(ia,{children:[e.jsx(la,{asChild:!0,children:e.jsx(B,{variant:"ghost",size:"sm",className:"h-8 px-2 text-slate-400 hover:text-white hover:bg-white/5",children:e.jsx(is,{className:"w-4 h-4"})})}),e.jsxs(oa,{align:"end",className:"bg-slate-950 border-white/10 w-56",children:[e.jsx(ca,{className:"text-[10px] font-black uppercase text-slate-500 tracking-widest",children:"Ações da Matriz"}),e.jsx(gt,{className:"bg-white/5"}),e.jsxs(We,{className:"text-xs font-bold text-slate-300 focus:text-white focus:bg-white/5 cursor-pointer gap-2 my-1",onClick:()=>P("week",void 0,y),children:[e.jsx(Lt,{className:"w-3.5 h-3.5"}),e.jsxs("span",{children:["Limpar Semana ",y]})]}),e.jsx(gt,{className:"bg-white/5"}),e.jsxs(We,{className:"text-xs font-bold text-red-500 focus:text-red-400 focus:bg-red-500/10 cursor-pointer gap-2 my-1",onClick:()=>P("all"),children:[e.jsx(Pe,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Limpar TUDO (6 Semanas)"})]}),e.jsxs(We,{className:"text-xs font-bold text-red-600 focus:text-red-500 focus:bg-red-500/20 cursor-pointer gap-2 my-1",onClick:()=>P("project_all"),children:[e.jsx(At,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"LIMPAR PROJETO INTEIRO"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-[9px] font-black uppercase tracking-widest text-slate-500",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-slate-700 shadow-glow-none"})," Pendente"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-500 shadow-glow-sm"})," Andamento"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500 shadow-glow-sm"})," Concluído"]})]})]})]}),e.jsxs(ze,{className:"h-[calc(100vh-380px)] border border-white/5 rounded-xl bg-black/40 shadow-2xl overflow-hidden",children:[e.jsxs(Wa,{className:"border-collapse",children:[e.jsx(Ja,{className:"bg-slate-950/80 sticky top-0 z-20 backdrop-blur-xl",children:e.jsxs(Xe,{className:"hover:bg-transparent border-white/10",children:[e.jsx(St,{className:"w-[240px] bg-slate-950/90 border-r border-white/5 text-[10px] font-black uppercase text-amber-500 py-6 px-4 sticky left-0 z-30",children:"Atividade / Categoria"}),_.map((o,g)=>e.jsx(St,{className:"min-w-[120px] text-center p-0 border-l border-white/5",children:e.jsxs("div",{className:"flex flex-col items-center py-4 gap-1 group/header relative",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-[9px] font-black text-amber-500 bg-amber-500/10 px-1.5 py-0.5 rounded-md border border-amber-500/20",children:g+1}),e.jsx("span",{className:"text-[11px] font-black uppercase tracking-tighter text-slate-300",children:o.shortLabel})]}),e.jsx("span",{className:"text-[10px] font-black text-amber-500/70 font-mono tracking-widest",children:o.dayNum}),n[g]&&n[g].towerCount>0&&e.jsx("div",{className:"flex flex-col items-center mt-1 pt-1 border-t border-white/5 w-full",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"text-[8px] font-black text-slate-400 uppercase",children:["T: ",n[g].towerCount]}),e.jsxs("span",{className:"text-[8px] font-black text-emerald-500 uppercase",children:["Q: ",n[g].totalQuantity]})]})}),e.jsx("button",{onClick:()=>P("day",o.date),className:"absolute top-1 right-1 p-1 rounded hover:bg-red-500/20 text-slate-600 hover:text-red-500 opacity-0 group-hover/header:opacity-100 transition-all",title:"Limpar dia",children:e.jsx(Pe,{className:"w-3 h-3"})})]})},g))]})}),e.jsx(Xa,{children:C.length===0?e.jsx(Xe,{children:e.jsx(Ze,{colSpan:8,className:"h-48 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 opacity-30 grayscale group",children:[e.jsx($e,{className:"w-10 h-10 text-slate-500 transition-transform group-hover:scale-110"}),e.jsxs("p",{className:"text-[10px] font-black uppercase text-slate-700 tracking-[0.4em] font-mono",children:["Nenhuma atividade programada para ",c==null?void 0:c.label]}),e.jsx(B,{variant:"outline",size:"sm",onClick:()=>b(!0),className:"opacity-0 group-hover:opacity-100 transition-opacity text-[10px] uppercase font-bold",children:"Mostrar Todas as Atividades para Agendar"})]})})}):C.map((o,g)=>e.jsxs(Xe,{className:"group hover:bg-slate-900/60 border-white/5 transition-all h-24",children:[e.jsx(Ze,{className:"w-[240px] bg-slate-950/40 border-r border-white/5 py-4 px-4 sticky left-0 z-10 group-hover:bg-slate-900 shadow-2xl",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[11px] font-black text-slate-100 uppercase tracking-tighter group-hover:text-amber-500 transition-colors",children:o.activityName}),e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase truncate max-w-[200px] leading-tight mt-1 opacity-60",children:o.categoryName})]})}),o.daySchedules.map((l,S)=>e.jsx(Ze,{className:"p-1 border-l border-white/5 text-center relative overflow-hidden group/cell",children:l.isScheduled?e.jsx(da,{children:e.jsxs(ma,{delayDuration:0,children:[e.jsx(pa,{asChild:!0,children:e.jsxs("div",{className:Q("h-full w-full rounded-xl flex flex-col items-center justify-center p-2 gap-1.5 transition-all shadow-lg border cursor-pointer relative",l.combinedStatus==="FINISHED"?"bg-emerald-500/10 border-emerald-500/30":l.combinedStatus==="IN_PROGRESS"?"bg-amber-500/10 border-amber-500/30 shadow-amber-500/10":"bg-slate-800/30 border-white/5"),onClick:()=>{t&&l.towers.length===1&&t(l.towers[0].id,o.activityId)},children:[e.jsxs("div",{className:"flex flex-wrap gap-1 justify-center max-w-full overflow-hidden items-center",children:[l.towers.slice(0,3).map(h=>e.jsx("span",{className:"text-[8px] font-black bg-white/5 px-1.5 py-0.5 rounded border border-white/10 text-slate-200 uppercase tracking-tighter",children:h.name},h.id)),l.towers.length>3&&e.jsxs("span",{className:"text-[8px] font-black text-amber-500",children:["+",l.towers.length-3]})]}),e.jsx("div",{className:"flex items-center gap-2",children:l.combinedStatus==="FINISHED"?e.jsx(at,{className:"w-3.5 h-3.5 text-emerald-500"}):e.jsxs("span",{className:Q("text-[10px] font-black tabular-nums",l.combinedStatus==="IN_PROGRESS"?"text-amber-500":"text-slate-500"),children:[l.avgProgress,"%"]})}),e.jsx("div",{className:"w-12 h-1 bg-white/5 rounded-full overflow-hidden shrink-0",children:e.jsx("div",{className:Q("h-full transition-all duration-700 ease-out",l.combinedStatus==="FINISHED"?"bg-emerald-500":"bg-amber-500"),style:{width:`${l.avgProgress}%`}})}),e.jsxs("div",{className:"absolute top-0.5 right-0.5 flex items-center gap-0.5 opacity-0 group-hover/cell:opacity-100 transition-all z-20",children:[e.jsx("button",{className:"p-1 rounded-full bg-black/50 hover:bg-red-500 hover:text-white border border-white/10 text-slate-400 transition-all scale-75 hover:scale-100",onClick:h=>{h.stopPropagation();const I=_[S].date;P("day",I,void 0,o.activityId)},title:"Remover agendamento deste dia",children:e.jsx(Pe,{className:"w-3 h-3"})}),e.jsx("button",{className:"p-1 rounded-full bg-black/50 hover:bg-amber-500 hover:text-black border border-white/10 text-slate-300 transition-all scale-75 hover:scale-100",onClick:h=>{h.stopPropagation();const I=_[S].date,M=K(I,"yyyy-MM-dd'T'12:00:00");t==null||t("",o.activityId,M,M)},title:"Adicionar mais torres",children:e.jsx(_e,{className:"w-3 h-3"})})]})]})}),e.jsx(xa,{className:"bg-slate-950 border-white/10 p-3 shadow-3xl z-50 rounded-xl",side:"bottom",children:e.jsxs("div",{className:"space-y-2 min-w-[180px]",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-white/10 pb-2 mb-2",children:[e.jsx("span",{className:"text-[10px] font-black text-amber-500 uppercase tracking-widest",children:_[S].label}),e.jsxs("span",{className:"text-[10px] font-black text-slate-500",children:[l.towers.length," Torres"]})]}),e.jsx("div",{className:"space-y-1.5",children:l.towers.map(h=>e.jsxs("div",{className:"flex items-center justify-between gap-4 p-1 rounded hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:Q("w-1.5 h-1.5 rounded-full",h.status==="FINISHED"?"bg-emerald-500":h.status==="IN_PROGRESS"?"bg-amber-500":"bg-slate-700")}),e.jsx("span",{className:"text-[10px] font-black text-slate-100 uppercase",children:h.name}),h.plannedQuantity>0&&e.jsxs("span",{className:"text-[9px] font-black text-emerald-500/80",children:["Q: ",h.plannedQuantity]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[9px] font-black text-slate-400 font-mono",children:[h.progress,"%"]}),e.jsx("button",{onClick:I=>{if(I.stopPropagation(),h.scheduleId){const M=_[S].date,z=K(M,"yyyy-MM-dd");u.mutate({scheduleId:h.scheduleId,targetDate:z})}},className:"p-1 rounded-md hover:bg-red-500/20 text-slate-500 hover:text-red-500 transition-colors",title:"Remover agendamento desta torre neste dia",children:e.jsx(Lt,{className:"w-3 h-3"})})]})]},h.id))}),e.jsx("div",{className:"pt-2 text-[8px] text-slate-600 font-bold uppercase tracking-widest text-center border-t border-white/5",children:"Detalhes da Execução"})]})})]})}):e.jsx("div",{className:"h-full w-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsx("button",{className:"h-8 w-8 rounded-full bg-white/5 border border-white/5 hover:bg-amber-500 hover:text-black flex items-center justify-center transition-all scale-75 group-hover/cell:scale-100",onClick:()=>{const h=_[S].date,I=K(h,"yyyy-MM-dd'T'12:00:00");t==null||t("",o.activityId,I,I)},children:e.jsx(_e,{className:"w-4 h-4"})})})},S))]},g))})]}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-10 bg-linear-to-t from-slate-950 to-transparent pointer-events-none"})]}),e.jsx(Za,{open:N,onOpenChange:k,children:e.jsxs(Ya,{className:"bg-slate-950 border-white/10",children:[e.jsxs(es,{children:[e.jsxs(ts,{className:"text-white flex items-center gap-2",children:[e.jsx(At,{className:"w-5 h-5 text-red-500"}),"Confirmar Limpeza de Cronograma"]}),e.jsxs(as,{className:"text-slate-400",children:[x==="day"&&!R&&`Tem certeza que deseja remover TODOS os agendamentos do dia ${j?K(j,"dd/MM"):""}?`,x==="day"&&R&&`Tem certeza que deseja remover os agendamentos desta atividade no dia ${j?K(j,"dd/MM"):""}?`,x==="week"&&`Tem certeza que deseja remover TODOS os agendamentos da Semana ${y}?`,x==="all"&&"ATENÇÃO: Isso removerá TODOS os agendamentos das próximas 6 SEMANAS. Essa ação não pode ser desfeita.",x==="project_all"&&"⚠️ PERIGO EXTREMO: Isso removerá ABSOLUTAMENTE TODAS as programações deste PROJETO, independente da data. Use apenas se tiver certeza absoluta!",e.jsx("br",{}),e.jsx("br",{}),e.jsx("span",{className:"font-bold text-red-500/80 uppercase text-xs tracking-wider",children:"Essa ação é irreversível."})]})]}),e.jsxs(ss,{children:[e.jsx(rs,{className:"bg-transparent border-white/10 text-slate-300 hover:bg-white/5 hover:text-white uppercase text-xs font-bold",children:"Cancelar"}),e.jsxs(ns,{onClick:()=>{x&&(ee.info("Iniciando limpeza em segundo plano..."),H.mutate({type:x,targetWeekId:E??void 0,targetDate:j??void 0,activityId:R??void 0}))},className:"bg-red-600 hover:bg-red-500 text-white border-0 uppercase text-xs font-black tracking-widest",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Confirmar Limpeza"]})]})]})})]})}function $s({projectId:s,projects:r,timeRange:i}){const{records:t,isLoading:a}=ls(),{employees:d,isLoading:f}=Qe(),{sites:y,isLoading:v}=Zt(),{isLoading:p}=os(),b=a||f||v||p,N=A.useMemo(()=>{if(!t.length||!d.length)return{hhhStats:[],distribution:[],totalHHH:0,activeWorkers:0,efficiency:0};const k=new Map(d.map(n=>[n.id,n])),x=new Map(y.map(n=>[n.id,n])),w=new Date;let j=Re(w,30);i==="week"&&(j=Re(w,7)),i==="quarter"&&(j=Re(w,90)),i==="year"&&(j=Re(w,365));const m=t.filter(n=>{if(new Date(n.recordedAt)<j)return!1;const o=k.get(n.employeeId);if(!o)return!1;const g=x.get(o.siteId);return s==="all"||g&&g.projectId===s}),E={};m.forEach(n=>{const c=K(new Date(n.recordedAt),"yyyy-MM-dd"),o=`${n.employeeId}_${c}`;E[o]||(E[o]=[]),E[o].push(n)});const T={};let R=0;Object.values(E).forEach(n=>{const c=n.sort((l,S)=>new Date(l.recordedAt).getTime()-new Date(S.recordedAt).getTime());let o=0;for(let l=0;l<c.length-1;l+=2)if(c[l].recordType==="entry"&&c[l+1].recordType==="exit"){const S=new Date(c[l+1].recordedAt).getTime()-new Date(c[l].recordedAt).getTime();o+=S/(1e3*60*60)}R+=o;const g=K(new Date(c[0].recordedAt),"dd/MM");T[g]=(T[g]||0)+o});const F=Ts({start:j,end:w}),D=s!=="all"?r.find(n=>n.id===s):null,O=(D==null?void 0:D.plannedHours)||0,H=F.map(n=>{const c=K(n,"dd/MM"),o=T[c]||0;let g=0;if(D&&D.startDate&&D.endDate&&O>0){const l=Math.max(1,(new Date(D.endDate).getTime()-new Date(D.startDate).getTime())/864e5);g=O/l}else g=new Set(m.filter(S=>K(new Date(S.recordedAt),"dd/MM")===c).map(S=>S.employeeId)).size*8.8;return{name:c,realizado:parseFloat(o.toFixed(1)),planejado:parseFloat(g.toFixed(1)),acumulado:0}});let u=0;H.forEach(n=>{u+=n.realizado,n.acumulado=parseFloat(u.toFixed(1))});const P={},L=d.filter(n=>{const c=x.get(n.siteId);return s==="all"||c&&c.projectId===s});L.forEach(n=>{const c=n.functionName||"Outros";P[c]=(P[c]||0)+1});const _=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899"],C=Object.entries(P).map(([n,c],o)=>({name:n,value:c,percentage:Math.round(c/Math.max(1,L.length)*100),color:_[o%_.length]})).slice(0,6);return{hhhStats:H,distribution:C,totalHHH:Math.round(R),activeWorkers:L.length,efficiency:R>0?Math.min(98,Math.round(R/(Math.max(1,L.length)*8.8*H.length)*100*2)):0}},[t,d,y,i,s,r]);return b?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] gap-4",children:[e.jsx(ve,{className:"w-10 h-10 animate-spin text-primary"}),e.jsx("p",{className:"text-white animate-pulse font-bold uppercase text-[10px] tracking-widest",children:"Sincronizando Mão de Obra..."})]}):e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(J,{className:"bg-slate-950/40 border-white/5 backdrop-blur-md overflow-hidden group hover:border-primary/30 transition-all",children:e.jsxs(X,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em]",children:"HHH REALIZADO"}),e.jsxs("h3",{className:"text-2xl font-black mt-1 text-white",children:[N.totalHHH.toLocaleString(),"h"]})]}),e.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center border border-primary/20 group-hover:scale-110 transition-transform",children:e.jsx(ua,{className:"text-primary w-5 h-5"})})]}),e.jsxs("p",{className:"text-[9px] font-bold text-primary/60 mt-4 uppercase",children:["Baseado em ",t.length," registros"]})]})}),e.jsx(J,{className:"bg-slate-950/40 border-white/5 backdrop-blur-md overflow-hidden group hover:border-amber-500/30 transition-all",children:e.jsxs(X,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em]",children:"APROVEITAMENTO"}),e.jsxs("h3",{className:"text-2xl font-black mt-1 text-white",children:[N.efficiency,"%"]})]}),e.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-500/10 flex items-center justify-center border border-amber-500/20 group-hover:scale-110 transition-transform",children:e.jsx(Be,{className:"text-amber-500 w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-4 text-[9px] font-bold text-emerald-500 uppercase",children:[e.jsx(ks,{className:"w-3 h-3"}),e.jsx("span",{children:"Controle de jornada ativo"})]})]})}),e.jsx(J,{className:"bg-slate-950/40 border-white/5 backdrop-blur-md overflow-hidden group hover:border-emerald-500/30 transition-all",children:e.jsxs(X,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em]",children:"MÃO DE OBRA"}),e.jsx("h3",{className:"text-2xl font-black mt-1 text-white",children:N.activeWorkers})]}),e.jsx("div",{className:"w-10 h-10 rounded-xl bg-emerald-500/10 flex items-center justify-center border border-emerald-500/20 group-hover:scale-110 transition-transform",children:e.jsx(xt,{className:"text-emerald-500 w-5 h-5"})})]}),e.jsx("p",{className:"text-[9px] font-bold text-muted-foreground mt-4 uppercase",children:"Funcionários no escopo"})]})}),e.jsx(J,{className:"bg-slate-950/40 border-white/5 backdrop-blur-md overflow-hidden group hover:border-purple-500/30 transition-all",children:e.jsxs(X,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em]",children:"CANTEIROS"}),e.jsx("h3",{className:"text-2xl font-black mt-1 text-white",children:y.length})]}),e.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-500/10 flex items-center justify-center border border-purple-500/20 group-hover:scale-110 transition-transform",children:e.jsx(ut,{className:"text-purple-500 w-5 h-5"})})]}),e.jsx("p",{className:"text-[9px] font-bold text-muted-foreground mt-4 uppercase",children:"Áreas monitoradas"})]})})]}),e.jsxs("div",{className:"flex items-center justify-between bg-black/40 p-4 rounded-xl border border-white/5 backdrop-blur-md",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ha,{className:"w-4 h-4 text-primary"}),e.jsx("h2",{className:"text-[11px] font-black uppercase tracking-widest leading-none",children:"Análise de Jornada"})]}),e.jsxs("div",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-widest px-3 py-1 bg-white/5 rounded-md",children:["Periodo: ",i==="week"?"Semana":i==="month"?"Mês":i==="quarter"?"Trimestre":"Ano"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(J,{className:"bg-slate-950/40 border-white/5 backdrop-blur-md",children:[e.jsx(oe,{className:"pb-2 border-b border-white/5",children:e.jsxs(ce,{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(ht,{className:"w-4 h-4 text-primary"}),"HHH Diário Realizado"]})}),e.jsx(X,{className:"h-[300px] pt-4",children:N.hhhStats.length>0?e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Yt,{data:N.hhhStats,children:[e.jsx(Se,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.05)",vertical:!1}),e.jsx(Ae,{dataKey:"name",stroke:"#6b7280",fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(Ie,{stroke:"#6b7280",fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(me,{contentStyle:{backgroundColor:"#0f172a",borderColor:"rgba(255,255,255,0.1)",borderRadius:"12px",fontSize:"10px"}}),e.jsx(it,{dataKey:"realizado",fill:"#fbbf24",radius:[4,4,0,0],name:"Realizado"}),e.jsx(it,{dataKey:"planejado",fill:"#3b82f6",fillOpacity:.2,radius:[4,4,0,0],name:"Planejado"})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground text-[10px] font-bold uppercase tracking-widest opacity-30",children:"Sem registros"})})]}),e.jsxs(J,{className:"bg-slate-950/40 border-white/5 backdrop-blur-md",children:[e.jsx(oe,{className:"pb-2 border-b border-white/5",children:e.jsxs(ce,{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4 text-emerald-500"}),"Curva de Esforço (HHH)"]})}),e.jsx(X,{className:"h-[300px] pt-4",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Qt,{data:N.hhhStats,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorHHH",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:0})]})}),e.jsx(Se,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.05)"}),e.jsx(Ae,{dataKey:"name",stroke:"#6b7280",fontSize:10}),e.jsx(Ie,{stroke:"#6b7280",fontSize:10}),e.jsx(me,{contentStyle:{backgroundColor:"#0f172a",borderColor:"rgba(255,255,255,0.1)",borderRadius:"12px",fontSize:"10px"}}),e.jsx(nt,{type:"monotone",dataKey:"acumulado",stroke:"#3b82f6",fillOpacity:1,fill:"url(#colorHHH)",name:"Acumulado",strokeWidth:2})]})})})]}),e.jsxs(J,{className:"bg-slate-950/40 border-white/5 backdrop-blur-md",children:[e.jsx(oe,{className:"pb-2 border-b border-white/5",children:e.jsxs(ce,{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(_t,{className:"w-4 h-4 text-primary"}),"Distribuição por Função"]})}),e.jsx(X,{className:"h-[300px] flex items-center justify-center",children:N.distribution.length>0?e.jsxs("div",{className:"w-full h-full flex flex-col md:flex-row items-center",children:[e.jsx(de,{width:"70%",height:"100%",children:e.jsxs(sa,{children:[e.jsx(re,{data:N.distribution,cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:5,dataKey:"value",stroke:"none",children:N.distribution.map((k,x)=>e.jsx(ft,{fill:k.color},`cell-${x}`))}),e.jsx(me,{contentStyle:{backgroundColor:"#0f172a",borderColor:"rgba(255,255,255,0.1)",borderRadius:"12px",fontSize:"10px"}})]})}),e.jsx("div",{className:"flex flex-col gap-2 shrink-0 min-w-[140px] border-l border-white/5 pl-4",children:N.distribution.map((k,x)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:k.color}}),e.jsx("span",{className:"text-[9px] font-bold text-slate-400 truncate w-20",children:k.name}),e.jsxs("span",{className:"text-[9px] font-black text-white ml-auto",children:[k.percentage,"%"]})]},x))})]}):e.jsx("div",{className:"text-muted-foreground text-[10px] uppercase font-bold tracking-widest opacity-30",children:"Sem dados de funcionários"})})]}),e.jsxs(J,{className:"bg-slate-950/40 border-white/5 backdrop-blur-md",children:[e.jsx(oe,{className:"pb-2 border-b border-white/5",children:e.jsxs(ce,{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(Es,{className:"w-4 h-4 text-emerald-500"}),"Tendência de Mobilização"]})}),e.jsx(X,{className:"h-[300px] pt-4",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(ms,{data:N.hhhStats,children:[e.jsx(Se,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.05)",vertical:!1}),e.jsx(Ae,{dataKey:"name",stroke:"#6b7280",fontSize:10,tickLine:!1}),e.jsx(Ie,{stroke:"#6b7280",fontSize:10,tickLine:!1}),e.jsx(me,{contentStyle:{backgroundColor:"#0f172a",borderColor:"rgba(255,255,255,0.1)",borderRadius:"12px",fontSize:"10px"}}),e.jsx(ps,{type:"stepAfter",dataKey:"realizado",stroke:"#10b981",strokeWidth:2,dot:{r:3,fill:"#10b981"},name:"Volume HHH"})]})})})]})]})]})}const Gs=["PEDREIRO","SERVENTE","CARPINTEIRO","ARMADOR","ELETRICISTA","ENCANADOR","PINTOR","AZULEJISTA","MESTRE DE OBRAS","ENCARREGADO DE OBRAS","AUXILIAR DE SERVIÇOS GERAIS","OPERADOR DE MÁQUINAS","MOTORISTA","AJUDANTE"],Bs=["ENGENHEIRO CIVIL","ENGENHEIRO","ARQUITETO","TÉCNICO EM SEGURANÇA DO TRABALHO","TECNICO SEGURANÇA","ALMOXARIFE","APONTADOR","ADMINISTRATIVO","RH","GESTOR","SUPERVISOR","COORDENADOR","DIRETOR","ESTAGIÁRIO","DESIGNER","COMMUNITY MANAGER"],Us=s=>{if(!s)return!0;const r=s.toUpperCase();return Gs.some(i=>r.includes(i))?!0:!Bs.some(i=>r.includes(i))},Qs=s=>Us(s)?"MOD":"MOI";function Vs({projectId:s,selectedSiteId:r="all"}){const{employees:i,isLoading:t}=Qe(),{teams:a,isLoading:d}=fa(),f=t||d,y=A.useMemo(()=>{if(!i.length||!a.length)return[];const b=new Set([...a.flatMap(x=>x.members),...a.map(x=>x.supervisorId).filter(Boolean)]),k=i.filter(x=>b.has(x.id)).reduce((x,w)=>{const j=Qs(w.functionName);return x[j]=(x[j]||0)+1,x},{MOD:0,MOI:0});return[{name:"MOD (Direta)",value:k.MOD,color:"#10b981"},{name:"MOI (Indireta)",value:k.MOI,color:"#3b82f6"}]},[i,a]),v=A.useMemo(()=>a.filter(b=>r==="all"||b.siteId===r).map(b=>({name:b.name,total:b.members.length+(b.supervisorId?1:0)})).sort((b,N)=>N.total-b.total).slice(0,10),[a,r]);A.useMemo(()=>{const b=new Set([...a.flatMap(x=>x.members),...a.map(x=>x.supervisorId).filter(Boolean)]),k=i.filter(x=>b.has(x.id)).reduce((x,w)=>{const j=w.functionName||"Outros";return x[j]=(x[j]||0)+1,x},{});return Object.entries(k).map(([x,w])=>({name:x,value:w})).sort((x,w)=>w.value-x.value).slice(0,6)},[i,a]);const p=A.useMemo(()=>{const N=new Set([...a.flatMap(w=>w.members),...a.map(w=>w.supervisorId).filter(Boolean)]).size,k=i.length,x=k>0?N/k*100:0;return{totalAllocated:N,allocationRate:x,activeFronts:a.length}},[i,a]);return f?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] gap-4",children:[e.jsx(ve,{className:"w-10 h-10 animate-spin text-primary"}),e.jsx("p",{className:"text-white animate-pulse font-bold uppercase text-[10px] tracking-widest",children:"Calculando Alocação..."})]}):e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(J,{className:"bg-slate-950/40 border-white/5 backdrop-blur-md",children:e.jsxs(X,{className:"p-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em]",children:"EFETIVO ALOCADO"}),e.jsx("h3",{className:"text-2xl font-black mt-1 text-white",children:p.totalAllocated})]}),e.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center border border-primary/20",children:e.jsx(xt,{className:"text-primary w-5 h-5"})})]})}),e.jsx(J,{className:"bg-slate-950/40 border-white/5 backdrop-blur-md",children:e.jsxs(X,{className:"p-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em]",children:"TAXA DE ALOCAÇÃO"}),e.jsxs("h3",{className:"text-2xl font-black mt-1 text-white",children:[p.allocationRate.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-10 h-10 rounded-xl bg-emerald-500/10 flex items-center justify-center border border-emerald-500/20",children:e.jsx(ut,{className:"text-emerald-500 w-5 h-5"})})]})}),e.jsx(J,{className:"bg-slate-950/40 border-white/5 backdrop-blur-md",children:e.jsxs(X,{className:"p-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-muted-foreground uppercase tracking-[0.2em]",children:"FRENTES ATIVAS"}),e.jsx("h3",{className:"text-2xl font-black mt-1 text-white",children:p.activeFronts})]}),e.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-500/10 flex items-center justify-center border border-blue-500/20",children:e.jsx(Be,{className:"text-blue-500 w-5 h-5"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(J,{className:"bg-slate-950/40 border-white/5 backdrop-blur-md",children:[e.jsx(oe,{className:"pb-2 border-b border-white/5",children:e.jsxs(ce,{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(_t,{className:"w-4 h-4 text-primary"}),"Distribuição MOD/MOI"]})}),e.jsx(X,{className:"h-[300px] pt-4",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(sa,{children:[e.jsx(re,{data:y,cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:5,dataKey:"value",stroke:"none",children:y.map((b,N)=>e.jsx(ft,{fill:b.color},`cell-${N}`))}),e.jsx(me,{contentStyle:{backgroundColor:"#0f172a",borderColor:"rgba(255,255,255,0.1)",borderRadius:"12px",fontSize:"10px"}}),e.jsx(Vt,{verticalAlign:"bottom",height:36,formatter:b=>e.jsx("span",{className:"text-[10px] font-bold uppercase text-slate-400",children:b})})]})})})]}),e.jsxs(J,{className:"bg-slate-950/40 border-white/5 backdrop-blur-md",children:[e.jsx(oe,{className:"pb-2 border-b border-white/5",children:e.jsxs(ce,{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(ht,{className:"w-4 h-4 text-primary"}),"Efetivo por Equipe"]})}),e.jsx(X,{className:"h-[300px] pt-4",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Yt,{data:v,layout:"vertical",children:[e.jsx(Se,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.05)",horizontal:!1}),e.jsx(Ae,{type:"number",hide:!0}),e.jsx(Ie,{dataKey:"name",type:"category",stroke:"#6b7280",fontSize:9,width:100,tickLine:!1,axisLine:!1}),e.jsx(me,{contentStyle:{backgroundColor:"#0f172a",borderColor:"rgba(255,255,255,0.1)",borderRadius:"12px",fontSize:"10px"}}),e.jsx(it,{dataKey:"total",fill:"#8b5cf6",radius:[0,4,4,0],name:"Efetivo"})]})})})]})]})]})}const Le=s=>{const r=s.substring(0,10),[i,t,a]=r.split("-").map(Number);return new Date(i,t-1,a,12,0,0,0)},Ws=({isOpen:s,onClose:r,towerId:i,towerName:t,activityId:a,activityName:d,projectId:f,initialPlannedStart:y,initialPlannedEnd:v,availableTowers:p})=>{const b=pt(),{employees:N}=Qe(),[k,x]=A.useState(y?Le(y):void 0),[w,j]=A.useState(v?Le(v):void 0),[m,E]=A.useState(""),[T,R]=A.useState(""),[F,D]=A.useState("none"),[O,H]=A.useState(!1),[u,P]=A.useState(i?{id:i,name:t}:null),[L,_]=A.useState(!1),{data:C,isLoading:n}=he({queryKey:["production-schedule",u==null?void 0:u.id,a],queryFn:async()=>{if(!(u!=null&&u.id))return null;const l=await ae.get(`/production/schedule?towerId=${u.id}`);return l.data&&Array.isArray(l.data)&&l.data.find(h=>h.activityId===a)||null},enabled:s&&!!(u!=null&&u.id)&&!!a}),{data:c}=he({queryKey:["production-status",u==null?void 0:u.id,a],queryFn:async()=>{if(!(u!=null&&u.id))return null;const l=await ae.get(`/production/tower-status?towerId=${u.id}`);return l.data&&Array.isArray(l.data)&&l.data.find(h=>h.activityId===a)||null},enabled:s&&!!(u!=null&&u.id)&&!!a});A.useEffect(()=>{var l;C&&(i&&(C.plannedStart&&x(Le(C.plannedStart)),C.plannedEnd&&j(Le(C.plannedEnd))),C.plannedQuantity&&E(C.plannedQuantity.toString()),C.plannedHHH&&R(C.plannedHHH.toString())),(l=c==null?void 0:c.metadata)!=null&&l.leadName&&D(c.metadata.leadName)},[C,c,i]);const o=W.useMemo(()=>N.filter(l=>l.canLeadTeam||l.professionalLevel>=3),[N]),g=qe({mutationFn:async()=>{if(!k||!w)throw ee.error("Datas de início e fim são obrigatórias."),new Error("Validation failed");if(!(u!=null&&u.id))throw ee.error("Selecione uma torre."),new Error("Validation failed");const l=h=>{if(!h)return null;const I=h.replace(",","."),M=parseFloat(I);return isNaN(M)?null:M},S=h=>{const I=new Date(h);return I.setHours(12,0,0,0),I.toISOString()};await ae.post("/production/schedule",{towerId:u.id,activityId:a,plannedStart:S(k),plannedEnd:S(w),plannedQuantity:l(m),plannedHHH:l(T)}),F!=="none"&&await ae.post("/production/tower-status",{towerId:u.id,activityId:a,status:(c==null?void 0:c.status)||"PENDING",foremanName:F,metadata:{leadName:F}})},onSuccess:()=>{b.invalidateQueries({queryKey:["production-towers"]}),b.invalidateQueries({queryKey:["production-schedule"]}),ee.success("Programação atualizada com sucesso"),r()},onError:l=>{var S,h;l.message!=="Validation failed"&&ee.error("Erro ao salvar programação: "+(((h=(S=l.response)==null?void 0:S.data)==null?void 0:h.message)||l.message))}});return e.jsx(Kt,{open:s,onOpenChange:r,children:e.jsxs(qt,{className:"sm:max-w-[400px] border-amber-500/20 bg-slate-950 text-slate-100 p-0 overflow-hidden shadow-2xl",children:[e.jsx("div",{className:"bg-amber-500/10 p-6 border-b border-amber-500/10",children:e.jsxs(ba,{children:[e.jsxs($t,{className:"flex items-center gap-3 text-lg font-black text-amber-500 uppercase tracking-widest",children:[e.jsx($e,{className:"w-5 h-5"}),"Programar Atividade"]}),e.jsxs(Gt,{className:"text-xs text-slate-400 font-bold uppercase tracking-wider mt-1",children:[(u==null?void 0:u.name)||"Selecione a Torre"," — ",d]})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[!i&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{className:"text-[10px] font-black uppercase text-slate-500 tracking-widest leading-none",children:"Selecione a Torre"}),e.jsxs(Ee,{open:L,onOpenChange:_,children:[e.jsx(Oe,{asChild:!0,children:e.jsx(B,{variant:"outline",className:"h-11 w-full justify-between bg-slate-900 border-slate-800 text-slate-200 hover:bg-slate-800 px-4 text-xs font-bold",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Tt,{className:"w-3.5 h-3.5 text-amber-500"}),e.jsx("span",{children:u?u.name:"Selecionar Torre..."})]})})}),e.jsx(Me,{className:"w-[340px] p-0 bg-slate-950 border-white/10 shadow-3xl z-50 overflow-hidden",align:"start",children:e.jsxs(Ct,{className:"bg-slate-950 text-slate-200",children:[e.jsx(Dt,{placeholder:"Procurar torre...",className:"h-10 border-none uppercase"}),e.jsxs(Et,{className:"max-h-[250px] overflow-y-auto",children:[e.jsx(Ot,{className:"py-6 text-center text-xs text-slate-500 uppercase font-black px-4",children:"Nenhuma torre encontrada."}),e.jsx(Mt,{heading:"Estruturas do Projeto",children:p==null?void 0:p.map(l=>e.jsxs(Ye,{value:l.objectId,onSelect:()=>{P({id:l.id,name:l.objectId}),_(!1)},className:"flex items-center gap-3 p-3 cursor-pointer hover:bg-white/5 border-b border-white/5 font-bold uppercase",children:[e.jsx("span",{className:"text-xs",children:l.objectId}),e.jsx(ke,{className:Q("ml-auto h-4 w-4 text-amber-500",(u==null?void 0:u.id)===l.id?"opacity-100":"opacity-0")})]},l.id))})]})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{className:"text-[10px] font-black uppercase text-slate-500 tracking-widest",children:"Início Planejado"}),e.jsxs(Ee,{children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(B,{variant:"outline",className:"w-full h-11 bg-slate-900 border-slate-800 justify-start text-xs font-bold hover:bg-slate-800 transition-colors",children:[e.jsx(Rt,{className:"mr-2 h-4 w-4 text-amber-500"}),k?K(k,"dd/MM/yyyy"):"Selecione"]})}),e.jsx(Me,{className:"w-auto p-0 bg-slate-900 border-slate-800",align:"start",children:e.jsx(It,{mode:"single",selected:k,onSelect:x,className:"bg-slate-900 text-slate-100",locale:ie})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{className:"text-[10px] font-black uppercase text-slate-500 tracking-widest",children:"Fim Planejado"}),e.jsxs(Ee,{children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(B,{variant:"outline",className:"w-full h-11 bg-slate-900 border-slate-800 justify-start text-xs font-bold hover:bg-slate-800 transition-colors",children:[e.jsx(Rt,{className:"mr-2 h-4 w-4 text-amber-500"}),w?K(w,"dd/MM/yyyy"):"Selecione"]})}),e.jsx(Me,{className:"w-auto p-0 bg-slate-900 border-slate-800",align:"start",children:e.jsx(It,{mode:"single",selected:w,onSelect:j,className:"bg-slate-900 text-slate-100",locale:ie})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{className:"text-[10px] font-black uppercase text-slate-500 tracking-widest",children:"Liderança Responsável"}),e.jsxs(Ee,{open:O,onOpenChange:H,children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(B,{variant:"outline",className:"h-11 w-full justify-between bg-slate-900 border-slate-800 text-slate-200 hover:bg-slate-800 px-4 text-xs font-bold",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(st,{className:"w-3.5 h-3.5 text-amber-500"}),e.jsx("span",{children:F&&F!=="none"?F:"Selecionar Encarregado..."})]}),e.jsx(Tt,{className:"ml-1 h-3 w-3 opacity-50"})]})}),e.jsx(Me,{className:"w-[340px] p-0 bg-slate-900 border-slate-800 shadow-2xl",align:"start",children:e.jsxs(Ct,{className:"bg-slate-900 text-slate-200",children:[e.jsx(Dt,{placeholder:"Procurar líder...",className:"h-10 border-none"}),e.jsxs(Et,{className:"max-h-[250px] overflow-y-auto",children:[e.jsx(Ot,{className:"py-6 text-center text-xs text-slate-500 uppercase font-black",children:"Nenhum líder encontrado."}),e.jsxs(Mt,{heading:"Corpo Técnico / Campo",children:[e.jsxs(Ye,{value:"none",onSelect:()=>{D("none"),H(!1)},className:"flex items-center p-3 cursor-pointer hover:bg-slate-800",children:[e.jsx("span",{className:"text-xs font-bold uppercase",children:"Nenhum"}),e.jsx(ke,{className:Q("ml-auto h-4 w-4 text-amber-500",F==="none"?"opacity-100":"opacity-0")})]}),o.map(l=>e.jsxs(Ye,{value:l.fullName,onSelect:()=>{D(l.fullName),H(!1)},className:"flex items-center gap-3 p-3 cursor-pointer hover:bg-slate-800",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-amber-500/10 flex items-center justify-center shrink-0",children:e.jsx(st,{className:"w-3 h-3 text-amber-500"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-bold uppercase tracking-tight text-white",children:l.fullName}),e.jsx("span",{className:"text-[9px] text-slate-500 font-bold uppercase",children:l.functionName||"Encarregado"})]}),e.jsx(ke,{className:Q("ml-auto h-4 w-4 text-amber-500",F===l.fullName?"opacity-100":"opacity-0")})]},l.id))]})]})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{className:"text-[10px] font-black uppercase text-slate-500 tracking-widest",children:"Qtd. Planejada"}),e.jsx("input",{type:"number",placeholder:"0.00",className:"w-full h-11 bg-slate-900 border border-slate-800 rounded-lg px-4 text-xs font-black text-white focus:outline-hidden focus:border-amber-500 transition-all font-mono",value:m,onChange:l=>E(l.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{className:"text-[10px] font-black uppercase text-slate-500 tracking-widest",children:"HHH Previsto"}),e.jsx("input",{type:"number",placeholder:"0.00",className:"w-full h-11 bg-slate-900 border border-slate-800 rounded-lg px-4 text-xs font-black text-white focus:outline-hidden focus:border-amber-500 transition-all font-mono",value:T,onChange:l=>R(l.target.value)})]})]})]}),e.jsxs(Bt,{className:"bg-slate-900/40 p-6 flex flex-row items-center justify-end gap-3 border-t border-white/5",children:[e.jsx(B,{variant:"ghost",size:"sm",onClick:r,disabled:g.isPending,className:"text-slate-500 hover:text-white font-bold h-10 px-6 uppercase text-[10px]",children:"Cancelar"}),e.jsxs(B,{size:"sm",onClick:()=>g.mutate(),disabled:g.isPending,className:"bg-amber-600 hover:bg-amber-500 text-black font-black px-10 h-10 text-[11px] uppercase tracking-widest shadow-glow",children:[g.isPending&&e.jsx(ve,{className:"mr-2 h-4 w-4 animate-spin"}),"Salvar Planejamento"]})]})]})})};function Js({isOpen:s,onClose:r,towers:i,categories:t,defaultStartDate:a=new Date,projectId:d}){const f=pt(),{employees:y}=Qe(),[v,p]=A.useState("activities"),[b,N]=A.useState([]),[k,x]=A.useState([]),[w,j]=A.useState([]),[m,E]=A.useState([]),[T,R]=A.useState(""),[F,D]=A.useState(""),O=A.useMemo(()=>Array.from({length:7}).map((n,c)=>Xt(a,c)),[a]),H=A.useMemo(()=>i.filter(n=>{var c;return n.objectId.toLowerCase().includes(F.toLowerCase())||((c=n.trecho)==null?void 0:c.toLowerCase().includes(F.toLowerCase()))}),[i,F]),u=A.useMemo(()=>y.filter(n=>n.canLeadTeam||n.professionalLevel>=3),[y]),P=qe({mutationFn:async()=>{var g,l;if(b.length===0||k.length===0||w.length===0)throw new Error("Preencha todos os campos obrigatórios.");const n=S=>{const h=new Date(S);return h.setHours(12,0,0,0),h},c=n(w.sort((S,h)=>S.getTime()-h.getTime())[0]),o=n(w.sort((S,h)=>S.getTime()-h.getTime())[w.length-1]);for(const S of k){const h=i.find(I=>I.id===S);for(const I of b)if(!((g=h==null?void 0:h.activityStatuses)!=null&&g.some(z=>z.activityId===I&&z.status==="FINISHED"))&&(await ae.post("/production/schedule",{towerId:S,activityId:I,plannedStart:c.toISOString(),plannedEnd:o.toISOString(),plannedQuantity:T?parseFloat(T):null}),await new Promise(z=>setTimeout(z,150)),m.length>0)){const z=(l=y.find(G=>G.id===m[0]))==null?void 0:l.fullName;await ae.post("/production/tower-status",{towerId:S,activityId:I,foremanName:z,metadata:{leadName:z,additionalLeads:m.slice(1).map(G=>{var V;return(V=y.find($=>$.id===G))==null?void 0:V.fullName})}}),await new Promise(G=>setTimeout(G,150))}}},onSuccess:()=>{f.invalidateQueries({queryKey:["production-towers"]}),ee.success(`${k.length*b.length} agendamentos criados com sucesso!`),r(),p("activities"),N([]),x([]),j([])},onError:n=>{ee.error(n.message||"Erro ao salvar programação em lote.")}}),L=n=>{const c=w.find(o=>et(o,n));j(c?w.filter(o=>!et(o,n)):[...w,n])},_=()=>{j(O)},C=n=>{switch(n.overallStatus||"PENDING"){case"FINISHED":return"bg-emerald-500";case"IN_PROGRESS":return"bg-amber-500";default:return"bg-slate-700"}};return e.jsx(Kt,{open:s,onOpenChange:r,children:e.jsxs(qt,{className:"sm:max-w-[700px] bg-slate-950 border-amber-500/20 text-slate-100 p-0 overflow-hidden shadow-2xl flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"bg-amber-500/10 p-6 border-b border-amber-500/10 flex items-center justify-between shrink-0",children:[e.jsxs("div",{children:[e.jsxs($t,{className:"flex items-center gap-3 text-lg font-black text-amber-500 uppercase tracking-widest",children:[e.jsx(bs,{className:"w-5 h-5"}),"Programação em Lote"]}),e.jsxs(Gt,{className:"text-xs text-slate-400 font-bold uppercase tracking-wider mt-1",children:["Agendamento massivo para a ",K(a,"'Semana de' dd/MM",{locale:ie})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:[1,2,3].map(n=>e.jsx("div",{className:Q("w-2.5 h-2.5 rounded-full transition-all duration-300",n===1&&v==="activities"||n===2&&v==="towers"||n===3&&v==="config"?"bg-amber-500 w-8":n===1&&(v==="towers"||v==="config")||n===2&&v==="config"?"bg-emerald-500/50":"bg-white/10")},n))})]}),e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col",children:e.jsxs("div",{className:"p-6 flex-1 overflow-hidden flex flex-col",children:[v==="activities"&&e.jsxs("div",{className:"space-y-4 flex-1 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between shrink-0",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase text-slate-500 tracking-widest",children:"Etapa 1: Selecionar Atividades"}),e.jsxs("span",{className:"text-[10px] font-bold text-amber-500",children:[b.length," selecionadas"]})]}),e.jsx(ze,{className:"flex-1 pr-4",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:t.map(n=>e.jsxs("div",{className:"space-y-3 p-4 rounded-xl bg-white/5 border border-white/5",children:[e.jsx("h5",{className:"text-[10px] font-black text-slate-400 uppercase tracking-tighter border-b border-white/5 pb-2 mb-2",children:n.name}),n.activities.map(c=>e.jsxs("div",{className:"flex items-center space-x-3 group cursor-pointer",onClick:()=>{b.includes(c.id)?N(b.filter(o=>o!==c.id)):N([...b,c.id])},children:[e.jsx(fs,{id:c.id,checked:b.includes(c.id),className:"data-[state=checked]:bg-amber-500 border-white/10"}),e.jsx("label",{htmlFor:c.id,className:"text-xs font-bold text-slate-200 group-hover:text-amber-500 transition-colors cursor-pointer uppercase",children:c.name})]},c.id))]},n.id))})})]}),v==="towers"&&e.jsxs("div",{className:"space-y-4 flex-1 flex flex-col overflow-hidden animate-in slide-in-from-right-4 duration-300",children:[e.jsxs("div",{className:"space-y-3 shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase text-slate-500 tracking-widest",children:"Etapa 2: Selecionar Estruturas"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{variant:"link",className:"text-[9px] font-bold text-slate-400 uppercase",onClick:()=>x(i.map(n=>n.id)),children:"Selecionar Tudo"}),e.jsxs("span",{className:"text-[10px] font-bold text-amber-500",children:[k.length," selecionadas"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(gs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"}),e.jsx(Ge,{placeholder:"Buscar por torre ou trecho...",className:"pl-10 bg-slate-900 border-white/5 text-xs h-10 uppercase font-bold",value:F,onChange:n=>D(n.target.value)})]})]}),e.jsx(ze,{className:"flex-1 h-[400px] pr-4",children:e.jsx("div",{className:"grid grid-cols-3 gap-2 pb-4",children:H.map(n=>{const c=b.filter(l=>{var S;return(S=n.activityStatuses)==null?void 0:S.find(h=>h.activityId===l&&h.status==="FINISHED")}).length,o=c===b.length,g=c>0&&c<b.length;return e.jsxs("div",{className:Q("p-3 rounded-lg border flex flex-col gap-1.5 transition-all cursor-pointer group relative overflow-hidden",k.includes(n.id)?"bg-amber-500/10 border-amber-500/40 shadow-glow-sm":"bg-white/5 border-white/5 hover:border-white/20",o&&"opacity-40 cursor-not-allowed grayscale bg-slate-900"),onClick:()=>{o||(k.includes(n.id)?x(k.filter(l=>l!==n.id)):x([...k,n.id]))},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:Q("w-2 h-2 rounded-full",C(n))}),e.jsx("span",{className:"text-xs font-black uppercase tracking-tighter text-slate-100",children:n.objectId})]}),o?e.jsx(at,{className:"w-3 h-3 text-emerald-500"}):k.includes(n.id)&&e.jsx(at,{className:"w-3 h-3 text-amber-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-[9px] font-bold text-slate-500 uppercase truncate",children:["(",n.towerType||"N/A",")"]}),e.jsx("span",{className:Q("text-[8px] font-bold uppercase tracking-widest mt-0.5 truncate border-t border-white/5 pt-1",o?"text-emerald-500":g?"text-amber-500":"text-slate-600"),children:o?"JÁ CONCLUÍDA":g?"PARCIAL CONCLUÍDA":n.trecho||"Sem trecho"})]})]},n.id)})})})]}),v==="config"&&e.jsxs("div",{className:"space-y-6 flex-1 flex flex-col overflow-hidden animate-in slide-in-from-right-4 duration-300",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase text-slate-500 tracking-widest shrink-0",children:"Etapa 3: Configurar Programação"}),e.jsxs("div",{className:"grid grid-cols-2 gap-8 flex-1 overflow-hidden",children:[e.jsxs("div",{className:"space-y-4 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Z,{className:"text-[10px] font-black uppercase text-amber-500/70 tracking-widest",children:"Calendário de Execução"}),e.jsx(B,{variant:"link",className:"text-[9px] font-bold text-slate-400 h-auto p-0 uppercase",onClick:_,children:"Semana Toda"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:O.map((n,c)=>{const o=w.some(g=>et(g,n));return e.jsxs("button",{onClick:()=>L(n),className:Q("p-3 rounded-lg border text-left flex flex-col gap-0.5 transition-all",o?"bg-amber-500 border-amber-500 text-black shadow-lg":"bg-white/5 border-white/5 text-slate-400 hover:bg-white/10"),children:[e.jsx("span",{className:"text-[8px] font-black uppercase",children:K(n,"EEEE",{locale:ie})}),e.jsx("span",{className:"text-xs font-black",children:K(n,"dd/MM")})]},c)})})]}),e.jsxs("div",{className:"space-y-4 flex flex-col overflow-hidden",children:[e.jsx(Z,{className:"text-[10px] font-black uppercase text-amber-500/70 tracking-widest leading-none",children:"Encarregados (Multi-seleção)"}),e.jsx(ze,{className:"flex-1 pr-4 bg-white/5 rounded-xl border border-white/5 p-2",children:e.jsx("div",{className:"space-y-1",children:u.map(n=>e.jsxs("div",{className:Q("flex items-center gap-3 p-2.5 rounded-lg cursor-pointer transition-colors group",m.includes(n.id)?"bg-amber-500/20 border border-amber-500/30":"hover:bg-white/5"),onClick:()=>{m.includes(n.id)?E(m.filter(c=>c!==n.id)):E([...m,n.id])},children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-amber-500/10 flex items-center justify-center shrink-0",children:e.jsx(st,{className:"w-3 h-3 text-amber-500"})}),e.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden",children:[e.jsx("span",{className:"text-[10px] font-black uppercase text-slate-200 truncate",children:n.fullName}),e.jsx("span",{className:"text-[8px] font-bold text-slate-500 uppercase",children:n.functionName||"Encarregado"})]}),m.includes(n.id)&&e.jsx(ke,{className:"w-3 h-3 text-amber-500"})]},n.id))})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-white/5 shrink-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{className:"text-[10px] font-black uppercase text-slate-500 tracking-widest",children:"Qtd. Planejada (Padrão)"}),e.jsx(Ge,{type:"number",placeholder:"Ex: 1",className:"h-10 bg-slate-900 border-white/5 text-xs font-black font-mono focus:border-amber-500/50",value:T,onChange:n=>R(n.target.value)})]}),e.jsx("div",{className:"flex items-end justify-end",children:e.jsxs("div",{className:"text-right p-3 rounded-lg bg-emerald-500/5 border border-emerald-500/10",children:[e.jsx("span",{className:"block text-[8px] font-black text-slate-500 uppercase",children:"Resumo da Execução"}),e.jsxs("span",{className:"text-[11px] font-black text-emerald-500 uppercase tracking-tighter",children:[k.length," torres x ",b.length," atividades"]}),e.jsxs("div",{className:"text-[10px] font-bold text-slate-400",children:["Total: ",k.length*b.length," Programações"]})]})})]})]})]})}),e.jsxs(Bt,{className:"bg-slate-900/40 p-6 flex items-center justify-between border-t border-white/5 shrink-0",children:[e.jsx(B,{variant:"ghost",size:"sm",className:"text-slate-500 hover:text-white font-bold h-10 px-6 uppercase text-[10px]",onClick:()=>{v==="activities"&&r(),v==="towers"&&p("activities"),v==="config"&&p("towers")},children:v==="activities"?"Cancelar":e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ea,{className:"w-3 h-3"}),"Voltar"]})}),e.jsx(B,{size:"sm",disabled:v==="activities"&&b.length===0||v==="towers"&&k.length===0||P.isPending,onClick:()=>{v==="activities"?p("towers"):v==="towers"?p("config"):P.mutate()},className:Q("font-black px-10 h-10 text-[10px] uppercase tracking-widest transition-all",v==="config"?"bg-emerald-600 hover:bg-emerald-500 text-white shadow-glow":"bg-amber-600 hover:bg-amber-500 text-black shadow-glow"),children:P.isPending?e.jsx(ve,{className:"w-4 h-4 animate-spin"}):v==="config"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-3.5 h-3.5"}),"Finalizar e Agendar"]}):e.jsxs("div",{className:"flex items-center gap-2",children:["Próximo",e.jsx(ga,{className:"w-3.5 h-3.5"})]})})]})]})})}const Xs=W.memo(function({value:r,onValueChange:i,className:t,placeholder:a="Selecione a Empresa"}){const{profile:d}=Ut(),f=(d==null?void 0:d.role)&&["SUPER_ADMIN","SUPER_ADMIN_GOD","ADMIN","TI_SOFTWARE"].includes(d.role),{data:y=[],isLoading:v}=he({queryKey:["companies-list"],queryFn:async()=>(await ae.get("/companies")).data,enabled:!!f,staleTime:300*1e3});return f?e.jsx("div",{className:Q("relative",t),children:e.jsxs(ot,{value:r,onValueChange:i,children:[e.jsx(ct,{className:"bg-slate-900/50 border-white/10 h-10 text-[11px] font-bold uppercase tracking-wider rounded-xl transition-all hover:bg-slate-800/50 hover:border-amber-500/30 focus:ring-amber-500/20",children:e.jsxs("div",{className:"flex items-center gap-2 truncate",children:[v?e.jsx(ve,{className:"w-3.5 h-3.5 animate-spin text-amber-500"}):e.jsx(As,{className:"w-3.5 h-3.5 text-amber-500"}),e.jsx(dt,{placeholder:a})]})}),e.jsxs(mt,{className:"bg-slate-950 border-white/10 backdrop-blur-xl max-h-[300px]",children:[e.jsx(le,{value:"all",className:"text-[11px] font-bold uppercase tracking-wider focus:bg-amber-500 focus:text-black",children:"Todas as Empresas"}),y.map(p=>e.jsx(le,{value:p.id,className:"text-[11px] font-bold uppercase tracking-wider focus:bg-amber-500 focus:text-black",children:p.name},p.id))]})]})}):null}),Gr=()=>{const{profile:s}=Ut(),r=va(),{projects:i}=ja(),[t,a]=A.useState((s==null?void 0:s.projectId)||"all"),[d,f]=A.useState((s==null?void 0:s.companyId)||"all"),{sites:y}=Zt(t!=="all"?t:void 0),[v,p]=A.useState("all");A.useEffect(()=>{t&&t!=="all"?v!=="all"&&!y.find(h=>h.id===v)&&p("all"):p("all")},[y,t,v]);const b=v,[N,k]=A.useState("month"),[x,w]=A.useState("overview"),[j,m]=A.useState(!1),[E,T]=A.useState(!1),[R,F]=A.useState(!1),[D,O]=A.useState(null),[H,u]=A.useState(null),[P,L]=A.useState(null),_=(s==null?void 0:s.role)==="SUPER_ADMIN"||(s==null?void 0:s.role)==="SUPER_ADMIN_GOD"||(s==null?void 0:s.role)==="ADMIN"||!!(s!=null&&s.isSystemAdmin),C=t,n=d,{users:c}=ya(),{data:o,isLoading:g}=he({queryKey:["production-towers",C,n,b],queryFn:async()=>{const h=_?n==="all"?"all":n:s==null?void 0:s.companyId,I=b==="all"?"":b;return(await ae.get(`/production/tower-status?projectId=${C}&companyId=${h}&siteId=${I}`)).data},enabled:!!(s!=null&&s.companyId)||_,staleTime:0,refetchOnWindowFocus:!0,refetchOnMount:!0}),{data:l}=he({queryKey:["production-categories"],queryFn:async()=>(await ae.get("/production/categories")).data}),{data:S}=he({queryKey:["unit-costs",C],queryFn:()=>Da.getUnitCosts(C),enabled:!!C&&C!=="all"});return e.jsxs("div",{className:"h-screen w-full bg-background flex flex-col overflow-hidden font-sans",children:[e.jsxs("header",{className:"shrink-0 flex items-center justify-between px-6 py-4 border-b border-primary/20 bg-background/95 backdrop-blur-xl z-50 shadow-2xl relative",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(B,{variant:"ghost",size:"icon",onClick:()=>r("/producao"),className:"rounded-full hover:bg-primary/10 transition-colors",children:e.jsx(ea,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("h1",{className:"text-xl md:text-2xl font-black tracking-tighter bg-linear-to-r from-primary via-primary to-primary/40 bg-clip-text text-transparent uppercase italic drop-shadow-sm flex items-center gap-2",children:[e.jsx(Na,{className:"h-6 w-6 text-primary"}),"GESTÃO DE PRODUÇÃO"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-1 w-8 bg-primary rounded-full shadow-[0_0_15px_rgba(var(--primary),0.6)]"}),e.jsx("p",{className:"text-muted-foreground text-[10px] font-bold uppercase tracking-[0.3em]",children:"Analytics e Custos"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(J,{className:"glass-card bg-primary/5 hover:bg-primary/10 group relative overflow-hidden h-14 flex items-center px-5 gap-4 border-primary/20",children:[e.jsx("div",{className:"p-2.5 rounded-2xl bg-primary/10 group-hover:bg-primary/20 group-hover:scale-110 transition-all duration-500",children:e.jsx(ut,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex flex-col justify-center",children:[e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest text-muted-foreground/60 transition-colors",children:"Inventário Total"}),e.jsxs("div",{className:"flex items-baseline gap-1.5",children:[e.jsx("span",{className:"text-2xl font-black tracking-tighter italic text-foreground text-shadow-glow",children:(o==null?void 0:o.length)||0}),e.jsx("span",{className:"text-[10px] font-bold text-muted-foreground/80 uppercase tracking-wider",children:"Torres"})]})]})]}),e.jsx("div",{className:"h-8 w-px bg-white/10 mx-1"}),e.jsxs(B,{variant:"outline",size:"sm",className:"border-primary/20 hover:bg-primary/10 text-foreground font-bold h-9 px-4 rounded-lg uppercase text-[10px] tracking-wider",onClick:()=>F(!0),children:[e.jsx(ys,{className:"h-3.5 w-3.5 mr-2 text-primary"}),"Importar"]}),e.jsxs(B,{size:"sm",className:"gap-2 shadow-lg shadow-primary/30 hover:shadow-primary/50 gradient-primary border-none text-primary-foreground font-black uppercase tracking-wider h-9 px-4 rounded-lg text-[10px]",onClick:()=>T(!0),children:[e.jsx(_e,{className:"h-4 w-4"}),"Nova Torre"]}),e.jsx("div",{className:"h-8 w-px bg-white/10 mx-1"}),x==="financial"&&C!=="all"&&e.jsxs(B,{variant:"outline",size:"sm",className:"border-amber-500/30 text-amber-500 hover:bg-amber-500/10 uppercase text-[10px] font-bold tracking-wider animate-in fade-in zoom-in duration-300",onClick:()=>m(!0),children:[e.jsx(Ns,{className:"h-3.5 w-3.5 mr-2"}),"Configurar Custos"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(ot,{value:N,onValueChange:k,children:[e.jsxs(ct,{className:"bg-slate-900/50 border-white/10 h-9 text-[10px] font-bold uppercase tracking-wider w-[140px] rounded-xl hover:bg-slate-800/50 transition-all focus:ring-primary/20",children:[e.jsx(Pt,{className:"w-3.5 h-3.5 mr-2 text-primary"}),e.jsx(dt,{placeholder:"Período"})]}),e.jsxs(mt,{className:"bg-slate-950 border-white/10",children:[e.jsx(le,{value:"week",children:"Semana"}),e.jsx(le,{value:"month",children:"Mês"}),e.jsx(le,{value:"quarter",children:"Trimestre"}),e.jsx(le,{value:"year",children:"Ano"})]})]}),e.jsx(Xs,{value:d,onValueChange:h=>{f(h),h!==d&&a("all")},className:"w-[200px]"}),e.jsx(wa,{value:t,onValueChange:a,companyId:d,className:"w-[200px]"})]})]})]}),e.jsx("main",{className:"flex-1 overflow-auto p-6 bg-black/20",children:e.jsx("div",{className:"max-w-7xl mx-auto space-y-6",children:e.jsxs(vs,{value:x,onValueChange:w,className:"w-full space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs(js,{className:"bg-slate-950/60 border border-white/10 p-1 h-12 w-full max-w-3xl shadow-2xl shadow-black/50 overflow-x-auto rounded-2xl",children:[e.jsxs(Ne,{value:"overview",className:"flex-1 text-[10px] uppercase font-black tracking-[0.2em] data-[state=active]:bg-primary data-[state=active]:text-primary-foreground transition-all duration-300 rounded-xl",children:[e.jsx(ht,{className:"w-3.5 h-3.5 mr-2"}),"Painel HH"]}),e.jsxs(Ne,{value:"physics",className:"flex-1 text-[10px] uppercase font-black tracking-[0.2em] data-[state=active]:bg-primary data-[state=active]:text-primary-foreground transition-all duration-300 rounded-xl",children:[e.jsx(Be,{className:"w-3.5 h-3.5 mr-2"}),"Físico (Curva S)"]}),e.jsxs(Ne,{value:"schedule",className:"flex-1 text-[10px] uppercase font-black tracking-[0.2em] data-[state=active]:bg-emerald-500 data-[state=active]:text-black transition-all duration-300 rounded-xl",children:[e.jsx(Pt,{className:"w-3.5 h-3.5 mr-2"}),"Programação"]}),e.jsxs(Ne,{value:"financial",className:"flex-1 text-[10px] uppercase font-black tracking-[0.2em] data-[state=active]:bg-amber-500 data-[state=active]:text-black transition-all duration-300 rounded-xl",children:[e.jsx(ka,{className:"w-3.5 h-3.5 mr-2"}),"Financeiro"]}),e.jsxs(Ne,{value:"teams",className:"flex-1 text-[10px] uppercase font-black tracking-[0.2em] data-[state=active]:bg-purple-500 data-[state=active]:text-black transition-all duration-300 rounded-xl",children:[e.jsx(xt,{className:"w-3.5 h-3.5 mr-2"}),"Análise Equipe"]})]})}),g?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] gap-4",children:[e.jsx(ve,{className:"h-10 w-10 text-primary animate-spin"}),e.jsx("p",{className:"text-white animate-pulse font-bold",children:"Consolidando dados..."})]}):!o||o.length===0?e.jsx("div",{className:"flex items-center justify-center min-h-[500px]",children:e.jsx(tt,{type:"towers",title:"Nenhuma Torre para Analisar",description:"Não há dados de produção disponíveis para esta obra. Comece cadastrando as torres e subtrechos na tela de planejamento.",onAction:()=>r("/producao"),actionLabel:"Ir para Planejamento"})}):e.jsxs(e.Fragment,{children:[e.jsx(we,{value:"overview",className:"animate-in slide-in-from-left-4 fade-in duration-500 focus-visible:outline-none",children:e.jsx($s,{projectId:C,projects:i,timeRange:N})}),e.jsx(we,{value:"physics",className:"animate-in slide-in-from-left-4 fade-in duration-500 focus-visible:outline-none",children:e.jsx(Ks,{projectId:C,towers:o||[],categories:l||[]})}),e.jsx(we,{value:"financial",className:"animate-in slide-in-from-right-4 fade-in duration-500 focus-visible:outline-none",children:e.jsx(Ia,{projectId:C,towers:o||[],categories:l||[],unitCosts:S||[]})}),e.jsx(we,{value:"schedule",className:"animate-in zoom-in-95 fade-in duration-500 focus-visible:outline-none",children:e.jsx(qs,{towers:o||[],categories:l||[],projectId:C,companyId:s==null?void 0:s.companyId,onEditActivity:(h,I,M,z)=>{const G=o==null?void 0:o.find($=>$.id===h),V=l==null?void 0:l.flatMap($=>$.activities).find($=>$.id===I);(G||!h)&&V&&u({towerId:G?G.id:"",towerName:G?G.objectId:"",activityId:V.id,activityName:V.name,plannedStart:M,plannedEnd:z})},onWeekClick:h=>L(h)})}),e.jsx(we,{value:"teams",className:"animate-in slide-in-from-right-4 fade-in duration-500 focus-visible:outline-none",children:!o||o.length===0?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(tt,{type:"towers",title:"Sem Dados de Equipe",description:"A análise de equipe requer que existam torres e atividades cadastradas para correlacionar o desempenho.",onAction:()=>r("/producao"),actionLabel:"Ir para Produção"})}):!c||c.length===0?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(tt,{type:"workers",title:"Equipes Não Configuradas",description:"Para visualizar a análise de equipe, é necessário alocar funcionários e frentes de trabalho para esta obra.",onAction:()=>r("/usuarios"),actionLabel:"Gerenciar Equipes"})}):e.jsx(Vs,{projectId:C})})]})]})})}),D&&e.jsx(xs,{isOpen:!!D,onClose:()=>O(null),elementId:D.towerId,towerName:D.towerName,towerType:D.towerType,activityId:D.activityId,activityName:D.activityName,currentStatus:D.status,projectId:C}),H&&e.jsx(Ws,{isOpen:!!H,onClose:()=>u(null),towerId:H.towerId,towerName:H.towerName,activityId:H.activityId,activityName:H.activityName,projectId:C,initialPlannedStart:H.plannedStart,initialPlannedEnd:H.plannedEnd,availableTowers:o||[]}),e.jsx(us,{isOpen:E,onClose:()=>T(!1),projectId:C,tower:null}),e.jsx(hs,{isOpen:R,onClose:()=>F(!1),projectId:C}),P&&e.jsx(Js,{isOpen:!!P,onClose:()=>L(null),towers:o||[],categories:l||[],defaultStartDate:P,projectId:C}),C!=="all"&&e.jsx(Ca,{isOpen:j,onClose:()=>m(!1),projectId:C})]})};export{Gr as default};
