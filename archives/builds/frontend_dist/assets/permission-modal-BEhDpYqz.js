import{f as q,r as m,g as be,W as S,j as e,a7 as we,s as B,b7 as oe,F as ce,ay as de,a_ as Ce,b8 as ke,aJ as De,B as D,al as ee,am as se,an as ae,ao as R,b9 as re,a6 as ze,O as _e,aj as Se,a$ as P,D as me,h as Fe,C as te,k as he,l as xe,m as ue,o as pe,e as ie,Q as Ie,q as fe,ar as Te,p as Pe,S as Ee,G as Le,H as Re,I as Me,J as qe,aS as Ae}from"./index-D951x4H-.js";import{R as Oe,a as $e,b as He}from"./index-COevDGDX.js";import{C as ne,a as le,b as Ve,c as T,d as U}from"./context-menu-CftfI8l1.js";import{E as Be}from"./eye-CxUjXe8h.js";import{F as je,P as Ue}from"./pen-C5GdyZXe.js";import{A as Qe}from"./archive-BPtJUZpO.js";import{I as Ze}from"./info-MbzHf59N.js";import{T as ge}from"./trash-2-DD2QlM38.js";import{I as Ge}from"./input-dNnkIPn6.js";import{S as G}from"./scroll-area-C9sC2RNd.js";import{P as J}from"./plus-DmkF01H_.js";import{A as Je}from"./activity-BYx2dwgt.js";import{E as We}from"./ellipsis-CNuBxG9Z.js";import{S as Ke}from"./search-BoEw84GM.js";import{T as W,a as K,b as O,c as M,d as X,e as E}from"./table-UwE0Vej1.js";import{f as Xe}from"./format-CP1OFCPJ.js";import{L as Ye}from"./list-BniZwJ04.js";import{C as Z}from"./checkbox-B9hZgst_.js";import{L as es}from"./lock-BtTOdZOV.js";import{S as ss}from"./save-BcLL5Pf6.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=[["path",{d:"M10 12.5 8 15l2 2.5",key:"1tg20x"}],["path",{d:"m14 12.5 2 2.5-2 2.5",key:"yinavb"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z",key:"1mlx9k"}]],rs=q("FileCode",as);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],is=q("FileImage",ts);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]],ls=q("FileJson",ns);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]],cs=q("FilePlus",os);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],ms=q("File",ds);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=[["path",{d:"M20 7h-3a2 2 0 0 1-2-2V2",key:"x099mo"}],["path",{d:"M9 18a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h7l4 4v10a2 2 0 0 1-2 2Z",key:"18t6ie"}],["path",{d:"M3 7.6v12.8A1.6 1.6 0 0 0 4.6 22h9.8",key:"1nja0z"}]],xs=q("Files",hs);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],ps=q("FolderOpen",us);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],js=q("Folder",fs);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],vs=q("Star",gs);function Gs(r,o,x){const[f,g]=m.useState([]),[n,u]=m.useState(!0),{toast:h}=be(),p=m.useCallback(async()=>{u(!0);try{let l=[];const t=a=>{let i=a;return o&&o!=="all_sites"&&(i=i.eq("site_id",o)),i.order("name",{ascending:!0})};if(r){const a=t(S.from("construction_documents").select("*").eq("project_id",r)),i=t(S.from("construction_documents").select("*").is("project_id",null)),[v,C]=await Promise.all([a,i]);if(v.error)throw v.error;if(C.error)throw C.error;l=[...v.data||[],...C.data||[]],l.sort((L,$)=>L.name.localeCompare($.name))}else{const a=t(S.from("construction_documents").select("*").is("project_id",null)),{data:i,error:v}=await a;if(v)throw v;l=i||[]}const s=l.map(a=>({id:a.id,projectId:a.project_id,siteId:a.site_id,companyId:a.company_id,name:a.name,docType:a.doc_type,version:a.version,fileUrl:a.file_url||"",folderPath:a.folder_path||"/",status:a.status,createdBy:a.created_by,metadata:a.metadata,fileSize:a.file_size||0,createdAt:a.created_at?new Date(a.created_at):new Date,updatedAt:a.updated_at?new Date(a.updated_at):new Date}));g(s)}catch(l){console.error("Error loading documents:",l)}finally{u(!1)}},[r,o]);return m.useEffect(()=>{p()},[p]),{documents:f,isLoading:n,uploadDocument:async(l,t)=>{try{const s=l.name.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9._-]/g,"_"),a=`${t.projectId||"global"}/${Date.now()}_${s}`,{data:i,error:v}=await S.storage.from("documents").upload(a,l);if(v)throw v;const{data:C,error:L}=await S.from("construction_documents").insert({project_id:t.projectId,site_id:t.siteId,company_id:t.companyId,name:t.name||l.name,doc_type:t.docType||"report",version:t.version||1,file_url:a,folder_path:t.folderPath||"/",status:t.status||"pending",file_size:l.size,metadata:t.metadata||{}}).select().single();if(L)throw L;return h({title:"Documento enviado",description:"O arquivo foi registrado com sucesso."}),p(),{success:!0,data:C}}catch(s){return h({title:"Erro no upload",description:s.message,variant:"destructive"}),{success:!1,error:s.message}}},updateDocument:async(l,t)=>{try{const{error:s}=await S.from("construction_documents").update({name:t.name,status:t.status,doc_type:t.docType,version:t.version,folder_path:t.folderPath,metadata:t.metadata,updated_at:new Date().toISOString()}).eq("id",l);if(s)throw s;return h({title:"Documento atualizado",description:"As alterações foram salvas com sucesso."}),p(),{success:!0}}catch(s){return h({title:"Erro ao atualizar",description:s.message,variant:"destructive"}),{success:!1,error:s.message}}},downloadDocument:async l=>{try{const{data:t,error:s}=await S.storage.from("documents").download(l.fileUrl);if(s)throw s;const a=window.URL.createObjectURL(t),i=document.createElement("a");i.href=a,i.setAttribute("download",l.name),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(a),h({title:"Download iniciado",description:`O arquivo ${l.name} está sendo baixado.`})}catch(t){h({title:"Erro no download",description:t.message,variant:"destructive"})}},previewDocument:async l=>{try{const{data:t,error:s}=await S.storage.from("documents").createSignedUrl(l.fileUrl,300);if(s)throw s;window.open(t.signedUrl,"_blank")}catch(t){h({title:"Erro ao visualizar",description:t.message,variant:"destructive"})}},createFolder:async(l,t="/")=>{try{const{data:s,error:a}=await S.from("construction_documents").insert({project_id:r||void 0,site_id:o||void 0,name:l,doc_type:"folder",version:1,file_url:"file://folder",folder_path:t,status:"valid",metadata:{type:"folder"}}).select().single();if(a)throw a;const i=s,v={id:i.id,projectId:i.project_id,siteId:i.site_id,companyId:i.company_id,name:i.name,docType:i.doc_type,version:i.version,fileUrl:i.file_url,folderPath:i.folder_path||"/",status:i.status,createdBy:i.created_by,metadata:i.metadata,fileSize:i.file_size||0,createdAt:new Date(i.created_at),updatedAt:new Date(i.updated_at)};return h({title:"Pasta criada",description:`A pasta "${l}" foi criada com sucesso.`}),p(),{success:!0,data:v}}catch(s){return h({title:"Erro ao criar pasta",description:s.message,variant:"destructive"}),{success:!1,error:s.message}}},deleteDocument:async(l,t)=>{try{const{error:s}=await S.from("construction_documents").delete().eq("id",l);if(s)throw s;return t&&!t.includes("folder")&&await S.storage.from("documents").remove([t]),h({title:"Excluído",description:"Item removido com sucesso."}),p(),{success:!0}}catch(s){return h({title:"Erro ao excluir",description:s.message,variant:"destructive"}),{success:!1,error:s.message}}},refresh:p}}const ys=Oe,Ns=$e,bs=He,ws=r=>{switch(r){case"txt":case"md":case"doc":case"pdf":return ce;case"png":case"jpg":case"jpeg":case"gif":case"svg":return is;case"ts":case"tsx":case"js":case"jsx":case"css":case"html":return rs;case"json":return ls;case"settings":return oe;default:return ms}};function ve({node:r,level:o=0,onSelect:x,selectedId:f,isMultiSelect:g,isSelected:n,getIsSelected:u,onAction:h,onMove:p}){const[y,w]=m.useState(!1),[k,N]=m.useState(!1),F=g?(u==null?void 0:u(r.id))??n:f===r.id,b=r.type==="folder"?y?ps:js:ws(r.extension),[l,t]=m.useState(r.name),s=j=>{if(j==="Renomear"){const I=window.prompt("Digite o novo nome:",l);I&&I!==l&&(t(I),h==null||h("Renomear",{...r,name:I}))}else h==null||h(j,r)},a=j=>{j.dataTransfer.setData("sourceId",r.id),j.dataTransfer.effectAllowed="move"},i=j=>{r.type==="folder"&&(j.preventDefault(),N(!0))},v=()=>{N(!1)},C=j=>{j.preventDefault(),N(!1);const I=j.dataTransfer.getData("sourceId");I&&I!==r.id&&(p==null||p(I,r.id))},L=()=>{if(!g)return null;const j=(u==null?void 0:u(r.id))??n;return e.jsx("div",{className:B("size-3.5 rounded border border-white/20 flex items-center justify-center transition-colors shrink-0",j?"bg-primary border-primary":"bg-transparent"),children:j&&e.jsx("svg",{className:"size-2.5 text-black",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})})},$=()=>e.jsxs(Ve,{className:"glass-card border-white/10 w-48",children:[e.jsxs(T,{onClick:()=>s("Abrir"),className:"gap-2 font-bold",children:[e.jsx(Be,{className:"size-3.5"})," Abrir / Visualizar"]}),r.type==="folder"&&e.jsxs(e.Fragment,{children:[e.jsxs(T,{onClick:()=>s("Novo Arquivo"),className:"gap-2",children:[e.jsx(cs,{className:"size-3.5"})," Novo Arquivo"]}),e.jsxs(T,{onClick:()=>s("Nova Pasta"),className:"gap-2",children:[e.jsx(je,{className:"size-3.5"})," Nova Pasta"]}),e.jsx(U,{className:"bg-white/5"}),e.jsxs(T,{onClick:()=>s("Permissões"),className:"gap-2",children:[e.jsx(de,{className:"size-3.5 text-primary"})," Gerenciar Permissões"]})]}),e.jsx(U,{className:"bg-white/5"}),e.jsxs(T,{onClick:()=>s("Renomear"),className:"gap-2",children:[e.jsx(Ue,{className:"size-3.5"})," Renomear"]}),e.jsxs(T,{onClick:()=>s("Arquivar"),className:"gap-2",children:[e.jsx(Qe,{className:"size-3.5 text-amber-500"})," Arquivar"]}),e.jsx(U,{className:"bg-white/5"}),e.jsxs(T,{onClick:()=>s("Informações"),className:"gap-2",children:[e.jsx(Ze,{className:"size-3.5"})," Informações"]}),e.jsxs(T,{onClick:()=>s("Excluir"),className:"gap-2 text-red-500 hover:text-red-400 focus:text-red-400",children:[e.jsx(ge,{className:"size-3.5"})," Excluir"]}),e.jsx(U,{className:"bg-white/5"}),e.jsxs(T,{onClick:()=>s("Marcar como Importante"),className:"gap-2",children:[e.jsx(vs,{className:"size-3.5 text-amber-500"})," Marcar como Importante"]}),r.type==="folder"&&e.jsxs(T,{onClick:()=>s("Nova Pasta Inteligente"),className:"gap-2",children:[e.jsx(Ce,{className:"size-3.5 text-primary"})," Estrutura Automática"]}),e.jsxs(T,{onClick:()=>s("Mover para Raiz"),className:"gap-2",children:[e.jsx(ke,{className:"size-3.5"})," Mover para Raiz"]})]});return r.type==="folder"&&r.children?e.jsxs(ne,{children:[e.jsxs(ys,{open:y,onOpenChange:w,children:[e.jsx(le,{asChild:!0,children:e.jsxs(Ns,{className:B("flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm transition-colors hover:bg-white/5",F&&"bg-primary/10 text-primary",k&&"bg-primary/20 ring-1 ring-primary/50"),style:{paddingLeft:`${o*16+8}px`},onClick:j=>{j.stopPropagation(),w(!y),x==null||x(r)},onDoubleClick:()=>s("Abrir"),draggable:!0,onDragStart:a,onDragOver:i,onDragLeave:v,onDrop:C,children:[e.jsx(we,{className:B("size-4 shrink-0 text-muted-foreground transition-transform duration-200",y&&"rotate-90")}),e.jsx(L,{}),e.jsx(b,{className:"size-4 shrink-0 text-cyan-500"}),e.jsx("span",{className:"truncate font-medium",children:l})]})}),e.jsx(bs,{children:r.children.map(j=>e.jsx(ve,{node:j,level:o+1,onSelect:x,selectedId:f,isMultiSelect:g,getIsSelected:u,onAction:h,onMove:p},j.id))})]}),e.jsx($,{})]}):e.jsxs(ne,{children:[e.jsx(le,{asChild:!0,children:e.jsxs("button",{className:B("flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm transition-colors hover:bg-white/5",F&&"bg-primary/10 text-primary",k&&"bg-primary/20 ring-1 ring-primary/50"),style:{paddingLeft:`${o*16+28}px`},onClick:()=>x==null?void 0:x(r),onDoubleClick:()=>s("Abrir"),draggable:!0,onDragStart:a,onDragOver:i,onDragLeave:v,onDrop:C,children:[e.jsx(L,{}),e.jsx(b,{className:"size-4 shrink-0 text-muted-foreground"}),e.jsx("span",{className:"truncate",children:l})]})}),e.jsx($,{})]})}function Cs({files:r,onSelect:o,onNewFile:x,onNewFolder:f,onRefresh:g,onAction:n,onMove:u,title:h="Explorer"}){const[p,y]=m.useState(),[w,k]=m.useState(""),[N,F]=m.useState(!1),[b,l]=m.useState(!1),[t,s]=m.useState(new Set),[a,i]=m.useState("type"),[v,C]=m.useState(r);m.useEffect(()=>{C(r)},[r]);const L=c=>{if(b){const d=new Set(t);d.has(c.id)?d.delete(c.id):d.add(c.id),s(d)}else y(c.id),o==null||o(c)},$=(c,d)=>{if(c===d)return;let z=null;const A=Q=>Q.reduce((_,H)=>H.id===c?(z=H,_):H.children?[..._,{...H,children:A(H.children)}]:[..._,H],[]),V=Q=>Q.map(_=>_.id===d&&_.type==="folder"?{..._,children:[..._.children||[],z]}:_.children?{..._,children:V(_.children)}:_),ye=A(v);if(!z)return;const Ne=V(ye);C(Ne),u==null||u(c,d)},j=c=>[...c].sort((d,z)=>a==="name"?d.name.localeCompare(z.name):a==="type"?d.type!==z.type?d.type==="folder"?-1:1:(d.extension||"").localeCompare(z.extension||""):d.id.localeCompare(z.id)).map(d=>d.children?{...d,children:j(d.children)}:d),I=(c,d)=>d?c.reduce((z,A)=>{if(A.name.toLowerCase().includes(d.toLowerCase()))z.push(A);else if(A.children){const V=I(A.children,d);V.length>0&&z.push({...A,children:V})}return z},[]):j(c),Y=I(v,w);return e.jsxs("div",{className:"flex h-full flex-col border-r border-white/5 bg-card/50",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-white/5 px-3 py-2",children:[e.jsxs("button",{onClick:()=>F(!N),onDragOver:c=>{c.preventDefault(),c.currentTarget.classList.add("text-primary")},onDragLeave:c=>{c.currentTarget.classList.remove("text-primary")},onDrop:c=>{c.preventDefault(),c.currentTarget.classList.remove("text-primary");const d=c.dataTransfer.getData("sourceId");d&&(u==null||u(d,"root"))},className:"flex items-center gap-1 text-xs font-bold uppercase tracking-widest text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(De,{className:`size-4 transition-transform ${N?"-rotate-90":""}`}),h]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(D,{variant:"ghost",size:"icon",className:`size-6 hover:bg-white/5 ${b?"text-primary bg-primary/10":""}`,onClick:()=>l(!b),title:"Seleção Múltipla",children:e.jsxs("svg",{className:"size-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}),e.jsx("path",{d:"m9 12 2 2 4-4"})]})}),e.jsx(D,{variant:"ghost",size:"icon",className:"size-6 hover:bg-white/5",onClick:x,title:"Novo Arquivo",children:e.jsx(J,{className:"size-4"})}),e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"icon",className:"size-6 hover:bg-white/5",title:"Mais Opções de Pasta",children:e.jsx(je,{className:"size-4"})})}),e.jsxs(ae,{align:"end",className:"glass-card border-white/10 w-48",children:[e.jsxs(R,{onClick:f,children:[e.jsx(J,{className:"w-3 h-3 mr-2"})," Nova Pasta Simples"]}),e.jsx(re,{}),e.jsxs(R,{onClick:()=>n==null?void 0:n("Nova Pasta Inteligente",{id:"template-obra",name:"Obra",type:"folder"}),children:[e.jsx(Je,{className:"w-3 h-3 mr-2 text-primary"})," Estrutura de Obra"]}),e.jsxs(R,{onClick:()=>n==null?void 0:n("Nova Pasta Inteligente",{id:"template-financeiro",name:"Financeiro",type:"folder"}),children:[e.jsx(ze,{className:"w-3 h-3 mr-2 text-primary"})," Pasta Financeira"]}),e.jsxs(R,{onClick:()=>n==null?void 0:n("Nova Pasta Inteligente",{id:"template-seguranca",name:"Segurança",type:"folder"}),children:[e.jsx(_e,{className:"w-3 h-3 mr-2 text-primary"})," Pasta de Segurança"]})]})]}),e.jsx(D,{variant:"ghost",size:"icon",className:"size-6 hover:bg-white/5",onClick:g,title:"Atualizar",children:e.jsx(Se,{className:"size-4"})}),e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"icon",className:"size-6 hover:bg-white/5",children:e.jsx(We,{className:"size-4"})})}),e.jsxs(ae,{align:"end",className:"glass-card border-white/10",children:[e.jsx(R,{onClick:()=>P.info("Expandindo todas as pastas..."),children:"Expandir Tudo"}),e.jsx(R,{onClick:()=>P.info("Recolhendo todas as pastas..."),children:"Recolher Tudo"}),e.jsx(re,{}),e.jsx(R,{onClick:()=>{i("name"),P.success("Ordenado por nome")},children:"Ordenar por Nome"}),e.jsx(R,{onClick:()=>{i("type"),P.success("Ordenado por tipo")},children:"Ordenar por Tipo"}),e.jsx(R,{onClick:()=>{i("date"),P.success("Ordenado por data")},children:"Ordenar por Data"})]})]})]})]}),!N&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-white/5 p-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ke,{className:"absolute left-2 top-1/2 size-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(Ge,{placeholder:"Buscar arquivos...",value:w,onChange:c=>k(c.target.value),className:"h-8 pl-8 text-sm bg-white/5 border-white/10 focus:border-primary/50"})]})}),e.jsx(G,{className:"flex-1",children:e.jsx("div",{className:"p-2",children:Y.length>0?Y.map(c=>e.jsx(ve,{node:c,onSelect:L,selectedId:b?void 0:p,isMultiSelect:b,getIsSelected:d=>t.has(d),onAction:n,onMove:$},c.id)):e.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground italic",children:"Nenhum arquivo encontrado"})})}),b&&t.size>0&&e.jsx("div",{className:"p-2 border-t border-white/5 bg-primary/5",children:e.jsxs(D,{variant:"ghost",size:"sm",className:"w-full text-[10px] h-7 uppercase font-bold",onClick:()=>s(new Set),children:["Limpar Seleção (",t.size,")"]})})]})]})}function ks({documents:r,onApprove:o,onReject:x}){const f=r.filter(n=>n.status==="pending"),g=r.filter(n=>n.status==="valid"||n.status==="rejected").slice(0,50);return e.jsxs(me,{children:[e.jsx(Fe,{asChild:!0,children:e.jsxs(D,{variant:"outline",className:"w-full gap-2 relative",children:[e.jsx(te,{className:"size-4"}),"Aprovação de Arquivos",f.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-red-500 text-[10px] text-white",children:f.length})]})}),e.jsxs(he,{className:"max-w-4xl max-h-[80vh] flex flex-col glass-card border-white/10",children:[e.jsxs(xe,{children:[e.jsx(ue,{children:"Central de Aprovação"}),e.jsx(pe,{children:"Gerencie a entrada de novos documentos no sistema."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 flex-1 overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col gap-4 overflow-hidden",children:[e.jsxs("h3",{className:"font-bold flex items-center gap-2 text-amber-500",children:[e.jsx(te,{className:"size-4"})," Pendentes (",f.length,")"]}),e.jsx("div",{className:"border border-white/10 rounded-lg overflow-hidden flex-1 bg-black/20",children:e.jsx(G,{className:"h-full",children:f.length===0?e.jsxs("div",{className:"p-8 text-center text-muted-foreground flex flex-col items-center gap-2",children:[e.jsx(ie,{className:"size-8 opacity-20"}),e.jsx("span",{className:"text-xs",children:"Tudo limpo! Nenhum documento pendente."})]}):e.jsxs(W,{children:[e.jsx(K,{children:e.jsxs(O,{className:"hover:bg-transparent",children:[e.jsx(M,{className:"text-xs",children:"Arquivo"}),e.jsx(M,{className:"text-xs text-right",children:"Ações"})]})}),e.jsx(X,{children:f.map(n=>e.jsxs(O,{className:"hover:bg-white/5",children:[e.jsx(E,{className:"py-2",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"font-medium text-sm flex items-center gap-2",children:[e.jsx(ce,{className:"size-3 text-primary"})," ",n.name]}),e.jsxs("div",{className:"flex gap-2 text-[10px] text-muted-foreground",children:[e.jsx("span",{children:Xe(n.createdAt,"dd/MM HH:mm")}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[(n.fileSize/1024).toFixed(0)," KB"]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:n.createdBy})]})]})}),e.jsx(E,{className:"text-right py-2",children:e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx(D,{size:"icon",variant:"ghost",className:"h-7 w-7 text-emerald-500 hover:bg-emerald-500/10 hover:text-emerald-400",onClick:()=>o(n),children:e.jsx(ie,{className:"size-4"})}),e.jsx(D,{size:"icon",variant:"ghost",className:"h-7 w-7 text-red-500 hover:bg-red-500/10 hover:text-red-400",onClick:()=>x(n),children:e.jsx(Ie,{className:"size-4"})})]})})]},n.id))})]})})})]}),e.jsxs("div",{className:"flex flex-col gap-4 overflow-hidden opacity-75",children:[e.jsxs("h3",{className:"font-bold flex items-center gap-2 text-muted-foreground",children:[e.jsx(Ds,{className:"size-4"})," Histórico Recente"]}),e.jsx("div",{className:"border border-white/10 rounded-lg overflow-hidden flex-1 bg-black/20",children:e.jsx(G,{className:"h-full",children:e.jsxs(W,{children:[e.jsx(K,{children:e.jsxs(O,{className:"hover:bg-transparent",children:[e.jsx(M,{className:"text-xs",children:"Arquivo"}),e.jsx(M,{className:"text-xs text-right",children:"Status"})]})}),e.jsx(X,{children:g.map(n=>e.jsxs(O,{className:"hover:bg-transparent opacity-60",children:[e.jsx(E,{className:"py-2 text-xs",children:n.name}),e.jsx(E,{className:"py-2 text-right",children:e.jsx(fe,{variant:"outline",className:`text-[10px] ${n.status==="valid"?"text-emerald-500 border-emerald-500/30":"text-gray-500 border-gray-500/30 font-bold"}`,children:n.status==="valid"?"Aprovado":"Rejeitado"})})]},n.id))})]})})})]})]})]})]})}function Ds(r){return e.jsxs("svg",{...r,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74-2.74L3 12"}),e.jsx("path",{d:"M3 3v9h9"}),e.jsx("path",{d:"M12 7v5l4 2"})]})}const zs=[{id:"1",name:"Projetos",type:"folder",children:[{id:"1-1",name:"Obra Centro Comercial",type:"folder",children:[{id:"1-1-1",name:"Contrato Principal - Centro Comercial",type:"file",extension:"pdf"},{id:"1-1-2",name:"Relatório Mensal - Janeiro 2026",type:"file",extension:"pdf"}]},{id:"1-2",name:"Residencial Vista Mar",type:"folder",children:[{id:"1-2-1",name:"Planta Baixa - Térreo",type:"file",extension:"pdf"},{id:"1-2-2",name:"Aditivo Contratual #32",type:"file",extension:"pdf"}]}]},{id:"2",name:"Documentos Legais",type:"folder",children:[{id:"2-1",name:"Cronograma Físico-Financeiro",type:"file",extension:"pdf"}]},{id:"3",name:"Terramaster",type:"folder",children:[]},{id:"4",name:"config.json",type:"file",extension:"json"}];function Js({onFileSelect:r,onNewFile:o,onNewFolder:x,onRefresh:f,onAction:g,onMove:n,files:u,className:h,documents:p=[],isAdmin:y=!1,onApprove:w=()=>{},onReject:k=()=>{}}){const[N,F]=m.useState("files"),b=u!==void 0?u:zs;return e.jsxs("div",{className:`flex h-full flex-col ${h||""}`,children:[e.jsxs("div",{className:"flex border-b border-white/5 bg-black/20",children:[e.jsx("button",{onClick:()=>F("files"),className:`flex-1 flex justify-center py-3 transition-colors hover:bg-white/5 ${N==="files"?"text-primary border-b-2 border-primary":"text-muted-foreground"}`,children:e.jsx(xs,{className:"size-5"})}),e.jsx("button",{onClick:()=>{F("list"),P.info("Visualização de lista em desenvolvimento")},className:`flex-1 flex justify-center py-3 transition-colors hover:bg-white/5 ${N==="list"?"text-primary border-b-2 border-primary":"text-muted-foreground"}`,children:e.jsx(Ye,{className:"size-5"})}),e.jsx("button",{onClick:()=>{F("settings"),P.info("Configurações do explorador em desenvolvimento")},className:`flex-1 flex justify-center py-3 transition-colors hover:bg-white/5 ${N==="settings"?"text-primary border-b-2 border-primary":"text-muted-foreground"}`,children:e.jsx(oe,{className:"size-5"})})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:N==="files"?e.jsx(Cs,{files:b,onSelect:r,onNewFile:o,onNewFolder:x,onRefresh:f,onAction:g,onMove:n,title:"Explorer"}):e.jsx("div",{className:"flex h-full flex-col gap-4 p-4 text-center text-sm text-muted-foreground",children:N==="settings"&&y?e.jsxs("div",{className:"flex flex-col gap-4 animate-in fade-in",children:[e.jsxs("div",{className:"text-xs uppercase tracking-widest font-bold text-primary flex items-center justify-center gap-2",children:[e.jsx(Te,{className:"size-4"})," Área Administrativa"]}),e.jsx("p",{className:"text-xs",children:"Gerencie a aprovação de arquivos enviados pelos usuários."}),e.jsx(ks,{documents:p,onApprove:w,onReject:k})]}):e.jsx("div",{className:"italic opacity-50",children:N==="list"?"Abra a aba de arquivos para navegar pelos documentos.":"Acesso restrito a administradores."})})})]})}function Ws(r){const[o,x]=m.useState([]),[f,g]=m.useState(!1),[n,u]=m.useState(null),h=m.useCallback(y=>{x(w=>[...w,...y]),P.info(`${y.length} arquivo(s) adicionado(s) à fila de download.`)},[]),p=m.useCallback(async()=>{if(f||o.length===0)return;g(!0);const y=o[0],w=o.slice(1);x(w),u(y.name);try{await r(y),await new Promise(k=>setTimeout(k,1e3))}catch(k){console.error("Download error:",k)}finally{g(!1),u(null)}},[o,f,r]);return m.useEffect(()=>{!f&&o.length>0&&p()},[o,f,p]),{addToQueue:h,queueLength:o.length,isProcessing:f,currentDownload:n}}function Ks({open:r,onOpenChange:o,document:x,onSave:f}){const[g,n]=m.useState([]),[u,h]=m.useState([]),[p,y]=m.useState(""),[w,k]=m.useState(!1);m.useEffect(()=>{(async()=>{const{data:a}=await S.from("permission_levels").select("id, name").order("rank");a&&h(a)})()},[]),m.useEffect(()=>{var s;if(r&&x){const a=((s=x.metadata)==null?void 0:s.permissions)||[];n(Array.isArray(a)?a:[])}},[r,x]);const N=()=>{if(p){if(g.some(s=>s.roleId===p)){P.error("Esta regra já existe.");return}n(s=>[...s,{roleId:p,canView:!0,canEdit:!1,canDelete:!1}]),y("")}},F=s=>{n(a=>a.filter(i=>i.roleId!==s))},b=(s,a,i)=>{n(v=>v.map(C=>C.roleId===s?{...C,[a]:i}:C))},l=async()=>{k(!0);try{await f(x.id,{permissions:g}),o(!1),P.success("Permissões atualizadas com sucesso!")}catch{P.error("Erro ao salvar permissões.")}finally{k(!1)}},t=s=>{var a;return((a=u.find(i=>i.name===s||i.id===s))==null?void 0:a.name)||s};return e.jsx(me,{open:r,onOpenChange:o,children:e.jsxs(he,{className:"max-w-xl glass-card border-white/10",children:[e.jsxs(xe,{children:[e.jsxs(ue,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"size-5 text-primary"}),"Permissões da Pasta"]}),e.jsxs(pe,{children:["Configurando acesso para: ",e.jsx("span",{className:"font-bold text-white",children:x==null?void 0:x.name})]})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(Pe,{children:"Adicionar Regra para Cargo/Nível"}),e.jsxs(Ee,{value:p,onValueChange:y,children:[e.jsx(Le,{className:"industrial-input",children:e.jsx(Re,{placeholder:"Selecione um nível..."})}),e.jsx(Me,{children:u.filter(s=>!g.some(a=>a.roleId===s.name)).map(s=>e.jsx(qe,{value:s.name,children:s.name},s.id))})]})]}),e.jsxs(D,{onClick:N,disabled:!p,className:"gradient-primary mb-0.5",children:[e.jsx(J,{className:"size-4 mr-2"})," Adicionar"]})]}),e.jsx("div",{className:"border border-white/10 rounded-lg overflow-hidden bg-black/20",children:e.jsxs(W,{children:[e.jsx(K,{children:e.jsxs(O,{className:"hover:bg-transparent",children:[e.jsx(M,{children:"Nível"}),e.jsx(M,{className:"text-center w-20",children:"Ver"}),e.jsx(M,{className:"text-center w-20",children:"Editar"}),e.jsx(M,{className:"text-center w-20",children:"Excluir"}),e.jsx(M,{className:"w-10"})]})}),e.jsx(X,{children:g.length===0?e.jsx(O,{children:e.jsx(E,{colSpan:5,className:"text-center py-8 text-muted-foreground italic",children:"Nenhuma regra definida. Acesso padrão do sistema."})}):g.map(s=>e.jsxs(O,{className:"hover:bg-white/5",children:[e.jsx(E,{className:"font-medium",children:e.jsx(fe,{variant:"outline",children:t(s.roleId)})}),e.jsx(E,{className:"text-center",children:e.jsx(Z,{checked:s.canView,onCheckedChange:a=>b(s.roleId,"canView",a)})}),e.jsx(E,{className:"text-center",children:e.jsx(Z,{checked:s.canEdit,onCheckedChange:a=>b(s.roleId,"canEdit",a)})}),e.jsx(E,{className:"text-center",children:e.jsx(Z,{checked:s.canDelete,onCheckedChange:a=>b(s.roleId,"canDelete",a)})}),e.jsx(E,{children:e.jsx(D,{size:"icon",variant:"ghost",className:"h-6 w-6 text-red-500 hover:text-red-400",onClick:()=>F(s.roleId),children:e.jsx(ge,{className:"size-3"})})})]},s.roleId))})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground bg-primary/5 p-3 rounded border border-primary/10",children:[e.jsx(es,{className:"size-3"}),e.jsx("span",{children:"Admins e Super Admins possuem acesso total irrestrito independente destas regras."})]})]}),e.jsxs(Ae,{children:[e.jsx(D,{variant:"ghost",onClick:()=>o(!1),children:"Cancelar"}),e.jsxs(D,{onClick:l,disabled:w,className:"gradient-primary",children:[w?e.jsx("span",{className:"animate-spin mr-2",children:"⏳"}):e.jsx(ss,{className:"size-4 mr-2"}),"Salvar Permissões"]})]})]})})}export{Js as D,Ks as F,Ws as a,Gs as u};
