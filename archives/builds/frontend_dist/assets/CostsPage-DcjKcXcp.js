import{ac as O,r as o,a$ as S,t as u,j as e,D as E,k as A,l as F,m as M,o as q,p as y,S as R,G as T,H as K,I as L,J as m,B as p,L as k,aS as $,u as z,a as U,w as B,bI as G,a0 as Q}from"./index-D951x4H-.js";import{u as w,a as P}from"./CartesianGrid-HrqNXgEf.js";import{D as I,P as V,b as H,k as _}from"./CostConfigurationModal-C9OI4zOa.js";import{P as J}from"./ProjectEmptyState-CRpC4Dgy.js";import{I as D}from"./input-dNnkIPn6.js";import{P as W}from"./plus-DmkF01H_.js";import{C as X}from"./circle-alert-BlgUQYiE.js";import{T as Y}from"./trash-2-DD2QlM38.js";import{S as Z}from"./settings-2-CrLI_2YT.js";import"./AreaChart-D9h5uedO.js";import"./card-BTHGlYFz.js";import"./format-CP1OFCPJ.js";import"./subDays-HHYU8WMe.js";import"./BarChart-DjRXQRXs.js";import"./pt-BR-B9S-fQgu.js";import"./save-BcLL5Pf6.js";import"./upload-D2Q7C-3S.js";const ee=({isOpen:s,onClose:h,projectId:r})=>{const g=O(),[i,b]=o.useState(""),[c,l]=o.useState(""),[d,x]=o.useState(""),[t,n]=o.useState("NONE"),{data:j=[],isLoading:C}=w({queryKey:["delay-reasons",r],queryFn:async()=>!r||r==="all"?[]:(await u.get(`/production/delay-reasons?projectId=${r}`)).data,enabled:s&&r!=="all"}),N=P({mutationFn:async()=>{if(!i||!c||!d)throw new Error("Preencha todos os campos");await u.post(`/production/delay-reasons?projectId=${r}`,{code:i,description:c,dailyCost:parseFloat(d),category:t})},onSuccess:()=>{S.success("Motivo adicionado"),g.invalidateQueries({queryKey:["delay-reasons"]}),b(""),l(""),x(""),n("NONE")},onError:a=>S.error("Erro ao adicionar: "+a.message)}),f=P({mutationFn:async a=>{await u.delete(`/production/delay-reasons?id=${a}`)},onSuccess:()=>{S.success("Motivo removido"),g.invalidateQueries({queryKey:["delay-reasons"]})}});return e.jsx(E,{open:s,onOpenChange:h,children:e.jsxs(A,{className:"sm:max-w-[700px] bg-[#0a0806] border-white/10 text-white",children:[e.jsxs(F,{children:[e.jsxs(M,{className:"flex items-center gap-2 text-xl font-bold text-amber-500",children:[e.jsx(I,{className:"h-5 w-5"}),"Catálogo de Custos de Atraso"]}),e.jsx(q,{className:"text-white/50",children:"Cadastre os motivos de impedimento e seus respectivos custos diários para esta obra."})]}),e.jsxs("div",{className:"grid gap-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-3 p-3 rounded-lg bg-white/5 border border-white/10 items-end",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(y,{className:"text-[10px] uppercase font-bold text-amber-500/80",children:"Código"}),e.jsx(D,{value:i,onChange:a=>b(a.target.value),placeholder:"Ex: CHUVA",className:"h-8 bg-black/40 border-white/10 text-xs"})]}),e.jsxs("div",{className:"col-span-4",children:[e.jsx(y,{className:"text-[10px] uppercase font-bold text-amber-500/80",children:"Descrição"}),e.jsx(D,{value:c,onChange:a=>l(a.target.value),placeholder:"Descrição detalhada",className:"h-8 bg-black/40 border-white/10 text-xs"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(y,{className:"text-[10px] uppercase font-bold text-amber-500/80",children:"Categoria"}),e.jsxs(R,{value:t,onValueChange:a=>n(a),children:[e.jsx(T,{className:"h-8 bg-black/40 border-white/10 text-xs",children:e.jsx(K,{})}),e.jsxs(L,{className:"bg-slate-900 border-slate-800",children:[e.jsx(m,{value:"NONE",children:"Nenhum"}),e.jsx(m,{value:"OWNER",children:"Proprietário"}),e.jsx(m,{value:"CONTRACTOR",children:"Empreiteira"}),e.jsx(m,{value:"PROJECT",children:"Projeto"}),e.jsx(m,{value:"WORK",children:"Obra/Clima"})]})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(y,{className:"text-[10px] uppercase font-bold text-amber-500/80",children:"Custo/Dia (R$)"}),e.jsx(D,{type:"number",value:d,onChange:a=>x(a.target.value),placeholder:"0.00",className:"h-8 bg-black/40 border-white/10 text-xs"})]}),e.jsx("div",{className:"col-span-2",children:e.jsxs(p,{size:"sm",onClick:()=>N.mutate(),disabled:N.isPending,className:"w-full h-8 bg-amber-600 hover:bg-amber-500 font-bold text-xs",children:[e.jsx(W,{className:"h-3 w-3 mr-1"})," Adicionar"]})})]}),e.jsxs("div",{className:"border border-white/10 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-12 bg-white/5 p-2 text-[10px] font-bold uppercase text-white/50 border-b border-white/10",children:[e.jsx("div",{className:"col-span-2",children:"Código"}),e.jsx("div",{className:"col-span-4",children:"Descrição"}),e.jsx("div",{className:"col-span-2",children:"Categoria"}),e.jsx("div",{className:"col-span-2 text-right",children:"Custo Diário"}),e.jsx("div",{className:"col-span-2 text-center",children:"Ações"})]}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto",children:C?e.jsx("div",{className:"p-4 text-center text-white/30",children:e.jsx(k,{className:"h-5 w-5 animate-spin mx-auto"})}):j.length===0?e.jsxs("div",{className:"p-8 text-center text-white/30 flex flex-col items-center gap-2",children:[e.jsx(X,{className:"h-8 w-8 opacity-20"}),"Nenhum motivo cadastrado."]}):j.map(a=>e.jsxs("div",{className:"grid grid-cols-12 p-2 text-xs border-b border-white/5 hover:bg-white/5 items-center transition-colors",children:[e.jsx("div",{className:"col-span-2 font-mono text-amber-500",children:a.code}),e.jsx("div",{className:"col-span-4 truncate",title:a.description,children:a.description}),e.jsx("div",{className:"col-span-2",children:e.jsx("span",{className:"px-1.5 py-0.5 rounded bg-white/10 text-[10px] font-bold text-white/70",children:a.category})}),e.jsx("div",{className:"col-span-2 text-right font-mono text-green-400",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a.dailyCost)}),e.jsx("div",{className:"col-span-2 flex justify-center",children:e.jsx(p,{variant:"ghost",size:"icon",className:"h-6 w-6 text-red-400 hover:text-red-300 hover:bg-red-900/20",onClick:()=>f.mutate(a.id),children:e.jsx(Y,{className:"h-3 w-3"})})})]},a.id))})]})]}),e.jsx($,{children:e.jsx(p,{variant:"ghost",onClick:h,className:"text-white/50 hover:text-white",children:"Fechar"})})]})})};function Ne(){var a;const{profile:s}=z(),h=U(),{projects:r}=B(),g=(s==null?void 0:s.role)==="SUPER_ADMIN"||(s==null?void 0:s.role)==="SUPER_ADMIN_GOD"||(s==null?void 0:s.role)==="ADMIN"||!!(s!=null&&s.isSystemAdmin),[i,b]=o.useState((s==null?void 0:s.projectId)||"all"),[c,l]=o.useState(!1),[d,x]=o.useState(!1),t=i,{data:n,isLoading:j}=w({queryKey:["production-towers",t,s==null?void 0:s.companyId],queryFn:async()=>{const v=g?"all":s==null?void 0:s.companyId;return(await u.get(`/production/tower-status?projectId=${t}&companyId=${v}`)).data},enabled:!!(s!=null&&s.companyId)}),{data:C}=w({queryKey:["production-categories"],queryFn:async()=>(await u.get("/production/categories")).data}),{data:N}=w({queryKey:["unit-costs",t],queryFn:()=>_.getUnitCosts(t),enabled:!!t&&t!=="all"}),f=((a=r.find(v=>v.id===t))==null?void 0:a.name)||"Todas as Obras";return e.jsxs("div",{className:"h-screen w-full bg-background flex flex-col overflow-hidden font-sans",children:[e.jsxs("header",{className:"shrink-0 flex items-center justify-between px-6 py-4 border-b border-primary/20 bg-background/95 backdrop-blur-xl z-50 shadow-2xl relative",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("h1",{className:"text-xl md:text-2xl font-black tracking-tighter bg-linear-to-r from-amber-500 via-yellow-500 to-amber-700 bg-clip-text text-transparent uppercase italic drop-shadow-sm flex items-center gap-2",children:[e.jsx(G,{className:"h-6 w-6 text-amber-500"}),"GESTÃO DE CUSTOSsss"]}),e.jsxs("p",{className:"text-muted-foreground text-[10px] font-bold uppercase tracking-[0.3em] pl-1",children:["Financeiro de Produ222ção11111 - ",f]})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(p,{variant:"outline",size:"sm",className:"border-rose-500/30 text-rose-500 hover:bg-rose-500/10 uppercase text-[10px] font-bold tracking-wider",onClick:()=>x(!0),disabled:t==="all",children:[e.jsx(I,{className:"h-3.5 w-3.5 mr-2"}),"Multas"]}),e.jsxs(p,{variant:"outline",size:"sm",className:"border-amber-500/30 text-amber-500 hover:bg-amber-500/10 uppercase text-[10px] font-bold tracking-wider",onClick:()=>l(!0),disabled:t==="all",children:[e.jsx(Z,{className:"h-3.5 w-3.5 mr-2"}),"Configurar Custos"]}),e.jsx(Q,{value:i,onValueChange:b,className:"w-[200px]"})]})]}),e.jsx("main",{className:"flex-1 overflow-auto p-6 bg-black/20",children:e.jsx("div",{className:"max-w-7xl mx-auto space-y-6",children:j?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] gap-4",children:[e.jsx(k,{className:"h-10 w-10 text-amber-500 animate-spin"}),e.jsx("p",{className:"text-white animate-pulse font-bold",children:"Calculando financeiro..."})]}):!n||n.length===0?e.jsx("div",{className:"flex items-center justify-center min-h-[500px]",children:e.jsx(J,{type:"towers",title:"Sem Dados Financeiros",description:"Para visualizar a gestão de custos, é necessário que a obra possua torres e atividades cadastradas com seus respectivos pesos (Concreto, Aço, Estrutura).",onAction:()=>h("/producao"),actionLabel:"Ir para Produção"})}):e.jsx(V,{projectId:t,towers:n||[],categories:C||[],unitCosts:N||[]})})}),t!=="all"&&e.jsxs(e.Fragment,{children:[e.jsx(H,{isOpen:c,onClose:()=>l(!1),projectId:t}),e.jsx(ee,{isOpen:d,onClose:()=>x(!1),projectId:t})]})]})}export{Ne as default};
