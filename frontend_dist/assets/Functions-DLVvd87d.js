import{f as he,N as fe,u as ge,r as m,g as ve,j as e,L as G,i as L,d as F,B as d,D as je,h as be,k as Ne,l as ye,m as we,n as A,o as Ce,p as v,q as B,s as Te,t as Le}from"./index-D951x4H-.js";import{u as Fe}from"./useJobFunctions-BUngp12J.js";import{I as k}from"./input-dNnkIPn6.js";import{C as ke,a as Ee}from"./card-BTHGlYFz.js";import{C as z}from"./checkbox-B9hZgst_.js";import{S as U}from"./separator-B22JG5bU.js";import{T as Ie,a as Se,b as V,c as j,d as De,e as b}from"./table-UwE0Vej1.js";import{C as Ae}from"./ConfirmationDialog-96fSVVNc.js";import{F as Oe,u as Me,m as _e}from"./jobSignals-BUdvneDr.js";import{F as Pe}from"./file-up-BAmu6W7r.js";import{P as qe}from"./plus-DmkF01H_.js";import{T as Re}from"./trending-up-BwuTo0m4.js";import{C as H}from"./crown-CP1ihsrK.js";import{S as Ge}from"./search-BoEw84GM.js";import{C as Be}from"./copy-CXglQ41p.js";import{P as ze}from"./pencil-DX9IZKx2.js";import{T as Ue}from"./trash-2-DD2QlM38.js";import"./alert-dialog-qR-bbYaw.js";import"./triangle-alert-BPKdZxxI.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],He=he("Globe",Ve);function ma(){fe();const{functions:$,isLoading:J,createFunction:W,updateFunction:Q,deleteFunction:X}=Fe(),{profile:n}=ge(),[E,Y]=m.useState(""),[Z,u]=m.useState(!1),[x,N]=m.useState(null),[O,M]=m.useState(!1),_=m.useRef(null),[i,c]=m.useState({name:"",description:"",canLeadTeam:!1,hierarchyLevel:0,isTemplate:!1}),[h,P]=m.useState({open:!1,title:"",description:"",onConfirm:()=>{},variant:"default"}),{toast:o}=ve(),K=5*1024*1024,ee=a=>a.replace(/^[=+\-@\t\r]/g,"").trim(),ae=a=>{var p;const s=(p=a.target.files)==null?void 0:p[0];if(!s)return;if(s.size>K){o({title:"Arquivo muito grande",description:"O arquivo deve ter no máximo 5MB",variant:"destructive"}),a.target.value="";return}if(!s.name.toLowerCase().endsWith(".csv")&&s.type!=="text/csv"){o({title:"Formato inválido",description:"Apenas arquivos CSV são permitidos",variant:"destructive"}),a.target.value="";return}const l=new FileReader;l.onload=async t=>{var R;const w=(R=t.target)==null?void 0:R.result;if(!w)return;const f=w.split(`
`).filter(r=>r.trim()),ne=f[0].toLowerCase().includes("nome")?1:0,C=[];for(let r=ne;r<f.length;r++){const g=f[r].trim(),le=g.includes(";")?";":",",ce=g.split(le).map(xe=>ee(xe.replace(/^["']|["']$/g,""))),[S,de,D,me]=ce;if(!S||S.length<2)continue;const T=D==null?void 0:D.toLowerCase(),pe=T==="sim"||T==="true"||T==="1"||T==="s",ue=parseInt(me||"0")||0;C.push({name:S.trim(),description:de||"",canLeadTeam:pe,hierarchyLevel:ue,companyId:(n==null?void 0:n.companyId)||null})}if(C.length===0){o({title:"Nenhum dado válido encontrado",variant:"destructive"});return}setIsEnqueuing(!0);try{const{data:r,error:g}=await Le.post("jobs",{type:"JOB_FUNCTION_IMPORT",payload:{data:C}});if(g)throw new Error(g.message);if(!r)throw new Error("Falha ao enfileirar job");Me(r.id,r),_e(r.id),o({title:"Importação iniciada",description:`${C.length} funções estão sendo processadas em segundo plano.`})}catch(r){o({title:"Erro na importação",description:r.message,variant:"destructive"})}finally{setIsEnqueuing(!1)}},l.readAsText(s,"UTF-8"),a.target.value=""},se=()=>{const a=["SEQUENCIA","Funcao","Descricao","Pode Liderar? (sim/nao)","Nivel (Peso Hierarquico 0-100)","Mao de Obra (MOI/MOD)"],s=[["1","Encarregado","Líder de equipe de campo","sim","6","MOI"],["2","Ajudante","Auxiliar em diversas tarefas","nao","1","MOD"]],l=[a.join(";"),...s.map(f=>f.join(";"))].join(`
`),p=new Blob(["\uFEFF"+l],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a"),w=URL.createObjectURL(p);t.setAttribute("href",w),t.setAttribute("download","template_importacao_funcoes.csv"),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t),o({title:"Template baixado",description:"Preencha o arquivo para importar seus cargos."})},te=["SUPER_ADMIN_GOD","SOCIO_DIRETOR","TI_SOFTWARE","ADMIN","HELPER_SYSTEM"],y=(n==null?void 0:n.role)&&te.includes(n.role),re=async a=>{if(a.preventDefault(),!i.name.trim()){o({title:"Erro",description:"O nome da função é obrigatório",variant:"destructive"});return}M(!0);try{const s={...i,companyId:i.isTemplate?null:n==null?void 0:n.companyId};x?(await Q(x.id,s)).success&&o({title:"Função atualizada!",description:`A função "${i.name}" foi atualizada com sucesso.`}):(await W(s)).success&&o({title:"Função criada!",description:`A função "${i.name}" foi adicionada com sucesso.`}),I()}finally{M(!1)}},ie=async a=>{P({open:!0,title:"Excluir Função",description:`Deseja realmente remover a função "${a.name}"? Esta ação não pode ser desfeita e pode afetar funcionários vinculados.`,variant:"destructive",onConfirm:async()=>{(await X(a.id)).success&&o({title:"Função removida",description:`A função "${a.name}" foi removida.`})}})},oe=a=>{N(null),c({name:`${a.name} (Cópia)`,description:a.description||"",canLeadTeam:a.canLeadTeam,hierarchyLevel:a.hierarchyLevel||a.level||0,isTemplate:!1}),u(!0),o({title:"Modelo copiado",description:"Ajuste os detalhes e salve para criar na sua empresa."})},I=()=>{c({name:"",description:"",canLeadTeam:!1,hierarchyLevel:0,isTemplate:!1}),N(null),u(!1)},q=$.filter(a=>a.name.toLowerCase().includes(E.toLowerCase()));return J?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(G,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6 animate-fade-in pr-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold gradient-text",children:"Gestão de Funções"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie cargos, hierarquia e permissões de liderança"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(L.value||F("functions.update"))&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{variant:"outline",onClick:()=>{var a;return(a=_.current)==null?void 0:a.click()},className:"border-primary/20 hover:bg-primary/5 text-primary-foreground/80",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Importar CSV"]}),e.jsxs(d,{variant:"outline",onClick:se,className:"border-white/10 hover:bg-white/5",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Template"]}),e.jsx("input",{type:"file",ref:_,className:"hidden",accept:".csv",onChange:ae})]}),(L.value||F("functions.create"))&&e.jsxs(je,{open:Z,onOpenChange:a=>{a||I(),u(a)},children:[e.jsx(be,{asChild:!0,children:e.jsxs(d,{className:"gradient-primary text-white shadow-glow border-none",children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Nova Função"]})}),e.jsxs(Ne,{className:"max-w-md",children:[e.jsxs(ye,{children:[e.jsxs(we,{className:"flex items-center gap-2 text-2xl font-bold",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg gradient-primary flex items-center justify-center shadow-glow",children:e.jsx(A,{className:"text-white w-6 h-6"})}),x?"Editar Função":"Nova Função"]}),e.jsx(Ce,{className:"text-muted-foreground pt-1",children:"Defina as atribuições e o nível hierárquico da função."})]}),e.jsxs("form",{onSubmit:re,className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-semibold text-sm uppercase tracking-wider",children:[e.jsx(A,{className:"w-4 h-4"}),"Identificação"]}),e.jsx(U,{className:"bg-white/10"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"name",className:"text-xs uppercase text-muted-foreground font-bold",children:"Nome da Função *"}),e.jsx(k,{id:"name",value:i.name,onChange:a=>c(s=>({...s,name:a.target.value})),placeholder:"Ex: Engenheiro Civil",className:"industrial-input h-10",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"description",className:"text-xs uppercase text-muted-foreground font-bold",children:"Descrição"}),e.jsx(k,{id:"description",value:i.description,onChange:a=>c(s=>({...s,description:a.target.value})),placeholder:"Breve descrição das responsabilidades",className:"industrial-input h-10"})]})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-500 font-semibold text-sm uppercase tracking-wider",children:[e.jsx(Re,{className:"w-4 h-4"}),"Hierarquia e Liderança"]}),e.jsx(U,{className:"bg-white/10"}),y&&!x&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-primary/5 border border-primary/10 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(He,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(v,{htmlFor:"isTemplate",className:"cursor-pointer font-bold text-sm",children:"Função Modelo (Global)"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"Disponível para todas as empresas copiarem"})]})]}),e.jsx(z,{id:"isTemplate",checked:i.isTemplate,onCheckedChange:a=>c(s=>({...s,isTemplate:a}))})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{className:"w-5 h-5 text-amber-500"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(v,{htmlFor:"canLeadTeam",className:"cursor-pointer font-bold text-sm",children:"Poder de Liderança"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"Esta função pode gerenciar equipes de campo"})]})]}),e.jsx(z,{id:"canLeadTeam",checked:i.canLeadTeam,onCheckedChange:a=>c(s=>({...s,canLeadTeam:a}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"level",className:"text-xs uppercase text-muted-foreground font-bold flex items-center gap-2",children:"Nível de Peso Hierárquico (0-100)"}),e.jsx(k,{id:"level",type:"number",min:"0",max:"100",value:i.hierarchyLevel,onChange:a=>c(s=>({...s,hierarchyLevel:parseInt(a.target.value)||0})),className:"industrial-input h-10"})]})]}),e.jsxs("div",{className:"pt-4 flex gap-3",children:[e.jsx(d,{type:"button",variant:"outline",onClick:I,className:"flex-1 h-11",children:"Cancelar"}),e.jsxs(d,{type:"submit",className:"flex-1 h-11 gradient-primary shadow-glow",disabled:O,children:[O?e.jsx(G,{className:"w-4 h-4 mr-2 animate-spin"}):null,x?"Salvar Alterações":i.isTemplate?"Criar Modelo Global":"Criar Função"]})]})]})]})]})]})]}),e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(k,{placeholder:"Buscar funções...",value:E,onChange:a=>Y(a.target.value),className:"pl-10 industrial-input"})]}),q.length===0?e.jsx(ke,{className:"glass-card",children:e.jsxs(Ee,{className:"py-12 text-center",children:[e.jsx(A,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"}),e.jsx("h3",{className:"text-lg font-medium",children:"Nenhuma função encontrada"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:E?"Tente outro termo de busca":"Crie sua primeira função para começar"})]})}):e.jsx("div",{className:"relative rounded-2xl border border-white/10 bg-card/30 backdrop-blur-md overflow-hidden shadow-premium",children:e.jsx("div",{className:"max-h-[calc(100vh-320px)] overflow-y-auto custom-scrollbar",children:e.jsxs(Ie,{children:[e.jsx(Se,{className:"sticky top-0 z-10 bg-background/60 backdrop-blur-xl border-b border-white/10",children:e.jsxs(V,{className:"hover:bg-transparent border-white/10 border-b-0",children:[e.jsx(j,{className:"w-[80px] text-[10px] font-black uppercase tracking-widest text-muted-foreground/50 py-5 px-6",children:"LVL"}),e.jsx(j,{className:"text-[10px] font-black uppercase tracking-widest text-muted-foreground/50 py-5 px-6",children:"Função & Atribuições"}),e.jsx(j,{className:"hidden md:table-cell text-[10px] font-black uppercase tracking-widest text-muted-foreground/50 py-5 px-6",children:"Descrição Técnica"}),e.jsx(j,{className:"text-center text-[10px] font-black uppercase tracking-widest text-muted-foreground/50 py-5 px-6",children:"Soberania"}),e.jsx(j,{className:"text-right text-[10px] font-black uppercase tracking-widest text-muted-foreground/50 py-5 px-6",children:"Gestão"})]})}),e.jsx(De,{children:q.map(a=>{const s=!a.companyId,l=L.value||F("functions.update")||s&&y,p=L.value||F("functions.delete")||s&&y;return e.jsxs(V,{className:Te("group border-white/5 transition-colors duration-200",l?"cursor-pointer hover:bg-white/5":"cursor-default"),onClick:()=>{l&&(N(a),c({name:a.name,description:a.description||"",canLeadTeam:a.canLeadTeam,hierarchyLevel:a.hierarchyLevel||a.level||0,isTemplate:!a.companyId}),u(!0))},children:[e.jsx(b,{className:"py-4 px-6 font-mono text-[10px] whitespace-nowrap",children:e.jsxs(B,{variant:"outline",className:"bg-primary/5 border-primary/20 text-primary font-bold",children:["LV ",a.hierarchyLevel||a.level||0]})}),e.jsx(b,{className:"py-4 px-6",children:e.jsx("div",{className:"flex flex-col gap-1",children:e.jsxs("div",{className:"flex items-center gap-2 font-bold text-sm text-white group-hover:text-primary transition-colors",children:[a.name,s&&e.jsx(B,{variant:"secondary",className:"bg-primary/20 text-primary border-primary/20 text-[9px] h-4 font-black uppercase tracking-tighter",children:"Global"})]})})}),e.jsx(b,{className:"hidden md:table-cell py-4 px-6 text-xs text-muted-foreground max-w-[300px] truncate",children:a.description||"-"}),e.jsx(b,{className:"py-4 px-6 text-center",children:a.canLeadTeam?e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"p-1.5 rounded-lg bg-amber-500/10 border border-amber-500/20 text-amber-500 shadow-[0_0_10px_-2px_rgba(245,158,11,0.3)]",children:e.jsx(H,{className:"w-3.5 h-3.5"})})}):e.jsx("span",{className:"text-muted-foreground/30 font-mono text-[10px]",children:"Não"})}),e.jsx(b,{className:"py-4 px-6 text-right",onClick:t=>t.stopPropagation(),children:e.jsx("div",{className:"flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:s&&!y?e.jsx(d,{variant:"outline",size:"icon",onClick:t=>{t.stopPropagation(),oe(a)},className:"h-8 w-8 bg-primary/5 border-primary/20 hover:bg-primary/20 hover:border-primary/40 text-primary",title:"Copiar para Empresa",children:e.jsx(Be,{className:"w-3.5 h-3.5"})}):e.jsxs(e.Fragment,{children:[l&&e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-white/10",onClick:t=>{t.stopPropagation(),N(a),c({name:a.name,description:a.description||"",canLeadTeam:a.canLeadTeam,hierarchyLevel:a.hierarchyLevel||a.level||0,isTemplate:!a.companyId}),u(!0)},children:e.jsx(ze,{className:"w-3.5 h-3.5"})}),p&&e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-destructive/10 text-destructive/70 hover:text-destructive",onClick:t=>{t.stopPropagation(),ie(a)},children:e.jsx(Ue,{className:"w-3.5 h-3.5"})})]})})})]},a.id)})})]})})}),e.jsx(Ae,{open:h.open,onOpenChange:a=>P(s=>({...s,open:a})),title:h.title,description:h.description,onConfirm:h.onConfirm,variant:h.variant})]})}export{ma as default};
