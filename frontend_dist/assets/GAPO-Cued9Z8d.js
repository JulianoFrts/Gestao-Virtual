import{f as is,r as j,t as qe,j as e,ak as os,K as Aa,b3 as ls,q as G,u as cs,as as ds,E as ms,aA as S,B as y,aK as Ge,F as Ve,a6 as ka,O as De,D as be,k as je,l as ve,m as ye,o as He,p as oa,aS as Ne,a$ as b,W as us,b4 as Pe,b5 as ps,ac as xs,g as Sa,e as we,Q as pe,s as ne,a3 as hs,C as fs,a0 as gs,S as bs,G as js,H as vs,I as ys,J as la,aX as Ns,b6 as ws}from"./index-D951x4H-.js";import{T as Ps,a as As,b as xe,c as he}from"./tabs-D3Kawp4S.js";import{P as ks}from"./ProjectEmptyState-CRpC4Dgy.js";import{u as Ss}from"./useWorkStages-DXnml1Pf.js";import{u as Cs}from"./useTimeRecords-RqrN7uRd.js";import{u as Ds}from"./useSites-Dum3dnEP.js";import{u as Os}from"./useAuditLogs-D3Sh0dD4.js";import{C as W,b as Ae,c as ke,a as J,d as Ke}from"./card-BTHGlYFz.js";import{T as Qe,a as Xe,b as z,c as D,d as Ze,e as P}from"./table-UwE0Vej1.js";import{A as Ca}from"./activity-BYx2dwgt.js";import{f as ee}from"./format-CP1OFCPJ.js";import{u as Es,a as Ts,D as Rs,F as _s}from"./permission-modal-BEhDpYqz.js";import{I as Ie}from"./input-dNnkIPn6.js";import{A as ca,a as da,b as ma,c as ua,d as pa,e as xa,f as ha,g as fa}from"./alert-dialog-qR-bbYaw.js";import{C as Ue}from"./checkbox-B9hZgst_.js";import{D as te}from"./download-L1tB_Hhn.js";import{A as Fe}from"./archive-BPtJUZpO.js";import{T as $e}from"./trash-2-DD2QlM38.js";import{U as Ms}from"./upload-D2Q7C-3S.js";import{E as Is}from"./eye-CxUjXe8h.js";import{P as ga}from"./pen-C5GdyZXe.js";import{I as Da}from"./info-MbzHf59N.js";import{G as Fs}from"./GAPOAnalyticsPanel-Db7gsqJw.js";import{u as $s,a as Ls}from"./CartesianGrid-HrqNXgEf.js";import{T as zs}from"./textarea-Db2vMs5u.js";import{T as Oa}from"./triangle-alert-BPKdZxxI.js";import{S as Bs}from"./square-check-big-CO_74oGA.js";import{L as qs}from"./lock-BtTOdZOV.js";import{f as Y,p as ie,i as fe,D as Gs,L as Le,A as Vs,a as ge,b as Hs,c as Ks,G as Us,g as ba,l as Ws,d as ja,e as Qs,h as Xs,R as Zs}from"./AreaChart-D9h5uedO.js";import{P as Js,a as Ea,b as Ys}from"./PolarAngleAxis-DQC9sugx.js";import{P as er}from"./printer-6uhaNVcg.js";import{T as ar}from"./trending-up-BwuTo0m4.js";import"./plus-DmkF01H_.js";import"./circle-alert-BlgUQYiE.js";import"./index-COevDGDX.js";import"./context-menu-CftfI8l1.js";import"./scroll-area-C9sC2RNd.js";import"./ellipsis-CNuBxG9Z.js";import"./search-BoEw84GM.js";import"./list-BniZwJ04.js";import"./save-BcLL5Pf6.js";import"./Line-DWxI2lOG.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sr=[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]],rr=is("TrendingDown",sr);function tr(){const[s,a]=j.useState(0),[r,t]=j.useState(!0),i=j.useCallback(async()=>{var o;t(!0);try{if(navigator.onLine){const l=await qe.get("/production/logs",{pendingOnly:"true"});if(l.error)throw new Error(l.error.message);a(((o=l.data)==null?void 0:o.length)||0)}}catch(l){console.error("Error loading audit stats:",l)}finally{t(!1)}},[]);return j.useEffect(()=>{i();const o=setInterval(i,6e4);return()=>clearInterval(o)},[i]),{pendingCount:s,isLoading:r,refresh:i}}function nr({projectId:s,siteId:a}){const{data:r=[],isLoading:t}=Os(),i=j.useMemo(()=>{const l=["work_stages","stage_progress","construction_documents","teams","sites","projects"];return r.filter(m=>l.includes(m.table_name)).slice(0,50)},[r,s]),o=l=>{switch(l){case"INSERT":return"bg-green-500/10 text-green-500 border-green-500/20";case"UPDATE":return"bg-amber-500/10 text-amber-500 border-amber-500/20";case"DELETE":return"bg-red-500/10 text-red-500 border-red-500/20";default:return"bg-blue-500/10 text-blue-500 border-blue-500/20"}};return e.jsxs(W,{className:"glass-card",children:[e.jsx(Ae,{className:"border-b border-white/5",children:e.jsxs(ke,{className:"flex items-center gap-2",children:[e.jsx(Ca,{className:"w-5 h-5 text-primary"}),"Trilha de Auditoria Operacional"]})}),e.jsx(J,{className:"p-0",children:e.jsxs(Qe,{children:[e.jsx(Xe,{children:e.jsxs(z,{className:"hover:bg-transparent border-white/5 bg-white/2",children:[e.jsx(D,{className:"font-bold text-[10px] uppercase tracking-widest pl-6",children:"Evento"}),e.jsx(D,{className:"font-bold text-[10px] uppercase tracking-widest",children:"Responsável"}),e.jsx(D,{className:"font-bold text-[10px] uppercase tracking-widest",children:"Módulo"}),e.jsx(D,{className:"font-bold text-[10px] uppercase tracking-widest",children:"Ação"}),e.jsx(D,{className:"font-bold text-[10px] uppercase tracking-widest pr-6",children:"Data"})]})}),e.jsx(Ze,{children:t?e.jsx(z,{children:e.jsx(P,{colSpan:5,className:"text-center py-10",children:"Processando trilhas..."})}):i.length===0?e.jsx(z,{children:e.jsx(P,{colSpan:5,className:"text-center py-10 italic text-muted-foreground",children:"Nenhum evento operacional registrado."})}):i.map(l=>e.jsxs(z,{className:"hover:bg-white/2 border-white/5 transition-colors",children:[e.jsx(P,{className:"pl-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{className:"w-3 h-3 text-muted-foreground"}),e.jsxs("span",{className:"text-sm font-bold",children:["ID: ",l.record_id.substring(0,8),"..."]})]})}),e.jsx(P,{children:e.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium",children:[e.jsx(Aa,{className:"w-3 h-3 text-primary"}),ls(l.performer_name)]})}),e.jsx(P,{children:e.jsx(G,{variant:"outline",className:"text-[9px] uppercase font-black bg-white/5",children:l.table_name})}),e.jsx(P,{children:e.jsx(G,{className:o(l.action)+" text-[9px] font-black uppercase",children:l.action})}),e.jsx(P,{className:"text-right pr-6 whitespace-nowrap",children:e.jsx("div",{className:"flex flex-col text-[10px] font-bold",children:l.performed_at&&!isNaN(new Date(l.performed_at).getTime())?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:ee(new Date(l.performed_at),"dd/MM/yyyy")}),e.jsx("span",{className:"opacity-50",children:ee(new Date(l.performed_at),"HH:mm:ss")})]}):e.jsx("span",{children:"--"})})})]},l.id))})]})})]})}function ir({projectId:s,siteId:a}){const{documents:r,isLoading:t,uploadDocument:i,updateDocument:o,downloadDocument:l,previewDocument:m,createFolder:p,deleteDocument:v,refresh:f}=Es(s,a),{addToQueue:A,isProcessing:x,currentDownload:k,queueLength:N}=Ts(l),{profile:O}=cs(),E=ds(O)||ms(O==null?void 0:O.role),[I,F]=j.useState(""),[B,H]=j.useState(null),[T,_]=j.useState([]),[se,g]=j.useState(null),w=S.useRef(null),[$,L]=j.useState(!1),[Q,Je]=j.useState(""),[Ma,Ia]=j.useState("/"),[Fa,re]=j.useState(!1),[Oe,Ee]=j.useState(""),[Ye,Te]=j.useState(null),[$a,ea]=j.useState(!1),[X,La]=j.useState(null),[za,Re]=j.useState(!1),[K,de]=j.useState(null),[Ba,aa]=j.useState(!1),[U,qa]=j.useState(null),_e=()=>{var n;(n=w.current)==null||n.click()},Ga=async n=>{var d;const c=(d=n.target.files)==null?void 0:d[0];c&&(b.promise(i(c,{projectId:s,siteId:a}),{loading:"Enviando documento...",success:"Documento enviado com sucesso!",error:"Erro ao enviar documento"}),w.current&&(w.current.value=""))},sa=(n="/")=>{Ia(n),Je(""),L(!0)},ra=async()=>{Q.trim()&&(L(!1),await p(Q,Ma))},me=20,ue=100,Va=()=>{const n=r.filter(u=>{var h;return u.docType!=="folder"&&!((h=u.fileUrl)!=null&&h.includes("folder"))});if(n.length===0){b.error("Nenhum documento para exportar.");return}if(n.length>me){b.error(`Limite de exportação excedido. Máximo ${me} arquivos por vez (atual: ${n.length}).`);return}const d=(n.reduce((u,h)=>u+(h.fileSize||0),0)/(1024*1024)).toFixed(2);if(parseFloat(d)>ue){b.error(`O tamanho total (${d}MB) excede o limite de ${ue}MB.`);return}b.success(`Exportando ${n.length} arquivos (${d}MB)...`),n.forEach(u=>l(u))},Ha=n=>{b.promise(o(n,{status:"archived"}),{loading:"Arquivando...",success:"Documento arquivado",error:"Erro ao arquivar"})},Ka=n=>{b.promise(o(n,{status:"valid"}),{loading:"Validando...",success:"Documento validado",error:"Erro ao validar"})},Ua=(n,c)=>{const d=r.find(u=>u.id===c.id);if(n==="Abrir")c.type==="file"?(H(c),d&&m(d)):(H(c),b.info(`Pasta "${c.name}" selecionada`));else if(n==="Visualizar")d&&m(d);else if(n==="Renomear")d&&(Te(d.id),Ee(d.name),re(!0));else if(n==="Informações")if(d){const u=`Tipo: ${d.docType}
Versão: v${d.version}
Status: ${d.status}
Caminho: ${d.folderPath}
Modificado: ${d.updatedAt?ee(new Date(d.updatedAt),"dd/MM/yyyy HH:mm"):"-"}`;de({title:`Detalhes: ${d.name}`,body:u})}else de({title:"Informações da Pasta",body:`Pasta: ${c.name}
ID: ${c.id}`});else n==="Excluir"?(La({id:c.id,name:c.name,storagePath:d==null?void 0:d.fileUrl}),ea(!0)):n==="Nova Pasta"?sa(c.type==="folder"?`${c.id}/`:"/"):n==="Novo Arquivo"?_e():n==="Nova Pasta Inteligente"?Qa(c.id,c.name):n==="Marcar como Importante"?d&&b.promise(o(d.id,{metadata:{...d.metadata,priority:"high"}}),{loading:"Marcando...",success:"Marcado como Importante",error:"Erro ao marcar"}):n==="Mover para Raiz"?ta(c.id,"root"):n==="Permissões"&&d&&(qa(d),aa(!0))},Wa=async(n,c)=>{const u=["01. Empresa","02. Obra","03. Canteiro"].includes(U.name),h={metadata:{...U.metadata,...c}};if(u&&window.confirm(`Esta é uma pasta padrão. Deseja aplicar estas permissões para TODAS as pastas "${U.name}" em todos os projetos?`)){b.loading(`Sincronizando permissões para ${U.name}...`);const{error:M}=await us.from("construction_documents").update(h).eq("file_url","folder").eq("name",U.name);M?(b.dismiss(),b.error("Erro ao sincronizar permissões.")):(b.dismiss(),b.success("Permissões sincronizadas globalmente!"),f());return}await o(n,h)},Qa=async(n,c="Obra")=>{const d={"template-obra":["01. Projetos","02. Torres","03. Relatórios","04. Fotos"],"template-canteiro":["01. Funcionários","02. Documentos Funcionários","03. EPIs","04. Treinamentos"],root:["01. Empresa","02. Obra","03. Canteiro"],Obra:["Torres","Projetos","Diários"],Canteiro:["Funcionários","Documentos"]},u=d[n]||d[c]||d.root,h=n==="root"||n.startsWith("template-")?"/":`/${n}/`;b.loading("Criando estrutura inteligente...");try{await Promise.all(u.map(C=>p(C,h))),b.dismiss(),b.success("Estrutura criada com sucesso!"),await f()}catch{b.dismiss(),b.error("Erro ao criar estrutura.")}},Xa=async(n,c)=>{await v(n,c)},ta=async(n,c)=>{if(!r.find(h=>h.id===n))return;const u=c==="root"||!c?"/":`/${c}/`;b.promise(o(n,{folderPath:u}),{loading:"Movendo...",success:"Movido com sucesso!",error:"Erro ao mover"})},Za=()=>{const n=r.filter(u=>{var h;return T.includes(u.id)&&u.docType!=="folder"&&!((h=u.fileUrl)!=null&&h.includes("folder"))});if(n.length===0)return;if(n.length>me){b.error(`Limite de download excedido. Selecione no máximo ${me} arquivos.`);return}const d=(n.reduce((u,h)=>u+(h.fileSize||0),0)/(1024*1024)).toFixed(2);if(parseFloat(d)>ue){b.error(`O tamanho total (${d}MB) excede o limite de ${ue}MB.`);return}A(n)},Ja=async n=>{b.promise(o(n.id,{status:"valid"}),{loading:"Aprovando...",success:"Documento aprovado!",error:"Erro ao aprovar"})},Ya=async n=>{b.promise(o(n.id,{status:"rejected"}),{loading:"Rejeitando...",success:"Documento rejeitado!",error:"Erro ao rejeitar"})},es=async()=>{b.loading(`Arquivando ${T.length} itens...`);try{await Promise.all(T.map(n=>o(n,{status:"archived"}))),_([]),b.dismiss(),b.success("Itens arquivados com sucesso")}catch{b.dismiss(),b.error("Erro ao arquivar alguns itens")}},as=async()=>{Re(!1),b.loading(`Excluindo ${T.length} itens...`);try{await Promise.all(T.map(n=>{const c=r.find(d=>d.id===n);return v(n,c==null?void 0:c.fileUrl)})),_([]),b.dismiss(),b.success("Itens excluídos")}catch{b.dismiss(),b.error("Erro ao excluir alguns itens")}},na=async()=>{!Ye||!Oe.trim()||(re(!1),b.promise(o(Ye,{name:Oe}),{loading:"Renomeando...",success:"Renomeado com sucesso!",error:"Erro ao renomear"}),Te(null))},ss=n=>{Te(n.id),Ee(n.name),re(!0)},Z=r.filter(n=>{var d;if(n.docType==="folder"||(d=n.fileUrl)!=null&&d.includes("folder"))return!1;const c=n.name.toLowerCase().includes(I.toLowerCase())||n.docType.toLowerCase().includes(I.toLowerCase());return B?B.type==="folder"?c&&n.folderPath.includes(B.id):n.id===B.id:c}),rs=(n,c)=>{if(!n.target.closest("button"))if(n.ctrlKey||n.metaKey)_(d=>d.includes(c)?d.filter(u=>u!==c):[...d,c]),g(c);else if(n.shiftKey&&se){const d=Z.filter(C=>{var M;return C.docType!=="folder"&&!((M=C.fileUrl)!=null&&M.includes("folder"))}),u=d.findIndex(C=>C.id===c),h=d.findIndex(C=>C.id===se);if(u!==-1&&h!==-1){const C=Math.min(u,h),M=Math.max(u,h),ns=d.slice(C,M+1).map(Me=>Me.id);_(Me=>Array.from(new Set([...Me,...ns])))}}else _([c]),g(c)},ts=n=>{switch(n){case"valid":return"bg-emerald-500/10 text-emerald-500 border-emerald-500/20";case"expired":return"bg-red-500/10 text-red-500 border-red-500/20";case"archived":return"bg-slate-500/10 text-slate-500 border-slate-500/20";case"superseded":return"bg-amber-500/10 text-amber-500 border-amber-500/20";case"pending":return"bg-yellow-500/10 text-yellow-500 border-yellow-500/20";case"rejected":return"bg-gray-500/10 text-gray-500 border-gray-500/20 font-bold";default:return"bg-blue-500/10 text-blue-500 border-blue-500/20"}},ia=n=>{const c=[],d={};return n.filter(u=>{var h;return u.docType==="folder"||((h=u.fileUrl)==null?void 0:h.includes("folder"))}).sort((u,h)=>u.name.localeCompare(h.name)).forEach(u=>{d[u.id]={id:u.id,name:u.name,type:"folder",children:[]}}),n.filter(u=>{var h;return u.docType==="folder"||((h=u.fileUrl)==null?void 0:h.includes("folder"))}).forEach(u=>{var M;const h=d[u.id],C=u.folderPath.split("/").filter(Boolean).pop();C&&d[C]?(M=d[C].children)==null||M.push(h):c.push(h)}),n.filter(u=>{var h;return u.docType!=="folder"&&!((h=u.fileUrl)!=null&&h.includes("folder"))}).forEach(u=>{var M;const h={id:u.id,name:u.name,type:"file",extension:u.name.split(".").pop()},C=u.folderPath.split("/").filter(Boolean).pop();C&&d[C]?(M=d[C].children)==null||M.push(h):c.push(h)}),c};return ia(r),e.jsxs("div",{className:"flex gap-4 h-[calc(100vh-280px)] min-h-[500px]",children:[e.jsx("input",{type:"file",className:"hidden",ref:w,onChange:Ga}),e.jsxs("div",{className:"w-72 shrink-0 glass-card rounded-lg overflow-hidden border border-white/5 flex flex-col",children:[B&&e.jsx("div",{className:"p-2 border-b border-white/5 bg-primary/5",children:e.jsxs(y,{variant:"ghost",size:"sm",className:"w-full text-[10px] h-7 uppercase font-bold gap-2",onClick:()=>H(null),children:[e.jsx(Ge,{className:"w-3 h-3"})," Limpar Seleção"]})}),e.jsx(Rs,{onFileSelect:n=>H(n),onNewFile:_e,onNewFolder:sa,onRefresh:f,onAction:Ua,onMove:ta,files:ia(r),documents:r,isAdmin:E,onApprove:Ja,onReject:Ya})]}),e.jsxs("div",{className:"flex-1 space-y-4 overflow-auto",children:[(x||N>0)&&e.jsxs("div",{className:"flex items-center justify-between p-3 glass-card bg-emerald-500/10 rounded-lg border-emerald-500/20 animate-pulse",children:[e.jsxs("span",{className:"text-sm font-bold uppercase text-emerald-400 flex items-center gap-2",children:[e.jsx(te,{className:"size-4 animate-bounce"}),"Baixando: ",k||"Preparando..."]}),e.jsxs(G,{variant:"outline",className:"text-emerald-400 border-emerald-400/30",children:["Fila: ",N]})]}),T.length>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 glass-card border-primary/20 bg-primary/5 rounded-lg animate-in fade-in slide-in-from-top-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"size-8 rounded-full bg-primary/20 flex items-center justify-center text-xs font-bold text-primary",children:T.length}),e.jsx("span",{className:"text-sm font-bold uppercase tracking-wider",children:"Itens Selecionados"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{size:"sm",variant:"ghost",className:"h-8 gap-2 hover:bg-emerald-500/20",onClick:Za,children:[e.jsx(te,{className:"w-4 h-4"})," Baixar"]}),e.jsxs(y,{size:"sm",variant:"ghost",className:"h-8 gap-2 hover:bg-amber-500/20",onClick:es,children:[e.jsx(Fe,{className:"w-4 h-4"})," Arquivar"]}),e.jsxs(y,{size:"sm",variant:"ghost",className:"h-8 gap-2 hover:bg-red-500/20 text-red-400",onClick:()=>Re(!0),children:[e.jsx($e,{className:"w-4 h-4"})," Excluir"]}),e.jsx("div",{className:"w-px h-8 bg-white/10 mx-1"}),e.jsx(y,{size:"sm",variant:"ghost",className:"h-8 text-xs opacity-50 hover:opacity-100",onClick:()=>_([]),children:"Cancelar"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Ie,{placeholder:"Buscar documentos, contratos, projetos...",className:"industrial-input pl-10",value:I,onChange:n=>F(n.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{variant:"outline",className:"glass-card border-white/5 font-bold gap-2 text-[10px] uppercase tracking-widest",onClick:Va,children:[e.jsx(te,{className:"w-4 h-4"})," Exportar Tudo"]}),e.jsxs(y,{className:"gradient-primary font-bold gap-2",onClick:_e,children:[e.jsx(Ms,{className:"w-4 h-4"})," Novo Documento"]})]})]}),e.jsxs(W,{className:"glass-card",children:[e.jsxs(Ae,{children:[e.jsxs(ke,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-5 h-5 text-primary"}),"Repositório de Documentos"]}),e.jsx(Ke,{children:"Gestão versionada e segura de arquivos da obra."})]}),e.jsx(J,{className:"p-0",children:e.jsxs(Qe,{children:[e.jsx(Xe,{children:e.jsxs(z,{className:"hover:bg-transparent border-white/5 bg-white/2",children:[e.jsx(D,{className:"w-10 pl-6",children:e.jsx(Ue,{checked:T.length===Z.filter(n=>{var c;return n.docType!=="folder"&&!((c=n.fileUrl)!=null&&c.includes("folder"))}).length&&Z.filter(n=>{var c;return n.docType!=="folder"&&!((c=n.fileUrl)!=null&&c.includes("folder"))}).length>0,onCheckedChange:n=>{_(n?Z.filter(c=>{var d;return c.docType!=="folder"&&!((d=c.fileUrl)!=null&&d.includes("folder"))}).map(c=>c.id):[])}})}),e.jsx(D,{className:"font-bold text-[10px] uppercase tracking-widest",children:"Nome do Arquivo"}),e.jsx(D,{className:"font-bold text-[10px] uppercase tracking-widest",children:"Tipo"}),e.jsx(D,{className:"font-bold text-[10px] uppercase tracking-widest",children:"Versão"}),e.jsx(D,{className:"font-bold text-[10px] uppercase tracking-widest",children:"Status"}),e.jsx(D,{className:"font-bold text-[10px] uppercase tracking-widest",children:"Última Modificação"}),e.jsx(D,{className:"text-right pr-6 font-bold text-[10px] uppercase tracking-widest",children:"Ações"})]})}),e.jsx(Ze,{children:t?e.jsx(z,{children:e.jsx(P,{colSpan:6,className:"text-center py-10",children:"Carregando documentos..."})}):Z.length===0?e.jsx(z,{children:e.jsx(P,{colSpan:6,className:"text-center py-10 italic text-muted-foreground",children:"Nenhum documento encontrado."})}):Z.filter(n=>{var c;return n.docType!=="folder"&&!((c=n.fileUrl)!=null&&c.includes("folder"))}).map(n=>e.jsxs(z,{className:`
                                                cursor-pointer transition-colors group border-white/5
                                                ${T.includes(n.id)?"bg-primary/15 hover:bg-primary/20":"hover:bg-white/2"}
                                            `,onClick:c=>rs(c,n.id),children:[e.jsx(P,{className:"pl-6",children:e.jsx(Ue,{checked:T.includes(n.id),onCheckedChange:()=>{_(c=>c.includes(n.id)?c.filter(d=>d!==n.id):[...c,n.id])},onClick:c=>c.stopPropagation()})}),e.jsx(P,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(Ve,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-bold text-sm",children:n.name}),e.jsxs("span",{className:"text-[10px] opacity-50 font-mono italic",children:["UUID: ",n.id.substring(0,8)]})]})]})}),e.jsx(P,{children:e.jsx(G,{variant:"outline",className:"text-[10px] font-black uppercase tracking-tight",children:n.docType})}),e.jsx(P,{children:e.jsxs("div",{className:"flex items-center gap-1 font-bold text-xs",children:[e.jsx(ka,{className:"w-3 h-3 text-muted-foreground"}),"v",n.version]})}),e.jsx(P,{children:e.jsx(G,{className:ts(n.status)+" text-[10px] font-black uppercase",children:n.status})}),e.jsx(P,{className:"text-xs font-medium",children:n.updatedAt&&!isNaN(new Date(n.updatedAt).getTime())?ee(new Date(n.updatedAt),"dd/MM/yyyy HH:mm"):"-"}),e.jsx(P,{className:"text-right pr-6",children:e.jsxs("div",{className:"flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(y,{size:"icon",variant:"ghost",className:"h-8 w-8 hover:bg-primary/20 hover:text-primary",title:"Visualizar",onClick:()=>m(n),children:e.jsx(Is,{className:"w-4 h-4"})}),e.jsx(y,{size:"icon",variant:"ghost",className:"h-8 w-8 hover:bg-emerald-500/20 hover:text-emerald-500",title:"Download",onClick:()=>l(n),children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx(y,{size:"icon",variant:"ghost",className:"h-8 w-8 hover:bg-amber-500/20 hover:text-amber-500",title:"Arquivar",onClick:()=>Ha(n.id),children:e.jsx(Fe,{className:"w-4 h-4"})}),e.jsx(y,{size:"icon",variant:"ghost",className:"h-8 w-8 hover:bg-blue-500/20 hover:text-blue-500",title:"Renomear",onClick:()=>ss(n),children:e.jsx(ga,{className:"w-4 h-4"})}),e.jsx(y,{size:"icon",variant:"ghost",className:"h-8 w-8 hover:bg-primary/20 hover:text-primary",title:"Validar",onClick:()=>Ka(n.id),children:e.jsx(De,{className:"w-4 h-4"})})]})})]},n.id))})]})})]})]}),e.jsx(be,{open:Fa,onOpenChange:re,children:e.jsxs(je,{className:"glass-card border-white/10 sm:max-w-[400px]",children:[e.jsxs(ve,{children:[e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(ga,{className:"w-5 h-5 text-primary"})," Renomear Item"]}),e.jsx(He,{className:"text-xs",children:"Digite o novo nome para o arquivo ou pasta."})]}),e.jsx("div",{className:"py-4 space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(oa,{className:"text-[10px] uppercase font-black tracking-widest opacity-60",children:"Novo Nome"}),e.jsx(Ie,{value:Oe,onChange:n=>Ee(n.target.value),className:"industrial-input",autoFocus:!0,onKeyDown:n=>n.key==="Enter"&&na()})]})}),e.jsxs(Ne,{children:[e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>re(!1),children:"Cancelar"}),e.jsx(y,{size:"sm",className:"gradient-primary",onClick:na,children:"Salvar Alteração"})]})]})}),e.jsx(be,{open:$,onOpenChange:L,children:e.jsxs(je,{className:"glass-card border-white/10 sm:max-w-[400px]",children:[e.jsxs(ve,{children:[e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5 text-primary"})," Criar Nova Pasta"]}),e.jsx(He,{className:"text-xs",children:"Crie uma nova pasta para organizar seus documentos."})]}),e.jsx("div",{className:"py-4 space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(oa,{className:"text-[10px] uppercase font-black tracking-widest opacity-60",children:"Nome da Pasta"}),e.jsx(Ie,{value:Q,onChange:n=>Je(n.target.value),className:"industrial-input",placeholder:"Ex: Relatórios Técnicos",autoFocus:!0,onKeyDown:n=>n.key==="Enter"&&ra()})]})}),e.jsxs(Ne,{children:[e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>L(!1),children:"Cancelar"}),e.jsx(y,{size:"sm",className:"gradient-primary",onClick:ra,children:"Criar Pasta"})]})]})}),e.jsx(be,{open:!!K,onOpenChange:n=>!n&&de(null),children:e.jsxs(je,{className:"glass-card border-white/10 sm:max-w-[450px]",children:[e.jsx(ve,{children:e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(Da,{className:"w-5 h-5 text-blue-400"})," ",K==null?void 0:K.title]})}),e.jsx("div",{className:"py-4 bg-white/2 rounded-lg p-4 border border-white/5",children:e.jsx("pre",{className:"text-xs font-mono text-white/70 whitespace-pre-wrap leading-relaxed",children:K==null?void 0:K.body})}),e.jsx(Ne,{children:e.jsx(y,{size:"sm",variant:"outline",className:"border-white/10",onClick:()=>de(null),children:"Fechar"})})]})}),e.jsx(ca,{open:$a,onOpenChange:ea,children:e.jsxs(da,{className:"glass-card border-white/10 sm:max-w-[400px]",children:[e.jsxs(ma,{children:[e.jsxs(ua,{className:"flex items-center gap-2 text-red-500",children:[e.jsx($e,{className:"w-5 h-5"})," Confirmar Exclusão"]}),e.jsxs(pa,{className:"text-xs leading-relaxed",children:["Tem certeza que deseja excluir permanentemente ",e.jsxs("strong",{children:['"',X==null?void 0:X.name,'"']}),"? esta ação não pode ser desfeita."]})]}),e.jsxs(xa,{children:[e.jsx(ha,{className:"border-white/10 h-9",children:"Cancelar"}),e.jsx(fa,{className:"bg-red-500 hover:bg-red-600 h-9",onClick:()=>X&&Xa(X.id,X.storagePath),children:"Excluir Agora"})]})]})}),e.jsx(ca,{open:za,onOpenChange:Re,children:e.jsxs(da,{className:"glass-card border-white/10 sm:max-w-[400px]",children:[e.jsxs(ma,{children:[e.jsxs(ua,{className:"flex items-center gap-2 text-red-500",children:[e.jsx($e,{className:"w-5 h-5"})," Excluir Múltiplos Itens"]}),e.jsxs(pa,{className:"text-xs leading-relaxed",children:["Você solicitou a exclusão de ",e.jsx("strong",{children:T.length})," itens. Eles serão removidos permanentemente do sistema e do armazenamento."]})]}),e.jsxs(xa,{children:[e.jsx(ha,{className:"border-white/10 h-9",children:"Cancelar"}),e.jsx(fa,{className:"bg-red-500 hover:bg-red-600 h-9",onClick:as,children:"Confirmar Exclusão em Massa"})]})]})}),U&&e.jsx(_s,{open:Ba,onOpenChange:aa,document:U,onSave:Wa})]})}var or=["cx","cy","innerRadius","outerRadius","gridType","radialLines"];function oe(s){"@babel/helpers - typeof";return oe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},oe(s)}function lr(s,a){if(s==null)return{};var r=cr(s,a),t,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(s);for(i=0;i<o.length;i++)t=o[i],!(a.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(s,t)&&(r[t]=s[t])}return r}function cr(s,a){if(s==null)return{};var r={};for(var t in s)if(Object.prototype.hasOwnProperty.call(s,t)){if(a.indexOf(t)>=0)continue;r[t]=s[t]}return r}function V(){return V=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(s[t]=r[t])}return s},V.apply(this,arguments)}function va(s,a){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(i){return Object.getOwnPropertyDescriptor(s,i).enumerable})),r.push.apply(r,t)}return r}function le(s){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?va(Object(r),!0).forEach(function(t){dr(s,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):va(Object(r)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(r,t))})}return s}function dr(s,a,r){return a=mr(a),a in s?Object.defineProperty(s,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[a]=r,s}function mr(s){var a=ur(s,"string");return oe(a)=="symbol"?a:a+""}function ur(s,a){if(oe(s)!="object"||!s)return s;var r=s[Symbol.toPrimitive];if(r!==void 0){var t=r.call(s,a);if(oe(t)!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}var pr=function(a,r,t,i){var o="";return i.forEach(function(l,m){var p=ie(r,t,a,l);m?o+="L ".concat(p.x,",").concat(p.y):o+="M ".concat(p.x,",").concat(p.y)}),o+="Z",o},xr=function(a){var r=a.cx,t=a.cy,i=a.innerRadius,o=a.outerRadius,l=a.polarAngles,m=a.radialLines;if(!l||!l.length||!m)return null;var p=le({stroke:"#ccc"},Y(a,!1));return S.createElement("g",{className:"recharts-polar-grid-angle"},l.map(function(v){var f=ie(r,t,i,v),A=ie(r,t,o,v);return S.createElement("line",V({},p,{key:"line-".concat(v),x1:f.x,y1:f.y,x2:A.x,y2:A.y}))}))},hr=function(a){var r=a.cx,t=a.cy,i=a.radius,o=a.index,l=le(le({stroke:"#ccc"},Y(a,!1)),{},{fill:"none"});return S.createElement("circle",V({},l,{className:Pe("recharts-polar-grid-concentric-circle",a.className),key:"circle-".concat(o),cx:r,cy:t,r:i}))},fr=function(a){var r=a.radius,t=a.index,i=le(le({stroke:"#ccc"},Y(a,!1)),{},{fill:"none"});return S.createElement("path",V({},i,{className:Pe("recharts-polar-grid-concentric-polygon",a.className),key:"path-".concat(t),d:pr(r,a.cx,a.cy,a.polarAngles)}))},gr=function(a){var r=a.polarRadius,t=a.gridType;return!r||!r.length?null:S.createElement("g",{className:"recharts-polar-grid-concentric"},r.map(function(i,o){var l=o;return t==="circle"?S.createElement(hr,V({key:l},a,{radius:i,index:o})):S.createElement(fr,V({key:l},a,{radius:i,index:o}))}))},Ta=function(a){var r=a.cx,t=r===void 0?0:r,i=a.cy,o=i===void 0?0:i,l=a.innerRadius,m=l===void 0?0:l,p=a.outerRadius,v=p===void 0?0:p,f=a.gridType,A=f===void 0?"polygon":f,x=a.radialLines,k=x===void 0?!0:x,N=lr(a,or);return v<=0?null:S.createElement("g",{className:"recharts-polar-grid"},S.createElement(xr,V({cx:t,cy:o,innerRadius:m,outerRadius:v,gridType:A,radialLines:k},N)),S.createElement(gr,V({cx:t,cy:o,innerRadius:m,outerRadius:v,gridType:A,radialLines:k},N)))};Ta.displayName="PolarGrid";var ze,ya;function br(){if(ya)return ze;ya=1;function s(a){return a&&a.length?a[0]:void 0}return ze=s,ze}var Be,Na;function jr(){return Na||(Na=1,Be=br()),Be}var vr=jr();const yr=ps(vr);var Nr=["key"];function ae(s){"@babel/helpers - typeof";return ae=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},ae(s)}function wr(s,a){if(s==null)return{};var r=Pr(s,a),t,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(s);for(i=0;i<o.length;i++)t=o[i],!(a.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(s,t)&&(r[t]=s[t])}return r}function Pr(s,a){if(s==null)return{};var r={};for(var t in s)if(Object.prototype.hasOwnProperty.call(s,t)){if(a.indexOf(t)>=0)continue;r[t]=s[t]}return r}function Se(){return Se=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(s[t]=r[t])}return s},Se.apply(this,arguments)}function wa(s,a){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(i){return Object.getOwnPropertyDescriptor(s,i).enumerable})),r.push.apply(r,t)}return r}function R(s){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?wa(Object(r),!0).forEach(function(t){q(s,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):wa(Object(r)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(r,t))})}return s}function Ar(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}function Pa(s,a){for(var r=0;r<a.length;r++){var t=a[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(s,_a(t.key),t)}}function kr(s,a,r){return a&&Pa(s.prototype,a),r&&Pa(s,r),Object.defineProperty(s,"prototype",{writable:!1}),s}function Sr(s,a,r){return a=Ce(a),Cr(s,Ra()?Reflect.construct(a,r||[],Ce(s).constructor):a.apply(s,r))}function Cr(s,a){if(a&&(ae(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Dr(s)}function Dr(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function Ra(){try{var s=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ra=function(){return!!s})()}function Ce(s){return Ce=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Ce(s)}function Or(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(a&&a.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),a&&We(s,a)}function We(s,a){return We=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t},We(s,a)}function q(s,a,r){return a=_a(a),a in s?Object.defineProperty(s,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[a]=r,s}function _a(s){var a=Er(s,"string");return ae(a)=="symbol"?a:a+""}function Er(s,a){if(ae(s)!="object"||!s)return s;var r=s[Symbol.toPrimitive];if(r!==void 0){var t=r.call(s,a);if(ae(t)!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}var ce=(function(s){function a(){var r;Ar(this,a);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return r=Sr(this,a,[].concat(i)),q(r,"state",{isAnimationFinished:!1}),q(r,"handleAnimationEnd",function(){var l=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),fe(l)&&l()}),q(r,"handleAnimationStart",function(){var l=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),fe(l)&&l()}),q(r,"handleMouseEnter",function(l){var m=r.props.onMouseEnter;m&&m(r.props,l)}),q(r,"handleMouseLeave",function(l){var m=r.props.onMouseLeave;m&&m(r.props,l)}),r}return Or(a,s),kr(a,[{key:"renderDots",value:function(t){var i=this.props,o=i.dot,l=i.dataKey,m=Y(this.props,!1),p=Y(o,!0),v=t.map(function(f,A){var x=R(R(R({key:"dot-".concat(A),r:3},m),p),{},{dataKey:l,cx:f.x,cy:f.y,index:A,payload:f});return a.renderDotItem(o,x)});return S.createElement(Le,{className:"recharts-radar-dots"},v)}},{key:"renderPolygonStatically",value:function(t){var i=this.props,o=i.shape,l=i.dot,m=i.isRange,p=i.baseLinePoints,v=i.connectNulls,f;return S.isValidElement(o)?f=S.cloneElement(o,R(R({},this.props),{},{points:t})):fe(o)?f=o(R(R({},this.props),{},{points:t})):f=S.createElement(Js,Se({},Y(this.props,!0),{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,points:t,baseLinePoints:m?p:null,connectNulls:v})),S.createElement(Le,{className:"recharts-radar-polygon"},f,l?this.renderDots(t):null)}},{key:"renderPolygonWithAnimation",value:function(){var t=this,i=this.props,o=i.points,l=i.isAnimationActive,m=i.animationBegin,p=i.animationDuration,v=i.animationEasing,f=i.animationId,A=this.state.prevPoints;return S.createElement(Vs,{begin:m,duration:p,isActive:l,easing:v,from:{t:0},to:{t:1},key:"radar-".concat(f),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(x){var k=x.t,N=A&&A.length/o.length,O=o.map(function(E,I){var F=A&&A[Math.floor(I*N)];if(F){var B=ge(F.x,E.x),H=ge(F.y,E.y);return R(R({},E),{},{x:B(k),y:H(k)})}var T=ge(E.cx,E.x),_=ge(E.cy,E.y);return R(R({},E),{},{x:T(k),y:_(k)})});return t.renderPolygonStatically(O)})}},{key:"renderPolygon",value:function(){var t=this.props,i=t.points,o=t.isAnimationActive,l=t.isRange,m=this.state.prevPoints;return o&&i&&i.length&&!l&&(!m||!Hs(m,i))?this.renderPolygonWithAnimation():this.renderPolygonStatically(i)}},{key:"render",value:function(){var t=this.props,i=t.hide,o=t.className,l=t.points,m=t.isAnimationActive;if(i||!l||!l.length)return null;var p=this.state.isAnimationFinished,v=Pe("recharts-radar",o);return S.createElement(Le,{className:v},this.renderPolygon(),(!m||p)&&Ks.renderCallByParent(this.props,l))}}],[{key:"getDerivedStateFromProps",value:function(t,i){return t.animationId!==i.prevAnimationId?{prevAnimationId:t.animationId,curPoints:t.points,prevPoints:i.curPoints}:t.points!==i.curPoints?{curPoints:t.points}:null}},{key:"renderDotItem",value:function(t,i){var o;if(S.isValidElement(t))o=S.cloneElement(t,i);else if(fe(t))o=t(i);else{var l=i.key,m=wr(i,Nr);o=S.createElement(Gs,Se({},m,{key:l,className:Pe("recharts-radar-dot",typeof t!="boolean"?t.className:"")}))}return o}}])})(j.PureComponent);q(ce,"displayName","Radar");q(ce,"defaultProps",{angleAxisId:0,radiusAxisId:0,hide:!1,activeDot:!0,dot:!1,legendType:"rect",isAnimationActive:!Us.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});q(ce,"getComposedData",function(s){var a=s.radiusAxis,r=s.angleAxis,t=s.displayedData,i=s.dataKey,o=s.bandSize,l=r.cx,m=r.cy,p=!1,v=[],f=r.type!=="number"?o??0:0;t.forEach(function(x,k){var N=ba(x,r.dataKey,k),O=ba(x,i),E=r.scale(N)+f,I=Array.isArray(O)?Ws(O):O,F=ja(I)?void 0:a.scale(I);Array.isArray(O)&&O.length>=2&&(p=!0),v.push(R(R({},ie(l,m,F,E)),{},{name:N,value:O,cx:l,cy:m,radius:F,angle:E,payload:x}))});var A=[];return p&&v.forEach(function(x){if(Array.isArray(x.value)){var k=yr(x.value),N=ja(k)?void 0:a.scale(k);A.push(R(R({},x),{},{radius:N},ie(l,m,N,x.angle)))}else A.push(x)}),{points:v,isRange:p,baseLinePoints:A}});var Tr=Qs({chartName:"RadarChart",GraphicalChild:ce,axisComponents:[{axisType:"angleAxis",AxisComp:Ea},{axisType:"radiusAxis",AxisComp:Ys}],formatAxisMap:Xs,defaultProps:{layout:"centric",startAngle:90,endAngle:-270,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});function Rr(s=!1){const a=xs(),r=$s({queryKey:["production_logs",{pendingOnly:s}],queryFn:async()=>{const i=await qe.get("/production/logs",{pendingOnly:String(s)});if(i.error)throw new Error(i.error.message);return i.data||[]}}),t=Ls({mutationFn:async({logId:i,approved:o,reason:l})=>{const m=await qe.post("/production/logs",{logId:i,approved:o,reason:l});if(m.error)throw new Error(m.error.message);return m.data},onSuccess:()=>{a.invalidateQueries({queryKey:["production_logs"]}),a.invalidateQueries({queryKey:["audit_stats"]})}});return{...r,approve:t.mutateAsync,isApproving:t.isPending}}function _r({projectId:s}){var _,se;const{data:a=[],isLoading:r,approve:t,isApproving:i}=Rr(!0),{toast:o}=Sa(),l=j.useMemo(()=>s?a.filter(g=>{var L;const w=g.tower,$=g;return!s||(w==null?void 0:w.project_id)===s||((L=$.metadata)==null?void 0:L.projectId)===s}):a,[a,s]),m=s?l:a,[p,v]=j.useState(null),[f,A]=j.useState(""),[x,k]=j.useState(null),[N,O]=j.useState([]),[E,I]=j.useState(!1),F=async()=>{var g;if(!(!p&&!(x!=null&&x.startsWith("bulk_"))||!x))try{if(x==="bulk_approve"||x==="bulk_reject"){I(!0);const w=x==="bulk_approve";for(const $ of N)await t({logId:$,approved:w,reason:f||"Processamento em massa via GAPO."});o({title:w?"Aprovação em Massa Concluída":"Rejeição em Massa Concluída",description:`${N.length} registros foram processados com sucesso.`}),O([])}else p&&(await t({logId:p.id,approved:x==="approve",reason:f}),o({title:x==="approve"?"Apontamento Aprovado":"Apontamento Rejeitado",description:`O registro da torre ${(g=p.tower)==null?void 0:g.objectId} foi processado com sucesso.`}));v(null),k(null),A("")}catch(w){console.error("Erro no processamento técnico:",w),o({title:"Erro no processamento",description:"Não foi possível salvar a validação técnica.",variant:"destructive"})}finally{I(!1)}},B=()=>{N.length===m.length?O([]):O(m.map(g=>g.id))},H=g=>{O(w=>w.includes(g)?w.filter($=>$!==g):[...w,g])},T=g=>{const w=new Date(g);return w instanceof Date&&!isNaN(w.getTime())};return r?e.jsx("div",{className:"p-8 text-center animate-pulse italic",children:"Carregando auditorias pendentes..."}):m.length===0?e.jsx(W,{className:"glass-card border-white/5 border-dashed",children:e.jsxs(J,{className:"p-12 text-center",children:[e.jsx(we,{className:"w-12 h-12 text-emerald-500/20 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-bold",children:"Tudo em dia!"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Não há validações técnicas pendentes no momento."})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(Oa,{className:"w-5 h-5 text-amber-500"}),"Aguardando Validação Técnica"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Analise e approve os apontamentos de campo que exigem supervisão."})]}),e.jsxs(G,{variant:"secondary",className:"bg-amber-500/10 text-amber-500 border-amber-500/20 font-black",children:[m.length," PENDENTES"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 items-center justify-between p-3 rounded-xl border border-white/5 bg-white/2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(y,{variant:"outline",size:"sm",className:ne("h-9 text-[10px] font-black uppercase tracking-widest border-white/10 hover:bg-white/5",N.length>0&&"border-primary/50 text-primary bg-primary/5"),onClick:B,children:[N.length===m.length&&m.length>0?e.jsx(pe,{className:"w-3.5 h-3.5 mr-2"}):e.jsx(Bs,{className:"w-3.5 h-3.5 mr-2"}),N.length===m.length&&m.length>0?"Desmarcar":"Selecionar Tudo"]}),N.length>0&&e.jsxs("div",{className:"flex items-center gap-2 animate-in fade-in slide-in-from-left-2 duration-300",children:[e.jsxs(y,{size:"sm",variant:"outline",className:"h-9 text-[10px] font-black uppercase tracking-widest border-emerald-500/20 text-emerald-500 hover:bg-emerald-500/10",onClick:()=>k("bulk_approve"),children:[e.jsx(De,{className:"w-3.5 h-3.5 mr-2"}),"Aprovar (",N.length,")"]}),e.jsxs(y,{size:"sm",variant:"outline",className:"h-9 text-[10px] font-black uppercase tracking-widest border-red-500/20 text-red-500 hover:bg-red-500/10",onClick:()=>k("bulk_reject"),children:[e.jsx(pe,{className:"w-3.5 h-3.5 mr-2"}),"Rejeitar"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-muted-foreground bg-blue-500/5 px-3 py-2 rounded-lg border border-blue-500/10",children:[e.jsx(Da,{className:"w-3.5 h-3.5 text-blue-400"}),e.jsx("span",{children:"A aprovação em massa aplicará o protocolo padrão a todos os itens."})]})]}),e.jsx(W,{className:"glass-card overflow-hidden",children:e.jsxs(Qe,{children:[e.jsx(Xe,{children:e.jsxs(z,{className:"hover:bg-transparent border-white/5 bg-white/2",children:[e.jsx(D,{className:"w-[40px] pl-6"}),e.jsx(D,{className:"text-[10px] uppercase font-black tracking-widest",children:"Torre / Objeto"}),e.jsx(D,{className:"text-[10px] uppercase font-black tracking-widest",children:"Atividade"}),e.jsx(D,{className:"text-[10px] uppercase font-black tracking-widest text-center",children:"Progresso"}),e.jsx(D,{className:"text-[10px] uppercase font-black tracking-widest",children:"Responsável"}),e.jsx(D,{className:"text-[10px] uppercase font-black tracking-widest",children:"Informado em"}),e.jsx(D,{className:"text-[10px] uppercase font-black tracking-widest pr-6 text-right",children:"Ações"})]})}),e.jsx(Ze,{children:m.map(g=>{var w,$,L,Q;return e.jsxs(z,{className:ne("hover:bg-white/2 border-white/5 transition-colors",N.includes(g.id)&&"bg-primary/5 border-primary/20"),children:[e.jsx(P,{className:"pl-6",children:e.jsx(Ue,{checked:N.includes(g.id),onCheckedChange:()=>H(g.id),className:"border-white/20 data-[state=checked]:bg-primary data-[state=checked]:border-primary"})}),e.jsx(P,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 rounded-lg bg-primary/10",children:e.jsx(hs,{className:"w-3.5 h-3.5 text-primary"})}),e.jsx("span",{className:"font-bold",children:(w=g.tower)==null?void 0:w.objectId})]})}),e.jsx(P,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[11px] font-bold",children:($=g.activity)==null?void 0:$.name}),e.jsx("span",{className:"text-[9px] uppercase tracking-tighter opacity-50 italic",children:g.approvalReason||"Solicitação Padrão"})]})}),e.jsx(P,{className:"text-center",children:e.jsxs(G,{variant:"outline",className:"text-[10px] font-black border-primary/20 bg-primary/5",children:[g.progressPercent,"%"]})}),e.jsx(P,{children:e.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-medium",children:[e.jsx(Aa,{className:"w-3 h-3 opacity-60"}),(Q=(L=g.changedBy)==null?void 0:L.name)==null?void 0:Q.split(" ")[0]]})}),e.jsx(P,{children:e.jsxs("div",{className:"flex flex-col text-[10px] font-bold",children:[e.jsx("span",{children:T(g.createdAt)?ee(new Date(g.createdAt),"dd/MM/yyyy"):"Data Inválida"}),e.jsx("span",{className:"opacity-50",children:T(g.createdAt)?ee(new Date(g.createdAt),"HH:mm"):"--:--"})]})}),e.jsx(P,{className:"pr-6 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(y,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0 hover:bg-red-500/10 hover:text-red-500",onClick:()=>{v(g),k("reject")},children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx(y,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0 hover:bg-emerald-500/10 hover:text-emerald-500",onClick:()=>{v(g),k("approve")},children:e.jsx(we,{className:"w-4 h-4"})})]})})]},g.id)})})]})}),e.jsx(be,{open:!!p||(x==null?void 0:x.startsWith("bulk_")),onOpenChange:g=>!g&&(v(null),k(null)),children:e.jsxs(je,{className:"glass-card border-white/10 sm:max-w-[400px]",children:[e.jsxs(ve,{children:[e.jsxs(ye,{className:"flex items-center gap-2",children:[x==="approve"||x==="bulk_approve"?e.jsx(we,{className:"w-5 h-5 text-emerald-500"}):e.jsx(pe,{className:"w-5 h-5 text-red-500"}),x==="approve"&&"Confirmar Validação",x==="reject"&&"Rejeitar Apontamento",x==="bulk_approve"&&"Aprovação em Massa",x==="bulk_reject"&&"Rejeição em Massa"]}),e.jsx(He,{className:"text-xs",children:p?e.jsxs(e.Fragment,{children:["Torre: ",e.jsx("span",{className:"font-bold text-foreground",children:(_=p==null?void 0:p.tower)==null?void 0:_.objectId})," | Atividade: ",e.jsx("span",{className:"font-bold text-foreground",children:(se=p==null?void 0:p.activity)==null?void 0:se.name})]}):e.jsxs(e.Fragment,{children:["Ação em massa para ",e.jsx("span",{className:"font-bold text-foreground",children:N.length})," registros selecionados."]})})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[p&&e.jsxs("div",{className:"p-3 rounded-xl bg-white/5 border border-white/10 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center text-[10px] uppercase font-black tracking-widest opacity-60",children:[e.jsx("span",{children:"Progresso Reportado"}),e.jsxs("span",{className:"text-primary",children:[p==null?void 0:p.progressPercent,"%"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${p==null?void 0:p.progressPercent}%`}})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest opacity-60 pl-1",children:"Notas de Auditoria (Opcional)"}),e.jsx(zs,{placeholder:"Descreva observações técnicas sobre esta validação...",className:"glass-card border-white/5 bg-white/2 min-h-[80px] text-xs",value:f,onChange:g=>A(g.target.value)})]})]}),e.jsxs(Ne,{className:"gap-2 sm:gap-0",children:[e.jsx(y,{variant:"ghost",size:"sm",className:"text-xs font-bold uppercase tracking-widest",onClick:()=>v(null),children:"Cancelar"}),e.jsx(y,{size:"sm",className:x==="approve"||x==="bulk_approve"?"gradient-primary":"bg-red-500 hover:bg-red-600",onClick:F,disabled:i||E,children:i||E?"Processando...":x==="approve"||x==="bulk_approve"?"Confirmar Agora":"Confirmar Rejeição"})]})]})})]})}function Mr({projectId:s,pendingAudits:a=0}){const r=j.useMemo(()=>[{subject:"Qualidade",A:85,fullMark:100},{subject:"Segurança",A:92,fullMark:100},{subject:"Prazo",A:78,fullMark:100},{subject:"Custos",A:65,fullMark:100},{subject:"Documentação",A:88,fullMark:100},{subject:"Compliance",A:95,fullMark:100}],[]),t=j.useMemo(()=>[{title:"Score de Governança",value:"84/100",sub:"+4% vs mês anterior",icon:De,color:"text-emerald-500",bg:"bg-emerald-500/10",detail:"Índice de conformidade técnica e administrativa."},{title:"Exposição a Risco",value:"MÉDIA",sub:"3 alertas críticos",icon:Oa,color:"text-amber-500",bg:"bg-amber-500/10",detail:"Baseado em atrasos e falhas de documentação."},{title:"Eficiência Líquida",value:"92%",sub:"Alta performance",icon:Ca,color:"text-sky-500",bg:"bg-sky-500/10",detail:"Relação entre avanço físico e esforço HH."},{title:"Status de Auditoria",value:`${a}`,sub:"Pendentes",icon:fs,color:"text-purple-500",bg:"bg-purple-500/10",detail:"Processos aguardando validação pela gerência."}],[a]);return e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:t.map((i,o)=>e.jsx(W,{className:"glass-card border-white/5 group hover:border-primary/20 transition-all",children:e.jsxs(J,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:ne("p-2 rounded-xl",i.bg),children:e.jsx(i.icon,{className:ne("w-5 h-5",i.color)})}),e.jsx(G,{variant:"outline",className:"text-[9px] font-black tracking-widest border-white/10 uppercase",children:"GAPO V3"})]}),e.jsx("h3",{className:"text-xs font-bold uppercase tracking-widest opacity-60 mb-1",children:i.title}),e.jsx("div",{className:"text-3xl font-black tracking-tight mb-1",children:i.value}),e.jsx("p",{className:ne("text-[10px] font-bold mb-3",i.color),children:i.sub}),e.jsx("div",{className:"pt-3 border-t border-white/5",children:e.jsx("p",{className:"text-[9px] text-muted-foreground leading-relaxed italic line-clamp-2",children:i.detail})})]})},o))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(W,{className:"glass-card lg:col-span-1 border-white/5 overflow-hidden",children:[e.jsxs(Ae,{className:"pb-2 border-b border-white/5 bg-white/1",children:[e.jsxs(ke,{className:"text-xs font-black uppercase tracking-widest flex items-center gap-2",children:[e.jsx(qs,{className:"w-4 h-4 text-emerald-500"}),"Radar de Governança"]}),e.jsx(Ke,{className:"text-[10px]",children:"Métricas de conformidade multipropósito."})]}),e.jsx(J,{className:"p-4 flex items-center justify-center",children:e.jsx("div",{className:"h-[280px] w-full mt-4",children:e.jsx(Zs,{width:"100%",height:"100%",children:e.jsxs(Tr,{cx:"50%",cy:"50%",outerRadius:"80%",data:r,children:[e.jsx(Ta,{stroke:"rgba(255,255,255,0.05)"}),e.jsx(Ea,{dataKey:"subject",tick:{fill:"rgba(255,255,255,0.4)",fontSize:10,fontWeight:"bold"}}),e.jsx(ce,{name:"Performance",dataKey:"A",stroke:"#f59e0b",fill:"#f59e0b",fillOpacity:.4})]})})})})]}),e.jsxs(W,{className:"glass-card lg:col-span-2 border-white/5",children:[e.jsx(Ae,{className:"pb-2 border-b border-white/5 bg-white/1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(ke,{className:"text-xs font-black uppercase tracking-widest flex items-center gap-2",children:[e.jsx(rr,{className:"w-4 h-4 text-amber-500"}),"Prioridades de Auditoria"]}),e.jsx(Ke,{className:"text-[10px]",children:"Itens que necessitam de intervenção técnica imediata."})]}),e.jsx(G,{className:"bg-primary text-[10px] font-black",children:"SLA: 24h"})]})}),e.jsx(J,{className:"p-4",children:e.jsx(_r,{projectId:s})})]})]}),e.jsxs("div",{className:"p-4 rounded-2xl border border-white/5 bg-white/1 flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center border border-emerald-500/20",children:e.jsx(we,{className:"w-5 h-5 text-emerald-500"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[11px] font-black uppercase tracking-widest",children:"Selo GAPO Premium"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Esta obra está operando dentro dos padrões de conformidade técnica nível A1."})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"px-3 py-1.5 rounded-lg bg-white/5 border border-white/10 text-[9px] font-bold uppercase tracking-widest",children:"Última Auditoria: Hoje, 14:20"}),e.jsx("div",{className:"px-3 py-1.5 rounded-lg bg-emerald-500/10 border border-emerald-500/20 text-[9px] font-bold uppercase tracking-widest text-emerald-500",children:"Status: Auditado"})]})]})]})}function Pt(){const[s,a]=j.useState(()=>localStorage.getItem("gapo_project_id")),[r,t]=j.useState(null),{sites:i}=Ds(s||void 0);j.useEffect(()=>{s&&i.length>0&&!r?t(i[0].id):s||t(null)},[s,i,r]);const{toast:o}=Sa(),{stages:l}=Ss(r||"all",s),{records:m}=Cs(),{pendingCount:p}=tr(),v=f=>{o({title:`Exportação ${f}`,description:`A exportação do relatório em ${f} está sendo processada e será baixada em instantes.`})};return e.jsxs("div",{className:"space-y-6 animate-fade-in p-2 md:p-6",children:[e.jsxs("header",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-xl bg-primary/10",children:e.jsx(De,{className:"w-8 h-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-black font-display tracking-tight text-foreground uppercase",children:"Módulo GAPO"}),e.jsx("p",{className:"text-muted-foreground text-xs font-medium italic",children:"Gestão, Auditoria e Performance de Obras"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full md:w-auto",children:[e.jsx("div",{className:"w-full sm:w-[250px]",children:e.jsx(gs,{value:s||"",onValueChange:f=>{a(f==="all"?null:f),t(null)}})}),s&&e.jsx("div",{className:"w-full sm:w-[200px]",children:e.jsxs(bs,{value:r||"",onValueChange:t,children:[e.jsx(js,{className:"bg-slate-900/50 border-white/10 h-10 text-[11px] font-bold uppercase tracking-wider rounded-xl",children:e.jsx(vs,{placeholder:"Todos os Canteiros"})}),e.jsxs(ys,{className:"bg-slate-950 border-white/10",children:[e.jsx(la,{value:"all",className:"text-[11px] font-bold uppercase",children:"Todos os Canteiros"}),i.map(f=>e.jsx(la,{value:f.id,className:"text-[11px] font-bold uppercase",children:f.name},f.id))]})]})})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(y,{variant:"outline",size:"sm",className:"glass-card gap-2 text-[10px] font-black uppercase tracking-widest border-white/5 h-9",onClick:()=>v("PDF"),children:[e.jsx(er,{className:"w-3.5 h-3.5 text-primary"})," PDF"]}),e.jsxs(y,{variant:"outline",size:"sm",className:"glass-card gap-2 text-[10px] font-black uppercase tracking-widest border-white/5 h-9",onClick:()=>v("EXCEL"),children:[e.jsx(Ns,{className:"w-3.5 h-3.5 text-emerald-500"})," Excel"]}),e.jsxs(y,{variant:"outline",size:"sm",className:"glass-card gap-2 text-[10px] font-black uppercase tracking-widest border-white/5 h-9",children:[e.jsx(Ge,{className:"w-3.5 h-3.5 text-blue-500"})," Filtros"]}),e.jsx("div",{className:"w-px h-6 bg-white/10 mx-1 hidden md:block"}),e.jsxs(y,{size:"sm",className:"gradient-primary gap-2 text-[10px] font-black uppercase tracking-widest h-9",children:[e.jsx(te,{className:"w-3.5 h-3.5"})," Exportar Tudo"]})]})]}),s?e.jsxs(Ps,{defaultValue:"dashboard",className:"w-full",children:[e.jsxs(As,{className:"glass-card mb-8 p-1 flex justify-start overflow-x-auto gap-2 border-white/5",children:[e.jsxs(xe,{value:"dashboard",className:"gap-2 px-6 py-2",children:[e.jsx(ws,{className:"w-4 h-4"})," Dashboard"]}),e.jsxs(xe,{value:"audit",className:"gap-2 px-6 py-2",children:[e.jsx(ka,{className:"w-4 h-4"})," Auditoria Operacional"]}),e.jsxs(xe,{value:"documents",className:"gap-2 px-6 py-2",children:[e.jsx(Ve,{className:"w-4 h-4"})," Documentação"]}),e.jsxs(xe,{value:"performance",className:"gap-2 px-6 py-2",children:[e.jsx(ar,{className:"w-4 h-4"})," Performance"]})]}),e.jsx(he,{value:"dashboard",className:"space-y-6",children:e.jsx(Mr,{projectId:s||void 0,stages:l,records:m,pendingAudits:p})}),e.jsx(he,{value:"audit",children:e.jsx(nr,{projectId:s||void 0,siteId:r||void 0})}),e.jsx(he,{value:"documents",children:e.jsx(ir,{projectId:s,siteId:r})}),e.jsx(he,{value:"performance",children:e.jsx(Fs,{projectId:s||void 0,stages:l,records:m})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center min-h-[500px]",children:e.jsx(ks,{type:"generic",title:"GAPO: Selecione uma Obra",description:"Selecione um projeto acima para visualizar os dados de auditoria e performance."})})]})}export{Pt as default};
