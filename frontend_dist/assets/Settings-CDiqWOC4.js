import{f as ze,r,g as de,j as e,e as me,B as c,u as le,O as ce,p as C,L as D,ac as ss,ad as as,ae as ts,af as rs,i as is,K as te,a8 as Ie,ag as ns,s as re,ah as os,ai as ls,aj as Pe,ak as cs,a5 as ds,D as L,k as V,l as U,m as q,o as J,al as ms,am as us,an as xs,ao as Me,ap as ps,aq as hs}from"./index-D951x4H-.js";import{C as M,b as _,c as $,a as E}from"./card-BTHGlYFz.js";import{I as O}from"./input-dNnkIPn6.js";import{S as Te,Q as fs,I as gs,T as js,P as Le}from"./index-LiCGkmGi.js";import{D as Ee}from"./download-L1tB_Hhn.js";import{E as Ve}from"./ellipsis-vertical-DHbXCy2I.js";import{S as ie}from"./slider-fkHl-ud9.js";import{C as vs}from"./copy-CXglQ41p.js";import{C as Ns}from"./circle-alert-BlgUQYiE.js";import{C as ws}from"./ConfirmationDialog-96fSVVNc.js";import{C as bs,a as ys,b as Cs,c as De}from"./context-menu-CftfI8l1.js";import{P as Ss}from"./pencil-DX9IZKx2.js";import{T as ne}from"./trash-2-DD2QlM38.js";import{L as oe}from"./lock-BtTOdZOV.js";import{I as Oe}from"./image-CBHGYJfV.js";import{T as As}from"./triangle-alert-BPKdZxxI.js";import{Z as Fe}from"./zoom-in-C25xHsbW.js";import{M as Re}from"./move-CukShz45.js";import"./alert-dialog-qR-bbYaw.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]],Is=ze("Share",ks);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],Ms=ze("SquarePlus",Ps);function Es(){const[n,s]=r.useState(null),[m,A]=r.useState(!1),[w,k]=r.useState(!1),[x,f]=r.useState(!1),[G,F]=r.useState(!1),{toast:l}=de();r.useEffect(()=>{(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone)&&k(!0);const g=navigator.userAgent;f(/iPad|iPhone|iPod/.test(g)&&!window.MSStream),F(/OPR/i.test(g)||/Opera/i.test(g));const y=p=>{p.preventDefault(),s(p),A(!0)};return window.addEventListener("beforeinstallprompt",y),()=>{window.removeEventListener("beforeinstallprompt",y)}},[]);const b=async()=>{if(!n)return;n.prompt();const{outcome:g}=await n.userChoice;g==="accepted"&&(l({title:"Instalando...",description:"O aplicativo está sendo instalado no seu dispositivo."}),A(!1)),s(null)};return w?e.jsxs("div",{className:"flex items-center gap-2 text-success bg-success/10 p-3 rounded-lg border border-success/20 w-full",children:[e.jsx(me,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Aplicativo já instalado"})]}):x&&!w?e.jsxs("div",{className:"space-y-3 bg-secondary/30 p-4 rounded-xl border border-white/10 w-full",children:[e.jsxs("p",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Te,{className:"h-4 w-4"}),"Instalar no iPhone / iPad"]}),e.jsxs("ol",{className:"text-xs text-muted-foreground space-y-2 list-decimal list-inside",children:[e.jsxs("li",{children:["Toque no botão de compartilhar ",e.jsx(Is,{className:"h-3 w-3 inline"})," abaixo"]}),e.jsx("li",{children:'Role para baixo e selecione "Adicionar à Tela de Início"'})]})]}):m?e.jsxs(c,{onClick:b,disabled:!m,className:"w-full gap-2 gradient-primary text-white shadow-glow hover:opacity-90 transition-all h-11",children:[e.jsx(Ee,{className:"h-5 w-5"}),m?"Instalar Aplicativo":"Verificando Compatibilidade..."]}):e.jsxs("div",{className:"space-y-3 bg-secondary/30 p-4 rounded-xl border border-white/10 w-full animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-medium",children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsx("span",{children:"Instalar Aplicativo"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-2",children:[e.jsx("p",{children:"O navegador (Opera) pode exigir a instalação manual. Siga os passos:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:["Procure o ícone de ",e.jsx("strong",{children:"Adicionar"})," ",e.jsx(Ms,{className:"h-3 w-3 inline"})," na barra de endereços (lado direito)."]}),e.jsxs("li",{children:["Ou abra o menu ",e.jsx(Ve,{className:"h-3 w-3 inline"})," e selecione ",e.jsx("strong",{children:'"Instalar Aplicativo"'}),"."]})]})]})]})}function Ds({onComplete:n}){const{profile:s,user:m,enableMfa:A}=le(),{toast:w}=de(),[k,x]=r.useState(s!=null&&s.mfaEnabled?"completed":"generate"),[f,G]=r.useState(""),[F,l]=r.useState(""),[b,g]=r.useState(""),[y,p]=r.useState(!1),I=()=>{try{const i=gs(),j="GESTÃO VIRTUAL",v=(m==null?void 0:m.email)||(s==null?void 0:s.fullName)||"user",P=js({issuer:j,label:v,secret:i});G(i),l(P),x("verify")}catch(i){console.error("MFA Error:",i)}},K=async()=>{if(b.length===6){p(!0);try{const i=await Le({token:b,secret:f});if(console.log("MFA Setup Verification:",{codeReceived:b,isValid:i.valid,secretUsed:f.substring(0,4)+"..."}),!i.valid){w({title:"Código Inválido",description:"O código inserido não coincide com o QR Code.",variant:"destructive"});return}const j=await A(f);if(!j.success)throw new Error(j.error);w({title:"MFA Ativado!",description:"Sua conta agora está protegida com autenticação de dois fatores."}),x("completed"),n&&n()}catch(i){w({title:"Erro ao ativar MFA",description:i.message,variant:"destructive"})}finally{p(!1)}}},Q=()=>{navigator.clipboard.writeText(f),w({description:"Segredo copiado para a área de transferência."})};return k==="completed"?e.jsxs("div",{className:"p-6 text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-success/10 rounded-full flex items-center justify-center mx-auto",children:e.jsx(me,{className:"w-10 h-10 text-success"})}),e.jsx("h3",{className:"text-xl font-bold",children:"MFA Ativado"}),e.jsx("p",{className:"text-muted-foreground",children:"Sua conta está blindada. Você precisará do Microsoft Authenticator para logar."}),e.jsx(c,{variant:"outline",className:"w-full",onClick:()=>x("generate"),children:"Reconfigurar (Gerar Novo)"})]}):e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-primary/10 border border-primary/20 rounded-lg",children:[e.jsx(ce,{className:"w-5 h-5 text-primary"}),e.jsx("p",{className:"text-sm font-medium",children:"Eleve a segurança da sua conta para o nível industrial."})]}),k==="generate"?e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Clique abaixo para gerar seu segredo único e configurar o protoloco TOTP."}),e.jsx(c,{onClick:I,className:"w-full gradient-primary",children:"Começar Configuração"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"p-4 bg-white rounded-xl shadow-inner inline-block",children:e.jsx(fs,{value:F,size:200})}),e.jsx("p",{className:"text-xs text-muted-foreground text-center max-w-[250px]",children:"Escaneie este QR Code usando o Microsoft Authenticator ou Google Authenticator."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg border border-dashed border-white/20",children:[e.jsx(C,{className:"text-[10px] uppercase text-muted-foreground mb-1 block",children:"Segredo Manual"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("code",{className:"text-xs font-mono",children:f}),e.jsx(c,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:Q,children:e.jsx(vs,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"verification",children:"Digite o código de 6 dígitos para validar"}),e.jsx(O,{id:"verification",placeholder:"000 000",value:b,onChange:i=>g(i.target.value.replace(/\D/g,"").slice(0,6)),className:"text-center text-2xl tracking-[0.5em] font-bold h-14"})]}),e.jsx(c,{onClick:K,className:"w-full h-12 text-lg font-bold",disabled:b.length!==6||y,children:y?e.jsx(D,{className:"w-5 h-5 animate-spin mr-2"}):"Ativar MFA"}),e.jsxs("div",{className:"flex items-start gap-2 text-[11px] text-amber-500 bg-amber-500/5 p-2 rounded border border-amber-500/20",children:[e.jsx(Ns,{className:"w-3.5 h-3.5 shrink-0"}),e.jsx("span",{children:"Não compartilhe seu segredo com ninguém. Guarde-o em local seguro."})]})]})]})]})}function Ys(){var Ae;const{user:n,profile:s,logout:m,disableMfa:A,refreshProfile:w}=le(),k=ss(),{isOnline:x,pendingChanges:f,syncNow:G}=as(),{updateUser:F}=ts(),{toast:l}=de(),{sendMessage:b,checkPasswordPermission:g,consumePasswordPermission:y}=rs(),[p,I]=r.useState(!1),[K,Q]=r.useState(!1),[i,j]=r.useState({fullName:"",email:"",image:""}),[v,P]=r.useState(""),[H,ue]=r.useState(!1),[Ue,xe]=r.useState(!1),[pe,he]=r.useState(!1),[qe,fe]=r.useState(!1),[_e,B]=r.useState(!1),[Z,ee]=r.useState(""),[ge,je]=r.useState(!1),[S,se]=r.useState(null),[R,$e]=r.useState(!1),[W,ve]=r.useState(null),[Ge,X]=r.useState(!1),[h,Y]=r.useState({zoom:1,x:0,y:0}),[z,Ne]=r.useState({open:!1,title:"",description:"",onConfirm:()=>{},variant:"default"}),{changePassword:we}=le(),ae=(s==null?void 0:s.fullName)||((Ae=n==null?void 0:n.email)==null?void 0:Ae.split("@")[0])||"Usuário",d=is.value;console.log(d),r.useEffect(()=>{(async()=>{if(p&&!d){const t=await g();xe(!t)}})()},[p,d,g]),r.useEffect(()=>{let a;return R&&S===null?se(5):R&&S!==null&&S>0?a=setInterval(()=>{se(t=>t!==null?t-1:null)},1e3):R&&S===0&&m(),()=>{a&&clearInterval(a)}},[R,S,m]);const be=()=>{j({fullName:(s==null?void 0:s.fullName)||"",email:(n==null?void 0:n.email)||"",image:(s==null?void 0:s.image)||""}),I(!0)},ye=()=>{j(a=>({...a,image:""})),l({title:"Foto removida",description:"A foto foi removida da sua prévia. Lembre-se de salvar as alterações."})},Ke=async a=>{var o;const t=(o=a.target.files)==null?void 0:o[0];if(t){if(!t.type.startsWith("image/")){l({title:"Tipo inválido",description:"Por favor, selecione uma imagem.",variant:"destructive"});return}Ce(t)}},Ce=async a=>{const t=new FileReader;t.onload=async o=>{var N;const u=(N=o.target)==null?void 0:N.result;ve(u),Y({zoom:1,x:0,y:0}),X(!0)},t.readAsDataURL(a)},Qe=async()=>{if(!W)return;const a=new Image;a.onload=()=>{const t=document.createElement("canvas"),o=400;t.width=o,t.height=o;const u=t.getContext("2d");if(!u)return;u.beginPath(),u.arc(o/2,o/2,o/2,0,Math.PI*2),u.clip();const N=Math.min(a.width,a.height),T=a.width/N*o*h.zoom,ke=a.height/N*o*h.zoom,Xe=(o-T)/2+h.x*o/100,Ye=(o-ke)/2+h.y*o/100;u.fillStyle="#FFFFFF",u.fillRect(0,0,o,o),u.drawImage(a,Xe,Ye,T,ke);const Je=t.toDataURL("image/jpeg",.9);j(es=>({...es,image:Je})),X(!1),ve(null),l({title:"Foto aplicada",description:"Seu novo avatar foi configurado."})},a.src=W};r.useEffect(()=>{const a=t=>{var u;if(!p)return;const o=(u=t.clipboardData)==null?void 0:u.items;if(o){for(let N=0;N<o.length;N++)if(o[N].type.indexOf("image")!==-1){const T=o[N].getAsFile();if(T){Ce(T);break}}}};return window.addEventListener("paste",a),()=>window.removeEventListener("paste",a)},[p]);const He=async()=>{if(!(s!=null&&s.id)||!i.fullName||!i.email){l({title:"Campos obrigatórios",description:"Preencha nome e email",variant:"destructive"});return}Q(!0);const a=await F(s.id,{fullName:i.fullName,email:i.email!==(n==null?void 0:n.email)?i.email:void 0,image:i.image});if(a.success&&await w(),a.success&&v.length>=6){const t=await we(v);t.success&&!d?await y():t.success||l({title:"Senha não atualizada",description:t.error,variant:"destructive"})}Q(!1),a.success?(l({title:"Perfil atualizado",description:"Suas informações foram atualizadas com sucesso."}),I(!1),P(""),setTimeout(()=>window.location.reload(),1e3)):l({title:"Erro ao atualizar",description:a.error,variant:"destructive"})},Se=async()=>{if(v.length<6){l({title:"Senha muito curta",description:"A senha deve ter pelo menos 6 caracteres",variant:"destructive"});return}ue(!0);const a=await we(v);ue(!1),a.success?(d||await y(),l({title:"Senha atualizada",description:"Sua senha foi alterada com sucesso."}),P(""),setIsChangingPassword(!1)):l({title:"Erro ao alterar senha",description:a.error,variant:"destructive"})},Be=async()=>{he(!0);try{await b({type:"PASSWORD_RESET",subject:"Solicitação de Redefinição de Senha",content:`O usuário ${s==null?void 0:s.fullName} (${n==null?void 0:n.email}) solicitou a redefinição de senha através do painel de configurações.`,recipientRole:"admin",companyId:s==null?void 0:s.companyId,projectId:s==null?void 0:s.projectId,siteId:s==null?void 0:s.siteId,metadata:{source:"settings_panel",userId:n==null?void 0:n.id,userName:s==null?void 0:s.fullName}}),l({title:"Solicitação enviada",description:"Os administradores foram notificados."})}catch{l({title:"Erro ao solicitar",description:"Tente novamente mais tarde.",variant:"destructive"})}finally{he(!1)}},Ze=async()=>{try{await hs.clearAll(),k.clear(),l({title:"Cache limpo",description:"Os dados temporários foram removidos com sucesso."}),setTimeout(()=>window.location.reload(),1e3)}catch{l({title:"Erro ao limpar cache",description:"Ocorreu um erro ao tentar limpar os dados.",variant:"destructive"})}},We=()=>{Ne({open:!0,title:"Limpar Todos os Dados",description:"Tem certeza? Esta ação removerá todos os caches locais e desconectará sua conta. Todos os dados não sincronizados serão perdidos permanentemente!",variant:"destructive",onConfirm:()=>{localStorage.clear(),l({title:"Dados limpos",description:"Todos os dados foram removidos"}),m()}})};return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(M,{className:"glass-card",children:[e.jsx(_,{children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),"Perfil"]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:be,className:"h-8",children:[e.jsx(Ss,{className:"w-3.5 h-3.5 mr-1.5"}),"Editar"]})]})}),e.jsx(E,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative group cursor-pointer",onClick:be,title:"Clique para alterar foto",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center text-2xl font-bold text-primary overflow-hidden border border-primary/20 transition-all group-hover:border-primary/50 group-hover:shadow-[0_0_15px_-3px_rgba(var(--primary),0.3)]",children:s!=null&&s.image?e.jsx("img",{src:s.image,alt:ae,className:"w-full h-full object-cover"}):ae.charAt(0).toUpperCase()}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded-full",children:e.jsx(Ie,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-lg",children:ae}),e.jsx("p",{className:"text-muted-foreground",children:n==null?void 0:n.email}),e.jsx("p",{className:re("inline-block mt-2 px-2 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-tight transition-all",os((s==null?void 0:s.role)||"worker")),children:ns((s==null?void 0:s.role)||"worker")})]})]})})]}),e.jsxs(M,{className:"glass-card",children:[e.jsx(_,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5"}),"Aplicativo"]})}),e.jsx(E,{children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Instale o aplicativo no seu dispositivo para acesso rápido e offline."}),e.jsx(Es,{})]})})]}),e.jsxs(M,{className:"glass-card",children:[e.jsx(_,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"w-5 h-5"}),"Sincronização"]})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Status"}),e.jsx("p",{className:`text-sm ${x?"text-green-500":"text-red-500"}`,children:x?"Online":"Offline"})]}),e.jsx("div",{className:`w-3 h-3 rounded-full ${x?"bg-green-500":"bg-red-500"} animate-pulse`})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Pendentes"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[f," item(s)"]})]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:G,disabled:f===0,children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Sincronizar"]})]})]})]}),e.jsxs(M,{className:"glass-card",children:[e.jsx(_,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"w-5 h-5"}),"Dados"]})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs(c,{variant:"outline",onClick:Ze,className:"w-full border-amber-500/30 text-amber-500 hover:bg-amber-500/10",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Limpar Cache de Dados"]}),e.jsxs(c,{variant:"destructive",onClick:We,className:"w-full",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Limpar Tudo e Sair"]})]})]}),e.jsxs(M,{className:"glass-card border-primary/20 bg-primary/5",children:[e.jsx(_,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5 text-primary"}),"Segurança (2FA)"]})}),e.jsxs(E,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s!=null&&s.mfaEnabled?"A autenticação de dois fatores está ATIVADA na sua conta.":"Adicione uma camada extra de segurança usando o Microsoft Authenticator."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{variant:s!=null&&s.mfaEnabled?"outline":"default",className:`w-full ${!(s!=null&&s.mfaEnabled)&&"gradient-primary"}`,onClick:()=>fe(!0),children:s!=null&&s.mfaEnabled?"Ver QR Code":"Ativar 2FA"}),(s==null?void 0:s.mfaEnabled)&&e.jsxs(c,{variant:"destructive","variant-ghost":"true",className:"w-full text-xs h-8 border border-destructive/20",onClick:()=>{ee(""),B(!0)},children:[e.jsx(oe,{className:"w-3 h-3 mr-2"})," Desativar 2FA"]})]})]})]}),e.jsx(M,{className:"glass-card",children:e.jsx(E,{className:"pt-6",children:e.jsxs(c,{variant:"outline",onClick:m,className:"w-full",disabled:!x,children:[e.jsx(ds,{className:"w-4 h-4 mr-2"}),"Sair da Conta ",!x&&"(Offline)"]})})}),e.jsx(L,{open:p,onOpenChange:I,children:e.jsxs(V,{children:[e.jsxs(U,{children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5 text-primary"}),"Editar Meu Perfil"]}),e.jsx(J,{children:"Atualize suas informações pessoais e foto"})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4 py-2",children:[e.jsxs(bs,{children:[e.jsx(ys,{asChild:!0,children:e.jsxs(ms,{children:[e.jsx(us,{asChild:!0,children:e.jsxs("div",{className:"relative group cursor-pointer",children:[e.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden border-2 border-primary/20 bg-muted flex items-center justify-center transition-all group-hover:border-primary/50 shadow-lg",children:i.image?e.jsx("img",{src:i.image,alt:"Preview",className:"w-full h-full object-cover"}):e.jsx(te,{className:"w-10 h-10 text-muted-foreground"})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded-full",children:e.jsx(Ie,{className:"w-6 h-6 text-white"})}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-7 h-7 bg-primary rounded-full flex items-center justify-center border-2 border-background shadow-md md:hidden",children:e.jsx(Ve,{className:"w-4 h-4 text-white"})})]})}),e.jsxs(xs,{align:"center",className:"w-48 bg-black/90 backdrop-blur-xl border-primary/20",children:[e.jsxs(Me,{onClick:()=>{var a;return(a=document.getElementById("profile-image-upload"))==null?void 0:a.click()},className:"cursor-pointer gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"})," Alterar Foto"]}),i.image&&e.jsxs(Me,{onClick:ye,className:"cursor-pointer gap-2 text-destructive focus:text-destructive",children:[e.jsx(ne,{className:"w-4 h-4"})," Remover Foto"]})]})]})}),e.jsxs(Cs,{className:"w-48 bg-black/90 backdrop-blur-xl border-primary/20",children:[e.jsxs(De,{onClick:()=>{var a;return(a=document.getElementById("profile-image-upload"))==null?void 0:a.click()},className:"cursor-pointer gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"})," Alterar Foto"]}),i.image&&e.jsxs(De,{onClick:ye,className:"cursor-pointer gap-2 text-destructive focus:text-destructive",children:[e.jsx(ne,{className:"w-4 h-4"})," Remover Foto"]})]})]}),e.jsx("input",{id:"profile-image-upload",type:"file",accept:"image/*",className:"hidden",onChange:Ke}),e.jsx("p",{className:"text-[10px] text-muted-foreground uppercase tracking-widest font-bold",children:"Clique ou botão direito para opções"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{htmlFor:"profile-name",children:"Nome Completo *"}),d&&e.jsx("span",{className:"text-[10px] font-bold text-red-500 animate-pulse border border-red-500 rounded px-1 cursor-help",title:"Campo restrito: Apenas Super Admin pode editar",children:"CLICK ME (ADMIN)"})]}),e.jsx(O,{id:"profile-name",value:i.fullName,onChange:a=>j({...i,fullName:a.target.value}),className:re("industrial-input",!d&&"opacity-70 cursor-not-allowed bg-muted"),placeholder:"Seu nome completo",readOnly:!d,disabled:!d}),!d&&e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Para alterar seu nome, entre em contato com o suporte ou administrador."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{htmlFor:"profile-email",children:"Email"}),d&&e.jsx("span",{className:"text-[10px] font-bold text-red-500 animate-pulse border border-red-500 rounded px-1 cursor-help",title:"Campo restrito: Apenas Super Admin pode editar",children:"CLICK ME (ADMIN)"})]}),e.jsx(O,{id:"profile-email",type:"email",value:i.email,onChange:a=>j({...i,email:a.target.value}),className:re("industrial-input",!d&&"opacity-70 cursor-not-allowed bg-muted"),placeholder:"seu@email.com",readOnly:!d,disabled:!d}),d?e.jsx("p",{className:"text-xs text-muted-foreground",children:"⚠️ Alterar o email pode exigir nova autenticação"}):e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Email gerenciado pela organização. Entre em contato para alterações."})]}),e.jsxs("div",{className:"pt-4 border-t space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-primary",children:[e.jsx(oe,{className:"w-4 h-4"}),"Segurança da Conta"]}),d?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(C,{htmlFor:"dialog-new-password",children:["Nova Senha (SuperAdmin)"," ",e.jsx("span",{className:"text-xs text-muted-foreground font-normal",children:"(Opcional)"})]}),e.jsx("span",{className:"text-[10px] font-bold text-red-500 animate-pulse border border-red-500 rounded px-1 cursor-help",title:"Campo restrito: Apenas Super Admin pode editar",children:"CLICK ME (ADMIN)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{id:"dialog-new-password",type:"text",value:v,onChange:a=>P(a.target.value),className:"industrial-input flex-1",placeholder:"Mínimo 6 caracteres",autoComplete:"new-password"}),e.jsx(c,{type:"button",variant:"outline",className:"h-10 border-primary/20 hover:bg-primary/10 text-primary",onClick:Se,disabled:H||v.length<6,children:H?e.jsx(D,{className:"w-4 h-4 animate-spin"}):"Atualizar"})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Como SuperAdmin, você pode alterar sua senha diretamente."})]}):Ue?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-green-500/10 border border-green-500/30 rounded-lg",children:[e.jsx(me,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Autorização concedida para alterar senha"})]}),e.jsxs(C,{htmlFor:"dialog-new-password",children:["Nova Senha"," ",e.jsx("span",{className:"text-xs text-muted-foreground font-normal",children:"(Opcional)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{id:"dialog-new-password",type:"password",value:v,onChange:a=>P(a.target.value),className:"industrial-input flex-1",placeholder:"Mínimo 6 caracteres",autoComplete:"new-password"}),e.jsx(c,{type:"button",variant:"outline",className:"h-10 border-green-500/50 hover:bg-green-500/10 text-green-600",onClick:async()=>{await Se(),await y(),xe(!1)},disabled:H||v.length<6,children:H?e.jsx(D,{className:"w-4 h-4 animate-spin"}):"Atualizar Senha"})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Esta autorização expira em 12h após a aprovação do ticket."})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Para garantir a segurança, a alteração de senha deve ser solicitada à administração."}),e.jsxs(c,{type:"button",variant:"secondary",className:"w-full border border-primary/20",onClick:Be,disabled:pe,children:[pe?e.jsx(D,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(ps,{className:"w-4 h-4 mr-2"}),"Solicitar Redefinição de Senha"]}),e.jsx("p",{className:"text-[10px] text-muted-foreground text-center",children:"Um ticket será aberto para a equipe administrativa."})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(c,{variant:"ghost",onClick:()=>I(!1),children:"Cancelar"}),e.jsxs(c,{className:"gradient-primary",onClick:He,disabled:K||!i.fullName||!i.email,children:[K&&e.jsx(D,{className:"w-4 h-4 mr-2 animate-spin"}),"Salvar Alterações"]})]})]})}),e.jsx(L,{open:qe,onOpenChange:fe,children:e.jsxs(V,{className:"sm:max-w-md",children:[e.jsx(U,{children:e.jsx(q,{children:"Configurar Autenticação em Duas Etapas"})}),e.jsx(Ds,{onComplete:()=>{setTimeout(()=>window.location.reload(),2e3)}})]})}),e.jsx(ws,{open:z.open,onOpenChange:a=>Ne(t=>({...t,open:a})),title:z.title,description:z.description,onConfirm:z.onConfirm,variant:z.variant}),e.jsx(L,{open:_e,onOpenChange:B,children:e.jsxs(V,{className:"sm:max-w-md",children:[e.jsxs(U,{children:[e.jsxs(q,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(As,{className:"w-5 h-5"}),"Desativar Autenticação 2FA"]}),e.jsx(J,{children:"Para confirmar a desativação, insira o código do seu aplicativo autenticador."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("div",{className:"p-3 bg-destructive/10 border border-destructive/20 rounded-lg",children:e.jsx("p",{className:"text-sm text-destructive font-medium",children:"⚠️ Atenção: Desativar o 2FA deixará sua conta menos protegida."})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"disable-mfa-code",children:"Código do Autenticador (6 dígitos)"}),e.jsx(O,{id:"disable-mfa-code",type:"text",inputMode:"numeric",maxLength:6,value:Z,onChange:a=>ee(a.target.value.replace(/\D/g,"")),className:"industrial-input text-center text-2xl tracking-widest font-mono",placeholder:"000000",autoComplete:"one-time-code"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(c,{variant:"outline",onClick:()=>B(!1),children:"Cancelar"}),e.jsxs(c,{variant:"destructive",disabled:Z.length!==6||ge,onClick:async()=>{if(!(Z.length!==6||!(s!=null&&s.mfaSecret))){je(!0);try{if((await Le({token:Z,secret:s.mfaSecret})).valid){const t=await A();t.success?(console.log("MFA Disabled successfully, starting cooldown..."),B(!1),$e(!0),se(5)):l({title:"Erro ao desativar",description:t.error,variant:"destructive"})}else l({title:"Código inválido",description:"O código inserido está incorreto ou expirou.",variant:"destructive"})}catch{l({title:"Erro de verificação",description:"Não foi possível verificar o código.",variant:"destructive"})}finally{je(!1),ee("")}}},children:[ge?e.jsx(D,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Confirmar Desativação"]})]})]})}),e.jsx(L,{open:R,onOpenChange:()=>{},children:e.jsxs(V,{className:"sm:max-w-md border-primary/50 shadow-glow bg-black/90 backdrop-blur-xl z-9999",onPointerDownOutside:a=>a.preventDefault(),onEscapeKeyDown:a=>a.preventDefault(),onInteractOutside:a=>a.preventDefault(),children:[e.jsxs(U,{className:"space-y-4",children:[e.jsx("div",{className:"mx-auto w-16 h-16 rounded-full bg-primary/20 flex items-center justify-center border border-primary/30 animate-pulse",children:e.jsx(ce,{className:"w-8 h-8 text-primary"})}),e.jsx(q,{className:"text-center text-xl font-bold",children:"Segurança Atualizada"}),e.jsx(J,{className:"text-center text-white/70",children:"A segurança de dois fatores foi removida com sucesso. Por motivos de segurança, sua sessão será encerrada em:"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center py-6",children:[e.jsx("div",{className:"text-6xl font-black text-primary tabular-nums drop-shadow-[0_0_15px_rgba(var(--primary),0.5)]",children:S!==null?S:5}),e.jsx("p",{className:"mt-2 text-xs uppercase tracking-[0.2em] font-bold text-muted-foreground",children:"segundos"})]}),e.jsx("div",{className:"p-4 rounded-xl bg-orange-500/10 border border-orange-500/20",children:e.jsx("p",{className:"text-xs text-center text-orange-400 font-medium",children:"Aguarde o redirecionamento automático para a tela de login."})})]})}),e.jsx(L,{open:Ge,onOpenChange:X,children:e.jsxs(V,{className:"sm:max-w-md border-primary/20 bg-black/90 backdrop-blur-xl",children:[e.jsxs(U,{children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5 text-primary"}),"Ajustar Enquadramento"]}),e.jsx(J,{children:"Regule o zoom e a posição da sua foto de perfil"})]}),e.jsxs("div",{className:"py-6 space-y-8",children:[e.jsxs("div",{className:"photo-adjust-viewport checkerboard-bg",style:{borderColor:"#fbbf24"},children:[e.jsx("div",{className:"image-stage",children:W&&e.jsx("img",{src:W,alt:"Ajuste",className:"max-w-none pointer-events-none select-none transition-transform duration-75",style:{width:"100%",height:"auto",transform:`scale(${h.zoom}) translate(${h.x}%, ${h.y}%)`}})}),e.jsx("div",{className:"photo-adjust-mask"})]}),e.jsxs("div",{className:"space-y-6 px-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs font-bold uppercase tracking-widest text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(Fe,{className:"w-3 h-3"})," Zoom"]}),e.jsxs("span",{children:[Math.round(h.zoom*100),"%"]})]}),e.jsx(ie,{value:[h.zoom],min:1,max:4,step:.01,onValueChange:([a])=>Y(t=>({...t,zoom:a}))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between text-[10px] font-bold uppercase text-muted-foreground",children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(Re,{className:"w-3 h-3"})," Horiz."]})}),e.jsx(ie,{value:[h.x],min:-50,max:50,step:1,onValueChange:([a])=>Y(t=>({...t,x:a}))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between text-[10px] font-bold uppercase text-muted-foreground",children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(Re,{className:"w-3 h-3 rotate-90"})," Vert."]})}),e.jsx(ie,{value:[h.y],min:-50,max:50,step:1,onValueChange:([a])=>Y(t=>({...t,y:a}))})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-primary/10",children:[e.jsx(c,{variant:"ghost",onClick:()=>X(!1),children:"Cancelar"}),e.jsx(c,{className:"gradient-primary",onClick:Qe,children:"Aplicar Foto"})]})]})})]})}export{Ys as default};
