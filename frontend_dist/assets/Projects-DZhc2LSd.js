import{f as xe,r as l,g as K,t as S,j as e,L as O,ay as I,S as T,G as M,H as A,I as R,J as v,B as c,q as ue,D as Q,h as W,k as X,l as Y,m as ee,o as se,N as he,w as pe,ae as ge,i as f,d as u,v as P,aw as q,p as m,M as je,C as Ne,n as fe,a3 as ve}from"./index-D951x4H-.js";import{u as be}from"./useCompanies-kjFTA6Qu.js";import{I as h}from"./input-dNnkIPn6.js";import{C as B,b as G,c as ae,d as we,a as U}from"./card-BTHGlYFz.js";import{S as J}from"./separator-B22JG5bU.js";import{C as ye}from"./ConfirmationDialog-96fSVVNc.js";import{I as Ce}from"./info-MbzHf59N.js";import{U as De}from"./user-plus-DZOYeFz-.js";import{T as te}from"./trash-2-DD2QlM38.js";import{P as Se}from"./plus-DmkF01H_.js";import{L as Pe}from"./lock-BtTOdZOV.js";import{T as Ie}from"./trending-up-BwuTo0m4.js";import{S as Ee}from"./search-BoEw84GM.js";import{P as He}from"./pencil-DX9IZKx2.js";import{C as ke}from"./circle-user-BEeDl7ms.js";import"./alert-dialog-qR-bbYaw.js";import"./triangle-alert-BPKdZxxI.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Z=xe("BadgeCheck",Le);function Oe({projectId:n}){const[p,g]=l.useState([]),[b,w]=l.useState([]),[E,F]=l.useState([]),[$,H]=l.useState(!0),[y,C]=l.useState(!1),{toast:j}=K(),[d,x]=l.useState({jobFunctionId:"",moduleId:""});l.useEffect(()=>{o()},[n]);const o=async()=>{H(!0);try{const[t,a,r]=await Promise.all([S.get(`/projects/${n}/delegations`),S.get(`/job_functions?projectId=${n}`),S.get(`/permission_modules?projectId=${n}`)]);g(t.data||[]),w(a.data||[]),F(r.data||[])}catch(t){console.error("Erro ao carregar dados de delegação:",t)}finally{H(!1)}},k=async()=>{if(!(!d.jobFunctionId||!d.moduleId)){C(!0);try{await S.post(`/projects/${n}/delegations`,{...d,canCreate:!0,canRead:!0,canUpdate:!0,canDelete:!0}),j({title:"Poderes Delegados",description:"A função agora possui acesso administrativo ao módulo."}),o(),x({jobFunctionId:"",moduleId:""})}catch{j({title:"Erro",description:"Não foi possível delegar a permissão.",variant:"destructive"})}finally{C(!1)}}},L=async t=>{try{await S.delete(`/projects/${n}/delegations/${t}`),j({title:"Permissão Revogada"}),g(a=>a.filter(r=>r.id!==t))}catch{j({title:"Erro",description:"Não foi possível revogar a permissão.",variant:"destructive"})}};return $?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(O,{className:"animate-spin"})}):e.jsxs(B,{className:"glass-card mt-6 border-l-4 border-l-blue-500",children:[e.jsxs(G,{children:[e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-blue-500"}),"Delegação de Poderes Extras (PM)"]}),e.jsx(we,{children:"Atribua poderes de gestão para cargos específicos neste projeto."})]}),e.jsxs(U,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-4 p-4 rounded-lg bg-blue-500/10 border border-blue-500/20 text-sm text-blue-200",children:[e.jsx(Ce,{className:"w-5 h-5 shrink-0"}),e.jsxs("p",{children:["Aqui você pode delegar o controle de módulos (ex: Gestão de Funcionários) para cargos como",e.jsx("strong",{children:" RH"})," ou ",e.jsx("strong",{children:" Administrativo"}),", permitindo que eles ajudem na gestão da obra."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end bg-white/5 p-4 rounded-xl border border-white/10",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold uppercase text-muted-foreground",children:"Escolha o Cargo"}),e.jsxs(T,{value:d.jobFunctionId,onValueChange:t=>x(a=>({...a,jobFunctionId:t})),children:[e.jsx(M,{className:"industrial-input",children:e.jsx(A,{placeholder:"Selecione o cargo"})}),e.jsx(R,{className:"glass-card",children:b.map(t=>e.jsx(v,{value:t.id,children:t.name},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold uppercase text-muted-foreground",children:"Pacote de Poderes (Módulo)"}),e.jsxs(T,{value:d.moduleId,onValueChange:t=>x(a=>({...a,moduleId:t})),children:[e.jsx(M,{className:"industrial-input",children:e.jsx(A,{placeholder:"Selecione o módulo"})}),e.jsx(R,{className:"glass-card",children:E.map(t=>e.jsx(v,{value:t.id,children:t.name},t.id))})]})]}),e.jsxs(c,{onClick:k,disabled:!d.jobFunctionId||!d.moduleId||y,className:"gradient-primary text-white",children:[y?e.jsx(O,{className:"animate-spin mr-2"}):e.jsx(De,{className:"w-4 h-4 mr-2"}),"Delegar Poderes"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-xs font-bold uppercase text-muted-foreground tracking-widest px-1",children:"Poderes Ativos"}),p.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground bg-white/5 rounded-lg border border-dashed border-white/10",children:"Nenhuma delegação ativa para este projeto."}):e.jsx("div",{className:"grid gap-2",children:p.map(t=>{var a,r;return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-500",children:e.jsx(I,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold",children:(a=t.jobFunction)==null?void 0:a.name}),e.jsx("div",{className:"text-[10px] text-muted-foreground uppercase",children:(r=t.module)==null?void 0:r.name})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{variant:"outline",className:"text-[10px] border-emerald-500/50 text-emerald-500 bg-emerald-500/5",children:"FULL ACCESS"}),e.jsx(c,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>L(t.id),children:e.jsx(te,{className:"w-4 h-4"})})]})]},t.id)})})]})]})]})}function Te({projectId:n,projectName:p,trigger:g}){const[b,w]=l.useState(!1);return e.jsxs(Q,{open:b,onOpenChange:w,children:[e.jsx(W,{asChild:!0,children:g||e.jsxs(c,{variant:"outline",size:"sm",className:"h-8 gap-2 border-primary/30 hover:bg-primary/10 hover:border-primary",children:[e.jsx(I,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"hidden sm:inline",children:"Delegação de Poderes"})]})}),e.jsxs(X,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Y,{children:[e.jsxs(ee,{className:"flex items-center gap-2 text-xl font-bold",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/20 flex items-center justify-center",children:e.jsx(I,{className:"text-primary w-5 h-5"})}),"Delegação de Poderes"]}),e.jsxs(se,{className:"text-muted-foreground pt-1",children:["Configure permissões extras para cargos específicos na obra ",e.jsx("span",{className:"font-semibold text-foreground",children:p}),"."]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(Oe,{projectId:n})})]})]})}function Xe(){he();const{projects:n,isLoading:p,createProject:g,updateProject:b,deleteProject:w}=pe(),{companies:E,isLoading:F}=be(),{users:$,isLoading:H}=ge(),y=p||F||H,[C,j]=l.useState(""),[d,x]=l.useState(!1),[o,k]=l.useState(null),[L,t]=l.useState(!1),[a,r]=l.useState({name:"",companyId:"",address:"",status:"active",plannedHours:0,estimatedCost:0,startDate:"",endDate:""}),[D,_]=l.useState({open:!1,title:"",description:"",onConfirm:()=>{},variant:"default"}),{toast:re}=K();if(y)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(O,{className:"w-8 h-8 animate-spin text-primary"})});const ie=async s=>{if(s.preventDefault(),!a.name.trim()||!a.companyId){re({title:"Aviso",description:"Nome e Empresa são obrigatórios",variant:"destructive"});return}t(!0);try{const i={...a,plannedHours:Number(a.plannedHours),estimatedCost:Number(a.estimatedCost),startDate:a.startDate?new Date(a.startDate):null,endDate:a.endDate?new Date(a.endDate):null};o?await b(o.id,i)&&z():await g(i)&&z()}finally{t(!1)}},le=s=>{k(s),r({name:s.name,companyId:s.companyId,address:s.address||"",status:s.status,plannedHours:s.plannedHours||0,estimatedCost:s.estimatedCost||0,startDate:s.startDate?new Date(s.startDate).toISOString().split("T")[0]:"",endDate:s.endDate?new Date(s.endDate).toISOString().split("T")[0]:""}),x(!0)},ne=async s=>{_({open:!0,title:"Excluir Obra",description:`Deseja realmente excluir a obra "${s.name}"? Esta ação não pode ser desfeita e removerá todos os vínculos com canteiros e funcionários.`,variant:"destructive",onConfirm:async()=>{await w(s.id)}})},z=()=>{r({name:"",companyId:"",address:"",status:"active",plannedHours:0,estimatedCost:0,startDate:"",endDate:""}),k(null),x(!1)},de=n.filter(s=>s.name.toLowerCase().includes(C.toLowerCase())),oe=s=>{var i;return((i=E.find(N=>N.id===s))==null?void 0:i.name)||"Empresa desconhecida"},ce=s=>$.filter(i=>i.role==="GESTOR_PROJECT"&&i.projectId===s);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold gradient-text",children:"Gestão de Obras"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie as obras e vincule-as às empresas"})]}),e.jsxs(Q,{open:d,onOpenChange:s=>{x(s)},children:[(f.value||u("projects.create")||P("showAdminMenu"))&&e.jsx(W,{asChild:!0,children:e.jsxs(c,{className:"gradient-primary text-white shadow-glow",children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Nova Obra"]})}),e.jsxs(X,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Y,{children:[e.jsxs(ee,{className:"flex items-center gap-2 text-2xl font-bold",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-accent flex items-center justify-center shadow-glow",children:e.jsx(q,{className:"text-white w-6 h-6"})}),o?"Editar Obra":"Nova Obra"]}),e.jsx(se,{className:"text-muted-foreground pt-1",children:"Gerencie os detalhes da obra, planejamento e empresa responsável."})]}),e.jsxs("form",{onSubmit:ie,className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-accent font-semibold text-sm uppercase tracking-wider",children:[e.jsx(Z,{className:"w-4 h-4"}),"Identificação"]}),e.jsx(J,{className:"bg-white/10"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-xs uppercase text-muted-foreground font-bold",children:"Empresa Responsável *"}),e.jsxs(T,{value:a.companyId,onValueChange:s=>r({...a,companyId:s}),children:[e.jsx(M,{className:"industrial-input h-10",children:e.jsx(A,{placeholder:"Selecione a empresa"})}),e.jsx(R,{className:"glass-card border-white/10",children:E.map(s=>e.jsx(v,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-xs uppercase text-muted-foreground font-bold",children:"Nome da Obra *"}),e.jsx(h,{value:a.name,onChange:s=>r({...a,name:s.target.value}),className:"industrial-input h-10 pr-10",placeholder:"Ex: Edifício Horizonte",required:!0,disabled:o&&!(f.value||u("projects.rename")||P("showMaintenance"))}),o&&!(f.value||u("projects.rename")||P("showMaintenance"))&&e.jsx(Pe,{className:"absolute right-3 top-2.5 w-4 h-4 text-orange-500/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-xs uppercase text-muted-foreground font-bold",children:"Endereço"}),e.jsx(h,{value:a.address,onChange:s=>r({...a,address:s.target.value}),className:"industrial-input h-10",placeholder:"Localização da obra"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-semibold text-sm uppercase tracking-wider",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Planejamento (Metas)"]}),e.jsx(J,{className:"bg-white/10"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-[10px] uppercase text-muted-foreground font-bold italic",children:"HHH Planejado"}),e.jsx(h,{type:"number",value:a.plannedHours,onChange:s=>r({...a,plannedHours:Number(s.target.value)}),className:"industrial-input h-10",placeholder:"Total de Horas"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-[10px] uppercase text-muted-foreground font-bold italic",children:"Orçamento (R$)"}),e.jsx(h,{type:"number",value:a.estimatedCost,onChange:s=>r({...a,estimatedCost:Number(s.target.value)}),className:"industrial-input h-10",placeholder:"Valor estimado"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-[10px] uppercase text-muted-foreground font-bold italic",children:"Data Início"}),e.jsx(h,{type:"date",value:a.startDate,onChange:s=>r({...a,startDate:s.target.value}),className:"industrial-input h-10"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-[10px] uppercase text-muted-foreground font-bold italic",children:"Data Fim"}),e.jsx(h,{type:"date",value:a.endDate,onChange:s=>r({...a,endDate:s.target.value}),className:"industrial-input h-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-xs uppercase text-muted-foreground font-black",children:"Status"}),e.jsxs(T,{value:a.status,onValueChange:s=>r({...a,status:s}),children:[e.jsx(M,{className:"industrial-input h-10",children:e.jsx(A,{placeholder:"Status da obra"})}),e.jsxs(R,{className:"glass-card border-white/10",children:[e.jsx(v,{value:"active",children:"Em Andamento"}),e.jsx(v,{value:"completed",children:"Concluída"}),e.jsx(v,{value:"paused",children:"Pausada"})]})]})]})]})]}),e.jsxs("div",{className:"pt-4 flex gap-3",children:[e.jsx(c,{type:"button",variant:"outline",onClick:z,className:"flex-1 h-11 border-white/10",children:"Cancelar"}),e.jsxs(c,{type:"submit",className:"flex-1 h-11 bg-accent hover:bg-accent/80 text-white shadow-glow",disabled:L,children:[L?e.jsx(O,{className:"w-4 h-4 mr-2 animate-spin"}):null,o?"Salvar Alterações":"Cadastrar Obra"]})]})]})]})]})]}),e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(h,{placeholder:"Buscar obras...",value:C,onChange:s=>j(s.target.value),className:"pl-10 industrial-input"})]}),e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-6",children:y?Array(6).fill(0).map((s,i)=>e.jsxs(B,{className:"glass-card animate-pulse overflow-hidden border-l-4 border-l-white/5 relative h-[280px]",children:[e.jsx(G,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-2xl bg-white/5 w-12 h-12"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 w-32 bg-white/10 rounded"}),e.jsx("div",{className:"h-3 w-24 bg-white/5 rounded"})]})]})}),e.jsxs(U,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 pb-4 border-b border-white/5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-2 w-12 bg-white/5 rounded"}),e.jsx("div",{className:"h-3 w-16 bg-white/10 rounded"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-2 w-12 bg-white/5 rounded"}),e.jsx("div",{className:"h-3 w-16 bg-white/10 rounded"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-3 w-full bg-white/5 rounded"}),e.jsx("div",{className:"h-3 w-2/3 bg-white/5 rounded"})]})]})]},`skeleton-${i}`)):de.map(s=>{var N,V;const i=ce(s.id);return e.jsxs(B,{className:"glass-card group hover:shadow-strong transition-all overflow-hidden border-l-4 border-l-accent relative",children:[e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[(f.value||u("ui.admin_access"))&&e.jsx(Te,{projectId:s.id,projectName:s.name,trigger:e.jsx(c,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-primary",title:"Delegação de Poderes",children:e.jsx(I,{className:"w-4 h-4"})})}),(f.value||u("projects.rename")||u("projects.update")||P("showAdminMenu"))&&e.jsx(c,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-accent",onClick:()=>le(s),children:e.jsx(He,{className:"w-4 h-4"})}),(f.value||u("projects.delete")||P("showMaintenance"))&&e.jsx(c,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>ne(s),children:e.jsx(te,{className:"w-4 h-4"})})]}),e.jsx(G,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-2xl bg-accent/10 group-hover:bg-accent/20 transition-colors",children:e.jsx(q,{className:"w-6 h-6 text-accent"})}),e.jsxs("div",{children:[e.jsx(ae,{className:"text-lg",children:s.name}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(je,{className:"w-3 h-3"}),oe(s.companyId)]})]})]})}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 pb-4 border-b border-white/5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-muted-foreground",children:"Target HHH"}),e.jsxs("p",{className:"text-sm font-black flex items-center gap-1",children:[e.jsx(Ne,{className:"w-3.5 h-3.5 text-primary"}),((N=s.plannedHours)==null?void 0:N.toLocaleString())||"0","h"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[10px] uppercase font-bold text-muted-foreground",children:"Orçamento"}),e.jsxs("p",{className:"text-sm font-black flex items-center gap-1",children:[e.jsx(fe,{className:"w-3 h-3 text-emerald-500"}),"R$ ",((V=s.estimatedCost)==null?void 0:V.toLocaleString())||"0,00"]})]})]}),e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate",children:s.address||"Local não informado"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:`w-4 h-4 ${s.status==="active"?"text-emerald-500":"text-amber-500"}`}),e.jsx("span",{className:"capitalize",children:s.status==="active"?"Em Andamento":s.status==="completed"?"Concluída":"Pausada"})]}),e.jsxs("div",{className:"pt-2 border-t border-white/5 flex flex-col gap-1",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold tracking-tight text-white/40",children:"Gestor Responsável"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"text-xs font-medium text-foreground",children:i.length>0?i.map(me=>me.fullName).join(", "):"Não atribuído"})]})]})]})]})]},s.id)})}),e.jsx(ye,{open:D.open,onOpenChange:s=>_(i=>({...i,open:s})),title:D.title,description:D.description,onConfirm:D.onConfirm,variant:D.variant})]})}export{Xe as default};
