var Se=Object.defineProperty;var Ue=(o,i,t)=>i in o?Se(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t;var x=(o,i,t)=>Ue(o,typeof i!="symbol"?i+"":i,t);import{f as vt,r as u,j as r,g as Pe,B as W,a4 as Le,a as Ne,b2 as De,aA as ct,bw as Ie,s as yt}from"./index-D951x4H-.js";import{u as Y,W as ke,H as Re,L as qt,D as je,F as Me,a as wt,_ as Q,V as ze,b as V,c as Fe,S as He,d as Ye,R as Ze,Q as Zt,M as pe,e as Ve,B as Be,f as Ke,g as Xe,h as qe,O as Qe,C as ue,i as _e,j as Ge,k as $e}from"./Gltf-DXY_s8Ul.js";import{S as Nt}from"./slider-fkHl-ud9.js";import{S as We}from"./settings-2-CrLI_2YT.js";import{M as Je}from"./move-CukShz45.js";import{T as ts}from"./trash-2-DD2QlM38.js";import{S as Qt}from"./save-BcLL5Pf6.js";import{C as es}from"./copy-CXglQ41p.js";import{F as ss}from"./file-up-BAmu6W7r.js";import{D as Gt}from"./download-L1tB_Hhn.js";import{U as is}from"./upload-D2Q7C-3S.js";import{A as os}from"./arrow-left-CQFd9_U_.js";import{L as ns}from"./layout-grid-4na9_LkO.js";import{A as rs,a as as}from"./arrow-up-BfG5I1o5.js";import{T as cs}from"./target-J4oQCKEn.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=[["path",{d:"M4.037 4.688a.495.495 0 0 1 .651-.651l16 6.5a.5.5 0 0 1-.063.947l-6.124 1.58a2 2 0 0 0-1.438 1.435l-1.579 6.126a.5.5 0 0 1-.947.063z",key:"edeuup"}]],fe=vt("MousePointer2",ls);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=[["path",{d:"M6 8L2 12L6 16",key:"kyvwex"}],["path",{d:"M2 12H22",key:"1m8cig"}]],ds=vt("MoveLeft",hs);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=[["path",{d:"M18 8L22 12L18 16",key:"1r0oui"}],["path",{d:"M2 12H22",key:"1m8cig"}]],ps=vt("MoveRight",ms);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],_s=vt("RotateCw",us);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=[["path",{d:"M5 3a2 2 0 0 0-2 2",key:"y57alp"}],["path",{d:"M19 3a2 2 0 0 1 2 2",key:"18rm91"}],["path",{d:"M21 19a2 2 0 0 1-2 2",key:"1j7049"}],["path",{d:"M5 21a2 2 0 0 1-2-2",key:"sbafld"}],["path",{d:"M9 3h1",key:"1yesri"}],["path",{d:"M9 21h1",key:"15o7lz"}],["path",{d:"M14 3h1",key:"1ec4yj"}],["path",{d:"M14 21h1",key:"v9vybs"}],["path",{d:"M3 9v1",key:"1r0deq"}],["path",{d:"M21 9v1",key:"mxsmne"}],["path",{d:"M3 14v1",key:"vnatye"}],["path",{d:"M21 14v1",key:"169vum"}]],gs=vt("SquareDashed",fs);function ys(o,i,t){const e=Y(_=>_.size),s=Y(_=>_.viewport),n=typeof o=="number"?o:e.width*s.dpr,c=e.height*s.dpr,l=(typeof o=="number"?t:o)||{},{samples:h=0,depth:m,...g}=l,E=m??l.depthBuffer,p=u.useMemo(()=>{const _=new ke(n,c,{minFilter:qt,magFilter:qt,type:Re,...g});return E&&(_.depthTexture=new je(n,c,Me)),_.samples=h,_},[]);return u.useLayoutEffect(()=>{p.setSize(n,c),h&&(p.samples=h)},[h,p,n,c]),u.useEffect(()=>()=>p.dispose(),[]),p}const xs=o=>typeof o=="function",Es=u.forwardRef(({envMap:o,resolution:i=256,frames:t=1/0,children:e,makeDefault:s,...n},c)=>{const l=Y(({set:O})=>O),h=Y(({camera:O})=>O),m=Y(({size:O})=>O),g=u.useRef(null);u.useImperativeHandle(c,()=>g.current,[]);const E=u.useRef(null),p=ys(i);u.useLayoutEffect(()=>{n.manual||g.current.updateProjectionMatrix()},[m,n]),u.useLayoutEffect(()=>{g.current.updateProjectionMatrix()}),u.useLayoutEffect(()=>{if(s){const O=h;return l(()=>({camera:g.current})),()=>l(()=>({camera:O}))}},[g,s,l]);let _=0,C=null;const T=xs(e);return wt(O=>{T&&(t===1/0||_<t)&&(E.current.visible=!1,O.gl.setRenderTarget(p),C=O.scene.background,o&&(O.scene.background=o),O.gl.render(O.scene,g.current),O.scene.background=C,O.gl.setRenderTarget(null),E.current.visible=!0,_++)}),u.createElement(u.Fragment,null,u.createElement("orthographicCamera",Q({left:m.width/-2,right:m.width/2,top:m.height/2,bottom:m.height/-2,ref:g},n),!T&&e),u.createElement("group",{ref:E},T&&e(p.texture)))});/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const j={LEFT:1,RIGHT:2,MIDDLE:4},a=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),mt={NONE:0,IN:1,OUT:-1};function lt(o){return o.isPerspectiveCamera}function ot(o){return o.isOrthographicCamera}const it=Math.PI*2,$t=Math.PI/2,ge=1e-5,xt=Math.PI/180;function $(o,i,t){return Math.max(i,Math.min(t,o))}function R(o,i=ge){return Math.abs(o)<i}function k(o,i,t=ge){return R(o-i,t)}function Wt(o,i){return Math.round(o/i)*i}function Et(o){return isFinite(o)?o:o<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Ot(o){return Math.abs(o)<Number.MAX_VALUE?o:o*(1/0)}function bt(o,i,t,e,s=1/0,n){e=Math.max(1e-4,e);const c=2/e,l=c*n,h=1/(1+l+.48*l*l+.235*l*l*l);let m=o-i;const g=i,E=s*e;m=$(m,-E,E),i=o-m;const p=(t.value+c*m)*n;t.value=(t.value-c*p)*h;let _=i+(m+p)*h;return g-o>0==_>g&&(_=g,t.value=(_-g)/n),_}function Jt(o,i,t,e,s=1/0,n,c){e=Math.max(1e-4,e);const l=2/e,h=l*n,m=1/(1+h+.48*h*h+.235*h*h*h);let g=i.x,E=i.y,p=i.z,_=o.x-g,C=o.y-E,T=o.z-p;const O=g,L=E,f=p,w=s*e,S=w*w,y=_*_+C*C+T*T;if(y>S){const A=Math.sqrt(y);_=_/A*w,C=C/A*w,T=T/A*w}g=o.x-_,E=o.y-C,p=o.z-T;const v=(t.x+l*_)*n,P=(t.y+l*C)*n,d=(t.z+l*T)*n;t.x=(t.x-l*v)*m,t.y=(t.y-l*P)*m,t.z=(t.z-l*d)*m,c.x=g+(_+v)*m,c.y=E+(C+P)*m,c.z=p+(T+d)*m;const N=O-o.x,M=L-o.y,B=f-o.z,K=c.x-O,J=c.y-L,I=c.z-f;return N*K+M*J+B*I>0&&(c.x=O,c.y=L,c.z=f,t.x=(c.x-O)/n,t.y=(c.y-L)/n,t.z=(c.z-f)/n),c}function Dt(o,i){i.set(0,0),o.forEach(t=>{i.x+=t.clientX,i.y+=t.clientY}),i.x/=o.length,i.y/=o.length}function It(o,i){return ot(o)?(console.warn(`${i} is not supported in OrthographicCamera`),!0):!1}class Os{constructor(){x(this,"_listeners",{})}addEventListener(i,t){const e=this._listeners;e[i]===void 0&&(e[i]=[]),e[i].indexOf(t)===-1&&e[i].push(t)}hasEventListener(i,t){const e=this._listeners;return e[i]!==void 0&&e[i].indexOf(t)!==-1}removeEventListener(i,t){const s=this._listeners[i];if(s!==void 0){const n=s.indexOf(t);n!==-1&&s.splice(n,1)}}removeAllEventListeners(i){if(!i){this._listeners={};return}Array.isArray(this._listeners[i])&&(this._listeners[i].length=0)}dispatchEvent(i){const e=this._listeners[i.type];if(e!==void 0){i.target=this;const s=e.slice(0);for(let n=0,c=s.length;n<c;n++)s[n].call(this,i)}}}const Ts="3.1.2",At=1/8;var me;const Cs=/Mac/.test((me=globalThis==null?void 0:globalThis.navigator)==null?void 0:me.platform);let b,te,St,kt,X,U,D,pt,Tt,tt,et,ht,ee,se,q,ut,_t,ie,Rt,oe,jt,Mt,Ut,vs=class Vt extends Os{constructor(t,e){super();x(this,"minPolarAngle",0);x(this,"maxPolarAngle",Math.PI);x(this,"minAzimuthAngle",-1/0);x(this,"maxAzimuthAngle",1/0);x(this,"minDistance",Number.EPSILON);x(this,"maxDistance",1/0);x(this,"infinityDolly",!1);x(this,"minZoom",.01);x(this,"maxZoom",1/0);x(this,"smoothTime",.25);x(this,"draggingSmoothTime",.125);x(this,"maxSpeed",1/0);x(this,"azimuthRotateSpeed",1);x(this,"polarRotateSpeed",1);x(this,"dollySpeed",1);x(this,"dollyDragInverted",!1);x(this,"truckSpeed",2);x(this,"dollyToCursor",!1);x(this,"dragToOffset",!1);x(this,"boundaryFriction",0);x(this,"restThreshold",.01);x(this,"colliderMeshes",[]);x(this,"mouseButtons");x(this,"touches");x(this,"cancel",()=>{});x(this,"lockPointer");x(this,"unlockPointer");x(this,"_enabled",!0);x(this,"_camera");x(this,"_yAxisUpSpace");x(this,"_yAxisUpSpaceInverse");x(this,"_state",a.NONE);x(this,"_domElement");x(this,"_viewport",null);x(this,"_target");x(this,"_targetEnd");x(this,"_focalOffset");x(this,"_focalOffsetEnd");x(this,"_spherical");x(this,"_sphericalEnd");x(this,"_lastDistance");x(this,"_zoom");x(this,"_zoomEnd");x(this,"_lastZoom");x(this,"_cameraUp0");x(this,"_target0");x(this,"_position0");x(this,"_zoom0");x(this,"_focalOffset0");x(this,"_dollyControlCoord");x(this,"_changedDolly",0);x(this,"_changedZoom",0);x(this,"_nearPlaneCorners");x(this,"_hasRested",!0);x(this,"_boundary");x(this,"_boundaryEnclosesCamera",!1);x(this,"_needsUpdate",!0);x(this,"_updatedLastTime",!1);x(this,"_elementRect",new DOMRect);x(this,"_isDragging",!1);x(this,"_dragNeedsUpdate",!0);x(this,"_activePointers",[]);x(this,"_lockedPointer",null);x(this,"_interactiveArea",new DOMRect(0,0,1,1));x(this,"_isUserControllingRotate",!1);x(this,"_isUserControllingDolly",!1);x(this,"_isUserControllingTruck",!1);x(this,"_isUserControllingOffset",!1);x(this,"_isUserControllingZoom",!1);x(this,"_lastDollyDirection",mt.NONE);x(this,"_thetaVelocity",{value:0});x(this,"_phiVelocity",{value:0});x(this,"_radiusVelocity",{value:0});x(this,"_targetVelocity",new b.Vector3);x(this,"_focalOffsetVelocity",new b.Vector3);x(this,"_zoomVelocity",{value:0});x(this,"_truckInternal",(t,e,s,n)=>{let c,l;if(lt(this._camera)){const h=U.copy(this._camera.position).sub(this._target),m=this._camera.getEffectiveFOV()*xt,g=h.length()*Math.tan(m*.5);c=this.truckSpeed*t*g/this._elementRect.height,l=this.truckSpeed*e*g/this._elementRect.height}else if(ot(this._camera)){const h=this._camera;c=this.truckSpeed*t*(h.right-h.left)/h.zoom/this._elementRect.width,l=this.truckSpeed*e*(h.top-h.bottom)/h.zoom/this._elementRect.height}else return;n?(s?this.setFocalOffset(this._focalOffsetEnd.x+c,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(c,0,!0),this.forward(-l,!0)):s?this.setFocalOffset(this._focalOffsetEnd.x+c,this._focalOffsetEnd.y+l,this._focalOffsetEnd.z,!0):this.truck(c,l,!0)});x(this,"_rotateInternal",(t,e)=>{const s=it*this.azimuthRotateSpeed*t/this._elementRect.height,n=it*this.polarRotateSpeed*e/this._elementRect.height;this.rotate(s,n,!0)});x(this,"_dollyInternal",(t,e,s)=>{const n=Math.pow(.95,-t*this.dollySpeed),c=this._sphericalEnd.radius,l=this._sphericalEnd.radius*n,h=$(l,this.minDistance,this.maxDistance),m=h-l;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(l,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(m,!0),this._dollyToNoClamp(h,!0)):this._dollyToNoClamp(h,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?l:h)-c,this._dollyControlCoord.set(e,s)),this._lastDollyDirection=Math.sign(-t)});x(this,"_zoomInternal",(t,e,s)=>{const n=Math.pow(.95,t*this.dollySpeed),c=this._zoom,l=this._zoom*n;this.zoomTo(l,!0),this.dollyToCursor&&(this._changedZoom+=l-c,this._dollyControlCoord.set(e,s))});typeof b>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=t,this._yAxisUpSpace=new b.Quaternion().setFromUnitVectors(this._camera.up,St),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=a.NONE,this._target=new b.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new b.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new b.Spherical().setFromVector3(U.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new b.Vector3,new b.Vector3,new b.Vector3,new b.Vector3],this._updateNearPlaneCorners(),this._boundary=new b.Box3(new b.Vector3(-1/0,-1/0,-1/0),new b.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new b.Vector2,this.mouseButtons={left:a.ROTATE,middle:a.DOLLY,right:a.TRUCK,wheel:lt(this._camera)?a.DOLLY:ot(this._camera)?a.ZOOM:a.NONE},this.touches={one:a.TOUCH_ROTATE,two:lt(this._camera)?a.TOUCH_DOLLY_TRUCK:ot(this._camera)?a.TOUCH_ZOOM_TRUCK:a.NONE,three:a.TOUCH_TRUCK};const s=new b.Vector2,n=new b.Vector2,c=new b.Vector2,l=f=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const y=this._domElement.getBoundingClientRect(),v=f.clientX/y.width,P=f.clientY/y.height;if(v<this._interactiveArea.left||v>this._interactiveArea.right||P<this._interactiveArea.top||P>this._interactiveArea.bottom)return}const w=f.pointerType!=="mouse"?null:(f.buttons&j.LEFT)===j.LEFT?j.LEFT:(f.buttons&j.MIDDLE)===j.MIDDLE?j.MIDDLE:(f.buttons&j.RIGHT)===j.RIGHT?j.RIGHT:null;if(w!==null){const y=this._findPointerByMouseButton(w);y&&this._disposePointer(y)}if((f.buttons&j.LEFT)===j.LEFT&&this._lockedPointer)return;const S={pointerId:f.pointerId,clientX:f.clientX,clientY:f.clientY,deltaX:0,deltaY:0,mouseButton:w};this._activePointers.push(S),this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",m),this._domElement.ownerDocument.addEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",m),this._isDragging=!0,_(f)},h=f=>{f.cancelable&&f.preventDefault();const w=f.pointerId,S=this._lockedPointer||this._findPointerById(w);if(S){if(S.clientX=f.clientX,S.clientY=f.clientY,S.deltaX=f.movementX,S.deltaY=f.movementY,this._state=0,f.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(f.buttons&j.LEFT)===j.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(f.buttons&j.MIDDLE)===j.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(f.buttons&j.RIGHT)===j.RIGHT&&(this._state=this._state|this.mouseButtons.right);C()}},m=f=>{const w=this._findPointerById(f.pointerId);if(!(w&&w===this._lockedPointer)){if(w&&this._disposePointer(w),f.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=a.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=a.NONE;T()}};let g=-1;const E=f=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===a.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const d=this._domElement.getBoundingClientRect(),N=f.clientX/d.width,M=f.clientY/d.height;if(N<this._interactiveArea.left||N>this._interactiveArea.right||M<this._interactiveArea.top||M>this._interactiveArea.bottom)return}if(f.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===a.ROTATE||this.mouseButtons.wheel===a.TRUCK){const d=performance.now();g-d<1e3&&this._getClientRect(this._elementRect),g=d}const w=Cs?-1:-3,S=f.deltaMode===1&&!f.ctrlKey?f.deltaY/w:f.deltaY/(w*10),y=this.dollyToCursor?(f.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,v=this.dollyToCursor?(f.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(f.ctrlKey?a.ZOOM:this.mouseButtons.wheel){case a.ROTATE:{this._rotateInternal(f.deltaX,f.deltaY),this._isUserControllingRotate=!0;break}case a.TRUCK:{this._truckInternal(f.deltaX,f.deltaY,!1,!1),this._isUserControllingTruck=!0;break}case a.SCREEN_PAN:{this._truckInternal(f.deltaX,f.deltaY,!1,!0),this._isUserControllingTruck=!0;break}case a.OFFSET:{this._truckInternal(f.deltaX,f.deltaY,!0,!1),this._isUserControllingOffset=!0;break}case a.DOLLY:{this._dollyInternal(-S,y,v),this._isUserControllingDolly=!0;break}case a.ZOOM:{this._zoomInternal(-S,y,v),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},p=f=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===Vt.ACTION.NONE){const w=f instanceof PointerEvent?f.pointerId:0,S=this._findPointerById(w);S&&this._disposePointer(S),this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",m);return}f.preventDefault()}},_=f=>{if(!this._enabled)return;if(Dt(this._activePointers,X),this._getClientRect(this._elementRect),s.copy(X),n.copy(X),this._activePointers.length>=2){const S=X.x-this._activePointers[1].clientX,y=X.y-this._activePointers[1].clientY,v=Math.sqrt(S*S+y*y);c.set(0,v);const P=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,d=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;n.set(P,d)}if(this._state=0,!f)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in f&&f.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(f.buttons&j.LEFT)===j.LEFT&&(this._state=this._state|this.mouseButtons.left),(f.buttons&j.MIDDLE)===j.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(f.buttons&j.RIGHT)===j.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&a.ROTATE)===a.ROTATE||(this._state&a.TOUCH_ROTATE)===a.TOUCH_ROTATE||(this._state&a.TOUCH_DOLLY_ROTATE)===a.TOUCH_DOLLY_ROTATE||(this._state&a.TOUCH_ZOOM_ROTATE)===a.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&a.TRUCK)===a.TRUCK||(this._state&a.SCREEN_PAN)===a.SCREEN_PAN||(this._state&a.TOUCH_TRUCK)===a.TOUCH_TRUCK||(this._state&a.TOUCH_SCREEN_PAN)===a.TOUCH_SCREEN_PAN||(this._state&a.TOUCH_DOLLY_TRUCK)===a.TOUCH_DOLLY_TRUCK||(this._state&a.TOUCH_DOLLY_SCREEN_PAN)===a.TOUCH_DOLLY_SCREEN_PAN||(this._state&a.TOUCH_ZOOM_TRUCK)===a.TOUCH_ZOOM_TRUCK||(this._state&a.TOUCH_ZOOM_SCREEN_PAN)===a.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&a.DOLLY)===a.DOLLY||(this._state&a.TOUCH_DOLLY)===a.TOUCH_DOLLY||(this._state&a.TOUCH_DOLLY_TRUCK)===a.TOUCH_DOLLY_TRUCK||(this._state&a.TOUCH_DOLLY_SCREEN_PAN)===a.TOUCH_DOLLY_SCREEN_PAN||(this._state&a.TOUCH_DOLLY_OFFSET)===a.TOUCH_DOLLY_OFFSET||(this._state&a.TOUCH_DOLLY_ROTATE)===a.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&a.ZOOM)===a.ZOOM||(this._state&a.TOUCH_ZOOM)===a.TOUCH_ZOOM||(this._state&a.TOUCH_ZOOM_TRUCK)===a.TOUCH_ZOOM_TRUCK||(this._state&a.TOUCH_ZOOM_SCREEN_PAN)===a.TOUCH_ZOOM_SCREEN_PAN||(this._state&a.TOUCH_ZOOM_OFFSET)===a.TOUCH_ZOOM_OFFSET||(this._state&a.TOUCH_ZOOM_ROTATE)===a.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&a.OFFSET)===a.OFFSET||(this._state&a.TOUCH_OFFSET)===a.TOUCH_OFFSET||(this._state&a.TOUCH_DOLLY_OFFSET)===a.TOUCH_DOLLY_OFFSET||(this._state&a.TOUCH_ZOOM_OFFSET)===a.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},C=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Dt(this._activePointers,X);const w=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,S=w?-w.deltaX:n.x-X.x,y=w?-w.deltaY:n.y-X.y;if(n.copy(X),((this._state&a.ROTATE)===a.ROTATE||(this._state&a.TOUCH_ROTATE)===a.TOUCH_ROTATE||(this._state&a.TOUCH_DOLLY_ROTATE)===a.TOUCH_DOLLY_ROTATE||(this._state&a.TOUCH_ZOOM_ROTATE)===a.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(S,y),this._isUserControllingRotate=!0),(this._state&a.DOLLY)===a.DOLLY||(this._state&a.ZOOM)===a.ZOOM){const v=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,P=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,d=this.dollyDragInverted?-1:1;(this._state&a.DOLLY)===a.DOLLY?(this._dollyInternal(d*y*At,v,P),this._isUserControllingDolly=!0):(this._zoomInternal(d*y*At,v,P),this._isUserControllingZoom=!0)}if((this._state&a.TOUCH_DOLLY)===a.TOUCH_DOLLY||(this._state&a.TOUCH_ZOOM)===a.TOUCH_ZOOM||(this._state&a.TOUCH_DOLLY_TRUCK)===a.TOUCH_DOLLY_TRUCK||(this._state&a.TOUCH_ZOOM_TRUCK)===a.TOUCH_ZOOM_TRUCK||(this._state&a.TOUCH_DOLLY_SCREEN_PAN)===a.TOUCH_DOLLY_SCREEN_PAN||(this._state&a.TOUCH_ZOOM_SCREEN_PAN)===a.TOUCH_ZOOM_SCREEN_PAN||(this._state&a.TOUCH_DOLLY_OFFSET)===a.TOUCH_DOLLY_OFFSET||(this._state&a.TOUCH_ZOOM_OFFSET)===a.TOUCH_ZOOM_OFFSET||(this._state&a.TOUCH_DOLLY_ROTATE)===a.TOUCH_DOLLY_ROTATE||(this._state&a.TOUCH_ZOOM_ROTATE)===a.TOUCH_ZOOM_ROTATE){const v=X.x-this._activePointers[1].clientX,P=X.y-this._activePointers[1].clientY,d=Math.sqrt(v*v+P*P),N=c.y-d;c.set(0,d);const M=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,B=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&a.TOUCH_DOLLY)===a.TOUCH_DOLLY||(this._state&a.TOUCH_DOLLY_ROTATE)===a.TOUCH_DOLLY_ROTATE||(this._state&a.TOUCH_DOLLY_TRUCK)===a.TOUCH_DOLLY_TRUCK||(this._state&a.TOUCH_DOLLY_SCREEN_PAN)===a.TOUCH_DOLLY_SCREEN_PAN||(this._state&a.TOUCH_DOLLY_OFFSET)===a.TOUCH_DOLLY_OFFSET?(this._dollyInternal(N*At,M,B),this._isUserControllingDolly=!0):(this._zoomInternal(N*At,M,B),this._isUserControllingZoom=!0)}((this._state&a.TRUCK)===a.TRUCK||(this._state&a.TOUCH_TRUCK)===a.TOUCH_TRUCK||(this._state&a.TOUCH_DOLLY_TRUCK)===a.TOUCH_DOLLY_TRUCK||(this._state&a.TOUCH_ZOOM_TRUCK)===a.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(S,y,!1,!1),this._isUserControllingTruck=!0),((this._state&a.SCREEN_PAN)===a.SCREEN_PAN||(this._state&a.TOUCH_SCREEN_PAN)===a.TOUCH_SCREEN_PAN||(this._state&a.TOUCH_DOLLY_SCREEN_PAN)===a.TOUCH_DOLLY_SCREEN_PAN||(this._state&a.TOUCH_ZOOM_SCREEN_PAN)===a.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(S,y,!1,!0),this._isUserControllingTruck=!0),((this._state&a.OFFSET)===a.OFFSET||(this._state&a.TOUCH_OFFSET)===a.TOUCH_OFFSET||(this._state&a.TOUCH_DOLLY_OFFSET)===a.TOUCH_DOLLY_OFFSET||(this._state&a.TOUCH_ZOOM_OFFSET)===a.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(S,y,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},T=()=>{Dt(this._activePointers,X),n.copy(X),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",m),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",m),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",O),this._domElement.ownerDocument.addEventListener("pointerlockerror",L),this._domElement.ownerDocument.addEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",m),_())},this.unlockPointer=()=>{var f,w,S;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(f=this._domElement)==null||f.ownerDocument.exitPointerLock(),(w=this._domElement)==null||w.ownerDocument.removeEventListener("pointerlockchange",O),(S=this._domElement)==null||S.ownerDocument.removeEventListener("pointerlockerror",L),this.cancel()};const O=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},L=()=>{this.unlockPointer()};this._addAllEventListeners=f=>{this._domElement=f,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",l),this._domElement.addEventListener("pointercancel",m),this._domElement.addEventListener("wheel",E,{passive:!1}),this._domElement.addEventListener("contextmenu",p)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",l),this._domElement.removeEventListener("pointercancel",m),this._domElement.removeEventListener("wheel",E,{passive:!1}),this._domElement.removeEventListener("contextmenu",p),this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",m),this._domElement.ownerDocument.removeEventListener("pointerlockchange",O),this._domElement.ownerDocument.removeEventListener("pointerlockerror",L))},this.cancel=()=>{this._state!==a.NONE&&(this._state=a.NONE,this._activePointers.length=0,T())},e&&this.connect(e),this.update(0)}static install(t){b=t.THREE,te=Object.freeze(new b.Vector3(0,0,0)),St=Object.freeze(new b.Vector3(0,1,0)),kt=Object.freeze(new b.Vector3(0,0,1)),X=new b.Vector2,U=new b.Vector3,D=new b.Vector3,pt=new b.Vector3,Tt=new b.Vector3,tt=new b.Vector3,et=new b.Vector3,ht=new b.Vector3,ee=new b.Vector3,se=new b.Vector3,q=new b.Spherical,ut=new b.Spherical,_t=new b.Box3,ie=new b.Box3,Rt=new b.Sphere,oe=new b.Quaternion,jt=new b.Quaternion,Mt=new b.Matrix4,Ut=new b.Raycaster}static get ACTION(){return a}set verticalDragToForward(t){console.warn("camera-controls: `verticalDragToForward` was removed. Use `mouseButtons.left = CameraControls.ACTION.SCREEN_PAN` instead.")}get camera(){return this._camera}set camera(t){this._camera=t,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._domElement&&(t?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(t){this._spherical.radius===t&&this._sphericalEnd.radius===t||(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(t){this._spherical.theta===t&&this._sphericalEnd.theta===t||(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(t){this._spherical.phi===t&&this._sphericalEnd.phi===t||(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0}set interactiveArea(t){this._interactiveArea.width=$(t.width,0,1),this._interactiveArea.height=$(t.height,0,1),this._interactiveArea.x=$(t.x,0,1-this._interactiveArea.width),this._interactiveArea.y=$(t.y,0,1-this._interactiveArea.height)}addEventListener(t,e){super.addEventListener(t,e)}removeEventListener(t,e){super.removeEventListener(t,e)}rotate(t,e,s=!1){return this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,s)}rotateAzimuthTo(t,e=!1){return this.rotateTo(t,this._sphericalEnd.phi,e)}rotatePolarTo(t,e=!1){return this.rotateTo(this._sphericalEnd.theta,t,e)}rotateTo(t,e,s=!1){this._isUserControllingRotate=!1;const n=$(t,this.minAzimuthAngle,this.maxAzimuthAngle),c=$(e,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=n,this._sphericalEnd.phi=c,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,s||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const l=!s||k(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&k(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(l)}dolly(t,e=!1){return this.dollyTo(this._sphericalEnd.radius-t,e)}dollyTo(t,e=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=mt.NONE,this._changedDolly=0,this._dollyToNoClamp($(t,this.minDistance,this.maxDistance),e)}_dollyToNoClamp(t,e=!1){const s=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const l=this._collisionTest(),h=k(l,this._spherical.radius);if(!(s>t)&&h)return Promise.resolve();this._sphericalEnd.radius=Math.min(t,l)}else this._sphericalEnd.radius=t;this._needsUpdate=!0,e||(this._spherical.radius=this._sphericalEnd.radius);const c=!e||k(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(c)}dollyInFixed(t,e=!1){this._targetEnd.add(this._getCameraDirection(Tt).multiplyScalar(t)),e||this._target.copy(this._targetEnd);const s=!e||k(this._target.x,this._targetEnd.x,this.restThreshold)&&k(this._target.y,this._targetEnd.y,this.restThreshold)&&k(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}zoom(t,e=!1){return this.zoomTo(this._zoomEnd+t,e)}zoomTo(t,e=!1){this._isUserControllingZoom=!1,this._zoomEnd=$(t,this.minZoom,this.maxZoom),this._needsUpdate=!0,e||(this._zoom=this._zoomEnd);const s=!e||k(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(s)}pan(t,e,s=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(t,e,s)}truck(t,e,s=!1){this._camera.updateMatrix(),tt.setFromMatrixColumn(this._camera.matrix,0),et.setFromMatrixColumn(this._camera.matrix,1),tt.multiplyScalar(t),et.multiplyScalar(-e);const n=U.copy(tt).add(et),c=D.copy(this._targetEnd).add(n);return this.moveTo(c.x,c.y,c.z,s)}forward(t,e=!1){U.setFromMatrixColumn(this._camera.matrix,0),U.crossVectors(this._camera.up,U),U.multiplyScalar(t);const s=D.copy(this._targetEnd).add(U);return this.moveTo(s.x,s.y,s.z,e)}elevate(t,e=!1){return U.copy(this._camera.up).multiplyScalar(t),this.moveTo(this._targetEnd.x+U.x,this._targetEnd.y+U.y,this._targetEnd.z+U.z,e)}moveTo(t,e,s,n=!1){this._isUserControllingTruck=!1;const c=U.set(t,e,s).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,c,this.boundaryFriction),this._needsUpdate=!0,n||this._target.copy(this._targetEnd);const l=!n||k(this._target.x,this._targetEnd.x,this.restThreshold)&&k(this._target.y,this._targetEnd.y,this.restThreshold)&&k(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(l)}lookInDirectionOf(t,e,s,n=!1){const h=U.set(t,e,s).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(h.x,h.y,h.z,n)}fitToBox(t,e,{cover:s=!1,paddingLeft:n=0,paddingRight:c=0,paddingBottom:l=0,paddingTop:h=0}={}){const m=[],g=t.isBox3?_t.copy(t):_t.setFromObject(t);g.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const E=Wt(this._sphericalEnd.theta,$t),p=Wt(this._sphericalEnd.phi,$t);m.push(this.rotateTo(E,p,e));const _=U.setFromSpherical(this._sphericalEnd).normalize(),C=oe.setFromUnitVectors(_,kt),T=k(Math.abs(_.y),1);T&&C.multiply(jt.setFromAxisAngle(St,E)),C.multiply(this._yAxisUpSpaceInverse);const O=ie.makeEmpty();D.copy(g.min).applyQuaternion(C),O.expandByPoint(D),D.copy(g.min).setX(g.max.x).applyQuaternion(C),O.expandByPoint(D),D.copy(g.min).setY(g.max.y).applyQuaternion(C),O.expandByPoint(D),D.copy(g.max).setZ(g.min.z).applyQuaternion(C),O.expandByPoint(D),D.copy(g.min).setZ(g.max.z).applyQuaternion(C),O.expandByPoint(D),D.copy(g.max).setY(g.min.y).applyQuaternion(C),O.expandByPoint(D),D.copy(g.max).setX(g.min.x).applyQuaternion(C),O.expandByPoint(D),D.copy(g.max).applyQuaternion(C),O.expandByPoint(D),O.min.x-=n,O.min.y-=l,O.max.x+=c,O.max.y+=h,C.setFromUnitVectors(kt,_),T&&C.premultiply(jt.invert()),C.premultiply(this._yAxisUpSpace);const L=O.getSize(U),f=O.getCenter(D).applyQuaternion(C);if(lt(this._camera)){const w=this.getDistanceToFitBox(L.x,L.y,L.z,s);m.push(this.moveTo(f.x,f.y,f.z,e)),m.push(this.dollyTo(w,e)),m.push(this.setFocalOffset(0,0,0,e))}else if(ot(this._camera)){const w=this._camera,S=w.right-w.left,y=w.top-w.bottom,v=s?Math.max(S/L.x,y/L.y):Math.min(S/L.x,y/L.y);m.push(this.moveTo(f.x,f.y,f.z,e)),m.push(this.zoomTo(v,e)),m.push(this.setFocalOffset(0,0,0,e))}return Promise.all(m)}fitToSphere(t,e){const s=[],c="isObject3D"in t?Vt.createBoundingSphere(t,Rt):Rt.copy(t);if(s.push(this.moveTo(c.center.x,c.center.y,c.center.z,e)),lt(this._camera)){const l=this.getDistanceToFitSphere(c.radius);s.push(this.dollyTo(l,e))}else if(ot(this._camera)){const l=this._camera.right-this._camera.left,h=this._camera.top-this._camera.bottom,m=2*c.radius,g=Math.min(l/m,h/m);s.push(this.zoomTo(g,e))}return s.push(this.setFocalOffset(0,0,0,e)),Promise.all(s)}setLookAt(t,e,s,n,c,l,h=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=mt.NONE,this._changedDolly=0;const m=D.set(n,c,l),g=U.set(t,e,s);this._targetEnd.copy(m),this._sphericalEnd.setFromVector3(g.sub(m).applyQuaternion(this._yAxisUpSpace)),this._needsUpdate=!0,h||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const E=!h||k(this._target.x,this._targetEnd.x,this.restThreshold)&&k(this._target.y,this._targetEnd.y,this.restThreshold)&&k(this._target.z,this._targetEnd.z,this.restThreshold)&&k(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&k(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&k(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(E)}lerp(t,e,s,n=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=mt.NONE,this._changedDolly=0;const c=U.set(...t.target);if("spherical"in t)q.set(...t.spherical);else{const p=D.set(...t.position);q.setFromVector3(p.sub(c).applyQuaternion(this._yAxisUpSpace))}const l=pt.set(...e.target);if("spherical"in e)ut.set(...e.spherical);else{const p=D.set(...e.position);ut.setFromVector3(p.sub(l).applyQuaternion(this._yAxisUpSpace))}this._targetEnd.copy(c.lerp(l,s));const h=ut.theta-q.theta,m=ut.phi-q.phi,g=ut.radius-q.radius;this._sphericalEnd.set(q.radius+g*s,q.phi+m*s,q.theta+h*s),this._needsUpdate=!0,n||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const E=!n||k(this._target.x,this._targetEnd.x,this.restThreshold)&&k(this._target.y,this._targetEnd.y,this.restThreshold)&&k(this._target.z,this._targetEnd.z,this.restThreshold)&&k(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&k(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&k(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(E)}lerpLookAt(t,e,s,n,c,l,h,m,g,E,p,_,C,T=!1){return this.lerp({position:[t,e,s],target:[n,c,l]},{position:[h,m,g],target:[E,p,_]},C,T)}setPosition(t,e,s,n=!1){return this.setLookAt(t,e,s,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,n)}setTarget(t,e,s,n=!1){const c=this.getPosition(U),l=this.setLookAt(c.x,c.y,c.z,t,e,s,n);return this._sphericalEnd.phi=$(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),l}setFocalOffset(t,e,s,n=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(t,e,s),this._needsUpdate=!0,n||this._focalOffset.copy(this._focalOffsetEnd);const c=!n||k(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&k(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&k(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(c)}setOrbitPoint(t,e,s){this._camera.updateMatrixWorld(),tt.setFromMatrixColumn(this._camera.matrixWorldInverse,0),et.setFromMatrixColumn(this._camera.matrixWorldInverse,1),ht.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const n=U.set(t,e,s),c=n.distanceTo(this._camera.position),l=n.sub(this._camera.position);tt.multiplyScalar(l.x),et.multiplyScalar(l.y),ht.multiplyScalar(l.z),U.copy(tt).add(et).add(ht),U.z=U.z+c,this.dollyTo(c,!1),this.setFocalOffset(-U.x,U.y,-U.z,!1),this.moveTo(t,e,s,!1)}setBoundary(t){if(!t){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(t,e,s,n){if(t===null){this._viewport=null;return}this._viewport=this._viewport||new b.Vector4,typeof t=="number"?this._viewport.set(t,e,s,n):this._viewport.copy(t)}getDistanceToFitBox(t,e,s,n=!1){if(It(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const c=t/e,l=this._camera.getEffectiveFOV()*xt,h=this._camera.aspect;return((n?c>h:c<h)?e:t/h)*.5/Math.tan(l*.5)+s*.5}getDistanceToFitSphere(t){if(It(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const e=this._camera.getEffectiveFOV()*xt,s=Math.atan(Math.tan(e*.5)*this._camera.aspect)*2,n=1<this._camera.aspect?e:s;return t/Math.sin(n*.5)}getTarget(t,e=!0){return(t&&t.isVector3?t:new b.Vector3).copy(e?this._targetEnd:this._target)}getPosition(t,e=!0){return(t&&t.isVector3?t:new b.Vector3).setFromSpherical(e?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(e?this._targetEnd:this._target)}getSpherical(t,e=!0){return(t||new b.Spherical).copy(e?this._sphericalEnd:this._spherical)}getFocalOffset(t,e=!0){return(t&&t.isVector3?t:new b.Vector3).copy(e?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){return this._sphericalEnd.theta=(this._sphericalEnd.theta%it+it)%it,this._sphericalEnd.theta>Math.PI&&(this._sphericalEnd.theta-=it),this._spherical.theta+=it*Math.round((this._sphericalEnd.theta-this._spherical.theta)/it),this}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(t=!1){if(!k(this._camera.up.x,this._cameraUp0.x)||!k(this._camera.up.y,this._cameraUp0.y)||!k(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const s=this.getPosition(U);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}const e=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,t),this.zoomTo(this._zoom0,t)];return Promise.all(e)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,St),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const t=U.subVectors(this._target,this._camera.position).normalize(),e=D.crossVectors(t,this._camera.up);this._camera.up.crossVectors(e,t).normalize(),this._camera.updateMatrixWorld();const s=this.getPosition(U);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}update(t){const e=this._sphericalEnd.theta-this._spherical.theta,s=this._sphericalEnd.phi-this._spherical.phi,n=this._sphericalEnd.radius-this._spherical.radius,c=ee.subVectors(this._targetEnd,this._target),l=se.subVectors(this._focalOffsetEnd,this._focalOffset),h=this._zoomEnd-this._zoom;if(R(e))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const p=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=bt(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,p,1/0,t),this._needsUpdate=!0}if(R(s))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const p=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=bt(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,p,1/0,t),this._needsUpdate=!0}if(R(n))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const p=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=bt(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,p,this.maxSpeed,t),this._needsUpdate=!0}if(R(c.x)&&R(c.y)&&R(c.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const p=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;Jt(this._target,this._targetEnd,this._targetVelocity,p,this.maxSpeed,t,this._target),this._needsUpdate=!0}if(R(l.x)&&R(l.y)&&R(l.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const p=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;Jt(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,p,this.maxSpeed,t,this._focalOffset),this._needsUpdate=!0}if(R(h))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const p=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=bt(this._zoom,this._zoomEnd,this._zoomVelocity,p,1/0,t)}if(this.dollyToCursor){if(lt(this._camera)&&this._changedDolly!==0){const p=this._spherical.radius-this._lastDistance,_=this._camera,C=this._getCameraDirection(Tt),T=U.copy(C).cross(_.up).normalize();T.lengthSq()===0&&(T.x=1);const O=D.crossVectors(T,C),L=this._sphericalEnd.radius*Math.tan(_.getEffectiveFOV()*xt*.5),w=(this._sphericalEnd.radius-p-this._sphericalEnd.radius)/this._sphericalEnd.radius,S=pt.copy(this._targetEnd).add(T.multiplyScalar(this._dollyControlCoord.x*L*_.aspect)).add(O.multiplyScalar(this._dollyControlCoord.y*L)),y=U.copy(this._targetEnd).lerp(S,w),v=this._lastDollyDirection===mt.IN&&this._spherical.radius<=this.minDistance,P=this._lastDollyDirection===mt.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(v||P)){this._sphericalEnd.radius-=p,this._spherical.radius-=p;const N=D.copy(C).multiplyScalar(-p);y.add(N)}this._boundary.clampPoint(y,y);const d=D.subVectors(y,this._targetEnd);this._targetEnd.copy(y),this._target.add(d),this._changedDolly-=p,R(this._changedDolly)&&(this._changedDolly=0)}else if(ot(this._camera)&&this._changedZoom!==0){const p=this._zoom-this._lastZoom,_=this._camera,C=U.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(_.near+_.far)/(_.near-_.far)).unproject(_),T=D.set(0,0,-1).applyQuaternion(_.quaternion),O=pt.copy(C).add(T.multiplyScalar(-C.dot(_.up))),f=-(this._zoom-p-this._zoom)/this._zoom,w=this._getCameraDirection(Tt),S=this._targetEnd.dot(w),y=U.copy(this._targetEnd).lerp(O,f),v=y.dot(w),P=w.multiplyScalar(v-S);y.sub(P),this._boundary.clampPoint(y,y);const d=D.subVectors(y,this._targetEnd);this._targetEnd.copy(y),this._target.add(d),this._changedZoom-=p,R(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const m=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,m),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!R(this._focalOffset.x)||!R(this._focalOffset.y)||!R(this._focalOffset.z))&&(this._camera.matrix.compose(this._camera.position,this._camera.quaternion,this._camera.scale),tt.setFromMatrixColumn(this._camera.matrix,0),et.setFromMatrixColumn(this._camera.matrix,1),ht.setFromMatrixColumn(this._camera.matrix,2),tt.multiplyScalar(this._focalOffset.x),et.multiplyScalar(-this._focalOffset.y),ht.multiplyScalar(this._focalOffset.z),U.copy(tt).add(et).add(ht),this._camera.position.add(U),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),U.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const E=this._needsUpdate;return E&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):E?(this.dispatchEvent({type:"update"}),R(e,this.restThreshold)&&R(s,this.restThreshold)&&R(n,this.restThreshold)&&R(c.x,this.restThreshold)&&R(c.y,this.restThreshold)&&R(c.z,this.restThreshold)&&R(l.x,this.restThreshold)&&R(l.y,this.restThreshold)&&R(l.z,this.restThreshold)&&R(h,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!E&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=E,this._needsUpdate=!1,E}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Et(this.maxDistance),minZoom:this.minZoom,maxZoom:Et(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Et(this.maxPolarAngle),minAzimuthAngle:Et(this.minAzimuthAngle),maxAzimuthAngle:Et(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:U.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(t,e=!1){const s=JSON.parse(t);this.enabled=s.enabled,this.minDistance=s.minDistance,this.maxDistance=Ot(s.maxDistance),this.minZoom=s.minZoom,this.maxZoom=Ot(s.maxZoom),this.minPolarAngle=s.minPolarAngle,this.maxPolarAngle=Ot(s.maxPolarAngle),this.minAzimuthAngle=Ot(s.minAzimuthAngle),this.maxAzimuthAngle=Ot(s.maxAzimuthAngle),this.smoothTime=s.smoothTime,this.draggingSmoothTime=s.draggingSmoothTime,this.dollySpeed=s.dollySpeed,this.truckSpeed=s.truckSpeed,this.dollyToCursor=s.dollyToCursor,this._target0.fromArray(s.target0),this._position0.fromArray(s.position0),this._zoom0=s.zoom0,this._focalOffset0.fromArray(s.focalOffset0),this.moveTo(s.target[0],s.target[1],s.target[2],e),q.setFromVector3(U.fromArray(s.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(q.theta,q.phi,e),this.dollyTo(q.radius,e),this.zoomTo(s.zoom,e),this.setFocalOffset(s.focalOffset[0],s.focalOffset[1],s.focalOffset[2],e),this._needsUpdate=!0}connect(t){if(this._domElement){console.warn("camera-controls is already connected.");return}t.setAttribute("data-camera-controls-version",Ts),this._addAllEventListeners(t),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(t){return t.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(t){return this._getTargetDirection(t).negate()}_findPointerById(t){return this._activePointers.find(e=>e.pointerId===t)}_findPointerByMouseButton(t){return this._activePointers.find(e=>e.mouseButton===t)}_disposePointer(t){this._activePointers.splice(this._activePointers.indexOf(t),1)}_encloseToBoundary(t,e,s){const n=e.lengthSq();if(n===0)return t;const c=D.copy(e).add(t),h=this._boundary.clampPoint(c,pt).sub(c),m=h.lengthSq();if(m===0)return t.add(e);if(m===n)return t;if(s===0)return t.add(e).add(h);{const g=1+s*m/e.dot(h);return t.add(D.copy(e).multiplyScalar(g)).add(h.multiplyScalar(1-s))}}_updateNearPlaneCorners(){if(lt(this._camera)){const t=this._camera,e=t.near,s=t.getEffectiveFOV()*xt,n=Math.tan(s*.5)*e,c=n*t.aspect;this._nearPlaneCorners[0].set(-c,-n,0),this._nearPlaneCorners[1].set(c,-n,0),this._nearPlaneCorners[2].set(c,n,0),this._nearPlaneCorners[3].set(-c,n,0)}else if(ot(this._camera)){const t=this._camera,e=1/t.zoom,s=t.left*e,n=t.right*e,c=t.top*e,l=t.bottom*e;this._nearPlaneCorners[0].set(s,c,0),this._nearPlaneCorners[1].set(n,c,0),this._nearPlaneCorners[2].set(n,l,0),this._nearPlaneCorners[3].set(s,l,0)}}_collisionTest(){let t=1/0;if(!(this.colliderMeshes.length>=1)||It(this._camera,"_collisionTest"))return t;const s=this._getTargetDirection(Tt);Mt.lookAt(te,s,this._camera.up);for(let n=0;n<4;n++){const c=D.copy(this._nearPlaneCorners[n]);c.applyMatrix4(Mt);const l=pt.addVectors(this._target,c);Ut.set(l,s),Ut.far=this._spherical.radius+1;const h=Ut.intersectObjects(this.colliderMeshes);h.length!==0&&h[0].distance<t&&(t=h[0].distance)}return t}_getClientRect(t){if(!this._domElement)return;const e=this._domElement.getBoundingClientRect();return t.x=e.left,t.y=e.top,this._viewport?(t.x+=this._viewport.x,t.y+=e.height-this._viewport.w-this._viewport.y,t.width=this._viewport.z,t.height=this._viewport.w):(t.width=e.width,t.height=e.height),t}_createOnRestPromise(t){return t?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(e=>{const s=()=>{this.removeEventListener("rest",s),e()};this.addEventListener("rest",s)}))}_addAllEventListeners(t){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(t){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(t){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(t,e=new b.Sphere){const s=e,n=s.center;_t.makeEmpty(),t.traverseVisible(l=>{l.isMesh&&_t.expandByObject(l)}),_t.getCenter(n);let c=0;return t.traverseVisible(l=>{if(!l.isMesh)return;const h=l;if(!h.geometry)return;const m=h.geometry.clone();m.applyMatrix4(h.matrixWorld);const E=m.attributes.position;for(let p=0,_=E.count;p<_;p++)U.fromBufferAttribute(E,p),c=Math.max(c,n.distanceToSquared(U))}),s.radius=Math.sqrt(c),s}};const ws=u.forwardRef((o,i)=>{const{impl:t,camera:e,domElement:s,makeDefault:n,onControlStart:c,onControl:l,onControlEnd:h,onTransitionStart:m,onUpdate:g,onWake:E,onRest:p,onSleep:_,onStart:C,onEnd:T,onChange:O,regress:L,...f}=o,w=t??vs;u.useMemo(()=>{const A={Box3:Be,MathUtils:{clamp:Ve.clamp},Matrix4:pe,Quaternion:Zt,Raycaster:Ze,Sphere:Ye,Spherical:He,Vector2:Fe,Vector3:V,Vector4:ze};w.install({THREE:A}),Ke({CameraControlsImpl:w})},[w]);const S=Y(A=>A.camera),y=Y(A=>A.gl),v=Y(A=>A.invalidate),P=Y(A=>A.events),d=Y(A=>A.setEvents),N=Y(A=>A.set),M=Y(A=>A.get),B=Y(A=>A.performance),K=e||S,J=s||P.connected||y.domElement,I=u.useMemo(()=>new w(K),[w,K]);return wt((A,st)=>{I.update(st)},-1),u.useEffect(()=>(I.connect(J),()=>void I.disconnect()),[J,I]),u.useEffect(()=>{function A(){v(),L&&B.regress()}const st=F=>{A(),c==null||c(F),C==null||C(F)},nt=F=>{A(),l==null||l(F),O==null||O(F)},z=F=>{h==null||h(F),T==null||T(F)},rt=F=>{A(),m==null||m(F),O==null||O(F)},at=F=>{A(),g==null||g(F),O==null||O(F)},dt=F=>{A(),E==null||E(F),O==null||O(F)},Kt=F=>{p==null||p(F)},Xt=F=>{_==null||_(F)};return I.addEventListener("controlstart",st),I.addEventListener("control",nt),I.addEventListener("controlend",z),I.addEventListener("transitionstart",rt),I.addEventListener("update",at),I.addEventListener("wake",dt),I.addEventListener("rest",Kt),I.addEventListener("sleep",Xt),()=>{I.removeEventListener("controlstart",st),I.removeEventListener("control",nt),I.removeEventListener("controlend",z),I.removeEventListener("transitionstart",rt),I.removeEventListener("update",at),I.removeEventListener("wake",dt),I.removeEventListener("rest",Kt),I.removeEventListener("sleep",Xt)}},[I,v,d,L,B,c,l,h,m,g,E,p,_,O,C,T]),u.useEffect(()=>{if(n){const A=M().controls;return N({controls:I}),()=>N({controls:A})}},[n,I]),u.createElement("primitive",Q({ref:i,object:I},f))});function bs({defaultScene:o,defaultCamera:i,renderPriority:t=1}){const{gl:e,scene:s,camera:n}=Y();let c;return wt(()=>{c=e.autoClear,t===1&&(e.autoClear=!0,e.render(o,i)),e.autoClear=!1,e.clearDepth(),e.render(s,n),e.autoClear=c},t),u.createElement("group",{onPointerOver:()=>null})}function As({children:o,renderPriority:i=1}){const{scene:t,camera:e}=Y(),[s]=u.useState(()=>new Xe);return u.createElement(u.Fragment,null,qe(u.createElement(u.Fragment,null,o,u.createElement(bs,{defaultScene:t,defaultCamera:e,renderPriority:i})),s,{events:{priority:i+1}}))}const ye=u.createContext({}),Bt=()=>u.useContext(ye),Ss=2*Math.PI,zt=new Qe,ne=new pe,[ft,Ft]=[new Zt,new Zt],re=new V,ae=new V,Us=o=>"minPolarAngle"in o,ce=o=>"getTarget"in o,le=({alignment:o="bottom-right",margin:i=[80,80],renderPriority:t=1,onUpdate:e,onTarget:s,children:n})=>{const c=Y(v=>v.size),l=Y(v=>v.camera),h=Y(v=>v.controls),m=Y(v=>v.invalidate),g=u.useRef(null),E=u.useRef(null),p=u.useRef(!1),_=u.useRef(0),C=u.useRef(new V(0,0,0)),T=u.useRef(new V(0,0,0));u.useEffect(()=>{T.current.copy(l.up),zt.up.copy(l.up)},[l]);const O=u.useCallback(v=>{p.current=!0,(h||s)&&(C.current=(s==null?void 0:s())||(ce(h)?h.getTarget(C.current):h==null?void 0:h.target)),_.current=l.position.distanceTo(re),ft.copy(l.quaternion),ae.copy(v).multiplyScalar(_.current).add(re),zt.lookAt(ae),Ft.copy(zt.quaternion),m()},[h,l,s,m]);wt((v,P)=>{if(E.current&&g.current){var d;if(p.current)if(ft.angleTo(Ft)<.01)p.current=!1,Us(h)&&l.up.copy(T.current);else{const N=P*Ss;ft.rotateTowards(Ft,N),l.position.set(0,0,1).applyQuaternion(ft).multiplyScalar(_.current).add(C.current),l.up.set(0,1,0).applyQuaternion(ft).normalize(),l.quaternion.copy(ft),ce(h)&&h.setPosition(l.position.x,l.position.y,l.position.z),e?e():h&&h.update(P),m()}ne.copy(l.matrix).invert(),(d=g.current)==null||d.quaternion.setFromRotationMatrix(ne)}});const L=u.useMemo(()=>({tweenCamera:O}),[O]),[f,w]=i,S=o.endsWith("-center")?0:o.endsWith("-left")?-c.width/2+f:c.width/2-f,y=o.startsWith("center-")?0:o.startsWith("top-")?c.height/2-w:-c.height/2+w;return u.createElement(As,{renderPriority:t},u.createElement(ye.Provider,{value:L},u.createElement(Es,{makeDefault:!0,ref:E,position:[0,0,200]}),u.createElement("group",{ref:g,position:[S,y,0]},n)))},Ct={bg:"#f0f0f0",hover:"#999",text:"black",stroke:"black"},Ps=["Right","Left","Top","Bottom","Front","Back"],xe=o=>new V(...o).multiplyScalar(.38),Ls=[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1],[-1,1,1],[-1,1,-1],[-1,-1,1],[-1,-1,-1]].map(xe),Ns=[.25,.25,.25],Ee=[[1,1,0],[1,0,1],[1,0,-1],[1,-1,0],[0,1,1],[0,1,-1],[0,-1,1],[0,-1,-1],[-1,1,0],[-1,0,1],[-1,0,-1],[-1,-1,0]].map(xe),Ds=Ee.map(o=>o.toArray().map(i=>i==0?.5:.25)),Is=({hover:o,index:i,font:t="20px Inter var, Arial, sans-serif",faces:e=Ps,color:s=Ct.bg,hoverColor:n=Ct.hover,textColor:c=Ct.text,strokeColor:l=Ct.stroke,opacity:h=1})=>{const m=Y(E=>E.gl),g=u.useMemo(()=>{const E=document.createElement("canvas");E.width=128,E.height=128;const p=E.getContext("2d");return p.fillStyle=s,p.fillRect(0,0,E.width,E.height),p.strokeStyle=l,p.strokeRect(0,0,E.width,E.height),p.font=t,p.textAlign="center",p.fillStyle=c,p.fillText(e[i].toUpperCase(),64,76),new ue(E)},[i,e,t,s,c,l]);return u.createElement("meshBasicMaterial",{map:g,"map-anisotropy":m.capabilities.getMaxAnisotropy()||1,attach:`material-${i}`,color:o?n:"white",transparent:!0,opacity:h})},ks=o=>{const{tweenCamera:i}=Bt(),[t,e]=u.useState(null),s=l=>{l.stopPropagation(),e(null)},n=l=>{l.stopPropagation(),i(l.face.normal)},c=l=>{l.stopPropagation(),e(Math.floor(l.faceIndex/2))};return u.createElement("mesh",{onPointerOut:s,onPointerMove:c,onClick:o.onClick||n},[...Array(6)].map((l,h)=>u.createElement(Is,Q({key:h,index:h,hover:t===h},o))),u.createElement("boxGeometry",null))},he=({onClick:o,dimensions:i,position:t,hoverColor:e=Ct.hover})=>{const{tweenCamera:s}=Bt(),[n,c]=u.useState(!1),l=g=>{g.stopPropagation(),c(!1)},h=g=>{g.stopPropagation(),c(!0)},m=g=>{g.stopPropagation(),s(t)};return u.createElement("mesh",{scale:1.01,position:t,onPointerOver:h,onPointerOut:l,onClick:o||m},u.createElement("meshBasicMaterial",{color:n?e:"white",transparent:!0,opacity:.6,visible:n}),u.createElement("boxGeometry",{args:i}))},Rs=o=>u.createElement("group",{scale:[60,60,60]},u.createElement(ks,o),Ee.map((i,t)=>u.createElement(he,Q({key:t,position:i,dimensions:Ds[t]},o))),Ls.map((i,t)=>u.createElement(he,Q({key:t,position:i,dimensions:Ns},o))));function Ht({scale:o=[.8,.05,.05],color:i,rotation:t}){return u.createElement("group",{rotation:t},u.createElement("mesh",{position:[.4,0,0]},u.createElement("boxGeometry",{args:o}),u.createElement("meshBasicMaterial",{color:i,toneMapped:!1})))}function gt({onClick:o,font:i,disabled:t,arcStyle:e,label:s,labelColor:n,axisHeadScale:c=1,...l}){const h=Y(T=>T.gl),m=u.useMemo(()=>{const T=document.createElement("canvas");T.width=64,T.height=64;const O=T.getContext("2d");return O.beginPath(),O.arc(32,32,16,0,2*Math.PI),O.closePath(),O.fillStyle=e,O.fill(),s&&(O.font=i,O.textAlign="center",O.fillStyle=n,O.fillText(s,32,41)),new ue(T)},[e,s,n,i]),[g,E]=u.useState(!1),p=(s?1:.75)*(g?1.2:1)*c,_=T=>{T.stopPropagation(),E(!0)},C=T=>{T.stopPropagation(),E(!1)};return u.createElement("sprite",Q({scale:p,onPointerOver:t?void 0:_,onPointerOut:t?void 0:o||C},l),u.createElement("spriteMaterial",{map:m,"map-anisotropy":h.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:s?1:.75,toneMapped:!1}))}const js=({hideNegativeAxes:o,hideAxisHeads:i,disabled:t,font:e="18px Inter var, Arial, sans-serif",axisColors:s=["#ff2060","#20df80","#2080ff"],axisHeadScale:n=1,axisScale:c,labels:l=["X","Y","Z"],labelColor:h="#000",onClick:m,...g})=>{const[E,p,_]=s,{tweenCamera:C}=Bt(),T={font:e,disabled:t,labelColor:h,onClick:m,axisHeadScale:n,onPointerDown:t?void 0:O=>{C(O.object.position),O.stopPropagation()}};return u.createElement("group",Q({scale:40},g),u.createElement(Ht,{color:E,rotation:[0,0,0],scale:c}),u.createElement(Ht,{color:p,rotation:[0,0,Math.PI/2],scale:c}),u.createElement(Ht,{color:_,rotation:[0,-Math.PI/2,0],scale:c}),!i&&u.createElement(u.Fragment,null,u.createElement(gt,Q({arcStyle:E,position:[1,0,0],label:l[0]},T)),u.createElement(gt,Q({arcStyle:p,position:[0,1,0],label:l[1]},T)),u.createElement(gt,Q({arcStyle:_,position:[0,0,1],label:l[2]},T)),!o&&u.createElement(u.Fragment,null,u.createElement(gt,Q({arcStyle:E,position:[-1,0,0]},T)),u.createElement(gt,Q({arcStyle:p,position:[0,-1,0]},T)),u.createElement(gt,Q({arcStyle:_,position:[0,0,-1]},T)))))},G=_e(o=>({view:"perspective",projection:"perspective",zoomToCursor:!0,cameraPosition:{x:10,y:-10,z:8},controlMode:"orbit",sensitivity:{rotate:.3,dolly:.5,truck:.5},setControlMode:i=>o({controlMode:i}),setView:i=>o({view:i}),setProjection:i=>o({projection:i}),toggleZoomMode:()=>o(i=>({zoomToCursor:!i.zoomToCursor})),setCameraPosition:i=>o({cameraPosition:i}),setSensitivity:i=>o(t=>({sensitivity:{...t.sensitivity,...i}}))})),Z=[];for(let o=0;o<256;++o)Z.push((o+256).toString(16).slice(1));function Ms(o,i=0){return(Z[o[i+0]]+Z[o[i+1]]+Z[o[i+2]]+Z[o[i+3]]+"-"+Z[o[i+4]]+Z[o[i+5]]+"-"+Z[o[i+6]]+Z[o[i+7]]+"-"+Z[o[i+8]]+Z[o[i+9]]+"-"+Z[o[i+10]]+Z[o[i+11]]+Z[o[i+12]]+Z[o[i+13]]+Z[o[i+14]]+Z[o[i+15]]).toLowerCase()}let Yt;const zs=new Uint8Array(16);function Fs(){if(!Yt){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Yt=crypto.getRandomValues.bind(crypto)}return Yt(zs)}const Hs=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),de={randomUUID:Hs};function Ys(o,i,t){var s;o=o||{};const e=o.random??((s=o.rng)==null?void 0:s.call(o))??Fs();if(e.length<16)throw new Error("Random bytes length must be >= 16");return e[6]=e[6]&15|64,e[8]=e[8]&63|128,Ms(e)}function Zs(o,i,t){return de.randomUUID&&!o?de.randomUUID():Ys(o)}const H=_e(o=>({anchors:[],addAnchor:i=>o(t=>({anchors:[...t.anchors,i]})),setAnchors:i=>o({anchors:i}),removeAnchor:i=>o(t=>({anchors:t.anchors.filter(e=>e.id!==i)})),updateAnchorName:(i,t)=>o(e=>({anchors:e.anchors.map(s=>s.id===i?{...s,name:t}:s)})),updateAnchorType:(i,t)=>o(e=>({anchors:e.anchors.map(s=>s.id===i?{...s,type:t}:s)})),updateAnchorPosition:(i,t)=>o(e=>({anchors:e.anchors.map(s=>s.id===i?{...s,position:t}:s)})),clearAnchors:()=>o({anchors:[]}),technicalKm:221,technicalIndex:441,circuitId:"C1",setTechnicalKm:i=>o({technicalKm:i}),setTechnicalIndex:i=>o({technicalIndex:i}),setCircuitId:i=>o({circuitId:i})}));function Vs(){const o="/models/towers/scene.gltf",{scene:i}=Ge(o),t=H(s=>s.addAnchor),e=s=>{var n;s.stopPropagation(),t({id:Zs(),position:s.point.clone(),normal:(n=s.face)==null?void 0:n.normal.clone(),faceIndex:s.faceIndex??void 0,meshName:s.object.name,createdAt:new Date().toISOString()})};return r.jsx("primitive",{object:i,onPointerDown:e,scale:1,position:[0,1,0]})}function Bs({anchor:o}){const i=o.type||"cable_attach",t={cable_attach:{color:"#ef4444",geometry:"sphere",scale:.04},calibration_base:{color:"#3b82f6",geometry:"box",scale:.05},accessory_mount:{color:"#eab308",geometry:"cone",scale:.05}},{color:e,geometry:s,scale:n}=t[i];return r.jsxs("mesh",{position:o.position,children:[s==="sphere"&&r.jsx("sphereGeometry",{args:[n,16,16]}),s==="box"&&r.jsx("boxGeometry",{args:[n,n,n]}),s==="cone"&&r.jsx("coneGeometry",{args:[n,n*2,16]}),r.jsx("meshStandardMaterial",{color:e,emissive:e,emissiveIntensity:.5})]})}function Ks(){const o=H(i=>i.anchors);return r.jsx(r.Fragment,{children:o.map(i=>r.jsx(Bs,{anchor:i},i.id))})}function Xs(){const{sensitivity:o,setSensitivity:i}=G();return r.jsxs("div",{className:"absolute top-28 left-6 z-20 bg-zinc-900/90 backdrop-blur-md text-white p-4 rounded-2xl w-64 shadow-2xl border border-white/10 flex flex-col gap-4 animate-in fade-in slide-in-from-left-4 duration-300",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("div",{className:"p-1.5 rounded-lg bg-cyan-500/20",children:r.jsx(We,{className:"w-4 h-4 text-cyan-400"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-white",children:"Cmera"}),r.jsx("p",{className:"text-[10px] text-white/40 uppercase font-bold leading-none",children:"Ajuste de Sensibilidade"})]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between items-center text-[10px] font-black uppercase tracking-wider text-white/50",children:[r.jsxs("div",{className:"flex items-center gap-1.5",children:[r.jsx(_s,{className:"w-3 h-3"})," Rotao"]}),r.jsx("span",{className:"text-cyan-400 font-mono",children:o.rotate.toFixed(1)})]}),r.jsx(Nt,{value:[o.rotate*10],onValueChange:([t])=>i({rotate:t/10}),min:1,max:10,step:1})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between items-center text-[10px] font-black uppercase tracking-wider text-white/50",children:[r.jsxs("div",{className:"flex items-center gap-1.5",children:[r.jsx(fe,{className:"w-3 h-3"})," Zoom (Dolly)"]}),r.jsx("span",{className:"text-cyan-400 font-mono",children:o.dolly.toFixed(1)})]}),r.jsx(Nt,{value:[o.dolly*10],onValueChange:([t])=>i({dolly:t/10}),min:1,max:10,step:1})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between items-center text-[10px] font-black uppercase tracking-wider text-white/50",children:[r.jsxs("div",{className:"flex items-center gap-1.5",children:[r.jsx(Je,{className:"w-3 h-3"})," Pan (Truck)"]}),r.jsx("span",{className:"text-cyan-400 font-mono",children:o.truck.toFixed(1)})]}),r.jsx(Nt,{value:[o.truck*10],onValueChange:([t])=>i({truck:t/10}),min:1,max:10,step:1})]})]})]})}function qs({enabled:o}){const{view:i,zoomToCursor:t,cameraPosition:e,setCameraPosition:s,sensitivity:n}=G(),c=u.useRef(null),[l,h]=u.useState(!1),m=u.useRef(!1);u.useEffect(()=>{const E=c.current;if(!E)return;const p=new V;E.getPosition(p),p.distanceTo(new V(e.x,e.y,e.z))>.1&&(m.current=!0,E.setPosition(e.x,e.y,e.z,!0).then(()=>{m.current=!1}))},[e]),u.useEffect(()=>{const E=c.current;if(!E)return;const p=()=>{if(m.current)return;const _=new V;E.getPosition(_);const C=G.getState().cameraPosition,T=new V(_.x,_.y,_.z),O=new V(C.x,C.y,C.z);T.distanceTo(O)>.05&&s({x:_.x,y:_.y,z:_.z})};return E.addEventListener("update",p),()=>E.removeEventListener("update",p)},[]);const g=u.useRef({w:!1,a:!1,s:!1,d:!1});return u.useEffect(()=>{const E=_=>{_.key==="Control"&&h(!0);const C=_.key.toLowerCase();Object.prototype.hasOwnProperty.call(g.current,C)&&(g.current[C]=!0)},p=_=>{_.key==="Control"&&h(!1);const C=_.key.toLowerCase();Object.prototype.hasOwnProperty.call(g.current,C)&&(g.current[C]=!1)};return window.addEventListener("keydown",E),window.addEventListener("keyup",p),()=>{window.removeEventListener("keydown",E),window.removeEventListener("keyup",p)}},[]),wt((E,p)=>{const _=c.current;if(!_||!o)return;const T=(l?20:10)*p;g.current.w&&_.forward(T,!0),g.current.s&&_.forward(-T,!0),g.current.d&&_.truck(T,0,!0),g.current.a&&_.truck(-T,0,!0)}),r.jsx(ws,{ref:c,enabled:o,makeDefault:!0,minPolarAngle:0,maxPolarAngle:Math.PI/2,azimuthRotateSpeed:n.rotate,polarRotateSpeed:n.rotate,dollySpeed:n.dolly,truckSpeed:n.truck,dollyToCursor:t,minDistance:.1,maxDistance:1/0,mouseButtons:{left:l?8:2,right:1,middle:0,wheel:8},touches:{one:32,two:512,three:128},smoothTime:.2})}function Qs(){const[o,i]=u.useState(!0),t=G(e=>e.projection);return r.jsxs("div",{className:"relative w-full h-full bg-zinc-950",children:[r.jsxs($e,{shadows:!0,camera:{position:[10,-10,8],fov:45,up:[0,0,1]},gl:{antialias:!0},orthographic:t==="orthographic",children:[r.jsxs(u.Suspense,{fallback:null,children:[r.jsx("group",{rotation:[Math.PI/2,0,0],children:r.jsx(Vs,{})}),r.jsx(Ks,{})]}),r.jsx(qs,{enabled:o}),r.jsx(le,{alignment:"bottom-right",margin:[80,80],renderPriority:1,children:r.jsx("group",{onPointerEnter:()=>i(!1),onPointerLeave:()=>i(!0),children:r.jsx(Rs,{font:"bold 24px Inter",color:"#18181b",strokeColor:"#eab308",textColor:"#ffffff",hoverColor:"#facc15",opacity:.9,faces:["DIREITA","ESQUERDA","BAIXO","TOPO","FRENTE","TRS"]})})}),r.jsx(le,{alignment:"bottom-left",margin:[80,140],children:r.jsx(js,{axisColors:["#ef4444","#22c55e","#3b82f6"],labelColor:"white"})}),r.jsx("ambientLight",{intensity:.7}),r.jsx("directionalLight",{position:[10,10,10],intensity:1.2,castShadow:!0}),r.jsx("hemisphereLight",{intensity:.4,groundColor:"#000000"}),r.jsx("gridHelper",{args:[100,100,4473924,2236962],rotation:[Math.PI/2,0,0]})]}),r.jsx(Xs,{})]})}const Pt="/api/v1",Oe=Pt.startsWith("http")?Pt:`${typeof window<"u"?window.location.origin:""}${Pt.startsWith("/")?"":"/"}${Pt}`,Te="00000000-0000-0000-0000-000000000000",Lt="00000000-0000-0000-0000-000000000000",Ce="default-tower";function ve(o){return o.map(i=>({...i,position:Array.isArray(i.position)?i.position:[i.position.x,i.position.y,i.position.z],normal:i.normal?Array.isArray(i.normal)?i.normal:[i.normal.x,i.normal.y,i.normal.z]:null}))}async function we(o){return(await Ae({companyId:Te,projectId:Lt,towerId:Ce})).anchors}async function Gs(o,i){return be({companyId:Te,projectId:Lt,towerId:Ce},i)}async function be(o,i,t){const e=ve(i),s=await fetch(`${Oe}/anchors`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...o,anchors:e,...t})});if(!s.ok)throw new Error("Failed to save anchors");return s.json()}async function Ae(o){const i=new URLSearchParams(o).toString(),t=await fetch(`${Oe}/anchors?${i}`);if(!t.ok)throw new Error("Failed to fetch anchors");const e=await t.json();return{anchors:(Array.isArray(e)?e:e.anchors||[]).map(c=>({id:c.id,name:c.name||c.meshName,type:c.type||"cable_attach",meshName:c.meshName,position:c.position,normal:c.normal,faceIndex:c.faceIndex,createdAt:c.createdAt||new Date().toISOString()})),technicalKm:e.technicalKm||0,technicalIndex:e.technicalIndex||0,circuitId:e.circuitId||"C1"}}function $s({context:o}){const i=H(d=>d.anchors),t=H(d=>d.removeAnchor),e=H(d=>d.clearAnchors),s=H(d=>d.setAnchors),n=H(d=>d.updateAnchorName),c=H(d=>d.updateAnchorType),l=H(d=>d.technicalKm),h=H(d=>d.technicalIndex),m=H(d=>d.circuitId),g=H(d=>d.setTechnicalKm),E=H(d=>d.setTechnicalIndex),p=H(d=>d.setCircuitId),[_,C]=u.useState(!1),{toast:T}=Pe(),O=u.useRef(null),L=i.find(d=>d.type==="calibration_base"),f=()=>{const d=ve(i),N=JSON.stringify(d,null,2),M=new Blob([N],{type:"application/json"}),B=URL.createObjectURL(M),K=document.createElement("a");K.href=B,K.download=`anchors_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(K),K.click(),document.body.removeChild(K),URL.revokeObjectURL(B)},w=d=>{var B;const N=(B=d.target.files)==null?void 0:B[0];if(!N)return;const M=new FileReader;M.onload=K=>{var J;try{const I=(J=K.target)==null?void 0:J.result,A=JSON.parse(I),st=Array.isArray(A)?A:A.anchors;if(!Array.isArray(st))throw new Error("Formato invlido: esperado um array de ncoras");const nt=st.map((z,rt)=>({id:z.id||`imported-${rt}-${Date.now()}`,name:z.name||z.label||`Anchor ${rt+1}`,type:z.type||"cable_attach",meshName:z.meshName||"imported",position:Array.isArray(z.position)?new V(z.position[0],z.position[1],z.position[2]):new V(z.position.x,z.position.y,z.position.z),normal:z.normal,faceIndex:z.faceIndex,createdAt:z.createdAt||new Date().toISOString()}));s(nt),T({title:"Importao Concluda",description:`${nt.length} ncoras carregadas com sucesso.`})}catch{T({title:"Erro na Importao",description:"Arquivo JSON invlido ou formato incorreto.",variant:"destructive"})}},M.readAsText(N),O.current&&(O.current.value="")},S=async()=>{if(!o.companyId||!o.projectId||!o.towerId){T({title:"Erro de Contexto",description:"Faltam informaes de Empresa, Obra ou Torre na URL.",variant:"destructive"});return}C(!0);try{await be(o,i,{technicalKm:l,technicalIndex:h,circuitId:m}),T({title:"Configurao Salva",description:"As ncoras e sequncia tcnica foram persistidas globalmente."})}finally{C(!1)}},y=async()=>{if(window.confirm("Isso substituir todas as ncoras atuais pelo modelo padro. Continuar?"))try{const N=(await we(o.towerId)).map(M=>({...M,id:`instance-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,companyId:o.companyId,projectId:o.projectId}));s(N),T({title:"Modelo Carregado",description:"As ncoras padro foram carregadas. Lembre-se de salvar para persistir neste projeto."})}catch{T({title:"Erro",description:"No foi possvel carregar o modelo padro.",variant:"destructive"})}},v=async()=>{if(window.confirm("ATENO: Isso atualizar o MODELO PADRO para todas as obras. Tem certeza?")){C(!0);try{await Gs(o.towerId,i),T({title:"Template Atualizado",description:"Esta configurao agora  o padro para este tipo de torre."})}catch{T({title:"Erro ao Salvar Template",description:"Falha ao atualizar o modelo padro.",variant:"destructive"})}finally{C(!1)}}},P=o.projectId===Lt;return r.jsxs("div",{className:"absolute top-6 right-6 bg-zinc-900/90 backdrop-blur-md text-white p-5 rounded-2xl w-80 shadow-2xl border border-white/10 flex flex-col max-h-[80vh]",children:[r.jsxs("div",{className:"flex justify-between items-center mb-4",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"font-black uppercase tracking-tighter text-lg",children:"Anchors"}),r.jsx("p",{className:"text-[10px] text-white/40 uppercase tracking-widest leading-none",children:P?"EDITANDO TEMPLATE":"Configurao do Projeto"})]}),r.jsx(W,{variant:"ghost",size:"icon",onClick:()=>{window.confirm("Limpar todas as ncoras?")&&e()},className:"text-white/20 hover:text-red-500 hover:bg-red-500/10",children:r.jsx(ts,{className:"w-4 h-4"})})]}),!P&&r.jsxs("div",{className:"bg-black/40 rounded-xl p-3 mb-4 border border-white/10 shadow-inner group",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("div",{className:"p-1 bg-cyan-500/20 rounded",children:r.jsx(Qt,{className:"w-3 h-3 text-cyan-400"})}),r.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-white/70",children:"Topologia da Linha"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs("div",{className:"flex flex-col gap-1",children:[r.jsx("span",{className:"text-[8px] text-white/40 font-bold uppercase",children:"Estrutura (KM/NDICE)"}),r.jsxs("div",{className:"flex items-center gap-1.5 bg-black/20 rounded-lg p-1 border border-white/5 focus-within:border-cyan-500/30 transition-all",children:[r.jsx("input",{type:"number",value:l,onFocus:d=>d.target.select(),onChange:d=>g(parseInt(d.target.value)||0),className:"w-full bg-transparent border-none text-[11px] font-mono text-center text-cyan-400 focus:outline-none focus:ring-0 p-0",placeholder:"KM"}),r.jsx("span",{className:"text-white/10 font-bold",children:"/"}),r.jsx("input",{type:"number",value:h,onFocus:d=>d.target.select(),onChange:d=>E(parseInt(d.target.value)||0),className:"w-full bg-transparent border-none text-[11px] font-mono text-center text-cyan-400 focus:outline-none focus:ring-0 p-0",placeholder:"IND"})]})]}),r.jsxs("div",{className:"flex flex-col gap-1",children:[r.jsx("span",{className:"text-[8px] text-white/40 font-bold uppercase",children:"Circuito ID"}),r.jsxs("div",{className:"flex items-center bg-black/20 rounded-lg p-1 h-[32px] border border-white/5 focus-within:border-cyan-500/30 transition-all",children:[r.jsx("span",{className:"text-[9px] text-white/20 font-black ml-1 mr-2 px-1 bg-white/5 rounded",children:"C"}),r.jsx("input",{type:"text",value:m.replace(/^C/,""),onFocus:d=>d.target.select(),onChange:d=>p(`C${d.target.value.toUpperCase().replace(/^C/,"")}`),className:"w-full bg-transparent border-none text-[11px] font-mono text-white focus:outline-none focus:ring-0 p-0",placeholder:"1"})]})]})]})]}),!P&&r.jsxs("div",{className:"flex gap-2 mb-4 pb-4 border-b border-white/5",children:[r.jsxs(W,{variant:"outline",size:"sm",onClick:y,className:"flex-1 border-amber-500/30 text-amber-500 hover:bg-amber-500/10 text-[9px] font-black uppercase tracking-widest h-8",children:[r.jsx(es,{className:"w-3 h-3 mr-2"}),"Usar Padro"]}),r.jsx(W,{variant:"ghost",size:"sm",onClick:v,className:"w-8 px-0 text-white/20 hover:text-amber-500",title:"Salvar como Template (CUIDADO)",children:r.jsx(ss,{className:"w-3 h-3"})})]}),r.jsx("div",{className:"mb-4 pb-4 border-b border-white/5",children:r.jsxs(W,{variant:"outline",size:"sm",onClick:()=>{if(!window.confirm("Isso ajustar a escala das ncoras de 4.5x para 1.0x. Use apenas se as ncoras estiverem flutuando longe da torre. Continuar?"))return;const d=i.map(N=>{const M=N.position.isVector3?N.position.clone():new V(N.position[0],N.position[1],N.position[2]);return M.sub(new V(0,4,0)).divideScalar(4.5),{...N,position:M}});s(d),T({title:"Escala Corrigida",description:"ncoras ajustadas para escala 1.0x."})},className:"w-full border-red-500/30 text-red-400 hover:bg-red-500/10 text-[9px] font-black uppercase tracking-widest h-8",children:[r.jsx(Gt,{className:"w-3 h-3 mr-2 rotate-180"}),"Corrigir Escala (4.5x  1x)"]})}),r.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar space-y-2 pr-2",children:i.length===0?r.jsxs("div",{className:"py-8 text-center border-2 border-dashed border-white/5 rounded-xl",children:[r.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-white/20",children:"Nenhum anchor criado"}),r.jsx("p",{className:"text-[9px] text-white/10",children:"Clique no modelo para adicionar"})]}):i.map(d=>{var K,J,I;const N=d.position.z??d.position[2],M=L?L.position.z??L.position[2]:0,B=L&&d.id!==L.id?Math.abs(N-M).toFixed(2):null;return r.jsxs("div",{className:"flex flex-col p-3 bg-white/5 border border-white/5 rounded-xl group hover:border-white/20 transition-all gap-2",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex flex-col flex-1 mr-2",children:[r.jsx("input",{type:"text",value:d.name??d.meshName??"Mesh",onChange:A=>n(d.id,A.target.value),className:"bg-transparent border-none text-[10px] font-black uppercase text-cyan-400 leading-none mb-1 focus:outline-none focus:ring-0 w-full",placeholder:"Nome do Ponto"}),r.jsxs("span",{className:"text-[9px] text-white/40 font-mono tracking-tighter",children:[(K=d.position.x??d.position[0])==null?void 0:K.toFixed(2),",",(J=d.position.y??d.position[1])==null?void 0:J.toFixed(2),",",(I=d.position.z??d.position[2])==null?void 0:I.toFixed(2)]})]}),r.jsx("button",{onClick:()=>t(d.id),className:"p-1.5 text-white/20 hover:text-red-400 hover:bg-red-400/10 rounded-lg transition-colors",children:r.jsx(Le,{className:"w-3.5 h-3.5"})})]}),r.jsxs("div",{className:"flex items-center justify-between gap-2 border-t border-white/5 pt-2",children:[r.jsxs("select",{value:d.type||"cable_attach",onChange:A=>c(d.id,A.target.value),className:"bg-black/20 text-[9px] text-white/70 border border-white/10 rounded px-1.5 py-1 focus:outline-none focus:border-cyan-500/50 w-full uppercase font-bold",children:[r.jsx("option",{value:"cable_attach",children:"Ponto de Fixao"}),r.jsx("option",{value:"calibration_base",children:"Base (Ref. Altura)"}),r.jsx("option",{value:"accessory_mount",children:"Acessrio"})]}),B&&r.jsxs("div",{className:"whitespace-nowrap bg-cyan-500/10 text-cyan-400 px-2 py-1 rounded text-[9px] font-bold border border-cyan-500/20",children:[B,"m"]})]}),r.jsx("div",{className:"grid grid-cols-3 gap-1 mt-1 border-t border-white/5 pt-2",children:["x","y","z"].map(A=>{var z;const nt=(z=(d.position.isVector3?d.position:new V(d.position[0],d.position[1],d.position[2]))[A])==null?void 0:z.toFixed(3);return r.jsxs("div",{className:"flex items-center bg-black/20 rounded px-1",children:[r.jsx("span",{className:"text-[8px] font-bold text-white/30 uppercase mr-1",children:A}),r.jsx("input",{type:"number",step:"0.01",value:nt,onChange:rt=>{const at=d.position.isVector3?d.position.clone():new V(d.position[0],d.position[1],d.position[2]),dt=parseFloat(rt.target.value);A==="x"&&(at.x=dt),A==="y"&&(at.y=dt),A==="z"&&(at.z=dt),H.getState().updateAnchorPosition(d.id,at)},className:"w-full bg-transparent border-none text-[9px] text-white font-mono focus:outline-none p-0 py-0.5"})]},A)})})]},d.id)})}),r.jsxs("div",{className:"mt-4 pt-4 border-t border-white/5 flex flex-col gap-2",children:[r.jsxs(W,{onClick:S,disabled:_||i.length===0,className:"w-full bg-green-600 hover:bg-green-700 text-white font-black uppercase text-[10px] tracking-widest h-10 shadow-glow-green flex items-center gap-2",children:[r.jsx(Qt,{className:"w-3.5 h-3.5"}),_?"Salvando...":"Aplicar Configurao"]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(W,{onClick:f,variant:"outline",className:"flex-1 border-white/10 hover:bg-white/5 text-white/60 font-black uppercase text-[10px] tracking-widest h-10 flex items-center gap-2",children:[r.jsx(Gt,{className:"w-3.5 h-3.5"}),"Exportar"]}),r.jsxs(W,{onClick:()=>{var d;return(d=O.current)==null?void 0:d.click()},variant:"outline",className:"flex-1 border-cyan-500/30 hover:bg-cyan-500/10 text-cyan-400 font-black uppercase text-[10px] tracking-widest h-10 flex items-center gap-2",children:[r.jsx(is,{className:"w-3.5 h-3.5"}),"Importar"]}),r.jsx("input",{ref:O,type:"file",accept:".json",onChange:w,className:"hidden"})]})]})]})}function ui(){const o=Ne(),[i]=De(),t=i.get("companyId"),e=i.get("projectId"),s=i.get("towerId"),[n,c]=ct.useState({companyId:t??"default-company",projectId:e??"default-project",towerId:s??"default-tower"});ct.useEffect(()=>{if(!t||!e){const y=localStorage.getItem("3d_lab_context");if(y)try{const v=JSON.parse(y);c(P=>({companyId:t||v.companyId||"default-company",projectId:e||v.projectId||"default-project",towerId:s||v.towerId||"default-tower"}))}catch(v){console.error("Failed to parse saved context",v)}}},[t,e,s]),ct.useEffect(()=>{n.companyId&&n.companyId!=="default-company"&&n.projectId&&n.projectId!=="default-project"&&n.towerId&&n.towerId!=="default-tower"&&localStorage.setItem("3d_lab_context",JSON.stringify({companyId:n.companyId,projectId:n.projectId,towerId:n.towerId}))},[n]);const l=G(y=>y.view),h=G(y=>y.setView),m=G(y=>y.projection),g=G(y=>y.setProjection),E=G(y=>y.zoomToCursor),p=G(y=>y.toggleZoomMode),_=G(y=>y.cameraPosition),C=G(y=>y.setCameraPosition);H(y=>y.setAnchors);const[T,O]=ct.useState(_),[L,f]=ct.useState(!1);ct.useEffect(()=>{L||O(_)},[_,L]);const w=(y,v)=>{O(P=>({...P,[y]:parseFloat(v)||0}))},S=()=>{C(T),f(!1)};return ct.useEffect(()=>{(async()=>{if(n.companyId&&n.projectId&&n.towerId)try{const v=await Ae(n);if(H.getState().setTechnicalKm(v.technicalKm),H.getState().setTechnicalIndex(v.technicalIndex),H.getState().setCircuitId(v.circuitId),v.anchors&&v.anchors.length>0)H.getState().setAnchors(v.anchors);else if(n.projectId!==Lt)try{const P=await we(n.towerId);if(P&&P.length>0){const d=P.map(N=>({...N,id:`auto-instance-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,companyId:n.companyId,projectId:n.projectId}));H.getState().setAnchors(d)}}catch(P){console.log("No template found or error loading template",P)}}catch(v){console.error("Failed to load anchors",v)}})()},[n.companyId,n.projectId,n.towerId]),r.jsxs("div",{className:"relative w-screen h-screen overflow-hidden bg-zinc-950 font-sans",children:[r.jsx("div",{className:"absolute inset-0 bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-size-[24px_24px] pointer-events-none"}),r.jsxs("div",{className:"absolute top-6 left-6 z-10 flex items-center gap-6",children:[r.jsx(W,{variant:"ghost",onClick:()=>o(-1),className:"bg-white/5 hover:bg-white/10 backdrop-blur-md border border-white/10 rounded-2xl h-12 w-12 p-0 text-white/60 hover:text-white",children:r.jsx(os,{className:"w-5 h-5"})}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("div",{className:"p-1 bg-cyan-500/20 rounded-md",children:r.jsx(Ie,{className:"w-3.5 h-3.5 text-cyan-400"})}),r.jsx("h1",{className:"text-xl font-black uppercase tracking-tighter text-white",children:"3D Anchor Lab"})]}),r.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-white/30 leading-none",children:"Configurao Tcnica de Pontos de Fixao"})]})]}),r.jsxs("div",{className:"absolute top-6 left-1/2 -translate-x-1/2 z-10 flex flex-col items-center gap-3",children:[r.jsx("div",{className:"flex items-center gap-1 bg-black/40 backdrop-blur-xl border border-white/10 p-1.5 rounded-2xl shadow-2xl",children:[{id:"perspective",label:"3D",icon:ns},{id:"top",label:"Topo",icon:rs},{id:"front",label:"Frente",icon:as},{id:"right",label:"Direita",icon:ps},{id:"left",label:"Esquerda",icon:ds}].map(y=>r.jsxs(W,{variant:"ghost",size:"sm",onClick:()=>h(y.id),className:yt("flex items-center gap-2 h-9 px-4 rounded-xl transition-all duration-300","text-[10px] font-black uppercase tracking-widest",l===y.id?"bg-primary text-white shadow-[0_0_15px_rgba(var(--primary),0.5)]":"text-white/40 hover:text-white hover:bg-white/5"),children:[r.jsx(y.icon,{className:"w-3.5 h-3.5"}),r.jsx("span",{className:"hidden sm:inline",children:y.label})]},y.id))}),r.jsxs("div",{className:"flex items-center gap-2 bg-black/20 backdrop-blur-lg border border-white/5 p-1 rounded-xl shadow-lg",children:[r.jsxs(W,{variant:"ghost",size:"sm",onClick:()=>g(m==="perspective"?"orthographic":"perspective"),className:yt("h-8 px-3 rounded-lg text-[9px] font-black uppercase tracking-wider gap-2",m==="orthographic"?"text-primary bg-primary/10":"text-white/40 hover:text-white"),title:m==="perspective"?"Mudar para Projeo Ortogrfica":"Mudar para Projeo Perspectiva",children:[r.jsx(gs,{className:"w-3 h-3"}),m==="perspective"?"Perspectiva":"Ortogrfica"]}),r.jsx("div",{className:"w-px h-4 bg-white/5"}),r.jsxs(W,{variant:"ghost",size:"sm",onClick:()=>p(),className:yt("h-8 px-3 rounded-lg text-[9px] font-black uppercase tracking-wider gap-2",E?"text-primary bg-primary/10":"text-white/40 hover:text-white"),title:E?"Zoom foca no Mouse":"Zoom foca no Centro",children:[E?r.jsx(fe,{className:"w-3 h-3"}):r.jsx(cs,{className:"w-3 h-3"}),E?"Zoom Mouse":"Zoom Centro"]})]})]}),r.jsx("div",{className:"absolute top-6 left-[calc(50%+240px)] z-10 hidden md:flex items-center gap-1.5 bg-black/40 backdrop-blur-xl border border-white/10 p-1.5 rounded-2xl shadow-2xl h-[44px]",children:["x","y","z"].map(y=>r.jsxs("div",{className:yt("flex items-center bg-black/20 rounded-lg px-2 h-full border border-white/5 transition-colors group",y==="x"&&"focus-within:border-red-500/50",y==="y"&&"focus-within:border-green-500/50",y==="z"&&"focus-within:border-blue-500/50"),children:[r.jsx("span",{className:yt("text-[10px] font-black mr-1.5 uppercase",y==="x"&&"text-red-500",y==="y"&&"text-green-500",y==="z"&&"text-blue-500"),children:y}),r.jsx("input",{type:"number",step:"0.5",value:T?T[y].toFixed(2):"0.00",onFocus:()=>f(!0),onBlur:S,onChange:v=>w(y,v.target.value),onKeyDown:v=>{v.key==="Enter"&&(S(),v.currentTarget.blur())},className:"bg-transparent border-none text-xs font-bold text-white w-12 text-center focus:outline-none"})]},y))}),r.jsx(Qs,{}),r.jsxs("div",{className:"absolute bottom-6 left-6 flex items-center gap-4 bg-black/40 backdrop-blur-md px-4 py-3 rounded-2xl border border-white/10 pointer-events-none",children:[r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"text-[8px] font-black text-white/40 uppercase tracking-widest",children:"Modelo Ativo"}),r.jsx("span",{className:"text-xs font-black text-white",children:"TOWER_SCENE_001.GLTF"})]}),r.jsx("div",{className:"w-px h-6 bg-white/10 mx-2"}),r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"text-[8px] font-black text-white/40 uppercase tracking-widest",children:"Status"}),r.jsxs("span",{className:"text-xs font-black text-green-400 flex items-center gap-1.5",children:[r.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-400 animate-pulse"}),"RENDERIZANDO"]})]})]}),r.jsx($s,{context:n})]})}export{ui as default};
