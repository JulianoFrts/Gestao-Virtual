import{f as ze,u as et,a1 as tt,c as at,b as st,r as o,g as rt,a2 as H,j as e,a3 as Q,C as ot,q as nt,p as ge,a4 as be,$ as ve,s as Y,K as we,B as q,a5 as je,a6 as it,a7 as ct,e as lt}from"./index-D951x4H-.js";import{u as Ne}from"./useTimeRecords-RqrN7uRd.js";import{I as ye}from"./input-dNnkIPn6.js";import{F as dt,f as ke}from"./FaceRegistrationDialog-DCcS3GMZ.js";import{A as Ce,a as De,b as Se,c as Ee,d as Me,e as Ae,f as mt,g as Ie}from"./alert-dialog-qR-bbYaw.js";import{c as ut,t as Re,f as Z}from"./format-CP1OFCPJ.js";import{i as xt}from"./isSameDay-BB6-IGfB.js";import{S as Te}from"./search-BoEw84GM.js";import{p as ht}from"./pt-BR-B9S-fQgu.js";import"./circle-alert-BlgUQYiE.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]],Fe=ze("LogIn",pt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["path",{d:"M9 9h.01",key:"1q5me6"}],["path",{d:"M15 9h.01",key:"x1ddxp"}]],gt=ze("ScanFace",ft);function bt(l){return ut(l,Date.now())}function vt(l){return c=>{const f=(l?Math[l]:Math.trunc)(c);return f===0?0:f}}function wt(l,c){return+Re(l)-+Re(c)}function Pe(l,c,d){const f=wt(l,c)/1e3;return vt(d==null?void 0:d.roundingMethod)(f)}function jt(l){return xt(l,bt(l))}const Nt={none:{maxWidth:1920,quality:.95,label:"Original (95%)"},light:{maxWidth:800,quality:.8,label:"Leve (800px, 80%)"},moderate:{maxWidth:640,quality:.7,label:"Moderada (640px, 70%)"},aggressive:{maxWidth:480,quality:.65,label:"Agressiva (480px, 65%)"}};async function yt(l,c="moderate"){const d=Nt[c];return new Promise((f,R)=>{const N=new Image;N.onload=()=>{const E=document.createElement("canvas");let M=N.width,i=N.height;M>d.maxWidth&&(i=i*d.maxWidth/M,M=d.maxWidth),E.width=M,E.height=i;const A=E.getContext("2d");if(!A){R(new Error("Não foi possível criar contexto canvas"));return}A.drawImage(N,0,0,M,i);const T=E.toDataURL("image/jpeg",d.quality),O=T.length-23,g=Math.round(O*.75/1024);f({dataUrl:T,sizeKB:g,config:d})},N.onerror=()=>R(new Error("Erro ao carregar imagem")),N.src=l})}const Le=l=>{if(!l)return"---";const c=l.replace(/\D/g,"");return c.length!==11?c:c.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4")};function zt(){const{user:l,profile:c}=et(),d=tt(c==null?void 0:c.role),f=c==null?void 0:c.employeeId;at();const{employees:R}=st(),{createRecord:N}=Ne(),[E,M]=o.useState(""),[i,A]=o.useState(""),[T,O]=o.useState("entry"),[g,ee]=o.useState(null),[kt,B]=o.useState(!1),[b,te]=o.useState(!1),[Ct,W]=o.useState(null),[ae,_e]=o.useState(new Date),[Dt,He]=o.useState([]),[qe,Oe]=o.useState(""),[y,se]=o.useState(null),[F,U]=o.useState(null),[h,$]=o.useState("home"),[G,Be]=o.useState("ponto"),[K,P]=o.useState(0),[S,V]=o.useState(null),[re,We]=o.useState([]),[w,oe]=o.useState(30),[p,ne]=o.useState(!1),[J,ie]=o.useState(""),[Ue,L]=o.useState(!1),[$e,ce]=o.useState(!1),[Ge,Ke]=o.useState("entry"),[Ve,X]=o.useState(!1),[I,z]=o.useState(""),[le,_]=o.useState(!1);o.useEffect(()=>{w===0&&h==="capturing"&&!p&&ne(!0)},[w,h,p]);const{records:de}=Ne(),j=o.useRef(null),Je=o.useRef(null),me=o.useRef(0),{toast:k}=rt(),v=R.filter(a=>a.isActive);o.useEffect(()=>{(async()=>{try{(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(s=>s.stop());const t=(await navigator.mediaDevices.enumerateDevices()).filter(s=>s.kind==="videoinput");He(t),t.length>0&&Oe(t[0].deviceId)}catch(r){console.error("Erro ao listar câmeras:",r),W("Permissão de câmera negada ou dispositivo não encontrado.")}})()},[]),o.useEffect(()=>{const a=setInterval(()=>_e(new Date),1e3);return H.getItem("last_known_location").then(V),()=>clearInterval(a)},[]),o.useEffect(()=>{h==="capturing"&&!p&&(async()=>{try{const r=await new Promise((t,s)=>navigator.geolocation.getCurrentPosition(t,s,{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e4})),n={lat:r.coords.latitude,lng:r.coords.longitude};V(n),await H.setItem("last_known_location",n)}catch(r){console.warn("Falha no pre-fetch de localização:",r)}})()},[h,p]);const ue=o.useMemo(()=>{const a=de.filter(s=>jt(new Date(s.recordedAt))&&s.employeeId===(d?f:i)).sort((s,m)=>new Date(s.recordedAt).getTime()-new Date(m.recordedAt).getTime());We(a);let r=0;for(let s=0;s<a.length;s+=2)a[s]&&a[s+1]?r+=Pe(new Date(a[s+1].recordedAt),new Date(a[s].recordedAt)):a[s]&&a[s].recordType==="entry"&&(r+=Pe(new Date,new Date(a[s].recordedAt)));const n=Math.floor(r/3600),t=Math.floor(r%3600/60);return{h:n,m:t,recs:a}},[de,d,f,i]);o.useEffect(()=>{let a;const r=async()=>{const n=Date.now();if(h==="capturing"&&j.current&&j.current.readyState===4&&!b&&!g&&!p&&w>0&&n-me.current>=250){me.current=n;try{const t=v.find(s=>s.id===i);if(t!=null&&t.faceDescriptor){const s=await ke.getDescriptor(j.current);if(s){const m=new Float32Array(t.faceDescriptor),x=ke.compareFaces(s,m);if(U(x),x<.45){const u=K+1;P(u),u>=5&&xe()}else P(0)}else U(null),P(0)}}catch(t){console.error("Auto-detect error",t)}}a=requestAnimationFrame(r)};return h==="capturing"&&r(),()=>cancelAnimationFrame(a)},[h,i,b,g,K,p]),o.useEffect(()=>{let a;return h==="capturing"&&w>0&&!p&&!g&&!b&&(a=window.setInterval(()=>{oe(r=>r-1)},1e3)),()=>clearInterval(a)},[h,w,p,g,b]);const xe=async()=>{if(!j.current)return;const a=document.createElement("canvas");a.width=j.current.videoWidth,a.height=j.current.videoHeight;const r=a.getContext("2d");r&&r.drawImage(j.current,0,0,a.width,a.height);const n=a.toDataURL("image/jpeg",.95),{dataUrl:t,sizeKB:s}=await yt(n,"light");console.log(`[TimeClock] Foto comprimida: ${s}KB`),ee(t),await Qe(t)};o.useEffect(()=>{d&&f&&A(f)},[d,f]),o.useEffect(()=>{h==="capturing"&&y&&j.current&&(j.current.srcObject=y)},[h,y]);const Xe=async a=>{const r=qe;W(null),y&&y.getTracks().forEach(n=>n.stop());try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Câmera não suportada ou conexão insegura (precisa de HTTPS).");B(!0);const n={video:{deviceId:r?{exact:r}:void 0,width:{ideal:1920},height:{ideal:1080},facingMode:r?void 0:"user",frameRate:{ideal:30,max:60}}},t=await navigator.mediaDevices.getUserMedia(n);se(t)}catch(n){console.error("Erro ao iniciar câmera:",n);const t=n instanceof Error?n.message:"Não foi possível acessar a câmera";W(t),B(!1),k({title:"Erro de Câmera",description:"Verifique as permissões ou use o upload de foto.",variant:"destructive"})}},he=o.useCallback(()=>{y&&(y.getTracks().forEach(a=>a.stop()),se(null)),B(!1)},[y]),pe=async a=>{var s,m;Ke(a);const r=await((s=navigator.permissions)==null?void 0:s.query({name:"camera"}).then(x=>x.state==="granted").catch(()=>!1)),n=await((m=navigator.permissions)==null?void 0:m.query({name:"geolocation"}).then(x=>x.state==="granted").catch(()=>!1));if(!r||!n){window.dispatchEvent(new CustomEvent("open-permissions-modal")),k({title:"Permissões Necessárias",description:"Por favor, conceda acesso à câmera e localização para continuar.",variant:"destructive"});return}if(!S){X(!0);return}const t=v.find(x=>x.id===i);if(!t){k({title:"Erro",description:"Selecione um funcionário primeiro.",variant:"destructive"});return}if(!t.faceDescriptor||t.faceDescriptor.length===0){L(!0);return}fe(a)},fe=a=>{O(a),oe(30),ne(!1),ie(""),$("capturing"),Xe()},Qe=async a=>{const r=a||g;if(!i||!r){k({title:"Erro",description:"Dados incompletos para o registro.",variant:"destructive"});return}te(!0);try{const n=v.find(u=>u.id===i);let t=null,s=null;const m=u=>new Promise((C,D)=>navigator.geolocation.getCurrentPosition(C,D,u));try{const u=await m({enableHighAccuracy:!0,timeout:15e3,maximumAge:0});t=u.coords.latitude,s=u.coords.longitude}catch(u){console.warn("Alta precisão falhou no save, tentando modo rápido...",u);try{const C=await m({enableHighAccuracy:!1,timeout:1e4,maximumAge:25e4});t=C.coords.latitude,s=C.coords.longitude}catch(C){console.error("GPS falhou completamente:",C);const D=await H.getItem("last_known_location");D&&(t=D.lat,s=D.lng,console.info("Usando última localização conhecida salva."))}}t!==null&&s!==null&&(await H.setItem("last_known_location",{lat:t,lng:s}),V({lat:t,lng:s}));const x=await N({employeeId:i,teamId:E||void 0,companyId:c==null?void 0:c.companyId,recordType:T,photoUrl:r,latitude:t??void 0,longitude:s??void 0});P(0),U(null),await new Promise(u=>setTimeout(u,3e3)),ee(null),he(),$("home")}catch{k({title:"Erro no servidor",description:"Não foi possível salvar o registro.",variant:"destructive"})}finally{te(!1)}},Ye=()=>{var a,r,n;return e.jsxs("div",{className:"flex flex-col h-full max-w-md mx-auto animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e.jsx("div",{className:"flex bg-muted/40 p-1 rounded-2xl mb-8 border border-border/50",children:["ponto","checkin","historico"].map(t=>e.jsx("button",{onClick:()=>Be(t),className:`flex-1 py-3 text-xs font-bold uppercase tracking-widest rounded-xl transition-all ${G===t?"bg-primary text-white shadow-lg":"text-muted-foreground hover:text-foreground"}`,children:t==="checkin"?"Check-in":t},t))}),e.jsxs("div",{className:"flex-1 space-y-8 pb-10",children:[G==="ponto"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h2",{className:"text-5xl font-black tracking-tighter text-foreground tabular-nums",children:Z(ae,"HH:mm:ss")}),e.jsx("p",{className:"text-muted-foreground font-bold uppercase tracking-widest text-xs",children:Z(ae,"EEEE, dd 'de' MMMM",{locale:ht})})]}),e.jsxs("div",{className:"glass-card p-6 rounded-[2.5rem] bg-linear-to-br from-primary/10 to-transparent border-primary/10 shadow-glow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 rounded-2xl bg-primary/20 text-primary",children:e.jsx(ot,{className:"w-6 h-6"})}),e.jsx(nt,{variant:"outline",className:"border-primary/20 text-primary font-bold",children:"HOJE"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-bold text-muted-foreground uppercase tracking-widest",children:"Horas trabalhadas hoje"}),e.jsxs("p",{className:"text-3xl font-black tracking-tight",children:[ue.h,"h ",ue.m,"m"]})]})]}),!d&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(ge,{className:"text-[10px] font-black uppercase tracking-widest ml-1 text-muted-foreground",children:"Colaborador"}),e.jsx("div",{className:"relative",children:!i&&e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(ye,{type:"text",placeholder:"Digite o nome, CPF ou matrícula...",value:I,onChange:t=>{z(t.target.value),_(!0)},onFocus:()=>_(!0),className:"h-14 rounded-2xl industrial-input bg-card shadow-sm pl-12 pr-4"}),I&&e.jsx("button",{onClick:()=>{z("")},className:"absolute right-4 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:e.jsx(be,{className:"h-5 w-5"})})]}),le&&I&&e.jsxs("div",{className:"absolute z-50 w-full mt-2 bg-card border border-border rounded-2xl shadow-xl max-h-60 overflow-y-auto",children:[v.filter(t=>{var D;const s=I.toLowerCase().trim(),m=s.replace(/\D/g,""),x=t.fullName.toLowerCase().includes(s),u=t.registrationNumber.toLowerCase().includes(s),C=m!==""&&((D=t.cpf)==null?void 0:D.replace(/\D/g,"").includes(m));return x||u||C}).slice(0,10).map(t=>e.jsxs("button",{onClick:()=>{A(t.id),z(t.fullName),_(!1)},className:Y("w-full px-4 py-3 text-left hover:bg-primary/10 flex items-center justify-between transition-colors",i===t.id&&"bg-primary/20"),children:[e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("p",{className:"font-bold text-sm leading-tight text-foreground",children:t.fullName}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[10px] text-muted-foreground font-medium uppercase tracking-wider bg-muted/30 px-1.5 py-0.5 rounded",children:["CPF: ",Le(t.cpf)]}),e.jsxs("span",{className:"text-[10px] text-muted-foreground font-medium uppercase tracking-wider bg-muted/30 px-1.5 py-0.5 rounded",children:["Mat: #",t.registrationNumber]})]})]}),i===t.id&&e.jsx(ve,{className:"h-5 w-5 text-primary"})]},t.id)),v.filter(t=>{var x;const s=I.toLowerCase().trim(),m=s.replace(/\D/g,"");return t.fullName.toLowerCase().includes(s)||t.registrationNumber.toLowerCase().includes(s)||m!==""&&((x=t.cpf)==null?void 0:x.replace(/\D/g,"").includes(m))}).length===0&&e.jsxs("div",{className:"px-4 py-6 text-center text-muted-foreground",children:[e.jsx(we,{className:"h-8 w-8 mx-auto mb-2 opacity-30"}),e.jsx("p",{className:"text-sm",children:"Nenhum colaborador encontrado"})]})]})]})}),i&&!le&&e.jsxs("div",{onClick:()=>{A(""),z(""),_(!0)},className:"flex items-center gap-3 p-4 rounded-2xl bg-primary/10 border border-primary/20 cursor-pointer hover:bg-primary/15 transition-all active:scale-[0.98] group relative overflow-hidden",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center shrink-0",children:e.jsx(we,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-bold text-base leading-tight",children:(a=v.find(t=>t.id===i))==null?void 0:a.fullName}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("span",{className:"text-xs text-muted-foreground font-medium uppercase tracking-wider",children:["CPF: ",Le(((r=v.find(t=>t.id===i))==null?void 0:r.cpf)||null)]}),e.jsxs("span",{className:"text-xs text-muted-foreground font-medium uppercase tracking-wider",children:["Mat: #",(n=v.find(t=>t.id===i))==null?void 0:n.registrationNumber]})]})]}),e.jsxs("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-muted/20 group-hover:bg-cyan-500/10 transition-all duration-300",children:[e.jsx(ve,{className:"h-6 w-6 text-emerald-500 group-hover:hidden drop-shadow-[0_0_8px_rgba(16,185,129,0.5)]"}),e.jsx(Te,{className:"h-6 w-6 text-cyan-400 hidden group-hover:block animate-in zoom-in-50 duration-200 drop-shadow-[0_0_8px_rgba(34,211,238,0.5)]"})]})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(q,{onClick:()=>pe("entry"),className:"h-24 flex-1 rounded-4xl flex-col gap-2 font-black text-lg bg-success text-white hover:bg-success/90 shadow-glow transition-transform active:scale-95",children:[e.jsx(Fe,{className:"w-8 h-8"}),"ENTRADA"]}),e.jsxs(q,{onClick:()=>pe("exit"),className:"h-24 flex-1 rounded-4xl flex-col gap-2 font-black text-lg bg-destructive text-white hover:bg-destructive/90 shadow-glow transition-transform active:scale-95",children:[e.jsx(je,{className:"w-8 h-8"}),"SAÍDA"]})]})}),e.jsxs("div",{className:"flex items-start gap-3 p-5 rounded-4xl bg-muted/30 border border-white/5",children:[e.jsx(Q,{className:"w-5 h-5 text-primary mt-0.5"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[10px] font-black text-muted-foreground uppercase tracking-widest",children:"Sua Localização"}),e.jsx("p",{className:"text-sm font-bold text-foreground leading-snug",children:S?`${S.lat.toFixed(4)}, ${S.lng.toFixed(4)} (Capturado)`:"Buscando sinal de satélite..."})]})]})]}),G==="historico"&&e.jsxs("div",{className:"space-y-4 animate-in fade-in slide-in-from-bottom-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-black uppercase tracking-widest text-xs ml-1",children:"Registros de Hoje"}),e.jsx(q,{variant:"ghost",size:"sm",className:"text-xs h-8",children:"Ver todos"})]}),re.length===0?e.jsxs("div",{className:"text-center py-12 opacity-30",children:[e.jsx(it,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Nenhum registro ainda hoje"})]}):re.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-4 p-4 glass-card rounded-2xl border-white/5",children:[e.jsx("div",{className:`p-3 rounded-xl ${t.recordType==="entry"?"bg-success/10 text-success":"bg-destructive/10 text-destructive"}`,children:t.recordType==="entry"?e.jsx(Fe,{className:"w-5 h-5"}):e.jsx(je,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-bold text-sm tracking-tight",children:t.recordType==="entry"?"Entrada":"Saída"}),e.jsx("p",{className:"text-[10px] text-muted-foreground font-black uppercase",children:Z(new Date(t.recordedAt),"HH:mm:ss")})]}),e.jsx(ct,{className:"w-4 h-4 text-muted-foreground opacity-30"})]},s))]})]})]})},Ze=()=>e.jsxs("div",{className:"fixed inset-0 z-50 bg-black animate-in fade-in duration-300 flex items-center justify-center p-0 lg:p-12 overflow-hidden",children:[e.jsxs("div",{className:"relative w-full h-full max-w-lg aspect-9/16 bg-background overflow-hidden shadow-2xl transition-transform duration-700",children:[e.jsx("video",{ref:j,autoPlay:!0,playsInline:!0,muted:!0,className:"absolute inset-0 w-full h-full object-cover scale-x-[-1]"}),!b&&!g&&e.jsx("div",{className:"absolute inset-x-0 h-20 w-full bg-linear-to-b from-transparent via-primary/20 to-transparent animate-scan-slow opacity-50 z-10 pointer-events-none"}),e.jsxs("div",{className:"absolute inset-0 z-20 flex flex-col pointer-events-none",children:[e.jsxs("div",{className:"w-full flex flex-col items-center",children:[e.jsxs("div",{className:"w-full bg-background/60 backdrop-blur-md py-6 border-b border-border/50 text-center space-y-1 pointer-events-none animate-in slide-in-from-top duration-500",children:[(!p||b)&&w>0&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-foreground text-3xl font-black tracking-tighter animate-pulse drop-shadow-sm",children:b?"REGISTRANDO...":"AGUARDE..."}),e.jsx("p",{className:"text-foreground/80 text-[11px] font-black uppercase tracking-[0.2em] leading-none",children:b?"Sua foto foi capturada":"estamos reconhecendo seu rosto"})]}),!b&&!g&&!p&&w>0&&e.jsxs("p",{className:"text-foreground text-[44px] font-black mt-2 drop-shadow-sm",children:[w,"s"]})]}),e.jsx("div",{className:"absolute top-6 right-6",children:e.jsx("button",{onClick:()=>{he(),$("home")},className:"w-14 h-14 rounded-full bg-background/60 backdrop-blur-xl flex items-center justify-center pointer-events-auto border border-border/50 text-foreground hover:bg-background/80 transition-colors shadow-lg",children:e.jsx(be,{className:"w-7 h-7 stroke-3"})})})]}),e.jsx("div",{className:"h-20"}),e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-8 relative",children:!p&&w>0&&e.jsxs("div",{className:"relative w-full aspect-square border-2 rounded-[3rem] transition-colors duration-500",style:{borderColor:F===null?"rgba(255,255,255,0.2)":F<.5?"var(--success)":"var(--destructive)"},children:[e.jsx("div",{className:"absolute -top-1 -left-1 w-12 h-12 border-t-8 border-l-8 rounded-tl-[3rem] border-inherit"}),e.jsx("div",{className:"absolute -top-1 -right-1 w-12 h-12 border-t-8 border-r-8 rounded-tr-[3rem] border-inherit"}),e.jsx("div",{className:"absolute -bottom-1 -left-1 w-12 h-12 border-b-8 border-l-8 rounded-bl-[3rem] border-inherit"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-12 h-12 border-b-8 border-r-8 rounded-br-[3rem] border-inherit"})]})}),e.jsxs("div",{className:"p-8 pb-12 pointer-events-auto mt-auto",children:[!p&&F!==null&&F<.5&&!b&&!g&&e.jsx("div",{className:"flex justify-center mb-12 animate-in fade-in slide-in-from-bottom-4 duration-500",children:e.jsxs("div",{className:"px-6 py-2.5 rounded-full bg-success text-success-foreground font-black text-[10px] tracking-[0.2em] shadow-lg flex items-center gap-2.5 whitespace-nowrap border border-white/10",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-current animate-ping"}),"RECONHECIDO ",Math.min(100,Math.round(K/5*100)),"%"]})}),e.jsx("div",{className:"absolute top-6 right-6 z-20 flex flex-col gap-2",children:e.jsxs("div",{className:Y("px-3 py-1.5 rounded-full backdrop-blur-md border flex items-center gap-2 transition-all duration-300",S?"bg-success/20 border-success/30 text-success":"bg-muted/50 border-border text-muted-foreground"),children:[e.jsx(Q,{className:Y("w-3.5 h-3.5",!S&&"animate-pulse")}),e.jsx("span",{className:"text-[10px] font-bold tracking-wider uppercase",children:S?"Localização OK":"Buscando GPS..."})]})}),p&&!b&&!g&&e.jsxs("div",{className:"w-full space-y-6 animate-in fade-in slide-in-from-bottom-8 duration-700",children:[e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx(ge,{className:"block text-[11px] font-black uppercase tracking-[0.4em] text-foreground opacity-90",children:"Digite seu CPF"}),e.jsx("div",{className:"relative",children:e.jsx(ye,{type:"text",value:J,onChange:a=>{const r=a.target.value.replace(/\D/g,"").slice(0,11);ie(r)},className:"h-20 rounded-[2.5rem] bg-background/60 border-border text-foreground text-center text-4xl font-black tracking-[0.2em] backdrop-blur-xl focus:ring-primary/50 shadow-inner",placeholder:"000.000.000-00",autoFocus:!0})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(q,{onClick:async()=>{var r;const a=v.find(n=>n.id===i);a&&(J===((r=a.cpf)==null?void 0:r.replace(/\D/g,""))?await xe():k({title:"CPF Incorreto",description:"O CPF digitado não corresponde ao colaborador selecionado.",variant:"destructive"}))},disabled:J.length<11,className:"w-full h-24 rounded-[3rem] bg-primary hover:opacity-90 text-primary-foreground font-black uppercase tracking-widest text-2xl shadow-glow active:scale-95 border-none transition-all",children:"Bater ponto com CPF"}),w===0&&e.jsx("p",{className:"text-muted-foreground text-[10px] uppercase font-black tracking-[0.3em] text-center",children:"Tempo de reconhecimento facial esgotado"})]})]})]})]})]}),b&&e.jsx("div",{className:"absolute inset-0 bg-white animate-flash z-40"}),g&&e.jsxs("div",{className:"absolute inset-0 z-50 flex flex-col items-center justify-center bg-background/80 backdrop-blur-md animate-in fade-in duration-500",children:[e.jsx("div",{className:"bg-success p-8 rounded-full shadow-glow animate-scale-in mb-6",children:e.jsx(lt,{className:"w-16 h-16 text-success-foreground"})}),e.jsxs("div",{className:"text-center space-y-2 animate-in slide-in-from-bottom-4 delay-200 duration-500",children:[e.jsx("p",{className:"text-foreground text-3xl font-black tracking-tighter",children:"SUCESSO!"}),e.jsx("p",{className:"text-muted-foreground font-bold uppercase tracking-widest text-[10px]",children:"Ponto registrado com êxito"})]})]})]});return e.jsxs("div",{className:"min-h-screen bg-transparent",children:[h==="home"&&Ye(),h==="capturing"&&Ze(),e.jsx("canvas",{ref:Je,className:"hidden"}),e.jsx(Ce,{open:Ue,onOpenChange:L,children:e.jsxs(De,{className:"max-w-md",children:[e.jsxs(Se,{children:[e.jsx("div",{className:"mx-auto mb-4 w-16 h-16 rounded-full bg-amber-500/10 flex items-center justify-center",children:e.jsx(gt,{className:"w-8 h-8 text-amber-500"})}),e.jsx(Ee,{className:"text-center text-xl",children:"Biometria Facial Não Cadastrada"}),e.jsx(Me,{className:"text-center",children:"Para registrar o ponto, é necessário ter a biometria facial cadastrada. Deseja cadastrar sua biometria agora?"})]}),e.jsxs(Ae,{className:"flex-col sm:flex-row gap-2",children:[e.jsx(mt,{className:"flex-1",onClick:()=>{L(!1),k({title:"Registro Bloqueado",description:"É necessário cadastrar a biometria facial para registrar ponto.",variant:"destructive"})},children:"Não, cancelar"}),e.jsx(Ie,{className:"flex-1 bg-primary",onClick:()=>{L(!1),ce(!0)},children:"Sim, cadastrar agora"})]})]})}),e.jsx(Ce,{open:Ve,onOpenChange:X,children:e.jsxs(De,{className:"max-w-md",children:[e.jsxs(Se,{children:[e.jsx("div",{className:"mx-auto mb-4 w-16 h-16 rounded-full bg-destructive/10 flex items-center justify-center",children:e.jsx(Q,{className:"w-8 h-8 text-destructive"})}),e.jsx(Ee,{className:"text-center text-xl",children:"Localização Não Disponível"}),e.jsx(Me,{className:"text-center",children:"Aguarde a localização GPS ser capturada antes de registrar o ponto. Verifique se o GPS está ativado no seu dispositivo."})]}),e.jsx(Ae,{children:e.jsx(Ie,{className:"w-full",onClick:()=>X(!1),children:"Entendido"})})]})}),e.jsx(dt,{employee:v.find(a=>a.id===i)||null,open:$e,onOpenChange:a=>{if(ce(a),!a){const r=v.find(n=>n.id===i);r!=null&&r.faceDescriptor&&r.faceDescriptor.length>0&&(k({title:"Biometria Cadastrada!",description:"Agora você pode registrar o ponto."}),fe(Ge))}}})]})}export{zt as default};
