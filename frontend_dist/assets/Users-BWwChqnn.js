import{f as ms,g as Wa,r as n,j as e,p as o,s as I,B as p,aj as ps,L as ye,O as xe,ar as ke,N as hs,u as xs,as as ie,ae as us,w as gs,d as q,i as Qe,a as bs,v as Oa,at as K,D as oe,k as ne,l as we,m as Ne,o as ve,K as ce,al as Da,am as Fa,a8 as Ma,an as Pa,ao as Ue,ap as de,Y as Ta,Z as _a,_ as Ua,S as N,G as v,H as y,I as k,J as d,ag as me,E as pe,M as Re,q as V,ah as Je,Q as js,$ as fs,au as ea,av as Le,R as ws,aw as Ns,ax as vs,ay as ys,W as ks,az as Cs}from"./index-D951x4H-.js";import{L as Ss}from"./LoadingScreen-SEZW07K4.js";import{u as Is}from"./useCompanies-kjFTA6Qu.js";import{u as As}from"./useSites-Dum3dnEP.js";import{I as h}from"./input-dNnkIPn6.js";import{C as Es,b as Os,c as Ds}from"./card-BTHGlYFz.js";import{C as Z}from"./checkbox-B9hZgst_.js";import{A as aa,h as Fs,a as sa,b as ra,c as ta,d as la,e as ia,f as oa,g as na}from"./alert-dialog-qR-bbYaw.js";import{E as Ms}from"./eye-off-Bbweex62.js";import{E as Ps}from"./eye-CxUjXe8h.js";import{C as Ts}from"./copy-CXglQ41p.js";import{I as _s}from"./info-MbzHf59N.js";import{C as Ra,a as La,b as za,c as ze}from"./context-menu-CftfI8l1.js";import{A as Ba,a as R,b as L,c as z,d as Us,v as Rs}from"./inputValidators-Bb6hXMpp.js";import{S as Ls}from"./slider-fkHl-ud9.js";import{C as zs,a as Bs,b as Gs,c as Vs,d as $s,e as Hs}from"./command-DzEVDCzR.js";import{T as Ga}from"./triangle-alert-BPKdZxxI.js";import{P as qs}from"./plus-DmkF01H_.js";import{U as Va}from"./user-plus-DZOYeFz-.js";import{I as Be}from"./image-CBHGYJfV.js";import{T as he}from"./trash-2-DD2QlM38.js";import{S as $a}from"./search-BoEw84GM.js";import{S as Ws}from"./square-check-big-CO_74oGA.js";import{P as Ys}from"./pencil-DX9IZKx2.js";import{Z as Ha}from"./zoom-in-C25xHsbW.js";import{M as Ks}from"./move-CukShz45.js";import"./index-COevDGDX.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]],Xs=ms("Ban",Zs);function qa({onSave:f,isSaving:X=!1}){const{toast:B}=Wa(),[E,O]=n.useState(""),[Q,Ce]=n.useState(!0),[W,Y]=n.useState(12),[j,P]=n.useState({uppercase:!0,lowercase:!0,numbers:!0,symbols:!0}),J=n.useCallback(()=>{const b={uppercase:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",lowercase:"abcdefghijklmnopqrstuvwxyz",numbers:"0123456789",symbols:"!@#$%^&*()_+~`|}{[]:;?><,./-="};let T="";if(j.uppercase&&(T+=b.uppercase),j.lowercase&&(T+=b.lowercase),j.numbers&&(T+=b.numbers),j.symbols&&(T+=b.symbols),!T){B({title:"Aviso",description:"Selecione pelo menos um tipo de caractere",variant:"destructive"});return}let Se="";for(let ue=0;ue<W;ue++)Se+=T.charAt(Math.floor(Math.random()*T.length));O(Se)},[W,j,B]);n.useEffect(()=>{J()},[]);const ee=()=>{navigator.clipboard.writeText(E),B({title:"Copiado!",description:"Senha copiada para a área de transferência."})},ae=(()=>{if(!E)return{label:"Empty",color:"text-muted-foreground"};let b=0;return E.length>8&&b++,E.length>12&&b++,/[A-Z]/.test(E)&&b++,/[0-9]/.test(E)&&b++,/[!@#$%^&*()]/.test(E)&&b++,b<=2?{label:"FRACA",color:"text-red-500 border-red-500/30 bg-red-500/5"}:b<=4?{label:"MÉDIA",color:"text-yellow-500 border-yellow-500/30 bg-yellow-500/5"}:{label:"FORTE",color:"text-emerald-500 border-emerald-500/30 bg-emerald-500/5"}})();return e.jsxs("div",{className:"p-6 space-y-6 rounded-xl border border-yellow-500/20 bg-black/95 backdrop-blur-2xl shadow-2xl animate-in zoom-in-95 duration-300 ring-1 ring-white/10",children:[e.jsxs("div",{className:"text-center space-y-1 relative",children:[e.jsx("div",{className:"absolute -top-1 left-1/2 -translate-x-1/2 w-32 h-1 bg-yellow-500/20 rounded-full"}),e.jsx("h3",{className:"text-xl font-black text-yellow-500 uppercase tracking-[0.2em] pt-4",children:"PASSWORD GENERATOR"}),e.jsx("p",{className:"text-[10px] text-white/30 font-bold uppercase tracking-widest italic",children:"Industrial Security Protocol"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-end px-1",children:[e.jsx(o,{className:"text-[10px] uppercase font-black tracking-widest text-white/40",children:"Senha Gerada"}),e.jsxs("span",{className:"text-[10px] font-black uppercase tracking-wider",children:["SEGURANÇA: ",e.jsx("span",{className:I("px-2 py-0.5 rounded transition-all duration-500 border",ae.color),children:ae.label})]})]}),e.jsxs("div",{className:"relative group overflow-hidden rounded-lg",children:[e.jsx(h,{type:Q?"text":"password",value:E,readOnly:!0,className:"h-14 bg-white/5 border-yellow-500/30 text-white font-mono text-xl pr-28 focus-visible:ring-yellow-500/50 focus-visible:border-yellow-500 transition-all text-center tracking-extra-wide"}),e.jsxs("div",{className:"absolute right-1.5 top-1/2 -translate-y-1/2 flex items-center gap-1 bg-black/40 backdrop-blur-md p-1 rounded-md border border-white/5",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"h-9 w-9 text-white/50 hover:text-yellow-500 hover:bg-yellow-500/10 transition-colors",onClick:()=>Ce(!Q),title:Q?"Ocultar":"Mostrar",children:Q?e.jsx(Ms,{className:"h-4 w-4"}):e.jsx(Ps,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"icon",className:"h-9 w-9 text-white/50 hover:text-yellow-500 hover:bg-yellow-500/10 transition-colors",onClick:ee,title:"Copiar",children:e.jsx(Ts,{className:"h-4 w-4"})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-[10px] uppercase font-black tracking-widest text-white/40 px-1",children:"Configuração Técnica"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 p-4 bg-white/2 border border-white/5 rounded-xl",children:[e.jsxs("div",{className:"flex items-center space-x-3 cursor-pointer group bg-white/5 p-2 rounded-lg hover:bg-white/10 transition-colors",onClick:()=>P({...j,uppercase:!j.uppercase}),children:[e.jsx(Z,{checked:j.uppercase,className:"border-yellow-500/50 data-[state=checked]:bg-yellow-500 data-[state=checked]:border-yellow-500"}),e.jsx("span",{className:"text-[11px] font-bold text-white/70 group-hover:text-white transition-colors uppercase",children:"Maiúsculas"})]}),e.jsxs("div",{className:"flex items-center space-x-3 cursor-pointer group bg-white/5 p-2 rounded-lg hover:bg-white/10 transition-colors",onClick:()=>P({...j,lowercase:!j.lowercase}),children:[e.jsx(Z,{checked:j.lowercase,className:"border-yellow-500/50 data-[state=checked]:bg-yellow-500 data-[state=checked]:border-yellow-500"}),e.jsx("span",{className:"text-[11px] font-bold text-white/70 group-hover:text-white transition-colors uppercase",children:"Minúsculas"})]}),e.jsxs("div",{className:"flex items-center space-x-3 cursor-pointer group bg-white/5 p-2 rounded-lg hover:bg-white/10 transition-colors",onClick:()=>P({...j,numbers:!j.numbers}),children:[e.jsx(Z,{checked:j.numbers,className:"border-yellow-500/50 data-[state=checked]:bg-yellow-500 data-[state=checked]:border-yellow-500"}),e.jsx("span",{className:"text-[11px] font-bold text-white/70 group-hover:text-white transition-colors uppercase",children:"Números"})]}),e.jsxs("div",{className:"flex items-center space-x-3 cursor-pointer group bg-white/5 p-2 rounded-lg hover:bg-white/10 transition-colors",onClick:()=>P({...j,symbols:!j.symbols}),children:[e.jsx(Z,{checked:j.symbols,className:"border-yellow-500/50 data-[state=checked]:bg-yellow-500 data-[state=checked]:border-yellow-500"}),e.jsx("span",{className:"text-[11px] font-bold text-white/70 group-hover:text-white transition-colors uppercase",children:"Símbolos"})]}),e.jsxs("div",{className:"col-span-2 pt-2 border-t border-white/5 mt-1 flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] uppercase font-black text-white/30",children:"Comprimento"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-yellow-500 font-mono font-bold text-sm w-4",children:W}),e.jsx(h,{type:"range",min:6,max:32,value:W,onChange:b=>Y(parseInt(b.target.value)),className:"h-1.5 w-32 bg-white/10 rounded-full appearance-none cursor-pointer accent-yellow-500 hover:accent-yellow-400"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 pt-2",children:[e.jsxs(p,{variant:"outline",className:"w-full border-yellow-500/50 text-yellow-500 hover:bg-yellow-500/10 font-black h-12 rounded-lg transition-all uppercase tracking-widest text-xs",onClick:J,children:[e.jsx(ps,{className:"w-4 h-4 mr-2"}),"Nova Senha"]}),e.jsxs(p,{className:"w-full bg-yellow-500 hover:bg-yellow-600 text-black font-black h-12 rounded-lg shadow-lg shadow-yellow-500/20 active:scale-[0.98] transition-all uppercase tracking-widest text-xs",onClick:()=>f(E),disabled:X,children:[X?e.jsx(ye,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Salvar Acesso"]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-white/5 animate-in fade-in slide-in-from-bottom-2 duration-700",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1 rounded bg-yellow-500/10 border border-yellow-500/20",children:e.jsx(_s,{className:"w-3.5 h-3.5 text-yellow-500"})}),e.jsx("h4",{className:"text-[10px] font-black text-yellow-500 uppercase tracking-widest",children:"Protocolo de Segurança"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-6 gap-y-2 text-[10px] text-white/40 leading-tight",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-yellow-500/70 font-bold",children:"•"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Entropy:"})," Com ",W," caracteres, a complexidade é exponencial."]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-yellow-500/70 font-bold",children:"•"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Storage:"})," Senhas são processadas via hashing irreversível no servidor."]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-yellow-500/70 font-bold",children:"•"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Transit:"})," Transferência protegida por criptografia de ponta Orion (TLS)."]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-yellow-500/70 font-bold",children:"•"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Control:"})," Toda alteração administrativa é registrada em logs de auditoria."]})]})]}),e.jsx("div",{className:"p-3 bg-red-500/5 rounded-lg border border-red-500/10 mt-1",children:e.jsxs("p",{className:"text-[9px] text-red-400 italic font-medium leading-relaxed",children:[e.jsx(ke,{className:"inline w-3 h-3 mr-1 -mt-0.5"}),e.jsx("strong",{children:"Aviso:"})," É obrigação do administrador reportar esta senha ao usuário por canal seguro e externo ao sistema."]})})]})})]})]})}const Qs={OPERATIONAL:{label:"Operacional (Básico)",permissions:[{code:"dashboard",label:"Painel Geral"},{code:"clock",label:"Bate-ponto (Câmera)"},{code:"clock.manual_id",label:"Ponto via Matrícula"},{code:"daily_reports",label:"Relatórios Diários"},{code:"time_records.view",label:"Visualizar Registros de Ponto"},{code:"settings.profile",label:"Editar Perfil"},{code:"support.ticket",label:"Chamados de Suporte"}]},MANAGEMENT:{label:"Gestão (Gerentes/Supervisores)",permissions:[{code:"companies.view",label:"Visualizar Empresas"},{code:"companies.manage",label:"Gerenciar Empresas"},{code:"sites.view",label:"Visualizar Canteiros"},{code:"projects.view",label:"Visualizar Obras"},{code:"projects.manage",label:"Gerenciar Obras"},{code:"team_composition",label:"Composição de Equipe"},{code:"employees.manage",label:"Gestão de Funcionários"},{code:"viewer_3d.view",label:"Visualizador 3D"},{code:"projects.progress",label:"Andamento de Projetos (Mapa)"},{code:"work_progress.view",label:"Andamento da Obra (Gráficos)"},{code:"costs.view",label:"Gestão de Custos"},{code:"production.analytics",label:"Analytics de Produção"}]},GLOBAL:{label:"Gestão Global (Admin)",permissions:[{code:"users.manage",label:"Gestão de Usuários"},{code:"custom_su.manage",label:"Configurar Matriz SU"},{code:"audit_logs.view",label:"Logs de Auditoria"},{code:"db_hub.manage",label:"Database Hub"},{code:"settings.mfa",label:"Gerenciar MFA"},{code:"gapo.view",label:"Módulo GAPO"}]}};function Sr(){hs();const{profile:f,refreshProfile:X}=xs(),[B,E]=n.useState([]);n.useEffect(()=>{(async()=>{const{data:s,error:l}=await ks.from("list_iap").select("*").order("iap",{ascending:!0});!l&&s&&E(s)})()},[]);const[O,Q]=n.useState(""),[Ce,W]=n.useState("");n.useEffect(()=>{const a=setTimeout(()=>{W(O)},500);return()=>clearTimeout(a)},[O]);const[Y,j]=n.useState("corporate"),[P,J]=n.useState("all_combined"),ee=Y==="corporate",da=n.useMemo(()=>({companyId:ie(f)?void 0:(f==null?void 0:f.companyId)||void 0,search:Ce,onlyCorporate:Y==="corporate",excludeCorporate:Y==="external"}),[f,Ce,Y]),{users:ae,isLoading:b,updateUser:T,createUser:Se,deleteUser:ue,resetUserPassword:Ya,adminChangePassword:ma,adminToggleBlock:Ka}=us(da),{companies:Ie}=Is(),{projects:_}=gs(),{sites:Ae}=As(),{toast:x}=Wa(),[pa,$]=n.useState(null),[ha,xa]=n.useState(!1),[ua,Ge]=n.useState(!1),Za=q("users.create")||q("users.manage")||Qe.value,Ve=q("users.update")||q("users.manage")||Qe.value,ga=q("users.delete")||q("users.manage")||Qe.value,[C,ge]=n.useState(new Set),ba=bs();n.useEffect(()=>{!b&&f&&Oa("showAdminMenu")&&!q("users.read")&&(x({title:"Acesso Negado",description:"Sua conta não tem permissão para gerenciar usuários.",variant:"destructive"}),ba("/dashboard"))},[b,f,ba,x]);const be=n.useMemo(()=>ae.filter(a=>{if(P==="app_management")return ie(a);if(O||P==="search"){const s=O.toLowerCase(),l=(a.fullName||"").toLowerCase().includes(s),c=(a.email||"").toLowerCase().includes(s),i=(a.registrationNumber||"").toLowerCase().includes(s),m=(a.cpf||"").replace(/\D/g,"").includes(s.replace(/\D/g,""));return l||c||i||m}return!0}),[ae,O,P]),G=n.useMemo(()=>[...be].sort((a,s)=>{var M,le,_e,fe;const l=(a.role||"WORKER").toUpperCase(),c=(s.role||"WORKER").toUpperCase(),i=((M=K.find(D=>D.name===l||D.name===(a.role||"").toLowerCase()))==null?void 0:M.rank)||((le=K.find(D=>D.name==="WORKER"))==null?void 0:le.rank)||0,m=((_e=K.find(D=>D.name===c||D.name===(s.role||"").toLowerCase()))==null?void 0:_e.rank)||((fe=K.find(D=>D.name==="WORKER"))==null?void 0:fe.rank)||0;return m!==i?m-i:(a.fullName||"").localeCompare(s.fullName||"")}),[be]),Xa=()=>{C.size===G.length&&G.length>0?ge(new Set):ge(new Set(G.map(a=>a.id)))},ja=a=>{const s=new Set(C);s.has(a)?s.delete(a):s.add(a),ge(s)},[S,$e]=n.useState(null),[Ee,Oe]=n.useState(!1),[He,qe]=n.useState(!1),[t,g]=n.useState({name:"",email:"",password:"",role:"ADMIN",companyId:"",projectId:"",siteId:"",registrationNumber:"",image:"",cpf:"",gender:"",birthDate:"",phone:"",cep:"",street:"",number:"",neighborhood:"",city:"",state:"",laborType:"",iapName:""}),[se,fa]=n.useState(null),[re,Qa]=n.useState(null),[We,Ye]=n.useState(null),[A,Ke]=n.useState(null),[w,Ze]=n.useState({companyId:"GESTÃO VIRTUAL",projectId:"ORION",siteId:"0"}),[Ja,wa]=n.useState(!1),[Na,va]=n.useState(!1),[F,De]=n.useState(null),[r,u]=n.useState({fullName:"",email:"",password:"",role:"WORKER",isSystemAdmin:!1,companyId:"none",projectId:"none",siteId:"none",registrationNumber:"",image:"",cpf:"",gender:"",birthDate:"",phone:"",cep:"",street:"",number:"",neighborhood:"",city:"",state:"",laborType:"",iapName:"",permissions:[]}),[te,Fe]=n.useState({}),H=(a,s,l,c)=>{const i=c?Us(s,c):s;if(l==="create"?g(m=>({...m,[a]:i})):u(m=>({...m,[a]:i})),c){const m=Rs(i,c);Fe(M=>({...M,[`${l}_${a}`]:m.isValid?"":m.message}))}else(a==="name"||a==="fullName")&&(i.length<3?Fe(m=>({...m,[`${l}_${a}`]:"Nome muito curto"})):Fe(m=>({...m,[`${l}_${a}`]:""})))},ya=async(a,s)=>{const l=s.replace(/\D/g,"");if(l.length===8)try{const i=await(await fetch(`https://viacep.com.br/ws/${l}/json/`)).json();i.erro?x({title:"CEP não encontrado",variant:"destructive"}):a==="create"?g(m=>({...m,street:i.logradouro,neighborhood:i.bairro,city:i.localidade,state:i.uf})):u(m=>({...m,street:i.logradouro,neighborhood:i.bairro,city:i.localidade,state:i.uf}))}catch(c){console.error("Erro ao buscar CEP",c)}},[ka,Me]=n.useState(!1),[es,Pe]=n.useState(!1),[Xe,Ca]=n.useState(null),[U,je]=n.useState({zoom:1,x:0,y:0}),[as,Sa]=n.useState(null),Ia=(a,s)=>{var c;const l=(c=a.target.files)==null?void 0:c[0];l&&(Sa(s),Aa(l))},Aa=async a=>{const s=new FileReader;s.onload=async l=>{var i;const c=(i=l.target)==null?void 0:i.result;Ca(c),je({zoom:1,x:0,y:0}),Pe(!0)},s.readAsDataURL(a)},ss=async()=>{if(!Xe)return;const a=new Image;a.onload=()=>{const s=document.createElement("canvas"),l=400;s.width=l,s.height=l;const c=s.getContext("2d");if(!c)return;c.beginPath(),c.arc(l/2,l/2,l/2,0,Math.PI*2),c.clip();const i=Math.min(a.width,a.height),m=a.width/i*l*U.zoom,M=a.height/i*l*U.zoom,le=(l-m)/2+U.x*l/100,_e=(l-M)/2+U.y*l/100;c.fillStyle="#FFFFFF",c.fillRect(0,0,l,l),c.drawImage(a,le,_e,m,M);const fe=s.toDataURL("image/jpeg",.9);as==="create"?g(D=>({...D,image:fe})):u(D=>({...D,image:fe})),Pe(!1),Ca(null),x({title:"Foto aplicada",description:"Avatar configurado."})},a.src=Xe},Te=a=>{a==="create"?g(s=>({...s,image:""})):u(s=>({...s,image:""})),x({title:"Foto removida"})};n.useEffect(()=>{const a=s=>{var c;if(!Ee&&!F)return;const l=(c=s.clipboardData)==null?void 0:c.items;if(l){for(let i=0;i<l.length;i++)if(l[i].type.indexOf("image")!==-1){const m=l[i].getAsFile();if(m){s.preventDefault(),Sa(Ee?"create":"edit");const le=new File([m],"pasted-image.png",{type:m.type});Aa(le),x({title:"Imagem detectada!",description:"Abrindo editor de corte..."})}break}}};return window.addEventListener("paste",a),()=>window.removeEventListener("paste",a)},[Ee,F,x]);const rs=async()=>{if(!A)return;va(!0);const a=await T(A.id,{role:A.role,companyId:w.companyId==="none"?null:w.companyId,projectId:w.projectId==="none"?null:w.projectId,siteId:w.siteId==="none"?null:w.siteId});va(!1),a.success&&(x({title:"Afiliações atualizadas",description:"A empresa, obra e canteiro do usuário foram alterados."}),Ke(null))},Ea=a=>{De(a),u({fullName:a.fullName,email:a.email,password:"",role:a.role,isSystemAdmin:a.isSystemAdmin||!1,companyId:a.companyId||"none",projectId:a.projectId||"none",siteId:a.siteId||"none",registrationNumber:a.registrationNumber||"",image:a.image||"",cpf:a.cpf||"",gender:a.gender||"",birthDate:a.birthDate||"",phone:a.phone||"",cep:a.zipCode||"",street:a.street||"",number:a.number||"",neighborhood:a.neighborhood||"",city:a.city||"",state:a.state||"",laborType:a.laborType||"",iapName:a.iapName||"",permissions:a.permissions||[]}),Fe({})},ts=async()=>{if(!F)return;if(Me(!0),r.password&&r.password.trim().length>0){if(r.password.length<6){x({title:"Senha muito curta",description:"A senha deve ter no mínimo 6 caracteres",variant:"destructive"}),Me(!1);return}const s=await ma(F.id,r.password);if(!s.success){x({title:"Erro ao alterar senha",description:s.error,variant:"destructive"}),Me(!1);return}}const a=await T(F.id,{fullName:r.fullName,email:r.email!==F.email?r.email:void 0,role:r.role,isSystemAdmin:r.isSystemAdmin,permissions:r.permissions,companyId:r.companyId==="none"?null:r.companyId,projectId:r.projectId==="none"?null:r.projectId,siteId:r.siteId==="none"?null:r.siteId,registrationNumber:r.registrationNumber||null,cpf:r.cpf||null,image:r.image||null,phone:r.phone||null,zipCode:r.cep||null,street:r.street||null,number:r.number||null,neighborhood:r.neighborhood||null,city:r.city||null,state:r.state||null,gender:r.gender||null,birthDate:r.birthDate||null,laborType:r.laborType||null,iapName:r.iapName||null},F);Me(!1),a.success?(F.id===(f==null?void 0:f.id)&&await X(),x({title:"Usuário atualizado",description:"As informações do usuário foram alteradas com sucesso."}),De(null)):x({title:"Erro ao atualizar",description:a.error,variant:"destructive"})},ls=async a=>{var l;if(a.preventDefault(),qe(!0),t.password.length<6){x({title:"Senha muito curta",description:"A senha deve ter pelo menos 6 caracteres",variant:"destructive"}),qe(!1);return}const s=await Se(t.email.trim(),t.password,t.name.trim(),t.role,t.companyId||void 0,t.projectId||void 0,t.siteId||void 0,((l=t.registrationNumber)==null?void 0:l.trim())||void 0,t.image||void 0,t.cpf||void 0,t.cep||void 0,t.street||void 0,t.number||void 0,t.neighborhood||void 0,t.city||void 0,t.state||void 0,t.gender||void 0,t.birthDate||void 0,t.phone||void 0,t.laborType||void 0,t.iapName||void 0);qe(!1),s.success?(x({title:"Usuário criado",description:"O novo usuário foi adicionado com sucesso."}),Oe(!1),g({name:"",email:"",password:"",role:"WORKER",companyId:"",projectId:"",siteId:"",registrationNumber:"",image:"",cpf:"",gender:"",birthDate:"",phone:"",cep:"",street:"",number:"",neighborhood:"",city:"",state:"",laborType:"",iapName:""})):x({title:"Erro ao criar usuário",description:s.error,variant:"destructive"})},is=async a=>{$(a.id),await Ka(a.id,!a.isBlocked),$(null)},os=async a=>{$(a.id);const s=await Ya(a.email);$(null),s.success&&x({title:"Email de recuperação enviado",description:`Uma nova senha poderá ser definida pelo usuário ${a.email}.`})},ns=async a=>{$(a.id);const s=await ue(a.id);if($(null),s.success&&(x({title:"Usuário excluído",description:"A conta foi removida do sistema."}),C.has(a.id))){const l=new Set(C);l.delete(a.id),ge(l)}},cs=async()=>{if(C.size===0||!confirm(`Deseja excluir permanentemente os ${C.size} usuários selecionados? Esta ação não pode ser desfeita.`))return;xa(!0);let s=0,l=0;for(const c of Array.from(C))(await ue(c)).success?s++:l++;xa(!1),ge(new Set),x(l===0?{title:"Sucesso",description:`${s} usuários excluídos com sucesso.`}:{title:"Ação Concluída com Alerta",description:`${s} excluídos, ${l} falhas. Verifique as permissões.`,variant:"destructive"})},ds=a=>{const s=Le(a),l=ie(a),c=a.isSystemAdmin===!0,i=[];return i.push(e.jsx(V,{className:I(Je(a.role),"shadow-sm"),children:me(a.role)},"default")),c&&i.push(e.jsxs(V,{className:"bg-sky-500/10 text-sky-500 border-sky-500/10 flex items-center gap-1 px-1.5 py-0 shadow-none",children:[e.jsx(Cs,{className:"w-3 h-3 text-sky-500"}),e.jsx("span",{className:"text-[10px] font-bold tracking-tight",children:"SYSTEM ADMIN"})]},"sysadmin")),l&&!s&&i.push(e.jsxs(V,{className:"bg-teal-500/10 text-teal-500 border-teal-500/10 flex items-center gap-1 px-1.5 py-0 shadow-none",children:[e.jsx(ke,{className:"w-3 h-3 text-teal-500"}),e.jsx("span",{className:"text-[10px] font-bold tracking-tight",children:"GESTÃO GLOBAL"})]},"global")),s&&i.push(e.jsxs(V,{className:"bg-orange-500/10 text-orange-500 border-orange-500/10 flex items-center gap-1 px-1.5 py-0 shadow-[0_0_10px_-4px_rgba(249,115,22,0.4)]",children:[e.jsx(xe,{className:"w-3 h-3 text-orange-500"}),e.jsx("span",{className:"text-[10px] font-bold tracking-tight",children:"ACESSO MESTRE"})]},"master")),e.jsx("div",{className:"flex flex-wrap items-center gap-1.5",children:i})};return b&&ae.length===0?e.jsx(Ss,{isLoading:!0,title:"GESTÃO DE USUÁRIOS",message:ha?"PROCESSANDO ALTERAÇÕES":"SINCRONIZANDO USUÁRIOS",details:[{label:"Usuários",isLoading:b},{label:"Processamento em Massa",isLoading:ha}]}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold gradient-text",children:"Gestão de Usuários"}),e.jsx("p",{className:"text-muted-foreground",children:"Controle quem acessa o painel administrativo"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[Oa("showMaintenance")&&e.jsxs(aa,{children:[e.jsx(Fs,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:"border-orange-500/20 text-orange-500 hover:bg-orange-500/10",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Manutenção de CPFs"]})}),e.jsxs(sa,{children:[e.jsxs(ra,{children:[e.jsxs(ta,{className:"flex items-center gap-2 text-orange-500",children:[e.jsx(Ga,{className:"w-5 h-5"})," Confirmar Manutenção"]}),e.jsxs(la,{children:["Esta ação irá verificar toda a base de dados em busca de CPFs duplicados. Para cada conflito, o registro"," ",e.jsx("strong",{children:"mais antigo"})," será mantido e os mais novos terão seu CPF anulado. Deseja continuar?"]})]}),e.jsxs(ia,{children:[e.jsx(oa,{children:"Cancelar"}),e.jsx(na,{className:"bg-orange-600 hover:bg-orange-700",onClick:async()=>{try{const s=await(await fetch("/api/v1/users/maintenance/deduplicate-cpfs",{method:"POST"})).json();s.success?x({title:"Sucesso",description:s.message,className:"bg-emerald-500/10 border-emerald-500/20 text-emerald-500"}):x({title:"Erro",description:s.error,variant:"destructive"})}catch{x({title:"Erro na conexão",description:"O servidor não respondeu.",variant:"destructive"})}},children:"Executar Limpeza"})]})]})]}),Za&&e.jsxs(e.Fragment,{children:[e.jsxs(p,{className:"gradient-primary shadow-glow",onClick:()=>Oe(!0),children:[e.jsx(qs,{className:"w-4 h-4 mr-2"}),"Novo Usuário"]}),e.jsx(oe,{open:Ee,onOpenChange:Oe,children:e.jsxs(ne,{className:"max-w-2xl bg-black/95 border-white/10 backdrop-blur-xl text-foreground",children:[e.jsxs(we,{children:[e.jsxs(Ne,{className:"flex items-center gap-2",children:[e.jsx(Va,{className:"w-5 h-5 text-primary"}),"Novo Usuário"]}),e.jsx(ve,{children:"Preencha as informações para criar um novo usuário no sistema."})]}),e.jsxs("form",{onSubmit:ls,className:"space-y-6 pt-4",children:[e.jsxs(Ba,{type:"single",collapsible:!0,defaultValue:"access",className:"w-full space-y-2",children:[e.jsxs(R,{value:"identification",className:"border-none",children:[e.jsx(L,{className:"hover:no-underline py-2 px-3 bg-white/5 rounded-lg border border-white/10 hover:bg-white/10 transition-all data-[state=open]:rounded-b-none data-[state=open]:bg-primary/5 data-[state=open]:border-primary/20 group text-[10px] uppercase font-black tracking-widest",children:e.jsxs("div",{className:"flex items-center gap-2 text-primary",children:[e.jsx(ce,{className:"w-4 h-4"}),"Identificação"]})}),e.jsxs(z,{className:"bg-black/20 border-x border-b border-white/10 rounded-b-lg px-4 py-6 -mt-px space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs(Ra,{children:[e.jsx(La,{asChild:!0,children:e.jsxs(Da,{children:[e.jsx(Fa,{asChild:!0,children:e.jsxs("div",{className:"relative group cursor-pointer",children:[e.jsx("div",{className:"w-20 h-20 rounded-full overflow-hidden border-2 border-primary/20 bg-muted flex items-center justify-center transition-all group-hover:border-primary/50 shadow-lg",children:t.image?e.jsx("img",{src:t.image,alt:"Preview",className:"w-full h-full object-cover"}):e.jsx(ce,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded-full",children:e.jsx(Ma,{className:"w-5 h-5 text-white"})})]})}),e.jsxs(Pa,{align:"center",className:"w-48 bg-black/90 backdrop-blur-xl border-primary/20",children:[e.jsxs(Ue,{onClick:()=>{var a;return(a=document.getElementById("create-image-upload"))==null?void 0:a.click()},className:"cursor-pointer gap-2",children:[e.jsx(Be,{className:"w-4 h-4"})," Alterar Foto"]}),t.image&&e.jsxs(Ue,{onClick:()=>Te("create"),className:"cursor-pointer gap-2 text-destructive focus:text-destructive",children:[e.jsx(he,{className:"w-4 h-4"})," ","Remover Foto"]})]})]})}),e.jsxs(za,{className:"w-48 bg-black/90 backdrop-blur-xl border-primary/20",children:[e.jsxs(ze,{onClick:()=>{var a;return(a=document.getElementById("create-image-upload"))==null?void 0:a.click()},className:"cursor-pointer gap-2",children:[e.jsx(Be,{className:"w-4 h-4"})," Alterar Foto"]}),t.image&&e.jsxs(ze,{onClick:()=>Te("create"),className:"cursor-pointer gap-2 text-destructive focus:text-destructive",children:[e.jsx(he,{className:"w-4 h-4"})," Remover Foto"]})]})]}),e.jsx("input",{id:"create-image-upload",type:"file",accept:"image/*",className:"hidden",onChange:a=>Ia(a,"create")}),e.jsx("span",{className:"text-[9px] text-muted-foreground uppercase font-bold tracking-tighter",children:"Clique para Foto"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"name",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Nome Completo *"}),e.jsx(h,{id:"name",placeholder:"Nome do usuário",className:"bg-white/5 border-white/10",value:t.name,onChange:a=>g({...t,name:a.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"registrationNumber",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Matrícula"}),e.jsx(h,{id:"registrationNumber",placeholder:"00000",className:"bg-white/5 border-white/10",value:t.registrationNumber,onChange:a=>g({...t,registrationNumber:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"email",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Email *"}),e.jsx(h,{id:"email",type:"email",placeholder:"email@exemplo.com",className:"bg-white/5 border-white/10",value:t.email,onChange:a=>g({...t,email:a.target.value}),required:!0})]})]})]})]}),e.jsxs(R,{value:"access",className:"border-none",children:[e.jsx(L,{className:"hover:no-underline py-2 px-3 bg-white/5 rounded-lg border border-white/10 hover:bg-white/10 transition-all data-[state=open]:rounded-b-none data-[state=open]:bg-amber-500/5 data-[state=open]:border-amber-500/20 group text-[10px] uppercase font-black tracking-widest",children:e.jsxs("div",{className:"flex items-center gap-2 text-amber-500",children:[e.jsx(de,{className:"w-4 h-4"}),"Acesso & Segurança"]})}),e.jsxs(z,{className:"bg-black/20 border-x border-b border-white/10 rounded-b-lg px-4 py-6 -mt-px space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"password",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Senha Temporária *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{id:"password",type:"password",placeholder:"Senha inicial",className:"industrial-input center-text",value:t.password,onChange:a=>g({...t,password:a.target.value}),required:!0,autoComplete:"new-password"}),e.jsxs(Ta,{children:[e.jsx(_a,{asChild:!0,children:e.jsx(p,{type:"button",variant:"outline",className:"industrial-input px-3",children:e.jsx(de,{className:"w-4 h-4"})})}),e.jsx(Ua,{className:"w-80 p-0 border-none bg-transparent",align:"end",children:e.jsx(qa,{onSave:async a=>{g(s=>({...s,password:a})),x({title:"Senha Gerada",description:"Senha aplicada ao formulário."})}})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"role",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Nível de Acesso"}),e.jsxs(N,{value:t.role,onValueChange:a=>g({...t,role:a,projectId:"",siteId:""}),children:[e.jsx(v,{className:"bg-white/5 border-white/10",children:e.jsx(y,{})}),e.jsx(k,{className:"glass-card border-white/10",children:K.map(a=>e.jsx(d,{value:a.name.toUpperCase(),disabled:a.name==="HELPER_SYSTEM",className:a.name==="HELPER_SYSTEM"?"line-through opacity-50":"",children:me(a.name)},a.name))})]})]})]})]}),(f==null?void 0:f.role)&&ie(f)&&e.jsxs(R,{value:"permissions",className:"border-slate-700",children:[e.jsx(L,{className:"text-slate-300 hover:text-amber-500",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4"}),"Permissões Individuais"]})}),e.jsx(z,{className:"pt-4 space-y-6",children:Object.values(Qs).map((a,s)=>e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-400 border-b border-slate-700 pb-1",children:a.label}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:a.permissions.map(l=>e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Z,{id:`perm-${l.code}`,checked:r.permissions.includes(l.code),onCheckedChange:c=>{u(i=>{const m=c?[...i.permissions,l.code]:i.permissions.filter(M=>M!==l.code);return{...i,permissions:m}})},className:"mt-0.5 border-slate-600 data-[state=checked]:bg-amber-500 data-[state=checked]:border-amber-500"}),e.jsx(o,{htmlFor:`perm-${l.code}`,className:"text-sm text-slate-300 font-normal cursor-pointer leading-tight",children:l.label})]},l.code))})]},s))})]}),!pe(t.role,t)&&e.jsxs(R,{value:"affiliation",className:"border-none",children:[e.jsx(L,{className:"hover:no-underline py-2 px-3 bg-white/5 rounded-lg border border-white/10 hover:bg-white/10 transition-all data-[state=open]:rounded-b-none data-[state=open]:bg-sky-500/5 data-[state=open]:border-sky-500/20 group text-[10px] uppercase font-black tracking-widest",children:e.jsxs("div",{className:"flex items-center gap-2 text-sky-500",children:[e.jsx(Re,{className:"w-4 h-4"}),"Afiliação & Contexto"]})}),e.jsxs(z,{className:"bg-black/20 border-x border-b border-white/10 rounded-b-lg px-4 py-6 -mt-px space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"company",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Empresa Afiliada"}),e.jsxs(N,{value:t.companyId||"none",onValueChange:a=>g({...t,companyId:a==="none"?"":a,projectId:"",siteId:""}),children:[e.jsx(v,{className:"bg-white/5 border-white/10",children:e.jsx(y,{placeholder:"Selecione..."})}),e.jsxs(k,{className:"glass-card border-white/10",children:[e.jsx(d,{value:"none",children:"Nenhuma Empresa"}),Ie.map(a=>e.jsx(d,{value:a.id,children:a.name},a.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"project",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Vincular Obra"}),e.jsxs(N,{value:t.projectId||"none",onValueChange:a=>g({...t,projectId:a==="none"?"":a,siteId:""}),children:[e.jsx(v,{className:"bg-white/5 border-white/10",children:e.jsx(y,{placeholder:"Selecione a obra..."})}),e.jsxs(k,{className:"glass-card border-white/10",children:[e.jsx(d,{value:"none",children:"Nenhuma Obra"}),_.filter(a=>!t.companyId||a.companyId===t.companyId).map(a=>e.jsx(d,{value:a.id,children:a.name},a.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"site",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Vincular Canteiro"}),e.jsxs(N,{value:t.siteId||"none",onValueChange:a=>g({...t,siteId:a==="none"?"":a}),children:[e.jsx(v,{className:"bg-white/5 border-white/10",children:e.jsx(y,{placeholder:"Selecione o canteiro..."})}),e.jsxs(k,{className:"glass-card border-white/10",children:[e.jsx(d,{value:"none",children:"Nenhum Canteiro"}),Ae.filter(a=>{if(!t.companyId)return!0;const s=_.find(l=>l.id===a.projectId);return(s==null?void 0:s.companyId)===t.companyId}).map(a=>e.jsxs(d,{value:a.id,children:[a.name," (",ca(a.projectId,_),")"]},a.id))]})]})]}),e.jsxs("div",{className:"relative pt-4 pb-2",children:[e.jsx("div",{className:"absolute inset-0 flex items-center","aria-hidden":"true",children:e.jsx("div",{className:"w-full border-t border-white/10"})}),e.jsx("div",{className:"relative flex justify-center",children:e.jsx("span",{className:"bg-background px-2 text-[9px] font-black uppercase tracking-widest text-muted-foreground",children:"Detalhes Operacionais"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Mão de Obra"}),e.jsxs(N,{value:t.laborType,onValueChange:a=>g({...t,laborType:a}),children:[e.jsx(v,{className:"bg-white/5 border-white/10",children:e.jsx(y,{placeholder:"Selecione..."})}),e.jsxs(k,{className:"glass-card border-white/10",children:[e.jsx(d,{value:"MOD",children:"Mão de Obra Direta"}),e.jsx(d,{value:"MOI",children:"Mão de Obra Indireta"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"IAP"}),e.jsxs(N,{value:t.iapName,onValueChange:a=>g({...t,iapName:a}),children:[e.jsx(v,{className:"bg-white/5 border-white/10",children:e.jsx(y,{placeholder:"Selecione..."})}),e.jsx(k,{className:"glass-card border-white/10",children:B.map(a=>e.jsx(d,{value:String(a.iap),children:Number(a.iap).toFixed(4)},a.id))})]})]})]})]})]}),e.jsxs(R,{value:"personal",className:"border-none",children:[e.jsx(L,{className:"hover:no-underline py-2 px-3 bg-white/5 rounded-lg border border-white/10 hover:bg-white/10 transition-all data-[state=open]:rounded-b-none data-[state=open]:bg-emerald-500/5 data-[state=open]:border-emerald-500/20 group text-[10px] uppercase font-black tracking-widest",children:e.jsxs("div",{className:"flex items-center gap-2 text-emerald-500",children:[e.jsx(xe,{className:"w-4 h-4"}),"Dados Pessoais"]})}),e.jsxs(z,{className:"bg-black/20 border-x border-b border-white/10 rounded-b-lg px-4 py-6 -mt-px space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"cpf",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"CPF"}),e.jsx(h,{id:"cpf",placeholder:"000.000.000-00",className:"bg-white/5 border-white/10",value:t.cpf,onChange:a=>H("cpf",a.target.value,"create","cpf")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"birthDate",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Data de Nascimento"}),e.jsx(h,{id:"birthDate",type:"text",className:"bg-white/5 border-white/10",value:t.birthDate,onChange:a=>H("birthDate",a.target.value,"create","date"),placeholder:"DD/MM/AAAA"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"create-phone",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Telefone / Celular"}),e.jsx(h,{id:"create-phone",className:"bg-white/5 border-white/10",value:t.phone,onChange:a=>H("phone",a.target.value,"create","phone"),placeholder:"(00) 00000-0000"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"create-gender",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Gênero"}),e.jsxs(N,{value:t.gender,onValueChange:a=>g({...t,gender:a}),children:[e.jsx(v,{className:"bg-white/5 border-white/10",children:e.jsx(y,{placeholder:"Selecione..."})}),e.jsxs(k,{className:"glass-card border-white/10",children:[e.jsx(d,{value:"MALE",children:"Masculino"}),e.jsx(d,{value:"FEMALE",children:"Feminino"}),e.jsx(d,{value:"OTHER",children:"Outro"})]})]})]})]}),e.jsx("div",{className:"h-px bg-white/10 my-2"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2 col-span-1",children:[e.jsx(o,{htmlFor:"create-cep",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"CEP"}),e.jsx(h,{id:"create-cep",className:"bg-white/5 border-white/10",value:t.cep,onChange:a=>H("cep",a.target.value,"create","cep"),onBlur:a=>ya("create",a.target.value),placeholder:"00000-000"})]}),e.jsxs("div",{className:"space-y-2 col-span-2",children:[e.jsx(o,{htmlFor:"create-street",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Rua / Logradouro"}),e.jsx(h,{id:"create-street",className:"bg-white/5 border-white/10",value:t.street,onChange:a=>g({...t,street:a.target.value}),placeholder:"Rua..."})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2 col-span-1",children:[e.jsx(o,{htmlFor:"create-number",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Número"}),e.jsx(h,{id:"create-number",className:"bg-white/5 border-white/10",value:t.number,onChange:a=>g({...t,number:a.target.value}),placeholder:"Nº"})]}),e.jsxs("div",{className:"space-y-2 col-span-3",children:[e.jsx(o,{htmlFor:"create-neighborhood",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Bairro"}),e.jsx(h,{id:"create-neighborhood",className:"bg-white/5 border-white/10",value:t.neighborhood,onChange:a=>g({...t,neighborhood:a.target.value}),placeholder:"Bairro"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2 col-span-3",children:[e.jsx(o,{htmlFor:"create-city",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Cidade"}),e.jsx(h,{id:"create-city",className:"bg-white/5 border-white/10",value:t.city,onChange:a=>g({...t,city:a.target.value}),placeholder:"Cidade"})]}),e.jsxs("div",{className:"space-y-2 col-span-1",children:[e.jsx(o,{htmlFor:"create-state",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"UF"}),e.jsx(h,{id:"create-state",className:"bg-white/5 border-white/10",value:t.state,onChange:a=>g({...t,state:a.target.value.toUpperCase().slice(0,2)}),placeholder:"UF"})]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(p,{type:"button",variant:"ghost",onClick:()=>Oe(!1),disabled:He,children:"Cancelar"}),e.jsxs(p,{type:"submit",className:"gradient-primary",disabled:He,children:[He?e.jsx(ye,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(Va,{className:"w-4 h-4 mr-2"}),"Criar Usuário"]})]})]})]})})]})]})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4 justify-between",children:[e.jsx("div",{className:"relative flex-1",children:e.jsxs(Ta,{open:ua,onOpenChange:Ge,children:[e.jsx(_a,{asChild:!0,children:e.jsxs(p,{variant:"outline",role:"combobox","aria-expanded":ua,className:"w-full justify-start text-left font-normal pl-10 industrial-input border-white/10 bg-black/40 hover:bg-white/5 hover:text-white relative h-12",children:[e.jsx($a,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),O||e.jsx("span",{className:"text-muted-foreground",children:"Buscar por nome, email ou matrícula..."})]})}),e.jsx(Ua,{className:"w-[var(--radix-popover-trigger-width)] p-0 border-white/10 bg-black/95 backdrop-blur-2xl",align:"start",children:e.jsxs(zs,{shouldFilter:!1,children:[e.jsx(Bs,{placeholder:"Digite para buscar...",value:O,onValueChange:Q,className:"border-none focus:ring-0 h-12"}),e.jsxs(Gs,{children:[e.jsx(Vs,{children:b?e.jsxs("div",{className:"flex items-center justify-center p-4 text-muted-foreground",children:[e.jsx(ye,{className:"w-5 h-5 animate-spin mr-3"}),"Buscando na Base Orion..."]}):"Nenhum usuário encontrado."}),e.jsx($s,{heading:O?"Busca Global":"Sugestões Recentes",children:(O?G:be.slice(0,10)).map(a=>e.jsx(Hs,{value:a.fullName+" "+a.email,onSelect:()=>{Ea(a),Ge(!1)},className:"cursor-pointer aria-selected:bg-primary/10 p-3",children:e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-bold text-sm",children:a.fullName}),e.jsx(V,{variant:"outline",className:I("text-[9px] h-4",Je(a.role)),children:me(a.role)})]}),e.jsx("span",{className:"text-xs text-muted-foreground opacity-60",children:a.email})]})},a.id))})]})]})})]})}),e.jsxs(p,{variant:"outline",className:I("h-12 px-6 border-white/10 bg-black/40 hover:bg-white/5 transition-all",C.size>0&&"border-primary/50 text-primary bg-primary/5"),onClick:Xa,children:[C.size===G.length&&G.length>0?e.jsx(js,{className:"w-5 h-5 mr-2"}):e.jsx(Ws,{className:"w-5 h-5 mr-2"}),e.jsx("span",{className:"font-bold",children:C.size===G.length&&G.length>0?"Desmarcar Todos":"Selecionar Tudo"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 p-1 bg-black/40 border border-white/10 rounded-xl backdrop-blur-md",children:[e.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>J("all_combined"),className:I("h-9 px-4 rounded-lg font-bold text-[11px] uppercase tracking-wider transition-all duration-300",P==="all_combined"?"bg-primary text-primary-foreground shadow-glow":"text-muted-foreground hover:bg-white/5"),children:[e.jsx(ce,{className:"w-3.5 h-3.5 mr-2"}),"Geral"]}),e.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>J("app_management"),className:I("h-9 px-4 rounded-lg font-bold text-[11px] uppercase tracking-wider transition-all duration-300",P==="app_management"?"bg-amber-500 text-white shadow-[0_0_15px_-3px_rgba(245,158,11,0.5)]":"text-muted-foreground hover:bg-white/5"),children:[e.jsx(ke,{className:"w-3.5 h-3.5 mr-2"}),"Gestão do App"]}),e.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>{J("search"),O||Ge(!0)},className:I("h-9 px-4 rounded-lg font-bold text-[11px] uppercase tracking-wider transition-all duration-300",P==="search"?"bg-blue-500 text-white shadow-[0_0_15px_-3px_rgba(59,130,246,0.5)]":"text-muted-foreground hover:bg-white/5"),children:[e.jsx($a,{className:"w-3.5 h-3.5 mr-2"}),"Resultado de Busca"]})]}),e.jsx("div",{className:"h-6 w-px bg-white/10 mx-1 hidden sm:block"}),e.jsxs(N,{value:Y,onValueChange:a=>j(a),children:[e.jsx(v,{className:"w-[180px] h-9 industrial-input bg-black/40 border-white/10 data-[state=open]:border-primary/50 transition-colors text-[11px] font-bold uppercase tracking-wider",children:e.jsx(y,{placeholder:"Tipo de Usuário"})}),e.jsxs(k,{className:"glass-card border-white/10 bg-black/95",children:[e.jsx(d,{value:"all",className:"focus:bg-primary/20 focus:text-primary cursor-pointer font-bold text-[10px] uppercase tracking-wider",children:"Todos os Cargos"}),e.jsx(d,{value:"corporate",className:"focus:bg-primary/20 focus:text-primary cursor-pointer font-bold text-[10px] uppercase tracking-wider",children:"Corporativo"}),e.jsx(d,{value:"external",className:"focus:bg-primary/20 focus:text-primary cursor-pointer font-bold text-[10px] uppercase tracking-wider",children:"Canteiro / Obra"})]})]}),e.jsxs("div",{className:"text-sm font-medium text-muted-foreground/60 px-2 flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-primary animate-pulse"}),be.length," ",be.length===1?"usuário":"usuários"]}),C.size>0&&ga&&e.jsxs(p,{variant:"ghost",className:"h-11 text-destructive hover:bg-destructive/10 animate-in fade-in zoom-in duration-300",onClick:cs,children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Excluir Selecionados (",C.size,")"]})]})]}),e.jsx("div",{className:"grid gap-4",children:G.map(a=>{var s,l,c;return q("users.manage"),e.jsxs(Es,{className:I("glass-card hover-lift transition-all duration-500 group overflow-hidden border-white/5 relative bg-white/2 backdrop-blur-xl",a.isBlocked&&"opacity-60 grayscale-[0.3] border-destructive/10"),children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-primary/5 rounded-full -mr-32 -mt-32 blur-[80px] group-hover:bg-primary/10 transition-colors duration-700 pointer-events-none"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-accent/5 rounded-full -ml-24 -mb-24 blur-[60px] group-hover:bg-accent/10 transition-colors duration-700 pointer-events-none"}),e.jsx(Os,{className:"pb-3 px-6 relative z-10 transition-transform duration-500",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"relative",children:e.jsx(Z,{checked:C.has(a.id),onCheckedChange:()=>ja(a.id),className:"border-white/20 data-[state=checked]:bg-primary data-[state=checked]:border-primary"})}),e.jsxs("div",{className:I("w-14 h-14 rounded-full border-2 flex items-center justify-center text-xl font-bold shrink-0 relative overflow-hidden transition-all duration-500",C.has(a.id)?"border-primary bg-primary/10 shadow-[0_0_20px_-5px_rgba(var(--primary),0.5)] scale-105":"border-white/5 bg-muted/40 group-hover:border-primary/40 group-hover:scale-105"),onClick:()=>ja(a.id),children:[a.image?e.jsx("img",{src:a.image,alt:a.fullName,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"}):e.jsx("span",{className:"bg-linear-to-br from-white/20 to-transparent w-full h-full flex items-center justify-center",children:(a.fullName||"U").charAt(0).toUpperCase()}),C.has(a.id)&&e.jsx("div",{className:"absolute inset-0 bg-primary/30 flex items-center justify-center backdrop-blur-[1px] animate-in fade-in duration-300",children:e.jsx(fs,{className:"w-7 h-7 text-primary drop-shadow-[0_0_8px_rgba(255,255,255,0.4)]",strokeWidth:3})})]})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs(Ds,{className:"text-lg flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:I("truncate transition-all duration-500",Le(a)&&"text-[#ea580c] font-black drop-shadow-[0_0_12px_rgba(234,88,12,0.5)] scale-[1.02] origin-left",ie(a)&&!Le(a)&&"text-yellow-500 font-extrabold drop-shadow-[0_0_8px_rgba(234,179,8,0.3)]",(a.role==="TI_SOFTWARE"||a.role==="TISOFTWARE")&&"text-purple-500 font-bold font-mono",ea(a)&&!Le(a)&&"text-orange-400 font-extrabold"),children:a.fullName}),ds(a),a.isBlocked&&e.jsx(V,{variant:"destructive",className:"animate-pulse shadow-[0_0_10px_rgba(239,68,68,0.3)]",children:"BLOQUEADO"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 mt-1",children:[e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(ws,{className:"w-3.5 h-3.5"}),a.email]}),e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1 group/global",children:[e.jsx(Re,{className:"w-3.5 h-3.5"}),ie(a)?e.jsxs("span",{className:"flex items-center gap-1.5 transition-all duration-300",children:[e.jsx(ke,{className:"w-3 h-3 text-emerald-500 animate-pulse"}),e.jsx("span",{className:"text-emerald-500 font-bold tracking-tight",children:"Gestão Global"})]}):e.jsx("span",{className:"opacity-70 group-hover/global:opacity-100 transition-opacity",children:((s=Ie.find(i=>i.id===a.companyId))==null?void 0:s.name)||"Sem Empresa"})]}),(a.laborType||a.iapName)&&e.jsxs("div",{className:"flex items-center gap-2",children:[a.laborType&&e.jsx(V,{variant:"outline",className:"text-[10px] h-4 bg-muted/20 border-white/5 text-muted-foreground",children:a.laborType}),a.iapName&&e.jsxs(V,{variant:"outline",className:"text-[10px] h-4 bg-amber-500/5 border-amber-500/20 text-amber-500/80",children:["IAP: ",Number(a.iapName).toFixed(4)]})]}),!pe(a.role,a)&&e.jsxs(e.Fragment,{children:[a.projectId&&e.jsxs("span",{className:"text-xs text-primary flex items-center gap-1",children:[e.jsx(Ns,{className:"w-3.5 h-3.5"}),(l=_.find(i=>i.id===a.projectId))==null?void 0:l.name]}),a.siteId&&e.jsxs("span",{className:"text-xs text-orange-500 flex items-center gap-1",children:[e.jsx(vs,{className:"w-3.5 h-3.5"}),(c=Ae.find(i=>i.id===a.siteId))==null?void 0:c.name]}),a.registrationNumber&&e.jsxs(V,{variant:"outline",className:"text-[10px] h-4 bg-primary/5 border-primary/20 text-primary",children:["MAT: ",a.registrationNumber]})]})]})]})]}),e.jsx("div",{className:"flex flex-col sm:items-end gap-2 shrink-0",children:e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[Ve&&e.jsx(p,{variant:"outline",size:"icon",className:"h-8 w-8 shrink-0 border-white/10 hover:bg-white/5",onClick:()=>Ea(a),title:"Editar Dados",children:e.jsx(Ys,{className:"w-3.5 h-3.5"})}),Ve&&e.jsx(p,{variant:"outline",size:"icon",className:"h-8 w-8 shrink-0 border-white/10 hover:bg-primary/10",onClick:()=>Ye(a),title:"Alterar Senha",children:e.jsx(de,{className:"w-3.5 h-3.5 text-primary"})}),Ve&&e.jsx(p,{variant:"outline",size:"icon",className:I("h-8 w-8 shrink-0 border-white/10",a.isBlocked?"hover:bg-emerald-500/10":"hover:bg-red-500/10"),onClick:()=>is(a),disabled:pa===a.id,title:a.isBlocked?"Desbloquear":"Bloquear",children:a.isBlocked?e.jsx(xe,{className:"w-3.5 h-3.5 text-emerald-500"}):e.jsx(Xs,{className:"w-3.5 h-3.5 text-red-400"})}),ga&&!ea(a)&&e.jsx(p,{variant:"outline",size:"icon",className:"h-8 w-8 shrink-0 border-white/10 hover:bg-destructive/10",onClick:()=>fa(a),title:"Excluir Conta",children:e.jsx(he,{className:"w-3.5 h-3.5 text-destructive"})})]}),ea(a)&&e.jsx("div",{className:"flex items-center justify-center h-8 w-8",title:"Usuário Protegido",children:e.jsx(xe,{className:"w-5 h-5 text-orange-500 animate-pulse"})})]})})]})})]},a.id)})}),e.jsx(oe,{open:!!A,onOpenChange:()=>Ke(null),children:e.jsxs(ne,{className:"max-w-md bg-black/60 border-white/5 backdrop-blur-2xl rounded-3xl shadow-2xl animate-in fade-in zoom-in duration-300",children:[e.jsxs(we,{children:[e.jsxs(Ne,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5 text-primary"})," Editar Afiliações"]}),e.jsxs(ve,{children:["Gerencie a empresa, obra e canteiro vinculados ao usuário"," ",e.jsx("strong",{children:A==null?void 0:A.fullName}),"."]})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[!pe(A==null?void 0:A.role)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Empresa Afiliada"}),e.jsxs(N,{value:w.companyId,onValueChange:a=>Ze({...w,companyId:a,projectId:"",siteId:""}),children:[e.jsx(v,{className:"bg-white/5 border-white/10",children:e.jsx(y,{placeholder:"Selecione..."})}),e.jsxs(k,{children:[e.jsx(d,{value:"none",children:"Nenhuma Empresa"}),Ie.map(a=>e.jsx(d,{value:a.id,children:a.name},a.id))]})]})]}),!pe(A==null?void 0:A.role,A)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2 animate-in slide-in-from-top-2",children:[e.jsx(o,{children:"Obra Vinculada"}),e.jsxs(N,{value:w.projectId,onValueChange:a=>Ze({...w,projectId:a,siteId:""}),children:[e.jsx(v,{className:"bg-white/5 border-white/10",children:e.jsx(y,{placeholder:"Selecione a obra..."})}),e.jsxs(k,{children:[e.jsx(d,{value:"none",children:"Nenhuma Obra"}),_.filter(a=>!w.companyId||w.companyId==="none"||a.companyId===w.companyId).map(a=>e.jsx(d,{value:a.id,children:a.name},a.id))]})]})]}),e.jsxs("div",{className:"space-y-2 animate-in slide-in-from-top-2",children:[e.jsx(o,{children:"Canteiro Vinculado"}),e.jsxs(N,{value:w.siteId,onValueChange:a=>Ze({...w,siteId:a}),children:[e.jsx(v,{className:"bg-white/5 border-white/10",children:e.jsx(y,{placeholder:"Selecione o canteiro..."})}),e.jsxs(k,{children:[e.jsx(d,{value:"none",children:"Nenhum Canteiro"}),Ae.filter(a=>{if(!w.companyId||w.companyId==="none")return!0;const s=_.find(l=>l.id===a.projectId);return(s==null?void 0:s.companyId)===w.companyId}).map(a=>e.jsxs(d,{value:a.id,children:[a.name," (",ca(a.projectId,_),")"]},a.id))]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-white/10 mt-4",children:[e.jsx(p,{variant:"ghost",onClick:()=>Ke(null),children:"Cancelar"}),e.jsxs(p,{className:"gradient-primary",onClick:rs,disabled:Na,children:[Na&&e.jsx(ye,{className:"w-4 h-4 mr-2 animate-spin"}),"Salvar Alterações"]})]})]})]})}),e.jsx(oe,{open:!!F,onOpenChange:()=>De(null),children:e.jsxs(ne,{className:"max-w-3xl bg-black/60 border-white/5 backdrop-blur-3xl rounded-3xl shadow-2xl max-h-[90vh] overflow-y-auto animate-in fade-in zoom-in duration-300",children:[e.jsxs(we,{children:[e.jsxs(Ne,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5 text-primary"})," Editar Usuário"]}),e.jsxs(ve,{children:["Edite todas as informações do usuário"," ",e.jsx("strong",{children:F==null?void 0:F.fullName}),"."]})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs(Ba,{type:"single",collapsible:!0,defaultValue:"identification",className:"w-full space-y-2",children:[e.jsxs(R,{value:"identification",className:"border-none",children:[e.jsx(L,{className:"hover:no-underline py-3 px-4 bg-white/5 rounded-2xl border border-white/5 hover:bg-white/10 transition-all data-[state=open]:rounded-b-none data-[state=open]:bg-primary/5 data-[state=open]:border-primary/20 group text-[10px] uppercase font-bold tracking-widest",children:e.jsxs("div",{className:"flex items-center gap-2 text-primary",children:[e.jsx(ce,{className:"w-4 h-4"}),"Identificação (Login)"]})}),e.jsxs(z,{className:"bg-black/10 border-x border-b border-white/5 rounded-b-2xl px-6 py-8 -mt-px space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs(Ra,{children:[e.jsx(La,{asChild:!0,children:e.jsxs(Da,{children:[e.jsx(Fa,{asChild:!0,children:e.jsxs("div",{className:"relative group cursor-pointer",children:[e.jsx("div",{className:"w-20 h-20 rounded-full overflow-hidden border-2 border-primary/20 bg-muted flex items-center justify-center transition-all group-hover:border-primary/50 shadow-lg",children:r.image?e.jsx("img",{src:r.image,alt:"Preview",className:"w-full h-full object-cover"}):e.jsx(ce,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded-full",children:e.jsx(Ma,{className:"w-5 h-5 text-white"})})]})}),e.jsxs(Pa,{align:"center",className:"w-48 bg-black/90 backdrop-blur-xl border-primary/20",children:[e.jsxs(Ue,{onClick:()=>{var a;return(a=document.getElementById("edit-image-upload"))==null?void 0:a.click()},className:"cursor-pointer gap-2",children:[e.jsx(Be,{className:"w-4 h-4"})," Alterar Foto"]}),r.image&&e.jsxs(Ue,{onClick:()=>Te("edit"),className:"cursor-pointer gap-2 text-destructive focus:text-destructive",children:[e.jsx(he,{className:"w-4 h-4"})," Remover Foto"]})]})]})}),e.jsxs(za,{className:"w-48 bg-black/90 backdrop-blur-xl border-primary/20",children:[e.jsxs(ze,{onClick:()=>{var a;return(a=document.getElementById("edit-image-upload"))==null?void 0:a.click()},className:"cursor-pointer gap-2",children:[e.jsx(Be,{className:"w-4 h-4"})," Alterar Foto"]}),r.image&&e.jsxs(ze,{onClick:()=>Te("edit"),className:"cursor-pointer gap-2 text-destructive focus:text-destructive",children:[e.jsx(he,{className:"w-4 h-4"})," Remover Foto"]})]})]}),e.jsx("input",{id:"edit-image-upload",type:"file",accept:"image/*",className:"hidden",onChange:a=>Ia(a,"edit")}),e.jsx("span",{className:"text-[9px] text-muted-foreground uppercase font-bold tracking-tighter",children:"Clique para Foto"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"edit-name",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Nome Completo *"}),e.jsx(h,{id:"edit-name",value:r.fullName,onChange:a=>u({...r,fullName:a.target.value}),className:"bg-white/5 border-white/10",placeholder:"Nome do usuário"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"edit-email",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Email (Login) *"}),e.jsx(h,{id:"edit-email",type:"email",value:r.email,onChange:a=>u({...r,email:a.target.value}),className:"bg-white/5 border-white/10",placeholder:"email@exemplo.com"})]}),!ee&&!pe(r.role,r)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"edit-registration",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Matrícula (Login alternativo)"}),e.jsx(h,{id:"edit-registration",placeholder:"Ex: 100200",className:"bg-white/5 border-white/10",value:r.registrationNumber,onChange:a=>u({...r,registrationNumber:a.target.value})})]})]})]})]}),ee&&e.jsxs(R,{value:"security",className:"border-none",children:[e.jsx(L,{className:"hover:no-underline py-2 px-3 bg-white/5 rounded-lg border border-white/10 hover:bg-white/10 transition-all data-[state=open]:rounded-b-none data-[state=open]:bg-red-500/5 data-[state=open]:border-red-500/20 group text-[10px] uppercase font-black tracking-widest",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[e.jsx(de,{className:"w-4 h-4"}),"Segurança (Senha)"]})}),e.jsx(z,{className:"bg-black/20 border-x border-b border-white/10 rounded-b-lg px-4 py-6 -mt-px space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"edit-password",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Nova Senha (Opcional)"}),e.jsx(h,{id:"edit-password",type:"text",value:r.password,onChange:a=>u({...r,password:a.target.value}),className:"bg-white/5 border-white/10",placeholder:"Deixe em branco para não alterar",autoComplete:"new-password"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Digite para redefinir a senha deste administrador."})]})})]}),e.jsxs(R,{value:"access",className:"border-none",children:[e.jsx(L,{className:"hover:no-underline py-2 px-3 bg-white/5 rounded-lg border border-white/10 hover:bg-white/10 transition-all data-[state=open]:rounded-b-none data-[state=open]:bg-primary/5 data-[state=open]:border-primary/20 group text-[10px] uppercase font-black tracking-widest",children:e.jsxs("div",{className:"flex items-center gap-2 text-primary",children:[e.jsx(de,{className:"w-4 h-4"}),"Acesso & Segurança"]})}),e.jsxs(z,{className:"bg-black/20 border-x border-b border-white/10 rounded-b-lg px-4 py-6 -mt-px space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Nível de Acesso"}),e.jsxs(N,{value:r.role,onValueChange:a=>u({...r,role:a,projectId:"none",siteId:"none"}),children:[e.jsx(v,{className:"bg-white/5 border-white/10",children:e.jsx(y,{})}),e.jsx(k,{className:"glass-card border-white/10",children:K.map(a=>e.jsx(d,{value:a.name.toUpperCase(),disabled:a.name==="HELPER_SYSTEM",className:a.name==="HELPER_SYSTEM"?" text-center line-through opacity-50 ":" text-center",children:me(a.name)},a.name))})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[e.jsx(Z,{id:"is-system-admin",checked:r.isSystemAdmin,onCheckedChange:a=>u({...r,isSystemAdmin:a===!0}),className:"data-[state=checked]:bg-primary data-[state=checked]:border-primary"}),e.jsxs("div",{className:"grid gap-1.5 leading-none",children:[e.jsx(o,{htmlFor:"is-system-admin",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest cursor-pointer",children:"Administrador do Sistema (System Admin)"}),e.jsxs("p",{className:"text-[10px] text-muted-foreground/70",children:["Concede acesso completo a todos os dados e configurações do sistema.",e.jsx("span",{className:"text-red-400 font-bold ml-1",children:"Cuidado!"})]})]})]})]})]}),!ee&&!pe(r.role,r)&&e.jsxs(R,{value:"affiliation",className:"border-none",children:[e.jsx(L,{className:"hover:no-underline py-3 px-4 bg-white/5 rounded-2xl border border-white/5 hover:bg-white/10 transition-all data-[state=open]:rounded-b-none data-[state=open]:bg-sky-500/5 data-[state=open]:border-sky-500/20 group text-[10px] uppercase font-bold tracking-widest",children:e.jsxs("div",{className:"flex items-center gap-2 text-sky-500",children:[e.jsx(Re,{className:"w-4 h-4"}),"Afiliação & Contexto"]})}),e.jsxs(z,{className:"bg-black/10 border-x border-b border-white/5 rounded-b-2xl px-6 py-8 -mt-px space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Empresa Afiliada"}),e.jsxs(N,{value:r.companyId,onValueChange:a=>u({...r,companyId:a,projectId:"none",siteId:"none"}),children:[e.jsx(v,{className:"bg-white/5 border-white/10",children:e.jsx(y,{placeholder:"Selecione..."})}),e.jsxs(k,{className:"glass-card border-white/10",children:[e.jsx(d,{value:"none",children:"Nenhuma Empresa"}),Ie.map(a=>e.jsx(d,{value:a.id,children:a.name},a.id))]})]})]}),e.jsxs("div",{className:"space-y-2 animate-in slide-in-from-top-2",children:[e.jsx(o,{className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Obra Vinculada"}),e.jsxs(N,{value:r.projectId,onValueChange:a=>u({...r,projectId:a,siteId:"none"}),children:[e.jsx(v,{className:"bg-white/5 border-white/10",children:e.jsx(y,{placeholder:"Selecione a obra..."})}),e.jsxs(k,{className:"glass-card border-white/10",children:[e.jsx(d,{value:"none",children:"Nenhuma Obra"}),_.filter(a=>!r.companyId||r.companyId==="none"||a.companyId===r.companyId).map(a=>e.jsx(d,{value:a.id,children:a.name},a.id))]})]})]}),e.jsxs("div",{className:"space-y-2 animate-in slide-in-from-top-2",children:[e.jsx(o,{className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Canteiro Vinculado"}),e.jsxs(N,{value:r.siteId,onValueChange:a=>u({...r,siteId:a}),children:[e.jsx(v,{className:"bg-white/5 border-white/10",children:e.jsx(y,{placeholder:"Selecione o canteiro..."})}),e.jsxs(k,{className:"glass-card border-white/10",children:[e.jsx(d,{value:"none",children:"Nenhum Canteiro"}),Ae.filter(a=>{if(!r.companyId||r.companyId==="none")return!0;const s=_.find(l=>l.id===a.projectId);return(s==null?void 0:s.companyId)===(r.companyId==="none"?null:r.companyId)}).map(a=>e.jsxs(d,{value:a.id,children:[a.name," (",ca(a.projectId,_),")"]},a.id))]})]})]}),e.jsxs("div",{className:"relative pt-4 pb-2",children:[e.jsx("div",{className:"absolute inset-0 flex items-center","aria-hidden":"true",children:e.jsx("div",{className:"w-full border-t border-white/10"})}),e.jsx("div",{className:"relative flex justify-center",children:e.jsx("span",{className:"bg-background px-2 text-[9px] font-black uppercase tracking-widest text-muted-foreground",children:"Detalhes Operacionais"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Mão de Obra"}),e.jsxs(N,{value:r.laborType,onValueChange:a=>u({...r,laborType:a}),children:[e.jsx(v,{className:"bg-white/5 border-white/10",children:e.jsx(y,{placeholder:"Selecione..."})}),e.jsxs(k,{className:"glass-card border-white/10",children:[e.jsx(d,{value:"MOD",children:"Mão de Obra Direta"}),e.jsx(d,{value:"MOI",children:"Mão de Obra Indireta"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"IAP"}),e.jsxs(N,{value:r.iapName,onValueChange:a=>u({...r,iapName:a}),children:[e.jsx(v,{className:"bg-white/5 border-white/10",children:e.jsx(y,{placeholder:"Selecione..."})}),e.jsx(k,{className:"glass-card border-white/10",children:B.map(a=>e.jsx(d,{value:String(a.iap),children:Number(a.iap).toFixed(4)},a.id))})]})]})]})]})]}),!ee&&e.jsxs(R,{value:"personal",className:"border-none",children:[e.jsx(L,{className:"hover:no-underline py-3 px-4 bg-white/5 rounded-2xl border border-white/5 hover:bg-white/10 transition-all data-[state=open]:rounded-b-none data-[state=open]:bg-emerald-500/5 data-[state=open]:border-emerald-500/20 group text-[10px] uppercase font-bold tracking-widest",children:e.jsxs("div",{className:"flex items-center gap-2 text-emerald-500",children:[e.jsx(xe,{className:"w-4 h-4"}),"Dados Pessoais & Endereço"]})}),e.jsxs(z,{className:"bg-black/10 border-x border-b border-white/5 rounded-b-2xl px-6 py-8 -mt-px space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(o,{className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"CPF"}),e.jsx(h,{value:r.cpf,onChange:a=>H("cpf",a.target.value,"edit","cpf"),className:I("industrial-input",te.edit_cpf&&"border-red-500/50"),placeholder:"000.000.000-00"}),te.edit_cpf&&e.jsx("span",{className:"text-[10px] text-red-400 font-bold",children:te.edit_cpf})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(o,{className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Data Nasc."}),e.jsx(h,{value:r.birthDate,onChange:a=>H("birthDate",a.target.value,"edit","date"),className:"bg-white/5 border-white/10",placeholder:"DD/MM/AAAA",maxLength:10})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(o,{className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Telefone / Celular"}),e.jsx(h,{value:r.phone,onChange:a=>H("phone",a.target.value,"edit","phone"),className:I("industrial-input",te.edit_phone&&"border-red-500/50"),placeholder:"(00) 00000-0000"}),te.edit_phone&&e.jsx("span",{className:"text-[10px] text-red-400 font-bold",children:te.edit_phone})]}),e.jsx("div",{className:"h-px bg-white/10 my-2"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1 col-span-1",children:[e.jsx(o,{className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"CEP"}),e.jsx(h,{value:r.cep,onChange:a=>H("cep",a.target.value,"edit","cep"),onBlur:a=>ya("edit",a.target.value),className:"bg-white/5 border-white/10",placeholder:"00000-000"})]}),e.jsxs("div",{className:"space-y-1 col-span-2",children:[e.jsx(o,{className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Rua / Logradouro"}),e.jsx(h,{value:r.street,onChange:a=>u({...r,street:a.target.value}),className:"bg-white/5 border-white/10",placeholder:"Rua..."})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-1 col-span-1",children:[e.jsx(o,{className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Número"}),e.jsx(h,{value:r.number,onChange:a=>u({...r,number:a.target.value}),className:"bg-white/5 border-white/10",placeholder:"Nº"})]}),e.jsxs("div",{className:"space-y-1 col-span-3",children:[e.jsx(o,{className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Bairro"}),e.jsx(h,{value:r.neighborhood,onChange:a=>u({...r,neighborhood:a.target.value}),className:"bg-white/5 border-white/10",placeholder:"Bairro"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1 col-span-2",children:[e.jsx(o,{className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Cidade"}),e.jsx(h,{value:r.city,onChange:a=>u({...r,city:a.target.value}),className:"bg-white/5 border-white/10",placeholder:"Cidade"})]}),e.jsxs("div",{className:"space-y-1 col-span-1",children:[e.jsx(o,{className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"UF"}),e.jsx(h,{value:r.state,onChange:a=>u({...r,state:a.target.value}),className:"bg-white/5 border-white/10",placeholder:"UF",maxLength:2})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"edit-gender",className:"text-[10px] uppercase text-muted-foreground font-black tracking-widest",children:"Gênero"}),e.jsxs(N,{value:r.gender||"none",onValueChange:a=>u({...r,gender:a==="none"?"":a}),children:[e.jsx(v,{className:"bg-white/5 border-white/10",children:e.jsx(y,{placeholder:"Selecione..."})}),e.jsxs(k,{className:"glass-card border-white/10",children:[e.jsx(d,{value:"none",children:"Não informado"}),e.jsx(d,{value:"MALE",children:"Masculino"}),e.jsx(d,{value:"FEMALE",children:"Feminino"}),e.jsx(d,{value:"OTHER",children:"Outro"})]})]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-white/10",children:[e.jsx(p,{variant:"ghost",onClick:()=>De(null),children:"Cancelar"}),e.jsxs(p,{className:"gradient-primary",onClick:ts,disabled:ka||!r.fullName||!r.email,children:[ka&&e.jsx(ye,{className:"w-4 h-4 mr-2 animate-spin"}),"Salvar Alterações"]})]})]})]})}),e.jsx(oe,{open:!!We,onOpenChange:()=>Ye(null),children:e.jsx(ne,{className:"p-0 border-none bg-transparent max-w-md",children:We&&e.jsx(qa,{isSaving:Ja,onSave:async a=>{wa(!0);const s=await ma(We.id,a);wa(!1),s.success&&Ye(null)}})})}),e.jsx(aa,{open:!!se,onOpenChange:()=>fa(null),children:e.jsxs(sa,{className:"glass-card border-destructive/20 max-w-md",children:[e.jsxs(ra,{children:[e.jsxs(ta,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(Ga,{className:"w-5 h-5"})," Confirmar Exclusão"]}),e.jsxs(la,{children:["Deseja excluir permanentemente o usuário"," ",e.jsx("strong",{children:se==null?void 0:se.fullName}),"? Esta ação não pode ser desfeita."]})]}),e.jsxs(ia,{children:[e.jsx(oa,{children:"Cancelar"}),e.jsx(na,{onClick:()=>se&&ns(se),className:"bg-destructive text-white hover:bg-destructive/90",children:"Excluir Permanentemente"})]})]})}),e.jsx(aa,{open:!!re,onOpenChange:()=>Qa(null),children:e.jsxs(sa,{children:[e.jsxs(ra,{children:[e.jsx(ta,{children:"Resetar Senha"}),e.jsxs(la,{children:["Enviar link de recuperação por e-mail para"," ",e.jsx("strong",{children:re==null?void 0:re.email}),"?"]})]}),e.jsxs(ia,{children:[e.jsx(oa,{children:"Cancelar"}),e.jsx(na,{onClick:()=>re&&os(re),className:"gradient-primary text-white",children:"Enviar Email"})]})]})}),e.jsx(oe,{open:es,onOpenChange:Pe,children:e.jsxs(ne,{className:"max-w-xl bg-black/95 backdrop-blur-2xl border-primary/30 shadow-[0_0_50px_-12px_rgba(234,179,8,0.3)]",children:[e.jsxs(we,{children:[e.jsxs(Ne,{className:"flex items-center gap-2",children:[e.jsx(Ha,{className:"w-5 h-5 text-primary"})," Ajustar Foto"]}),e.jsx(ve,{children:"Posicione e dê zoom para enquadrar perfeitamente."})]}),e.jsxs("div",{className:"flex flex-col items-center gap-6 py-6",children:[e.jsxs("div",{className:"photo-adjustment-viewport w-96 h-96 overflow-hidden rounded-xl border border-white/10 bg-black/50 relative shadow-2xl mx-auto select-none touch-none",children:[e.jsx("div",{className:"photo-adjustment-image-stage w-full h-full flex items-center justify-center cursor-move active:cursor-grabbing",onMouseDown:a=>{a.preventDefault();const s=a.pageX-U.x,l=a.pageY-U.y,c=m=>{m.preventDefault(),je(M=>({...M,x:m.pageX-s,y:m.pageY-l}))},i=()=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",i)};window.addEventListener("mousemove",c),window.addEventListener("mouseup",i)},children:e.jsx("img",{src:Xe||"",alt:"Adjust",className:"max-w-none transition-transform duration-75 select-none pointer-events-none",style:{transform:`scale(${U.zoom}) translate(${U.x}px, ${U.y}px)`},draggable:!1})}),e.jsx("div",{className:"absolute inset-0 pointer-events-none z-10",style:{background:"radial-gradient(circle at center, transparent 150px, rgba(0,0,0,0.85) 151px)"}}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[300px] h-[300px] rounded-full border-2 border-white/30 pointer-events-none z-20 shadow-[0_0_0_999px_rgba(0,0,0,0.5)] opacity-50"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[300px] h-[300px] rounded-full border border-primary/50 pointer-events-none z-30"})]}),e.jsxs("div",{className:"w-full space-y-4 px-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ha,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(Ls,{value:[U.zoom],min:1,max:3,step:.01,onValueChange:([a])=>je(s=>({...s,zoom:a}))})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ks,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx(p,{variant:"outline",size:"sm",onClick:()=>je(a=>({...a,x:0,y:0})),className:"text-[10px] h-7 px-2",children:"RESETA POSIÇÃO"}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>je(a=>({...a,zoom:1})),className:"text-[10px] h-7 px-2",children:"RESETA ZOOM"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-white/10",children:[e.jsx(p,{variant:"ghost",onClick:()=>Pe(!1),children:"Cancelar"}),e.jsx(p,{className:"gradient-primary text-white",onClick:ss,children:"Aplicar Foto"})]})]})}),e.jsx(oe,{open:!!S,onOpenChange:a=>!a&&$e(null),children:e.jsxs(ne,{className:"sm:max-w-lg bg-linear-to-br from-black via-zinc-900 to-black border-white/10 max-h-[90vh] overflow-y-auto",children:[e.jsxs(we,{children:[e.jsxs(Ne,{className:"text-xl flex items-center gap-2",children:[e.jsx(ys,{className:"w-5 h-5 text-primary"}),"Alterar Nível de Acesso"]}),e.jsxs(ve,{children:["Selecione o novo cargo para"," ",e.jsx("span",{className:"text-center font-semibold text-white",children:S==null?void 0:S.fullName})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 py-4",children:K.filter(a=>a.name!=="HELPER_SYSTEM").map(a=>e.jsxs(p,{variant:"outline",className:I("h-auto py-3 px-4 flex flex-col items-start gap-1 border transition-all",a.name.toUpperCase()===(S==null?void 0:S.role)?"bg-primary/20 border-primary ring-2 ring-primary/50":"hover:bg-white/5 border-white/10"),disabled:pa===(S==null?void 0:S.id),onClick:async()=>{if(!S||a.name.toUpperCase()===S.role)return;$(S.id);const s=await T(S.id,{role:a.name.toUpperCase()});$(null),s.success?(x({title:"Cargo atualizado",description:`${S.fullName} agora é ${me(a.name)}`}),$e(null)):x({title:"Erro ao atualizar",description:s.error,variant:"destructive"})},children:[e.jsx("span",{className:I("font-medium text-sm",Je(a.name)),children:me(a.name)}),e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:["Nível ",a.rank]})]},a.name))}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-white/10",children:e.jsx(p,{variant:"ghost",onClick:()=>$e(null),children:"Cancelar"})})]})})]})}function ca(f,X){var B;return((B=X.find(E=>E.id===f))==null?void 0:B.name)||""}export{Sr as default};
