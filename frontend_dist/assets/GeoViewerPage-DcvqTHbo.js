var oa=Object.defineProperty;var sa=(i,a,n)=>a in i?oa(i,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[a]=n;var ge=(i,a,n)=>sa(i,typeof a!="symbol"?a+"":a,n);import{r as G,j as F,u as la,aA as kt,w as ca,M as ua,S as yr,G as Er,H as Mr,I as xr,J as Sr,a7 as ha,n as da,s as Ir,a$ as rr,t as pa}from"./index-D951x4H-.js";import{l as ur,I as ma,m as hr,n as Fr,v as Dr,b as Ee,S as Tr,Q as Ar,o as Zt,c as je,P as ar,p as ct,T as ut,q as fa,r as ga,s as Ur,H as Fe,F as We,t as ht,L as Ge,w as Mt,x as va,u as Re,a as kr,_ as Br,y as Ve,g as jr,z as Hr,W as zr,U as Wt,A as wa,E as _a,G as or,J as dt,K as ba,N as ya,X as Ea,Y as Ma,Z as xa,$ as sr,a0 as Sa,a1 as Ia,a2 as Cr,a3 as Ta,a4 as Gt,a5 as Aa,a6 as xt,a7 as Ca,a8 as Ra,a9 as Oa,f as Pa,aa as Na,h as La,ab as Rr,i as Fa,ac as Da,j as Ua,k as ka}from"./Gltf-DXY_s8Ul.js";import{E as Ba,C as ja}from"./CompletedWorkModal-gflenMLd.js";import{u as Ha}from"./useCompanies-kjFTA6Qu.js";import"./xlsx-BBWTpfDg.js";import"./card-BTHGlYFz.js";import"./scroll-area-C9sC2RNd.js";import"./useWorkStages-DXnml1Pf.js";import"./useTowerProduction-DGhO_ax3.js";import"./calendar-MfduwZdl.js";import"./subDays-HHYU8WMe.js";import"./format-CP1OFCPJ.js";import"./isSameDay-BB6-IGfB.js";import"./search-BoEw84GM.js";import"./calendar-B3GVMfO3.js";import"./activity-BYx2dwgt.js";import"./trending-up-BwuTo0m4.js";import"./arrow-up-BfG5I1o5.js";import"./eye-off-Bbweex62.js";import"./AreaChart-D9h5uedO.js";import"./BarChart-DjRXQRXs.js";import"./LineChart-DAkisegE.js";import"./Line-DWxI2lOG.js";var Le=Uint8Array,Ke=Uint16Array,lr=Uint32Array,Zr=new Le([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Gr=new Le([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),za=new Le([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Yr=function(i,a){for(var n=new Ke(31),t=0;t<31;++t)n[t]=a+=1<<i[t-1];for(var l=new lr(n[30]),t=1;t<30;++t)for(var u=n[t];u<n[t+1];++u)l[u]=u-n[t]<<5|t;return[n,l]},Wr=Yr(Zr,2),Xr=Wr[0],Za=Wr[1];Xr[28]=258,Za[258]=28;var Ga=Yr(Gr,0),Ya=Ga[0],cr=new Ke(32768);for(var pe=0;pe<32768;++pe){var $e=(pe&43690)>>>1|(pe&21845)<<1;$e=($e&52428)>>>2|($e&13107)<<2,$e=($e&61680)>>>4|($e&3855)<<4,cr[pe]=(($e&65280)>>>8|($e&255)<<8)>>>1}var Et=(function(i,a,n){for(var t=i.length,l=0,u=new Ke(a);l<t;++l)++u[i[l]-1];var c=new Ke(a);for(l=0;l<a;++l)c[l]=c[l-1]+u[l-1]<<1;var f;if(n){f=new Ke(1<<a);var m=15-a;for(l=0;l<t;++l)if(i[l])for(var g=l<<4|i[l],w=a-i[l],T=c[i[l]-1]++<<w,C=T|(1<<w)-1;T<=C;++T)f[cr[T]>>>m]=g}else for(f=new Ke(t),l=0;l<t;++l)i[l]&&(f[l]=cr[c[i[l]-1]++]>>>15-i[l]);return f}),It=new Le(288);for(var pe=0;pe<144;++pe)It[pe]=8;for(var pe=144;pe<256;++pe)It[pe]=9;for(var pe=256;pe<280;++pe)It[pe]=7;for(var pe=280;pe<288;++pe)It[pe]=8;var $r=new Le(32);for(var pe=0;pe<32;++pe)$r[pe]=5;var Wa=Et(It,9,1),Xa=Et($r,5,1),nr=function(i){for(var a=i[0],n=1;n<i.length;++n)i[n]>a&&(a=i[n]);return a},He=function(i,a,n){var t=a/8|0;return(i[t]|i[t+1]<<8)>>(a&7)&n},ir=function(i,a){var n=a/8|0;return(i[n]|i[n+1]<<8|i[n+2]<<16)>>(a&7)},$a=function(i){return(i/8|0)+(i&7&&1)},Va=function(i,a,n){(n==null||n>i.length)&&(n=i.length);var t=new(i instanceof Ke?Ke:i instanceof lr?lr:Le)(n-a);return t.set(i.subarray(a,n)),t},Ka=function(i,a,n){var t=i.length;if(!t||n&&!n.l&&t<5)return a||new Le(0);var l=!a||n,u=!n||n.i;n||(n={}),a||(a=new Le(t*3));var c=function(ne){var De=a.length;if(ne>De){var Ue=new Le(Math.max(De*2,ne));Ue.set(a),a=Ue}},f=n.f||0,m=n.p||0,g=n.b||0,w=n.l,T=n.d,C=n.m,D=n.n,j=t*8;do{if(!w){n.f=f=He(i,m,1);var J=He(i,m+1,3);if(m+=3,J)if(J==1)w=Wa,T=Xa,C=9,D=5;else if(J==2){var ee=He(i,m,31)+257,te=He(i,m+10,15)+4,L=ee+He(i,m+5,31)+1;m+=14;for(var R=new Le(L),re=new Le(19),y=0;y<te;++y)re[za[y]]=He(i,m+y*3,7);m+=te*3;for(var A=nr(re),P=(1<<A)-1,q=Et(re,A,1),y=0;y<L;){var K=q[He(i,m,P)];m+=K&15;var z=K>>>4;if(z<16)R[y++]=z;else{var Y=0,B=0;for(z==16?(B=3+He(i,m,3),m+=2,Y=R[y-1]):z==17?(B=3+He(i,m,7),m+=3):z==18&&(B=11+He(i,m,127),m+=7);B--;)R[y++]=Y}}var oe=R.subarray(0,ee),Z=R.subarray(ee);C=nr(oe),D=nr(Z),w=Et(oe,C,1),T=Et(Z,D,1)}else throw"invalid block type";else{var z=$a(m)+4,$=i[z-4]|i[z-3]<<8,V=z+$;if(V>t){if(u)throw"unexpected EOF";break}l&&c(g+$),a.set(i.subarray(z,V),g),n.b=g+=$,n.p=m=V*8;continue}if(m>j){if(u)throw"unexpected EOF";break}}l&&c(g+131072);for(var Ie=(1<<C)-1,Te=(1<<D)-1,Me=m;;Me=m){var Y=w[ir(i,m)&Ie],ae=Y>>>4;if(m+=Y&15,m>j){if(u)throw"unexpected EOF";break}if(!Y)throw"invalid length/literal";if(ae<256)a[g++]=ae;else if(ae==256){Me=m,w=null;break}else{var Oe=ae-254;if(ae>264){var y=ae-257,se=Zr[y];Oe=He(i,m,(1<<se)-1)+Xr[y],m+=se}var ve=T[ir(i,m)&Te],Ae=ve>>>4;if(!ve)throw"invalid distance";m+=ve&15;var Z=Ya[Ae];if(Ae>3){var se=Gr[Ae];Z+=ir(i,m)&(1<<se)-1,m+=se}if(m>j){if(u)throw"unexpected EOF";break}l&&c(g+131072);for(var qe=g+Oe;g<qe;g+=4)a[g]=a[g-Z],a[g+1]=a[g+1-Z],a[g+2]=a[g+2-Z],a[g+3]=a[g+3-Z];g=qe}}n.l=w,n.p=Me,n.b=g,w&&(f=1,n.m=C,n.d=T,n.n=D)}while(!f);return g==a.length?a:Va(a,0,g)},qa=new Le(0),Qa=function(i){if((i[0]&15)!=8||i[0]>>>4>7||(i[0]<<8|i[1])%31)throw"invalid zlib data";if(i[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Bt(i,a){return Ka((Qa(i),i.subarray(2,-4)),a)}var Ja=typeof TextDecoder<"u"&&new TextDecoder,en=0;try{Ja.decode(qa,{stream:!0}),en=1}catch{}const tn=i=>i&&i.isCubeTexture;class rn extends ur{constructor(a,n){var t,l;const u=tn(a),f=((l=u?(t=a.image[0])==null?void 0:t.width:a.image.width)!=null?l:1024)/4,m=Math.floor(Math.log2(f)),g=Math.pow(2,m),w=3*Math.max(g,112),T=4*g,C=[u?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/w}`,`#define CUBEUV_TEXEL_HEIGHT ${1/T}`,`#define CUBEUV_MAX_MIP ${m}.0`],D=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,j=C.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${Dr>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,J={map:{value:a},height:{value:(n==null?void 0:n.height)||15},radius:{value:(n==null?void 0:n.radius)||100}},z=new ma(1,16),$=new hr({uniforms:J,fragmentShader:j,vertexShader:D,side:Fr});super(z,$)}set radius(a){this.material.uniforms.radius.value=a}get radius(){return this.material.uniforms.radius.value}set height(a){this.material.uniforms.height.value=a}get height(){return this.material.uniforms.height.value}}var an=Object.defineProperty,nn=(i,a,n)=>a in i?an(i,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[a]=n,on=(i,a,n)=>(nn(i,a+"",n),n);class sn{constructor(){on(this,"_listeners")}addEventListener(a,n){this._listeners===void 0&&(this._listeners={});const t=this._listeners;t[a]===void 0&&(t[a]=[]),t[a].indexOf(n)===-1&&t[a].push(n)}hasEventListener(a,n){if(this._listeners===void 0)return!1;const t=this._listeners;return t[a]!==void 0&&t[a].indexOf(n)!==-1}removeEventListener(a,n){if(this._listeners===void 0)return;const l=this._listeners[a];if(l!==void 0){const u=l.indexOf(n);u!==-1&&l.splice(u,1)}}dispatchEvent(a){if(this._listeners===void 0)return;const t=this._listeners[a.type];if(t!==void 0){a.target=this;const l=t.slice(0);for(let u=0,c=l.length;u<c;u++)l[u].call(this,a);a.target=null}}}var ln=Object.defineProperty,cn=(i,a,n)=>a in i?ln(i,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[a]=n,k=(i,a,n)=>(cn(i,typeof a!="symbol"?a+"":a,n),n);const jt=new fa,Or=new ga,un=Math.cos(70*(Math.PI/180)),Pr=(i,a)=>(i%a+a)%a;let hn=class extends sn{constructor(a,n){super(),k(this,"object"),k(this,"domElement"),k(this,"enabled",!0),k(this,"target",new Ee),k(this,"minDistance",0),k(this,"maxDistance",1/0),k(this,"minZoom",0),k(this,"maxZoom",1/0),k(this,"minPolarAngle",0),k(this,"maxPolarAngle",Math.PI),k(this,"minAzimuthAngle",-1/0),k(this,"maxAzimuthAngle",1/0),k(this,"enableDamping",!1),k(this,"dampingFactor",.05),k(this,"enableZoom",!0),k(this,"zoomSpeed",1),k(this,"enableRotate",!0),k(this,"rotateSpeed",1),k(this,"enablePan",!0),k(this,"panSpeed",1),k(this,"screenSpacePanning",!0),k(this,"keyPanSpeed",7),k(this,"zoomToCursor",!1),k(this,"autoRotate",!1),k(this,"autoRotateSpeed",2),k(this,"reverseOrbit",!1),k(this,"reverseHorizontalOrbit",!1),k(this,"reverseVerticalOrbit",!1),k(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),k(this,"mouseButtons",{LEFT:ct.ROTATE,MIDDLE:ct.DOLLY,RIGHT:ct.PAN}),k(this,"touches",{ONE:ut.ROTATE,TWO:ut.DOLLY_PAN}),k(this,"target0"),k(this,"position0"),k(this,"zoom0"),k(this,"_domElementKeyEvents",null),k(this,"getPolarAngle"),k(this,"getAzimuthalAngle"),k(this,"setPolarAngle"),k(this,"setAzimuthalAngle"),k(this,"getDistance"),k(this,"getZoomScale"),k(this,"listenToKeyEvents"),k(this,"stopListenToKeyEvents"),k(this,"saveState"),k(this,"reset"),k(this,"update"),k(this,"connect"),k(this,"dispose"),k(this,"dollyIn"),k(this,"dollyOut"),k(this,"getScale"),k(this,"setScale"),this.object=a,this.domElement=n,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>w.phi,this.getAzimuthalAngle=()=>w.theta,this.setPolarAngle=s=>{let _=Pr(s,2*Math.PI),O=w.phi;O<0&&(O+=2*Math.PI),_<0&&(_+=2*Math.PI);let Q=Math.abs(_-O);2*Math.PI-Q<Q&&(_<O?_+=2*Math.PI:O+=2*Math.PI),T.phi=_-O,t.update()},this.setAzimuthalAngle=s=>{let _=Pr(s,2*Math.PI),O=w.theta;O<0&&(O+=2*Math.PI),_<0&&(_+=2*Math.PI);let Q=Math.abs(_-O);2*Math.PI-Q<Q&&(_<O?_+=2*Math.PI:O+=2*Math.PI),T.theta=_-O,t.update()},this.getDistance=()=>t.object.position.distanceTo(t.target),this.listenToKeyEvents=s=>{s.addEventListener("keydown",it),this._domElementKeyEvents=s},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",it),this._domElementKeyEvents=null},this.saveState=()=>{t.target0.copy(t.target),t.position0.copy(t.object.position),t.zoom0=t.object.zoom},this.reset=()=>{t.target.copy(t.target0),t.object.position.copy(t.position0),t.object.zoom=t.zoom0,t.object.updateProjectionMatrix(),t.dispatchEvent(l),t.update(),m=f.NONE},this.update=(()=>{const s=new Ee,_=new Ee(0,1,0),O=new Ar().setFromUnitVectors(a.up,_),Q=O.clone().invert(),E=new Ee,xe=new Ar,ze=2*Math.PI;return function(){const Dt=t.object.position;O.setFromUnitVectors(a.up,_),Q.copy(O).invert(),s.copy(Dt).sub(t.target),s.applyQuaternion(O),w.setFromVector3(s),t.autoRotate&&m===f.NONE&&B(K()),t.enableDamping?(w.theta+=T.theta*t.dampingFactor,w.phi+=T.phi*t.dampingFactor):(w.theta+=T.theta,w.phi+=T.phi);let ke=t.minAzimuthAngle,Be=t.maxAzimuthAngle;isFinite(ke)&&isFinite(Be)&&(ke<-Math.PI?ke+=ze:ke>Math.PI&&(ke-=ze),Be<-Math.PI?Be+=ze:Be>Math.PI&&(Be-=ze),ke<=Be?w.theta=Math.max(ke,Math.min(Be,w.theta)):w.theta=w.theta>(ke+Be)/2?Math.max(ke,w.theta):Math.min(Be,w.theta)),w.phi=Math.max(t.minPolarAngle,Math.min(t.maxPolarAngle,w.phi)),w.makeSafe(),t.enableDamping===!0?t.target.addScaledVector(D,t.dampingFactor):t.target.add(D),t.zoomToCursor&&A||t.object.isOrthographicCamera?w.radius=ve(w.radius):w.radius=ve(w.radius*C),s.setFromSpherical(w),s.applyQuaternion(Q),Dt.copy(t.target).add(s),t.object.matrixAutoUpdate||t.object.updateMatrix(),t.object.lookAt(t.target),t.enableDamping===!0?(T.theta*=1-t.dampingFactor,T.phi*=1-t.dampingFactor,D.multiplyScalar(1-t.dampingFactor)):(T.set(0,0,0),D.set(0,0,0));let et=!1;if(t.zoomToCursor&&A){let tt=null;if(t.object instanceof ar&&t.object.isPerspectiveCamera){const rt=s.length();tt=ve(rt*C);const lt=rt-tt;t.object.position.addScaledVector(re,lt),t.object.updateMatrixWorld()}else if(t.object.isOrthographicCamera){const rt=new Ee(y.x,y.y,0);rt.unproject(t.object),t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/C)),t.object.updateProjectionMatrix(),et=!0;const lt=new Ee(y.x,y.y,0);lt.unproject(t.object),t.object.position.sub(lt).add(rt),t.object.updateMatrixWorld(),tt=s.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),t.zoomToCursor=!1;tt!==null&&(t.screenSpacePanning?t.target.set(0,0,-1).transformDirection(t.object.matrix).multiplyScalar(tt).add(t.object.position):(jt.origin.copy(t.object.position),jt.direction.set(0,0,-1).transformDirection(t.object.matrix),Math.abs(t.object.up.dot(jt.direction))<un?a.lookAt(t.target):(Or.setFromNormalAndCoplanarPoint(t.object.up,t.target),jt.intersectPlane(Or,t.target))))}else t.object instanceof Zt&&t.object.isOrthographicCamera&&(et=C!==1,et&&(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/C)),t.object.updateProjectionMatrix()));return C=1,A=!1,et||E.distanceToSquared(t.object.position)>g||8*(1-xe.dot(t.object.quaternion))>g?(t.dispatchEvent(l),E.copy(t.object.position),xe.copy(t.object.quaternion),et=!1,!0):!1}})(),this.connect=s=>{t.domElement=s,t.domElement.style.touchAction="none",t.domElement.addEventListener("contextmenu",Ft),t.domElement.addEventListener("pointerdown",Nt),t.domElement.addEventListener("pointercancel",Qe),t.domElement.addEventListener("wheel",Lt)},this.dispose=()=>{var s,_,O,Q,E,xe;t.domElement&&(t.domElement.style.touchAction="auto"),(s=t.domElement)==null||s.removeEventListener("contextmenu",Ft),(_=t.domElement)==null||_.removeEventListener("pointerdown",Nt),(O=t.domElement)==null||O.removeEventListener("pointercancel",Qe),(Q=t.domElement)==null||Q.removeEventListener("wheel",Lt),(E=t.domElement)==null||E.ownerDocument.removeEventListener("pointermove",nt),(xe=t.domElement)==null||xe.ownerDocument.removeEventListener("pointerup",Qe),t._domElementKeyEvents!==null&&t._domElementKeyEvents.removeEventListener("keydown",it)};const t=this,l={type:"change"},u={type:"start"},c={type:"end"},f={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let m=f.NONE;const g=1e-6,w=new Tr,T=new Tr;let C=1;const D=new Ee,j=new je,J=new je,z=new je,$=new je,V=new je,ee=new je,te=new je,L=new je,R=new je,re=new Ee,y=new je;let A=!1;const P=[],q={};function K(){return 2*Math.PI/60/60*t.autoRotateSpeed}function Y(){return Math.pow(.95,t.zoomSpeed)}function B(s){t.reverseOrbit||t.reverseHorizontalOrbit?T.theta+=s:T.theta-=s}function oe(s){t.reverseOrbit||t.reverseVerticalOrbit?T.phi+=s:T.phi-=s}const Z=(()=>{const s=new Ee;return function(O,Q){s.setFromMatrixColumn(Q,0),s.multiplyScalar(-O),D.add(s)}})(),Ie=(()=>{const s=new Ee;return function(O,Q){t.screenSpacePanning===!0?s.setFromMatrixColumn(Q,1):(s.setFromMatrixColumn(Q,0),s.crossVectors(t.object.up,s)),s.multiplyScalar(O),D.add(s)}})(),Te=(()=>{const s=new Ee;return function(O,Q){const E=t.domElement;if(E&&t.object instanceof ar&&t.object.isPerspectiveCamera){const xe=t.object.position;s.copy(xe).sub(t.target);let ze=s.length();ze*=Math.tan(t.object.fov/2*Math.PI/180),Z(2*O*ze/E.clientHeight,t.object.matrix),Ie(2*Q*ze/E.clientHeight,t.object.matrix)}else E&&t.object instanceof Zt&&t.object.isOrthographicCamera?(Z(O*(t.object.right-t.object.left)/t.object.zoom/E.clientWidth,t.object.matrix),Ie(Q*(t.object.top-t.object.bottom)/t.object.zoom/E.clientHeight,t.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),t.enablePan=!1)}})();function Me(s){t.object instanceof ar&&t.object.isPerspectiveCamera||t.object instanceof Zt&&t.object.isOrthographicCamera?C=s:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function ae(s){Me(C/s)}function Oe(s){Me(C*s)}function se(s){if(!t.zoomToCursor||!t.domElement)return;A=!0;const _=t.domElement.getBoundingClientRect(),O=s.clientX-_.left,Q=s.clientY-_.top,E=_.width,xe=_.height;y.x=O/E*2-1,y.y=-(Q/xe)*2+1,re.set(y.x,y.y,1).unproject(t.object).sub(t.object.position).normalize()}function ve(s){return Math.max(t.minDistance,Math.min(t.maxDistance,s))}function Ae(s){j.set(s.clientX,s.clientY)}function qe(s){se(s),te.set(s.clientX,s.clientY)}function ne(s){$.set(s.clientX,s.clientY)}function De(s){J.set(s.clientX,s.clientY),z.subVectors(J,j).multiplyScalar(t.rotateSpeed);const _=t.domElement;_&&(B(2*Math.PI*z.x/_.clientHeight),oe(2*Math.PI*z.y/_.clientHeight)),j.copy(J),t.update()}function Ue(s){L.set(s.clientX,s.clientY),R.subVectors(L,te),R.y>0?ae(Y()):R.y<0&&Oe(Y()),te.copy(L),t.update()}function $t(s){V.set(s.clientX,s.clientY),ee.subVectors(V,$).multiplyScalar(t.panSpeed),Te(ee.x,ee.y),$.copy(V),t.update()}function Vt(s){se(s),s.deltaY<0?Oe(Y()):s.deltaY>0&&ae(Y()),t.update()}function Tt(s){let _=!1;switch(s.code){case t.keys.UP:Te(0,t.keyPanSpeed),_=!0;break;case t.keys.BOTTOM:Te(0,-t.keyPanSpeed),_=!0;break;case t.keys.LEFT:Te(t.keyPanSpeed,0),_=!0;break;case t.keys.RIGHT:Te(-t.keyPanSpeed,0),_=!0;break}_&&(s.preventDefault(),t.update())}function At(){if(P.length==1)j.set(P[0].pageX,P[0].pageY);else{const s=.5*(P[0].pageX+P[1].pageX),_=.5*(P[0].pageY+P[1].pageY);j.set(s,_)}}function mt(){if(P.length==1)$.set(P[0].pageX,P[0].pageY);else{const s=.5*(P[0].pageX+P[1].pageX),_=.5*(P[0].pageY+P[1].pageY);$.set(s,_)}}function ft(){const s=P[0].pageX-P[1].pageX,_=P[0].pageY-P[1].pageY,O=Math.sqrt(s*s+_*_);te.set(0,O)}function Ct(){t.enableZoom&&ft(),t.enablePan&&mt()}function Kt(){t.enableZoom&&ft(),t.enableRotate&&At()}function Rt(s){if(P.length==1)J.set(s.pageX,s.pageY);else{const O=st(s),Q=.5*(s.pageX+O.x),E=.5*(s.pageY+O.y);J.set(Q,E)}z.subVectors(J,j).multiplyScalar(t.rotateSpeed);const _=t.domElement;_&&(B(2*Math.PI*z.x/_.clientHeight),oe(2*Math.PI*z.y/_.clientHeight)),j.copy(J)}function Ot(s){if(P.length==1)V.set(s.pageX,s.pageY);else{const _=st(s),O=.5*(s.pageX+_.x),Q=.5*(s.pageY+_.y);V.set(O,Q)}ee.subVectors(V,$).multiplyScalar(t.panSpeed),Te(ee.x,ee.y),$.copy(V)}function Pt(s){const _=st(s),O=s.pageX-_.x,Q=s.pageY-_.y,E=Math.sqrt(O*O+Q*Q);L.set(0,E),R.set(0,Math.pow(L.y/te.y,t.zoomSpeed)),ae(R.y),te.copy(L)}function qt(s){t.enableZoom&&Pt(s),t.enablePan&&Ot(s)}function Qt(s){t.enableZoom&&Pt(s),t.enableRotate&&Rt(s)}function Nt(s){var _,O;t.enabled!==!1&&(P.length===0&&((_=t.domElement)==null||_.ownerDocument.addEventListener("pointermove",nt),(O=t.domElement)==null||O.ownerDocument.addEventListener("pointerup",Qe)),tr(s),s.pointerType==="touch"?ot(s):gt(s))}function nt(s){t.enabled!==!1&&(s.pointerType==="touch"?er(s):Jt(s))}function Qe(s){var _,O,Q;Je(s),P.length===0&&((_=t.domElement)==null||_.releasePointerCapture(s.pointerId),(O=t.domElement)==null||O.ownerDocument.removeEventListener("pointermove",nt),(Q=t.domElement)==null||Q.ownerDocument.removeEventListener("pointerup",Qe)),t.dispatchEvent(c),m=f.NONE}function gt(s){let _;switch(s.button){case 0:_=t.mouseButtons.LEFT;break;case 1:_=t.mouseButtons.MIDDLE;break;case 2:_=t.mouseButtons.RIGHT;break;default:_=-1}switch(_){case ct.DOLLY:if(t.enableZoom===!1)return;qe(s),m=f.DOLLY;break;case ct.ROTATE:if(s.ctrlKey||s.metaKey||s.shiftKey){if(t.enablePan===!1)return;ne(s),m=f.PAN}else{if(t.enableRotate===!1)return;Ae(s),m=f.ROTATE}break;case ct.PAN:if(s.ctrlKey||s.metaKey||s.shiftKey){if(t.enableRotate===!1)return;Ae(s),m=f.ROTATE}else{if(t.enablePan===!1)return;ne(s),m=f.PAN}break;default:m=f.NONE}m!==f.NONE&&t.dispatchEvent(u)}function Jt(s){if(t.enabled!==!1)switch(m){case f.ROTATE:if(t.enableRotate===!1)return;De(s);break;case f.DOLLY:if(t.enableZoom===!1)return;Ue(s);break;case f.PAN:if(t.enablePan===!1)return;$t(s);break}}function Lt(s){t.enabled===!1||t.enableZoom===!1||m!==f.NONE&&m!==f.ROTATE||(s.preventDefault(),t.dispatchEvent(u),Vt(s),t.dispatchEvent(c))}function it(s){t.enabled===!1||t.enablePan===!1||Tt(s)}function ot(s){switch(be(s),P.length){case 1:switch(t.touches.ONE){case ut.ROTATE:if(t.enableRotate===!1)return;At(),m=f.TOUCH_ROTATE;break;case ut.PAN:if(t.enablePan===!1)return;mt(),m=f.TOUCH_PAN;break;default:m=f.NONE}break;case 2:switch(t.touches.TWO){case ut.DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;Ct(),m=f.TOUCH_DOLLY_PAN;break;case ut.DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;Kt(),m=f.TOUCH_DOLLY_ROTATE;break;default:m=f.NONE}break;default:m=f.NONE}m!==f.NONE&&t.dispatchEvent(u)}function er(s){switch(be(s),m){case f.TOUCH_ROTATE:if(t.enableRotate===!1)return;Rt(s),t.update();break;case f.TOUCH_PAN:if(t.enablePan===!1)return;Ot(s),t.update();break;case f.TOUCH_DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;qt(s),t.update();break;case f.TOUCH_DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;Qt(s),t.update();break;default:m=f.NONE}}function Ft(s){t.enabled!==!1&&s.preventDefault()}function tr(s){P.push(s)}function Je(s){delete q[s.pointerId];for(let _=0;_<P.length;_++)if(P[_].pointerId==s.pointerId){P.splice(_,1);return}}function be(s){let _=q[s.pointerId];_===void 0&&(_=new je,q[s.pointerId]=_),_.set(s.pageX,s.pageY)}function st(s){const _=s.pointerId===P[0].pointerId?P[1]:P[0];return q[_.pointerId]}this.dollyIn=(s=Y())=>{Oe(s),t.update()},this.dollyOut=(s=Y())=>{ae(s),t.update()},this.getScale=()=>C,this.setScale=s=>{Me(s),t.update()},this.getZoomScale=()=>Y(),n!==void 0&&this.connect(n),this.update()}};class dn extends Ur{constructor(a){super(a),this.type=Fe}parse(a){const c=function(y,A){switch(y){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(A||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(A||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(A||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(A||""))}},T=function(y,A,P){A=A||1024;let K=y.pos,Y=-1,B=0,oe="",Z=String.fromCharCode.apply(null,new Uint16Array(y.subarray(K,K+128)));for(;0>(Y=Z.indexOf(`
`))&&B<A&&K<y.byteLength;)oe+=Z,B+=Z.length,K+=128,Z+=String.fromCharCode.apply(null,new Uint16Array(y.subarray(K,K+128)));return-1<Y?(y.pos+=B+Y+1,oe+Z.slice(0,Y)):!1},C=function(y){const A=/^#\?(\S+)/,P=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,q=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,K=/^\s*FORMAT=(\S+)\s*$/,Y=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,B={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let oe,Z;for((y.pos>=y.byteLength||!(oe=T(y)))&&c(1,"no header found"),(Z=oe.match(A))||c(3,"bad initial token"),B.valid|=1,B.programtype=Z[1],B.string+=oe+`
`;oe=T(y),oe!==!1;){if(B.string+=oe+`
`,oe.charAt(0)==="#"){B.comments+=oe+`
`;continue}if((Z=oe.match(P))&&(B.gamma=parseFloat(Z[1])),(Z=oe.match(q))&&(B.exposure=parseFloat(Z[1])),(Z=oe.match(K))&&(B.valid|=2,B.format=Z[1]),(Z=oe.match(Y))&&(B.valid|=4,B.height=parseInt(Z[1],10),B.width=parseInt(Z[2],10)),B.valid&2&&B.valid&4)break}return B.valid&2||c(3,"missing format specifier"),B.valid&4||c(3,"missing image size specifier"),B},D=function(y,A,P){const q=A;if(q<8||q>32767||y[0]!==2||y[1]!==2||y[2]&128)return new Uint8Array(y);q!==(y[2]<<8|y[3])&&c(3,"wrong scanline width");const K=new Uint8Array(4*A*P);K.length||c(4,"unable to allocate buffer space");let Y=0,B=0;const oe=4*q,Z=new Uint8Array(4),Ie=new Uint8Array(oe);let Te=P;for(;Te>0&&B<y.byteLength;){B+4>y.byteLength&&c(1),Z[0]=y[B++],Z[1]=y[B++],Z[2]=y[B++],Z[3]=y[B++],(Z[0]!=2||Z[1]!=2||(Z[2]<<8|Z[3])!=q)&&c(3,"bad rgbe scanline format");let Me=0,ae;for(;Me<oe&&B<y.byteLength;){ae=y[B++];const se=ae>128;if(se&&(ae-=128),(ae===0||Me+ae>oe)&&c(3,"bad scanline data"),se){const ve=y[B++];for(let Ae=0;Ae<ae;Ae++)Ie[Me++]=ve}else Ie.set(y.subarray(B,B+ae),Me),Me+=ae,B+=ae}const Oe=q;for(let se=0;se<Oe;se++){let ve=0;K[Y]=Ie[se+ve],ve+=q,K[Y+1]=Ie[se+ve],ve+=q,K[Y+2]=Ie[se+ve],ve+=q,K[Y+3]=Ie[se+ve],Y+=4}Te--}return K},j=function(y,A,P,q){const K=y[A+3],Y=Math.pow(2,K-128)/255;P[q+0]=y[A+0]*Y,P[q+1]=y[A+1]*Y,P[q+2]=y[A+2]*Y,P[q+3]=1},J=function(y,A,P,q){const K=y[A+3],Y=Math.pow(2,K-128)/255;P[q+0]=ht.toHalfFloat(Math.min(y[A+0]*Y,65504)),P[q+1]=ht.toHalfFloat(Math.min(y[A+1]*Y,65504)),P[q+2]=ht.toHalfFloat(Math.min(y[A+2]*Y,65504)),P[q+3]=ht.toHalfFloat(1)},z=new Uint8Array(a);z.pos=0;const $=C(z),V=$.width,ee=$.height,te=D(z.subarray(z.pos),V,ee);let L,R,re;switch(this.type){case We:re=te.length/4;const y=new Float32Array(re*4);for(let P=0;P<re;P++)j(te,P*4,y,P*4);L=y,R=We;break;case Fe:re=te.length/4;const A=new Uint16Array(re*4);for(let P=0;P<re;P++)J(te,P*4,A,P*4);L=A,R=Fe;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:V,height:ee,data:L,header:$.string,gamma:$.gamma,exposure:$.exposure,type:R}}setDataType(a){return this.type=a,this}load(a,n,t,l){function u(c,f){switch(c.type){case We:case Fe:"colorSpace"in c?c.colorSpace="srgb-linear":c.encoding=3e3,c.minFilter=Ge,c.magFilter=Ge,c.generateMipmaps=!1,c.flipY=!0;break}n&&n(c,f)}return super.load(a,u,t,l)}}const bt=Dr>=152;class pn extends Ur{constructor(a){super(a),this.type=Fe}parse(a){const A=Math.pow(2.7182818,2.2);function P(e,r){for(var o=0,h=0;h<65536;++h)(h==0||e[h>>3]&1<<(h&7))&&(r[o++]=h);for(var d=o-1;o<65536;)r[o++]=0;return d}function q(e){for(var r=0;r<16384;r++)e[r]={},e[r].len=0,e[r].lit=0,e[r].p=null}const K={l:0,c:0,lc:0};function Y(e,r,o,h,d){for(;o<e;)r=r<<8|st(h,d),o+=8;o-=e,K.l=r>>o&(1<<e)-1,K.c=r,K.lc=o}const B=new Array(59);function oe(e){for(var r=0;r<=58;++r)B[r]=0;for(var r=0;r<65537;++r)B[e[r]]+=1;for(var o=0,r=58;r>0;--r){var h=o+B[r]>>1;B[r]=o,o=h}for(var r=0;r<65537;++r){var d=e[r];d>0&&(e[r]=d|B[d]++<<6)}}function Z(e,r,o,h,d,p,b){for(var v=o,S=0,x=0;d<=p;d++){if(v.value-o.value>h)return!1;Y(6,S,x,e,v);var I=K.l;if(S=K.c,x=K.lc,b[d]=I,I==63){if(v.value-o.value>h)throw"Something wrong with hufUnpackEncTable";Y(8,S,x,e,v);var M=K.l+6;if(S=K.c,x=K.lc,d+M>p+1)throw"Something wrong with hufUnpackEncTable";for(;M--;)b[d++]=0;d--}else if(I>=59){var M=I-59+2;if(d+M>p+1)throw"Something wrong with hufUnpackEncTable";for(;M--;)b[d++]=0;d--}}oe(b)}function Ie(e){return e&63}function Te(e){return e>>6}function Me(e,r,o,h){for(;r<=o;r++){var d=Te(e[r]),p=Ie(e[r]);if(d>>p)throw"Invalid table entry";if(p>14){var b=h[d>>p-14];if(b.len)throw"Invalid table entry";if(b.lit++,b.p){var v=b.p;b.p=new Array(b.lit);for(var S=0;S<b.lit-1;++S)b.p[S]=v[S]}else b.p=new Array(1);b.p[b.lit-1]=r}else if(p)for(var x=0,S=1<<14-p;S>0;S--){var b=h[(d<<14-p)+x];if(b.len||b.p)throw"Invalid table entry";b.len=p,b.lit=r,x++}}return!0}const ae={c:0,lc:0};function Oe(e,r,o,h){e=e<<8|st(o,h),r+=8,ae.c=e,ae.lc=r}const se={c:0,lc:0};function ve(e,r,o,h,d,p,b,v,S,x){if(e==r){h<8&&(Oe(o,h,d,b),o=ae.c,h=ae.lc),h-=8;var I=o>>h,I=new Uint8Array([I])[0];if(S.value+I>x)return!1;for(var M=v[S.value-1];I-- >0;)v[S.value++]=M}else if(S.value<x)v[S.value++]=e;else return!1;se.c=o,se.lc=h}function Ae(e){return e&65535}function qe(e){var r=Ae(e);return r>32767?r-65536:r}const ne={a:0,b:0};function De(e,r){var o=qe(e),h=qe(r),d=h,p=o+(d&1)+(d>>1),b=p,v=p-d;ne.a=b,ne.b=v}function Ue(e,r){var o=Ae(e),h=Ae(r),d=o-(h>>1)&65535,p=h+d-32768&65535;ne.a=p,ne.b=d}function $t(e,r,o,h,d,p,b){for(var v=b<16384,S=o>d?d:o,x=1,I;x<=S;)x<<=1;for(x>>=1,I=x,x>>=1;x>=1;){for(var M=0,fe=M+p*(d-I),N=p*x,U=p*I,H=h*x,W=h*I,le,ue,we,Se;M<=fe;M+=U){for(var he=M,Ze=M+h*(o-I);he<=Ze;he+=W){var de=he+H,_e=he+N,Ye=_e+H;v?(De(e[he+r],e[_e+r]),le=ne.a,we=ne.b,De(e[de+r],e[Ye+r]),ue=ne.a,Se=ne.b,De(le,ue),e[he+r]=ne.a,e[de+r]=ne.b,De(we,Se),e[_e+r]=ne.a,e[Ye+r]=ne.b):(Ue(e[he+r],e[_e+r]),le=ne.a,we=ne.b,Ue(e[de+r],e[Ye+r]),ue=ne.a,Se=ne.b,Ue(le,ue),e[he+r]=ne.a,e[de+r]=ne.b,Ue(we,Se),e[_e+r]=ne.a,e[Ye+r]=ne.b)}if(o&x){var _e=he+N;v?De(e[he+r],e[_e+r]):Ue(e[he+r],e[_e+r]),le=ne.a,e[_e+r]=ne.b,e[he+r]=le}}if(d&x)for(var he=M,Ze=M+h*(o-I);he<=Ze;he+=W){var de=he+H;v?De(e[he+r],e[de+r]):Ue(e[he+r],e[de+r]),le=ne.a,e[de+r]=ne.b,e[he+r]=le}I=x,x>>=1}return M}function Vt(e,r,o,h,d,p,b,v,S,x){for(var I=0,M=0,fe=v,N=Math.trunc(d.value+(p+7)/8);d.value<N;)for(Oe(I,M,o,d),I=ae.c,M=ae.lc;M>=14;){var U=I>>M-14&16383,H=r[U];if(H.len)M-=H.len,ve(H.lit,b,I,M,o,h,d,S,x,fe),I=se.c,M=se.lc;else{if(!H.p)throw"hufDecode issues";var W;for(W=0;W<H.lit;W++){for(var le=Ie(e[H.p[W]]);M<le&&d.value<N;)Oe(I,M,o,d),I=ae.c,M=ae.lc;if(M>=le&&Te(e[H.p[W]])==(I>>M-le&(1<<le)-1)){M-=le,ve(H.p[W],b,I,M,o,h,d,S,x,fe),I=se.c,M=se.lc;break}}if(W==H.lit)throw"hufDecode issues"}}var ue=8-p&7;for(I>>=ue,M-=ue;M>0;){var H=r[I<<14-M&16383];if(H.len)M-=H.len,ve(H.lit,b,I,M,o,h,d,S,x,fe),I=se.c,M=se.lc;else throw"hufDecode issues"}return!0}function Tt(e,r,o,h,d,p){var b={value:0},v=o.value,S=be(r,o),x=be(r,o);o.value+=4;var I=be(r,o);if(o.value+=4,S<0||S>=65537||x<0||x>=65537)throw"Something wrong with HUF_ENCSIZE";var M=new Array(65537),fe=new Array(16384);q(fe);var N=h-(o.value-v);if(Z(e,r,o,N,S,x,M),I>8*(h-(o.value-v)))throw"Something wrong with hufUncompress";Me(M,S,x,fe),Vt(M,fe,e,r,o,I,x,p,d,b)}function At(e,r,o){for(var h=0;h<o;++h)r[h]=e[r[h]]}function mt(e){for(var r=1;r<e.length;r++){var o=e[r-1]+e[r]-128;e[r]=o}}function ft(e,r){for(var o=0,h=Math.floor((e.length+1)/2),d=0,p=e.length-1;!(d>p||(r[d++]=e[o++],d>p));)r[d++]=e[h++]}function Ct(e){for(var r=e.byteLength,o=new Array,h=0,d=new DataView(e);r>0;){var p=d.getInt8(h++);if(p<0){var b=-p;r-=b+1;for(var v=0;v<b;v++)o.push(d.getUint8(h++))}else{var b=p;r-=2;for(var S=d.getUint8(h++),v=0;v<b+1;v++)o.push(S)}}return o}function Kt(e,r,o,h,d,p){var de=new DataView(p.buffer),b=o[e.idx[0]].width,v=o[e.idx[0]].height,S=3,x=Math.floor(b/8),I=Math.ceil(b/8),M=Math.ceil(v/8),fe=b-(I-1)*8,N=v-(M-1)*8,U={value:0},H=new Array(S),W=new Array(S),le=new Array(S),ue=new Array(S),we=new Array(S);for(let ce=0;ce<S;++ce)we[ce]=r[e.idx[ce]],H[ce]=ce<1?0:H[ce-1]+I*M,W[ce]=new Float32Array(64),le[ce]=new Uint16Array(64),ue[ce]=new Uint16Array(I*64);for(let ce=0;ce<M;++ce){var Se=8;ce==M-1&&(Se=N);var he=8;for(let me=0;me<I;++me){me==I-1&&(he=fe);for(let ie=0;ie<S;++ie)le[ie].fill(0),le[ie][0]=d[H[ie]++],Rt(U,h,le[ie]),Ot(le[ie],W[ie]),Pt(W[ie]);qt(W);for(let ie=0;ie<S;++ie)Qt(W[ie],ue[ie],me*64)}let ye=0;for(let me=0;me<S;++me){const ie=o[e.idx[me]].type;for(let Ne=8*ce;Ne<8*ce+Se;++Ne){ye=we[me][Ne];for(let at=0;at<x;++at){const Ce=at*64+(Ne&7)*8;de.setUint16(ye+0*ie,ue[me][Ce+0],!0),de.setUint16(ye+2*ie,ue[me][Ce+1],!0),de.setUint16(ye+4*ie,ue[me][Ce+2],!0),de.setUint16(ye+6*ie,ue[me][Ce+3],!0),de.setUint16(ye+8*ie,ue[me][Ce+4],!0),de.setUint16(ye+10*ie,ue[me][Ce+5],!0),de.setUint16(ye+12*ie,ue[me][Ce+6],!0),de.setUint16(ye+14*ie,ue[me][Ce+7],!0),ye+=16*ie}}if(x!=I)for(let Ne=8*ce;Ne<8*ce+Se;++Ne){const at=we[me][Ne]+8*x*2*ie,Ce=x*64+(Ne&7)*8;for(let Xe=0;Xe<he;++Xe)de.setUint16(at+Xe*2*ie,ue[me][Ce+Xe],!0)}}}for(var Ze=new Uint16Array(b),de=new DataView(p.buffer),_e=0;_e<S;++_e){o[e.idx[_e]].decoded=!0;var Ye=o[e.idx[_e]].type;if(o[_e].type==2)for(var _t=0;_t<v;++_t){const ce=we[_e][_t];for(var Pe=0;Pe<b;++Pe)Ze[Pe]=de.getUint16(ce+Pe*2*Ye,!0);for(var Pe=0;Pe<b;++Pe)de.setFloat32(ce+Pe*2*Ye,E(Ze[Pe]),!0)}}}function Rt(e,r,o){for(var h,d=1;d<64;)h=r[e.value],h==65280?d=64:h>>8==255?d+=h&255:(o[d]=h,d++),e.value++}function Ot(e,r){r[0]=E(e[0]),r[1]=E(e[1]),r[2]=E(e[5]),r[3]=E(e[6]),r[4]=E(e[14]),r[5]=E(e[15]),r[6]=E(e[27]),r[7]=E(e[28]),r[8]=E(e[2]),r[9]=E(e[4]),r[10]=E(e[7]),r[11]=E(e[13]),r[12]=E(e[16]),r[13]=E(e[26]),r[14]=E(e[29]),r[15]=E(e[42]),r[16]=E(e[3]),r[17]=E(e[8]),r[18]=E(e[12]),r[19]=E(e[17]),r[20]=E(e[25]),r[21]=E(e[30]),r[22]=E(e[41]),r[23]=E(e[43]),r[24]=E(e[9]),r[25]=E(e[11]),r[26]=E(e[18]),r[27]=E(e[24]),r[28]=E(e[31]),r[29]=E(e[40]),r[30]=E(e[44]),r[31]=E(e[53]),r[32]=E(e[10]),r[33]=E(e[19]),r[34]=E(e[23]),r[35]=E(e[32]),r[36]=E(e[39]),r[37]=E(e[45]),r[38]=E(e[52]),r[39]=E(e[54]),r[40]=E(e[20]),r[41]=E(e[22]),r[42]=E(e[33]),r[43]=E(e[38]),r[44]=E(e[46]),r[45]=E(e[51]),r[46]=E(e[55]),r[47]=E(e[60]),r[48]=E(e[21]),r[49]=E(e[34]),r[50]=E(e[37]),r[51]=E(e[47]),r[52]=E(e[50]),r[53]=E(e[56]),r[54]=E(e[59]),r[55]=E(e[61]),r[56]=E(e[35]),r[57]=E(e[36]),r[58]=E(e[48]),r[59]=E(e[49]),r[60]=E(e[57]),r[61]=E(e[58]),r[62]=E(e[62]),r[63]=E(e[63])}function Pt(e){const r=.5*Math.cos(.7853975),o=.5*Math.cos(3.14159/16),h=.5*Math.cos(3.14159/8),d=.5*Math.cos(3*3.14159/16),p=.5*Math.cos(5*3.14159/16),b=.5*Math.cos(3*3.14159/8),v=.5*Math.cos(7*3.14159/16);for(var S=new Array(4),x=new Array(4),I=new Array(4),M=new Array(4),fe=0;fe<8;++fe){var N=fe*8;S[0]=h*e[N+2],S[1]=b*e[N+2],S[2]=h*e[N+6],S[3]=b*e[N+6],x[0]=o*e[N+1]+d*e[N+3]+p*e[N+5]+v*e[N+7],x[1]=d*e[N+1]-v*e[N+3]-o*e[N+5]-p*e[N+7],x[2]=p*e[N+1]-o*e[N+3]+v*e[N+5]+d*e[N+7],x[3]=v*e[N+1]-p*e[N+3]+d*e[N+5]-o*e[N+7],I[0]=r*(e[N+0]+e[N+4]),I[3]=r*(e[N+0]-e[N+4]),I[1]=S[0]+S[3],I[2]=S[1]-S[2],M[0]=I[0]+I[1],M[1]=I[3]+I[2],M[2]=I[3]-I[2],M[3]=I[0]-I[1],e[N+0]=M[0]+x[0],e[N+1]=M[1]+x[1],e[N+2]=M[2]+x[2],e[N+3]=M[3]+x[3],e[N+4]=M[3]-x[3],e[N+5]=M[2]-x[2],e[N+6]=M[1]-x[1],e[N+7]=M[0]-x[0]}for(var U=0;U<8;++U)S[0]=h*e[16+U],S[1]=b*e[16+U],S[2]=h*e[48+U],S[3]=b*e[48+U],x[0]=o*e[8+U]+d*e[24+U]+p*e[40+U]+v*e[56+U],x[1]=d*e[8+U]-v*e[24+U]-o*e[40+U]-p*e[56+U],x[2]=p*e[8+U]-o*e[24+U]+v*e[40+U]+d*e[56+U],x[3]=v*e[8+U]-p*e[24+U]+d*e[40+U]-o*e[56+U],I[0]=r*(e[U]+e[32+U]),I[3]=r*(e[U]-e[32+U]),I[1]=S[0]+S[3],I[2]=S[1]-S[2],M[0]=I[0]+I[1],M[1]=I[3]+I[2],M[2]=I[3]-I[2],M[3]=I[0]-I[1],e[0+U]=M[0]+x[0],e[8+U]=M[1]+x[1],e[16+U]=M[2]+x[2],e[24+U]=M[3]+x[3],e[32+U]=M[3]-x[3],e[40+U]=M[2]-x[2],e[48+U]=M[1]-x[1],e[56+U]=M[0]-x[0]}function qt(e){for(var r=0;r<64;++r){var o=e[0][r],h=e[1][r],d=e[2][r];e[0][r]=o+1.5747*d,e[1][r]=o-.1873*h-.4682*d,e[2][r]=o+1.8556*h}}function Qt(e,r,o){for(var h=0;h<64;++h)r[o+h]=ht.toHalfFloat(Nt(e[h]))}function Nt(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(A,Math.abs(e)-1)}function nt(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function Qe(e){var r=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),o=new Uint8Array(Ct(r)),h=new Uint8Array(o.length);return mt(o),ft(o,h),new DataView(h.buffer)}function gt(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),o=Bt(r),h=new Uint8Array(o.length);return mt(o),ft(o,h),new DataView(h.buffer)}function Jt(e){for(var r=e.viewer,o={value:e.offset.value},h=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),d=new Uint8Array(8192),p=0,b=new Array(e.channels),v=0;v<e.channels;v++)b[v]={},b[v].start=p,b[v].end=b[v].start,b[v].nx=e.width,b[v].ny=e.lines,b[v].size=e.type,p+=b[v].nx*b[v].ny*b[v].size;var S=xe(r,o),x=xe(r,o);if(x>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(S<=x)for(var v=0;v<x-S+1;v++)d[v+S]=s(r,o);var I=new Uint16Array(65536),M=P(d,I),fe=be(r,o);Tt(e.array,r,o,fe,h,p);for(var v=0;v<e.channels;++v)for(var N=b[v],U=0;U<b[v].size;++U)$t(h,N.start+U,N.nx,N.size,N.ny,N.nx*N.size,M);At(I,h,p);for(var H=0,W=new Uint8Array(h.buffer.byteLength),le=0;le<e.lines;le++)for(var ue=0;ue<e.channels;ue++){var N=b[ue],we=N.nx*N.size,Se=new Uint8Array(h.buffer,N.end*2,we*2);W.set(Se,H),H+=we*2,N.end+=we}return new DataView(W.buffer)}function Lt(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),o=Bt(r);const h=e.lines*e.channels*e.width,d=e.type==1?new Uint16Array(h):new Uint32Array(h);let p=0,b=0;const v=new Array(4);for(let S=0;S<e.lines;S++)for(let x=0;x<e.channels;x++){let I=0;switch(e.type){case 1:v[0]=p,v[1]=v[0]+e.width,p=v[1]+e.width;for(let M=0;M<e.width;++M){const fe=o[v[0]++]<<8|o[v[1]++];I+=fe,d[b]=I,b++}break;case 2:v[0]=p,v[1]=v[0]+e.width,v[2]=v[1]+e.width,p=v[2]+e.width;for(let M=0;M<e.width;++M){const fe=o[v[0]++]<<24|o[v[1]++]<<16|o[v[2]++]<<8;I+=fe,d[b]=I,b++}break}}return new DataView(d.buffer)}function it(e){var r=e.viewer,o={value:e.offset.value},h=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),d={version:_(r,o),unknownUncompressedSize:_(r,o),unknownCompressedSize:_(r,o),acCompressedSize:_(r,o),dcCompressedSize:_(r,o),rleCompressedSize:_(r,o),rleUncompressedSize:_(r,o),rleRawSize:_(r,o),totalAcUncompressedCount:_(r,o),totalDcUncompressedCount:_(r,o),acCompression:_(r,o)};if(d.version<2)throw"EXRLoader.parse: "+wt.compression+" version "+d.version+" is unsupported";for(var p=new Array,b=xe(r,o)-2;b>0;){var v=ot(r.buffer,o),S=s(r,o),x=S>>2&3,I=(S>>4)-1,M=new Int8Array([I])[0],fe=s(r,o);p.push({name:v,index:M,type:fe,compression:x}),b-=v.length+3}for(var N=wt.channels,U=new Array(e.channels),H=0;H<e.channels;++H){var W=U[H]={},le=N[H];W.name=le.name,W.compression=0,W.decoded=!1,W.type=le.pixelType,W.pLinear=le.pLinear,W.width=e.width,W.height=e.lines}for(var ue={idx:new Array(3)},we=0;we<e.channels;++we)for(var W=U[we],H=0;H<p.length;++H){var Se=p[H];W.name==Se.name&&(W.compression=Se.compression,Se.index>=0&&(ue.idx[Se.index]=we),W.offset=we)}if(d.acCompressedSize>0)switch(d.acCompression){case 0:var de=new Uint16Array(d.totalAcUncompressedCount);Tt(e.array,r,o,d.acCompressedSize,de,d.totalAcUncompressedCount);break;case 1:var he=e.array.slice(o.value,o.value+d.totalAcUncompressedCount),Ze=Bt(he),de=new Uint16Array(Ze.buffer);o.value+=d.totalAcUncompressedCount;break}if(d.dcCompressedSize>0){var _e={array:e.array,offset:o,size:d.dcCompressedSize},Ye=new Uint16Array(gt(_e).buffer);o.value+=d.dcCompressedSize}if(d.rleRawSize>0){var he=e.array.slice(o.value,o.value+d.rleCompressedSize),Ze=Bt(he),_t=Ct(Ze.buffer);o.value+=d.rleCompressedSize}for(var Pe=0,ce=new Array(U.length),H=0;H<ce.length;++H)ce[H]=new Array;for(var ye=0;ye<e.lines;++ye)for(var me=0;me<U.length;++me)ce[me].push(Pe),Pe+=U[me].width*e.type*2;Kt(ue,ce,U,de,Ye,h);for(var H=0;H<U.length;++H){var W=U[H];if(!W.decoded)switch(W.compression){case 2:for(var ie=0,Ne=0,ye=0;ye<e.lines;++ye){for(var at=ce[H][ie],Ce=0;Ce<W.width;++Ce){for(var Xe=0;Xe<2*W.type;++Xe)h[at++]=_t[Ne+Xe*W.width*W.height];Ne++}ie++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(h.buffer)}function ot(e,r){for(var o=new Uint8Array(e),h=0;o[r.value+h]!=0;)h+=1;var d=new TextDecoder().decode(o.slice(r.value,r.value+h));return r.value=r.value+h+1,d}function er(e,r,o){var h=new TextDecoder().decode(new Uint8Array(e).slice(r.value,r.value+o));return r.value=r.value+o,h}function Ft(e,r){var o=Je(e,r),h=be(e,r);return[o,h]}function tr(e,r){var o=be(e,r),h=be(e,r);return[o,h]}function Je(e,r){var o=e.getInt32(r.value,!0);return r.value=r.value+4,o}function be(e,r){var o=e.getUint32(r.value,!0);return r.value=r.value+4,o}function st(e,r){var o=e[r.value];return r.value=r.value+1,o}function s(e,r){var o=e.getUint8(r.value);return r.value=r.value+1,o}const _=function(e,r){let o;return"getBigInt64"in DataView.prototype?o=Number(e.getBigInt64(r.value,!0)):o=e.getUint32(r.value+4,!0)+Number(e.getUint32(r.value,!0)<<32),r.value+=8,o};function O(e,r){var o=e.getFloat32(r.value,!0);return r.value+=4,o}function Q(e,r){return ht.toHalfFloat(O(e,r))}function E(e){var r=(e&31744)>>10,o=e&1023;return(e>>15?-1:1)*(r?r===31?o?NaN:1/0:Math.pow(2,r-15)*(1+o/1024):6103515625e-14*(o/1024))}function xe(e,r){var o=e.getUint16(r.value,!0);return r.value+=2,o}function ze(e,r){return E(xe(e,r))}function _r(e,r,o,h){for(var d=o.value,p=[];o.value<d+h-1;){var b=ot(r,o),v=Je(e,o),S=s(e,o);o.value+=3;var x=Je(e,o),I=Je(e,o);p.push({name:b,pixelType:v,pLinear:S,xSampling:x,ySampling:I})}return o.value+=1,p}function Dt(e,r){var o=O(e,r),h=O(e,r),d=O(e,r),p=O(e,r),b=O(e,r),v=O(e,r),S=O(e,r),x=O(e,r);return{redX:o,redY:h,greenX:d,greenY:p,blueX:b,blueY:v,whiteX:S,whiteY:x}}function ke(e,r){var o=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],h=s(e,r);return o[h]}function Be(e,r){var o=be(e,r),h=be(e,r),d=be(e,r),p=be(e,r);return{xMin:o,yMin:h,xMax:d,yMax:p}}function et(e,r){var o=["INCREASING_Y"],h=s(e,r);return o[h]}function tt(e,r){var o=O(e,r),h=O(e,r);return[o,h]}function rt(e,r){var o=O(e,r),h=O(e,r),d=O(e,r);return[o,h,d]}function lt(e,r,o,h,d){if(h==="string"||h==="stringvector"||h==="iccProfile")return er(r,o,d);if(h==="chlist")return _r(e,r,o,d);if(h==="chromaticities")return Dt(e,o);if(h==="compression")return ke(e,o);if(h==="box2i")return Be(e,o);if(h==="lineOrder")return et(e,o);if(h==="float")return O(e,o);if(h==="v2f")return tt(e,o);if(h==="v3f")return rt(e,o);if(h==="int")return Je(e,o);if(h==="rational")return Ft(e,o);if(h==="timecode")return tr(e,o);if(h==="preview")return o.value+=d,"skipped";o.value+=d}function ra(e,r,o){const h={};if(e.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";h.version=e.getUint8(4);const d=e.getUint8(5);h.spec={singleTile:!!(d&2),longName:!!(d&4),deepFormat:!!(d&8),multiPart:!!(d&16)},o.value=8;for(var p=!0;p;){var b=ot(r,o);if(b==0)p=!1;else{var v=ot(r,o),S=be(e,o),x=lt(e,r,o,v,S);x===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${v}'.`):h[b]=x}}if((d&-5)!=0)throw console.error("EXRHeader:",h),"THREE.EXRLoader: provided file is currently unsupported.";return h}function aa(e,r,o,h,d){const p={size:0,viewer:r,array:o,offset:h,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[bt?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":p.lines=1,p.uncompress=nt;break;case"RLE_COMPRESSION":p.lines=1,p.uncompress=Qe;break;case"ZIPS_COMPRESSION":p.lines=1,p.uncompress=gt;break;case"ZIP_COMPRESSION":p.lines=16,p.uncompress=gt;break;case"PIZ_COMPRESSION":p.lines=32,p.uncompress=Jt;break;case"PXR24_COMPRESSION":p.lines=16,p.uncompress=Lt;break;case"DWAA_COMPRESSION":p.lines=32,p.uncompress=it;break;case"DWAB_COMPRESSION":p.lines=256,p.uncompress=it;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(p.scanlineBlockSize=p.lines,p.type==1)switch(d){case We:p.getter=ze,p.inputSize=2;break;case Fe:p.getter=xe,p.inputSize=2;break}else if(p.type==2)switch(d){case We:p.getter=O,p.inputSize=4;break;case Fe:p.getter=Q,p.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+p.type+" for "+e.compression+".";p.blockCount=(e.dataWindow.yMax+1)/p.scanlineBlockSize;for(var b=0;b<p.blockCount;b++)_(r,h);p.outputChannels=p.channels==3?4:p.channels;const v=p.width*p.height*p.outputChannels;switch(d){case We:p.byteArray=new Float32Array(v),p.channels<p.outputChannels&&p.byteArray.fill(1,0,v);break;case Fe:p.byteArray=new Uint16Array(v),p.channels<p.outputChannels&&p.byteArray.fill(15360,0,v);break;default:console.error("THREE.EXRLoader: unsupported type: ",d);break}return p.bytesPerLine=p.width*p.inputSize*p.channels,p.outputChannels==4?p.format=Mt:p.format=va,bt?p.colorSpace="srgb-linear":p.encoding=3e3,p}const Ut=new DataView(a),na=new Uint8Array(a),vt={value:0},wt=ra(Ut,a,vt),X=aa(wt,Ut,na,vt,this.type),br={value:0},ia={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<X.height/X.scanlineBlockSize;e++){const r=be(Ut,vt);X.size=be(Ut,vt),X.lines=r+X.scanlineBlockSize>X.height?X.height-r:X.scanlineBlockSize;const h=X.size<X.lines*X.bytesPerLine?X.uncompress(X):nt(X);vt.value+=X.size;for(let d=0;d<X.scanlineBlockSize;d++){const p=d+e*X.scanlineBlockSize;if(p>=X.height)break;for(let b=0;b<X.channels;b++){const v=ia[wt.channels[b].name];for(let S=0;S<X.width;S++){br.value=(d*(X.channels*X.width)+b*X.width+S)*X.inputSize;const x=(X.height-1-p)*(X.width*X.outputChannels)+S*X.outputChannels+v;X.byteArray[x]=X.getter(h,br)}}}}return{header:wt,width:X.width,height:X.height,data:X.byteArray,format:X.format,[bt?"colorSpace":"encoding"]:X[bt?"colorSpace":"encoding"],type:this.type}}setDataType(a){return this.type=a,this}load(a,n,t,l){function u(c,f){bt?c.colorSpace=f.colorSpace:c.encoding=f.encoding,c.minFilter=Ge,c.magFilter=Ge,c.generateMipmaps=!1,c.flipY=!1,n&&n(c,f)}return super.load(a,u,t,l)}}const mn=G.forwardRef(({makeDefault:i,camera:a,regress:n,domElement:t,enableDamping:l=!0,keyEvents:u=!1,onChange:c,onStart:f,onEnd:m,...g},w)=>{const T=Re(R=>R.invalidate),C=Re(R=>R.camera),D=Re(R=>R.gl),j=Re(R=>R.events),J=Re(R=>R.setEvents),z=Re(R=>R.set),$=Re(R=>R.get),V=Re(R=>R.performance),ee=a||C,te=t||j.connected||D.domElement,L=G.useMemo(()=>new hn(ee),[ee]);return kr(()=>{L.enabled&&L.update()},-1),G.useEffect(()=>(u&&L.connect(u===!0?te:u),L.connect(te),()=>void L.dispose()),[u,te,n,L,T]),G.useEffect(()=>{const R=A=>{T(),n&&V.regress(),c&&c(A)},re=A=>{f&&f(A)},y=A=>{m&&m(A)};return L.addEventListener("change",R),L.addEventListener("start",re),L.addEventListener("end",y),()=>{L.removeEventListener("start",re),L.removeEventListener("end",y),L.removeEventListener("change",R)}},[c,f,m,L,T,J]),G.useEffect(()=>{if(i){const R=$().controls;return z({controls:L}),()=>z({controls:R})}},[i,L]),G.createElement("primitive",Br({ref:w,object:L,enableDamping:l},g))}),Vr=(i,a,n)=>{let t;switch(i){case sr:t=new Uint8ClampedArray(a*n*4);break;case Fe:t=new Uint16Array(a*n*4);break;case xa:t=new Uint32Array(a*n*4);break;case Ma:t=new Int8Array(a*n*4);break;case Ea:t=new Int16Array(a*n*4);break;case ya:t=new Int32Array(a*n*4);break;case We:t=new Float32Array(a*n*4);break;default:throw new Error("Unsupported data type")}return t};let Ht;const fn=(i,a,n,t)=>{if(Ht!==void 0)return Ht;const l=new zr(1,1,t);a.setRenderTarget(l);const u=new ur(new Hr,new ba({color:16777215}));a.render(u,n),a.setRenderTarget(null);const c=Vr(i,l.width,l.height);return a.readRenderTargetPixels(l,0,0,l.width,l.height,c),l.dispose(),u.geometry.dispose(),u.material.dispose(),Ht=c[0]!==0,Ht};class dr{constructor(a){ge(this,"_renderer");ge(this,"_rendererIsDisposable",!1);ge(this,"_material");ge(this,"_scene");ge(this,"_camera");ge(this,"_quad");ge(this,"_renderTarget");ge(this,"_width");ge(this,"_height");ge(this,"_type");ge(this,"_colorSpace");ge(this,"_supportsReadPixels",!0);ge(this,"render",()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(a){throw this._renderer.setRenderTarget(null),a}this._renderer.setRenderTarget(null)});var t,l,u,c,f,m,g,w,T,C,D,j,J,z,$,V;this._width=a.width,this._height=a.height,this._type=a.type,this._colorSpace=a.colorSpace;const n={format:Mt,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((t=a.renderTargetOptions)==null?void 0:t.anisotropy)!==void 0?(l=a.renderTargetOptions)==null?void 0:l.anisotropy:1,generateMipmaps:((u=a.renderTargetOptions)==null?void 0:u.generateMipmaps)!==void 0?(c=a.renderTargetOptions)==null?void 0:c.generateMipmaps:!1,magFilter:((f=a.renderTargetOptions)==null?void 0:f.magFilter)!==void 0?(m=a.renderTargetOptions)==null?void 0:m.magFilter:Ge,minFilter:((g=a.renderTargetOptions)==null?void 0:g.minFilter)!==void 0?(w=a.renderTargetOptions)==null?void 0:w.minFilter:Ge,samples:((T=a.renderTargetOptions)==null?void 0:T.samples)!==void 0?(C=a.renderTargetOptions)==null?void 0:C.samples:void 0,wrapS:((D=a.renderTargetOptions)==null?void 0:D.wrapS)!==void 0?(j=a.renderTargetOptions)==null?void 0:j.wrapS:Ve,wrapT:((J=a.renderTargetOptions)==null?void 0:J.wrapT)!==void 0?(z=a.renderTargetOptions)==null?void 0:z.wrapT:Ve};if(this._material=a.material,a.renderer?this._renderer=a.renderer:(this._renderer=dr.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new jr,this._camera=new Zt,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!fn(this._type,this._renderer,this._camera,n)){let ee;switch(this._type){case Fe:ee=this._renderer.extensions.has("EXT_color_buffer_float")?We:void 0;break}ee!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${We}`),this._type=ee):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new ur(new Hr,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new zr(this.width,this.height,n),this._renderTarget.texture.mapping=(($=a.renderTargetOptions)==null?void 0:$.mapping)!==void 0?(V=a.renderTargetOptions)==null?void 0:V.mapping:Wt}static instantiateRenderer(){const a=new wa;return a.setSize(128,128),a}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const a=Vr(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,a),a}toDataTexture(a){const n=new _a(this.toArray(),this.width,this.height,Mt,this._type,(a==null?void 0:a.mapping)||Wt,(a==null?void 0:a.wrapS)||Ve,(a==null?void 0:a.wrapT)||Ve,(a==null?void 0:a.magFilter)||Ge,(a==null?void 0:a.minFilter)||Ge,(a==null?void 0:a.anisotropy)||1,or);return n.generateMipmaps=(a==null?void 0:a.generateMipmaps)!==void 0?a==null?void 0:a.generateMipmaps:!1,n}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(a){this.disposeOnDemandRenderer(),a&&this.renderTarget.dispose(),this.material instanceof hr&&Object.values(this.material.uniforms).forEach(n=>{n.value instanceof dt&&n.value.dispose()}),Object.values(this.material).forEach(n=>{n instanceof dt&&n.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(a){this._width=a,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(a){this._height=a,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(a){this._renderTarget=a,this._width=a.width,this._height=a.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class Kr extends Error{}class qr extends Error{}const yt=(i,a,n)=>{const t=new RegExp(`${a}="([^"]*)"`,"i").exec(i);if(t)return t[1];const l=new RegExp(`<${a}[^>]*>([\\s\\S]*?)</${a}>`,"i").exec(i);if(l){const u=l[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return u&&u.length===3?u.map(c=>c.replace(/<\/?rdf:li>/g,"")):l[1].trim()}if(n!==void 0)return n;throw new Error(`Can't find ${a} in gainmap metadata`)},gn=i=>{let a;typeof TextDecoder<"u"?a=new TextDecoder().decode(i):a=i.toString();let n=a.indexOf("<x:xmpmeta");for(;n!==-1;){const t=a.indexOf("x:xmpmeta>",n),l=a.slice(n,t+10);try{const u=yt(l,"hdrgm:GainMapMin","0"),c=yt(l,"hdrgm:GainMapMax"),f=yt(l,"hdrgm:Gamma","1"),m=yt(l,"hdrgm:OffsetSDR","0.015625"),g=yt(l,"hdrgm:OffsetHDR","0.015625"),w=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(l),T=w?w[1]:"0",C=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(l);if(!C)throw new Error("Incomplete gainmap metadata");const D=C[1];return{gainMapMin:Array.isArray(u)?u.map(j=>parseFloat(j)):[parseFloat(u),parseFloat(u),parseFloat(u)],gainMapMax:Array.isArray(c)?c.map(j=>parseFloat(j)):[parseFloat(c),parseFloat(c),parseFloat(c)],gamma:Array.isArray(f)?f.map(j=>parseFloat(j)):[parseFloat(f),parseFloat(f),parseFloat(f)],offsetSdr:Array.isArray(m)?m.map(j=>parseFloat(j)):[parseFloat(m),parseFloat(m),parseFloat(m)],offsetHdr:Array.isArray(g)?g.map(j=>parseFloat(j)):[parseFloat(g),parseFloat(g),parseFloat(g)],hdrCapacityMin:parseFloat(T),hdrCapacityMax:parseFloat(D)}}catch{}n=a.indexOf("<x:xmpmeta",t)}};class vn{constructor(a){ge(this,"options");this.options={debug:a&&a.debug!==void 0?a.debug:!1,extractFII:a&&a.extractFII!==void 0?a.extractFII:!0,extractNonFII:a&&a.extractNonFII!==void 0?a.extractNonFII:!0}}extract(a){return new Promise((n,t)=>{const l=this.options.debug,u=new DataView(a.buffer);if(u.getUint16(0)!==65496){t(new Error("Not a valid jpeg"));return}const c=u.byteLength;let f=2,m=0,g;for(;f<c;){if(++m>250){t(new Error(`Found no marker after ${m} loops `));return}if(u.getUint8(f)!==255){t(new Error(`Not a valid marker at offset 0x${f.toString(16)}, found: 0x${u.getUint8(f).toString(16)}`));return}if(g=u.getUint8(f+1),l&&console.log(`Marker: ${g.toString(16)}`),g===226){l&&console.log("Found APP2 marker (0xffe2)");const w=f+4;if(u.getUint32(w)===1297106432){const T=w+4;let C;if(u.getUint16(T)===18761)C=!1;else if(u.getUint16(T)===19789)C=!0;else{t(new Error("No valid endianness marker found in TIFF header"));return}if(u.getUint16(T+2,!C)!==42){t(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const D=u.getUint32(T+4,!C);if(D<8){t(new Error("Not valid TIFF data! (First offset less than 8)"));return}const j=T+D,J=u.getUint16(j,!C),z=j+2;let $=0;for(let L=z;L<z+12*J;L+=12)u.getUint16(L,!C)===45057&&($=u.getUint32(L+8,!C));const ee=j+2+J*12+4,te=[];for(let L=ee;L<ee+$*16;L+=16){const R={MPType:u.getUint32(L,!C),size:u.getUint32(L+4,!C),dataOffset:u.getUint32(L+8,!C),dependantImages:u.getUint32(L+12,!C),start:-1,end:-1,isFII:!1};R.dataOffset?(R.start=T+R.dataOffset,R.isFII=!1):(R.start=0,R.isFII=!0),R.end=R.start+R.size,te.push(R)}if(this.options.extractNonFII&&te.length){const L=new Blob([u]),R=[];for(const re of te){if(re.isFII&&!this.options.extractFII)continue;const y=L.slice(re.start,re.end+1,"image/jpeg");R.push(y)}n(R)}}}f+=2+u.getUint16(f+2)}})}}const wn=async i=>{const a=gn(i);if(!a)throw new qr("Gain map XMP metadata not found");const t=await new vn({extractFII:!0,extractNonFII:!0}).extract(i);if(t.length!==2)throw new Kr("Gain map recovery image not found");return{sdr:new Uint8Array(await t[0].arrayBuffer()),gainMap:new Uint8Array(await t[1].arrayBuffer()),metadata:a}},Nr=i=>new Promise((a,n)=>{const t=document.createElement("img");t.onload=()=>{a(t)},t.onerror=l=>{n(l)},t.src=URL.createObjectURL(i)});class _n extends Sa{constructor(n,t){super(t);ge(this,"_renderer");ge(this,"_renderTargetOptions");ge(this,"_internalLoadingManager");ge(this,"_config");this._config=n,n.renderer&&(this._renderer=n.renderer),this._internalLoadingManager=new Ia}setRenderer(n){return this._renderer=n,this}setRenderTargetOptions(n){return this._renderTargetOptions=n,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: A Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const n=this._config.createMaterial({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new dt,sdr:new dt});return this._config.createQuadRenderer({width:16,height:16,type:Fe,colorSpace:or,material:n,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async processImages(n,t,l){const u=t?new Blob([t],{type:"image/jpeg"}):void 0,c=new Blob([n],{type:"image/jpeg"});let f,m,g=!1;if(typeof createImageBitmap>"u"){const w=await Promise.all([u?Nr(u):Promise.resolve(void 0),Nr(c)]);m=w[0],f=w[1],g=l==="flipY"}else{const w=await Promise.all([u?createImageBitmap(u,{imageOrientation:l||"flipY"}):Promise.resolve(void 0),createImageBitmap(c,{imageOrientation:l||"flipY"})]);m=w[0],f=w[1]}return{sdrImage:f,gainMapImage:m,needsFlip:g}}createTextures(n,t,l){const u=new dt(t||new ImageData(2,2),Wt,Ve,Ve,Ge,Cr,Mt,sr,1,or);u.flipY=l,u.needsUpdate=!0;const c=new dt(n,Wt,Ve,Ve,Ge,Cr,Mt,sr,1,Ta);return c.flipY=l,c.needsUpdate=!0,{gainMap:u,sdr:c}}updateQuadRenderer(n,t,l,u,c){n.width=t.width,n.height=t.height,n.material.gainMap=l,n.material.sdr=u,n.material.gainMapMin=c.gainMapMin,n.material.gainMapMax=c.gainMapMax,n.material.offsetHdr=c.offsetHdr,n.material.offsetSdr=c.offsetSdr,n.material.gamma=c.gamma,n.material.hdrCapacityMin=c.hdrCapacityMin,n.material.hdrCapacityMax=c.hdrCapacityMax,n.material.maxDisplayBoost=Math.pow(2,c.hdrCapacityMax),n.material.needsUpdate=!0}}const bn=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,yn=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class En extends hr{constructor({gamma:n,offsetHdr:t,offsetSdr:l,gainMapMin:u,gainMapMax:c,maxDisplayBoost:f,hdrCapacityMin:m,hdrCapacityMax:g,sdr:w,gainMap:T}){super({name:"GainMapDecoderMaterial",vertexShader:bn,fragmentShader:yn,uniforms:{sdr:{value:w},gainMap:{value:T},gamma:{value:new Ee(1/n[0],1/n[1],1/n[2])},offsetHdr:{value:new Ee().fromArray(t)},offsetSdr:{value:new Ee().fromArray(l)},gainMapMin:{value:new Ee().fromArray(u)},gainMapMax:{value:new Ee().fromArray(c)},weightFactor:{value:(Math.log2(f)-m)/(g-m)}},blending:Aa,depthTest:!1,depthWrite:!1});ge(this,"_maxDisplayBoost");ge(this,"_hdrCapacityMin");ge(this,"_hdrCapacityMax");this._maxDisplayBoost=f,this._hdrCapacityMin=m,this._hdrCapacityMax=g,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(n){this.uniforms.sdr.value=n}get gainMap(){return this.uniforms.gainMap.value}set gainMap(n){this.uniforms.gainMap.value=n}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(n){this.uniforms.offsetHdr.value.fromArray(n)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(n){this.uniforms.offsetSdr.value.fromArray(n)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(n){this.uniforms.gainMapMin.value.fromArray(n)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(n){this.uniforms.gainMapMax.value.fromArray(n)}get gamma(){const n=this.uniforms.gamma.value;return[1/n.x,1/n.y,1/n.z]}set gamma(n){const t=this.uniforms.gamma.value;t.x=1/n[0],t.y=1/n[1],t.z=1/n[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(n){this._hdrCapacityMin=n,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(n){this._hdrCapacityMax=n,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(n){this._maxDisplayBoost=Math.max(1,Math.min(65504,n)),this.calculateWeight()}calculateWeight(){const n=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,n))}}class Qr extends _n{constructor(a,n){super({renderer:a,createMaterial:t=>new En(t),createQuadRenderer:t=>new dr(t)},n)}async render(a,n,t,l){const{sdrImage:u,gainMapImage:c,needsFlip:f}=await this.processImages(t,l,"flipY"),{gainMap:m,sdr:g}=this.createTextures(u,c,f);this.updateQuadRenderer(a,u,m,g,n),a.render()}}class Mn extends Qr{load([a,n,t],l,u,c){const f=this.prepareQuadRenderer();let m,g,w;const T=async()=>{if(m&&g&&w){try{await this.render(f,w,m,g)}catch(A){this.manager.itemError(a),this.manager.itemError(n),this.manager.itemError(t),typeof c=="function"&&c(A),f.disposeOnDemandRenderer();return}typeof l=="function"&&l(f),this.manager.itemEnd(a),this.manager.itemEnd(n),this.manager.itemEnd(t),f.disposeOnDemandRenderer()}};let C=!0,D=0,j=0,J=!0,z=0,$=0,V=!0,ee=0,te=0;const L=()=>{if(typeof u=="function"){const A=D+z+ee,P=j+$+te,q=C&&J&&V;u(new ProgressEvent("progress",{lengthComputable:q,loaded:P,total:A}))}};this.manager.itemStart(a),this.manager.itemStart(n),this.manager.itemStart(t);const R=new Gt(this._internalLoadingManager);R.setResponseType("arraybuffer"),R.setRequestHeader(this.requestHeader),R.setPath(this.path),R.setWithCredentials(this.withCredentials),R.load(a,async A=>{if(typeof A=="string")throw new Error("Invalid sdr buffer");m=A,await T()},A=>{C=A.lengthComputable,j=A.loaded,D=A.total,L()},A=>{this.manager.itemError(a),typeof c=="function"&&c(A)});const re=new Gt(this._internalLoadingManager);re.setResponseType("arraybuffer"),re.setRequestHeader(this.requestHeader),re.setPath(this.path),re.setWithCredentials(this.withCredentials),re.load(n,async A=>{if(typeof A=="string")throw new Error("Invalid gainmap buffer");g=A,await T()},A=>{J=A.lengthComputable,$=A.loaded,z=A.total,L()},A=>{this.manager.itemError(n),typeof c=="function"&&c(A)});const y=new Gt(this._internalLoadingManager);return y.setRequestHeader(this.requestHeader),y.setPath(this.path),y.setWithCredentials(this.withCredentials),y.load(t,async A=>{if(typeof A!="string")throw new Error("Invalid metadata string");w=JSON.parse(A),await T()},A=>{V=A.lengthComputable,te=A.loaded,ee=A.total,L()},A=>{this.manager.itemError(t),typeof c=="function"&&c(A)}),f}}class xn extends Qr{load(a,n,t,l){const u=this.prepareQuadRenderer(),c=new Gt(this._internalLoadingManager);return c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setPath(this.path),c.setWithCredentials(this.withCredentials),this.manager.itemStart(a),c.load(a,async f=>{if(typeof f=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const m=new Uint8Array(f);let g,w,T;try{const C=await wn(m);g=C.sdr,w=C.gainMap,T=C.metadata}catch(C){if(C instanceof qr||C instanceof Kr)console.warn(`Failure to reconstruct an HDR image from ${a}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),T={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},g=m;else throw C}try{await this.render(u,T,g.buffer,w==null?void 0:w.buffer)}catch(C){this.manager.itemError(a),typeof l=="function"&&l(C),u.disposeOnDemandRenderer();return}typeof n=="function"&&n(u),this.manager.itemEnd(a),u.disposeOnDemandRenderer()},t,f=>{this.manager.itemError(a),typeof l=="function"&&l(f)}),u}}const St={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},Jr="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",pt=i=>Array.isArray(i),pr=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function Xt({files:i=pr,path:a="",preset:n=void 0,colorSpace:t=void 0,extensions:l}={}){n&&(mr(n),i=St[n],a=Jr);const u=pt(i),{extension:c,isCubemap:f}=fr(i),m=gr(c);if(!m)throw new Error("useEnvironment: Unrecognized file extension: "+i);const g=Re(D=>D.gl);G.useLayoutEffect(()=>{if(c!=="webp"&&c!=="jpg"&&c!=="jpeg")return;function D(){xt.clear(m,u?[i]:i)}g.domElement.addEventListener("webglcontextlost",D,{once:!0})},[i,g.domElement]);const w=xt(m,u?[i]:i,D=>{(c==="webp"||c==="jpg"||c==="jpeg")&&D.setRenderer(g),D.setPath==null||D.setPath(a),l&&l(D)});let T=u?w[0]:w;if(c==="jpg"||c==="jpeg"||c==="webp"){var C;T=(C=T.renderTarget)==null?void 0:C.texture}return T.mapping=f?Ca:Ra,T.colorSpace=t??(f?"srgb":"srgb-linear"),T}const Sn={files:pr,path:"",preset:void 0,extensions:void 0};Xt.preload=i=>{const a={...Sn,...i};let{files:n,path:t=""}=a;const{preset:l,extensions:u}=a;l&&(mr(l),n=St[l],t=Jr);const{extension:c}=fr(n);if(c==="webp"||c==="jpg"||c==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const f=gr(c);if(!f)throw new Error("useEnvironment: Unrecognized file extension: "+n);xt.preload(f,pt(n)?[n]:n,m=>{m.setPath==null||m.setPath(t),u&&u(m)})};const In={files:pr,preset:void 0};Xt.clear=i=>{const a={...In,...i};let{files:n}=a;const{preset:t}=a;t&&(mr(t),n=St[t]);const{extension:l}=fr(n),u=gr(l);if(!u)throw new Error("useEnvironment: Unrecognized file extension: "+n);xt.clear(u,pt(n)?[n]:n)};function mr(i){if(!(i in St))throw new Error("Preset must be one of: "+Object.keys(St).join(", "))}function fr(i){var a;const n=pt(i)&&i.length===6,t=pt(i)&&i.length===3&&i.some(c=>c.endsWith("json")),l=pt(i)?i[0]:i;return{extension:n?"cube":t?"webp":l.startsWith("data:application/exr")?"exr":l.startsWith("data:application/hdr")?"hdr":l.startsWith("data:image/jpeg")?"jpg":(a=l.split(".").pop())==null||(a=a.split("?"))==null||(a=a.shift())==null?void 0:a.toLowerCase(),isCubemap:n,isGainmap:t}}function gr(i){return i==="cube"?Oa:i==="hdr"?dn:i==="exr"?pn:i==="jpg"||i==="jpeg"?xn:i==="webp"?Mn:null}const Tn=i=>i.current&&i.current.isScene,An=i=>Tn(i)?i.current:i;function vr(i,a,n,t,l={}){var u,c,f,m;l={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...l};const g=An(a||n),w=g.background,T=g.environment,C={backgroundBlurriness:g.backgroundBlurriness,backgroundIntensity:g.backgroundIntensity,backgroundRotation:(u=(c=g.backgroundRotation)==null||c.clone==null?void 0:c.clone())!==null&&u!==void 0?u:[0,0,0],environmentIntensity:g.environmentIntensity,environmentRotation:(f=(m=g.environmentRotation)==null||m.clone==null?void 0:m.clone())!==null&&f!==void 0?f:[0,0,0]};return i!=="only"&&(g.environment=t),i&&(g.background=t),Rr(g,l),()=>{i!=="only"&&(g.environment=T),i&&(g.background=w),Rr(g,C)}}function wr({scene:i,background:a=!1,map:n,...t}){const l=Re(u=>u.scene);return G.useLayoutEffect(()=>{if(n)return vr(a,i,l,n,t)}),null}function ea({background:i=!1,scene:a,blur:n,backgroundBlurriness:t,backgroundIntensity:l,backgroundRotation:u,environmentIntensity:c,environmentRotation:f,...m}){const g=Xt(m),w=Re(T=>T.scene);return G.useLayoutEffect(()=>vr(i,a,w,g,{backgroundBlurriness:n??t,backgroundIntensity:l,backgroundRotation:u,environmentIntensity:c,environmentRotation:f})),G.useEffect(()=>()=>{g.dispose()},[g]),null}function Cn({children:i,near:a=.1,far:n=1e3,resolution:t=256,frames:l=1,map:u,background:c=!1,blur:f,backgroundBlurriness:m,backgroundIntensity:g,backgroundRotation:w,environmentIntensity:T,environmentRotation:C,scene:D,files:j,path:J,preset:z=void 0,extensions:$}){const V=Re(y=>y.gl),ee=Re(y=>y.scene),te=G.useRef(null),[L]=G.useState(()=>new jr),R=G.useMemo(()=>{const y=new Na(t);return y.texture.type=Fe,y},[t]);G.useEffect(()=>()=>{R.dispose()},[R]),G.useLayoutEffect(()=>{if(l===1){const y=V.autoClear;V.autoClear=!0,te.current.update(V,L),V.autoClear=y}return vr(c,D,ee,R.texture,{backgroundBlurriness:f??m,backgroundIntensity:g,backgroundRotation:w,environmentIntensity:T,environmentRotation:C})},[i,L,R.texture,D,ee,c,l,V]);let re=1;return kr(()=>{if(l===1/0||re<l){const y=V.autoClear;V.autoClear=!0,te.current.update(V,L),V.autoClear=y,re++}}),G.createElement(G.Fragment,null,La(G.createElement(G.Fragment,null,i,G.createElement("cubeCamera",{ref:te,args:[a,n,R]}),j||z?G.createElement(ea,{background:!0,files:j,preset:z,path:J,extensions:$}):u?G.createElement(wr,{background:!0,map:u,extensions:$}):null),L))}function Rn(i){var a,n,t,l;const u=Xt(i),c=i.map||u;G.useMemo(()=>Pa({GroundProjectedEnvImpl:rn}),[]),G.useEffect(()=>()=>{u.dispose()},[u]);const f=G.useMemo(()=>[c],[c]),m=(a=i.ground)==null?void 0:a.height,g=(n=i.ground)==null?void 0:n.radius,w=(t=(l=i.ground)==null?void 0:l.scale)!==null&&t!==void 0?t:1e3;return G.createElement(G.Fragment,null,G.createElement(wr,Br({},i,{map:c})),G.createElement("groundProjectedEnvImpl",{args:f,scale:w,height:m,radius:g}))}function On(i){return i.ground?G.createElement(Rn,i):i.map?G.createElement(wr,i):i.children?G.createElement(Cn,i):G.createElement(ea,i)}const zt=6378137;function Yt(i,a,n,t){const l=a*Math.PI*zt/180,u=Math.log(Math.tan((90+i)*Math.PI/360))*zt,c=t*Math.PI*zt/180,f=Math.log(Math.tan((90+n)*Math.PI/360))*zt;return[l-c,0,-(u-f)]}function Pn(i,a,n){const t=Math.pow(2,n),l=Math.floor((a+180)/360*t),u=Math.floor((1-Math.log(Math.tan(i*Math.PI/180)+1/Math.cos(i*Math.PI/180))/Math.PI)/2*t);return{x:l,y:u,z:n}}function Lr(i,a,n){const t=Math.pow(2,n),l=i/t*360-180,c=Math.atan(Math.sinh(Math.PI*(1-2*a/t)))*180/Math.PI,f=(i+1)/t*360-180,g=Math.atan(Math.sinh(Math.PI*(1-2*(a+1)/t)))*180/Math.PI;return{minLat:Math.min(c,g),maxLat:Math.max(c,g),minLon:Math.min(l,f),maxLon:Math.max(l,f)}}const ta=Fa(i=>({center:{lat:-23.55052,lng:-46.633309},zoom:16,setCenter:(a,n)=>i({center:{lat:a,lng:n}}),setZoom:a=>i({zoom:a})})),Nn=({x:i,y:a,z:n,worldCenterLat:t,worldCenterLon:l,offline:u=!1})=>{const c=u?`/tiles/${n}/${i}/${a}.png`:`https://a.tile.openstreetmap.org/${n}/${i}/${a}.png`,f=xt(Da,c),m=G.useMemo(()=>{const w=Lr(i,a,n),T=(w.minLat+w.maxLat)/2,C=(w.minLon+w.maxLon)/2,[D,j,J]=Yt(T,C,t,l);return[D,0,J]},[i,a,n,t,l]),g=G.useMemo(()=>{const w=Lr(i,a,n),T=Yt(w.minLat,w.minLon,t,l),C=Yt(w.maxLat,w.maxLon,t,l),D=Math.abs(C[0]-T[0]),j=Math.abs(C[2]-T[2]);return[D,j]},[i,a,n,t,l]);return F.jsxs("mesh",{position:m,rotation:[-Math.PI/2,0,0],children:[F.jsx("planeGeometry",{args:[g[0],g[1]]}),F.jsx("meshBasicMaterial",{map:f,side:Fr})]})},Ln=({offline:i=!1})=>{const{center:a,zoom:n}=ta(),t=G.useMemo(()=>{const l=Pn(a.lat,a.lng,n),u=[],c=2;for(let f=-c;f<=c;f++)for(let m=-c;m<=c;m++)u.push({x:l.x+f,y:l.y+m,z:n});return u},[a,n]);return F.jsx("group",{children:t.map(l=>F.jsx(Nn,{x:l.x,y:l.y,z:l.z,worldCenterLat:a.lat,worldCenterLon:a.lng,offline:i},`${l.z}-${l.x}-${l.y}`))})},Fn=({url:i,latitude:a,longitude:n,scale:t=1,rotation:l=[0,0,0],altitude:u=0})=>{const{center:c}=ta(),{scene:f}=Ua(i),m=G.useMemo(()=>{const[w,T,C]=Yt(a,n,c.lat,c.lng);return[w,T+u,C]},[a,n,c.lat,c.lng,u]),g=G.useMemo(()=>f.clone(),[f]);return F.jsx("primitive",{object:g,position:m,scale:t,rotation:l})},Dn=({offline:i=!1})=>F.jsxs(ka,{camera:{position:[0,500,500],fov:60},style:{width:"100%",height:"100%",background:"#1a1a1a"},children:[F.jsx("ambientLight",{intensity:.5}),F.jsx("directionalLight",{position:[100,100,50],intensity:1}),F.jsxs("group",{children:[F.jsx(Ln,{offline:i}),F.jsxs("mesh",{position:[0,10,0],children:[F.jsx("sphereGeometry",{args:[2,32,32]}),F.jsx("meshStandardMaterial",{color:"red"})]}),F.jsx(G.Suspense,{fallback:null,children:F.jsx(Fn,{url:"/models/towers/scene.gltf",latitude:-43.7689477,longitude:-22.65294843,scale:45,altitude:45,rotation:[0,0,0]})})]}),F.jsx(mn,{enableDamping:!0,dampingFactor:.06,minDistance:10,maxDistance:5e3}),F.jsx("gridHelper",{args:[1e4,100],position:[0,-.1,0]}),F.jsx("axesHelper",{args:[100]}),F.jsx(On,{preset:"city"})]}),li=()=>{const{profile:i}=la(),[a,n]=kt.useState(!1),[t,l]=kt.useState((i==null?void 0:i.companyId)||null),[u,c]=kt.useState(null),{companies:f}=Ha(),{projects:m}=ca();return kt.useEffect(()=>{if(t){const g=m.filter(w=>w.companyId===t);g.length>0&&!u&&c(g[0].id)}},[t,m,u]),F.jsxs("div",{className:"w-screen h-screen relative bg-[#0a0a0a] overflow-hidden",children:[F.jsx("div",{className:"absolute inset-0 z-0",children:F.jsx(Dn,{offline:a})}),F.jsxs("div",{className:"absolute top-6 left-6 z-10 flex items-center gap-3",children:[F.jsxs("div",{className:"flex items-center gap-2 bg-black/40 backdrop-blur-xl border border-white/10 px-4 h-11 rounded-2xl shadow-2xl",children:[F.jsx("div",{className:"w-6 h-6 rounded-lg bg-primary/20 flex items-center justify-center border border-primary/30",children:F.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-pulse"})}),F.jsxs("span",{className:"text-[11px] font-black uppercase tracking-[0.3em] text-white/90",children:["Orion ",F.jsx("span",{className:"text-primary",children:"Viewer"})]})]}),F.jsx("div",{className:"h-6 w-px bg-white/10 mx-1"}),F.jsxs("div",{className:"flex items-center bg-black/40 backdrop-blur-xl border border-white/10 rounded-2xl pl-4 pr-1 h-11 hover:border-white/20 transition-all shadow-xl group",children:[F.jsx(ua,{className:"w-4 h-4 text-white/40 group-hover:text-primary/60 transition-colors"}),F.jsxs(yr,{value:t||"",onValueChange:l,children:[F.jsx(Er,{className:"w-[180px] bg-transparent border-none text-[11px] font-bold uppercase tracking-widest text-white/80 focus:ring-0",children:F.jsx(Mr,{placeholder:"Selecione Empresa"})}),F.jsx(xr,{className:"bg-slate-900 border-white/10 text-white",children:f.map(g=>F.jsx(Sr,{value:g.id,className:"text-[11px] uppercase font-bold tracking-widest",children:g.name},g.id))})]})]}),F.jsx(ha,{className:"w-4 h-4 text-white/20"}),F.jsxs("div",{className:Ir("flex items-center bg-black/40 backdrop-blur-xl border border-white/10 rounded-2xl pl-4 pr-1 h-11 transition-all shadow-xl group",!t&&"opacity-40 grayscale pointer-events-none"),children:[F.jsx(da,{className:"w-4 h-4 text-white/40 group-hover:text-primary/60 transition-colors"}),F.jsxs(yr,{value:u||"",onValueChange:c,children:[F.jsx(Er,{className:"w-[200px] bg-transparent border-none text-[11px] font-bold uppercase tracking-widest text-white/80 focus:ring-0",children:F.jsx(Mr,{placeholder:"Selecione Obra"})}),F.jsx(xr,{className:"bg-slate-900 border-white/10 text-white",children:m.map(g=>F.jsx(Sr,{value:g.id,className:"text-[11px] uppercase font-bold tracking-widest",children:g.name},g.id))})]})]})]}),F.jsxs("div",{className:"absolute top-6 right-6 z-10 flex flex-col gap-3",children:[F.jsx(Ba,{onLoad:async(g,w)=>{if(!u){rr.error("Selecione um projeto primeiro");return}try{const T=g.map((D,j)=>({projectId:u,externalId:D.name,name:D.name,elementType:"TOWER",latitude:D.coordinates.lat,longitude:D.coordinates.lng,elevation:D.coordinates.altitude,sequence:j,metadata:D.properties||{}})),{error:C}=await pa.from("tower_technical_data").insert(T);if(C)throw C;rr.success("Projeto Importado com Sucesso"),window.location.reload()}catch(T){console.error(T),rr.error("Erro ao importar projeto")}}}),F.jsx(ja,{companyId:t,projectId:u,onCompanyChange:l,onProjectChange:c}),F.jsxs("div",{className:"flex items-center gap-2 bg-black/40 backdrop-blur-xl border border-white/10 px-3 py-1.5 rounded-full self-end",children:[F.jsx("div",{className:Ir("w-1.5 h-1.5 rounded-full",a?"bg-red-500":"bg-green-500")}),F.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest text-white/60",children:a?"Offline":"Live Mode"}),F.jsx("input",{type:"checkbox",checked:a,onChange:g=>n(g.target.checked),className:"opacity-0 absolute inset-0 cursor-pointer"})]})]}),F.jsx("div",{className:"absolute bottom-4 left-4 z-10 text-white/40 text-xs",children:F.jsx("p",{children:"Modules / Geo Viewer / v1.0.0"})})]})};export{li as GeoViewerPage,li as default};
